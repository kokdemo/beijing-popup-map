(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function BS(e,r){const t=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)t[n[i]]=!0;return r?i=>!!t[i.toLowerCase()]:i=>!!t[i]}const S6="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",w6=BS(S6);function wk(e){return!!e||e===""}function NS(e){if(Ga(e)){const r={};for(let t=0;t<e.length;t++){const n=e[t],i=Wf(n)?M6(n):NS(n);if(i)for(const a in i)r[a]=i[a]}return r}else{if(Wf(e))return e;if(Gl(e))return e}}const A6=/;(?![^(]*\))/g,T6=/:(.+)/;function M6(e){const r={};return e.split(A6).forEach(t=>{if(t){const n=t.split(T6);n.length>1&&(r[n[0].trim()]=n[1].trim())}}),r}function zS(e){let r="";if(Wf(e))r=e;else if(Ga(e))for(let t=0;t<e.length;t++){const n=zS(e[t]);n&&(r+=n+" ")}else if(Gl(e))for(const t in e)e[t]&&(r+=t+" ");return r.trim()}const $s={},Py=[],Xd=()=>{},I6=()=>!1,L6=/^on[^a-z]/,zb=e=>L6.test(e),US=e=>e.startsWith("onUpdate:"),Hf=Object.assign,VS=(e,r)=>{const t=e.indexOf(r);t>-1&&e.splice(t,1)},k6=Object.prototype.hasOwnProperty,Co=(e,r)=>k6.call(e,r),Ga=Array.isArray,n1=e=>Ub(e)==="[object Map]",R6=e=>Ub(e)==="[object Set]",Ja=e=>typeof e=="function",Wf=e=>typeof e=="string",GS=e=>typeof e=="symbol",Gl=e=>e!==null&&typeof e=="object",Ak=e=>Gl(e)&&Ja(e.then)&&Ja(e.catch),O6=Object.prototype.toString,Ub=e=>O6.call(e),P6=e=>Ub(e).slice(8,-1),F6=e=>Ub(e)==="[object Object]",jS=e=>Wf(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Hx=BS(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Vb=e=>{const r=Object.create(null);return t=>r[t]||(r[t]=e(t))},D6=/-(\w)/g,jy=Vb(e=>e.replace(D6,(r,t)=>t?t.toUpperCase():"")),B6=/\B([A-Z])/g,i_=Vb(e=>e.replace(B6,"-$1").toLowerCase()),Tk=Vb(e=>e.charAt(0).toUpperCase()+e.slice(1)),G2=Vb(e=>e?`on${Tk(e)}`:""),ab=(e,r)=>!Object.is(e,r),j2=(e,r)=>{for(let t=0;t<e.length;t++)e[t](r)},ob=(e,r,t)=>{Object.defineProperty(e,r,{configurable:!0,enumerable:!1,value:t})},N6=e=>{const r=parseFloat(e);return isNaN(r)?e:r};let AA;const z6=()=>AA||(AA=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Iv;class U6{constructor(r=!1){this.active=!0,this.effects=[],this.cleanups=[],!r&&Iv&&(this.parent=Iv,this.index=(Iv.scopes||(Iv.scopes=[])).push(this)-1)}run(r){if(this.active){const t=Iv;try{return Iv=this,r()}finally{Iv=t}}}on(){Iv=this}off(){Iv=this.parent}stop(r){if(this.active){let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(this.parent&&!r){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.active=!1}}}function V6(e,r=Iv){r&&r.active&&r.effects.push(e)}const HS=e=>{const r=new Set(e);return r.w=0,r.n=0,r},Mk=e=>(e.w&ym)>0,Ik=e=>(e.n&ym)>0,G6=({deps:e})=>{if(e.length)for(let r=0;r<e.length;r++)e[r].w|=ym},j6=e=>{const{deps:r}=e;if(r.length){let t=0;for(let n=0;n<r.length;n++){const i=r[n];Mk(i)&&!Ik(i)?i.delete(e):r[t++]=i,i.w&=~ym,i.n&=~ym}r.length=t}},eC=new WeakMap;let $_=0,ym=1;const tC=30;let jd;const wg=Symbol(""),rC=Symbol("");class WS{constructor(r,t=null,n){this.fn=r,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,V6(this,n)}run(){if(!this.active)return this.fn();let r=jd,t=dm;for(;r;){if(r===this)return;r=r.parent}try{return this.parent=jd,jd=this,dm=!0,ym=1<<++$_,$_<=tC?G6(this):TA(this),this.fn()}finally{$_<=tC&&j6(this),ym=1<<--$_,jd=this.parent,dm=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){jd===this?this.deferStop=!0:this.active&&(TA(this),this.onStop&&this.onStop(),this.active=!1)}}function TA(e){const{deps:r}=e;if(r.length){for(let t=0;t<r.length;t++)r[t].delete(e);r.length=0}}let dm=!0;const Lk=[];function a_(){Lk.push(dm),dm=!1}function o_(){const e=Lk.pop();dm=e===void 0?!0:e}function Pp(e,r,t){if(dm&&jd){let n=eC.get(e);n||eC.set(e,n=new Map);let i=n.get(t);i||n.set(t,i=HS()),kk(i)}}function kk(e,r){let t=!1;$_<=tC?Ik(e)||(e.n|=ym,t=!Mk(e)):t=!e.has(jd),t&&(e.add(jd),jd.deps.push(e))}function w0(e,r,t,n,i,a){const o=eC.get(e);if(!o)return;let l=[];if(r==="clear")l=[...o.values()];else if(t==="length"&&Ga(e))o.forEach((c,p)=>{(p==="length"||p>=n)&&l.push(c)});else switch(t!==void 0&&l.push(o.get(t)),r){case"add":Ga(e)?jS(t)&&l.push(o.get("length")):(l.push(o.get(wg)),n1(e)&&l.push(o.get(rC)));break;case"delete":Ga(e)||(l.push(o.get(wg)),n1(e)&&l.push(o.get(rC)));break;case"set":n1(e)&&l.push(o.get(wg));break}if(l.length===1)l[0]&&nC(l[0]);else{const c=[];for(const p of l)p&&c.push(...p);nC(HS(c))}}function nC(e,r){const t=Ga(e)?e:[...e];for(const n of t)n.computed&&MA(n);for(const n of t)n.computed||MA(n)}function MA(e,r){(e!==jd||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const H6=BS("__proto__,__v_isRef,__isVue"),Rk=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(GS)),W6=$S(),$6=$S(!1,!0),X6=$S(!0),IA=Z6();function Z6(){const e={};return["includes","indexOf","lastIndexOf"].forEach(r=>{e[r]=function(...t){const n=us(this);for(let a=0,o=this.length;a<o;a++)Pp(n,"get",a+"");const i=n[r](...t);return i===-1||i===!1?n[r](...t.map(us)):i}}),["push","pop","shift","unshift","splice"].forEach(r=>{e[r]=function(...t){a_();const n=us(this)[r].apply(this,t);return o_(),n}}),e}function $S(e=!1,r=!1){return function(n,i,a){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return r;if(i==="__v_raw"&&a===(e?r?cD:Bk:r?Dk:Fk).get(n))return n;const o=Ga(n);if(!e&&o&&Co(IA,i))return Reflect.get(IA,i,a);const l=Reflect.get(n,i,a);return(GS(i)?Rk.has(i):H6(i))||(e||Pp(n,"get",i),r)?l:yh(l)?o&&jS(i)?l:l.value:Gl(l)?e?Nk(l):YS(l):l}}const Y6=Ok(),q6=Ok(!0);function Ok(e=!1){return function(t,n,i,a){let o=t[n];if(p1(o)&&yh(o)&&!yh(i))return!1;if(!e&&(!iC(i)&&!p1(i)&&(o=us(o),i=us(i)),!Ga(t)&&yh(o)&&!yh(i)))return o.value=i,!0;const l=Ga(t)&&jS(n)?Number(n)<t.length:Co(t,n),c=Reflect.set(t,n,i,a);return t===us(a)&&(l?ab(i,o)&&w0(t,"set",n,i):w0(t,"add",n,i)),c}}function K6(e,r){const t=Co(e,r);e[r];const n=Reflect.deleteProperty(e,r);return n&&t&&w0(e,"delete",r,void 0),n}function Q6(e,r){const t=Reflect.has(e,r);return(!GS(r)||!Rk.has(r))&&Pp(e,"has",r),t}function J6(e){return Pp(e,"iterate",Ga(e)?"length":wg),Reflect.ownKeys(e)}const Pk={get:W6,set:Y6,deleteProperty:K6,has:Q6,ownKeys:J6},eD={get:X6,set(e,r){return!0},deleteProperty(e,r){return!0}},tD=Hf({},Pk,{get:$6,set:q6}),XS=e=>e,Gb=e=>Reflect.getPrototypeOf(e);function hx(e,r,t=!1,n=!1){e=e.__v_raw;const i=us(e),a=us(r);t||(r!==a&&Pp(i,"get",r),Pp(i,"get",a));const{has:o}=Gb(i),l=n?XS:t?QS:KS;if(o.call(i,r))return l(e.get(r));if(o.call(i,a))return l(e.get(a));e!==i&&e.get(r)}function px(e,r=!1){const t=this.__v_raw,n=us(t),i=us(e);return r||(e!==i&&Pp(n,"has",e),Pp(n,"has",i)),e===i?t.has(e):t.has(e)||t.has(i)}function dx(e,r=!1){return e=e.__v_raw,!r&&Pp(us(e),"iterate",wg),Reflect.get(e,"size",e)}function LA(e){e=us(e);const r=us(this);return Gb(r).has.call(r,e)||(r.add(e),w0(r,"add",e,e)),this}function kA(e,r){r=us(r);const t=us(this),{has:n,get:i}=Gb(t);let a=n.call(t,e);a||(e=us(e),a=n.call(t,e));const o=i.call(t,e);return t.set(e,r),a?ab(r,o)&&w0(t,"set",e,r):w0(t,"add",e,r),this}function RA(e){const r=us(this),{has:t,get:n}=Gb(r);let i=t.call(r,e);i||(e=us(e),i=t.call(r,e)),n&&n.call(r,e);const a=r.delete(e);return i&&w0(r,"delete",e,void 0),a}function OA(){const e=us(this),r=e.size!==0,t=e.clear();return r&&w0(e,"clear",void 0,void 0),t}function vx(e,r){return function(n,i){const a=this,o=a.__v_raw,l=us(o),c=r?XS:e?QS:KS;return!e&&Pp(l,"iterate",wg),o.forEach((p,y)=>n.call(i,c(p),c(y),a))}}function mx(e,r,t){return function(...n){const i=this.__v_raw,a=us(i),o=n1(a),l=e==="entries"||e===Symbol.iterator&&o,c=e==="keys"&&o,p=i[e](...n),y=t?XS:r?QS:KS;return!r&&Pp(a,"iterate",c?rC:wg),{next(){const{value:b,done:w}=p.next();return w?{value:b,done:w}:{value:l?[y(b[0]),y(b[1])]:y(b),done:w}},[Symbol.iterator](){return this}}}}function q0(e){return function(...r){return e==="delete"?!1:this}}function rD(){const e={get(a){return hx(this,a)},get size(){return dx(this)},has:px,add:LA,set:kA,delete:RA,clear:OA,forEach:vx(!1,!1)},r={get(a){return hx(this,a,!1,!0)},get size(){return dx(this)},has:px,add:LA,set:kA,delete:RA,clear:OA,forEach:vx(!1,!0)},t={get(a){return hx(this,a,!0)},get size(){return dx(this,!0)},has(a){return px.call(this,a,!0)},add:q0("add"),set:q0("set"),delete:q0("delete"),clear:q0("clear"),forEach:vx(!0,!1)},n={get(a){return hx(this,a,!0,!0)},get size(){return dx(this,!0)},has(a){return px.call(this,a,!0)},add:q0("add"),set:q0("set"),delete:q0("delete"),clear:q0("clear"),forEach:vx(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(a=>{e[a]=mx(a,!1,!1),t[a]=mx(a,!0,!1),r[a]=mx(a,!1,!0),n[a]=mx(a,!0,!0)}),[e,t,r,n]}const[nD,iD,aD,oD]=rD();function ZS(e,r){const t=r?e?oD:aD:e?iD:nD;return(n,i,a)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(Co(t,i)&&i in n?t:n,i,a)}const sD={get:ZS(!1,!1)},uD={get:ZS(!1,!0)},lD={get:ZS(!0,!1)},Fk=new WeakMap,Dk=new WeakMap,Bk=new WeakMap,cD=new WeakMap;function fD(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hD(e){return e.__v_skip||!Object.isExtensible(e)?0:fD(P6(e))}function YS(e){return p1(e)?e:qS(e,!1,Pk,sD,Fk)}function pD(e){return qS(e,!1,tD,uD,Dk)}function Nk(e){return qS(e,!0,eD,lD,Bk)}function qS(e,r,t,n,i){if(!Gl(e)||e.__v_raw&&!(r&&e.__v_isReactive))return e;const a=i.get(e);if(a)return a;const o=hD(e);if(o===0)return e;const l=new Proxy(e,o===2?n:t);return i.set(e,l),l}function Fy(e){return p1(e)?Fy(e.__v_raw):!!(e&&e.__v_isReactive)}function p1(e){return!!(e&&e.__v_isReadonly)}function iC(e){return!!(e&&e.__v_isShallow)}function zk(e){return Fy(e)||p1(e)}function us(e){const r=e&&e.__v_raw;return r?us(r):e}function Uk(e){return ob(e,"__v_skip",!0),e}const KS=e=>Gl(e)?YS(e):e,QS=e=>Gl(e)?Nk(e):e;function dD(e){dm&&jd&&(e=us(e),kk(e.dep||(e.dep=HS())))}function vD(e,r){e=us(e),e.dep&&nC(e.dep)}function yh(e){return!!(e&&e.__v_isRef===!0)}function mD(e){return yh(e)?e.value:e}const gD={get:(e,r,t)=>mD(Reflect.get(e,r,t)),set:(e,r,t,n)=>{const i=e[r];return yh(i)&&!yh(t)?(i.value=t,!0):Reflect.set(e,r,t,n)}};function Vk(e){return Fy(e)?e:new Proxy(e,gD)}var Gk;class yD{constructor(r,t,n,i){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[Gk]=!1,this._dirty=!0,this.effect=new WS(r,()=>{this._dirty||(this._dirty=!0,vD(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const r=us(this);return dD(r),(r._dirty||!r._cacheable)&&(r._dirty=!1,r._value=r.effect.run()),r._value}set value(r){this._setter(r)}}Gk="__v_isReadonly";function _D(e,r,t=!1){let n,i;const a=Ja(e);return a?(n=e,i=Xd):(n=e.get,i=e.set),new yD(n,i,a||!i,t)}function vm(e,r,t,n){let i;try{i=n?e(...n):e()}catch(a){jb(a,r,t)}return i}function ld(e,r,t,n){if(Ja(e)){const a=vm(e,r,t,n);return a&&Ak(a)&&a.catch(o=>{jb(o,r,t)}),a}const i=[];for(let a=0;a<e.length;a++)i.push(ld(e[a],r,t,n));return i}function jb(e,r,t,n=!0){const i=r?r.vnode:null;if(r){let a=r.parent;const o=r.proxy,l=t;for(;a;){const p=a.ec;if(p){for(let y=0;y<p.length;y++)if(p[y](e,o,l)===!1)return}a=a.parent}const c=r.appContext.config.errorHandler;if(c){vm(c,null,10,[e,o,l]);return}}xD(e,t,i,n)}function xD(e,r,t,n=!0){console.error(e)}let d1=!1,aC=!1;const Gf=[];let Ov=0;const Dy=[];let m0=null,yg=0;const jk=Promise.resolve();let JS=null;function bD(e){const r=JS||jk;return e?r.then(this?e.bind(this):e):r}function ED(e){let r=Ov+1,t=Gf.length;for(;r<t;){const n=r+t>>>1;v1(Gf[n])<e?r=n+1:t=n}return r}function ew(e){(!Gf.length||!Gf.includes(e,d1&&e.allowRecurse?Ov+1:Ov))&&(e.id==null?Gf.push(e):Gf.splice(ED(e.id),0,e),Hk())}function Hk(){!d1&&!aC&&(aC=!0,JS=jk.then($k))}function CD(e){const r=Gf.indexOf(e);r>Ov&&Gf.splice(r,1)}function SD(e){Ga(e)?Dy.push(...e):(!m0||!m0.includes(e,e.allowRecurse?yg+1:yg))&&Dy.push(e),Hk()}function PA(e,r=d1?Ov+1:0){for(;r<Gf.length;r++){const t=Gf[r];t&&t.pre&&(Gf.splice(r,1),r--,t())}}function Wk(e){if(Dy.length){const r=[...new Set(Dy)];if(Dy.length=0,m0){m0.push(...r);return}for(m0=r,m0.sort((t,n)=>v1(t)-v1(n)),yg=0;yg<m0.length;yg++)m0[yg]();m0=null,yg=0}}const v1=e=>e.id==null?1/0:e.id,wD=(e,r)=>{const t=v1(e)-v1(r);if(t===0){if(e.pre&&!r.pre)return-1;if(r.pre&&!e.pre)return 1}return t};function $k(e){aC=!1,d1=!0,Gf.sort(wD);const r=Xd;try{for(Ov=0;Ov<Gf.length;Ov++){const t=Gf[Ov];t&&t.active!==!1&&vm(t,null,14)}}finally{Ov=0,Gf.length=0,Wk(),d1=!1,JS=null,(Gf.length||Dy.length)&&$k()}}function AD(e,r,...t){if(e.isUnmounted)return;const n=e.vnode.props||$s;let i=t;const a=r.startsWith("update:"),o=a&&r.slice(7);if(o&&o in n){const y=`${o==="modelValue"?"model":o}Modifiers`,{number:b,trim:w}=n[y]||$s;w&&(i=t.map(M=>M.trim())),b&&(i=t.map(N6))}let l,c=n[l=G2(r)]||n[l=G2(jy(r))];!c&&a&&(c=n[l=G2(i_(r))]),c&&ld(c,e,6,i);const p=n[l+"Once"];if(p){if(!e.emitted)e.emitted={};else if(e.emitted[l])return;e.emitted[l]=!0,ld(p,e,6,i)}}function Xk(e,r,t=!1){const n=r.emitsCache,i=n.get(e);if(i!==void 0)return i;const a=e.emits;let o={},l=!1;if(!Ja(e)){const c=p=>{const y=Xk(p,r,!0);y&&(l=!0,Hf(o,y))};!t&&r.mixins.length&&r.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}return!a&&!l?(Gl(e)&&n.set(e,null),null):(Ga(a)?a.forEach(c=>o[c]=null):Hf(o,a),Gl(e)&&n.set(e,o),o)}function Hb(e,r){return!e||!zb(r)?!1:(r=r.slice(2).replace(/Once$/,""),Co(e,r[0].toLowerCase()+r.slice(1))||Co(e,i_(r))||Co(e,r))}let Bv=null,Wb=null;function sb(e){const r=Bv;return Bv=e,Wb=e&&e.type.__scopeId||null,r}function TD(e){Wb=e}function MD(){Wb=null}function ID(e,r=Bv,t){if(!r||e._n)return e;const n=(...i)=>{n._d&&WA(-1);const a=sb(r),o=e(...i);return sb(a),n._d&&WA(1),o};return n._n=!0,n._c=!0,n._d=!0,n}function H2(e){const{type:r,vnode:t,proxy:n,withProxy:i,props:a,propsOptions:[o],slots:l,attrs:c,emit:p,render:y,renderCache:b,data:w,setupState:M,ctx:O,inheritAttrs:N}=e;let z,j;const Y=sb(e);try{if(t.shapeFlag&4){const ie=i||n;z=Rv(y.call(ie,ie,b,a,M,w,O)),j=c}else{const ie=r;z=Rv(ie.length>1?ie(a,{attrs:c,slots:l,emit:p}):ie(a,null)),j=r.props?c:LD(c)}}catch(ie){i1.length=0,jb(ie,e,1),z=Ag(E0)}let K=z;if(j&&N!==!1){const ie=Object.keys(j),{shapeFlag:le}=K;ie.length&&le&7&&(o&&ie.some(US)&&(j=kD(j,o)),K=_m(K,j))}return t.dirs&&(K=_m(K),K.dirs=K.dirs?K.dirs.concat(t.dirs):t.dirs),t.transition&&(K.transition=t.transition),z=K,sb(Y),z}const LD=e=>{let r;for(const t in e)(t==="class"||t==="style"||zb(t))&&((r||(r={}))[t]=e[t]);return r},kD=(e,r)=>{const t={};for(const n in e)(!US(n)||!(n.slice(9)in r))&&(t[n]=e[n]);return t};function RD(e,r,t){const{props:n,children:i,component:a}=e,{props:o,children:l,patchFlag:c}=r,p=a.emitsOptions;if(r.dirs||r.transition)return!0;if(t&&c>=0){if(c&1024)return!0;if(c&16)return n?FA(n,o,p):!!o;if(c&8){const y=r.dynamicProps;for(let b=0;b<y.length;b++){const w=y[b];if(o[w]!==n[w]&&!Hb(p,w))return!0}}}else return(i||l)&&(!l||!l.$stable)?!0:n===o?!1:n?o?FA(n,o,p):!0:!!o;return!1}function FA(e,r,t){const n=Object.keys(r);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const a=n[i];if(r[a]!==e[a]&&!Hb(t,a))return!0}return!1}function OD({vnode:e,parent:r},t){for(;r&&r.subTree===e;)(e=r.vnode).el=t,r=r.parent}const PD=e=>e.__isSuspense;function FD(e,r){r&&r.pendingBranch?Ga(e)?r.effects.push(...e):r.effects.push(e):SD(e)}function DD(e,r){if(ff){let t=ff.provides;const n=ff.parent&&ff.parent.provides;n===t&&(t=ff.provides=Object.create(n)),t[e]=r}}function W2(e,r,t=!1){const n=ff||Bv;if(n){const i=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return t&&Ja(r)?r.call(n.proxy):r}}const DA={};function $2(e,r,t){return Zk(e,r,t)}function Zk(e,r,{immediate:t,deep:n,flush:i,onTrack:a,onTrigger:o}=$s){const l=ff;let c,p=!1,y=!1;if(yh(e)?(c=()=>e.value,p=iC(e)):Fy(e)?(c=()=>e,n=!0):Ga(e)?(y=!0,p=e.some(j=>Fy(j)||iC(j)),c=()=>e.map(j=>{if(yh(j))return j.value;if(Fy(j))return Iy(j);if(Ja(j))return vm(j,l,2)})):Ja(e)?r?c=()=>vm(e,l,2):c=()=>{if(!(l&&l.isUnmounted))return b&&b(),ld(e,l,3,[w])}:c=Xd,r&&n){const j=c;c=()=>Iy(j())}let b,w=j=>{b=z.onStop=()=>{vm(j,l,4)}};if(g1)return w=Xd,r?t&&ld(r,l,3,[c(),y?[]:void 0,w]):c(),Xd;let M=y?[]:DA;const O=()=>{if(!!z.active)if(r){const j=z.run();(n||p||(y?j.some((Y,K)=>ab(Y,M[K])):ab(j,M)))&&(b&&b(),ld(r,l,3,[j,M===DA?void 0:M,w]),M=j)}else z.run()};O.allowRecurse=!!r;let N;i==="sync"?N=O:i==="post"?N=()=>$h(O,l&&l.suspense):(O.pre=!0,l&&(O.id=l.uid),N=()=>ew(O));const z=new WS(c,N);return r?t?O():M=z.run():i==="post"?$h(z.run.bind(z),l&&l.suspense):z.run(),()=>{z.stop(),l&&l.scope&&VS(l.scope.effects,z)}}function BD(e,r,t){const n=this.proxy,i=Wf(e)?e.includes(".")?Yk(n,e):()=>n[e]:e.bind(n,n);let a;Ja(r)?a=r:(a=r.handler,t=r);const o=ff;Hy(this);const l=Zk(i,a.bind(n),t);return o?Hy(o):Tg(),l}function Yk(e,r){const t=r.split(".");return()=>{let n=e;for(let i=0;i<t.length&&n;i++)n=n[t[i]];return n}}function Iy(e,r){if(!Gl(e)||e.__v_skip||(r=r||new Set,r.has(e)))return e;if(r.add(e),yh(e))Iy(e.value,r);else if(Ga(e))for(let t=0;t<e.length;t++)Iy(e[t],r);else if(R6(e)||n1(e))e.forEach(t=>{Iy(t,r)});else if(F6(e))for(const t in e)Iy(e[t],r);return e}function ND(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return tw(()=>{e.isMounted=!0}),Jk(()=>{e.isUnmounting=!0}),e}const td=[Function,Array],zD={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:td,onEnter:td,onAfterEnter:td,onEnterCancelled:td,onBeforeLeave:td,onLeave:td,onAfterLeave:td,onLeaveCancelled:td,onBeforeAppear:td,onAppear:td,onAfterAppear:td,onAppearCancelled:td},setup(e,{slots:r}){const t=S7(),n=ND();let i;return()=>{const a=r.default&&Kk(r.default(),!0);if(!a||!a.length)return;let o=a[0];if(a.length>1){for(const N of a)if(N.type!==E0){o=N;break}}const l=us(e),{mode:c}=l;if(n.isLeaving)return X2(o);const p=BA(o);if(!p)return X2(o);const y=oC(p,l,n,t);sC(p,y);const b=t.subTree,w=b&&BA(b);let M=!1;const{getTransitionKey:O}=p.type;if(O){const N=O();i===void 0?i=N:N!==i&&(i=N,M=!0)}if(w&&w.type!==E0&&(!_g(p,w)||M)){const N=oC(w,l,n,t);if(sC(w,N),c==="out-in")return n.isLeaving=!0,N.afterLeave=()=>{n.isLeaving=!1,t.update()},X2(o);c==="in-out"&&p.type!==E0&&(N.delayLeave=(z,j,Y)=>{const K=qk(n,w);K[String(w.key)]=w,z._leaveCb=()=>{j(),z._leaveCb=void 0,delete y.delayedLeave},y.delayedLeave=Y})}return o}}},UD=zD;function qk(e,r){const{leavingVNodes:t}=e;let n=t.get(r.type);return n||(n=Object.create(null),t.set(r.type,n)),n}function oC(e,r,t,n){const{appear:i,mode:a,persisted:o=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:p,onEnterCancelled:y,onBeforeLeave:b,onLeave:w,onAfterLeave:M,onLeaveCancelled:O,onBeforeAppear:N,onAppear:z,onAfterAppear:j,onAppearCancelled:Y}=r,K=String(e.key),ie=qk(t,e),le=(ue,Ke)=>{ue&&ld(ue,n,9,Ke)},Se=(ue,Ke)=>{const ke=Ke[1];le(ue,Ke),Ga(ue)?ue.every(Ce=>Ce.length<=1)&&ke():ue.length<=1&&ke()},ze={mode:a,persisted:o,beforeEnter(ue){let Ke=l;if(!t.isMounted)if(i)Ke=N||l;else return;ue._leaveCb&&ue._leaveCb(!0);const ke=ie[K];ke&&_g(e,ke)&&ke.el._leaveCb&&ke.el._leaveCb(),le(Ke,[ue])},enter(ue){let Ke=c,ke=p,Ce=y;if(!t.isMounted)if(i)Ke=z||c,ke=j||p,Ce=Y||y;else return;let je=!1;const ve=ue._enterCb=Ie=>{je||(je=!0,Ie?le(Ce,[ue]):le(ke,[ue]),ze.delayedLeave&&ze.delayedLeave(),ue._enterCb=void 0)};Ke?Se(Ke,[ue,ve]):ve()},leave(ue,Ke){const ke=String(e.key);if(ue._enterCb&&ue._enterCb(!0),t.isUnmounting)return Ke();le(b,[ue]);let Ce=!1;const je=ue._leaveCb=ve=>{Ce||(Ce=!0,Ke(),ve?le(O,[ue]):le(M,[ue]),ue._leaveCb=void 0,ie[ke]===e&&delete ie[ke])};ie[ke]=e,w?Se(w,[ue,je]):je()},clone(ue){return oC(ue,r,t,n)}};return ze}function X2(e){if($b(e))return e=_m(e),e.children=null,e}function BA(e){return $b(e)?e.children?e.children[0]:void 0:e}function sC(e,r){e.shapeFlag&6&&e.component?sC(e.component.subTree,r):e.shapeFlag&128?(e.ssContent.transition=r.clone(e.ssContent),e.ssFallback.transition=r.clone(e.ssFallback)):e.transition=r}function Kk(e,r=!1,t){let n=[],i=0;for(let a=0;a<e.length;a++){let o=e[a];const l=t==null?o.key:String(t)+String(o.key!=null?o.key:a);o.type===Gd?(o.patchFlag&128&&i++,n=n.concat(Kk(o.children,r,l))):(r||o.type!==E0)&&n.push(l!=null?_m(o,{key:l}):o)}if(i>1)for(let a=0;a<n.length;a++)n[a].patchFlag=-2;return n}const Wx=e=>!!e.type.__asyncLoader,$b=e=>e.type.__isKeepAlive;function VD(e,r){Qk(e,"a",r)}function GD(e,r){Qk(e,"da",r)}function Qk(e,r,t=ff){const n=e.__wdc||(e.__wdc=()=>{let i=t;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(Xb(r,n,t),t){let i=t.parent;for(;i&&i.parent;)$b(i.parent.vnode)&&jD(n,r,t,i),i=i.parent}}function jD(e,r,t,n){const i=Xb(r,e,n,!0);eR(()=>{VS(n[r],i)},t)}function Xb(e,r,t=ff,n=!1){if(t){const i=t[e]||(t[e]=[]),a=r.__weh||(r.__weh=(...o)=>{if(t.isUnmounted)return;a_(),Hy(t);const l=ld(r,t,e,o);return Tg(),o_(),l});return n?i.unshift(a):i.push(a),a}}const A0=e=>(r,t=ff)=>(!g1||e==="sp")&&Xb(e,r,t),HD=A0("bm"),tw=A0("m"),WD=A0("bu"),$D=A0("u"),Jk=A0("bum"),eR=A0("um"),XD=A0("sp"),ZD=A0("rtg"),YD=A0("rtc");function qD(e,r=ff){Xb("ec",e,r)}function eg(e,r,t,n){const i=e.dirs,a=r&&r.dirs;for(let o=0;o<i.length;o++){const l=i[o];a&&(l.oldValue=a[o].value);let c=l.dir[n];c&&(a_(),ld(c,t,8,[e.el,l,e,r]),o_())}}const KD=Symbol(),uC=e=>e?fR(e)?ow(e)||e.proxy:uC(e.parent):null,ub=Hf(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>uC(e.parent),$root:e=>uC(e.root),$emit:e=>e.emit,$options:e=>rw(e),$forceUpdate:e=>e.f||(e.f=()=>ew(e.update)),$nextTick:e=>e.n||(e.n=bD.bind(e.proxy)),$watch:e=>BD.bind(e)}),QD={get({_:e},r){const{ctx:t,setupState:n,data:i,props:a,accessCache:o,type:l,appContext:c}=e;let p;if(r[0]!=="$"){const M=o[r];if(M!==void 0)switch(M){case 1:return n[r];case 2:return i[r];case 4:return t[r];case 3:return a[r]}else{if(n!==$s&&Co(n,r))return o[r]=1,n[r];if(i!==$s&&Co(i,r))return o[r]=2,i[r];if((p=e.propsOptions[0])&&Co(p,r))return o[r]=3,a[r];if(t!==$s&&Co(t,r))return o[r]=4,t[r];lC&&(o[r]=0)}}const y=ub[r];let b,w;if(y)return r==="$attrs"&&Pp(e,"get",r),y(e);if((b=l.__cssModules)&&(b=b[r]))return b;if(t!==$s&&Co(t,r))return o[r]=4,t[r];if(w=c.config.globalProperties,Co(w,r))return w[r]},set({_:e},r,t){const{data:n,setupState:i,ctx:a}=e;return i!==$s&&Co(i,r)?(i[r]=t,!0):n!==$s&&Co(n,r)?(n[r]=t,!0):Co(e.props,r)||r[0]==="$"&&r.slice(1)in e?!1:(a[r]=t,!0)},has({_:{data:e,setupState:r,accessCache:t,ctx:n,appContext:i,propsOptions:a}},o){let l;return!!t[o]||e!==$s&&Co(e,o)||r!==$s&&Co(r,o)||(l=a[0])&&Co(l,o)||Co(n,o)||Co(ub,o)||Co(i.config.globalProperties,o)},defineProperty(e,r,t){return t.get!=null?e._.accessCache[r]=0:Co(t,"value")&&this.set(e,r,t.value,null),Reflect.defineProperty(e,r,t)}};let lC=!0;function JD(e){const r=rw(e),t=e.proxy,n=e.ctx;lC=!1,r.beforeCreate&&NA(r.beforeCreate,e,"bc");const{data:i,computed:a,methods:o,watch:l,provide:c,inject:p,created:y,beforeMount:b,mounted:w,beforeUpdate:M,updated:O,activated:N,deactivated:z,beforeDestroy:j,beforeUnmount:Y,destroyed:K,unmounted:ie,render:le,renderTracked:Se,renderTriggered:ze,errorCaptured:ue,serverPrefetch:Ke,expose:ke,inheritAttrs:Ce,components:je,directives:ve,filters:Ie}=r;if(p&&e7(p,n,null,e.appContext.config.unwrapInjectedRef),o)for(const Rt in o){const $t=o[Rt];Ja($t)&&(n[Rt]=$t.bind(t))}if(i){const Rt=i.call(t,t);Gl(Rt)&&(e.data=YS(Rt))}if(lC=!0,a)for(const Rt in a){const $t=a[Rt],gt=Ja($t)?$t.bind(t,t):Ja($t.get)?$t.get.bind(t,t):Xd,jr=!Ja($t)&&Ja($t.set)?$t.set.bind(t):Xd,Er=L7({get:gt,set:jr});Object.defineProperty(n,Rt,{enumerable:!0,configurable:!0,get:()=>Er.value,set:rn=>Er.value=rn})}if(l)for(const Rt in l)tR(l[Rt],n,t,Rt);if(c){const Rt=Ja(c)?c.call(t):c;Reflect.ownKeys(Rt).forEach($t=>{DD($t,Rt[$t])})}y&&NA(y,e,"c");function St(Rt,$t){Ga($t)?$t.forEach(gt=>Rt(gt.bind(t))):$t&&Rt($t.bind(t))}if(St(HD,b),St(tw,w),St(WD,M),St($D,O),St(VD,N),St(GD,z),St(qD,ue),St(YD,Se),St(ZD,ze),St(Jk,Y),St(eR,ie),St(XD,Ke),Ga(ke))if(ke.length){const Rt=e.exposed||(e.exposed={});ke.forEach($t=>{Object.defineProperty(Rt,$t,{get:()=>t[$t],set:gt=>t[$t]=gt})})}else e.exposed||(e.exposed={});le&&e.render===Xd&&(e.render=le),Ce!=null&&(e.inheritAttrs=Ce),je&&(e.components=je),ve&&(e.directives=ve)}function e7(e,r,t=Xd,n=!1){Ga(e)&&(e=cC(e));for(const i in e){const a=e[i];let o;Gl(a)?"default"in a?o=W2(a.from||i,a.default,!0):o=W2(a.from||i):o=W2(a),yh(o)&&n?Object.defineProperty(r,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:l=>o.value=l}):r[i]=o}}function NA(e,r,t){ld(Ga(e)?e.map(n=>n.bind(r.proxy)):e.bind(r.proxy),r,t)}function tR(e,r,t,n){const i=n.includes(".")?Yk(t,n):()=>t[n];if(Wf(e)){const a=r[e];Ja(a)&&$2(i,a)}else if(Ja(e))$2(i,e.bind(t));else if(Gl(e))if(Ga(e))e.forEach(a=>tR(a,r,t,n));else{const a=Ja(e.handler)?e.handler.bind(t):r[e.handler];Ja(a)&&$2(i,a,e)}}function rw(e){const r=e.type,{mixins:t,extends:n}=r,{mixins:i,optionsCache:a,config:{optionMergeStrategies:o}}=e.appContext,l=a.get(r);let c;return l?c=l:!i.length&&!t&&!n?c=r:(c={},i.length&&i.forEach(p=>lb(c,p,o,!0)),lb(c,r,o)),Gl(r)&&a.set(r,c),c}function lb(e,r,t,n=!1){const{mixins:i,extends:a}=r;a&&lb(e,a,t,!0),i&&i.forEach(o=>lb(e,o,t,!0));for(const o in r)if(!(n&&o==="expose")){const l=t7[o]||t&&t[o];e[o]=l?l(e[o],r[o]):r[o]}return e}const t7={data:zA,props:vg,emits:vg,methods:vg,computed:vg,beforeCreate:vh,created:vh,beforeMount:vh,mounted:vh,beforeUpdate:vh,updated:vh,beforeDestroy:vh,beforeUnmount:vh,destroyed:vh,unmounted:vh,activated:vh,deactivated:vh,errorCaptured:vh,serverPrefetch:vh,components:vg,directives:vg,watch:n7,provide:zA,inject:r7};function zA(e,r){return r?e?function(){return Hf(Ja(e)?e.call(this,this):e,Ja(r)?r.call(this,this):r)}:r:e}function r7(e,r){return vg(cC(e),cC(r))}function cC(e){if(Ga(e)){const r={};for(let t=0;t<e.length;t++)r[e[t]]=e[t];return r}return e}function vh(e,r){return e?[...new Set([].concat(e,r))]:r}function vg(e,r){return e?Hf(Hf(Object.create(null),e),r):r}function n7(e,r){if(!e)return r;if(!r)return e;const t=Hf(Object.create(null),e);for(const n in r)t[n]=vh(e[n],r[n]);return t}function i7(e,r,t,n=!1){const i={},a={};ob(a,Zb,1),e.propsDefaults=Object.create(null),rR(e,r,i,a);for(const o in e.propsOptions[0])o in i||(i[o]=void 0);t?e.props=n?i:pD(i):e.type.props?e.props=i:e.props=a,e.attrs=a}function a7(e,r,t,n){const{props:i,attrs:a,vnode:{patchFlag:o}}=e,l=us(i),[c]=e.propsOptions;let p=!1;if((n||o>0)&&!(o&16)){if(o&8){const y=e.vnode.dynamicProps;for(let b=0;b<y.length;b++){let w=y[b];if(Hb(e.emitsOptions,w))continue;const M=r[w];if(c)if(Co(a,w))M!==a[w]&&(a[w]=M,p=!0);else{const O=jy(w);i[O]=fC(c,l,O,M,e,!1)}else M!==a[w]&&(a[w]=M,p=!0)}}}else{rR(e,r,i,a)&&(p=!0);let y;for(const b in l)(!r||!Co(r,b)&&((y=i_(b))===b||!Co(r,y)))&&(c?t&&(t[b]!==void 0||t[y]!==void 0)&&(i[b]=fC(c,l,b,void 0,e,!0)):delete i[b]);if(a!==l)for(const b in a)(!r||!Co(r,b)&&!0)&&(delete a[b],p=!0)}p&&w0(e,"set","$attrs")}function rR(e,r,t,n){const[i,a]=e.propsOptions;let o=!1,l;if(r)for(let c in r){if(Hx(c))continue;const p=r[c];let y;i&&Co(i,y=jy(c))?!a||!a.includes(y)?t[y]=p:(l||(l={}))[y]=p:Hb(e.emitsOptions,c)||(!(c in n)||p!==n[c])&&(n[c]=p,o=!0)}if(a){const c=us(t),p=l||$s;for(let y=0;y<a.length;y++){const b=a[y];t[b]=fC(i,c,b,p[b],e,!Co(p,b))}}return o}function fC(e,r,t,n,i,a){const o=e[t];if(o!=null){const l=Co(o,"default");if(l&&n===void 0){const c=o.default;if(o.type!==Function&&Ja(c)){const{propsDefaults:p}=i;t in p?n=p[t]:(Hy(i),n=p[t]=c.call(null,r),Tg())}else n=c}o[0]&&(a&&!l?n=!1:o[1]&&(n===""||n===i_(t))&&(n=!0))}return n}function nR(e,r,t=!1){const n=r.propsCache,i=n.get(e);if(i)return i;const a=e.props,o={},l=[];let c=!1;if(!Ja(e)){const y=b=>{c=!0;const[w,M]=nR(b,r,!0);Hf(o,w),M&&l.push(...M)};!t&&r.mixins.length&&r.mixins.forEach(y),e.extends&&y(e.extends),e.mixins&&e.mixins.forEach(y)}if(!a&&!c)return Gl(e)&&n.set(e,Py),Py;if(Ga(a))for(let y=0;y<a.length;y++){const b=jy(a[y]);UA(b)&&(o[b]=$s)}else if(a)for(const y in a){const b=jy(y);if(UA(b)){const w=a[y],M=o[b]=Ga(w)||Ja(w)?{type:w}:w;if(M){const O=jA(Boolean,M.type),N=jA(String,M.type);M[0]=O>-1,M[1]=N<0||O<N,(O>-1||Co(M,"default"))&&l.push(b)}}}const p=[o,l];return Gl(e)&&n.set(e,p),p}function UA(e){return e[0]!=="$"}function VA(e){const r=e&&e.toString().match(/^\s*function (\w+)/);return r?r[1]:e===null?"null":""}function GA(e,r){return VA(e)===VA(r)}function jA(e,r){return Ga(r)?r.findIndex(t=>GA(t,e)):Ja(r)&&GA(r,e)?0:-1}const iR=e=>e[0]==="_"||e==="$stable",nw=e=>Ga(e)?e.map(Rv):[Rv(e)],o7=(e,r,t)=>{if(r._n)return r;const n=ID((...i)=>nw(r(...i)),t);return n._c=!1,n},aR=(e,r,t)=>{const n=e._ctx;for(const i in e){if(iR(i))continue;const a=e[i];if(Ja(a))r[i]=o7(i,a,n);else if(a!=null){const o=nw(a);r[i]=()=>o}}},oR=(e,r)=>{const t=nw(r);e.slots.default=()=>t},s7=(e,r)=>{if(e.vnode.shapeFlag&32){const t=r._;t?(e.slots=us(r),ob(r,"_",t)):aR(r,e.slots={})}else e.slots={},r&&oR(e,r);ob(e.slots,Zb,1)},u7=(e,r,t)=>{const{vnode:n,slots:i}=e;let a=!0,o=$s;if(n.shapeFlag&32){const l=r._;l?t&&l===1?a=!1:(Hf(i,r),!t&&l===1&&delete i._):(a=!r.$stable,aR(r,i)),o=r}else r&&(oR(e,r),o={default:1});if(a)for(const l in i)!iR(l)&&!(l in o)&&delete i[l]};function sR(){return{app:null,config:{isNativeTag:I6,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let l7=0;function c7(e,r){return function(n,i=null){Ja(n)||(n=Object.assign({},n)),i!=null&&!Gl(i)&&(i=null);const a=sR(),o=new Set;let l=!1;const c=a.app={_uid:l7++,_component:n,_props:i,_container:null,_context:a,_instance:null,version:k7,get config(){return a.config},set config(p){},use(p,...y){return o.has(p)||(p&&Ja(p.install)?(o.add(p),p.install(c,...y)):Ja(p)&&(o.add(p),p(c,...y))),c},mixin(p){return a.mixins.includes(p)||a.mixins.push(p),c},component(p,y){return y?(a.components[p]=y,c):a.components[p]},directive(p,y){return y?(a.directives[p]=y,c):a.directives[p]},mount(p,y,b){if(!l){const w=Ag(n,i);return w.appContext=a,y&&r?r(w,p):e(w,p,b),l=!0,c._container=p,p.__vue_app__=c,ow(w.component)||w.component.proxy}},unmount(){l&&(e(null,c._container),delete c._container.__vue_app__)},provide(p,y){return a.provides[p]=y,c}};return c}}function hC(e,r,t,n,i=!1){if(Ga(e)){e.forEach((w,M)=>hC(w,r&&(Ga(r)?r[M]:r),t,n,i));return}if(Wx(n)&&!i)return;const a=n.shapeFlag&4?ow(n.component)||n.component.proxy:n.el,o=i?null:a,{i:l,r:c}=e,p=r&&r.r,y=l.refs===$s?l.refs={}:l.refs,b=l.setupState;if(p!=null&&p!==c&&(Wf(p)?(y[p]=null,Co(b,p)&&(b[p]=null)):yh(p)&&(p.value=null)),Ja(c))vm(c,l,12,[o,y]);else{const w=Wf(c),M=yh(c);if(w||M){const O=()=>{if(e.f){const N=w?y[c]:c.value;i?Ga(N)&&VS(N,a):Ga(N)?N.includes(a)||N.push(a):w?(y[c]=[a],Co(b,c)&&(b[c]=y[c])):(c.value=[a],e.k&&(y[e.k]=c.value))}else w?(y[c]=o,Co(b,c)&&(b[c]=o)):M&&(c.value=o,e.k&&(y[e.k]=o))};o?(O.id=-1,$h(O,t)):O()}}}const $h=FD;function f7(e){return h7(e)}function h7(e,r){const t=z6();t.__VUE__=!0;const{insert:n,remove:i,patchProp:a,createElement:o,createText:l,createComment:c,setText:p,setElementText:y,parentNode:b,nextSibling:w,setScopeId:M=Xd,cloneNode:O,insertStaticContent:N}=e,z=(Me,Qe,Ct,Yt=null,qt=null,_r=null,Pr=!1,xr=null,kr=!!Qe.dynamicChildren)=>{if(Me===Qe)return;Me&&!_g(Me,Qe)&&(Yt=Sa(Me),dn(Me,qt,_r,!0),Me=null),Qe.patchFlag===-2&&(kr=!1,Qe.dynamicChildren=null);const{type:vr,ref:In,shapeFlag:W}=Qe;switch(vr){case iw:j(Me,Qe,Ct,Yt);break;case E0:Y(Me,Qe,Ct,Yt);break;case Z2:Me==null&&K(Qe,Ct,Yt,Pr);break;case Gd:ve(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr);break;default:W&1?Se(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr):W&6?Ie(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr):(W&64||W&128)&&vr.process(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr,Dr)}In!=null&&qt&&hC(In,Me&&Me.ref,_r,Qe||Me,!Qe)},j=(Me,Qe,Ct,Yt)=>{if(Me==null)n(Qe.el=l(Qe.children),Ct,Yt);else{const qt=Qe.el=Me.el;Qe.children!==Me.children&&p(qt,Qe.children)}},Y=(Me,Qe,Ct,Yt)=>{Me==null?n(Qe.el=c(Qe.children||""),Ct,Yt):Qe.el=Me.el},K=(Me,Qe,Ct,Yt)=>{[Me.el,Me.anchor]=N(Me.children,Qe,Ct,Yt,Me.el,Me.anchor)},ie=({el:Me,anchor:Qe},Ct,Yt)=>{let qt;for(;Me&&Me!==Qe;)qt=w(Me),n(Me,Ct,Yt),Me=qt;n(Qe,Ct,Yt)},le=({el:Me,anchor:Qe})=>{let Ct;for(;Me&&Me!==Qe;)Ct=w(Me),i(Me),Me=Ct;i(Qe)},Se=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr)=>{Pr=Pr||Qe.type==="svg",Me==null?ze(Qe,Ct,Yt,qt,_r,Pr,xr,kr):ke(Me,Qe,qt,_r,Pr,xr,kr)},ze=(Me,Qe,Ct,Yt,qt,_r,Pr,xr)=>{let kr,vr;const{type:In,props:W,shapeFlag:st,transition:zt,patchFlag:mr,dirs:fr}=Me;if(Me.el&&O!==void 0&&mr===-1)kr=Me.el=O(Me.el);else{if(kr=Me.el=o(Me.type,_r,W&&W.is,W),st&8?y(kr,Me.children):st&16&&Ke(Me.children,kr,null,Yt,qt,_r&&In!=="foreignObject",Pr,xr),fr&&eg(Me,null,Yt,"created"),W){for(const Mn in W)Mn!=="value"&&!Hx(Mn)&&a(kr,Mn,null,W[Mn],_r,Me.children,Yt,qt,Ti);"value"in W&&a(kr,"value",null,W.value),(vr=W.onVnodeBeforeMount)&&Sv(vr,Yt,Me)}ue(kr,Me,Me.scopeId,Pr,Yt)}fr&&eg(Me,null,Yt,"beforeMount");const nn=(!qt||qt&&!qt.pendingBranch)&&zt&&!zt.persisted;nn&&zt.beforeEnter(kr),n(kr,Qe,Ct),((vr=W&&W.onVnodeMounted)||nn||fr)&&$h(()=>{vr&&Sv(vr,Yt,Me),nn&&zt.enter(kr),fr&&eg(Me,null,Yt,"mounted")},qt)},ue=(Me,Qe,Ct,Yt,qt)=>{if(Ct&&M(Me,Ct),Yt)for(let _r=0;_r<Yt.length;_r++)M(Me,Yt[_r]);if(qt){let _r=qt.subTree;if(Qe===_r){const Pr=qt.vnode;ue(Me,Pr,Pr.scopeId,Pr.slotScopeIds,qt.parent)}}},Ke=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr=0)=>{for(let vr=kr;vr<Me.length;vr++){const In=Me[vr]=xr?sm(Me[vr]):Rv(Me[vr]);z(null,In,Qe,Ct,Yt,qt,_r,Pr,xr)}},ke=(Me,Qe,Ct,Yt,qt,_r,Pr)=>{const xr=Qe.el=Me.el;let{patchFlag:kr,dynamicChildren:vr,dirs:In}=Qe;kr|=Me.patchFlag&16;const W=Me.props||$s,st=Qe.props||$s;let zt;Ct&&tg(Ct,!1),(zt=st.onVnodeBeforeUpdate)&&Sv(zt,Ct,Qe,Me),In&&eg(Qe,Me,Ct,"beforeUpdate"),Ct&&tg(Ct,!0);const mr=qt&&Qe.type!=="foreignObject";if(vr?Ce(Me.dynamicChildren,vr,xr,Ct,Yt,mr,_r):Pr||gt(Me,Qe,xr,null,Ct,Yt,mr,_r,!1),kr>0){if(kr&16)je(xr,Qe,W,st,Ct,Yt,qt);else if(kr&2&&W.class!==st.class&&a(xr,"class",null,st.class,qt),kr&4&&a(xr,"style",W.style,st.style,qt),kr&8){const fr=Qe.dynamicProps;for(let nn=0;nn<fr.length;nn++){const Mn=fr[nn],Wn=W[Mn],Bn=st[Mn];(Bn!==Wn||Mn==="value")&&a(xr,Mn,Wn,Bn,qt,Me.children,Ct,Yt,Ti)}}kr&1&&Me.children!==Qe.children&&y(xr,Qe.children)}else!Pr&&vr==null&&je(xr,Qe,W,st,Ct,Yt,qt);((zt=st.onVnodeUpdated)||In)&&$h(()=>{zt&&Sv(zt,Ct,Qe,Me),In&&eg(Qe,Me,Ct,"updated")},Yt)},Ce=(Me,Qe,Ct,Yt,qt,_r,Pr)=>{for(let xr=0;xr<Qe.length;xr++){const kr=Me[xr],vr=Qe[xr],In=kr.el&&(kr.type===Gd||!_g(kr,vr)||kr.shapeFlag&70)?b(kr.el):Ct;z(kr,vr,In,null,Yt,qt,_r,Pr,!0)}},je=(Me,Qe,Ct,Yt,qt,_r,Pr)=>{if(Ct!==Yt){for(const xr in Yt){if(Hx(xr))continue;const kr=Yt[xr],vr=Ct[xr];kr!==vr&&xr!=="value"&&a(Me,xr,vr,kr,Pr,Qe.children,qt,_r,Ti)}if(Ct!==$s)for(const xr in Ct)!Hx(xr)&&!(xr in Yt)&&a(Me,xr,Ct[xr],null,Pr,Qe.children,qt,_r,Ti);"value"in Yt&&a(Me,"value",Ct.value,Yt.value)}},ve=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr)=>{const vr=Qe.el=Me?Me.el:l(""),In=Qe.anchor=Me?Me.anchor:l("");let{patchFlag:W,dynamicChildren:st,slotScopeIds:zt}=Qe;zt&&(xr=xr?xr.concat(zt):zt),Me==null?(n(vr,Ct,Yt),n(In,Ct,Yt),Ke(Qe.children,Ct,In,qt,_r,Pr,xr,kr)):W>0&&W&64&&st&&Me.dynamicChildren?(Ce(Me.dynamicChildren,st,Ct,qt,_r,Pr,xr),(Qe.key!=null||qt&&Qe===qt.subTree)&&uR(Me,Qe,!0)):gt(Me,Qe,Ct,In,qt,_r,Pr,xr,kr)},Ie=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr)=>{Qe.slotScopeIds=xr,Me==null?Qe.shapeFlag&512?qt.ctx.activate(Qe,Ct,Yt,Pr,kr):dt(Qe,Ct,Yt,qt,_r,Pr,kr):St(Me,Qe,kr)},dt=(Me,Qe,Ct,Yt,qt,_r,Pr)=>{const xr=Me.component=C7(Me,Yt,qt);if($b(Me)&&(xr.ctx.renderer=Dr),w7(xr),xr.asyncDep){if(qt&&qt.registerDep(xr,Rt),!Me.el){const kr=xr.subTree=Ag(E0);Y(null,kr,Qe,Ct)}return}Rt(xr,Me,Qe,Ct,qt,_r,Pr)},St=(Me,Qe,Ct)=>{const Yt=Qe.component=Me.component;if(RD(Me,Qe,Ct))if(Yt.asyncDep&&!Yt.asyncResolved){$t(Yt,Qe,Ct);return}else Yt.next=Qe,CD(Yt.update),Yt.update();else Qe.el=Me.el,Yt.vnode=Qe},Rt=(Me,Qe,Ct,Yt,qt,_r,Pr)=>{const xr=()=>{if(Me.isMounted){let{next:In,bu:W,u:st,parent:zt,vnode:mr}=Me,fr=In,nn;tg(Me,!1),In?(In.el=mr.el,$t(Me,In,Pr)):In=mr,W&&j2(W),(nn=In.props&&In.props.onVnodeBeforeUpdate)&&Sv(nn,zt,In,mr),tg(Me,!0);const Mn=H2(Me),Wn=Me.subTree;Me.subTree=Mn,z(Wn,Mn,b(Wn.el),Sa(Wn),Me,qt,_r),In.el=Mn.el,fr===null&&OD(Me,Mn.el),st&&$h(st,qt),(nn=In.props&&In.props.onVnodeUpdated)&&$h(()=>Sv(nn,zt,In,mr),qt)}else{let In;const{el:W,props:st}=Qe,{bm:zt,m:mr,parent:fr}=Me,nn=Wx(Qe);if(tg(Me,!1),zt&&j2(zt),!nn&&(In=st&&st.onVnodeBeforeMount)&&Sv(In,fr,Qe),tg(Me,!0),W&&Wt){const Mn=()=>{Me.subTree=H2(Me),Wt(W,Me.subTree,Me,qt,null)};nn?Qe.type.__asyncLoader().then(()=>!Me.isUnmounted&&Mn()):Mn()}else{const Mn=Me.subTree=H2(Me);z(null,Mn,Ct,Yt,Me,qt,_r),Qe.el=Mn.el}if(mr&&$h(mr,qt),!nn&&(In=st&&st.onVnodeMounted)){const Mn=Qe;$h(()=>Sv(In,fr,Mn),qt)}(Qe.shapeFlag&256||fr&&Wx(fr.vnode)&&fr.vnode.shapeFlag&256)&&Me.a&&$h(Me.a,qt),Me.isMounted=!0,Qe=Ct=Yt=null}},kr=Me.effect=new WS(xr,()=>ew(vr),Me.scope),vr=Me.update=()=>kr.run();vr.id=Me.uid,tg(Me,!0),vr()},$t=(Me,Qe,Ct)=>{Qe.component=Me;const Yt=Me.vnode.props;Me.vnode=Qe,Me.next=null,a7(Me,Qe.props,Yt,Ct),u7(Me,Qe.children,Ct),a_(),PA(),o_()},gt=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr=!1)=>{const vr=Me&&Me.children,In=Me?Me.shapeFlag:0,W=Qe.children,{patchFlag:st,shapeFlag:zt}=Qe;if(st>0){if(st&128){Er(vr,W,Ct,Yt,qt,_r,Pr,xr,kr);return}else if(st&256){jr(vr,W,Ct,Yt,qt,_r,Pr,xr,kr);return}}zt&8?(In&16&&Ti(vr,qt,_r),W!==vr&&y(Ct,W)):In&16?zt&16?Er(vr,W,Ct,Yt,qt,_r,Pr,xr,kr):Ti(vr,qt,_r,!0):(In&8&&y(Ct,""),zt&16&&Ke(W,Ct,Yt,qt,_r,Pr,xr,kr))},jr=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr)=>{Me=Me||Py,Qe=Qe||Py;const vr=Me.length,In=Qe.length,W=Math.min(vr,In);let st;for(st=0;st<W;st++){const zt=Qe[st]=kr?sm(Qe[st]):Rv(Qe[st]);z(Me[st],zt,Ct,null,qt,_r,Pr,xr,kr)}vr>In?Ti(Me,qt,_r,!0,!1,W):Ke(Qe,Ct,Yt,qt,_r,Pr,xr,kr,W)},Er=(Me,Qe,Ct,Yt,qt,_r,Pr,xr,kr)=>{let vr=0;const In=Qe.length;let W=Me.length-1,st=In-1;for(;vr<=W&&vr<=st;){const zt=Me[vr],mr=Qe[vr]=kr?sm(Qe[vr]):Rv(Qe[vr]);if(_g(zt,mr))z(zt,mr,Ct,null,qt,_r,Pr,xr,kr);else break;vr++}for(;vr<=W&&vr<=st;){const zt=Me[W],mr=Qe[st]=kr?sm(Qe[st]):Rv(Qe[st]);if(_g(zt,mr))z(zt,mr,Ct,null,qt,_r,Pr,xr,kr);else break;W--,st--}if(vr>W){if(vr<=st){const zt=st+1,mr=zt<In?Qe[zt].el:Yt;for(;vr<=st;)z(null,Qe[vr]=kr?sm(Qe[vr]):Rv(Qe[vr]),Ct,mr,qt,_r,Pr,xr,kr),vr++}}else if(vr>st)for(;vr<=W;)dn(Me[vr],qt,_r,!0),vr++;else{const zt=vr,mr=vr,fr=new Map;for(vr=mr;vr<=st;vr++){const ca=Qe[vr]=kr?sm(Qe[vr]):Rv(Qe[vr]);ca.key!=null&&fr.set(ca.key,vr)}let nn,Mn=0;const Wn=st-mr+1;let Bn=!1,Mi=0;const mi=new Array(Wn);for(vr=0;vr<Wn;vr++)mi[vr]=0;for(vr=zt;vr<=W;vr++){const ca=Me[vr];if(Mn>=Wn){dn(ca,qt,_r,!0);continue}let Ki;if(ca.key!=null)Ki=fr.get(ca.key);else for(nn=mr;nn<=st;nn++)if(mi[nn-mr]===0&&_g(ca,Qe[nn])){Ki=nn;break}Ki===void 0?dn(ca,qt,_r,!0):(mi[Ki-mr]=vr+1,Ki>=Mi?Mi=Ki:Bn=!0,z(ca,Qe[Ki],Ct,null,qt,_r,Pr,xr,kr),Mn++)}const mo=Bn?p7(mi):Py;for(nn=mo.length-1,vr=Wn-1;vr>=0;vr--){const ca=mr+vr,Ki=Qe[ca],yl=ca+1<In?Qe[ca+1].el:Yt;mi[vr]===0?z(null,Ki,Ct,yl,qt,_r,Pr,xr,kr):Bn&&(nn<0||vr!==mo[nn]?rn(Ki,Ct,yl,2):nn--)}}},rn=(Me,Qe,Ct,Yt,qt=null)=>{const{el:_r,type:Pr,transition:xr,children:kr,shapeFlag:vr}=Me;if(vr&6){rn(Me.component.subTree,Qe,Ct,Yt);return}if(vr&128){Me.suspense.move(Qe,Ct,Yt);return}if(vr&64){Pr.move(Me,Qe,Ct,Dr);return}if(Pr===Gd){n(_r,Qe,Ct);for(let W=0;W<kr.length;W++)rn(kr[W],Qe,Ct,Yt);n(Me.anchor,Qe,Ct);return}if(Pr===Z2){ie(Me,Qe,Ct);return}if(Yt!==2&&vr&1&&xr)if(Yt===0)xr.beforeEnter(_r),n(_r,Qe,Ct),$h(()=>xr.enter(_r),qt);else{const{leave:W,delayLeave:st,afterLeave:zt}=xr,mr=()=>n(_r,Qe,Ct),fr=()=>{W(_r,()=>{mr(),zt&&zt()})};st?st(_r,mr,fr):fr()}else n(_r,Qe,Ct)},dn=(Me,Qe,Ct,Yt=!1,qt=!1)=>{const{type:_r,props:Pr,ref:xr,children:kr,dynamicChildren:vr,shapeFlag:In,patchFlag:W,dirs:st}=Me;if(xr!=null&&hC(xr,null,Ct,Me,!0),In&256){Qe.ctx.deactivate(Me);return}const zt=In&1&&st,mr=!Wx(Me);let fr;if(mr&&(fr=Pr&&Pr.onVnodeBeforeUnmount)&&Sv(fr,Qe,Me),In&6)xa(Me.component,Ct,Yt);else{if(In&128){Me.suspense.unmount(Ct,Yt);return}zt&&eg(Me,null,Qe,"beforeUnmount"),In&64?Me.type.remove(Me,Qe,Ct,qt,Dr,Yt):vr&&(_r!==Gd||W>0&&W&64)?Ti(vr,Qe,Ct,!1,!0):(_r===Gd&&W&384||!qt&&In&16)&&Ti(kr,Qe,Ct),Yt&&Rn(Me)}(mr&&(fr=Pr&&Pr.onVnodeUnmounted)||zt)&&$h(()=>{fr&&Sv(fr,Qe,Me),zt&&eg(Me,null,Qe,"unmounted")},Ct)},Rn=Me=>{const{type:Qe,el:Ct,anchor:Yt,transition:qt}=Me;if(Qe===Gd){Ar(Ct,Yt);return}if(Qe===Z2){le(Me);return}const _r=()=>{i(Ct),qt&&!qt.persisted&&qt.afterLeave&&qt.afterLeave()};if(Me.shapeFlag&1&&qt&&!qt.persisted){const{leave:Pr,delayLeave:xr}=qt,kr=()=>Pr(Ct,_r);xr?xr(Me.el,_r,kr):kr()}else _r()},Ar=(Me,Qe)=>{let Ct;for(;Me!==Qe;)Ct=w(Me),i(Me),Me=Ct;i(Qe)},xa=(Me,Qe,Ct)=>{const{bum:Yt,scope:qt,update:_r,subTree:Pr,um:xr}=Me;Yt&&j2(Yt),qt.stop(),_r&&(_r.active=!1,dn(Pr,Me,Qe,Ct)),xr&&$h(xr,Qe),$h(()=>{Me.isUnmounted=!0},Qe),Qe&&Qe.pendingBranch&&!Qe.isUnmounted&&Me.asyncDep&&!Me.asyncResolved&&Me.suspenseId===Qe.pendingId&&(Qe.deps--,Qe.deps===0&&Qe.resolve())},Ti=(Me,Qe,Ct,Yt=!1,qt=!1,_r=0)=>{for(let Pr=_r;Pr<Me.length;Pr++)dn(Me[Pr],Qe,Ct,Yt,qt)},Sa=Me=>Me.shapeFlag&6?Sa(Me.component.subTree):Me.shapeFlag&128?Me.suspense.next():w(Me.anchor||Me.el),hr=(Me,Qe,Ct)=>{Me==null?Qe._vnode&&dn(Qe._vnode,null,null,!0):z(Qe._vnode||null,Me,Qe,null,null,null,Ct),PA(),Wk(),Qe._vnode=Me},Dr={p:z,um:dn,m:rn,r:Rn,mt:dt,mc:Ke,pc:gt,pbc:Ce,n:Sa,o:e};let Kn,Wt;return r&&([Kn,Wt]=r(Dr)),{render:hr,hydrate:Kn,createApp:c7(hr,Kn)}}function tg({effect:e,update:r},t){e.allowRecurse=r.allowRecurse=t}function uR(e,r,t=!1){const n=e.children,i=r.children;if(Ga(n)&&Ga(i))for(let a=0;a<n.length;a++){const o=n[a];let l=i[a];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=i[a]=sm(i[a]),l.el=o.el),t||uR(o,l))}}function p7(e){const r=e.slice(),t=[0];let n,i,a,o,l;const c=e.length;for(n=0;n<c;n++){const p=e[n];if(p!==0){if(i=t[t.length-1],e[i]<p){r[n]=i,t.push(n);continue}for(a=0,o=t.length-1;a<o;)l=a+o>>1,e[t[l]]<p?a=l+1:o=l;p<e[t[a]]&&(a>0&&(r[n]=t[a-1]),t[a]=n)}}for(a=t.length,o=t[a-1];a-- >0;)t[a]=o,o=r[o];return t}const d7=e=>e.__isTeleport,Gd=Symbol(void 0),iw=Symbol(void 0),E0=Symbol(void 0),Z2=Symbol(void 0),i1=[];let Hd=null;function HA(e=!1){i1.push(Hd=e?null:[])}function v7(){i1.pop(),Hd=i1[i1.length-1]||null}let m1=1;function WA(e){m1+=e}function m7(e){return e.dynamicChildren=m1>0?Hd||Py:null,v7(),m1>0&&Hd&&Hd.push(e),e}function $A(e,r,t,n,i,a){return m7(mh(e,r,t,n,i,a,!0))}function g7(e){return e?e.__v_isVNode===!0:!1}function _g(e,r){return e.type===r.type&&e.key===r.key}const Zb="__vInternal",lR=({key:e})=>e!=null?e:null,$x=({ref:e,ref_key:r,ref_for:t})=>e!=null?Wf(e)||yh(e)||Ja(e)?{i:Bv,r:e,k:r,f:!!t}:e:null;function mh(e,r=null,t=null,n=0,i=null,a=e===Gd?0:1,o=!1,l=!1){const c={__v_isVNode:!0,__v_skip:!0,type:e,props:r,key:r&&lR(r),ref:r&&$x(r),scopeId:Wb,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null};return l?(aw(c,t),a&128&&e.normalize(c)):t&&(c.shapeFlag|=Wf(t)?8:16),m1>0&&!o&&Hd&&(c.patchFlag>0||a&6)&&c.patchFlag!==32&&Hd.push(c),c}const Ag=y7;function y7(e,r=null,t=null,n=0,i=null,a=!1){if((!e||e===KD)&&(e=E0),g7(e)){const l=_m(e,r,!0);return t&&aw(l,t),m1>0&&!a&&Hd&&(l.shapeFlag&6?Hd[Hd.indexOf(e)]=l:Hd.push(l)),l.patchFlag|=-2,l}if(I7(e)&&(e=e.__vccOpts),r){r=_7(r);let{class:l,style:c}=r;l&&!Wf(l)&&(r.class=zS(l)),Gl(c)&&(zk(c)&&!Ga(c)&&(c=Hf({},c)),r.style=NS(c))}const o=Wf(e)?1:PD(e)?128:d7(e)?64:Gl(e)?4:Ja(e)?2:0;return mh(e,r,t,n,i,o,a,!0)}function _7(e){return e?zk(e)||Zb in e?Hf({},e):e:null}function _m(e,r,t=!1){const{props:n,ref:i,patchFlag:a,children:o}=e,l=r?x7(n||{},r):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&lR(l),ref:r&&r.ref?t&&i?Ga(i)?i.concat($x(r)):[i,$x(r)]:$x(r):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:o,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:r&&e.type!==Gd?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&_m(e.ssContent),ssFallback:e.ssFallback&&_m(e.ssFallback),el:e.el,anchor:e.anchor}}function cR(e=" ",r=0){return Ag(iw,null,e,r)}function Rv(e){return e==null||typeof e=="boolean"?Ag(E0):Ga(e)?Ag(Gd,null,e.slice()):typeof e=="object"?sm(e):Ag(iw,null,String(e))}function sm(e){return e.el===null||e.memo?e:_m(e)}function aw(e,r){let t=0;const{shapeFlag:n}=e;if(r==null)r=null;else if(Ga(r))t=16;else if(typeof r=="object")if(n&65){const i=r.default;i&&(i._c&&(i._d=!1),aw(e,i()),i._c&&(i._d=!0));return}else{t=32;const i=r._;!i&&!(Zb in r)?r._ctx=Bv:i===3&&Bv&&(Bv.slots._===1?r._=1:(r._=2,e.patchFlag|=1024))}else Ja(r)?(r={default:r,_ctx:Bv},t=32):(r=String(r),n&64?(t=16,r=[cR(r)]):t=8);e.children=r,e.shapeFlag|=t}function x7(...e){const r={};for(let t=0;t<e.length;t++){const n=e[t];for(const i in n)if(i==="class")r.class!==n.class&&(r.class=zS([r.class,n.class]));else if(i==="style")r.style=NS([r.style,n.style]);else if(zb(i)){const a=r[i],o=n[i];o&&a!==o&&!(Ga(a)&&a.includes(o))&&(r[i]=a?[].concat(a,o):o)}else i!==""&&(r[i]=n[i])}return r}function Sv(e,r,t,n=null){ld(e,r,7,[t,n])}const b7=sR();let E7=0;function C7(e,r,t){const n=e.type,i=(r?r.appContext:e.appContext)||b7,a={uid:E7++,vnode:e,type:n,parent:r,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new U6(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:r?r.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:nR(n,i),emitsOptions:Xk(n,i),emit:null,emitted:null,propsDefaults:$s,inheritAttrs:n.inheritAttrs,ctx:$s,data:$s,props:$s,attrs:$s,slots:$s,refs:$s,setupState:$s,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=r?r.root:a,a.emit=AD.bind(null,a),e.ce&&e.ce(a),a}let ff=null;const S7=()=>ff||Bv,Hy=e=>{ff=e,e.scope.on()},Tg=()=>{ff&&ff.scope.off(),ff=null};function fR(e){return e.vnode.shapeFlag&4}let g1=!1;function w7(e,r=!1){g1=r;const{props:t,children:n}=e.vnode,i=fR(e);i7(e,t,i,r),s7(e,n);const a=i?A7(e,r):void 0;return g1=!1,a}function A7(e,r){const t=e.type;e.accessCache=Object.create(null),e.proxy=Uk(new Proxy(e.ctx,QD));const{setup:n}=t;if(n){const i=e.setupContext=n.length>1?M7(e):null;Hy(e),a_();const a=vm(n,e,0,[e.props,i]);if(o_(),Tg(),Ak(a)){if(a.then(Tg,Tg),r)return a.then(o=>{XA(e,o,r)}).catch(o=>{jb(o,e,0)});e.asyncDep=a}else XA(e,a,r)}else hR(e,r)}function XA(e,r,t){Ja(r)?e.type.__ssrInlineRender?e.ssrRender=r:e.render=r:Gl(r)&&(e.setupState=Vk(r)),hR(e,t)}let ZA;function hR(e,r,t){const n=e.type;if(!e.render){if(!r&&ZA&&!n.render){const i=n.template||rw(e).template;if(i){const{isCustomElement:a,compilerOptions:o}=e.appContext.config,{delimiters:l,compilerOptions:c}=n,p=Hf(Hf({isCustomElement:a,delimiters:l},o),c);n.render=ZA(i,p)}}e.render=n.render||Xd}Hy(e),a_(),JD(e),o_(),Tg()}function T7(e){return new Proxy(e.attrs,{get(r,t){return Pp(e,"get","$attrs"),r[t]}})}function M7(e){const r=n=>{e.exposed=n||{}};let t;return{get attrs(){return t||(t=T7(e))},slots:e.slots,emit:e.emit,expose:r}}function ow(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Vk(Uk(e.exposed)),{get(r,t){if(t in r)return r[t];if(t in ub)return ub[t](e)}}))}function I7(e){return Ja(e)&&"__vccOpts"in e}const L7=(e,r)=>_D(e,r,g1),k7="3.2.39",R7="http://www.w3.org/2000/svg",xg=typeof document<"u"?document:null,YA=xg&&xg.createElement("template"),O7={insert:(e,r,t)=>{r.insertBefore(e,t||null)},remove:e=>{const r=e.parentNode;r&&r.removeChild(e)},createElement:(e,r,t,n)=>{const i=r?xg.createElementNS(R7,e):xg.createElement(e,t?{is:t}:void 0);return e==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:e=>xg.createTextNode(e),createComment:e=>xg.createComment(e),setText:(e,r)=>{e.nodeValue=r},setElementText:(e,r)=>{e.textContent=r},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>xg.querySelector(e),setScopeId(e,r){e.setAttribute(r,"")},cloneNode(e){const r=e.cloneNode(!0);return"_value"in e&&(r._value=e._value),r},insertStaticContent(e,r,t,n,i,a){const o=t?t.previousSibling:r.lastChild;if(i&&(i===a||i.nextSibling))for(;r.insertBefore(i.cloneNode(!0),t),!(i===a||!(i=i.nextSibling)););else{YA.innerHTML=n?`<svg>${e}</svg>`:e;const l=YA.content;if(n){const c=l.firstChild;for(;c.firstChild;)l.appendChild(c.firstChild);l.removeChild(c)}r.insertBefore(l,t)}return[o?o.nextSibling:r.firstChild,t?t.previousSibling:r.lastChild]}};function P7(e,r,t){const n=e._vtc;n&&(r=(r?[r,...n]:[...n]).join(" ")),r==null?e.removeAttribute("class"):t?e.setAttribute("class",r):e.className=r}function F7(e,r,t){const n=e.style,i=Wf(t);if(t&&!i){for(const a in t)pC(n,a,t[a]);if(r&&!Wf(r))for(const a in r)t[a]==null&&pC(n,a,"")}else{const a=n.display;i?r!==t&&(n.cssText=t):r&&e.removeAttribute("style"),"_vod"in e&&(n.display=a)}}const qA=/\s*!important$/;function pC(e,r,t){if(Ga(t))t.forEach(n=>pC(e,r,n));else if(t==null&&(t=""),r.startsWith("--"))e.setProperty(r,t);else{const n=D7(e,r);qA.test(t)?e.setProperty(i_(n),t.replace(qA,""),"important"):e[n]=t}}const KA=["Webkit","Moz","ms"],Y2={};function D7(e,r){const t=Y2[r];if(t)return t;let n=jy(r);if(n!=="filter"&&n in e)return Y2[r]=n;n=Tk(n);for(let i=0;i<KA.length;i++){const a=KA[i]+n;if(a in e)return Y2[r]=a}return r}const QA="http://www.w3.org/1999/xlink";function B7(e,r,t,n,i){if(n&&r.startsWith("xlink:"))t==null?e.removeAttributeNS(QA,r.slice(6,r.length)):e.setAttributeNS(QA,r,t);else{const a=w6(r);t==null||a&&!wk(t)?e.removeAttribute(r):e.setAttribute(r,a?"":t)}}function N7(e,r,t,n,i,a,o){if(r==="innerHTML"||r==="textContent"){n&&o(n,i,a),e[r]=t==null?"":t;return}if(r==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=t;const c=t==null?"":t;(e.value!==c||e.tagName==="OPTION")&&(e.value=c),t==null&&e.removeAttribute(r);return}let l=!1;if(t===""||t==null){const c=typeof e[r];c==="boolean"?t=wk(t):t==null&&c==="string"?(t="",l=!0):c==="number"&&(t=0,l=!0)}try{e[r]=t}catch{}l&&e.removeAttribute(r)}const[pR,z7]=(()=>{let e=Date.now,r=!1;if(typeof window<"u"){Date.now()>document.createEvent("Event").timeStamp&&(e=performance.now.bind(performance));const t=navigator.userAgent.match(/firefox\/(\d+)/i);r=!!(t&&Number(t[1])<=53)}return[e,r]})();let dC=0;const U7=Promise.resolve(),V7=()=>{dC=0},G7=()=>dC||(U7.then(V7),dC=pR());function j7(e,r,t,n){e.addEventListener(r,t,n)}function H7(e,r,t,n){e.removeEventListener(r,t,n)}function W7(e,r,t,n,i=null){const a=e._vei||(e._vei={}),o=a[r];if(n&&o)o.value=n;else{const[l,c]=$7(r);if(n){const p=a[r]=X7(n,i);j7(e,l,p,c)}else o&&(H7(e,l,o,c),a[r]=void 0)}}const JA=/(?:Once|Passive|Capture)$/;function $7(e){let r;if(JA.test(e)){r={};let n;for(;n=e.match(JA);)e=e.slice(0,e.length-n[0].length),r[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):i_(e.slice(2)),r]}function X7(e,r){const t=n=>{const i=n.timeStamp||pR();(z7||i>=t.attached-1)&&ld(Z7(n,t.value),r,5,[n])};return t.value=e,t.attached=G7(),t}function Z7(e,r){if(Ga(r)){const t=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{t.call(e),e._stopped=!0},r.map(n=>i=>!i._stopped&&n&&n(i))}else return r}const eT=/^on[a-z]/,Y7=(e,r,t,n,i=!1,a,o,l,c)=>{r==="class"?P7(e,n,i):r==="style"?F7(e,t,n):zb(r)?US(r)||W7(e,r,t,n,o):(r[0]==="."?(r=r.slice(1),!0):r[0]==="^"?(r=r.slice(1),!1):q7(e,r,n,i))?N7(e,r,n,a,o,l,c):(r==="true-value"?e._trueValue=n:r==="false-value"&&(e._falseValue=n),B7(e,r,n,i))};function q7(e,r,t,n){return n?!!(r==="innerHTML"||r==="textContent"||r in e&&eT.test(r)&&Ja(t)):r==="spellcheck"||r==="draggable"||r==="translate"||r==="form"||r==="list"&&e.tagName==="INPUT"||r==="type"&&e.tagName==="TEXTAREA"||eT.test(r)&&Wf(t)?!1:r in e}const K7={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};UD.props;const Q7=Hf({patchProp:Y7},O7);let tT;function J7(){return tT||(tT=f7(Q7))}const e8=(...e)=>{const r=J7().createApp(...e),{mount:t}=r;return r.mount=n=>{const i=t8(n);if(!i)return;const a=r._component;!Ja(a)&&!a.render&&!a.template&&(a.template=i.innerHTML),i.innerHTML="";const o=t(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},r};function t8(e){return Wf(e)?document.querySelector(e):e}var dR={},vR={},rT=function(r){return vR[r]},T0=function(r,t){vR[r]=t},r8=function(r){return dR[r]},s_=function(r,t){dR[r]=t},nT={},q2={},K2=34,A_=10,Q2=13;function mR(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function n8(e,r){var t=mR(e);return function(n,i){return r(t(n),i,e)}}function iT(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function Xh(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function i8(e){return e<0?"-"+Xh(-e,6):e>9999?"+"+Xh(e,6):Xh(e,4)}function a8(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":i8(e.getUTCFullYear())+"-"+Xh(e.getUTCMonth()+1,2)+"-"+Xh(e.getUTCDate(),2)+(i?"T"+Xh(r,2)+":"+Xh(t,2)+":"+Xh(n,2)+"."+Xh(i,3)+"Z":n?"T"+Xh(r,2)+":"+Xh(t,2)+":"+Xh(n,2)+"Z":t||r?"T"+Xh(r,2)+":"+Xh(t,2)+"Z":"")}function o8(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(b,w){var M,O,N=i(b,function(z,j){if(M)return M(z,j-1);O=z,M=w?n8(z,w):mR(z)});return N.columns=O||[],N}function i(b,w){var M=[],O=b.length,N=0,z=0,j,Y=O<=0,K=!1;b.charCodeAt(O-1)===A_&&--O,b.charCodeAt(O-1)===Q2&&--O;function ie(){if(Y)return q2;if(K)return K=!1,nT;var Se,ze=N,ue;if(b.charCodeAt(ze)===K2){for(;N++<O&&b.charCodeAt(N)!==K2||b.charCodeAt(++N)===K2;);return(Se=N)>=O?Y=!0:(ue=b.charCodeAt(N++))===A_?K=!0:ue===Q2&&(K=!0,b.charCodeAt(N)===A_&&++N),b.slice(ze+1,Se-1).replace(/""/g,'"')}for(;N<O;){if((ue=b.charCodeAt(Se=N++))===A_)K=!0;else if(ue===Q2)K=!0,b.charCodeAt(N)===A_&&++N;else if(ue!==t)continue;return b.slice(ze,Se)}return Y=!0,b.slice(ze,O)}for(;(j=ie())!==q2;){for(var le=[];j!==nT&&j!==q2;)le.push(j),j=ie();w&&(le=w(le,z++))==null||M.push(le)}return M}function a(b,w){return b.map(function(M){return w.map(function(O){return y(M[O])}).join(e)})}function o(b,w){return w==null&&(w=iT(b)),[w.map(y).join(e)].concat(a(b,w)).join(`
`)}function l(b,w){return w==null&&(w=iT(b)),a(b,w).join(`
`)}function c(b){return b.map(p).join(`
`)}function p(b){return b.map(y).join(e)}function y(b){return b==null?"":b instanceof Date?a8(b):r.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:o,formatBody:l,formatRows:c,formatRow:p,formatValue:y}}var s8=o8(","),u8=s8.parse;function vC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function l8(e){if(Array.isArray(e))return vC(e)}function c8(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gR(e,r){if(!!e){if(typeof e=="string")return vC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return vC(e,r)}}function f8(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zn(e){return l8(e)||c8(e)||gR(e)||f8()}function ne(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function aT(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function tr(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?aT(Object(t),!0).forEach(function(n){ne(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):aT(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Lp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function h8(e){var r=e.default;if(typeof r=="function"){var t=function(){return r.apply(this,arguments)};t.prototype=r.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),t}var mC=Xx;function Xx(e,r){var t=e&&e.type,n;if(t==="FeatureCollection")for(n=0;n<e.features.length;n++)Xx(e.features[n],r);else if(t==="GeometryCollection")for(n=0;n<e.geometries.length;n++)Xx(e.geometries[n],r);else if(t==="Feature")Xx(e.geometry,r);else if(t==="Polygon")oT(e.coordinates,r);else if(t==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)oT(e.coordinates[n],r);return e}function oT(e,r){if(e.length!==0){sT(e[0],r);for(var t=1;t<e.length;t++)sT(e[t],!r)}}function sT(e,r){for(var t=0,n=0,i=0,a=e.length,o=a-1;i<a;o=i++){var l=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),c=t+l;n+=Math.abs(t)>=Math.abs(l)?t-c+l:l-c+t,t=c}t+n>=0!=!!r&&e.reverse()}var Hh=63710088e-1,p8={centimeters:Hh*100,centimetres:Hh*100,degrees:Hh/111325,feet:Hh*3.28084,inches:Hh*39.37,kilometers:Hh/1e3,kilometres:Hh/1e3,meters:Hh,metres:Hh,miles:Hh/1609.344,millimeters:Hh*1e3,millimetres:Hh*1e3,nauticalmiles:Hh/1852,radians:1,yards:Hh*1.0936};function Wy(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function sw(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return Wy(l,r,t)}function d8(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Wy(n,r,t)}function v8(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function m8(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return Wy(n,r,t)}function g8(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return Wy(n,r,t)}function y8(e,r){r===void 0&&(r="kilometers");var t=p8[r];if(!t)throw new Error(r+" units is invalid");return e*t}function gx(e){var r=e%360;return r*Math.PI/180}function _8(e,r){var t,n,i,a,o,l,c,p,y,b,w=0,M=e.type==="FeatureCollection",O=e.type==="Feature",N=M?e.features.length:1;for(t=0;t<N;t++){for(l=M?e.features[t].geometry:O?e.geometry:e,p=M?e.features[t].properties:O?e.properties:{},y=M?e.features[t].bbox:O?e.bbox:void 0,b=M?e.features[t].id:O?e.id:void 0,c=l?l.type==="GeometryCollection":!1,o=c?l.geometries.length:1,i=0;i<o;i++){if(a=c?l.geometries[i]:l,a===null){if(r(null,w,p,y,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,w,p,y,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],w,p,y,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function yR(e,r){_8(e,function(t,n,i,a,o){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(Wy(t,i,{bbox:a,id:o}),n,0)===!1?!1:void 0}var c;switch(l){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var y=t.coordinates[p],b={type:c,coordinates:y};if(r(Wy(b,i),n,p)===!1)return!1}})}function _R(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function y1(e){return e.type==="Feature"?e.geometry:e}function xR(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,o=r.coordinates,l=r.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};for(var p=function(M){var O=e[M];if(l){var N=tr({},O[l]),z=mC(N,!0);return yR(z,function(ue){var Ke=_R(ue),ke=tr(tr({},O),{},{_id:M,coordinates:Ke});c.push(ke)}),"continue"}var j=[];if(o){var Y="Polygon";Array.isArray(o[0])||(Y="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(Y="LineString");var K={type:Y,coordinates:zn(O[o])},ie=mC(K,!0);j=ie.coordinates}else if(t&&n&&i&&a){var le=[parseFloat(O[t]),parseFloat(O[n])],Se=[parseFloat(O[i]),parseFloat(O[a])];j=[le,Se]}else t&&n&&(j=[parseFloat(O[t]),parseFloat(O[n])]);var ze=tr(tr({},O),{},{_id:M,coordinates:j});c.push(ze)},y=0;y<e.length;y++)var b=p(y);return{dataArray:c}}function x8(e,r){var t=u8(e);return xR(t,r)}function b8(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function E8(e,r){return r===void 0?null:r==="id"&&e.id?e.id:e[r]?e[r]:e.properties&&e.properties[r]?b8(e.properties[r]+"")%1000019:null}function C8(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),mC(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(yR(e,function(i,a){var o=E8(i,r==null?void 0:r.featureId);o===null&&(o=a);var l=o,c=_R(i),p=tr(tr({},i.properties),{},{coordinates:c,_id:l});t.push(p)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function S8(e){if(Array.isArray(e))return e}function w8(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function A8(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pi(e,r){return S8(e)||w8(e,r)||gR(e,r)||A8()}var X_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function uw(e){this.message=e}uw.prototype=new Error;uw.prototype.name="InvalidCharacterError";function T8(e){var r=String(e).replace(/=+$/,"");if(r.length%4===1)throw new uw("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,i,a,o=0;a=r.charAt(o++);~a&&(i=n%4?i*64+a:a,n++%4)?t+=String.fromCharCode(255&i>>(-2*n&6)):0)a=X_.indexOf(a);return t}function bR(e){e=String(e);for(var r,t,n,i,a="",o=0,l=e.length%3;o<e.length;){if((t=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");r=t<<16|n<<8|i,a+=X_.charAt(r>>18&63)+X_.charAt(r>>12&63)+X_.charAt(r>>6&63)+X_.charAt(r&63)}return l?a.slice(0,l-3)+"===".substring(l):a}function Kt(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function uT(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qt(e,r,t){return r&&uT(e.prototype,r),t&&uT(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var M8=function(){function e(r,t){Kt(this,e),this.buffers=r,this.type=t}return Qt(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,i){throw new Error("not implemented")}}]),e}(),ud;typeof window>"u"?ud={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(r){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(r){return!0},Event:function(r,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:ud=window;var I8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;const L8=I8?my.getSystemInfoSync().pixelRatio:ud.devicePixelRatio;function _1(e,r){return _1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},_1(e,r)}function On(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&_1(e,r)}function x1(e){return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},x1(e)}function vt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fn(e,r){if(r&&(x1(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vt(e)}function At(e){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},At(e)}var ER=Qt(function e(r,t){Kt(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=r,this.timeStamp=Date.now()});function k8(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=R8(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function R8(e,r){if(!!e){if(typeof e=="string")return lT(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lT(e,r)}}function lT(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var T_=new WeakMap,lw=function(){function e(){Kt(this,e),T_.set(this,{})}return Qt(e,[{key:"addEventListener",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=T_.get(this);a||(a={}),a[t]||(a[t]=[]),a[t].push(n),T_.set(this,a),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(t,n){var i=T_.get(this);if(i){var a=i[t];if(a&&a.length>0){for(var o=a.length;o--;o>0)if(a[o]===n){a.splice(o,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=T_.get(this)[t.type];if(n){var i=k8(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o(t)}}catch(l){i.e(l)}finally{i.f()}}}}]),e}();function O8(e){var r=P8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function P8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CR=function(e){On(t,e);var r=O8(t);function t(){var n;return Kt(this,t),n=r.call(this),n.childNodes=[],n}return Qt(t,[{key:"appendChild",value:function(i){this.childNodes.push(i)}},{key:"cloneNode",value:function(){var i=Object.create(this);return Object.assign(i,this),i}},{key:"removeChild",value:function(i){var a=this.childNodes.findIndex(function(o){return o===i});return a>-1?this.childNodes.splice(a,1):null}}]),t}(lw);function F8(e){var r=D8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function D8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var SR=function(e){On(t,e);var r=F8(t);function t(){var n;return Kt(this,t),n=r.call(this),n.className="",n.children=[],n}return Qt(t,[{key:"setAttribute",value:function(i,a){this[i]=a}},{key:"getAttribute",value:function(i){return this[i]}},{key:"setAttributeNS",value:function(i,a){this[i]=a}},{key:"getAttributeNS",value:function(i){return this[i]}}]),t}(CR),B8=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,gC,yC,_C,xC;if(B8){var yx=my.getSystemInfoSync();gC=yx.screenWidth,yC=yx.screenHeight,_C=yx.windowWidth,xC=yx.windowHeight}else{var cT=ud.innerWidth,fT=ud.innerHeight;gC=cT,yC=fT,_C=cT,xC=fT}var a1={width:gC,height:yC,availWidth:_C,availHeight:xC,availLeft:0,availTop:0},Yb=a1.availWidth,qb=a1.availHeight,hT={style:[]};function wR(e,r){if(!("parentNode"in e)){var t;r===0?t=function(){return null}:r===1?t=function(){return hT}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;r===0?n=function(){return null}:r===1?n=function(){return hT}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function N8(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Yb+"px",height:qb+"px",margin:"0px",padding:"0px"})}function z8(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Yb,e.clientHeight=qb),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var r={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return r})}function U8(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Yb,e.offsetHeight=qb)}function V8(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Yb,e.scrollHeight=qb)}function AR(e){var r=function(){return!0};e.classList=[],e.classList.add=r,e.classList.remove=r,e.classList.contains=r,e.classList.toggle=r}function G8(e){var r=j8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function j8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function fy(){}var u_=function(e){On(t,e);var r=G8(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0;return Kt(this,t),n=r.call(this),n.className="",n.children=[],n.focus=fy,n.blur=fy,n.insertBefore=fy,n.appendChild=fy,n.removeChild=fy,n.remove=fy,n.innerHTML="",n.tagName=i.toUpperCase(),wR(vt(n),a),N8(vt(n)),AR(vt(n)),z8(vt(n)),U8(vt(n)),V8(vt(n)),n}return Qt(t)}(SR);function H8(e){var r=W8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function W8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TR=function(e){On(t,e);var r=H8(t);function t(n){return Kt(this,t),r.call(this,n)}return Qt(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(u_);function $8(e){var r=X8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function X8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var MR=function(e){On(t,e);var r=$8(t);function t(){return Kt(this,t),r.call(this,"video")}return Qt(t)}(TR),Z8={};function cw(){return Z8}var IR=Qt(function e(){Kt(this,e);var r=cw(),t=r.createImage&&r.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),wR(t),AR(t),Object.assign(t,{addEventListener:function(i,a){t["on".concat(i)]=a.bind(t)},removeEventListener:function(i){t["on".concat(i)]=null}}),t}),LR={href:"",protocol:"",host:""};function kR(e){var r=Y8();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Y8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var q8=function(e){On(t,e);var r=kR(t);function t(){return Kt(this,t),r.call(this,"body",0)}return Qt(t,[{key:"addEventListener",value:function(i,a){}},{key:"removeEventListener",value:function(i,a,o){}},{key:"dispatchEvent",value:function(i){}}]),t}(u_),K8=function(e){On(t,e);var r=kR(t);function t(){return Kt(this,t),r.call(this,"html",0)}return Qt(t,[{key:"addEventListener",value:function(i,a){}},{key:"removeEventListener",value:function(i,a){}},{key:"dispatchEvent",value:function(i){}}]),t}(u_),M_={},Cg={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:LR,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(r){return r=r.toLowerCase(),r==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):r==="img"?new IR:r==="video"?new MR:new u_(r)},createElementNS:function(r,t){return this.createElement(t)},createTextNode:function(r){return r},getElementById:function(r){return null},getElementsByTagName:function(r){return r=r.toLowerCase(),[]},getElementsByTagNameNS:function(r,t){return this.getElementsByTagName(t)},getElementsByName:function(r){return[]},querySelector:function(r){return null},querySelectorAll:function(r){return[]},addEventListener:function(r,t,n){M_[r]||(M_[r]=[]),M_[r].push(t)},removeEventListener:function(r,t){var n=M_[r];if(n&&n.length>0){for(var i=n.length;i--;i>0)if(n[i]===t){n.splice(i,1);break}}},dispatchEvent:function(r){var t=r.type,n=M_[t];if(n)for(var i=0;i<n.length;i++)n[i](r);r.target&&typeof r.target["on"+t]=="function"&&r.target["on"+t](r)},createEvent:function(r){return new ER(r)}};Cg.documentElement=new K8;Cg.head=new u_("head");Cg.body=new q8;var Q8=Object,J8=function(){function e(){Kt(this,e);var r=arguments.length;if(r===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else r===3&&x1(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return Qt(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),eB=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,bC,Wh,cb;if(eB){var J2=my.getSystemInfoSync();bC=J2.system,Wh=J2.platform,cb=J2.language}else{var wp={versions:function(){var e=ud.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(ud.navigator.browserLanguage||ud.navigator.language).toLowerCase()};wp.versions.android?Wh="android":wp.versions.trident?Wh="IE":wp.versions.presto?Wh="Opera":wp.versions.webKit?Wh="webKit":wp.versions.gecko?Wh="Firefox":wp.versions.mobile?Wh="mobile":wp.versions.ios?Wh="ios":wp.versions.iPhone?Wh="iPhone":wp.versions.iPad?Wh="ipad":wp.versions.webApp?Wh="webApp":wp.versions.weixin?Wh="weixin":wp.versions.qq&&(Wh="qq"),bC=ud.navigator.userAgent,cb=wp.language}var tB=bC.toLowerCase().indexOf("android")!==-1,RR=tB?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",rB="Mozilla/5.0 (".concat(RR,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(cb),nB={platform:Wh,language:cb,appVersion:"5.0 (".concat(RR,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:rB},iB={mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){}},pT=0,dT=0;function aB(e){var r=Date.now(),t=Math.max(pT+23,r);return dT=setTimeout(function(){e(pT=t)},t-r),dT}function oB(e){var r=cw();return r.requestAnimationFrame?r.requestAnimationFrame(e):aB(e)}function sB(e){var r=cw();return r.cancelAnimationFrame?r.cancelAnimationFrame(e):clearTimeout(e)}var uB=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(Kt(this,e),r.indexOf("http://")==0||r.indexOf("https://")==0){this.href=r;return}this.href=t+r}return Qt(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],i=t.type,a=lB(n),o="data:".concat(i,";base64, ");return o+a}}]),e}();function lB(e){for(var r="",t=new Uint8Array(e),n=t.byteLength,i=0;i<n;i++)r+=String.fromCharCode(t[i]);return bR(r)}var cB={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},fB={};function hB(e){var r=pB();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function pB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eE=new Map,vT=new Map,dB=new Map,Vg=function(e){On(t,e);var r=hB(t);function t(){var n;return Kt(this,t),n=r.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,eE.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return Qt(t,[{key:"responseType",set:function(i){this._responseType=i}},{key:"abort",value:function(){var i=dB.get("requestTask");i&&i.abort()}},{key:"getAllResponseHeaders",value:function(){var i=vT.get("responseHeader");return Object.keys(i).map(function(a){return"".concat(a,": ").concat(i[a])}).join(`
`)}},{key:"getResponseHeader",value:function(i){return vT.get("responseHeader")[i]}},{key:"open",value:function(i,a,o){this._method=i,this._url=a}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(i,a){var o=eE.get("requestHeader");o[i]=a,eE.set("requestHeader",o)}},{key:"addEventListener",value:function(i,a){var o=this;typeof a=="function"&&(this["on"+i]=function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};l.target=l.target||o,a.call(o,l)})}},{key:"removeEventListener",value:function(i,a){this["on"+i]===a&&(this["on"+i]=null)}}]),t}(lw);Vg.UNSEND=0;Vg.OPENED=1;Vg.HEADERS_RECEIVED=2;Vg.LOADING=3;Vg.DONE=4;var vB=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,mB=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),Zh=vB||mB,gB={atob:T8,btoa:bR,devicePixelRatio:L8,Blob:M8,document:Cg,Element:SR,Event:ER,EventTarget:lw,HTMLCanvasElement:Q8,HTMLElement:u_,HTMLMediaElement:TR,HTMLVideoElement:MR,Image:IR,ImageData:J8,navigator:nB,Node:CR,requestAnimationFrame:oB,cancelAnimationFrame:sB,screen:a1,XMLHttpRequest:Vg,performance:iB,URL:uB,WebGLRenderingContext:cB,WebGL2RenderingContext:fB,addEventListener:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Cg.addEventListener(r,t,n)},removeEventListener:function(r,t,n){Cg.removeEventListener(r,t)},dispatchEvent:function(r){Cg.dispatchEvent(r)},innerWidth:a1.availWidth,innerHeight:a1.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ho=Zh?gB:ud,yB=Zh?Vg:ud.XMLHttpRequest;Zh||ud.location;function _B(e){var r=e;return typeof e=="string"&&(r=Ho.document.getElementById(e)),r}function OR(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function xB(e){return OR(e).split(/\s+/)}function bB(e){var r,t,n=Ho==null||(r=Ho.document)===null||r===void 0||(t=r.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var i in e)if(e[i]&&e[i]in n)return e[i];return e[0]}function Ul(e,r,t){var n=Ho.document.createElement(e);return n.className=r||"",t&&t.appendChild(n),n}function b1(e){var r=e.parentNode;r&&r.removeChild(e)}function kg(e,r){if(e.classList!==void 0)for(var t=xB(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!EB(e,r)){var a=fw(e);PR(e,(a?a+" ":"")+r)}}function E1(e,r){e.classList!==void 0?e.classList.remove(r):PR(e,OR((" "+fw(e)+" ").replace(" "+r+" "," ")))}function EB(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=fw(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function PR(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function fw(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function mT(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var CB=bB(["transform","WebkitTransform"]);function SB(e,r){e.style[CB]=r}function wB(){if(typeof Event=="function")Ho.dispatchEvent(new Event("resize"));else{var e=Ho.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ho,0),Ho.dispatchEvent(e)}}function AB(){var e,r=Ho.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),o=Pi(a,2),l=o[0];return o[1],l==="initial-scale"});return n?n.split("=")[1]*1:1}var Ou=AB()<1?1:Ho.devicePixelRatio;function TB(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function MB(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function FR(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function IB(e){if(e.length===0)throw new Error("mean requires at least one data point");return FR(e)/e.length}function LB(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var DR={min:MB,max:TB,mean:IB,sum:FR,mode:LB};function BR(e,r){return e.map(function(t){return t[r]})}function gT(e,r,t,n,i,a,o){try{var l=e[a](o),c=l.value}catch(p){t(p);return}l.done?r(c):Promise.resolve(c).then(n,i)}function eo(e){return function(){var r=this,t=arguments;return new Promise(function(n,i){var a=e.apply(r,t);function o(c){gT(a,n,i,o,l,"next",c)}function l(c){gT(a,n,i,o,l,"throw",c)}o(void 0)})}}function kB(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function RB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function By(e,r,t){return RB()?By=Reflect.construct.bind():By=function(i,a,o){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return o&&_1(p,o.prototype),p},By.apply(null,arguments)}function EC(e){var r=typeof Map=="function"?new Map:void 0;return EC=function(n){if(n===null||!kB(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return By(n,arguments,At(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_1(i,n)},EC(e)}var NR={exports:{}},zR={exports:{}};(function(e){function r(t){return e.exports=r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(zR);(function(e){var r=zR.exports.default;function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=t=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o=typeof Symbol=="function"?Symbol:{},l=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",p=o.toStringTag||"@@toStringTag";function y(ve,Ie,dt){return Object.defineProperty(ve,Ie,{value:dt,enumerable:!0,configurable:!0,writable:!0}),ve[Ie]}try{y({},"")}catch{y=function(dt,St,Rt){return dt[St]=Rt}}function b(ve,Ie,dt,St){var Rt=Ie&&Ie.prototype instanceof O?Ie:O,$t=Object.create(Rt.prototype),gt=new ke(St||[]);return $t._invoke=function(jr,Er,rn){var dn="suspendedStart";return function(Rn,Ar){if(dn==="executing")throw new Error("Generator is already running");if(dn==="completed"){if(Rn==="throw")throw Ar;return je()}for(rn.method=Rn,rn.arg=Ar;;){var xa=rn.delegate;if(xa){var Ti=ze(xa,rn);if(Ti){if(Ti===M)continue;return Ti}}if(rn.method==="next")rn.sent=rn._sent=rn.arg;else if(rn.method==="throw"){if(dn==="suspendedStart")throw dn="completed",rn.arg;rn.dispatchException(rn.arg)}else rn.method==="return"&&rn.abrupt("return",rn.arg);dn="executing";var Sa=w(jr,Er,rn);if(Sa.type==="normal"){if(dn=rn.done?"completed":"suspendedYield",Sa.arg===M)continue;return{value:Sa.arg,done:rn.done}}Sa.type==="throw"&&(dn="completed",rn.method="throw",rn.arg=Sa.arg)}}}(ve,dt,gt),$t}function w(ve,Ie,dt){try{return{type:"normal",arg:ve.call(Ie,dt)}}catch(St){return{type:"throw",arg:St}}}n.wrap=b;var M={};function O(){}function N(){}function z(){}var j={};y(j,l,function(){return this});var Y=Object.getPrototypeOf,K=Y&&Y(Y(Ce([])));K&&K!==i&&a.call(K,l)&&(j=K);var ie=z.prototype=O.prototype=Object.create(j);function le(ve){["next","throw","return"].forEach(function(Ie){y(ve,Ie,function(dt){return this._invoke(Ie,dt)})})}function Se(ve,Ie){function dt(Rt,$t,gt,jr){var Er=w(ve[Rt],ve,$t);if(Er.type!=="throw"){var rn=Er.arg,dn=rn.value;return dn&&r(dn)=="object"&&a.call(dn,"__await")?Ie.resolve(dn.__await).then(function(Rn){dt("next",Rn,gt,jr)},function(Rn){dt("throw",Rn,gt,jr)}):Ie.resolve(dn).then(function(Rn){rn.value=Rn,gt(rn)},function(Rn){return dt("throw",Rn,gt,jr)})}jr(Er.arg)}var St;this._invoke=function(Rt,$t){function gt(){return new Ie(function(jr,Er){dt(Rt,$t,jr,Er)})}return St=St?St.then(gt,gt):gt()}}function ze(ve,Ie){var dt=ve.iterator[Ie.method];if(dt===void 0){if(Ie.delegate=null,Ie.method==="throw"){if(ve.iterator.return&&(Ie.method="return",Ie.arg=void 0,ze(ve,Ie),Ie.method==="throw"))return M;Ie.method="throw",Ie.arg=new TypeError("The iterator does not provide a 'throw' method")}return M}var St=w(dt,ve.iterator,Ie.arg);if(St.type==="throw")return Ie.method="throw",Ie.arg=St.arg,Ie.delegate=null,M;var Rt=St.arg;return Rt?Rt.done?(Ie[ve.resultName]=Rt.value,Ie.next=ve.nextLoc,Ie.method!=="return"&&(Ie.method="next",Ie.arg=void 0),Ie.delegate=null,M):Rt:(Ie.method="throw",Ie.arg=new TypeError("iterator result is not an object"),Ie.delegate=null,M)}function ue(ve){var Ie={tryLoc:ve[0]};1 in ve&&(Ie.catchLoc=ve[1]),2 in ve&&(Ie.finallyLoc=ve[2],Ie.afterLoc=ve[3]),this.tryEntries.push(Ie)}function Ke(ve){var Ie=ve.completion||{};Ie.type="normal",delete Ie.arg,ve.completion=Ie}function ke(ve){this.tryEntries=[{tryLoc:"root"}],ve.forEach(ue,this),this.reset(!0)}function Ce(ve){if(ve){var Ie=ve[l];if(Ie)return Ie.call(ve);if(typeof ve.next=="function")return ve;if(!isNaN(ve.length)){var dt=-1,St=function Rt(){for(;++dt<ve.length;)if(a.call(ve,dt))return Rt.value=ve[dt],Rt.done=!1,Rt;return Rt.value=void 0,Rt.done=!0,Rt};return St.next=St}}return{next:je}}function je(){return{value:void 0,done:!0}}return N.prototype=z,y(ie,"constructor",z),y(z,"constructor",N),N.displayName=y(z,p,"GeneratorFunction"),n.isGeneratorFunction=function(ve){var Ie=typeof ve=="function"&&ve.constructor;return!!Ie&&(Ie===N||(Ie.displayName||Ie.name)==="GeneratorFunction")},n.mark=function(ve){return Object.setPrototypeOf?Object.setPrototypeOf(ve,z):(ve.__proto__=z,y(ve,p,"GeneratorFunction")),ve.prototype=Object.create(ie),ve},n.awrap=function(ve){return{__await:ve}},le(Se.prototype),y(Se.prototype,c,function(){return this}),n.AsyncIterator=Se,n.async=function(ve,Ie,dt,St,Rt){Rt===void 0&&(Rt=Promise);var $t=new Se(b(ve,Ie,dt,St),Rt);return n.isGeneratorFunction(Ie)?$t:$t.next().then(function(gt){return gt.done?gt.value:$t.next()})},le(ie),y(ie,p,"Generator"),y(ie,l,function(){return this}),y(ie,"toString",function(){return"[object Generator]"}),n.keys=function(ve){var Ie=[];for(var dt in ve)Ie.push(dt);return Ie.reverse(),function St(){for(;Ie.length;){var Rt=Ie.pop();if(Rt in ve)return St.value=Rt,St.done=!1,St}return St.done=!0,St}},n.values=Ce,ke.prototype={constructor:ke,reset:function(Ie){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Ke),!Ie)for(var dt in this)dt.charAt(0)==="t"&&a.call(this,dt)&&!isNaN(+dt.slice(1))&&(this[dt]=void 0)},stop:function(){this.done=!0;var Ie=this.tryEntries[0].completion;if(Ie.type==="throw")throw Ie.arg;return this.rval},dispatchException:function(Ie){if(this.done)throw Ie;var dt=this;function St(rn,dn){return gt.type="throw",gt.arg=Ie,dt.next=rn,dn&&(dt.method="next",dt.arg=void 0),!!dn}for(var Rt=this.tryEntries.length-1;Rt>=0;--Rt){var $t=this.tryEntries[Rt],gt=$t.completion;if($t.tryLoc==="root")return St("end");if($t.tryLoc<=this.prev){var jr=a.call($t,"catchLoc"),Er=a.call($t,"finallyLoc");if(jr&&Er){if(this.prev<$t.catchLoc)return St($t.catchLoc,!0);if(this.prev<$t.finallyLoc)return St($t.finallyLoc)}else if(jr){if(this.prev<$t.catchLoc)return St($t.catchLoc,!0)}else{if(!Er)throw new Error("try statement without catch or finally");if(this.prev<$t.finallyLoc)return St($t.finallyLoc)}}}},abrupt:function(Ie,dt){for(var St=this.tryEntries.length-1;St>=0;--St){var Rt=this.tryEntries[St];if(Rt.tryLoc<=this.prev&&a.call(Rt,"finallyLoc")&&this.prev<Rt.finallyLoc){var $t=Rt;break}}$t&&(Ie==="break"||Ie==="continue")&&$t.tryLoc<=dt&&dt<=$t.finallyLoc&&($t=null);var gt=$t?$t.completion:{};return gt.type=Ie,gt.arg=dt,$t?(this.method="next",this.next=$t.finallyLoc,M):this.complete(gt)},complete:function(Ie,dt){if(Ie.type==="throw")throw Ie.arg;return Ie.type==="break"||Ie.type==="continue"?this.next=Ie.arg:Ie.type==="return"?(this.rval=this.arg=Ie.arg,this.method="return",this.next="end"):Ie.type==="normal"&&dt&&(this.next=dt),M},finish:function(Ie){for(var dt=this.tryEntries.length-1;dt>=0;--dt){var St=this.tryEntries[dt];if(St.finallyLoc===Ie)return this.complete(St.completion,St.afterLoc),Ke(St),M}},catch:function(Ie){for(var dt=this.tryEntries.length-1;dt>=0;--dt){var St=this.tryEntries[dt];if(St.tryLoc===Ie){var Rt=St.completion;if(Rt.type==="throw"){var $t=Rt.arg;Ke(St)}return $t}}throw new Error("illegal catch attempt")},delegateYield:function(Ie,dt,St){return this.delegate={iterator:Ce(Ie),resultName:dt,nextLoc:St},this.method==="next"&&(this.arg=void 0),M}},n}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(NR);var Zx=NR.exports(),Xn=Zx;try{regeneratorRuntime=Zx}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Zx:Function("r","regeneratorRuntime = r")(Zx)}function OB(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}function PB(e){var r=FB();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function FB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var DB=function(e){On(t,e);var r=PB(t);function t(n,i,a,o){var l;return Kt(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=o,l}return Qt(t)}(EC(Error));function BB(e,r){var t=new yB;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var n in e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var i=t.response;if(e.type==="json")try{i=JSON.parse(t.response)}catch(o){return r(o)}r(null,i,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var a=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new DB(t.status,t.statusText,e.url,a))}},t.send(e.body),t}function NB(e,r){return BB(e,r)}var hw=function(r,t){return NB(tr(tr({},r),{},{type:"arrayBuffer"}),t)},yT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zB(e,r){var t=new Ho.Image,n=Ho.URL||Ho.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=yT})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):yT}function UB(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var CC=function(r,t){return hw(r,function(n,i){if(n)t(n);else if(i){var a=typeof createImageBitmap=="function";a?UB(i,t):zB(i,t)}})},VB=function(){var e=eo(Xn.mark(function r(t,n,i){var a,o,l,c,p,y;return Xn.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,i(t);case 3:a=w.sent,o=a.rasterData,l=a.width,c=a.height,p=0,y=8e3,n(null,{data:o,width:l,height:c,min:p,max:y}),w.next=15;break;case 12:w.prev=12,w.t0=w.catch(0),n(null,new Error(""+w.t0));case 15:case"end":return w.stop()}},r,null,[[0,12]])}));return function(t,n,i){return e.apply(this,arguments)}}(),GB=function(r,t,n){return hw(r,function(i,a){i?t(i):a&&VB(a,t,n)})};function tE(e){return typeof e=="number"}var _T=2*Math.PI*6378137/2;function jB(e){var r=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var n=t.coordinates;UR(r,n)}),r}function UR(e,r){return Array.isArray(r[0])?r.forEach(function(t){UR(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function rE(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=$B(e,r);var n=e[0],i=e[1],a=n*_T/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*_T/180,t.enable&&(a=Number(a.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function HB(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function WB(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function $B(e,r){if(r===!1)return e;var t=HB(e[0]),n=WB(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ic(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,o=t*i;o=Math.log(Math.tan(Math.PI/4+o/2));var l=.5/Math.PI,c=.5,p=-.5/Math.PI;return i=.5,a=n*(l*a+c),o=n*(p*o+i),[Math.floor(a),Math.floor(o)]}function XB(e,r,t){var n=gx(r[1]-e[1]),i=gx(r[0]-e[0]),a=gx(e[1]),o=gx(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return y8(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),"meters")}function Kb(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function VR(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function fb(e){return[[e[0],e[1]],[e[2],e[3]]]}function GR(e){var r=ZB(e,[0,0]);return[e[0]/r,e[1]/r]}function ZB(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function cd(e){if(tE(e[0]))return e;if(tE(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(tE(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(o){t+=o[0],n+=o[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function YB(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,o=0,l=0,c=0;c<e.length;c+=2){var p=e[c],y=e[c+1];p&&y&&(r=Math.max(p,r),t=Math.max(y,t),n=Math.min(p,n),i=Math.min(y,i),a+=p,o+=y,l++)}return{center:[a/l,o/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}var qB=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;Kt(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return Qt(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Qb(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}function pw(e,r,t){e.prototype=r.prototype=t,t.constructor=e}function jR(e,r){var t=Object.create(e.prototype);for(var n in r)t[n]=r[n];return t}function Z1(){}var C1=.7,hb=1/C1,Ny="\\s*([+-]?\\d+)\\s*",S1="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",KB=/^#([0-9a-f]{3,8})$/,QB=new RegExp("^rgb\\("+[Ny,Ny,Ny]+"\\)$"),JB=new RegExp("^rgb\\("+[Vv,Vv,Vv]+"\\)$"),eN=new RegExp("^rgba\\("+[Ny,Ny,Ny,S1]+"\\)$"),tN=new RegExp("^rgba\\("+[Vv,Vv,Vv,S1]+"\\)$"),rN=new RegExp("^hsl\\("+[S1,Vv,Vv]+"\\)$"),nN=new RegExp("^hsla\\("+[S1,Vv,Vv,S1]+"\\)$"),xT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};pw(Z1,xm,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:bT,formatHex:bT,formatHsl:iN,formatRgb:ET,toString:ET});function bT(){return this.rgb().formatHex()}function iN(){return HR(this).formatHsl()}function ET(){return this.rgb().formatRgb()}function xm(e){var r,t;return e=(e+"").trim().toLowerCase(),(r=KB.exec(e))?(t=r[1].length,r=parseInt(r[1],16),t===6?CT(r):t===3?new Op(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):t===8?_x(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):t===4?_x(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=QB.exec(e))?new Op(r[1],r[2],r[3],1):(r=JB.exec(e))?new Op(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=eN.exec(e))?_x(r[1],r[2],r[3],r[4]):(r=tN.exec(e))?_x(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=rN.exec(e))?AT(r[1],r[2]/100,r[3]/100,1):(r=nN.exec(e))?AT(r[1],r[2]/100,r[3]/100,r[4]):xT.hasOwnProperty(e)?CT(xT[e]):e==="transparent"?new Op(NaN,NaN,NaN,0):null}function CT(e){return new Op(e>>16&255,e>>8&255,e&255,1)}function _x(e,r,t,n){return n<=0&&(e=r=t=NaN),new Op(e,r,t,n)}function aN(e){return e instanceof Z1||(e=xm(e)),e?(e=e.rgb(),new Op(e.r,e.g,e.b,e.opacity)):new Op}function pb(e,r,t,n){return arguments.length===1?aN(e):new Op(e,r,t,n==null?1:n)}function Op(e,r,t,n){this.r=+e,this.g=+r,this.b=+t,this.opacity=+n}pw(Op,pb,jR(Z1,{brighter:function(e){return e=e==null?hb:Math.pow(hb,e),new Op(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?C1:Math.pow(C1,e),new Op(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ST,formatHex:ST,formatRgb:wT,toString:wT}));function ST(){return"#"+nE(this.r)+nE(this.g)+nE(this.b)}function wT(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function nE(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function AT(e,r,t,n){return n<=0?e=r=t=NaN:t<=0||t>=1?e=r=NaN:r<=0&&(e=NaN),new Pv(e,r,t,n)}function HR(e){if(e instanceof Pv)return new Pv(e.h,e.s,e.l,e.opacity);if(e instanceof Z1||(e=xm(e)),!e)return new Pv;if(e instanceof Pv)return e;e=e.rgb();var r=e.r/255,t=e.g/255,n=e.b/255,i=Math.min(r,t,n),a=Math.max(r,t,n),o=NaN,l=a-i,c=(a+i)/2;return l?(r===a?o=(t-n)/l+(t<n)*6:t===a?o=(n-r)/l+2:o=(r-t)/l+4,l/=c<.5?a+i:2-a-i,o*=60):l=c>0&&c<1?0:o,new Pv(o,l,c,e.opacity)}function oN(e,r,t,n){return arguments.length===1?HR(e):new Pv(e,r,t,n==null?1:n)}function Pv(e,r,t,n){this.h=+e,this.s=+r,this.l=+t,this.opacity=+n}pw(Pv,oN,jR(Z1,{brighter:function(e){return e=e==null?hb:Math.pow(hb,e),new Pv(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?C1:Math.pow(C1,e),new Pv(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,t=this.l,n=t+(t<.5?t:1-t)*r,i=2*t-n;return new Op(iE(e>=240?e-240:e+120,i,n),iE(e,i,n),iE(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function iE(e,r,t){return(e<60?r+(t-r)*e/60:e<180?t:e<240?r+(t-r)*(240-e)/60:r)*255}function WR(e){return typeof e=="string"?!!xm(e):!1}function Lo(e){var r=xm(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function Nv(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function bm(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Rg(e){var r=Ho.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=null;if(e.weights){var i=0;e.weights.map(function(w,M){var O=e.colors[M]||"rgba(0, 0, 0, 0)",N=i+w;t.fillStyle=O,t.fillRect(i*256,0,N*256,1),i=N})}else{for(var a=t.createLinearGradient(0,0,256,1),o=e.positions[0],l=e.positions[e.positions.length-1],c=0;c<e.colors.length;++c){var p=(e.positions[c]-o)/(l-o);a.addColorStop(p,e.colors[c])}t.fillStyle=a,t.fillRect(0,0,256,1)}if(Zh)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var y=t.createImageData(256,1),b=0;b<y.data.length;b+=4)y.data[b+0]=n[b+0],y.data[b+1]=n[b+1],y.data[b+2]=n[b+2],y.data[b+3]=n[b+3];return r=null,t=null,y}var db;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(db||(db={}));var SC={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sN(e,r,t){var n=e.classList;for(var i in SC)SC.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}function bs(e,r){return{enable:e,mask:255,func:{cmp:514,ref:r?1:0,mask:255}}}function w1(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var uN=typeof window<"u"&&typeof window.orientation<"u",lN=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){w1(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){w1(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),aE=new Map;function cN(e){w1(e.source&&!e.url||!e.source&&e.url);var r=aE.get(e.source||e.url);return r||(e.url&&(r=fN(e.url),aE.set(e.url,r)),e.source&&(r=$R(e.source),aE.set(e.source,r))),w1(r),r}function fN(e){if(!e.startsWith("http"))return e;var r=hN(e);return $R(r)}function $R(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function hN(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function dw(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(TT(e))n.add(e);else if(TT(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)dw(e[i],r,n)}}return t===void 0?Array.from(n):[]}function TT(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var oE=function(){},XR=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;w1(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=oE,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker<"u"},e.prototype.destroy=function(){this.onMessage=oE,this.onError=oE,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||dw(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=cN({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),vb=globalThis&&globalThis.__assign||function(){return vb=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},vb.apply(this,arguments)},MT=globalThis&&globalThis.__awaiter||function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(y){try{p(n.next(y))}catch(b){o(b)}}function c(y){try{p(n.throw(y))}catch(b){o(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},IT=globalThis&&globalThis.__generator||function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},pN=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=vb(vb({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,a,o){return i.done(o)}),n===void 0&&(n=function(i,a){return i.error(a)}),MT(this,void 0,void 0,function(){var i,a=this;return IT(this,function(o){switch(o.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,o.sent()]}})})},e.prototype.startQueuedJob=function(){return MT(this,void 0,void 0,function(){var r,t,n;return IT(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new lN(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new XR({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return uN?this.maxMobileConcurrency:this.maxConcurrency},e}(),o1=globalThis&&globalThis.__assign||function(){return o1=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},o1.apply(this,arguments)},LT=globalThis&&globalThis.__values||function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},dN={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},vN=function(){function e(r){this.workerPools=new Map,this.props=o1({},dN),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return XR.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=LT(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(o){r={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=o1(o1({},this.props),r);try{for(var i=LT(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var o=a.value;o.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new pN({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),sE=new Map,_0=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(!!kT(t)){var n=t.data,i=n.type,a=n.payload;r(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=sE.get(r);t||(t=function(n){if(!!kT(n)){var i=n.data,a=i.type,o=i.payload;r(a,o)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=sE.get(r);sE.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=dw(t);self.postMessage(n,i)}},e}();function kT(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var mN=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),gN=globalThis&&globalThis.__awaiter||function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(y){try{p(n.next(y))}catch(b){o(b)}}function c(y){try{p(n.throw(y))}catch(b){o(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},yN=globalThis&&globalThis.__generator||function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},_N=globalThis&&globalThis.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(o){return new Promise(function(l,c){o=e[a](o),i(l,c,o.done,o.value)})}}function i(a,o,l,c){Promise.resolve(c).then(function(p){a({value:p,done:l})},o)}},xN=0,xx,RT;function bN(e,r){var t=this;if(!(typeof self>"u")){var n={process:EN};_0.onmessage=function(i,a){return gN(t,void 0,void 0,function(){var o,l,c,p,y,b,w,M,O,N,z;return yN(this,function(j){switch(j.label){case 0:switch(j.trys.push([0,19,,20]),o=i,o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=j.sent(),_0.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");xx=new mN,RT=a.options||{},c=r(xx,RT,n),j.label=4;case 4:j.trys.push([4,9,10,15]),p=_N(c),j.label=5;case 5:return[4,p.next()];case 6:if(y=j.sent(),!!y.done)return[3,8];b=y.value,_0.postMessage("output-batch",{result:b}),j.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return w=j.sent(),N={error:w},[3,15];case 10:return j.trys.push([10,,13,14]),y&&!y.done&&(z=p.return)?[4,z.call(p)]:[3,12];case 11:j.sent(),j.label=12;case 12:return[3,14];case 13:if(N)throw N.error;return[7];case 14:return[7];case 15:return _0.postMessage("done",{}),[3,18];case 16:return xx.push(a.input),[3,18];case 17:return xx.close(),[3,18];case 18:return[3,20];case 19:return M=j.sent(),O=M instanceof Error?M.message:"",_0.postMessage("error",{error:O}),[3,20];case 20:return[2]}})})}}}function EN(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=xN++,a=function(l,c){if(c.id===i)switch(l){case"done":_0.removeEventListener(a),t(c.result);break;case"error":_0.removeEventListener(a),n(c.error);break}};_0.addEventListener(a);var o={id:i,input:e,options:r};_0.postMessage("process",o)})}globalThis&&globalThis.__awaiter;globalThis&&globalThis.__generator;var CN={};(function(e){function r(C,L){var P=Object.keys(C);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(C);L&&(f=f.filter(function(m){return Object.getOwnPropertyDescriptor(C,m).enumerable})),P.push.apply(P,f)}return P}function t(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return C};var C={},L=Object.prototype,P=L.hasOwnProperty,f=typeof Symbol=="function"?Symbol:{},m=f.iterator||"@@iterator",S=f.asyncIterator||"@@asyncIterator",k=f.toStringTag||"@@toStringTag";function B(or,yr,ri){return Object.defineProperty(or,yr,{value:ri,enumerable:!0,configurable:!0,writable:!0}),or[yr]}try{B({},"")}catch{B=function(yr,ri,Ca){return yr[ri]=Ca}}function G(or,yr,ri,Ca){var Wi=yr&&yr.prototype instanceof _e?yr:_e,ac=Object.create(Wi.prototype),wc=new Ai(Ca||[]);return ac._invoke=function(os,Ac,xs){var zd="suspendedStart";return function(f0,Bl){if(zd==="executing")throw new Error("Generator is already running");if(zd==="completed"){if(f0==="throw")throw Bl;return hi()}for(xs.method=f0,xs.arg=Bl;;){var ss=xs.delegate;if(ss){var rf=Ur(ss,xs);if(rf){if(rf===ee)continue;return rf}}if(xs.method==="next")xs.sent=xs._sent=xs.arg;else if(xs.method==="throw"){if(zd==="suspendedStart")throw zd="completed",xs.arg;xs.dispatchException(xs.arg)}else xs.method==="return"&&xs.abrupt("return",xs.arg);zd="executing";var dl=Z(os,Ac,xs);if(dl.type==="normal"){if(zd=xs.done?"completed":"suspendedYield",dl.arg===ee)continue;return{value:dl.arg,done:xs.done}}dl.type==="throw"&&(zd="completed",xs.method="throw",xs.arg=dl.arg)}}}(or,ri,wc),ac}function Z(or,yr,ri){try{return{type:"normal",arg:or.call(yr,ri)}}catch(Ca){return{type:"throw",arg:Ca}}}C.wrap=G;var ee={};function _e(){}function Ge(){}function Xe(){}var it={};B(it,m,function(){return this});var bt=Object.getPrototypeOf,kt=bt&&bt(bt(Oi([])));kt&&kt!==L&&P.call(kt,m)&&(it=kt);var Xt=Xe.prototype=_e.prototype=Object.create(it);function Ht(or){["next","throw","return"].forEach(function(yr){B(or,yr,function(ri){return this._invoke(yr,ri)})})}function ir(or,yr){var ri;this._invoke=function(Ca,Wi){function ac(){return new yr(function(wc,os){(function Ac(xs,zd,f0,Bl){var ss=Z(or[xs],or,zd);if(ss.type!=="throw"){var rf=ss.arg,dl=rf.value;return dl&&typeof dl=="object"&&P.call(dl,"__await")?yr.resolve(dl.__await).then(function(nf){Ac("next",nf,f0,Bl)},function(nf){Ac("throw",nf,f0,Bl)}):yr.resolve(dl).then(function(nf){rf.value=nf,f0(rf)},function(nf){return Ac("throw",nf,f0,Bl)})}Bl(ss.arg)})(Ca,Wi,wc,os)})}return ri=ri?ri.then(ac,ac):ac()}}function Ur(or,yr){var ri=or.iterator[yr.method];if(ri===void 0){if(yr.delegate=null,yr.method==="throw"){if(or.iterator.return&&(yr.method="return",yr.arg=void 0,Ur(or,yr),yr.method==="throw"))return ee;yr.method="throw",yr.arg=new TypeError("The iterator does not provide a 'throw' method")}return ee}var Ca=Z(ri,or.iterator,yr.arg);if(Ca.type==="throw")return yr.method="throw",yr.arg=Ca.arg,yr.delegate=null,ee;var Wi=Ca.arg;return Wi?Wi.done?(yr[or.resultName]=Wi.value,yr.next=or.nextLoc,yr.method!=="return"&&(yr.method="next",yr.arg=void 0),yr.delegate=null,ee):Wi:(yr.method="throw",yr.arg=new TypeError("iterator result is not an object"),yr.delegate=null,ee)}function qn(or){var yr={tryLoc:or[0]};1 in or&&(yr.catchLoc=or[1]),2 in or&&(yr.finallyLoc=or[2],yr.afterLoc=or[3]),this.tryEntries.push(yr)}function Ri(or){var yr=or.completion||{};yr.type="normal",delete yr.arg,or.completion=yr}function Ai(or){this.tryEntries=[{tryLoc:"root"}],or.forEach(qn,this),this.reset(!0)}function Oi(or){if(or){var yr=or[m];if(yr)return yr.call(or);if(typeof or.next=="function")return or;if(!isNaN(or.length)){var ri=-1,Ca=function Wi(){for(;++ri<or.length;)if(P.call(or,ri))return Wi.value=or[ri],Wi.done=!1,Wi;return Wi.value=void 0,Wi.done=!0,Wi};return Ca.next=Ca}}return{next:hi}}function hi(){return{value:void 0,done:!0}}return Ge.prototype=Xe,B(Xt,"constructor",Xe),B(Xe,"constructor",Ge),Ge.displayName=B(Xe,k,"GeneratorFunction"),C.isGeneratorFunction=function(or){var yr=typeof or=="function"&&or.constructor;return!!yr&&(yr===Ge||(yr.displayName||yr.name)==="GeneratorFunction")},C.mark=function(or){return Object.setPrototypeOf?Object.setPrototypeOf(or,Xe):(or.__proto__=Xe,B(or,k,"GeneratorFunction")),or.prototype=Object.create(Xt),or},C.awrap=function(or){return{__await:or}},Ht(ir.prototype),B(ir.prototype,S,function(){return this}),C.AsyncIterator=ir,C.async=function(or,yr,ri,Ca,Wi){Wi===void 0&&(Wi=Promise);var ac=new ir(G(or,yr,ri,Ca),Wi);return C.isGeneratorFunction(yr)?ac:ac.next().then(function(wc){return wc.done?wc.value:ac.next()})},Ht(Xt),B(Xt,k,"Generator"),B(Xt,m,function(){return this}),B(Xt,"toString",function(){return"[object Generator]"}),C.keys=function(or){var yr=[];for(var ri in or)yr.push(ri);return yr.reverse(),function Ca(){for(;yr.length;){var Wi=yr.pop();if(Wi in or)return Ca.value=Wi,Ca.done=!1,Ca}return Ca.done=!0,Ca}},C.values=Oi,Ai.prototype={constructor:Ai,reset:function(or){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Ri),!or)for(var yr in this)yr.charAt(0)==="t"&&P.call(this,yr)&&!isNaN(+yr.slice(1))&&(this[yr]=void 0)},stop:function(){this.done=!0;var or=this.tryEntries[0].completion;if(or.type==="throw")throw or.arg;return this.rval},dispatchException:function(or){if(this.done)throw or;var yr=this;function ri(Ac,xs){return ac.type="throw",ac.arg=or,yr.next=Ac,xs&&(yr.method="next",yr.arg=void 0),!!xs}for(var Ca=this.tryEntries.length-1;Ca>=0;--Ca){var Wi=this.tryEntries[Ca],ac=Wi.completion;if(Wi.tryLoc==="root")return ri("end");if(Wi.tryLoc<=this.prev){var wc=P.call(Wi,"catchLoc"),os=P.call(Wi,"finallyLoc");if(wc&&os){if(this.prev<Wi.catchLoc)return ri(Wi.catchLoc,!0);if(this.prev<Wi.finallyLoc)return ri(Wi.finallyLoc)}else if(wc){if(this.prev<Wi.catchLoc)return ri(Wi.catchLoc,!0)}else{if(!os)throw new Error("try statement without catch or finally");if(this.prev<Wi.finallyLoc)return ri(Wi.finallyLoc)}}}},abrupt:function(or,yr){for(var ri=this.tryEntries.length-1;ri>=0;--ri){var Ca=this.tryEntries[ri];if(Ca.tryLoc<=this.prev&&P.call(Ca,"finallyLoc")&&this.prev<Ca.finallyLoc){var Wi=Ca;break}}Wi&&(or==="break"||or==="continue")&&Wi.tryLoc<=yr&&yr<=Wi.finallyLoc&&(Wi=null);var ac=Wi?Wi.completion:{};return ac.type=or,ac.arg=yr,Wi?(this.method="next",this.next=Wi.finallyLoc,ee):this.complete(ac)},complete:function(or,yr){if(or.type==="throw")throw or.arg;return or.type==="break"||or.type==="continue"?this.next=or.arg:or.type==="return"?(this.rval=this.arg=or.arg,this.method="return",this.next="end"):or.type==="normal"&&yr&&(this.next=yr),ee},finish:function(or){for(var yr=this.tryEntries.length-1;yr>=0;--yr){var ri=this.tryEntries[yr];if(ri.finallyLoc===or)return this.complete(ri.completion,ri.afterLoc),Ri(ri),ee}},catch:function(or){for(var yr=this.tryEntries.length-1;yr>=0;--yr){var ri=this.tryEntries[yr];if(ri.tryLoc===or){var Ca=ri.completion;if(Ca.type==="throw"){var Wi=Ca.arg;Ri(ri)}return Wi}}throw new Error("illegal catch attempt")},delegateYield:function(or,yr,ri){return this.delegate={iterator:Oi(or),resultName:yr,nextLoc:ri},this.method==="next"&&(this.arg=void 0),ee}},C}function n(C,L,P,f,m,S,k){try{var B=C[S](k),G=B.value}catch(Z){return void P(Z)}B.done?L(G):Promise.resolve(G).then(f,m)}function i(C){return function(){var L=this,P=arguments;return new Promise(function(f,m){var S=C.apply(L,P);function k(G){n(S,f,m,k,B,"next",G)}function B(G){n(S,f,m,k,B,"throw",G)}k(void 0)})}}function a(C,L){if(!(C instanceof L))throw new TypeError("Cannot call a class as a function")}function o(C,L){for(var P=0;P<L.length;P++){var f=L[P];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(C,f.key,f)}}function l(C,L,P){return L&&o(C.prototype,L),P&&o(C,P),Object.defineProperty(C,"prototype",{writable:!1}),C}function c(C,L,P){return L in C?Object.defineProperty(C,L,{value:P,enumerable:!0,configurable:!0,writable:!0}):C[L]=P,C}function p(C,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(L&&L.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),L&&b(C,L)}function y(C){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(L){return L.__proto__||Object.getPrototypeOf(L)})(C)}function b(C,L){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(P,f){return P.__proto__=f,P})(C,L)}function w(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function M(C,L){if(L&&(typeof L=="object"||typeof L=="function"))return L;if(L!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(C)}function O(C){var L=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var P,f=y(C);if(L){var m=y(this).constructor;P=Reflect.construct(f,arguments,m)}else P=f.apply(this,arguments);return M(this,P)}}function N(C,L){return function(P){if(Array.isArray(P))return P}(C)||function(P,f){var m=P==null?null:typeof Symbol<"u"&&P[Symbol.iterator]||P["@@iterator"];if(m!=null){var S,k,B=[],G=!0,Z=!1;try{for(m=m.call(P);!(G=(S=m.next()).done)&&(B.push(S.value),!f||B.length!==f);G=!0);}catch(ee){Z=!0,k=ee}finally{try{G||m.return==null||m.return()}finally{if(Z)throw k}}return B}}(C,L)||j(C,L)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function z(C){return function(L){if(Array.isArray(L))return Y(L)}(C)||function(L){if(typeof Symbol<"u"&&L[Symbol.iterator]!=null||L["@@iterator"]!=null)return Array.from(L)}(C)||j(C)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function j(C,L){if(C){if(typeof C=="string")return Y(C,L);var P=Object.prototype.toString.call(C).slice(8,-1);return P==="Object"&&C.constructor&&(P=C.constructor.name),P==="Map"||P==="Set"?Array.from(C):P==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(P)?Y(C,L):void 0}}function Y(C,L){(L==null||L>C.length)&&(L=C.length);for(var P=0,f=new Array(L);P<L;P++)f[P]=C[P];return f}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Lp<"u"?Lp:typeof self<"u"?self:{};function ie(C,L){return C(L={exports:{}},L.exports),L.exports}var le,Se,ze=function(C){return C&&C.Math==Math&&C},ue=ze(typeof globalThis=="object"&&globalThis)||ze(typeof window=="object"&&window)||ze(typeof self=="object"&&self)||ze(typeof K=="object"&&K)||function(){return this}()||Function("return this")(),Ke=Object.defineProperty,ke=function(C,L){try{Ke(ue,C,{value:L,configurable:!0,writable:!0})}catch{ue[C]=L}return L},Ce=ue["__core-js_shared__"]||ke("__core-js_shared__",{}),je=ie(function(C){(C.exports=function(L,P){return Ce[L]||(Ce[L]=P!==void 0?P:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),ve=function(C){try{return!!C()}catch{return!0}},Ie=!ve(function(){var C=function(){}.bind();return typeof C!="function"||C.hasOwnProperty("prototype")}),dt=Function.prototype,St=dt.bind,Rt=dt.call,$t=Ie&&St.bind(Rt,Rt),gt=Ie?function(C){return C&&$t(C)}:function(C){return C&&function(){return Rt.apply(C,arguments)}},jr=TypeError,Er=function(C){if(C==null)throw jr("Can't call method on "+C);return C},rn=Object,dn=function(C){return rn(Er(C))},Rn=gt({}.hasOwnProperty),Ar=Object.hasOwn||function(C,L){return Rn(dn(C),L)},xa=0,Ti=Math.random(),Sa=gt(1 .toString),hr=function(C){return"Symbol("+(C===void 0?"":C)+")_"+Sa(++xa+Ti,36)},Dr=function(C){return typeof C=="function"},Kn=function(C){return Dr(C)?C:void 0},Wt=function(C,L){return arguments.length<2?Kn(ue[C]):ue[C]&&ue[C][L]},Me=Wt("navigator","userAgent")||"",Qe=ue.process,Ct=ue.Deno,Yt=Qe&&Qe.versions||Ct&&Ct.version,qt=Yt&&Yt.v8;qt&&(Se=(le=qt.split("."))[0]>0&&le[0]<4?1:+(le[0]+le[1])),!Se&&Me&&(!(le=Me.match(/Edge\/(\d+)/))||le[1]>=74)&&(le=Me.match(/Chrome\/(\d+)/))&&(Se=+le[1]);var _r=Se,Pr=!!Object.getOwnPropertySymbols&&!ve(function(){var C=Symbol();return!String(C)||!(Object(C)instanceof Symbol)||!Symbol.sham&&_r&&_r<41}),xr=Pr&&!Symbol.sham&&typeof Symbol.iterator=="symbol",kr=je("wks"),vr=ue.Symbol,In=vr&&vr.for,W=xr?vr:vr&&vr.withoutSetter||hr,st=function(C){if(!Ar(kr,C)||!Pr&&typeof kr[C]!="string"){var L="Symbol."+C;Pr&&Ar(vr,C)?kr[C]=vr[C]:kr[C]=xr&&In?In(L):W(L)}return kr[C]},zt={};zt[st("toStringTag")]="z";var mr=String(zt)==="[object z]",fr=!ve(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),nn=function(C){return typeof C=="object"?C!==null:Dr(C)},Mn=ue.document,Wn=nn(Mn)&&nn(Mn.createElement),Bn=function(C){return Wn?Mn.createElement(C):{}},Mi=!fr&&!ve(function(){return Object.defineProperty(Bn("div"),"a",{get:function(){return 7}}).a!=7}),mi=fr&&ve(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),mo=String,ca=TypeError,Ki=function(C){if(nn(C))return C;throw ca(mo(C)+" is not an object")},yl=Function.prototype.call,Xi=Ie?yl.bind(yl):function(){return yl.apply(yl,arguments)},nu=gt({}.isPrototypeOf),mu=Object,iu=xr?function(C){return typeof C=="symbol"}:function(C){var L=Wt("Symbol");return Dr(L)&&nu(L.prototype,mu(C))},pf=String,Fu=function(C){try{return pf(C)}catch{return"Object"}},uo=TypeError,J=function(C){if(Dr(C))return C;throw uo(Fu(C)+" is not a function")},ae=function(C,L){var P=C[L];return P==null?void 0:J(P)},ce=TypeError,be=TypeError,Be=st("toPrimitive"),et=function(C,L){if(!nn(C)||iu(C))return C;var P,f=ae(C,Be);if(f){if(L===void 0&&(L="default"),P=Xi(f,C,L),!nn(P)||iu(P))return P;throw be("Can't convert object to primitive value")}return L===void 0&&(L="number"),function(m,S){var k,B;if(S==="string"&&Dr(k=m.toString)&&!nn(B=Xi(k,m))||Dr(k=m.valueOf)&&!nn(B=Xi(k,m))||S!=="string"&&Dr(k=m.toString)&&!nn(B=Xi(k,m)))return B;throw ce("Can't convert object to primitive value")}(C,L)},ot=function(C){var L=et(C,"string");return iu(L)?L:L+""},ge=TypeError,Ve=Object.defineProperty,mt=Object.getOwnPropertyDescriptor,Jt={f:fr?mi?function(C,L,P){if(Ki(C),L=ot(L),Ki(P),typeof C=="function"&&L==="prototype"&&"value"in P&&"writable"in P&&!P.writable){var f=mt(C,L);f&&f.writable&&(C[L]=P.value,P={configurable:"configurable"in P?P.configurable:f.configurable,enumerable:"enumerable"in P?P.enumerable:f.enumerable,writable:!1})}return Ve(C,L,P)}:Ve:function(C,L,P){if(Ki(C),L=ot(L),Ki(P),Mi)try{return Ve(C,L,P)}catch{}if("get"in P||"set"in P)throw ge("Accessors not supported");return"value"in P&&(C[L]=P.value),C}},Cr=Function.prototype,Dt=fr&&Object.getOwnPropertyDescriptor,pr=Ar(Cr,"name"),Nr={EXISTS:pr,PROPER:pr&&function(){}.name==="something",CONFIGURABLE:pr&&(!fr||fr&&Dt(Cr,"name").configurable)},xn=gt(Function.toString);Dr(Ce.inspectSource)||(Ce.inspectSource=function(C){return xn(C)});var Bt,ln,Wr,Zr=Ce.inspectSource,gi=ue.WeakMap,Jr=Dr(gi)&&/native code/.test(Zr(gi)),bi=function(C,L){return{enumerable:!(1&C),configurable:!(2&C),writable:!(4&C),value:L}},ci=fr?function(C,L,P){return Jt.f(C,L,bi(1,P))}:function(C,L,P){return C[L]=P,C},Ci=je("keys"),Fi=function(C){return Ci[C]||(Ci[C]=hr(C))},Di={},ls=ue.TypeError,sa=ue.WeakMap;if(Jr||Ce.state){var Zi=Ce.state||(Ce.state=new sa),ia=gt(Zi.get),pi=gt(Zi.has),Li=gt(Zi.set);Bt=function(C,L){if(pi(Zi,C))throw new ls("Object already initialized");return L.facade=C,Li(Zi,C,L),L},ln=function(C){return ia(Zi,C)||{}},Wr=function(C){return pi(Zi,C)}}else{var go=Fi("state");Di[go]=!0,Bt=function(C,L){if(Ar(C,go))throw new ls("Object already initialized");return L.facade=C,ci(C,go,L),L},ln=function(C){return Ar(C,go)?C[go]:{}},Wr=function(C){return Ar(C,go)}}var pa={set:Bt,get:ln,has:Wr,enforce:function(C){return Wr(C)?ln(C):Bt(C,{})},getterFor:function(C){return function(L){var P;if(!nn(L)||(P=ln(L)).type!==C)throw ls("Incompatible receiver, "+C+" required");return P}}},Za=ie(function(C){var L=Nr.CONFIGURABLE,P=pa.enforce,f=pa.get,m=Object.defineProperty,S=fr&&!ve(function(){return m(function(){},"length",{value:8}).length!==8}),k=String(String).split("String"),B=C.exports=function(G,Z,ee){String(Z).slice(0,7)==="Symbol("&&(Z="["+String(Z).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),ee&&ee.getter&&(Z="get "+Z),ee&&ee.setter&&(Z="set "+Z),(!Ar(G,"name")||L&&G.name!==Z)&&(fr?m(G,"name",{value:Z,configurable:!0}):G.name=Z),S&&ee&&Ar(ee,"arity")&&G.length!==ee.arity&&m(G,"length",{value:ee.arity});try{ee&&Ar(ee,"constructor")&&ee.constructor?fr&&m(G,"prototype",{writable:!1}):G.prototype&&(G.prototype=void 0)}catch{}var _e=P(G);return Ar(_e,"source")||(_e.source=k.join(typeof Z=="string"?Z:"")),G};Function.prototype.toString=B(function(){return Dr(this)&&f(this).source||Zr(this)},"toString")}),da=function(C,L,P,f){f||(f={});var m=f.enumerable,S=f.name!==void 0?f.name:L;if(Dr(P)&&Za(P,S,f),f.global)m?C[L]=P:ke(L,P);else{try{f.unsafe?C[L]&&(m=!0):delete C[L]}catch{}m?C[L]=P:Jt.f(C,L,{value:P,enumerable:!1,configurable:!f.nonConfigurable,writable:!f.nonWritable})}return C},Xf=gt({}.toString),Hl=gt("".slice),ki=function(C){return Hl(Xf(C),8,-1)},oc=st("toStringTag"),ns=Object,Ya=ki(function(){return arguments}())=="Arguments",yo=mr?ki:function(C){var L,P,f;return C===void 0?"Undefined":C===null?"Null":typeof(P=function(m,S){try{return m[S]}catch{}}(L=ns(C),oc))=="string"?P:Ya?ki(L):(f=ki(L))=="Object"&&Dr(L.callee)?"Arguments":f},Da=mr?{}.toString:function(){return"[object "+yo(this)+"]"};mr||da(Object.prototype,"toString",Da,{unsafe:!0});var ks={}.propertyIsEnumerable,qa=Object.getOwnPropertyDescriptor,Rc={f:qa&&!ks.call({1:2},1)?function(C){var L=qa(this,C);return!!L&&L.enumerable}:ks},Rs=Object,df=gt("".split),Os=ve(function(){return!Rs("z").propertyIsEnumerable(0)})?function(C){return ki(C)=="String"?df(C,""):Rs(C)}:Rs,Ha=function(C){return Os(Er(C))},Ps=Object.getOwnPropertyDescriptor,se={f:fr?Ps:function(C,L){if(C=Ha(C),L=ot(L),Mi)try{return Ps(C,L)}catch{}if(Ar(C,L))return bi(!Xi(Rc.f,C,L),C[L])}},we=Math.ceil,Je=Math.floor,Nt=Math.trunc||function(C){var L=+C;return(L>0?Je:we)(L)},Tr=function(C){var L=+C;return L!=L||L===0?0:Nt(L)},Un=Math.max,Qi=Math.min,Ma=function(C,L){var P=Tr(C);return P<0?Un(P+L,0):Qi(P,L)},cs=Math.min,ko=function(C){return C>0?cs(Tr(C),9007199254740991):0},Ia=function(C){return ko(C.length)},Fp=function(C){return function(L,P,f){var m,S=Ha(L),k=Ia(S),B=Ma(f,k);if(C&&P!=P){for(;k>B;)if((m=S[B++])!=m)return!0}else for(;k>B;B++)if((C||B in S)&&S[B]===P)return C||B||0;return!C&&-1}},Zf={includes:Fp(!0),indexOf:Fp(!1)},qd=Zf.indexOf,Kh=gt([].push),gu=function(C,L){var P,f=Ha(C),m=0,S=[];for(P in f)!Ar(Di,P)&&Ar(f,P)&&Kh(S,P);for(;L.length>m;)Ar(f,P=L[m++])&&(~qd(S,P)||Kh(S,P));return S},Wl=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],vf=Wl.concat("length","prototype"),Ku={f:Object.getOwnPropertyNames||function(C){return gu(C,vf)}},yu={f:Object.getOwnPropertySymbols},mf=gt([].concat),to=Wt("Reflect","ownKeys")||function(C){var L=Ku.f(Ki(C)),P=yu.f;return P?mf(L,P(C)):L},Ji=function(C,L,P){for(var f=to(L),m=Jt.f,S=se.f,k=0;k<f.length;k++){var B=f[k];Ar(C,B)||P&&Ar(P,B)||m(C,B,S(L,B))}},Ro=/#|\.prototype\./,$l=function(C,L){var P=Wv[dd(C)];return P==Qh||P!=vd&&(Dr(L)?ve(L):!!L)},dd=$l.normalize=function(C){return String(C).replace(Ro,".").toLowerCase()},Wv=$l.data={},vd=$l.NATIVE="N",Qh=$l.POLYFILL="P",_u=$l,Ch=se.f,Yi=function(C,L){var P,f,m,S,k,B=C.target,G=C.global,Z=C.stat;if(P=G?ue:Z?ue[B]||ke(B,{}):(ue[B]||{}).prototype)for(f in L){if(S=L[f],m=C.dontCallGetSet?(k=Ch(P,f))&&k.value:P[f],!_u(G?f:B+(Z?".":"#")+f,C.forced)&&m!==void 0){if(typeof S==typeof m)continue;Ji(S,m)}(C.sham||m&&m.sham)&&ci(S,"sham",!0),da(P,f,S,C)}},Qu=ki(ue.process)=="process",gf=String,Kd=TypeError,Oo=Object.setPrototypeOf||("__proto__"in{}?function(){var C,L=!1,P={};try{(C=gt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(P,[]),L=P instanceof Array}catch{}return function(f,m){return Ki(f),function(S){if(typeof S=="object"||Dr(S))return S;throw Kd("Can't set "+gf(S)+" as a prototype")}(m),L?C(f,m):f.__proto__=m,f}}():void 0),au=Jt.f,Dp=st("toStringTag"),Po=function(C,L,P){C&&!P&&(C=C.prototype),C&&!Ar(C,Dp)&&au(C,Dp,{configurable:!0,value:L})},Jh=st("species"),Fs=function(C){var L=Wt(C),P=Jt.f;fr&&L&&!L[Jh]&&P(L,Jh,{configurable:!0,get:function(){return this}})},Oc=TypeError,Xs=function(C,L){if(nu(L,C))return C;throw Oc("Incorrect invocation")},Fo=function(){},yf=[],Do=Wt("Reflect","construct"),sc=/^\s*(?:class|function)\b/,Du=gt(sc.exec),uc=!sc.exec(Fo),xu=function(C){if(!Dr(C))return!1;try{return Do(Fo,yf,C),!0}catch{return!1}},va=function(C){if(!Dr(C))return!1;switch(yo(C)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return uc||!!Du(sc,Zr(C))}catch{return!0}};va.sham=!0;var ro,ou,ep,tp,Sh=!Do||ve(function(){var C;return xu(xu.call)||!xu(Object)||!xu(function(){C=!0})||C})?va:xu,Qd=TypeError,Pc=function(C){if(Sh(C))return C;throw Qd(Fu(C)+" is not a constructor")},Wa=st("species"),lc=function(C,L){var P,f=Ki(C).constructor;return f===void 0||(P=Ki(f)[Wa])==null?L:Pc(P)},wh=Function.prototype,Zs=wh.apply,Ah=wh.call,bu=typeof Reflect=="object"&&Reflect.apply||(Ie?Ah.bind(Zs):function(){return Ah.apply(Zs,arguments)}),Fc=gt(gt.bind),Ys=function(C,L){return J(C),L===void 0?C:Ie?Fc(C,L):function(){return C.apply(L,arguments)}},Bu=Wt("document","documentElement"),Xl=gt([].slice),_f=TypeError,ka=function(C,L){if(C<L)throw _f("Not enough arguments");return C},Dc=/(?:ipad|iphone|ipod).*applewebkit/i.test(Me),Bp=ue.setImmediate,Bc=ue.clearImmediate,Nu=ue.process,rp=ue.Dispatch,Th=ue.Function,xf=ue.MessageChannel,cc=ue.String,Nc=0,fc={};try{ro=ue.location}catch{}var _l=function(C){if(Ar(fc,C)){var L=fc[C];delete fc[C],L()}},hc=function(C){return function(){_l(C)}},np=function(C){_l(C.data)},zu=function(C){ue.postMessage(cc(C),ro.protocol+"//"+ro.host)};Bp&&Bc||(Bp=function(C){ka(arguments.length,1);var L=Dr(C)?C:Th(C),P=Xl(arguments,1);return fc[++Nc]=function(){bu(L,void 0,P)},ou(Nc),Nc},Bc=function(C){delete fc[C]},Qu?ou=function(C){Nu.nextTick(hc(C))}:rp&&rp.now?ou=function(C){rp.now(hc(C))}:xf&&!Dc?(tp=(ep=new xf).port2,ep.port1.onmessage=np,ou=Ys(tp.postMessage,tp)):ue.addEventListener&&Dr(ue.postMessage)&&!ue.importScripts&&ro&&ro.protocol!=="file:"&&!ve(zu)?(ou=zu,ue.addEventListener("message",np,!1)):ou="onreadystatechange"in Bn("script")?function(C){Bu.appendChild(Bn("script")).onreadystatechange=function(){Bu.removeChild(this),_l(C)}}:function(C){setTimeout(hc(C),0)});var qs,zc,Uc,Vc,Ks,Zl,Yf,ip,Mh={set:Bp,clear:Bc},Yl=/ipad|iphone|ipod/i.test(Me)&&ue.Pebble!==void 0,su=/web0s(?!.*chrome)/i.test(Me),Ih=se.f,bf=Mh.set,md=ue.MutationObserver||ue.WebKitMutationObserver,ap=ue.document,Np=ue.process,Ef=ue.Promise,Gc=Ih(ue,"queueMicrotask"),pt=Gc&&Gc.value;pt||(qs=function(){var C,L;for(Qu&&(C=Np.domain)&&C.exit();zc;){L=zc.fn,zc=zc.next;try{L()}catch(P){throw zc?Vc():Uc=void 0,P}}Uc=void 0,C&&C.enter()},Dc||Qu||su||!md||!ap?!Yl&&Ef&&Ef.resolve?((Yf=Ef.resolve(void 0)).constructor=Ef,ip=Ys(Yf.then,Yf),Vc=function(){ip(qs)}):Qu?Vc=function(){Np.nextTick(qs)}:(bf=Ys(bf,ue),Vc=function(){bf(qs)}):(Ks=!0,Zl=ap.createTextNode(""),new md(qs).observe(Zl,{characterData:!0}),Vc=function(){Zl.data=Ks=!Ks}));var ur=pt||function(C){var L={fn:C,next:void 0};Uc&&(Uc.next=L),zc||(zc=L,Vc()),Uc=L},Vt=function(C){try{return{error:!1,value:C()}}catch(L){return{error:!0,value:L}}},on=function(){this.head=null,this.tail=null};on.prototype={add:function(C){var L={item:C,next:null};this.head?this.tail.next=L:this.head=L,this.tail=L},get:function(){var C=this.head;if(C)return this.head=C.next,this.tail===C&&(this.tail=null),C.item}};var Ei,ua,no,Gn=on,qi=ue.Promise,Qs=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",uu=!Qs&&!Qu&&typeof window=="object"&&typeof document=="object",jc=(qi&&qi.prototype,st("species")),Lh=!1,qf=Dr(ue.PromiseRejectionEvent),pc={CONSTRUCTOR:_u("Promise",function(){var C=Zr(qi),L=C!==String(qi);if(!L&&_r===66)return!0;if(!_r||_r<51||!/native code/.test(C)){var P=new qi(function(m){m(1)}),f=function(m){m(function(){},function(){})};if((P.constructor={})[jc]=f,!(Lh=P.then(function(){})instanceof f))return!0}return!L&&(uu||Qs)&&!qf}),REJECTION_EVENT:qf,SUBCLASSING:Lh},Cf=function(C){var L,P;this.promise=new C(function(f,m){if(L!==void 0||P!==void 0)throw TypeError("Bad Promise constructor");L=f,P=m}),this.resolve=J(L),this.reject=J(P)},fa={f:function(C){return new Cf(C)}},ql=Mh.set,lo=pc.CONSTRUCTOR,Sf=pc.REJECTION_EVENT,op=pc.SUBCLASSING,ba=pa.getterFor("Promise"),mn=pa.set,Xo=qi&&qi.prototype,Js=qi,Ju=Xo,Uu=ue.TypeError,fs=ue.document,Kf=ue.process,qr=fa.f,Kl=qr,Jo=!!(fs&&fs.createEvent&&ue.dispatchEvent),Hc=function(C){var L;return!(!nn(C)||!Dr(L=C.then))&&L},hs=function(C,L){var P,f,m,S=L.value,k=L.state==1,B=k?C.ok:C.fail,G=C.resolve,Z=C.reject,ee=C.domain;try{B?(k||(L.rejection===2&&xl(L),L.rejection=1),B===!0?P=S:(ee&&ee.enter(),P=B(S),ee&&(ee.exit(),m=!0)),P===C.promise?Z(Uu("Promise-chain cycle")):(f=Hc(P))?Xi(f,P,G,Z):G(P)):Z(S)}catch(_e){ee&&!m&&ee.exit(),Z(_e)}},Bo=function(C,L){C.notified||(C.notified=!0,ur(function(){for(var P,f=C.reactions;P=f.get();)hs(P,C);C.notified=!1,L&&!C.rejection&&sp(C)}))},kh=function(C,L,P){var f,m;Jo?((f=fs.createEvent("Event")).promise=L,f.reason=P,f.initEvent(C,!1,!0),ue.dispatchEvent(f)):f={promise:L,reason:P},!Sf&&(m=ue["on"+C])?m(f):C==="unhandledrejection"&&function(S,k){var B=ue.console;B&&B.error&&(arguments.length==1?B.error(S):B.error(S,k))}("Unhandled promise rejection",P)},sp=function(C){Xi(ql,ue,function(){var L,P=C.facade,f=C.value;if(Eu(C)&&(L=Vt(function(){Qu?Kf.emit("unhandledRejection",f,P):kh("unhandledrejection",P,f)}),C.rejection=Qu||Eu(C)?2:1,L.error))throw L.value})},Eu=function(C){return C.rejection!==1&&!C.parent},xl=function(C){Xi(ql,ue,function(){var L=C.facade;Qu?Kf.emit("rejectionHandled",L):kh("rejectionhandled",L,C.value)})},dc=function(C,L,P){return function(f){C(L,f,P)}},bl=function(C,L,P){C.done||(C.done=!0,P&&(C=P),C.value=L,C.state=2,Bo(C,!0))},Qf=function(C,L,P){if(!C.done){C.done=!0,P&&(C=P);try{if(C.facade===L)throw Uu("Promise can't be resolved itself");var f=Hc(L);f?ur(function(){var m={done:!1};try{Xi(f,L,dc(Qf,m,C),dc(bl,m,C))}catch(S){bl(m,S,C)}}):(C.value=L,C.state=1,Bo(C,!1))}catch(m){bl({done:!1},m,C)}}};if(lo&&(Ju=(Js=function(C){Xs(this,Ju),J(C),Xi(Ei,this);var L=ba(this);try{C(dc(Qf,L),dc(bl,L))}catch(P){bl(L,P)}}).prototype,(Ei=function(C){mn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Gn,rejection:!1,state:0,value:void 0})}).prototype=da(Ju,"then",function(C,L){var P=ba(this),f=qr(lc(this,Js));return P.parent=!0,f.ok=!Dr(C)||C,f.fail=Dr(L)&&L,f.domain=Qu?Kf.domain:void 0,P.state==0?P.reactions.add(f):ur(function(){hs(f,P)}),f.promise}),ua=function(){var C=new Ei,L=ba(C);this.promise=C,this.resolve=dc(Qf,L),this.reject=dc(bl,L)},fa.f=qr=function(C){return C===Js||C===void 0?new ua(C):Kl(C)},Dr(qi)&&Xo!==Object.prototype)){no=Xo.then,op||da(Xo,"then",function(C,L){var P=this;return new Js(function(f,m){Xi(no,P,f,m)}).then(C,L)},{unsafe:!0});try{delete Xo.constructor}catch{}Oo&&Oo(Xo,Ju)}Yi({global:!0,constructor:!0,wrap:!0,forced:lo},{Promise:Js}),Po(Js,"Promise",!1),Fs("Promise");var vc={},el=st("iterator"),Vu=Array.prototype,ti=function(C){return C!==void 0&&(vc.Array===C||Vu[el]===C)},_o=st("iterator"),Cu=function(C){if(C!=null)return ae(C,_o)||ae(C,"@@iterator")||vc[yo(C)]},Ds=TypeError,El=function(C,L){var P=arguments.length<2?Cu(C):L;if(J(P))return Ki(Xi(P,C));throw Ds(Fu(C)+" is not iterable")},Wc=function(C,L,P){var f,m;Ki(C);try{if(!(f=ae(C,"return"))){if(L==="throw")throw P;return P}f=Xi(f,C)}catch(S){m=!0,f=S}if(L==="throw")throw P;if(m)throw f;return Ki(f),P},ps=TypeError,xo=function(C,L){this.stopped=C,this.result=L},$c=xo.prototype,kn=function(C,L,P){var f,m,S,k,B,G,Z,ee=P&&P.that,_e=!(!P||!P.AS_ENTRIES),Ge=!(!P||!P.IS_RECORD),Xe=!(!P||!P.IS_ITERATOR),it=!(!P||!P.INTERRUPTED),bt=Ys(L,ee),kt=function(Ht){return f&&Wc(f,"normal",Ht),new xo(!0,Ht)},Xt=function(Ht){return _e?(Ki(Ht),it?bt(Ht[0],Ht[1],kt):bt(Ht[0],Ht[1])):it?bt(Ht,kt):bt(Ht)};if(Ge)f=C.iterator;else if(Xe)f=C;else{if(!(m=Cu(C)))throw ps(Fu(C)+" is not iterable");if(ti(m)){for(S=0,k=Ia(C);k>S;S++)if((B=Xt(C[S]))&&nu($c,B))return B;return new xo(!1)}f=El(C,m)}for(G=Ge?C.next:f.next;!(Z=Xi(G,f)).done;){try{B=Xt(Z.value)}catch(Ht){Wc(f,"throw",Ht)}if(typeof B=="object"&&B&&nu($c,B))return B}return new xo(!1)},bn=st("iterator"),mc=!1;try{var ds=0,Bs={next:function(){return{done:!!ds++}},return:function(){mc=!0}};Bs[bn]=function(){return this},Array.from(Bs,function(){throw 2})}catch{}var is=function(C,L){if(!L&&!mc)return!1;var P=!1;try{var f={};f[bn]=function(){return{next:function(){return{done:P=!0}}}},C(f)}catch{}return P},Cl=pc.CONSTRUCTOR||!is(function(C){qi.all(C).then(void 0,function(){})});Yi({target:"Promise",stat:!0,forced:Cl},{all:function(C){var L=this,P=fa.f(L),f=P.resolve,m=P.reject,S=Vt(function(){var k=J(L.resolve),B=[],G=0,Z=1;kn(C,function(ee){var _e=G++,Ge=!1;Z++,Xi(k,L,ee).then(function(Xe){Ge||(Ge=!0,B[_e]=Xe,--Z||f(B))},m)}),--Z||f(B)});return S.error&&m(S.value),P.promise}});var zp=pc.CONSTRUCTOR,Su=qi&&qi.prototype;if(Yi({target:"Promise",proto:!0,forced:zp,real:!0},{catch:function(C){return this.then(void 0,C)}}),Dr(qi)){var ma=Wt("Promise").prototype.catch;Su.catch!==ma&&da(Su,"catch",ma,{unsafe:!0})}Yi({target:"Promise",stat:!0,forced:Cl},{race:function(C){var L=this,P=fa.f(L),f=P.reject,m=Vt(function(){var S=J(L.resolve);kn(C,function(k){Xi(S,L,k).then(P.resolve,f)})});return m.error&&f(m.value),P.promise}}),Yi({target:"Promise",stat:!0,forced:pc.CONSTRUCTOR},{reject:function(C){var L=fa.f(this);return Xi(L.reject,void 0,C),L.promise}});var es=pc.CONSTRUCTOR;Wt("Promise");function lu(C,L){if(!C)throw new Error(L||"web worker helper assertion failed.")}Yi({target:"Promise",stat:!0,forced:es},{resolve:function(C){return function(L,P){if(Ki(L),nn(P)&&P.constructor===L)return P;var f=fa.f(L);return(0,f.resolve)(P),f.promise}(this,C)}});var Sl=new Map;function ye(C){lu(C.source&&!C.url||!C.source&&C.url);var L=Sl.get(C.source||C.url);return L||(C.url&&(L=function(P){if(!P.startsWith("http"))return P;return Ns((f=P,`try {
  importScripts('`+f+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var f}(C.url),Sl.set(C.url,L)),C.source&&(L=Ns(C.source),Sl.set(C.source,L))),lu(L),L}function Ns(C){var L=new Blob([C],{type:"application/javascript"});return URL.createObjectURL(L)}function vs(C,L,P){L===void 0&&(L=!0);var f=P||new Set;if(C){if(Es(C))f.add(C);else if(Es(C.buffer))f.add(C.buffer);else if(!ArrayBuffer.isView(C)){if(L&&typeof C=="object")for(var m in C)vs(C[m],L,f)}}return P===void 0?Array.from(f):[]}function Es(C){return!!C&&(C instanceof ArrayBuffer||typeof MessagePort<"u"&&C instanceof MessagePort||typeof ImageBitmap<"u"&&C instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&C instanceof OffscreenCanvas)}var Ii=function(){};(function(){function C(L){this.terminated=!1,this.loadableURL="";var P=L.name,f=L.source,m=L.url;lu(f||m),this.name=P,this.source=f,this.url=m,this.onMessage=Ii,this.onError=function(S){return console.log(S)},this.worker=this.createBrowserWorker()}return C.isSupported=function(){return typeof Worker<"u"},C.prototype.destroy=function(){this.onMessage=Ii,this.onError=Ii,this.worker.terminate(),this.terminated=!0},Object.defineProperty(C.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),C.prototype.postMessage=function(L,P){P=P||vs(L),this.worker.postMessage(L,P)},C.prototype.getErrorFromErrorEvent=function(L){var P="Failed to load ";return P+="worker "+this.name+" from "+this.url+". ",L.message&&(P+=L.message+" in "),L.lineno&&(P+=":"+L.lineno+":"+L.colno),new Error(P)},C.prototype.createBrowserWorker=function(){var L=this;this.loadableURL=ye({source:this.source,url:this.url});var P=new Worker(this.loadableURL,{name:this.name});return P.onmessage=function(f){f.data?L.onMessage(f.data):L.onError(new Error("No data received"))},P.onerror=function(f){L.onError(L.getErrorFromErrorEvent(f)),L.terminated=!0},P.onmessageerror=function(f){return console.error("worker "+L.name+", message error: "+f)},P},C})();var Jf=new Map,wu=function(){function C(){}return Object.defineProperty(C,"onmessage",{set:function(L){self.onmessage=function(P){if(Rh(P)){var f=P.data,m=f.type,S=f.payload;L(m,S)}}},enumerable:!1,configurable:!0}),C.addEventListener=function(L){var P=Jf.get(L);P||(P=function(f){if(Rh(f)){var m=f.data,S=m.type,k=m.payload;L(S,k)}}),self.addEventListener("message",P)},C.removeEventListener=function(L){var P=Jf.get(L);Jf.delete(L),self.removeEventListener("message",P)},C.postMessage=function(L,P){if(self){var f={source:"Worker thread",type:L,payload:P},m=vs(P);self.postMessage(f,m)}},C}();function Rh(C){var L=C.type,P=C.data;return L==="message"&&P&&typeof P.source=="string"&&P.source==="Main thread"}var wl,eh,th=function(){function C(){this._values=[],this._settlers=[],this._closed=!1}return C.prototype[Symbol.asyncIterator]=function(){return this},C.prototype.push=function(L){return this.enqueue(L)},C.prototype.enqueue=function(L){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var P=this._settlers.shift();L instanceof Error?P.reject(L):P.resolve({value:L})}else this._values.push(L)},C.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},C.prototype.next=function(){var L=this;if(this._values.length>0){var P=this._values.shift();return P instanceof Error?Promise.reject(P):Promise.resolve({done:!1,value:P})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(f,m){L._settlers.push({resolve:f,reject:m})})},C}(),gd=self&&self.__awaiter||function(C,L,P,f){return new(P||(P=Promise))(function(m,S){function k(Z){try{G(f.next(Z))}catch(ee){S(ee)}}function B(Z){try{G(f.throw(Z))}catch(ee){S(ee)}}function G(Z){var ee;Z.done?m(Z.value):(ee=Z.value,ee instanceof P?ee:new P(function(_e){_e(ee)})).then(k,B)}G((f=f.apply(C,L||[])).next())})},wf=self&&self.__generator||function(C,L){var P,f,m,S,k={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return S={next:B(0),throw:B(1),return:B(2)},typeof Symbol=="function"&&(S[Symbol.iterator]=function(){return this}),S;function B(G){return function(Z){return function(ee){if(P)throw new TypeError("Generator is already executing.");for(;k;)try{if(P=1,f&&(m=2&ee[0]?f.return:ee[0]?f.throw||((m=f.return)&&m.call(f),0):f.next)&&!(m=m.call(f,ee[1])).done)return m;switch(f=0,m&&(ee=[2&ee[0],m.value]),ee[0]){case 0:case 1:m=ee;break;case 4:return k.label++,{value:ee[1],done:!1};case 5:k.label++,f=ee[1],ee=[0];continue;case 7:ee=k.ops.pop(),k.trys.pop();continue;default:if(m=k.trys,!((m=m.length>0&&m[m.length-1])||ee[0]!==6&&ee[0]!==2)){k=0;continue}if(ee[0]===3&&(!m||ee[1]>m[0]&&ee[1]<m[3])){k.label=ee[1];break}if(ee[0]===6&&k.label<m[1]){k.label=m[1],m=ee;break}if(m&&k.label<m[2]){k.label=m[2],k.ops.push(ee);break}m[2]&&k.ops.pop(),k.trys.pop();continue}ee=L.call(C,k)}catch(_e){ee=[6,_e],f=0}finally{P=m=0}if(5&ee[0])throw ee[1];return{value:ee[0]?ee[1]:void 0,done:!0}}([G,Z])}}},Af=self&&self.__asyncValues||function(C){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L,P=C[Symbol.asyncIterator];return P?P.call(C):(C=typeof __values=="function"?__values(C):C[Symbol.iterator](),L={},f("next"),f("throw"),f("return"),L[Symbol.asyncIterator]=function(){return this},L);function f(m){L[m]=C[m]&&function(S){return new Promise(function(k,B){(function(G,Z,ee,_e){Promise.resolve(_e).then(function(Ge){G({value:Ge,done:ee})},Z)})(k,B,(S=C[m](S)).done,S.value)})}}},tl=0;function gc(C,L){var P=this;if(typeof self<"u"){var f={process:Al};wu.onmessage=function(m,S){return gd(P,void 0,void 0,function(){var k,B,G,Z,ee,_e,Ge,Xe,it,bt;return wf(this,function(kt){switch(kt.label){case 0:switch(kt.trys.push([0,19,,20]),m){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!C)throw new Error("Worker does not support atomic processing");return[4,C(S.input,S.options||{},f)];case 2:return k=kt.sent(),wu.postMessage("done",{result:k}),[3,18];case 3:if(!L)throw new Error("Worker does not support batched processing");wl=new th,eh=S.options||{},B=L(wl,eh,f),kt.label=4;case 4:kt.trys.push([4,9,10,15]),G=Af(B),kt.label=5;case 5:return[4,G.next()];case 6:if((Z=kt.sent()).done)return[3,8];ee=Z.value,wu.postMessage("output-batch",{result:ee}),kt.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return _e=kt.sent(),it={error:_e},[3,15];case 10:return kt.trys.push([10,,13,14]),Z&&!Z.done&&(bt=G.return)?[4,bt.call(G)]:[3,12];case 11:kt.sent(),kt.label=12;case 12:return[3,14];case 13:if(it)throw it.error;return[7];case 14:return[7];case 15:return wu.postMessage("done",{}),[3,18];case 16:return wl.push(S.input),[3,18];case 17:return wl.close(),[3,18];case 18:return[3,20];case 19:return Ge=kt.sent(),Xe=Ge instanceof Error?Ge.message:"",wu.postMessage("error",{error:Xe}),[3,20];case 20:return[2]}})})}}}function Al(C,L){return L===void 0&&(L={}),new Promise(function(P,f){var m=tl++,S=function(B,G){if(G.id===m)switch(B){case"done":wu.removeEventListener(S),P(G.result);break;case"error":wu.removeEventListener(S),f(G.error)}};wu.addEventListener(S);var k={id:m,input:C,options:L};wu.postMessage("process",k)})}var Oh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Xc=Bn("span").classList,rh=Xc&&Xc.constructor&&Xc.constructor.prototype,rl=rh===Object.prototype?void 0:rh,d=Array.isArray||function(C){return ki(C)=="Array"},g=st("species"),v=Array,x=function(C,L){return new(function(P){var f;return d(P)&&(f=P.constructor,(Sh(f)&&(f===v||d(f.prototype))||nn(f)&&(f=f[g])===null)&&(f=void 0)),f===void 0?v:f}(C))(L===0?0:L)},T=gt([].push),R=function(C){var L=C==1,P=C==2,f=C==3,m=C==4,S=C==6,k=C==7,B=C==5||S;return function(G,Z,ee,_e){for(var Ge,Xe,it=dn(G),bt=Os(it),kt=Ys(Z,ee),Xt=Ia(bt),Ht=0,ir=_e||x,Ur=L?ir(G,Xt):P||k?ir(G,0):void 0;Xt>Ht;Ht++)if((B||Ht in bt)&&(Xe=kt(Ge=bt[Ht],Ht,it),C))if(L)Ur[Ht]=Xe;else if(Xe)switch(C){case 3:return!0;case 5:return Ge;case 6:return Ht;case 2:T(Ur,Ge)}else switch(C){case 4:return!1;case 7:T(Ur,Ge)}return S?-1:f||m?m:Ur}},F={forEach:R(0),map:R(1),filter:R(2),some:R(3),every:R(4),find:R(5),findIndex:R(6),filterReject:R(7)},U=function(C,L){var P=[][C];return!!P&&ve(function(){P.call(null,L||function(){return 1},1)})},X=F.forEach,re=U("forEach")?[].forEach:function(C){return X(this,C,arguments.length>1?arguments[1]:void 0)},he=function(C){if(C&&C.forEach!==re)try{ci(C,"forEach",re)}catch{C.forEach=re}};for(var me in Oh)Oh[me]&&he(ue[me]&&ue[me].prototype);he(rl);var xe=function(C,L,P){var f=ot(L);f in C?Jt.f(C,f,bi(0,P)):C[f]=P},Ne=st("species"),Fe=function(C){return _r>=51||!ve(function(){var L=[];return(L.constructor={})[Ne]=function(){return{foo:1}},L[C](Boolean).foo!==1})},qe=Fe("slice"),Re=st("species"),Ze=Array,at=Math.max;Yi({target:"Array",proto:!0,forced:!qe},{slice:function(C,L){var P,f,m,S=Ha(this),k=Ia(S),B=Ma(C,k),G=Ma(L===void 0?k:L,k);if(d(S)&&(P=S.constructor,(Sh(P)&&(P===Ze||d(P.prototype))||nn(P)&&(P=P[Re])===null)&&(P=void 0),P===Ze||P===void 0))return Xl(S,B,G);for(f=new(P===void 0?Ze:P)(at(G-B,0)),m=0;B<G;B++,m++)B in S&&xe(f,m,S[B]);return f.length=m,f}});var ht=Nr.EXISTS,Ot=Jt.f,It=Function.prototype,Ut=gt(It.toString),cr=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Sr=gt(cr.exec);fr&&!ht&&Ot(It,"name",{configurable:!0,get:function(){try{return Sr(cr,Ut(this))[1]}catch{return""}}});var zr=F.map,sn=Fe("map");Yi({target:"Array",proto:!0,forced:!sn},{map:function(C){return zr(this,C,arguments.length>1?arguments[1]:void 0)}});var Cn,Dn=Object.keys||function(C){return gu(C,Wl)},Nn={f:fr&&!mi?Object.defineProperties:function(C,L){Ki(C);for(var P,f=Ha(L),m=Dn(L),S=m.length,k=0;S>k;)Jt.f(C,P=m[k++],f[P]);return C}},ta=Fi("IE_PROTO"),un=function(){},Zn=function(C){return"<script>"+C+"<\/script>"},ui=function(C){C.write(Zn("")),C.close();var L=C.parentWindow.Object;return C=null,L},ni=function(){try{Cn=new ActiveXObject("htmlfile")}catch{}var C,L;ni=typeof document<"u"?document.domain&&Cn?ui(Cn):((L=Bn("iframe")).style.display="none",Bu.appendChild(L),L.src=String("javascript:"),(C=L.contentWindow.document).open(),C.write(Zn("document.F=Object")),C.close(),C.F):ui(Cn);for(var P=Wl.length;P--;)delete ni.prototype[Wl[P]];return ni()};Di[ta]=!0;var jn=Object.create||function(C,L){var P;return C!==null?(un.prototype=Ki(C),P=new un,un.prototype=null,P[ta]=C):P=ni(),L===void 0?P:Nn.f(P,L)},yi=Jt.f,Qn=st("unscopables"),wn=Array.prototype;wn[Qn]==null&&yi(wn,Qn,{configurable:!0,value:jn(null)});var Ba,co,io,So=function(C){wn[Qn][C]=!0},Ka=!ve(function(){function C(){}return C.prototype.constructor=null,Object.getPrototypeOf(new C)!==C.prototype}),Na=Fi("IE_PROTO"),Cs=Object,Ra=Cs.prototype,Ss=Ka?Cs.getPrototypeOf:function(C){var L=dn(C);if(Ar(L,Na))return L[Na];var P=L.constructor;return Dr(P)&&L instanceof P?P.prototype:L instanceof Cs?Ra:null},zs=st("iterator"),nl=!1;[].keys&&("next"in(io=[].keys())?(co=Ss(Ss(io)))!==Object.prototype&&(Ba=co):nl=!0),(Ba==null||ve(function(){var C={};return Ba[zs].call(C)!==C}))&&(Ba={}),Dr(Ba[zs])||da(Ba,zs,function(){return this});var Au={IteratorPrototype:Ba,BUGGY_SAFARI_ITERATORS:nl},Zc=Au.IteratorPrototype,nh=function(){return this},il=Nr.PROPER,Yc=Nr.CONFIGURABLE,Tf=Au.IteratorPrototype,Gu=Au.BUGGY_SAFARI_ITERATORS,Tu=st("iterator"),Ql=function(){return this},Zo=function(C,L,P,f,m,S,k){(function(Xt,Ht,ir,Ur){var qn=Ht+" Iterator";Xt.prototype=jn(Zc,{next:bi(+!Ur,ir)}),Po(Xt,qn,!1),vc[qn]=nh})(P,L,f);var B,G,Z,ee=function(Xt){if(Xt===m&&bt)return bt;if(!Gu&&Xt in Xe)return Xe[Xt];switch(Xt){case"keys":case"values":case"entries":return function(){return new P(this,Xt)}}return function(){return new P(this)}},_e=L+" Iterator",Ge=!1,Xe=C.prototype,it=Xe[Tu]||Xe["@@iterator"]||m&&Xe[m],bt=!Gu&&it||ee(m),kt=L=="Array"&&Xe.entries||it;if(kt&&(B=Ss(kt.call(new C)))!==Object.prototype&&B.next&&(Ss(B)!==Tf&&(Oo?Oo(B,Tf):Dr(B[Tu])||da(B,Tu,Ql)),Po(B,_e,!0)),il&&m=="values"&&it&&it.name!=="values"&&(Yc?ci(Xe,"name","values"):(Ge=!0,bt=function(){return Xi(it,this)})),m)if(G={values:ee("values"),keys:S?bt:ee("keys"),entries:ee("entries")},k)for(Z in G)(Gu||Ge||!(Z in Xe))&&da(Xe,Z,G[Z]);else Yi({target:L,proto:!0,forced:Gu||Ge},G);return Xe[Tu]!==bt&&da(Xe,Tu,bt,{name:m}),vc[L]=bt,G},al=Jt.f,yc=pa.set,Mf=pa.getterFor("Array Iterator"),Bi=Zo(Array,"Array",function(C,L){yc(this,{type:"Array Iterator",target:Ha(C),index:0,kind:L})},function(){var C=Mf(this),L=C.target,P=C.kind,f=C.index++;return!L||f>=L.length?(C.target=void 0,{value:void 0,done:!0}):P=="keys"?{value:f,done:!1}:P=="values"?{value:L[f],done:!1}:{value:[f,L[f]],done:!1}},"values"),cu=vc.Arguments=vc.Array;if(So("keys"),So("values"),So("entries"),fr&&cu.name!=="values")try{al(cu,"name",{value:"values"})}catch{}var La,Mu,ih,Iu=typeof ArrayBuffer<"u"&&typeof DataView<"u",Ph=Jt.f,ol=pa.enforce,ah=pa.get,fu=ue.Int8Array,Tl=fu&&fu.prototype,qc=ue.Uint8ClampedArray,sl=qc&&qc.prototype,bo=fu&&Ss(fu),ul=Tl&&Ss(Tl),Up=Object.prototype,up=ue.TypeError,yd=st("toStringTag"),If=hr("TYPED_ARRAY_TAG"),Ml=Iu&&!!Oo&&yo(ue.opera)!=="Opera",Vp=!1,Ni={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},lp={BigInt64Array:8,BigUint64Array:8},Jd=function(C){var L=Ss(C);if(nn(L)){var P=ah(L);return P&&Ar(P,"TypedArrayConstructor")?P.TypedArrayConstructor:Jd(L)}},Il=function(C){if(!nn(C))return!1;var L=yo(C);return Ar(Ni,L)||Ar(lp,L)};for(La in Ni)(ih=(Mu=ue[La])&&Mu.prototype)?ol(ih).TypedArrayConstructor=Mu:Ml=!1;for(La in lp)(ih=(Mu=ue[La])&&Mu.prototype)&&(ol(ih).TypedArrayConstructor=Mu);if((!Ml||!Dr(bo)||bo===Function.prototype)&&(bo=function(){throw up("Incorrect invocation")},Ml))for(La in Ni)ue[La]&&Oo(ue[La],bo);if((!Ml||!ul||ul===Up)&&(ul=bo.prototype,Ml))for(La in Ni)ue[La]&&Oo(ue[La].prototype,ul);if(Ml&&Ss(sl)!==ul&&Oo(sl,ul),fr&&!Ar(ul,yd))for(La in Vp=!0,Ph(ul,yd,{get:function(){return nn(this)?this[If]:void 0}}),Ni)ue[La]&&ci(ue[La],If,La);var oi={NATIVE_ARRAY_BUFFER_VIEWS:Ml,TYPED_ARRAY_TAG:Vp&&If,aTypedArray:function(C){if(Il(C))return C;throw up("Target is not a typed array")},aTypedArrayConstructor:function(C){if(Dr(C)&&(!Oo||nu(bo,C)))return C;throw up(Fu(C)+" is not a typed array constructor")},exportTypedArrayMethod:function(C,L,P,f){if(fr){if(P)for(var m in Ni){var S=ue[m];if(S&&Ar(S.prototype,C))try{delete S.prototype[C]}catch{try{S.prototype[C]=L}catch{}}}ul[C]&&!P||da(ul,C,P?L:Ml&&Tl[C]||L,f)}},exportTypedArrayStaticMethod:function(C,L,P){var f,m;if(fr){if(Oo){if(P){for(f in Ni)if((m=ue[f])&&Ar(m,C))try{delete m[C]}catch{}}if(bo[C]&&!P)return;try{return da(bo,C,P?L:Ml&&bo[C]||L)}catch{}}for(f in Ni)!(m=ue[f])||m[C]&&!P||da(m,C,L)}},getTypedArrayConstructor:Jd,isView:function(C){if(!nn(C))return!1;var L=yo(C);return L==="DataView"||Ar(Ni,L)||Ar(lp,L)},isTypedArray:Il,TypedArray:bo,TypedArrayPrototype:ul},Gp=oi.NATIVE_ARRAY_BUFFER_VIEWS,$v=ue.ArrayBuffer,hu=ue.Int8Array,km=!Gp||!ve(function(){hu(1)})||!ve(function(){new hu(-1)})||!is(function(C){new hu,new hu(null),new hu(1.5),new hu(C)},!0)||ve(function(){return new hu(new $v(2),1,void 0).length!==1}),Kc=function(C,L,P){for(var f in L)da(C,f,L[f],P);return C},Xv=RangeError,cp=function(C){if(C===void 0)return 0;var L=Tr(C),P=ko(L);if(L!==P)throw Xv("Wrong length or index");return P},ev=Array,Jl=Math.abs,ws=Math.pow,Zv=Math.floor,ts=Math.log,fp=Math.LN2,Yv=function(C,L,P){var f,m,S,k=ev(P),B=8*P-L-1,G=(1<<B)-1,Z=G>>1,ee=L===23?ws(2,-24)-ws(2,-77):0,_e=C<0||C===0&&1/C<0?1:0,Ge=0;for((C=Jl(C))!=C||C===1/0?(m=C!=C?1:0,f=G):(f=Zv(ts(C)/fp),C*(S=ws(2,-f))<1&&(f--,S*=2),(C+=f+Z>=1?ee/S:ee*ws(2,1-Z))*S>=2&&(f++,S/=2),f+Z>=G?(m=0,f=G):f+Z>=1?(m=(C*S-1)*ws(2,L),f+=Z):(m=C*ws(2,Z-1)*ws(2,L),f=0));L>=8;)k[Ge++]=255&m,m/=256,L-=8;for(f=f<<L|m,B+=L;B>0;)k[Ge++]=255&f,f/=256,B-=8;return k[--Ge]|=128*_e,k},jp=function(C,L){var P,f=C.length,m=8*f-L-1,S=(1<<m)-1,k=S>>1,B=m-7,G=f-1,Z=C[G--],ee=127&Z;for(Z>>=7;B>0;)ee=256*ee+C[G--],B-=8;for(P=ee&(1<<-B)-1,ee>>=-B,B+=L;B>0;)P=256*P+C[G--],B-=8;if(ee===0)ee=1-k;else{if(ee===S)return P?NaN:Z?-1/0:1/0;P+=ws(2,L),ee-=k}return(Z?-1:1)*P*ws(2,ee-L)},Fh=function(C){for(var L=dn(this),P=Ia(L),f=arguments.length,m=Ma(f>1?arguments[1]:void 0,P),S=f>2?arguments[2]:void 0,k=S===void 0?P:Ma(S,P);k>m;)L[m++]=C;return L},Lf=Array,hp=Math.max,ll=function(C,L,P){for(var f=Ia(C),m=Ma(L,f),S=Ma(P===void 0?f:P,f),k=Lf(hp(S-m,0)),B=0;m<S;m++,B++)xe(k,B,C[m]);return k.length=B,k},pp=Ku.f,ec=Jt.f,dp=Nr.PROPER,Hp=Nr.CONFIGURABLE,Ll=pa.get,_d=pa.set,ju=ue.ArrayBuffer,kl=ju,tc=kl&&kl.prototype,Hu=ue.DataView,As=Hu&&Hu.prototype,vp=Object.prototype,Wp=ue.Array,eu=ue.RangeError,Rl=gt(Fh),Dh=gt([].reverse),Bh=Yv,mp=jp,gp=function(C){return[255&C]},tv=function(C){return[255&C,C>>8&255]},rv=function(C){return[255&C,C>>8&255,C>>16&255,C>>24&255]},oh=function(C){return C[3]<<24|C[2]<<16|C[1]<<8|C[0]},qv=function(C){return Bh(C,23,4)},_c=function(C){return Bh(C,52,8)},sh=function(C,L){ec(C.prototype,L,{get:function(){return Ll(this)[L]}})},kf=function(C,L,P,f){var m=cp(P),S=Ll(C);if(m+L>S.byteLength)throw eu("Wrong index");var k=Ll(S.buffer).bytes,B=m+S.byteOffset,G=ll(k,B,B+L);return f?G:Dh(G)},Ol=function(C,L,P,f,m,S){var k=cp(P),B=Ll(C);if(k+L>B.byteLength)throw eu("Wrong index");for(var G=Ll(B.buffer).bytes,Z=k+B.byteOffset,ee=f(+m),_e=0;_e<L;_e++)G[Z+_e]=ee[S?_e:L-_e-1]};if(Iu){var rc=dp&&ju.name!=="ArrayBuffer";if(ve(function(){ju(1)})&&ve(function(){new ju(-1)})&&!ve(function(){return new ju,new ju(1.5),new ju(NaN),rc&&!Hp}))rc&&Hp&&ci(ju,"name","ArrayBuffer");else{(kl=function(C){return Xs(this,tc),new ju(cp(C))}).prototype=tc;for(var cl,nv=pp(ju),Rf=0;nv.length>Rf;)(cl=nv[Rf++])in kl||ci(kl,cl,ju[cl]);tc.constructor=kl}Oo&&Ss(As)!==vp&&Oo(As,vp);var Lu=new Hu(new kl(2)),yp=gt(As.setInt8);Lu.setInt8(0,2147483648),Lu.setInt8(1,2147483649),!Lu.getInt8(0)&&Lu.getInt8(1)||Kc(As,{setInt8:function(C,L){yp(this,C,L<<24>>24)},setUint8:function(C,L){yp(this,C,L<<24>>24)}},{unsafe:!0})}else tc=(kl=function(C){Xs(this,tc);var L=cp(C);_d(this,{bytes:Rl(Wp(L),0),byteLength:L}),fr||(this.byteLength=L)}).prototype,As=(Hu=function(C,L,P){Xs(this,As),Xs(C,tc);var f=Ll(C).byteLength,m=Tr(L);if(m<0||m>f)throw eu("Wrong offset");if(m+(P=P===void 0?f-m:ko(P))>f)throw eu("Wrong length");_d(this,{buffer:C,byteLength:P,byteOffset:m}),fr||(this.buffer=C,this.byteLength=P,this.byteOffset=m)}).prototype,fr&&(sh(kl,"byteLength"),sh(Hu,"buffer"),sh(Hu,"byteLength"),sh(Hu,"byteOffset")),Kc(As,{getInt8:function(C){return kf(this,1,C)[0]<<24>>24},getUint8:function(C){return kf(this,1,C)[0]},getInt16:function(C){var L=kf(this,2,C,arguments.length>1?arguments[1]:void 0);return(L[1]<<8|L[0])<<16>>16},getUint16:function(C){var L=kf(this,2,C,arguments.length>1?arguments[1]:void 0);return L[1]<<8|L[0]},getInt32:function(C){return oh(kf(this,4,C,arguments.length>1?arguments[1]:void 0))},getUint32:function(C){return oh(kf(this,4,C,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(C){return mp(kf(this,4,C,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(C){return mp(kf(this,8,C,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(C,L){Ol(this,1,C,gp,L)},setUint8:function(C,L){Ol(this,1,C,gp,L)},setInt16:function(C,L){Ol(this,2,C,tv,L,arguments.length>2?arguments[2]:void 0)},setUint16:function(C,L){Ol(this,2,C,tv,L,arguments.length>2?arguments[2]:void 0)},setInt32:function(C,L){Ol(this,4,C,rv,L,arguments.length>2?arguments[2]:void 0)},setUint32:function(C,L){Ol(this,4,C,rv,L,arguments.length>2?arguments[2]:void 0)},setFloat32:function(C,L){Ol(this,4,C,qv,L,arguments.length>2?arguments[2]:void 0)},setFloat64:function(C,L){Ol(this,8,C,_c,L,arguments.length>2?arguments[2]:void 0)}});Po(kl,"ArrayBuffer"),Po(Hu,"DataView");var iv={ArrayBuffer:kl,DataView:Hu},xd=Math.floor,bd=Number.isInteger||function(C){return!nn(C)&&isFinite(C)&&xd(C)===C},Ts=RangeError,Qc=RangeError,la=function(C,L){var P=function(f){var m=Tr(f);if(m<0)throw Ts("The argument can't be less than 0");return m}(C);if(P%L)throw Qc("Wrong offset");return P},fl=oi.aTypedArrayConstructor,xc=function(C){var L,P,f,m,S,k,B=Pc(this),G=dn(C),Z=arguments.length,ee=Z>1?arguments[1]:void 0,_e=ee!==void 0,Ge=Cu(G);if(Ge&&!ti(Ge))for(k=(S=El(G,Ge)).next,G=[];!(m=Xi(k,S)).done;)G.push(m.value);for(_e&&Z>2&&(ee=Ys(ee,arguments[2])),P=Ia(G),f=new(fl(B))(P),L=0;P>L;L++)f[L]=_e?ee(G[L],L):G[L];return f},Ed=function(C,L,P){var f,m;return Oo&&Dr(f=L.constructor)&&f!==P&&nn(m=f.prototype)&&m!==P.prototype&&Oo(C,m),C},Kv=ie(function(C){var L=Ku.f,P=F.forEach,f=pa.get,m=pa.set,S=pa.enforce,k=Jt.f,B=se.f,G=Math.round,Z=ue.RangeError,ee=iv.ArrayBuffer,_e=ee.prototype,Ge=iv.DataView,Xe=oi.NATIVE_ARRAY_BUFFER_VIEWS,it=oi.TYPED_ARRAY_TAG,bt=oi.TypedArray,kt=oi.TypedArrayPrototype,Xt=oi.aTypedArrayConstructor,Ht=oi.isTypedArray,ir=function(hi,or){Xt(hi);for(var yr=0,ri=or.length,Ca=new hi(ri);ri>yr;)Ca[yr]=or[yr++];return Ca},Ur=function(hi,or){k(hi,or,{get:function(){return f(this)[or]}})},qn=function(hi){var or;return nu(_e,hi)||(or=yo(hi))=="ArrayBuffer"||or=="SharedArrayBuffer"},Ri=function(hi,or){return Ht(hi)&&!iu(or)&&or in hi&&bd(+or)&&or>=0},Ai=function(hi,or){return or=ot(or),Ri(hi,or)?bi(2,hi[or]):B(hi,or)},Oi=function(hi,or,yr){return or=ot(or),!(Ri(hi,or)&&nn(yr)&&Ar(yr,"value"))||Ar(yr,"get")||Ar(yr,"set")||yr.configurable||Ar(yr,"writable")&&!yr.writable||Ar(yr,"enumerable")&&!yr.enumerable?k(hi,or,yr):(hi[or]=yr.value,hi)};fr?(Xe||(se.f=Ai,Jt.f=Oi,Ur(kt,"buffer"),Ur(kt,"byteOffset"),Ur(kt,"byteLength"),Ur(kt,"length")),Yi({target:"Object",stat:!0,forced:!Xe},{getOwnPropertyDescriptor:Ai,defineProperty:Oi}),C.exports=function(hi,or,yr){var ri=hi.match(/\d+$/)[0]/8,Ca=hi+(yr?"Clamped":"")+"Array",Wi="get"+hi,ac="set"+hi,wc=ue[Ca],os=wc,Ac=os&&os.prototype,xs={},zd=function(Bl,ss){k(Bl,ss,{get:function(){return function(rf,dl){var nf=f(rf);return nf.view[Wi](dl*ri+nf.byteOffset,!0)}(this,ss)},set:function(rf){return function(dl,nf,ed){var Y0=f(dl);yr&&(ed=(ed=G(ed))<0?0:ed>255?255:255&ed),Y0.view[ac](nf*ri+Y0.byteOffset,ed,!0)}(this,ss,rf)},enumerable:!0})};Xe?km&&(os=or(function(Bl,ss,rf,dl){return Xs(Bl,Ac),Ed(nn(ss)?qn(ss)?dl!==void 0?new wc(ss,la(rf,ri),dl):rf!==void 0?new wc(ss,la(rf,ri)):new wc(ss):Ht(ss)?ir(os,ss):Xi(xc,os,ss):new wc(cp(ss)),Bl,os)}),Oo&&Oo(os,bt),P(L(wc),function(Bl){Bl in os||ci(os,Bl,wc[Bl])}),os.prototype=Ac):(os=or(function(Bl,ss,rf,dl){Xs(Bl,Ac);var nf,ed,Y0,wA=0,fx=0;if(nn(ss)){if(!qn(ss))return Ht(ss)?ir(os,ss):Xi(xc,os,ss);nf=ss,fx=la(rf,ri);var V2=ss.byteLength;if(dl===void 0){if(V2%ri||(ed=V2-fx)<0)throw Z("Wrong length")}else if((ed=ko(dl)*ri)+fx>V2)throw Z("Wrong length");Y0=ed/ri}else Y0=cp(ss),nf=new ee(ed=Y0*ri);for(m(Bl,{buffer:nf,byteOffset:fx,byteLength:ed,length:Y0,view:new Ge(nf)});wA<Y0;)zd(Bl,wA++)}),Oo&&Oo(os,bt),Ac=os.prototype=jn(kt)),Ac.constructor!==os&&ci(Ac,"constructor",os),S(Ac).TypedArrayConstructor=os,it&&ci(Ac,it,Ca);var f0=os!=wc;xs[Ca]=os,Yi({global:!0,constructor:!0,forced:f0,sham:!Xe},xs),"BYTES_PER_ELEMENT"in os||ci(os,"BYTES_PER_ELEMENT",ri),"BYTES_PER_ELEMENT"in Ac||ci(Ac,"BYTES_PER_ELEMENT",ri),Fs(Ca)}):C.exports=function(){}});Kv("Uint8",function(C){return function(L,P,f){return C(this,L,P,f)}},!0);var k0=TypeError,Cd=function(C,L){if(!delete C[L])throw k0("Cannot delete property "+Fu(L)+" of "+Fu(C))},R0=Math.min,Rm=gt([].copyWithin||function(C,L){var P=dn(this),f=Ia(P),m=Ma(C,f),S=Ma(L,f),k=arguments.length>2?arguments[2]:void 0,B=R0((k===void 0?f:Ma(k,f))-S,f-m),G=1;for(S<m&&m<S+B&&(G=-1,S+=B-1,m+=B-1);B-- >0;)S in P?P[m]=P[S]:Cd(P,m),m+=G,S+=G;return P}),Of=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("copyWithin",function(C,L){return Rm(Of(this),C,L,arguments.length>2?arguments[2]:void 0)});var Qv=F.every,Jv=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("every",function(C){return Qv(Jv(this),C,arguments.length>1?arguments[1]:void 0)});var _p=TypeError,$p=function(C){var L=et(C,"number");if(typeof L=="number")throw _p("Can't convert number to bigint");return BigInt(L)},Nh=oi.aTypedArray,di=oi.exportTypedArrayMethod,Oa=gt("".slice);di("fill",function(C){var L=arguments.length;Nh(this);var P=Oa(yo(this),0,3)==="Big"?$p(C):+C;return Xi(Fh,this,P,L>1?arguments[1]:void 0,L>2?arguments[2]:void 0)},ve(function(){var C=0;return new Int8Array(2).fill({valueOf:function(){return C++}}),C!==1}));var av=oi.aTypedArrayConstructor,Wu=oi.getTypedArrayConstructor,uh=function(C){return av(lc(C,Wu(C)))},H=function(C,L){return function(P,f){for(var m=0,S=Ia(f),k=new P(S);S>m;)k[m]=f[m++];return k}(uh(C),L)},Ee=F.filter,Ue=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("filter",function(C){var L=Ee(Ue(this),C,arguments.length>1?arguments[1]:void 0);return H(this,L)});var wt=F.find,rr=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("find",function(C){return wt(rr(this),C,arguments.length>1?arguments[1]:void 0)});var Et=F.findIndex,jt=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("findIndex",function(C){return Et(jt(this),C,arguments.length>1?arguments[1]:void 0)});var sr=F.forEach,br=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("forEach",function(C){sr(br(this),C,arguments.length>1?arguments[1]:void 0)});var Rr=Zf.includes,Lr=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("includes",function(C){return Rr(Lr(this),C,arguments.length>1?arguments[1]:void 0)});var dr=Zf.indexOf,Mr=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("indexOf",function(C){return dr(Mr(this),C,arguments.length>1?arguments[1]:void 0)});var gr=st("iterator"),Or=ue.Uint8Array,ft=gt(Bi.values),Ft=gt(Bi.keys),wr=gt(Bi.entries),Kr=oi.aTypedArray,ar=oi.exportTypedArrayMethod,Br=Or&&Or.prototype,Xr=!ve(function(){Br[gr].call([1])}),En=!!Br&&Br.values&&Br[gr]===Br.values&&Br.values.name==="values",er=function(){return ft(Kr(this))};ar("entries",function(){return wr(Kr(this))},Xr),ar("keys",function(){return Ft(Kr(this))},Xr),ar("values",er,Xr||!En,{name:"values"}),ar(gr,er,Xr||!En,{name:"values"});var Zt=oi.aTypedArray,en=oi.exportTypedArrayMethod,Yr=gt([].join);en("join",function(C){return Yr(Zt(this),C)});var Ir=Math.min,Qr=[].lastIndexOf,an=!!Qr&&1/[1].lastIndexOf(1,-0)<0,si=U("lastIndexOf"),ai=an||!si?function(C){if(an)return bu(Qr,this,arguments)||0;var L=Ha(this),P=Ia(L),f=P-1;for(arguments.length>1&&(f=Ir(f,Tr(arguments[1]))),f<0&&(f=P+f);f>=0;f--)if(f in L&&L[f]===C)return f||0;return-1}:Qr,cn=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("lastIndexOf",function(C){var L=arguments.length;return bu(ai,cn(this),L>1?[C,arguments[1]]:[C])});var pn=F.map,Hn=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("map",function(C){return pn(Hn(this),C,arguments.length>1?arguments[1]:void 0,function(L,P){return new(uh(L))(P)})});var li=TypeError,fi=function(C){return function(L,P,f,m){J(P);var S=dn(L),k=Os(S),B=Ia(S),G=C?B-1:0,Z=C?-1:1;if(f<2)for(;;){if(G in k){m=k[G],G+=Z;break}if(G+=Z,C?G<0:B<=G)throw li("Reduce of empty array with no initial value")}for(;C?G>=0:B>G;G+=Z)G in k&&(m=P(m,k[G],G,S));return m}},Pa={left:fi(!1),right:fi(!0)},Yo=Pa.left,zi=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("reduce",function(C){var L=arguments.length;return Yo(zi(this),C,L,L>1?arguments[1]:void 0)});var Us=Pa.right,ao=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("reduceRight",function(C){var L=arguments.length;return Us(ao(this),C,L,L>1?arguments[1]:void 0)});var ms=oi.aTypedArray,as=oi.exportTypedArrayMethod,Vs=Math.floor;as("reverse",function(){for(var C,L=ms(this).length,P=Vs(L/2),f=0;f<P;)C=this[f],this[f++]=this[--L],this[L]=C;return this});var Gs=ue.RangeError,Ms=ue.Int8Array,wo=Ms&&Ms.prototype,Si=wo&&wo.set,gs=oi.aTypedArray,ga=oi.exportTypedArrayMethod,No=!ve(function(){var C=new Uint8ClampedArray(2);return Xi(Si,C,{length:1,0:3},1),C[1]!==3}),Jn=No&&oi.NATIVE_ARRAY_BUFFER_VIEWS&&ve(function(){var C=new Ms(2);return C.set(1),C.set("2",1),C[0]!==0||C[1]!==2});ga("set",function(C){gs(this);var L=la(arguments.length>1?arguments[1]:void 0,1),P=dn(C);if(No)return Xi(Si,this,P,L);var f=this.length,m=Ia(P),S=0;if(m+L>f)throw Gs("Wrong length");for(;S<m;)this[L+S]=P[S++]},!No||Jn);var Ui=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("slice",function(C,L){for(var P=Xl(Ui(this),C,L),f=uh(this),m=0,S=P.length,k=new f(S);S>m;)k[m]=P[m++];return k},ve(function(){new Int8Array(1).slice()}));var $a=F.some,ys=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("some",function(C){return $a(ys(this),C,arguments.length>1?arguments[1]:void 0)});var Pl=Math.floor,Oe=function(C,L){var P=C.length,f=Pl(P/2);return P<8?Mt(C,L):yt(C,Oe(ll(C,0,f),L),Oe(ll(C,f),L),L)},Mt=function(C,L){for(var P,f,m=C.length,S=1;S<m;){for(f=S,P=C[S];f&&L(C[f-1],P)>0;)C[f]=C[--f];f!==S++&&(C[f]=P)}return C},yt=function(C,L,P,f){for(var m=L.length,S=P.length,k=0,B=0;k<m||B<S;)C[k+B]=k<m&&B<S?f(L[k],P[B])<=0?L[k++]:P[B++]:k<m?L[k++]:P[B++];return C},gn=Oe,Vi=Me.match(/firefox\/(\d+)/i),Te=!!Vi&&+Vi[1],pe=/MSIE|Trident/.test(Me),He=Me.match(/AppleWebKit\/(\d+)\./),ct=!!He&&+He[1],Tt=oi.aTypedArray,rt=oi.exportTypedArrayMethod,Ye=ue.Uint16Array,nt=Ye&&gt(Ye.prototype.sort),de=!(!nt||ve(function(){nt(new Ye(2),null)})&&ve(function(){nt(new Ye(2),{})})),$e=!!nt&&!ve(function(){if(_r)return _r<74;if(Te)return Te<67;if(pe)return!0;if(ct)return ct<602;var C,L,P=new Ye(516),f=Array(516);for(C=0;C<516;C++)L=C%4,P[C]=515-C,f[C]=C-2*L+3;for(nt(P,function(m,S){return(m/4|0)-(S/4|0)}),C=0;C<516;C++)if(P[C]!==f[C])return!0});rt("sort",function(C){return C!==void 0&&J(C),$e?nt(this,C):gn(Tt(this),function(L){return function(P,f){return L!==void 0?+L(P,f)||0:f!=f?-1:P!=P?1:P===0&&f===0?1/P>0&&1/f<0?1:-1:P>f}}(C))},!$e||de);var Le=oi.aTypedArray;(0,oi.exportTypedArrayMethod)("subarray",function(C,L){var P=Le(this),f=P.length,m=Ma(C,f);return new(uh(P))(P.buffer,P.byteOffset+m*P.BYTES_PER_ELEMENT,ko((L===void 0?f:Ma(L,f))-m))});var ut=ue.Int8Array,_t=oi.aTypedArray,lr=oi.exportTypedArrayMethod,Hr=[].toLocaleString,$r=!!ut&&ve(function(){Hr.call(new ut(1))});lr("toLocaleString",function(){return bu(Hr,$r?Xl(_t(this)):_t(this),Xl(arguments))},ve(function(){return[1,2].toLocaleString()!=new ut([1,2]).toLocaleString()})||!ve(function(){ut.prototype.toLocaleString.call([1,2])}));var fn=oi.exportTypedArrayMethod,Gr=ue.Uint8Array,Ln=Gr&&Gr.prototype||{},hn=[].toString,Sn=gt([].join);ve(function(){hn.call({})})&&(hn=function(){return Sn(this)});var An=Ln.toString!=hn;fn("toString",hn,An);var Tn,ei,wa=String,ya=function(C){if(yo(C)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return wa(C)},hl=function(){var C=Ki(this),L="";return C.hasIndices&&(L+="d"),C.global&&(L+="g"),C.ignoreCase&&(L+="i"),C.multiline&&(L+="m"),C.dotAll&&(L+="s"),C.unicode&&(L+="u"),C.unicodeSets&&(L+="v"),C.sticky&&(L+="y"),L},bc=ue.RegExp,za=ve(function(){var C=bc("a","y");return C.lastIndex=2,C.exec("abcd")!=null}),ea=za||ve(function(){return!bc("a","y").sticky}),Jc={BROKEN_CARET:za||ve(function(){var C=bc("^r","gy");return C.lastIndex=2,C.exec("str")!=null}),MISSED_STICKY:ea,UNSUPPORTED_Y:za},nc=ue.RegExp,Sd=ve(function(){var C=nc(".","s");return!(C.dotAll&&C.exec(`
`)&&C.flags==="s")}),ic=ue.RegExp,e0=ve(function(){var C=ic("(?<a>b)","g");return C.exec("b").groups.a!=="b"||"b".replace(C,"$<a>c")!=="bc"}),Om=pa.get,wd=je("native-string-replace",String.prototype.replace),zh=RegExp.prototype.exec,O0=zh,Is=gt("".charAt),t0=gt("".indexOf),xp=gt("".replace),Ad=gt("".slice),ov=(ei=/b*/g,Xi(zh,Tn=/a/,"a"),Xi(zh,ei,"a"),Tn.lastIndex!==0||ei.lastIndex!==0),Td=Jc.BROKEN_CARET,Xp=/()??/.exec("")[1]!==void 0;(ov||Xp||Td||Sd||e0)&&(O0=function(C){var L,P,f,m,S,k,B,G=this,Z=Om(G),ee=ya(C),_e=Z.raw;if(_e)return _e.lastIndex=G.lastIndex,L=Xi(O0,_e,ee),G.lastIndex=_e.lastIndex,L;var Ge=Z.groups,Xe=Td&&G.sticky,it=Xi(hl,G),bt=G.source,kt=0,Xt=ee;if(Xe&&(it=xp(it,"y",""),t0(it,"g")===-1&&(it+="g"),Xt=Ad(ee,G.lastIndex),G.lastIndex>0&&(!G.multiline||G.multiline&&Is(ee,G.lastIndex-1)!==`
`)&&(bt="(?: "+bt+")",Xt=" "+Xt,kt++),P=new RegExp("^(?:"+bt+")",it)),Xp&&(P=new RegExp("^"+bt+"$(?!\\s)",it)),ov&&(f=G.lastIndex),m=Xi(zh,Xe?P:G,Xt),Xe?m?(m.input=Ad(m.input,kt),m[0]=Ad(m[0],kt),m.index=G.lastIndex,G.lastIndex+=m[0].length):G.lastIndex=0:ov&&m&&(G.lastIndex=G.global?m.index+m[0].length:f),Xp&&m&&m.length>1&&Xi(wd,m[0],P,function(){for(S=1;S<arguments.length-2;S++)arguments[S]===void 0&&(m[S]=void 0)}),m&&Ge)for(m.groups=k=jn(null),S=0;S<Ge.length;S++)k[(B=Ge[S])[0]]=m[B[1]];return m});var Pf=O0;Yi({target:"RegExp",proto:!0,forced:/./.exec!==Pf},{exec:Pf});var lh,Zg=st("species"),Pm=RegExp.prototype,js=function(C,L,P,f){var m=st(C),S=!ve(function(){var Z={};return Z[m]=function(){return 7},""[C](Z)!=7}),k=S&&!ve(function(){var Z=!1,ee=/a/;return C==="split"&&((ee={}).constructor={},ee.constructor[Zg]=function(){return ee},ee.flags="",ee[m]=/./[m]),ee.exec=function(){return Z=!0,null},ee[m](""),!Z});if(!S||!k||P){var B=gt(/./[m]),G=L(m,""[C],function(Z,ee,_e,Ge,Xe){var it=gt(Z),bt=ee.exec;return bt===Pf||bt===Pm.exec?S&&!Xe?{done:!0,value:B(ee,_e,Ge)}:{done:!0,value:it(_e,ee,Ge)}:{done:!1}});da(String.prototype,C,G[0]),da(Pm,m,G[1])}f&&ci(Pm[m],"sham",!0)},Zp=gt("".charAt),Fm=gt("".charCodeAt),s=gt("".slice),u=function(C){return function(L,P){var f,m,S=ya(Er(L)),k=Tr(P),B=S.length;return k<0||k>=B?C?"":void 0:(f=Fm(S,k))<55296||f>56319||k+1===B||(m=Fm(S,k+1))<56320||m>57343?C?Zp(S,k):f:C?s(S,k,k+2):m-56320+(f-55296<<10)+65536}},h={codeAt:u(!1),charAt:u(!0)},_=h.charAt,E=function(C,L,P){return L+(P?_(C,L).length:1)},A=Math.floor,I=gt("".charAt),D=gt("".replace),V=gt("".slice),$=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,q=/\$([$&'`]|\d{1,2})/g,te=function(C,L,P,f,m,S){var k=P+C.length,B=f.length,G=q;return m!==void 0&&(m=dn(m),G=$),D(S,G,function(Z,ee){var _e;switch(I(ee,0)){case"$":return"$";case"&":return C;case"`":return V(L,0,P);case"'":return V(L,k);case"<":_e=m[V(ee,1,-1)];break;default:var Ge=+ee;if(Ge===0)return Z;if(Ge>B){var Xe=A(Ge/10);return Xe===0?Z:Xe<=B?f[Xe-1]===void 0?I(ee,1):f[Xe-1]+I(ee,1):Z}_e=f[Ge-1]}return _e===void 0?"":_e})},oe=TypeError,fe=function(C,L){var P=C.exec;if(Dr(P)){var f=Xi(P,C,L);return f!==null&&Ki(f),f}if(ki(C)==="RegExp")return Xi(Pf,C,L);throw oe("RegExp#exec called on incompatible receiver")},Pe=st("replace"),De=Math.max,tt=Math.min,We=gt([].concat),lt=gt([].push),xt=gt("".indexOf),Lt=gt("".slice),Pt="a".replace(/./,"$0")==="$0",nr=!!/./[Pe]&&/./[Pe]("a","$0")==="";function Fr(C){this.message=C}js("replace",function(C,L,P){var f=nr?"$":"$0";return[function(m,S){var k=Er(this),B=m==null?void 0:ae(m,Pe);return B?Xi(B,m,k,S):Xi(L,ya(k),m,S)},function(m,S){var k=Ki(this),B=ya(m);if(typeof S=="string"&&xt(S,f)===-1&&xt(S,"$<")===-1){var G=P(L,k,B,S);if(G.done)return G.value}var Z=Dr(S);Z||(S=ya(S));var ee=k.global;if(ee){var _e=k.unicode;k.lastIndex=0}for(var Ge=[];;){var Xe=fe(k,B);if(Xe===null||(lt(Ge,Xe),!ee))break;ya(Xe[0])===""&&(k.lastIndex=E(B,ko(k.lastIndex),_e))}for(var it,bt="",kt=0,Xt=0;Xt<Ge.length;Xt++){for(var Ht=ya((Xe=Ge[Xt])[0]),ir=De(tt(Tr(Xe.index),B.length),0),Ur=[],qn=1;qn<Xe.length;qn++)lt(Ur,(it=Xe[qn])===void 0?it:String(it));var Ri=Xe.groups;if(Z){var Ai=We([Ht],Ur,ir,B);Ri!==void 0&&lt(Ai,Ri);var Oi=ya(bu(S,void 0,Ai))}else Oi=te(Ht,B,ir,Ur,Ri,S);ir>=kt&&(bt+=Lt(B,kt,ir)+Oi,kt=ir+Ht.length)}return bt+Lt(B,kt)}]},!!ve(function(){var C=/./;return C.exec=function(){var L=[];return L.groups={a:"7"},L},"".replace(C,"$<a>")!=="7"})||!Pt||nr),Fr.prototype=new Error,Fr.prototype.name="InvalidCharacterError",Yi({global:!0},{globalThis:ue}),lh=typeof window>"u"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(C){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(C){return null},clearMeasures:function(C){return null},clearMarks:function(C){return null},measure:function(C,L,P){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(C){return!0},Event:function(C,L){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:lh.devicePixelRatio;var tn=TypeError,Vn=function(C){if(C>9007199254740991)throw tn("Maximum allowed index exceeded");return C},vn=Fe("splice"),$n=Math.max,yn=Math.min;Yi({target:"Array",proto:!0,forced:!vn},{splice:function(C,L){var P,f,m,S,k,B,G=dn(this),Z=Ia(G),ee=Ma(C,Z),_e=arguments.length;for(_e===0?P=f=0:_e===1?(P=0,f=Z-ee):(P=_e-2,f=yn($n(Tr(L),0),Z-ee)),Vn(Z+P-f),m=x(G,f),S=0;S<f;S++)(k=ee+S)in G&&xe(m,S,G[k]);if(m.length=f,P<f){for(S=ee;S<Z-f;S++)B=S+P,(k=S+f)in G?G[B]=G[k]:Cd(G,B);for(S=Z;S>Z-f+P;S--)Cd(G,S-1)}else if(P>f)for(S=Z-f;S>ee;S--)B=S+P-1,(k=S+f-1)in G?G[B]=G[k]:Cd(G,B);for(S=0;S<P;S++)G[S+ee]=arguments[S+2];return G.length=Z-f+P,m}}),l(function C(L,P){a(this,C),c(this,"cancelBubble",void 0),c(this,"cancelable",void 0),c(this,"target",void 0),c(this,"currentTarget",void 0),c(this,"preventDefault",void 0),c(this,"stopPropagation",void 0),c(this,"type",void 0),c(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=L,this.timeStamp=Date.now()});var _i=Object.assign,ii=Object.defineProperty,Pn=gt([].concat),Gi=!_i||ve(function(){if(fr&&_i({b:1},_i(ii({},"a",{enumerable:!0,get:function(){ii(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var C={},L={},P=Symbol();return C[P]=7,"abcdefghijklmnopqrst".split("").forEach(function(f){L[f]=f}),_i({},C)[P]!=7||Dn(_i({},L)).join("")!="abcdefghijklmnopqrst"})?function(C,L){for(var P=dn(C),f=arguments.length,m=1,S=yu.f,k=Rc.f;f>m;)for(var B,G=Os(arguments[m++]),Z=S?Pn(Dn(G),S(G)):Dn(G),ee=Z.length,_e=0;ee>_e;)B=Z[_e++],fr&&!Xi(k,G,B)||(P[B]=G[B]);return P}:_i;Yi({target:"Object",stat:!0,arity:2,forced:Object.assign!==Gi},{assign:Gi});var wi=F.findIndex,aa=!0;"findIndex"in[]&&Array(1).findIndex(function(){aa=!1}),Yi({target:"Array",proto:!0,forced:aa},{findIndex:function(C){return wi(this,C,arguments.length>1?arguments[1]:void 0)}}),So("findIndex");var Yn=h.charAt,Ea=pa.set,Ao=pa.getterFor("String Iterator");Zo(String,"String",function(C){Ea(this,{type:"String Iterator",string:ya(C),index:0})},function(){var C,L=Ao(this),P=L.string,f=L.index;return f>=P.length?{value:void 0,done:!0}:(C=Yn(P,f),L.index+=C.length,{value:C,done:!1})});var Eo=Ku.f,fo=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],To={f:function(C){return fo&&ki(C)=="Window"?function(L){try{return Eo(L)}catch{return ll(fo)}}(C):Eo(Ha(C))}},qo=ve(function(){if(typeof ArrayBuffer=="function"){var C=new ArrayBuffer(8);Object.isExtensible(C)&&Object.defineProperty(C,"a",{value:8})}}),Ko=Object.isExtensible,Mo=ve(function(){Ko(1)})||qo?function(C){return!!nn(C)&&(!qo||ki(C)!="ArrayBuffer")&&(!Ko||Ko(C))}:Ko,$u=!ve(function(){return Object.isExtensible(Object.preventExtensions({}))}),zo=ie(function(C){var L=Jt.f,P=!1,f=hr("meta"),m=0,S=function(B){L(B,f,{value:{objectID:"O"+m++,weakData:{}}})},k=C.exports={enable:function(){k.enable=function(){},P=!0;var B=Ku.f,G=gt([].splice),Z={};Z[f]=1,B(Z).length&&(Ku.f=function(ee){for(var _e=B(ee),Ge=0,Xe=_e.length;Ge<Xe;Ge++)if(_e[Ge]===f){G(_e,Ge,1);break}return _e},Yi({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:To.f}))},fastKey:function(B,G){if(!nn(B))return typeof B=="symbol"?B:(typeof B=="string"?"S":"P")+B;if(!Ar(B,f)){if(!Mo(B))return"F";if(!G)return"E";S(B)}return B[f].objectID},getWeakData:function(B,G){if(!Ar(B,f)){if(!Mo(B))return!0;if(!G)return!1;S(B)}return B[f].weakData},onFreeze:function(B){return $u&&P&&Mo(B)&&!Ar(B,f)&&S(B),B}};Di[f]=!0}),ku=(zo.enable,zo.fastKey,zo.getWeakData,zo.onFreeze,function(C,L,P){var f=C.indexOf("Map")!==-1,m=C.indexOf("Weak")!==-1,S=f?"set":"add",k=ue[C],B=k&&k.prototype,G=k,Z={},ee=function(kt){var Xt=gt(B[kt]);da(B,kt,kt=="add"?function(Ht){return Xt(this,Ht===0?0:Ht),this}:kt=="delete"?function(Ht){return!(m&&!nn(Ht))&&Xt(this,Ht===0?0:Ht)}:kt=="get"?function(Ht){return m&&!nn(Ht)?void 0:Xt(this,Ht===0?0:Ht)}:kt=="has"?function(Ht){return!(m&&!nn(Ht))&&Xt(this,Ht===0?0:Ht)}:function(Ht,ir){return Xt(this,Ht===0?0:Ht,ir),this})};if(_u(C,!Dr(k)||!(m||B.forEach&&!ve(function(){new k().entries().next()}))))G=P.getConstructor(L,C,f,S),zo.enable();else if(_u(C,!0)){var _e=new G,Ge=_e[S](m?{}:-0,1)!=_e,Xe=ve(function(){_e.has(1)}),it=is(function(kt){new k(kt)}),bt=!m&&ve(function(){for(var kt=new k,Xt=5;Xt--;)kt[S](Xt,Xt);return!kt.has(-0)});it||((G=L(function(kt,Xt){Xs(kt,B);var Ht=Ed(new k,kt,G);return Xt!=null&&kn(Xt,Ht[S],{that:Ht,AS_ENTRIES:f}),Ht})).prototype=B,B.constructor=G),(Xe||bt)&&(ee("delete"),ee("has"),f&&ee("get")),(bt||Ge)&&ee(S),m&&B.clear&&delete B.clear}return Z[C]=G,Yi({global:!0,constructor:!0,forced:G!=k},Z),Po(G,C),m||P.setStrong(G,C,f),G}),Uo=zo.getWeakData,tu=pa.set,ra=pa.getterFor,Qa=F.find,Ua=F.findIndex,ha=gt([].splice),pl=0,Hs=function(C){return C.frozen||(C.frozen=new ho)},ho=function(){this.entries=[]},Fa=function(C,L){return Qa(C.entries,function(P){return P[0]===L})};ho.prototype={get:function(C){var L=Fa(this,C);if(L)return L[1]},has:function(C){return!!Fa(this,C)},set:function(C,L){var P=Fa(this,C);P?P[1]=L:this.entries.push([C,L])},delete:function(C){var L=Ua(this.entries,function(P){return P[0]===C});return~L&&ha(this.entries,L,1),!!~L}};var Ls,_a={getConstructor:function(C,L,P,f){var m=C(function(G,Z){Xs(G,S),tu(G,{type:L,id:pl++,frozen:void 0}),Z!=null&&kn(Z,G[f],{that:G,AS_ENTRIES:P})}),S=m.prototype,k=ra(L),B=function(G,Z,ee){var _e=k(G),Ge=Uo(Ki(Z),!0);return Ge===!0?Hs(_e).set(Z,ee):Ge[_e.id]=ee,G};return Kc(S,{delete:function(G){var Z=k(this);if(!nn(G))return!1;var ee=Uo(G);return ee===!0?Hs(Z).delete(G):ee&&Ar(ee,Z.id)&&delete ee[Z.id]},has:function(G){var Z=k(this);if(!nn(G))return!1;var ee=Uo(G);return ee===!0?Hs(Z).has(G):ee&&Ar(ee,Z.id)}}),Kc(S,P?{get:function(G){var Z=k(this);if(nn(G)){var ee=Uo(G);return ee===!0?Hs(Z).get(G):ee?ee[Z.id]:void 0}},set:function(G,Z){return B(this,G,Z)}}:{add:function(G){return B(this,G,!0)}}),m}},Ru=pa.enforce,xi=!ue.ActiveXObject&&"ActiveXObject"in ue,ch=function(C){return function(){return C(this,arguments.length?arguments[0]:void 0)}},Aa=ku("WeakMap",ch,_a);if(Jr&&xi){Ls=_a.getConstructor(ch,"WeakMap",!0),zo.enable();var Xa=Aa.prototype,ef=gt(Xa.delete),Fl=gt(Xa.has),Yp=gt(Xa.get),Md=gt(Xa.set);Kc(Xa,{delete:function(C){if(nn(C)&&!Mo(C)){var L=Ru(this);return L.frozen||(L.frozen=new Ls),ef(this,C)||L.frozen.delete(C)}return ef(this,C)},has:function(C){if(nn(C)&&!Mo(C)){var L=Ru(this);return L.frozen||(L.frozen=new Ls),Fl(this,C)||L.frozen.has(C)}return Fl(this,C)},get:function(C){if(nn(C)&&!Mo(C)){var L=Ru(this);return L.frozen||(L.frozen=new Ls),Fl(this,C)?Yp(this,C):L.frozen.get(C)}return Yp(this,C)},set:function(C,L){if(nn(C)&&!Mo(C)){var P=Ru(this);P.frozen||(P.frozen=new Ls),Fl(this,C)?Md(this,C,L):P.frozen.set(C,L)}else Md(this,C,L);return this}})}var fh=st("iterator"),Id=st("toStringTag"),sv=Bi.values,bp=function(C,L){if(C){if(C[fh]!==sv)try{ci(C,fh,sv)}catch{C[fh]=sv}if(C[Id]||ci(C,Id,L),Oh[L]){for(var P in Bi)if(C[P]!==Bi[P])try{ci(C,P,Bi[P])}catch{C[P]=Bi[P]}}}};for(var Ld in Oh)bp(ue[Ld]&&ue[Ld].prototype,Ld);bp(rl,"DOMTokenList");var Ec,kd,Cc,Io,po=new WeakMap,Uh=function(){function C(){a(this,C),po.set(this,{})}return l(C,[{key:"addEventListener",value:function(L,P){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=po.get(this);m||(m={}),m[L]||(m[L]=[]),m[L].push(P),po.set(this,m),f.capture,f.once,f.passive}},{key:"removeEventListener",value:function(L,P){var f=po.get(this);if(f){var m=f[L];if(m&&m.length>0){for(var S=m.length;S--;S>0)if(m[S]===P){m.splice(S,1);break}}}}},{key:"dispatchEvent",value:function(L){var P=po.get(this)[L.type];if(P){var f,m=function(S,k){var B=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(!B){if(Array.isArray(S)||(B=j(S))||k&&S&&typeof S.length=="number"){B&&(S=B);var G=0,Z=function(){};return{s:Z,n:function(){return G>=S.length?{done:!0}:{done:!1,value:S[G++]}},e:function(Xe){throw Xe},f:Z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ee,_e=!0,Ge=!1;return{s:function(){B=B.call(S)},n:function(){var Xe=B.next();return _e=Xe.done,Xe},e:function(Xe){Ge=!0,ee=Xe},f:function(){try{_e||B.return==null||B.return()}finally{if(Ge)throw ee}}}}(P);try{for(m.s();!(f=m.n()).done;)(0,f.value)(L)}catch(S){m.e(S)}finally{m.f()}}}}]),C}(),uv=function(C){p(P,C);var L=O(P);function P(){var f;return a(this,P),c(w(f=L.call(this)),"className",void 0),c(w(f),"children",void 0),f.className="",f.children=[],f}return l(P,[{key:"setAttribute",value:function(f,m){this[f]=m}},{key:"getAttribute",value:function(f){return this[f]}},{key:"setAttributeNS",value:function(f,m){this[f]=m}},{key:"getAttributeNS",value:function(f){return this[f]}}]),P}(function(C){p(P,C);var L=O(P);function P(){var f;return a(this,P),c(w(f=L.call(this)),"childNodes",void 0),f.childNodes=[],f}return l(P,[{key:"appendChild",value:function(f){this.childNodes.push(f)}},{key:"cloneNode",value:function(){var f=Object.create(this);return Object.assign(f,this),f}},{key:"removeChild",value:function(f){var m=this.childNodes.findIndex(function(S){return S===f});return m>-1?this.childNodes.splice(m,1):null}}]),P}(Uh));if(typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Rd=my.getSystemInfoSync();Ec=Rd.screenWidth,kd=Rd.screenHeight,Cc=Rd.windowWidth,Io=Rd.windowHeight}else{var r0=lh.innerWidth,lv=lh.innerHeight;Ec=r0,kd=lv,Cc=r0,Io=lv}var cv={width:Ec,height:kd,availWidth:Cc,availHeight:Io,availLeft:0,availTop:0},Od=cv.availWidth,Ep=cv.availHeight,Vh={style:[]};function qp(C,L){var P,f;"parentNode"in C||(P=L===0?function(){return null}:L===1?function(){return Vh}:function(){return null},Object.defineProperty(C,"parentNode",{enumerable:!0,get:P})),"parentElement"in C||(f=L===0?function(){return null}:L===1?function(){return Vh}:function(){return null},Object.defineProperty(C,"parentElement",{enumerable:!0,get:f}))}function P0(C){C.style=C.style||{},Object.assign(C.style,{top:"0px",left:"0px",width:Od+"px",height:Ep+"px",margin:"0px",padding:"0px"})}function Pd(C){"clientLeft"in C||(C.clientLeft=0,C.clientTop=0),"clientWidth"in C||(C.clientWidth=Od,C.clientHeight=Ep),"getBoundingClientRect"in C||(C.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Fd(C){"offsetLeft"in C||(C.offsetLeft=0,C.offsetTop=0),"offsetWidth"in C||(C.offsetWidth=Od,C.offsetHeight=Ep)}function Xu(C){"scrollLeft"in C||(C.scrollLeft=0,C.scrollTop=0),"scrollWidth"in C||(C.scrollWidth=Od,C.scrollHeight=Ep)}function hh(C){var L=function(){return!0};C.classList=[],C.classList.add=L,C.classList.remove=L,C.classList.contains=L,C.classList.toggle=L}function Ff(){}var Kp=function(C){p(P,C);var L=O(P);function P(){var f,m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",S=arguments.length>1?arguments[1]:void 0;return a(this,P),c(w(f=L.call(this)),"className",void 0),c(w(f),"children",void 0),c(w(f),"focus",void 0),c(w(f),"blur",void 0),c(w(f),"insertBefore",void 0),c(w(f),"appendChild",void 0),c(w(f),"removeChild",void 0),c(w(f),"remove",void 0),c(w(f),"innerHTML",void 0),c(w(f),"tagName",void 0),f.className="",f.children=[],f.focus=Ff,f.blur=Ff,f.insertBefore=Ff,f.appendChild=Ff,f.removeChild=Ff,f.remove=Ff,f.innerHTML="",f.tagName=m.toUpperCase(),qp(w(f),S),P0(w(f)),hh(w(f)),Pd(w(f)),Fd(w(f)),Xu(w(f)),f}return l(P)}(uv);(function(C){p(P,C);var L=O(P);function P(){return a(this,P),L.call(this,"video")}return l(P)})(function(C){p(P,C);var L=O(P);function P(f){return a(this,P),L.call(this,f)}return l(P,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),P}(Kp));var fv={};function Dm(){return fv}l(function C(){a(this,C);var L=Dm(),P=L.createImage&&L.createImage()||{};return"tagName"in P||(P.tagName="IMG",P.__proto__=C.prototype),qp(P),hh(P),Object.assign(P,{addEventListener:function(f,m){P["on".concat(f)]=m.bind(P)},removeEventListener:function(f){P["on".concat(f)]=null}}),P});var Yg=function(C){p(P,C);var L=O(P);function P(){return a(this,P),L.call(this,"body",0)}return l(P,[{key:"addEventListener",value:function(f,m){}},{key:"removeEventListener",value:function(f,m,S){}},{key:"dispatchEvent",value:function(f){}}]),P}(Kp),F0=function(C){p(P,C);var L=O(P);function P(){return a(this,P),L.call(this,"html",0)}return l(P,[{key:"addEventListener",value:function(f,m){}},{key:"removeEventListener",value:function(f,m){}},{key:"dispatchEvent",value:function(f){}}]),P}(Kp);new F0,new Kp("head"),new Yg,js("match",function(C,L,P){return[function(f){var m=Er(this),S=f==null?void 0:ae(f,C);return S?Xi(S,f,m):new RegExp(f)[C](ya(m))},function(f){var m=Ki(this),S=ya(f),k=P(L,m,S);if(k.done)return k.value;if(!m.global)return fe(m,S);var B=m.unicode;m.lastIndex=0;for(var G,Z=[],ee=0;(G=fe(m,S))!==null;){var _e=ya(G[0]);Z[ee]=_e,_e===""&&(m.lastIndex=E(S,ko(m.lastIndex),B)),ee++}return ee===0?null:Z}]});var Df,vi,Bm=st("isConcatSpreadable"),Dl=_r>=51||!ve(function(){var C=[];return C[Bm]=!1,C.concat()[0]!==C}),rs=Fe("concat"),ph=function(C){if(!nn(C))return!1;var L=C[Bm];return L!==void 0?!!L:d(C)};if(Yi({target:"Array",proto:!0,arity:1,forced:!Dl||!rs},{concat:function(C){var L,P,f,m,S,k=dn(this),B=x(k,0),G=0;for(L=-1,f=arguments.length;L<f;L++)if(ph(S=L===-1?k:arguments[L]))for(m=Ia(S),Vn(G+m),P=0;P<m;P++,G++)P in S&&xe(B,G,S[P]);else Vn(G+1),xe(B,G++,S);return B.length=G,B}}),typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var oo=my.getSystemInfoSync();Df=oo.system,oo.platform,oo.language}else{var pu={versions:(vi=lh.navigator.userAgent,{trident:vi.indexOf("Trident")>-1,presto:vi.indexOf("Presto")>-1,webKit:vi.indexOf("AppleWebKit")>-1,gecko:vi.indexOf("Gecko")>-1&&vi.indexOf("KHTML")===-1,mobile:!!vi.match(/AppleWebKit.*Mobile.*/),ios:!!vi.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:vi.indexOf("Android")>-1||vi.indexOf("Linux")>-1,iPhone:vi.indexOf("iPhone")>-1,iPad:vi.indexOf("iPad")>-1,webApp:vi.indexOf("Safari")===-1,weixin:vi.indexOf("MicroMessenger")>-1,qq:vi.match(/\sQQ/i)===" qq"}),language:(lh.navigator.browserLanguage||lh.navigator.language).toLowerCase()};pu.versions.android||pu.versions.trident||pu.versions.presto||pu.versions.webKit||pu.versions.gecko||pu.versions.mobile||pu.versions.ios||pu.versions.iPhone||pu.versions.iPad||pu.versions.webApp||pu.versions.weixin||pu.versions.qq,Df=lh.navigator.userAgent,pu.language}Df.toLowerCase().indexOf("android"),Kv("Uint8",function(C){return function(L,P,f){return C(this,L,P,f)}});var D0=Jt.f,hv=zo.fastKey,n0=pa.set,Bf=pa.getterFor;ku("Map",function(C){return function(){return C(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(C,L,P,f){var m=C(function(Z,ee){Xs(Z,S),n0(Z,{type:L,index:jn(null),first:void 0,last:void 0,size:0}),fr||(Z.size=0),ee!=null&&kn(ee,Z[f],{that:Z,AS_ENTRIES:P})}),S=m.prototype,k=Bf(L),B=function(Z,ee,_e){var Ge,Xe,it=k(Z),bt=G(Z,ee);return bt?bt.value=_e:(it.last=bt={index:Xe=hv(ee,!0),key:ee,value:_e,previous:Ge=it.last,next:void 0,removed:!1},it.first||(it.first=bt),Ge&&(Ge.next=bt),fr?it.size++:Z.size++,Xe!=="F"&&(it.index[Xe]=bt)),Z},G=function(Z,ee){var _e,Ge=k(Z),Xe=hv(ee);if(Xe!=="F")return Ge.index[Xe];for(_e=Ge.first;_e;_e=_e.next)if(_e.key==ee)return _e};return Kc(S,{clear:function(){for(var Z=k(this),ee=Z.index,_e=Z.first;_e;)_e.removed=!0,_e.previous&&(_e.previous=_e.previous.next=void 0),delete ee[_e.index],_e=_e.next;Z.first=Z.last=void 0,fr?Z.size=0:this.size=0},delete:function(Z){var ee=k(this),_e=G(this,Z);if(_e){var Ge=_e.next,Xe=_e.previous;delete ee.index[_e.index],_e.removed=!0,Xe&&(Xe.next=Ge),Ge&&(Ge.previous=Xe),ee.first==_e&&(ee.first=Ge),ee.last==_e&&(ee.last=Xe),fr?ee.size--:this.size--}return!!_e},forEach:function(Z){for(var ee,_e=k(this),Ge=Ys(Z,arguments.length>1?arguments[1]:void 0);ee=ee?ee.next:_e.first;)for(Ge(ee.value,ee.key,this);ee&&ee.removed;)ee=ee.previous},has:function(Z){return!!G(this,Z)}}),Kc(S,P?{get:function(Z){var ee=G(this,Z);return ee&&ee.value},set:function(Z,ee){return B(this,Z===0?0:Z,ee)}}:{add:function(Z){return B(this,Z=Z===0?0:Z,Z)}}),fr&&D0(S,"size",{get:function(){return k(this).size}}),m},setStrong:function(C,L,P){var f=L+" Iterator",m=Bf(L),S=Bf(f);Zo(C,L,function(k,B){n0(this,{type:f,target:k,state:m(k),kind:B,last:void 0})},function(){for(var k=S(this),B=k.kind,G=k.last;G&&G.removed;)G=G.previous;return k.target&&(k.last=G=G?G.next:k.state.first)?B=="keys"?{value:G.key,done:!1}:B=="values"?{value:G.value,done:!1}:{value:[G.key,G.value],done:!1}:(k.target=void 0,{value:void 0,done:!0})},P?"entries":"values",!P,!0),Fs(L)}});var B0=gt([].join),i0=Os!=Object,N0=U("join",",");Yi({target:"Array",proto:!0,forced:i0||!N0},{join:function(C){return B0(Ha(this),C===void 0?",":C)}});var z0=ve(function(){Dn(1)});Yi({target:"Object",stat:!0,forced:z0},{keys:function(C){return Dn(dn(C))}});var a0=new Map,Nm=new Map,o0=new Map,dh=function(C){p(P,C);var L=O(P);function P(){var f;return a(this,P),c(w(f=L.call(this)),"onabort",void 0),c(w(f),"onerror",void 0),c(w(f),"onload",void 0),c(w(f),"onloadstart",void 0),c(w(f),"onprogress",void 0),c(w(f),"ontimeout",void 0),c(w(f),"onloadend",void 0),c(w(f),"onreadystatechange",void 0),c(w(f),"readyState",void 0),c(w(f),"response",void 0),c(w(f),"responseText",void 0),c(w(f),"_responseType",void 0),c(w(f),"responseXML",void 0),c(w(f),"status",void 0),c(w(f),"statusText",void 0),c(w(f),"upload",void 0),c(w(f),"withCredentials",void 0),c(w(f),"timeout",void 0),c(w(f),"_url",void 0),c(w(f),"_method",void 0),f.onabort=null,f.onerror=null,f.onload=null,f.onloadstart=null,f.onprogress=null,f.ontimeout=null,f.onloadend=null,f.onreadystatechange=null,f.readyState=0,f.response=null,f.responseText=null,f._responseType="text",f.responseXML=null,f.status=0,f.statusText="",f.upload={},f.withCredentials=!1,a0.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),f}return l(P,[{key:"responseType",set:function(f){this._responseType=f}},{key:"abort",value:function(){var f=o0.get("requestTask");f&&f.abort()}},{key:"getAllResponseHeaders",value:function(){var f=Nm.get("responseHeader");return Object.keys(f).map(function(m){return"".concat(m,": ").concat(f[m])}).join(`
`)}},{key:"getResponseHeader",value:function(f){return Nm.get("responseHeader")[f]}},{key:"open",value:function(f,m,S){this._method=f,this._url=m}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(f,m){var S=a0.get("requestHeader");S[f]=m,a0.set("requestHeader",S)}},{key:"addEventListener",value:function(f,m){var S=this;typeof m=="function"&&(this["on"+f]=function(){var k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};k.target=k.target||S,m.call(S,k)})}},{key:"removeEventListener",value:function(f,m){this["on"+f]===m&&(this["on"+f]=null)}}]),P}(Uh);c(dh,"UNSEND",void 0),c(dh,"OPENED",void 0),c(dh,"HEADERS_RECEIVED",void 0),c(dh,"LOADING",void 0),c(dh,"DONE",void 0),dh.UNSEND=0,dh.OPENED=1,dh.HEADERS_RECEIVED=2,dh.LOADING=3,dh.DONE=4;var qg=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Kg=typeof wx<"u"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),zm=qg||Kg;zm||lh.XMLHttpRequest,zm||lh.location;function pv(C){return[C+1&255,C+1>>8&255,C+1>>8>>8&255]}var Sc=F.filter,dv=Fe("filter");function U0(C,L){var P=C.color;return P&&P.length?P:[1,1,1,1]}function Nf(C,L,P){return P.length===2?[P[0],P[1],0]:[P[0],P[1],P[2]]}function Um(C,L){return C.filter?[1]:[0]}function ru(C,L,P,f){return[L]}Yi({target:"Array",proto:!0,forced:!dv},{filter:function(C){return Sc(this,C,arguments.length>1?arguments[1]:void 0)}});var Ws=Cp,vv=Cp;function Cp(C,L,P){P=P||2;var f,m,S,k,B,G,Z,ee=L&&L.length,_e=ee?L[0]*P:C.length,Ge=Dd(C,0,_e,P,!0),Xe=[];if(!Ge||Ge.next===Ge.prev)return Xe;if(ee&&(Ge=function(bt,kt,Xt,Ht){var ir,Ur,qn,Ri,Ai,Oi=[];for(ir=0,Ur=kt.length;ir<Ur;ir++)qn=kt[ir]*Ht,Ri=ir<Ur-1?kt[ir+1]*Ht:bt.length,(Ai=Dd(bt,qn,Ri,Ht,!1))===Ai.next&&(Ai.steiner=!0),Oi.push(Wm(Ai));for(Oi.sort(jm),ir=0;ir<Oi.length;ir++)Xt=Sp(Oi[ir],Xt);return Xt}(C,L,Ge,P)),C.length>80*P){f=S=C[0],m=k=C[1];for(var it=P;it<_e;it+=P)(B=C[it])<f&&(f=B),(G=C[it+1])<m&&(m=G),B>S&&(S=B),G>k&&(k=G);Z=(Z=Math.max(S-f,k-m))!==0?32767/Z:0}return mv(Ge,Xe,P,f,m,Z,0),Xe}function Dd(C,L,P,f,m){var S,k;if(m===Ym(C,L,P,f)>0)for(S=L;S<P;S+=f)k=Xm(S,C[S],C[S+1],k);else for(S=P-f;S>=L;S-=f)k=Xm(S,C[S],C[S+1],k);return k&&Gh(k,k.next)&&(Nd(k),k=k.next),k}function tf(C,L){if(!C)return C;L||(L=C);var P,f=C;do if(P=!1,f.steiner||!Gh(f,f.next)&&_s(f.prev,f,f.next)!==0)f=f.next;else{if(Nd(f),(f=L=f.prev)===f.next)break;P=!0}while(P||f!==L);return L}function mv(C,L,P,f,m,S,k){if(C){!k&&S&&function(ee,_e,Ge,Xe){var it=ee;do it.z===0&&(it.z=gv(it.x,it.y,_e,Ge,Xe)),it.prevZ=it.prev,it.nextZ=it.next,it=it.next;while(it!==ee);it.prevZ.nextZ=null,it.prevZ=null,function(bt){var kt,Xt,Ht,ir,Ur,qn,Ri,Ai,Oi=1;do{for(Xt=bt,bt=null,Ur=null,qn=0;Xt;){for(qn++,Ht=Xt,Ri=0,kt=0;kt<Oi&&(Ri++,Ht=Ht.nextZ);kt++);for(Ai=Oi;Ri>0||Ai>0&&Ht;)Ri!==0&&(Ai===0||!Ht||Xt.z<=Ht.z)?(ir=Xt,Xt=Xt.nextZ,Ri--):(ir=Ht,Ht=Ht.nextZ,Ai--),Ur?Ur.nextZ=ir:bt=ir,ir.prevZ=Ur,Ur=ir;Xt=Ht}Ur.nextZ=null,Oi*=2}while(qn>1)}(it)}(C,f,m,S);for(var B,G,Z=C;C.prev!==C.next;)if(B=C.prev,G=C.next,S?Jg(C,f,m,S):Qg(C))L.push(B.i/P|0),L.push(C.i/P|0),L.push(G.i/P|0),Nd(C),C=G.next,Z=G.next;else if((C=G)===Z){k?k===1?mv(C=Vm(tf(C),L,P),L,P,f,m,S,2):k===2&&Gm(C,L,P,f,m,S):mv(tf(C),L,P,f,m,S,1);break}}}function Qg(C){var L=C.prev,P=C,f=C.next;if(_s(L,P,f)>=0)return!1;for(var m=L.x,S=P.x,k=f.x,B=L.y,G=P.y,Z=f.y,ee=m<S?m<k?m:k:S<k?S:k,_e=B<G?B<Z?B:Z:G<Z?G:Z,Ge=m>S?m>k?m:k:S>k?S:k,Xe=B>G?B>Z?B:Z:G>Z?G:Z,it=f.next;it!==L;){if(it.x>=ee&&it.x<=Ge&&it.y>=_e&&it.y<=Xe&&Bd(m,B,S,G,k,Z,it.x,it.y)&&_s(it.prev,it,it.next)>=0)return!1;it=it.next}return!0}function Jg(C,L,P,f){var m=C.prev,S=C,k=C.next;if(_s(m,S,k)>=0)return!1;for(var B=m.x,G=S.x,Z=k.x,ee=m.y,_e=S.y,Ge=k.y,Xe=B<G?B<Z?B:Z:G<Z?G:Z,it=ee<_e?ee<Ge?ee:Ge:_e<Ge?_e:Ge,bt=B>G?B>Z?B:Z:G>Z?G:Z,kt=ee>_e?ee>Ge?ee:Ge:_e>Ge?_e:Ge,Xt=gv(Xe,it,L,P,f),Ht=gv(bt,kt,L,P,f),ir=C.prevZ,Ur=C.nextZ;ir&&ir.z>=Xt&&Ur&&Ur.z<=Ht;){if(ir.x>=Xe&&ir.x<=bt&&ir.y>=it&&ir.y<=kt&&ir!==m&&ir!==k&&Bd(B,ee,G,_e,Z,Ge,ir.x,ir.y)&&_s(ir.prev,ir,ir.next)>=0||(ir=ir.prevZ,Ur.x>=Xe&&Ur.x<=bt&&Ur.y>=it&&Ur.y<=kt&&Ur!==m&&Ur!==k&&Bd(B,ee,G,_e,Z,Ge,Ur.x,Ur.y)&&_s(Ur.prev,Ur,Ur.next)>=0))return!1;Ur=Ur.nextZ}for(;ir&&ir.z>=Xt;){if(ir.x>=Xe&&ir.x<=bt&&ir.y>=it&&ir.y<=kt&&ir!==m&&ir!==k&&Bd(B,ee,G,_e,Z,Ge,ir.x,ir.y)&&_s(ir.prev,ir,ir.next)>=0)return!1;ir=ir.prevZ}for(;Ur&&Ur.z<=Ht;){if(Ur.x>=Xe&&Ur.x<=bt&&Ur.y>=it&&Ur.y<=kt&&Ur!==m&&Ur!==k&&Bd(B,ee,G,_e,Z,Ge,Ur.x,Ur.y)&&_s(Ur.prev,Ur,Ur.next)>=0)return!1;Ur=Ur.nextZ}return!0}function Vm(C,L,P){var f=C;do{var m=f.prev,S=f.next.next;!Gh(m,S)&&V0(m,f,f.next,S)&&yv(m,S)&&yv(S,m)&&(L.push(m.i/P|0),L.push(f.i/P|0),L.push(S.i/P|0),Nd(f),Nd(f.next),f=C=S),f=f.next}while(f!==C);return tf(f)}function Gm(C,L,P,f,m,S){var k=C;do{for(var B=k.next.next;B!==k.prev;){if(k.i!==B.i&&$m(k,B)){var G=u0(k,B);return k=tf(k,k.next),G=tf(G,G.next),mv(k,L,P,f,m,S,0),void mv(G,L,P,f,m,S,0)}B=B.next}k=k.next}while(k!==C)}function jm(C,L){return C.x-L.x}function Sp(C,L){var P=function(m,S){var k,B=S,G=m.x,Z=m.y,ee=-1/0;do{if(Z<=B.y&&Z>=B.next.y&&B.next.y!==B.y){var _e=B.x+(Z-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(_e<=G&&_e>ee&&(ee=_e,k=B.x<B.next.x?B:B.next,_e===G))return k}B=B.next}while(B!==S);if(!k)return null;var Ge,Xe=k,it=k.x,bt=k.y,kt=1/0;B=k;do G>=B.x&&B.x>=it&&G!==B.x&&Bd(Z<bt?G:ee,Z,it,bt,Z<bt?ee:G,Z,B.x,B.y)&&(Ge=Math.abs(Z-B.y)/(G-B.x),yv(B,m)&&(Ge<kt||Ge===kt&&(B.x>k.x||B.x===k.x&&Hm(k,B)))&&(k=B,kt=Ge)),B=B.next;while(B!==Xe);return k}(C,L);if(!P)return L;var f=u0(P,C);return tf(f,f.next),tf(P,P.next)}function Hm(C,L){return _s(C.prev,C,L.prev)<0&&_s(L.next,C,C.next)<0}function gv(C,L,P,f,m){return(C=1431655765&((C=858993459&((C=252645135&((C=16711935&((C=(C-P)*m|0)|C<<8))|C<<4))|C<<2))|C<<1))|(L=1431655765&((L=858993459&((L=252645135&((L=16711935&((L=(L-f)*m|0)|L<<8))|L<<4))|L<<2))|L<<1))<<1}function Wm(C){var L=C,P=C;do(L.x<P.x||L.x===P.x&&L.y<P.y)&&(P=L),L=L.next;while(L!==C);return P}function Bd(C,L,P,f,m,S,k,B){return(m-k)*(L-B)>=(C-k)*(S-B)&&(C-k)*(f-B)>=(P-k)*(L-B)&&(P-k)*(S-B)>=(m-k)*(f-B)}function $m(C,L){return C.next.i!==L.i&&C.prev.i!==L.i&&!function(P,f){var m=P;do{if(m.i!==P.i&&m.next.i!==P.i&&m.i!==f.i&&m.next.i!==f.i&&V0(m,m.next,P,f))return!0;m=m.next}while(m!==P);return!1}(C,L)&&(yv(C,L)&&yv(L,C)&&function(P,f){var m=P,S=!1,k=(P.x+f.x)/2,B=(P.y+f.y)/2;do m.y>B!=m.next.y>B&&m.next.y!==m.y&&k<(m.next.x-m.x)*(B-m.y)/(m.next.y-m.y)+m.x&&(S=!S),m=m.next;while(m!==P);return S}(C,L)&&(_s(C.prev,C,L.prev)||_s(C,L.prev,L))||Gh(C,L)&&_s(C.prev,C,C.next)>0&&_s(L.prev,L,L.next)>0)}function _s(C,L,P){return(L.y-C.y)*(P.x-L.x)-(L.x-C.x)*(P.y-L.y)}function Gh(C,L){return C.x===L.x&&C.y===L.y}function V0(C,L,P,f){var m=Qp(_s(C,L,P)),S=Qp(_s(C,L,f)),k=Qp(_s(P,f,C)),B=Qp(_s(P,f,L));return m!==S&&k!==B||!(m!==0||!s0(C,P,L))||!(S!==0||!s0(C,f,L))||!(k!==0||!s0(P,C,f))||!(B!==0||!s0(P,L,f))}function s0(C,L,P){return L.x<=Math.max(C.x,P.x)&&L.x>=Math.min(C.x,P.x)&&L.y<=Math.max(C.y,P.y)&&L.y>=Math.min(C.y,P.y)}function Qp(C){return C>0?1:C<0?-1:0}function yv(C,L){return _s(C.prev,C,C.next)<0?_s(C,L,C.next)>=0&&_s(C,C.prev,L)>=0:_s(C,L,C.prev)<0||_s(C,C.next,L)<0}function u0(C,L){var P=new Zm(C.i,C.x,C.y),f=new Zm(L.i,L.x,L.y),m=C.next,S=L.prev;return C.next=L,L.prev=C,P.next=m,m.prev=P,f.next=P,P.prev=f,S.next=f,f.prev=S,f}function Xm(C,L,P,f){var m=new Zm(C,L,P);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function Nd(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Zm(C,L,P){this.i=C,this.x=L,this.y=P,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ym(C,L,P,f){for(var m=0,S=L,k=P-f;S<P;S+=f)m+=(C[k]-C[S])*(C[S+1]+C[k+1]),k=S;return m}Cp.deviation=function(C,L,P,f){var m=L&&L.length,S=m?L[0]*P:C.length,k=Math.abs(Ym(C,0,S,P));if(m)for(var B=0,G=L.length;B<G;B++){var Z=L[B]*P,ee=B<G-1?L[B+1]*P:C.length;k-=Math.abs(Ym(C,Z,ee,P))}var _e=0;for(B=0;B<f.length;B+=3){var Ge=f[B]*P,Xe=f[B+1]*P,it=f[B+2]*P;_e+=Math.abs((C[Ge]-C[it])*(C[Xe+1]-C[Ge+1])-(C[Ge]-C[Xe])*(C[it+1]-C[Ge+1]))}return k===0&&_e===0?0:Math.abs((_e-k)/k)},Cp.flatten=function(C){for(var L=C[0][0].length,P={vertices:[],holes:[],dimensions:L},f=0,m=0;m<C.length;m++){for(var S=0;S<C[m].length;S++)for(var k=0;k<L;k++)P.vertices.push(C[m][S][k]);m>0&&(f+=C[m-1].length,P.holes.push(f))}return P},Ws.default=vv;var ey=gt(1 .valueOf),ty=gt("".replace),G0=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,p_=RegExp("^"+G0+G0+"*"),d_=RegExp(G0+G0+"*$"),qm=function(C){return function(L){var P=ya(Er(L));return 1&C&&(P=ty(P,p_,"")),2&C&&(P=ty(P,d_,"")),P}},jh={start:qm(1),end:qm(2),trim:qm(3)},j0=Ku.f,ry=se.f,l0=Jt.f,ny=jh.trim,_v=ue.Number,v_=_v.prototype,A2=ue.TypeError,T2=gt("".slice),iy=gt("".charCodeAt),M2=function(C){var L=et(C,"number");return typeof L=="bigint"?L:I2(L)},I2=function(C){var L,P,f,m,S,k,B,G,Z=et(C,"number");if(iu(Z))throw A2("Cannot convert a Symbol value to a number");if(typeof Z=="string"&&Z.length>2){if(Z=ny(Z),(L=iy(Z,0))===43||L===45){if((P=iy(Z,2))===88||P===120)return NaN}else if(L===48){switch(iy(Z,1)){case 66:case 98:f=2,m=49;break;case 79:case 111:f=8,m=55;break;default:return+Z}for(k=(S=T2(Z,2)).length,B=0;B<k;B++)if((G=iy(S,B))<48||G>m)return NaN;return parseInt(S,f)}}return+Z};if(_u("Number",!_v(" 0o1")||!_v("0b1")||_v("+0x1"))){for(var ay,H0=function(C){var L=arguments.length<1?0:_v(M2(C)),P=this;return nu(v_,P)&&ve(function(){ey(P)})?Ed(Object(L),P,H0):L},nx=fr?j0(_v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),m_=0;nx.length>m_;m_++)Ar(_v,ay=nx[m_])&&!Ar(H0,ay)&&l0(H0,ay,ry(_v,ay));H0.prototype=v_,v_.constructor=H0,da(ue,"Number",H0,{constructor:!0})}var L2=RangeError,g_=RangeError,y_=String,__=Math.floor,x_=gt(function(C){var L=ya(Er(this)),P="",f=Tr(C);if(f<0||f==1/0)throw L2("Wrong number of repetitions");for(;f>0;(f>>>=1)&&(L+=L))1&f&&(P+=L);return P}),ix=gt("".slice),Km=gt(1 .toFixed),xv=function(C,L,P){return L===0?P:L%2==1?xv(C,L-1,P*C):xv(C*C,L/2,P)},W0=function(C,L,P){for(var f=-1,m=P;++f<6;)m+=L*C[f],C[f]=m%1e7,m=__(m/1e7)},b_=function(C,L){for(var P=6,f=0;--P>=0;)f+=C[P],C[P]=__(f/L),f=f%L*1e7},ax=function(C){for(var L=6,P="";--L>=0;)if(P!==""||L===0||C[L]!==0){var f=y_(C[L]);P=P===""?f:P+x_("0",7-f.length)+f}return P},zf=ve(function(){return Km(8e-5,3)!=="0.000"||Km(.9,0)!=="1"||Km(1.255,2)!=="1.25"||Km(0xde0b6b3a7640080,0)!=="1000000000000000128"})||!ve(function(){Km({})});function Qm(C){return typeof C=="number"}function bv(C){var L=Math.max(Math.min(85.0511287798,C[1]),-85.0511287798),P=Math.PI/180,f=C[0]*P,m=L*P;return m=Math.log(Math.tan(Math.PI/4+m/2)),f=(256<<20)*(.5/Math.PI*f+.5),m=(256<<20)*(-.5/Math.PI*m+(P=.5)),[Math.floor(f),Math.floor(m)]}Yi({target:"Number",proto:!0,forced:zf},{toFixed:function(C){var L,P,f,m,S=ey(this),k=Tr(C),B=[0,0,0,0,0,0],G="",Z="0";if(k<0||k>20)throw g_("Incorrect fraction digits");if(S!=S)return"NaN";if(S<=-1e21||S>=1e21)return y_(S);if(S<0&&(G="-",S=-S),S>1e-21)if(P=(L=function(ee){for(var _e=0,Ge=ee;Ge>=4096;)_e+=12,Ge/=4096;for(;Ge>=2;)_e+=1,Ge/=2;return _e}(S*xv(2,69,1))-69)<0?S*xv(2,-L,1):S/xv(2,L,1),P*=4503599627370496,(L=52-L)>0){for(W0(B,0,P),f=k;f>=7;)W0(B,1e7,0),f-=7;for(W0(B,xv(10,f,1),0),f=L-1;f>=23;)b_(B,1<<23),f-=23;b_(B,1<<f),W0(B,1,1),b_(B,2),Z=ax(B)}else W0(B,0,P),W0(B,1<<-L,0),Z=ax(B)+x_("0",k);return Z=k>0?G+((m=Z.length)<=k?"0."+x_("0",k-m)+Z:ix(Z,0,m-k)+"."+ix(Z,m-k)):G+Z}});var ox,k2=/"/g,R2=gt("".replace);Yi({target:"String",proto:!0,forced:(ox="sub",ve(function(){var C=""[ox]('"');return C!==C.toLowerCase()||C.split('"').length>3}))},{sub:function(){return C="sub",L="",P="",f=ya(Er(this)),m="<"+C,L!==""&&(m+=" "+L+'="'+R2(ya(P),k2,"&quot;")+'"'),m+">"+f+"</"+C+">";var C,L,P,f,m}});var oy=RegExp.prototype,O2=Nr.PROPER,sy=RegExp.prototype.toString,P2=ve(function(){return sy.call({source:"a",flags:"b"})!="/a/b"}),F2=O2&&sy.name!="toString";(P2||F2)&&da(RegExp.prototype,"toString",function(){var C=Ki(this);return"/"+ya(C.source)+"/"+ya(function(L){var P=L.flags;return P!==void 0||"flags"in oy||Ar(L,"flags")||!nu(oy,L)?P:Xi(hl,L)}(C))},{unsafe:!0});var E_=typeof Float32Array<"u"?Float32Array:Array;function Zu(){var C=new E_(2);return E_!=Float32Array&&(C[0]=0,C[1]=0),C}function uy(C,L){var P=new E_(2);return P[0]=C,P[1]=L,P}function Jm(C,L){return C[0]=L[0],C[1]=L[1],C}function Jp(C,L,P){return C[0]=L[0]+P[0],C[1]=L[1]+P[1],C}function ly(C,L,P){return C[0]=L[0]-P[0],C[1]=L[1]-P[1],C}function c0(C,L){var P=L[0],f=L[1],m=P*P+f*f;return m>0&&(m=1/Math.sqrt(m)),C[0]=L[0]*m,C[1]=L[1]*m,C}function $0(C,L){return C[0]*L[0]+C[1]*L[1]}Math.hypot||(Math.hypot=function(){for(var C=0,L=arguments.length;L--;)C+=arguments[L]*arguments[L];return Math.sqrt(C)});var C_=ly,cy=(Zu(),Zu()),Yu=(Zu(),Zu()),Ev=Zu(),X0=Zu();function S_(C,L,P,f,m){return Jp(C,P,f),c0(C,C),[m/$0(L=uy(-C[1],C[0]),uy(-P[1],P[0])),L]}function Cv(C,L){return function(P,f,m){return P[0]=f,P[1]=m,P}(C,-L[1],L[0])}function Z0(C,L,P){return C_(C,L,P),c0(C,C),C}function w_(C,L){return C[0]===L[0]&&C[1]===L[1]}var D2=function(){function C(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};a(this,C),c(this,"complex",void 0),c(this,"join",void 0),c(this,"cap",void 0),c(this,"miterLimit",void 0),c(this,"thickness",void 0),c(this,"normal",void 0),c(this,"lastFlip",-1),c(this,"miter",uy(0,0)),c(this,"started",!1),c(this,"dash",!1),c(this,"totalDistance",0),c(this,"currentIndex",0),this.join=L.join||"miter",this.cap=L.cap||"butt",this.miterLimit=L.miterLimit||10,this.thickness=L.thickness||1,this.dash=L.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return l(C,[{key:"extrude_gaode2",value:function(L,P){var f=this.complex;if(L.length<=1)return f;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var m=L.length,S=f.startIndex,k=1;k<m;k++){var B,G,Z,ee=L[k-1];ee.push((B=P[k-1][2])!==null&&B!==void 0?B:0);var _e=P[k-1],Ge=L[k];Ge.push((G=P[k][2])!==null&&G!==void 0?G:0);var Xe=P[k],it=k<L.length-1?[].concat(z(L[k+1]),[(Z=P[k+1][2])!==null&&Z!==void 0?Z:0]):null,bt=k<P.length-1?P[k+1]:null;S+=this.segment_gaode2(f,S,ee,Ge,it,_e,Xe,bt)}if(this.dash)for(var kt=0;kt<f.positions.length/6;kt++)f.positions[6*kt+5]=this.totalDistance;return f.startIndex=f.positions.length/6,f}},{key:"simpleExtrude_gaode2",value:function(L,P){var f=this.complex;if(L.length<=1)return f;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var m=L.length,S=f.startIndex,k=1;k<m;k++){var B,G,Z,ee=L[k-1];ee.push((B=P[k-1][2])!==null&&B!==void 0?B:0);var _e=P[k-1],Ge=L[k];Ge.push((G=P[k][2])!==null&&G!==void 0?G:0);var Xe=P[k],it=k<L.length-1?[].concat(z(L[k+1]),[(Z=P[k+1][2])!==null&&Z!==void 0?Z:0]):null,bt=k<P.length-1?P[k+1]:null;S+=this.simpleSegment(f,S,ee,Ge,it,_e,Xe,bt)}if(this.dash)for(var kt=0;kt<f.positions.length/6;kt++)f.positions[6*kt+5]=this.totalDistance;return f.startIndex=f.positions.length/6,f}},{key:"extrude",value:function(L){var P=this.complex;if(L.length<=1)return P;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var f=L.length,m=P.startIndex,S=1;S<f;S++){var k=L[S-1],B=L[S],G=S<L.length-1?L[S+1]:null;m+=this.segment(P,m,k,B,G)}if(this.dash)for(var Z=0;Z<P.positions.length/6;Z++)P.positions[6*Z+5]=this.totalDistance;return P.startIndex=P.positions.length/6,P}},{key:"simpleExtrude",value:function(L){var P=this.complex;if(L.length<=1)return P;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var f=L.length,m=P.startIndex,S=1;S<f;S++){var k=L[S-1],B=L[S],G=S<L.length-1?L[S+1]:null;m+=this.simpleSegment(P,m,k,B,G)}if(this.dash)for(var Z=0;Z<P.positions.length/6;Z++)P.positions[6*Z+5]=this.totalDistance;return P.startIndex=P.positions.length/6,P}},{key:"segment_gaode2",value:function(L,P,f,m,S,k,B,G){var Z=0,ee=L.indices,_e=L.positions,Ge=L.normals,Xe=this.cap==="square",it=this.join==="bevel",bt=bv([B[0],B[1]]),kt=bv([k[0],k[1]]);Z0(Yu,m,f);var Xt=0;if(this.dash&&(Xt=this.lineSegmentDistance(bt,kt),this.totalDistance+=Xt),this.normal||(this.normal=Zu(),Cv(this.normal,Yu)),!this.started)if(this.started=!0,Xe){var Ht=Zu(),ir=Zu();Jp(Ht,this.normal,Yu),Jp(ir,this.normal,Yu),Ge.push(ir[0],ir[1],0),Ge.push(Ht[0],Ht[1],0),_e.push(f[0],f[1],0|f[2],this.totalDistance-Xt,-this.thickness,0|f[2]),this.complex.indexes.push(this.currentIndex),_e.push(f[0],f[1],0|f[2],this.totalDistance-Xt,this.thickness,0|f[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(_e,Ge,f,this.normal,this.thickness,this.totalDistance-Xt);if(ee.push(P+0,P+1,P+2),S){w_(m,S)&&Jp(S,m,c0(S,ly(S,m,f))),Z0(Ev,S,m);var Ur=N(S_(X0,Zu(),Yu,Ev,this.thickness),2),qn=Ur[0],Ri=Ur[1],Ai=$0(X0,this.normal)<0?-1:1,Oi=it;!Oi&&this.join==="miter"&&qn>this.miterLimit&&(Oi=!0),Oi?(Ge.push(this.normal[0],this.normal[1],0),Ge.push(Ri[0],Ri[1],0),_e.push(m[0],m[1],0|m[2],this.totalDistance,-this.thickness*Ai,0|m[2]),this.complex.indexes.push(this.currentIndex),_e.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness*Ai,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,ee.push.apply(ee,z(this.lastFlip!==-Ai?[P,P+2,P+3]:[P+2,P+1,P+3])),ee.push(P+2,P+3,P+4),Cv(cy,Ev),Jm(this.normal,cy),Ge.push(this.normal[0],this.normal[1],0),_e.push(m[0],m[1],0|m[2],this.totalDistance,-this.thickness*Ai,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Z+=3):(this.extrusions(_e,Ge,m,Ri,qn,this.totalDistance),ee.push.apply(ee,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),Ai=-1,Jm(this.normal,Ri),Z+=2),this.lastFlip=Ai}else{if(Cv(this.normal,Yu),Xe){var hi=Zu(),or=Zu();C_(or,Yu,this.normal),Jp(hi,Yu,this.normal),Ge.push(or[0],or[1],0),Ge.push(hi[0],hi[1],0),_e.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness,0|m[2]),this.complex.indexes.push(this.currentIndex),_e.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(_e,Ge,m,this.normal,this.thickness,this.totalDistance);ee.push.apply(ee,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),Z+=2}return Z}},{key:"simpleSegment",value:function(L,P,f,m,S){var k=0,B=L.indices,G=L.positions,Z=L.normals,ee=bv([m[0],m[1]]),_e=bv([f[0],f[1]]);Z0(Yu,ee,_e);var Ge=0;if(this.dash&&(Ge=this.lineSegmentDistance(ee,_e),this.totalDistance+=Ge),this.normal||(this.normal=Zu(),Cv(this.normal,Yu)),this.started||(this.started=!0,this.extrusions(G,Z,f,this.normal,this.thickness,this.totalDistance-Ge)),B.push(P+0,P+1,P+2),S){var Xe=bv([S[0],S[1]]);w_(ee,Xe)&&Jp(Xe,ee,c0(Xe,ly(Xe,ee,_e))),Z0(Ev,Xe,ee);var it=N(S_(X0,Zu(),Yu,Ev,this.thickness),2),bt=it[0],kt=it[1];$0(X0,this.normal),this.extrusions(G,Z,m,kt,bt,this.totalDistance),B.push.apply(B,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),Jm(this.normal,kt),k+=2,this.lastFlip=-1}else Cv(this.normal,Yu),this.extrusions(G,Z,m,this.normal,this.thickness,this.totalDistance),B.push.apply(B,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),k+=2;return k}},{key:"segment",value:function(L,P,f,m,S){var k=0,B=L.indices,G=L.positions,Z=L.normals,ee=this.cap==="square",_e=this.join==="bevel",Ge=bv([m[0],m[1]]),Xe=bv([f[0],f[1]]);Z0(Yu,Ge,Xe);var it=0;if(this.dash&&(it=this.lineSegmentDistance(Ge,Xe),this.totalDistance+=it),this.normal||(this.normal=Zu(),Cv(this.normal,Yu)),!this.started)if(this.started=!0,ee){var bt=Zu(),kt=Zu();Jp(bt,this.normal,Yu),Jp(kt,this.normal,Yu),Z.push(kt[0],kt[1],0),Z.push(bt[0],bt[1],0),G.push(f[0],f[1],0|f[2],this.totalDistance-it,-this.thickness,0|f[2]),this.complex.indexes.push(this.currentIndex),G.push(f[0],f[1],0|f[2],this.totalDistance-it,this.thickness,0|f[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(G,Z,f,this.normal,this.thickness,this.totalDistance-it);if(B.push(P+0,P+1,P+2),S){var Xt=bv([S[0],S[1]]);w_(Ge,Xt)&&Jp(Xt,Ge,c0(Xt,ly(Xt,Ge,Xe))),Z0(Ev,Xt,Ge);var Ht=N(S_(X0,Zu(),Yu,Ev,this.thickness),2),ir=Ht[0],Ur=Ht[1],qn=$0(X0,this.normal)<0?-1:1,Ri=_e;!Ri&&this.join==="miter"&&ir>this.miterLimit&&(Ri=!0),Ri?(Z.push(this.normal[0],this.normal[1],0),Z.push(Ur[0],Ur[1],0),G.push(m[0],m[1],0|m[2],this.totalDistance,-this.thickness*qn,0|m[2]),this.complex.indexes.push(this.currentIndex),G.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness*qn,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,B.push.apply(B,z(this.lastFlip!==-qn?[P,P+2,P+3]:[P+2,P+1,P+3])),B.push(P+2,P+3,P+4),Cv(cy,Ev),Jm(this.normal,cy),Z.push(this.normal[0],this.normal[1],0),G.push(m[0],m[1],0|m[2],this.totalDistance,-this.thickness*qn,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,k+=3):(this.extrusions(G,Z,m,Ur,ir,this.totalDistance),B.push.apply(B,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),qn=-1,Jm(this.normal,Ur),k+=2),this.lastFlip=qn}else{if(Cv(this.normal,Yu),ee){var Ai=Zu(),Oi=Zu();C_(Oi,Yu,this.normal),Jp(Ai,Yu,this.normal),Z.push(Oi[0],Oi[1],0),Z.push(Ai[0],Ai[1],0),G.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness,0|m[2]),this.complex.indexes.push(this.currentIndex),G.push(m[0],m[1],0|m[2],this.totalDistance,this.thickness,0|m[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(G,Z,m,this.normal,this.thickness,this.totalDistance);B.push.apply(B,z(this.lastFlip===1?[P,P+2,P+3]:[P+2,P+1,P+3])),k+=2}return k}},{key:"extrusions",value:function(L,P,f,m,S,k){P.push(m[0],m[1],0),P.push(m[0],m[1],0),L.push(f[0],f[1],0|f[2],k,-S,0|f[2]),this.complex.indexes.push(this.currentIndex),L.push(f[0],f[1],0|f[2],k,S,0|f[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(L,P){var f=P[0]-L[0],m=P[1]-L[1];return Math.sqrt(f*f+m*m)}}]),C}();function B2(C){var L=C.coordinates,P=C.originCoordinates,f=C.version,m=new D2({dash:!0,join:"bevel"});if(f==="GAODE2.x"){var S=L;Array.isArray(S[0][0])||(S=[L]);var k=P;Array.isArray(k[0][0])||(k=[P]);for(var B=0;B<S.length;B++){var G=S[B],Z=k[B];m.extrude_gaode2(G,Z)}}else{var ee=L;ee[0]&&!Array.isArray(ee[0][0])&&(ee=[L]),ee.forEach(function(Ge){m.extrude(Ge)})}var _e=m.complex;return{vertices:_e.positions,indices:_e.indices,normals:_e.normals,indexes:_e.indexes,size:6}}function N2(C){var L=function(P){if(Qm(P[0]))return P;if(Qm(P[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Qm(P[0][0][0])){var f=0,m=0,S=0;return P.forEach(function(k){k.forEach(function(B){f+=B[0],m+=B[1],S++})}),[f/S,m/S,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(C.coordinates);return{vertices:[].concat(z(L),z(L),z(L),z(L)),indices:[0,1,2,2,3,0],size:L.length}}function z2(C){var L=C.coordinates,P=Ws.flatten(L),f=P.vertices,m=P.dimensions,S=P.holes;return{indices:Ws(f,S,m),vertices:f,size:m}}var U2=function(){var C=i(t().mark(function L(P){var f,m,S,k,B,G,Z,ee,_e;return t().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return f=P.descriptors,m=P.features,S=P.enablePicking,k=P.iconMap,B={a_Color:U0,a_Position:Nf,filter:Um,a_vertexId:ru,a_PickingColor:function(Xe,it){var bt=Xe.id;return S?pv(bt):[0,0,0]},a_DistanceAndIndex:function(Xe,it,bt,kt,Xt,Ht){return Ht===void 0?[bt[3],10]:[bt[3],Ht]},a_Total_Distance:function(Xe,it,bt,kt){return[bt[5]]},a_Size:function(Xe,it,bt,kt){var Xt=Xe.size,Ht=Xt===void 0?1:Xt;return Array.isArray(Ht)?[Ht[0],Ht[1]]:[Ht,0]},a_Normal:function(Xe,it,bt,kt,Xt){return Xt},a_Miter:function(Xe,it,bt,kt){return[bt[4]]},a_iconMapUV:function(Xe,it,bt,kt){var Xt=Xe.texture,Ht=k[Xt]||{x:0,y:0};return[Ht.x,Ht.y]}},G={sizePerElement:0,elements:[]},Z=0,ee=[],_e=3,m.forEach(function(Xe,it){var bt=B2(Xe),kt=bt.indices,Xt=bt.vertices,Ht=bt.normals,ir=bt.size,Ur=bt.indexes;kt.forEach(function(Oi){ee.push(Oi+Z)}),_e=ir;var qn=Xt.length/ir;G.sizePerElement=_e,G.elements.push({featureIdx:it,vertices:Xt,normals:Ht,offset:Z}),Z+=qn;for(var Ri=function(Oi){var hi=(Ht==null?void 0:Ht.slice(3*Oi,3*Oi+3))||[],or=Xt.slice(Oi*ir,Oi*ir+ir),yr=0;Ur&&Ur[Oi]!==void 0&&(yr=Ur[Oi]),f.forEach(function(ri,Ca){var Wi;ri&&B[ri.name]&&(Wi=ri.buffer.data).push.apply(Wi,z(B[ri.name](Xe,it,or,Oi,hi,yr)))})},Ai=0;Ai<qn;Ai++)Ri(Ai)}),Ge.abrupt("return",{descriptors:f,featureLayout:G,indices:ee});case 8:case"end":return Ge.stop()}},L)}));return function(L){return C.apply(this,arguments)}}(),sx={pointFill:function(){var C=i(t().mark(function L(P){var f,m,S,k,B,G,Z,ee,_e;return t().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return f=P.descriptors,m=P.features,S=P.enablePicking,k=P.shape2d,B={a_Color:U0,a_Position:Nf,filter:Um,a_vertexId:ru,a_PickingColor:function(Xe,it){var bt=Xe.id;return S?pv(bt):[0,0,0]},a_Shape:function(Xe,it,bt,kt){var Xt=Xe.shape,Ht=Xt===void 0?2:Xt;return[k.indexOf(Ht)]},a_Extrude:function(Xe,it,bt,kt){var Xt=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Ht=kt%4*3;return[Xt[Ht],Xt[Ht+1],Xt[Ht+2]]},a_Size:function(Xe,it,bt,kt){var Xt=Xe.size,Ht=Xt===void 0?5:Xt;return Array.isArray(Ht)?[Ht[0]]:[Ht]}},G={sizePerElement:0,elements:[]},Z=0,ee=[],_e=3,m.forEach(function(Xe,it){var bt=N2(Xe),kt=bt.indices,Xt=bt.vertices,Ht=bt.normals,ir=bt.size;kt.forEach(function(Ai){ee.push(Ai+Z)}),_e=ir;var Ur=Xt.length/ir;G.sizePerElement=_e,G.elements.push({featureIdx:it,vertices:Xt,normals:Ht,offset:Z}),Z+=Ur;for(var qn=function(Ai){var Oi=[],hi=Xt.slice(Ai*ir,Ai*ir+ir);f.forEach(function(or,yr){var ri;or&&B[or.name]&&(ri=or.buffer.data).push.apply(ri,z(B[or.name](Xe,it,hi,Ai,Oi,0)))})},Ri=0;Ri<Ur;Ri++)qn(Ri)}),Ge.abrupt("return",{descriptors:f,featureLayout:G,indices:ee});case 8:case"end":return Ge.stop()}},L)}));return function(L){return C.apply(this,arguments)}}(),line:U2,polygonFill:function(){var C=i(t().mark(function L(P){var f,m,S,k,B,G,Z,ee;return t().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return f=P.descriptors,m=P.features,S=P.enablePicking,k={a_Color:U0,a_Position:Nf,filter:Um,a_vertexId:ru,a_PickingColor:function(Ge,Xe){var it=Ge.id;return S?pv(it):[0,0,0]}},B={sizePerElement:0,elements:[]},G=0,Z=[],ee=3,m.forEach(function(Ge,Xe){var it=z2(Ge),bt=it.indices,kt=it.vertices,Xt=it.normals,Ht=it.size;bt.forEach(function(Ri){Z.push(Ri+G)}),ee=Ht;var ir=kt.length/Ht;B.sizePerElement=ee,B.elements.push({featureIdx:Xe,vertices:kt,normals:Xt,offset:G}),G+=ir;for(var Ur=function(Ri){var Ai=[],Oi=kt.slice(Ri*Ht,Ri*Ht+Ht);f.forEach(function(hi,or){var yr;hi&&k[hi.name]&&(yr=hi.buffer.data).push.apply(yr,z(k[hi.name](Ge,Xe,Oi,Ri,Ai,0)))})},qn=0;qn<ir;qn++)Ur(qn)}),_e.abrupt("return",{descriptors:f,featureLayout:B,indices:Z});case 8:case"end":return _e.stop()}},L)}));return function(L){return C.apply(this,arguments)}}()},ux=function(C){for(var L=1;L<arguments.length;L++){var P=arguments[L]!=null?arguments[L]:{};L%2?r(Object(P),!0).forEach(function(f){c(C,f,P[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(P)):r(Object(P)).forEach(function(f){Object.defineProperty(C,f,Object.getOwnPropertyDescriptor(P,f))})}return C}({},sx);function lx(C){return cx.apply(this,arguments)}function cx(){return(cx=i(t().mark(function C(L){var P,f;return t().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(P=L.workerType,f=L.data,!ux[P]){m.next=3;break}return m.abrupt("return",ux[P](f));case 3:return m.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(P,'" non-existent.'))));case 4:case"end":return m.stop()}},C)}))).apply(this,arguments)}return gc(lx),e.WorkerSourceMap=sx,e.createWorker=gc,e.worker=lx,e})({});function vw(e,r){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function mw(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function gw(e,r){var t=e.filter;return t?[1]:[0]}function yw(e,r,t,n){return[r]}var jv={exports:{}};jv.exports=Jb;jv.exports.default=Jb;function Jb(e,r,t){t=t||2;var n=r&&r.length,i=n?r[0]*t:e.length,a=ZR(e,0,i,t,!0),o=[];if(!a||a.next===a.prev)return o;var l,c,p,y,b,w,M;if(n&&(a=MN(e,r,a,t)),e.length>80*t){l=p=e[0],c=y=e[1];for(var O=t;O<i;O+=t)b=e[O],w=e[O+1],b<l&&(l=b),w<c&&(c=w),b>p&&(p=b),w>y&&(y=w);M=Math.max(p-l,y-c),M=M!==0?32767/M:0}return A1(a,o,t,l,c,M,0),o}function ZR(e,r,t,n,i){var a,o;if(i===TC(e,r,t,n)>0)for(a=r;a<t;a+=n)o=OT(a,e[a],e[a+1],o);else for(a=t-n;a>=r;a-=n)o=OT(a,e[a],e[a+1],o);return o&&e2(o,o.next)&&(M1(o),o=o.next),o}function Og(e,r){if(!e)return e;r||(r=e);var t=e,n;do if(n=!1,!t.steiner&&(e2(t,t.next)||Pu(t.prev,t,t.next)===0)){if(M1(t),t=r=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==r);return r}function A1(e,r,t,n,i,a,o){if(!!e){!o&&a&&ON(e,n,i,a);for(var l=e,c,p;e.prev!==e.next;){if(c=e.prev,p=e.next,a?wN(e,n,i,a):SN(e)){r.push(c.i/t|0),r.push(e.i/t|0),r.push(p.i/t|0),M1(e),e=p.next,l=p.next;continue}if(e=p,e===l){o?o===1?(e=AN(Og(e),r,t),A1(e,r,t,n,i,a,2)):o===2&&TN(e,r,t,n,i,a):A1(Og(e),r,t,n,i,a,1);break}}}}function SN(e){var r=e.prev,t=e,n=e.next;if(Pu(r,t,n)>=0)return!1;for(var i=r.x,a=t.x,o=n.x,l=r.y,c=t.y,p=n.y,y=i<a?i<o?i:o:a<o?a:o,b=l<c?l<p?l:p:c<p?c:p,w=i>a?i>o?i:o:a>o?a:o,M=l>c?l>p?l:p:c>p?c:p,O=n.next;O!==r;){if(O.x>=y&&O.x<=w&&O.y>=b&&O.y<=M&&Ly(i,l,a,c,o,p,O.x,O.y)&&Pu(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function wN(e,r,t,n){var i=e.prev,a=e,o=e.next;if(Pu(i,a,o)>=0)return!1;for(var l=i.x,c=a.x,p=o.x,y=i.y,b=a.y,w=o.y,M=l<c?l<p?l:p:c<p?c:p,O=y<b?y<w?y:w:b<w?b:w,N=l>c?l>p?l:p:c>p?c:p,z=y>b?y>w?y:w:b>w?b:w,j=wC(M,O,r,t,n),Y=wC(N,z,r,t,n),K=e.prevZ,ie=e.nextZ;K&&K.z>=j&&ie&&ie.z<=Y;){if(K.x>=M&&K.x<=N&&K.y>=O&&K.y<=z&&K!==i&&K!==o&&Ly(l,y,c,b,p,w,K.x,K.y)&&Pu(K.prev,K,K.next)>=0||(K=K.prevZ,ie.x>=M&&ie.x<=N&&ie.y>=O&&ie.y<=z&&ie!==i&&ie!==o&&Ly(l,y,c,b,p,w,ie.x,ie.y)&&Pu(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;K&&K.z>=j;){if(K.x>=M&&K.x<=N&&K.y>=O&&K.y<=z&&K!==i&&K!==o&&Ly(l,y,c,b,p,w,K.x,K.y)&&Pu(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;ie&&ie.z<=Y;){if(ie.x>=M&&ie.x<=N&&ie.y>=O&&ie.y<=z&&ie!==i&&ie!==o&&Ly(l,y,c,b,p,w,ie.x,ie.y)&&Pu(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function AN(e,r,t){var n=e;do{var i=n.prev,a=n.next.next;!e2(i,a)&&YR(i,n,n.next,a)&&T1(i,a)&&T1(a,i)&&(r.push(i.i/t|0),r.push(n.i/t|0),r.push(a.i/t|0),M1(n),M1(n.next),n=e=a),n=n.next}while(n!==e);return Og(n)}function TN(e,r,t,n,i,a){var o=e;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&DN(o,l)){var c=qR(o,l);o=Og(o,o.next),c=Og(c,c.next),A1(o,r,t,n,i,a,0),A1(c,r,t,n,i,a,0);return}l=l.next}o=o.next}while(o!==e)}function MN(e,r,t,n){var i=[],a,o,l,c,p;for(a=0,o=r.length;a<o;a++)l=r[a]*n,c=a<o-1?r[a+1]*n:e.length,p=ZR(e,l,c,n,!1),p===p.next&&(p.steiner=!0),i.push(FN(p));for(i.sort(IN),a=0;a<i.length;a++)t=LN(i[a],t);return t}function IN(e,r){return e.x-r.x}function LN(e,r){var t=kN(e,r);if(!t)return r;var n=qR(t,e);return Og(n,n.next),Og(t,t.next)}function kN(e,r){var t=r,n=e.x,i=e.y,a=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var l=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=n&&l>a&&(a=l,o=t.x<t.next.x?t:t.next,l===n))return o}t=t.next}while(t!==r);if(!o)return null;var c=o,p=o.x,y=o.y,b=1/0,w;t=o;do n>=t.x&&t.x>=p&&n!==t.x&&Ly(i<y?n:a,i,p,y,i<y?a:n,i,t.x,t.y)&&(w=Math.abs(i-t.y)/(n-t.x),T1(t,e)&&(w<b||w===b&&(t.x>o.x||t.x===o.x&&RN(o,t)))&&(o=t,b=w)),t=t.next;while(t!==c);return o}function RN(e,r){return Pu(e.prev,e,r.prev)<0&&Pu(r.next,e,e.next)<0}function ON(e,r,t,n){var i=e;do i.z===0&&(i.z=wC(i.x,i.y,r,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,PN(i)}function PN(e){var r,t,n,i,a,o,l,c,p=1;do{for(t=e,e=null,a=null,o=0;t;){for(o++,n=t,l=0,r=0;r<p&&(l++,n=n.nextZ,!!n);r++);for(c=p;l>0||c>0&&n;)l!==0&&(c===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,l--):(i=n,n=n.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;t=n}a.nextZ=null,p*=2}while(o>1);return e}function wC(e,r,t,n,i){return e=(e-t)*i|0,r=(r-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e|r<<1}function FN(e){var r=e,t=e;do(r.x<t.x||r.x===t.x&&r.y<t.y)&&(t=r),r=r.next;while(r!==e);return t}function Ly(e,r,t,n,i,a,o,l){return(i-o)*(r-l)>=(e-o)*(a-l)&&(e-o)*(n-l)>=(t-o)*(r-l)&&(t-o)*(a-l)>=(i-o)*(n-l)}function DN(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!BN(e,r)&&(T1(e,r)&&T1(r,e)&&NN(e,r)&&(Pu(e.prev,e,r.prev)||Pu(e,r.prev,r))||e2(e,r)&&Pu(e.prev,e,e.next)>0&&Pu(r.prev,r,r.next)>0)}function Pu(e,r,t){return(r.y-e.y)*(t.x-r.x)-(r.x-e.x)*(t.y-r.y)}function e2(e,r){return e.x===r.x&&e.y===r.y}function YR(e,r,t,n){var i=Ex(Pu(e,r,t)),a=Ex(Pu(e,r,n)),o=Ex(Pu(t,n,e)),l=Ex(Pu(t,n,r));return!!(i!==a&&o!==l||i===0&&bx(e,t,r)||a===0&&bx(e,n,r)||o===0&&bx(t,e,n)||l===0&&bx(t,r,n))}function bx(e,r,t){return r.x<=Math.max(e.x,t.x)&&r.x>=Math.min(e.x,t.x)&&r.y<=Math.max(e.y,t.y)&&r.y>=Math.min(e.y,t.y)}function Ex(e){return e>0?1:e<0?-1:0}function BN(e,r){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==r.i&&t.next.i!==r.i&&YR(t,t.next,e,r))return!0;t=t.next}while(t!==e);return!1}function T1(e,r){return Pu(e.prev,e,e.next)<0?Pu(e,r,e.next)>=0&&Pu(e,e.prev,r)>=0:Pu(e,r,e.prev)<0||Pu(e,e.next,r)<0}function NN(e,r){var t=e,n=!1,i=(e.x+r.x)/2,a=(e.y+r.y)/2;do t.y>a!=t.next.y>a&&t.next.y!==t.y&&i<(t.next.x-t.x)*(a-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==e);return n}function qR(e,r){var t=new AC(e.i,e.x,e.y),n=new AC(r.i,r.x,r.y),i=e.next,a=r.prev;return e.next=r,r.prev=e,t.next=i,i.prev=t,n.next=t,t.prev=n,a.next=n,n.prev=a,n}function OT(e,r,t,n){var i=new AC(e,r,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M1(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function AC(e,r,t){this.i=e,this.x=r,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Jb.deviation=function(e,r,t,n){var i=r&&r.length,a=i?r[0]*t:e.length,o=Math.abs(TC(e,0,a,t));if(i)for(var l=0,c=r.length;l<c;l++){var p=r[l]*t,y=l<c-1?r[l+1]*t:e.length;o-=Math.abs(TC(e,p,y,t))}var b=0;for(l=0;l<n.length;l+=3){var w=n[l]*t,M=n[l+1]*t,O=n[l+2]*t;b+=Math.abs((e[w]-e[O])*(e[M+1]-e[w+1])-(e[w]-e[M])*(e[O+1]-e[w+1]))}return o===0&&b===0?0:Math.abs((b-o)/o)};function TC(e,r,t,n){for(var i=0,a=r,o=t-n;a<t;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}Jb.flatten=function(e){for(var r=e[0][0].length,t={vertices:[],holes:[],dimensions:r},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<r;o++)t.vertices.push(e[i][a][o]);i>0&&(n+=e[i-1].length,t.holes.push(n))}return t};var du=1e-6,$f=typeof Float32Array<"u"?Float32Array:Array,PT=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function kp(){var e=new $f(16);return $f!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function KR(e){var r=new $f(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function zN(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function QR(e,r,t,n,i,a,o,l,c,p,y,b,w,M,O,N){var z=new $f(16);return z[0]=e,z[1]=r,z[2]=t,z[3]=n,z[4]=i,z[5]=a,z[6]=o,z[7]=l,z[8]=c,z[9]=p,z[10]=y,z[11]=b,z[12]=w,z[13]=M,z[14]=O,z[15]=N,z}function UN(e,r,t,n,i,a,o,l,c,p,y,b,w,M,O,N,z){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=l,e[7]=c,e[8]=p,e[9]=y,e[10]=b,e[11]=w,e[12]=M,e[13]=O,e[14]=N,e[15]=z,e}function JR(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function VN(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],a=r[6],o=r[7],l=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=i,e[13]=o,e[14]=l}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function _w(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],p=r[7],y=r[8],b=r[9],w=r[10],M=r[11],O=r[12],N=r[13],z=r[14],j=r[15],Y=t*l-n*o,K=t*c-i*o,ie=t*p-a*o,le=n*c-i*l,Se=n*p-a*l,ze=i*p-a*c,ue=y*N-b*O,Ke=y*z-w*O,ke=y*j-M*O,Ce=b*z-w*N,je=b*j-M*N,ve=w*j-M*z,Ie=Y*ve-K*je+ie*Ce+le*ke-Se*Ke+ze*ue;return Ie?(Ie=1/Ie,e[0]=(l*ve-c*je+p*Ce)*Ie,e[1]=(i*je-n*ve-a*Ce)*Ie,e[2]=(N*ze-z*Se+j*le)*Ie,e[3]=(w*Se-b*ze-M*le)*Ie,e[4]=(c*ke-o*ve-p*Ke)*Ie,e[5]=(t*ve-i*ke+a*Ke)*Ie,e[6]=(z*ie-O*ze-j*K)*Ie,e[7]=(y*ze-w*ie+M*K)*Ie,e[8]=(o*je-l*ke+p*ue)*Ie,e[9]=(n*ke-t*je-a*ue)*Ie,e[10]=(O*Se-N*ie+j*Y)*Ie,e[11]=(b*ie-y*Se-M*Y)*Ie,e[12]=(l*Ke-o*Ce-c*ue)*Ie,e[13]=(t*Ce-n*Ke+i*ue)*Ie,e[14]=(N*K-O*le-z*Y)*Ie,e[15]=(y*le-b*K+w*Y)*Ie,e):null}function GN(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],p=r[7],y=r[8],b=r[9],w=r[10],M=r[11],O=r[12],N=r[13],z=r[14],j=r[15];return e[0]=l*(w*j-M*z)-b*(c*j-p*z)+N*(c*M-p*w),e[1]=-(n*(w*j-M*z)-b*(i*j-a*z)+N*(i*M-a*w)),e[2]=n*(c*j-p*z)-l*(i*j-a*z)+N*(i*p-a*c),e[3]=-(n*(c*M-p*w)-l*(i*M-a*w)+b*(i*p-a*c)),e[4]=-(o*(w*j-M*z)-y*(c*j-p*z)+O*(c*M-p*w)),e[5]=t*(w*j-M*z)-y*(i*j-a*z)+O*(i*M-a*w),e[6]=-(t*(c*j-p*z)-o*(i*j-a*z)+O*(i*p-a*c)),e[7]=t*(c*M-p*w)-o*(i*M-a*w)+y*(i*p-a*c),e[8]=o*(b*j-M*N)-y*(l*j-p*N)+O*(l*M-p*b),e[9]=-(t*(b*j-M*N)-y*(n*j-a*N)+O*(n*M-a*b)),e[10]=t*(l*j-p*N)-o*(n*j-a*N)+O*(n*p-a*l),e[11]=-(t*(l*M-p*b)-o*(n*M-a*b)+y*(n*p-a*l)),e[12]=-(o*(b*z-w*N)-y*(l*z-c*N)+O*(l*w-c*b)),e[13]=t*(b*z-w*N)-y*(n*z-i*N)+O*(n*w-i*b),e[14]=-(t*(l*z-c*N)-o*(n*z-i*N)+O*(n*c-i*l)),e[15]=t*(l*w-c*b)-o*(n*w-i*b)+y*(n*c-i*l),e}function jN(e){var r=e[0],t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],l=e[6],c=e[7],p=e[8],y=e[9],b=e[10],w=e[11],M=e[12],O=e[13],N=e[14],z=e[15],j=r*o-t*a,Y=r*l-n*a,K=r*c-i*a,ie=t*l-n*o,le=t*c-i*o,Se=n*c-i*l,ze=p*O-y*M,ue=p*N-b*M,Ke=p*z-w*M,ke=y*N-b*O,Ce=y*z-w*O,je=b*z-w*N;return j*je-Y*Ce+K*ke+ie*Ke-le*ue+Se*ze}function fd(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=r[4],c=r[5],p=r[6],y=r[7],b=r[8],w=r[9],M=r[10],O=r[11],N=r[12],z=r[13],j=r[14],Y=r[15],K=t[0],ie=t[1],le=t[2],Se=t[3];return e[0]=K*n+ie*l+le*b+Se*N,e[1]=K*i+ie*c+le*w+Se*z,e[2]=K*a+ie*p+le*M+Se*j,e[3]=K*o+ie*y+le*O+Se*Y,K=t[4],ie=t[5],le=t[6],Se=t[7],e[4]=K*n+ie*l+le*b+Se*N,e[5]=K*i+ie*c+le*w+Se*z,e[6]=K*a+ie*p+le*M+Se*j,e[7]=K*o+ie*y+le*O+Se*Y,K=t[8],ie=t[9],le=t[10],Se=t[11],e[8]=K*n+ie*l+le*b+Se*N,e[9]=K*i+ie*c+le*w+Se*z,e[10]=K*a+ie*p+le*M+Se*j,e[11]=K*o+ie*y+le*O+Se*Y,K=t[12],ie=t[13],le=t[14],Se=t[15],e[12]=K*n+ie*l+le*b+Se*N,e[13]=K*i+ie*c+le*w+Se*z,e[14]=K*a+ie*p+le*M+Se*j,e[15]=K*o+ie*y+le*O+Se*Y,e}function Pg(e,r,t){var n=t[0],i=t[1],a=t[2],o,l,c,p,y,b,w,M,O,N,z,j;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],l=r[1],c=r[2],p=r[3],y=r[4],b=r[5],w=r[6],M=r[7],O=r[8],N=r[9],z=r[10],j=r[11],e[0]=o,e[1]=l,e[2]=c,e[3]=p,e[4]=y,e[5]=b,e[6]=w,e[7]=M,e[8]=O,e[9]=N,e[10]=z,e[11]=j,e[12]=o*n+y*i+O*a+r[12],e[13]=l*n+b*i+N*a+r[13],e[14]=c*n+w*i+z*a+r[14],e[15]=p*n+M*i+j*a+r[15]),e}function $y(e,r,t){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function HN(e,r,t,n){var i=n[0],a=n[1],o=n[2],l=Math.hypot(i,a,o),c,p,y,b,w,M,O,N,z,j,Y,K,ie,le,Se,ze,ue,Ke,ke,Ce,je,ve,Ie,dt;return l<du?null:(l=1/l,i*=l,a*=l,o*=l,c=Math.sin(t),p=Math.cos(t),y=1-p,b=r[0],w=r[1],M=r[2],O=r[3],N=r[4],z=r[5],j=r[6],Y=r[7],K=r[8],ie=r[9],le=r[10],Se=r[11],ze=i*i*y+p,ue=a*i*y+o*c,Ke=o*i*y-a*c,ke=i*a*y-o*c,Ce=a*a*y+p,je=o*a*y+i*c,ve=i*o*y+a*c,Ie=a*o*y-i*c,dt=o*o*y+p,e[0]=b*ze+N*ue+K*Ke,e[1]=w*ze+z*ue+ie*Ke,e[2]=M*ze+j*ue+le*Ke,e[3]=O*ze+Y*ue+Se*Ke,e[4]=b*ke+N*Ce+K*je,e[5]=w*ke+z*Ce+ie*je,e[6]=M*ke+j*Ce+le*je,e[7]=O*ke+Y*Ce+Se*je,e[8]=b*ve+N*Ie+K*dt,e[9]=w*ve+z*Ie+ie*dt,e[10]=M*ve+j*Ie+le*dt,e[11]=O*ve+Y*Ie+Se*dt,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Y1(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[4],o=r[5],l=r[6],c=r[7],p=r[8],y=r[9],b=r[10],w=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*i+p*n,e[5]=o*i+y*n,e[6]=l*i+b*n,e[7]=c*i+w*n,e[8]=p*i-a*n,e[9]=y*i-o*n,e[10]=b*i-l*n,e[11]=w*i-c*n,e}function t2(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],p=r[8],y=r[9],b=r[10],w=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i-p*n,e[1]=o*i-y*n,e[2]=l*i-b*n,e[3]=c*i-w*n,e[8]=a*n+p*i,e[9]=o*n+y*i,e[10]=l*n+b*i,e[11]=c*n+w*i,e}function r2(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],p=r[4],y=r[5],b=r[6],w=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+p*n,e[1]=o*i+y*n,e[2]=l*i+b*n,e[3]=c*i+w*n,e[4]=p*i-a*n,e[5]=y*i-o*n,e[6]=b*i-l*n,e[7]=w*i-c*n,e}function eO(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function WN(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $N(e,r,t){var n=t[0],i=t[1],a=t[2],o=Math.hypot(n,i,a),l,c,p;return o<du?null:(o=1/o,n*=o,i*=o,a*=o,l=Math.sin(r),c=Math.cos(r),p=1-c,e[0]=n*n*p+c,e[1]=i*n*p+a*l,e[2]=a*n*p-i*l,e[3]=0,e[4]=n*i*p-a*l,e[5]=i*i*p+c,e[6]=a*i*p+n*l,e[7]=0,e[8]=n*a*p+i*l,e[9]=i*a*p-n*l,e[10]=a*a*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function XN(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ZN(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function YN(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tO(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=n+n,c=i+i,p=a+a,y=n*l,b=n*c,w=n*p,M=i*c,O=i*p,N=a*p,z=o*l,j=o*c,Y=o*p;return e[0]=1-(M+N),e[1]=b+Y,e[2]=w-j,e[3]=0,e[4]=b-Y,e[5]=1-(y+N),e[6]=O+z,e[7]=0,e[8]=w+j,e[9]=O-z,e[10]=1-(y+M),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function qN(e,r){var t=new $f(3),n=-r[0],i=-r[1],a=-r[2],o=r[3],l=r[4],c=r[5],p=r[6],y=r[7],b=n*n+i*i+a*a+o*o;return b>0?(t[0]=(l*o+y*n+c*a-p*i)*2/b,t[1]=(c*o+y*i+p*n-l*a)*2/b,t[2]=(p*o+y*a+l*i-c*n)*2/b):(t[0]=(l*o+y*n+c*a-p*i)*2,t[1]=(c*o+y*i+p*n-l*a)*2,t[2]=(p*o+y*a+l*i-c*n)*2),tO(e,r,t),e}function KN(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function rO(e,r){var t=r[0],n=r[1],i=r[2],a=r[4],o=r[5],l=r[6],c=r[8],p=r[9],y=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(a,o,l),e[2]=Math.hypot(c,p,y),e}function QN(e,r){var t=new $f(3);rO(t,r);var n=1/t[0],i=1/t[1],a=1/t[2],o=r[0]*n,l=r[1]*i,c=r[2]*a,p=r[4]*n,y=r[5]*i,b=r[6]*a,w=r[8]*n,M=r[9]*i,O=r[10]*a,N=o+y+O,z=0;return N>0?(z=Math.sqrt(N+1)*2,e[3]=.25*z,e[0]=(b-M)/z,e[1]=(w-c)/z,e[2]=(l-p)/z):o>y&&o>O?(z=Math.sqrt(1+o-y-O)*2,e[3]=(b-M)/z,e[0]=.25*z,e[1]=(l+p)/z,e[2]=(w+c)/z):y>O?(z=Math.sqrt(1+y-o-O)*2,e[3]=(w-c)/z,e[0]=(l+p)/z,e[1]=.25*z,e[2]=(b+M)/z):(z=Math.sqrt(1+O-o-y)*2,e[3]=(l-p)/z,e[0]=(w+c)/z,e[1]=(b+M)/z,e[2]=.25*z),e}function JN(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=r[3],c=i+i,p=a+a,y=o+o,b=i*c,w=i*p,M=i*y,O=a*p,N=a*y,z=o*y,j=l*c,Y=l*p,K=l*y,ie=n[0],le=n[1],Se=n[2];return e[0]=(1-(O+z))*ie,e[1]=(w+K)*ie,e[2]=(M-Y)*ie,e[3]=0,e[4]=(w-K)*le,e[5]=(1-(b+z))*le,e[6]=(N+j)*le,e[7]=0,e[8]=(M+Y)*Se,e[9]=(N-j)*Se,e[10]=(1-(b+O))*Se,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function e9(e,r,t,n,i){var a=r[0],o=r[1],l=r[2],c=r[3],p=a+a,y=o+o,b=l+l,w=a*p,M=a*y,O=a*b,N=o*y,z=o*b,j=l*b,Y=c*p,K=c*y,ie=c*b,le=n[0],Se=n[1],ze=n[2],ue=i[0],Ke=i[1],ke=i[2],Ce=(1-(N+j))*le,je=(M+ie)*le,ve=(O-K)*le,Ie=(M-ie)*Se,dt=(1-(w+j))*Se,St=(z+Y)*Se,Rt=(O+K)*ze,$t=(z-Y)*ze,gt=(1-(w+N))*ze;return e[0]=Ce,e[1]=je,e[2]=ve,e[3]=0,e[4]=Ie,e[5]=dt,e[6]=St,e[7]=0,e[8]=Rt,e[9]=$t,e[10]=gt,e[11]=0,e[12]=t[0]+ue-(Ce*ue+Ie*Ke+Rt*ke),e[13]=t[1]+Ke-(je*ue+dt*Ke+$t*ke),e[14]=t[2]+ke-(ve*ue+St*Ke+gt*ke),e[15]=1,e}function t9(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t+t,l=n+n,c=i+i,p=t*o,y=n*o,b=n*l,w=i*o,M=i*l,O=i*c,N=a*o,z=a*l,j=a*c;return e[0]=1-b-O,e[1]=y+j,e[2]=w-z,e[3]=0,e[4]=y-j,e[5]=1-p-O,e[6]=M+N,e[7]=0,e[8]=w+z,e[9]=M-N,e[10]=1-p-b,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function r9(e,r,t,n,i,a,o){var l=1/(t-r),c=1/(i-n),p=1/(a-o);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(t+r)*l,e[9]=(i+n)*c,e[10]=(o+a)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*p,e[15]=0,e}function nO(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var xw=nO;function n9(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(n-i),e[10]=i*o,e[14]=i*n*o):(e[10]=-1,e[14]=-n),e}function i9(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),o=Math.tan(r.leftDegrees*Math.PI/180),l=Math.tan(r.rightDegrees*Math.PI/180),c=2/(o+l),p=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-((o-l)*c*.5),e[9]=(i-a)*p*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function iO(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),p=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=(o+a)*p,e[15]=1,e}var a9=iO;function o9(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),p=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=a*p,e[15]=1,e}function aO(e,r,t,n){var i,a,o,l,c,p,y,b,w,M,O=r[0],N=r[1],z=r[2],j=n[0],Y=n[1],K=n[2],ie=t[0],le=t[1],Se=t[2];return Math.abs(O-ie)<du&&Math.abs(N-le)<du&&Math.abs(z-Se)<du?JR(e):(y=O-ie,b=N-le,w=z-Se,M=1/Math.hypot(y,b,w),y*=M,b*=M,w*=M,i=Y*w-K*b,a=K*y-j*w,o=j*b-Y*y,M=Math.hypot(i,a,o),M?(M=1/M,i*=M,a*=M,o*=M):(i=0,a=0,o=0),l=b*o-w*a,c=w*i-y*o,p=y*a-b*i,M=Math.hypot(l,c,p),M?(M=1/M,l*=M,c*=M,p*=M):(l=0,c=0,p=0),e[0]=i,e[1]=l,e[2]=y,e[3]=0,e[4]=a,e[5]=c,e[6]=b,e[7]=0,e[8]=o,e[9]=p,e[10]=w,e[11]=0,e[12]=-(i*O+a*N+o*z),e[13]=-(l*O+c*N+p*z),e[14]=-(y*O+b*N+w*z),e[15]=1,e)}function s9(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=n[0],c=n[1],p=n[2],y=i-t[0],b=a-t[1],w=o-t[2],M=y*y+b*b+w*w;M>0&&(M=1/Math.sqrt(M),y*=M,b*=M,w*=M);var O=c*w-p*b,N=p*y-l*w,z=l*b-c*y;return M=O*O+N*N+z*z,M>0&&(M=1/Math.sqrt(M),O*=M,N*=M,z*=M),e[0]=O,e[1]=N,e[2]=z,e[3]=0,e[4]=b*z-w*N,e[5]=w*O-y*z,e[6]=y*N-b*O,e[7]=0,e[8]=y,e[9]=b,e[10]=w,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function u9(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function l9(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function c9(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function oO(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function f9(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function h9(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function p9(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function MC(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],l=e[5],c=e[6],p=e[7],y=e[8],b=e[9],w=e[10],M=e[11],O=e[12],N=e[13],z=e[14],j=e[15],Y=r[0],K=r[1],ie=r[2],le=r[3],Se=r[4],ze=r[5],ue=r[6],Ke=r[7],ke=r[8],Ce=r[9],je=r[10],ve=r[11],Ie=r[12],dt=r[13],St=r[14],Rt=r[15];return Math.abs(t-Y)<=du*Math.max(1,Math.abs(t),Math.abs(Y))&&Math.abs(n-K)<=du*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(i-ie)<=du*Math.max(1,Math.abs(i),Math.abs(ie))&&Math.abs(a-le)<=du*Math.max(1,Math.abs(a),Math.abs(le))&&Math.abs(o-Se)<=du*Math.max(1,Math.abs(o),Math.abs(Se))&&Math.abs(l-ze)<=du*Math.max(1,Math.abs(l),Math.abs(ze))&&Math.abs(c-ue)<=du*Math.max(1,Math.abs(c),Math.abs(ue))&&Math.abs(p-Ke)<=du*Math.max(1,Math.abs(p),Math.abs(Ke))&&Math.abs(y-ke)<=du*Math.max(1,Math.abs(y),Math.abs(ke))&&Math.abs(b-Ce)<=du*Math.max(1,Math.abs(b),Math.abs(Ce))&&Math.abs(w-je)<=du*Math.max(1,Math.abs(w),Math.abs(je))&&Math.abs(M-ve)<=du*Math.max(1,Math.abs(M),Math.abs(ve))&&Math.abs(O-Ie)<=du*Math.max(1,Math.abs(O),Math.abs(Ie))&&Math.abs(N-dt)<=du*Math.max(1,Math.abs(N),Math.abs(dt))&&Math.abs(z-St)<=du*Math.max(1,Math.abs(z),Math.abs(St))&&Math.abs(j-Rt)<=du*Math.max(1,Math.abs(j),Math.abs(Rt))}var d9=fd,v9=oO;const m9=Object.freeze(Object.defineProperty({__proto__:null,create:kp,clone:KR,copy:zN,fromValues:QR,set:UN,identity:JR,transpose:VN,invert:_w,adjoint:GN,determinant:jN,multiply:fd,translate:Pg,scale:$y,rotate:HN,rotateX:Y1,rotateY:t2,rotateZ:r2,fromTranslation:eO,fromScaling:WN,fromRotation:$N,fromXRotation:XN,fromYRotation:ZN,fromZRotation:YN,fromRotationTranslation:tO,fromQuat2:qN,getTranslation:KN,getScaling:rO,getRotation:QN,fromRotationTranslationScale:JN,fromRotationTranslationScaleOrigin:e9,fromQuat:t9,frustum:r9,perspectiveNO:nO,perspective:xw,perspectiveZO:n9,perspectiveFromFieldOfView:i9,orthoNO:iO,ortho:a9,orthoZO:o9,lookAt:aO,targetTo:s9,str:u9,frob:l9,add:c9,subtract:oO,multiplyScalar:f9,multiplyScalarAndAdd:h9,exactEquals:p9,equals:MC,mul:d9,sub:v9},Symbol.toStringTag,{value:"Module"}));function ky(){var e=new $f(3);return $f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function g9(e){var r=new $f(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function sO(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function Lc(e,r,t){var n=new $f(3);return n[0]=e,n[1]=r,n[2]=t,n}function y9(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function _9(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function x9(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function uO(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function lO(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function cO(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function b9(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function E9(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function C9(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function S9(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function w9(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function A9(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function T9(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function fO(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function hO(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function pO(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function dO(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function M9(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Ry(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function vO(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function mO(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],l=t[1],c=t[2];return e[0]=i*c-a*l,e[1]=a*o-n*c,e[2]=n*l-i*o,e}function I9(e,r,t,n){var i=r[0],a=r[1],o=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e}function L9(e,r,t,n,i,a){var o=a*a,l=o*(2*a-3)+1,c=o*(a-2)+a,p=o*(a-1),y=o*(3-2*a);return e[0]=r[0]*l+t[0]*c+n[0]*p+i[0]*y,e[1]=r[1]*l+t[1]*c+n[1]*p+i[1]*y,e[2]=r[2]*l+t[2]*c+n[2]*p+i[2]*y,e}function k9(e,r,t,n,i,a){var o=1-a,l=o*o,c=a*a,p=l*o,y=3*a*l,b=3*c*o,w=c*a;return e[0]=r[0]*p+t[0]*y+n[0]*b+i[0]*w,e[1]=r[1]*p+t[1]*y+n[1]*b+i[1]*w,e[2]=r[2]*p+t[2]*y+n[2]*b+i[2]*w,e}function R9(e,r){r=r||1;var t=PT()*2*Math.PI,n=PT()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function Z_(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[3]*n+t[7]*i+t[11]*a+t[15];return o=o||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/o,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/o,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/o,e}function O9(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function P9(e,r,t){var n=t[0],i=t[1],a=t[2],o=t[3],l=r[0],c=r[1],p=r[2],y=i*p-a*c,b=a*l-n*p,w=n*c-i*l,M=i*w-a*b,O=a*y-n*w,N=n*b-i*y,z=o*2;return y*=z,b*=z,w*=z,M*=2,O*=2,N*=2,e[0]=l+y+M,e[1]=c+b+O,e[2]=p+w+N,e}function F9(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function D9(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function B9(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function IC(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2],c=Math.sqrt(t*t+n*n+i*i),p=Math.sqrt(a*a+o*o+l*l),y=c*p,b=y&&vO(e,r)/y;return Math.acos(Math.min(Math.max(b,-1),1))}function N9(e){return e[0]=0,e[1]=0,e[2]=0,e}function z9(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function U9(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function V9(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2];return Math.abs(t-a)<=du*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-o)<=du*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=du*Math.max(1,Math.abs(i),Math.abs(l))}var LC=uO,G9=lO,j9=cO,H9=fO,W9=hO,$9=sO,X9=pO,Z9=function(){var e=ky();return function(r,t,n,i,a,o){var l,c;for(t||(t=3),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2];return r}}();const uE=Object.freeze(Object.defineProperty({__proto__:null,create:ky,clone:g9,length:sO,fromValues:Lc,copy:y9,set:_9,add:x9,subtract:uO,multiply:lO,divide:cO,ceil:b9,floor:E9,min:C9,max:S9,round:w9,scale:A9,scaleAndAdd:T9,distance:fO,squaredDistance:hO,squaredLength:pO,negate:dO,inverse:M9,normalize:Ry,dot:vO,cross:mO,lerp:I9,hermite:L9,bezier:k9,random:R9,transformMat4:Z_,transformMat3:O9,transformQuat:P9,rotateX:F9,rotateY:D9,rotateZ:B9,angle:IC,zero:N9,str:z9,exactEquals:U9,equals:V9,sub:LC,mul:G9,div:j9,dist:H9,sqrDist:W9,len:$9,sqrLen:X9,forEach:Z9},Symbol.toStringTag,{value:"Module"}));function gO(){var e=new $f(4);return $f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Y9(e,r,t,n){var i=new $f(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function q9(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function bw(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,e}(function(){var e=gO();return function(r,t,n,i,a,o){var l,c;for(t||(t=4),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],e[3]=r[l+3],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2],r[l+3]=e[3];return r}})();function Va(){var e=new $f(2);return $f!=Float32Array&&(e[0]=0,e[1]=0),e}function Xy(e,r){var t=new $f(2);return t[0]=e,t[1]=r,t}function Fv(e,r){return e[0]=r[0],e[1]=r[1],e}function yO(e,r,t){return e[0]=r,e[1]=t,e}function qu(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function Mg(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function K9(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Gv(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function mm(e,r){return e[0]*r[0]+e[1]*r[1]}function Q9(e,r,t,n){var i=r[0],a=r[1];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e}var Zy=Mg;(function(){var e=Va();return function(r,t,n,i,a,o){var l,c;for(t||(t=2),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],a(e,e,o),r[l]=e[0],r[l+1]=e[1];return r}})();var Cx=Va();Va();var Nl=Va(),K0=Va(),hy=Va();function lE(e,r,t,n,i){qu(e,t,n),Gv(e,e),r=Xy(-e[1],e[0]);var a=Xy(-t[1],t[0]);return[i/mm(r,a),r]}function Q0(e,r){return yO(e,-r[1],r[0])}function py(e,r,t){return Zy(e,r,t),Gv(e,e),e}function cE(e,r){return e[0]===r[0]&&e[1]===r[1]}var J9=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Kt(this,e),ne(this,"lastFlip",-1),ne(this,"miter",Xy(0,0)),ne(this,"started",!1),ne(this,"dash",!1),ne(this,"totalDistance",0),ne(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Qt(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,y,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var w=n[l-1],M=t[l];M.push((p=n[l][2])!==null&&p!==void 0?p:0);var O=n[l],N=l<t.length-1?[].concat(zn(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,z=l<n.length-1?n[l+1]:null,j=this.segment_gaode2(i,o,b,M,N,w,O,z);o+=j}if(this.dash)for(var Y=0;Y<i.positions.length/6;Y++)i.positions[Y*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,y,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var w=n[l-1],M=t[l];M.push((p=n[l][2])!==null&&p!==void 0?p:0);var O=n[l],N=l<t.length-1?[].concat(zn(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,z=l<n.length-1?n[l+1]:null,j=this.simpleSegment(i,o,b,M,N,w,O,z);o+=j}if(this.dash)for(var Y=0;Y<i.positions.length/6;Y++)i.positions[Y*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,y=this.segment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,y=this.simpleSegment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,p){var y=0,b=t.indices,w=t.positions,M=t.normals,O=this.cap==="square",N=this.join==="bevel",z=Ic([c[0],c[1]]),j=Ic([l[0],l[1]]);py(Nl,a,i);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(z,j),this.totalDistance+=Y),this.normal||(this.normal=Va(),Q0(this.normal,Nl)),!this.started)if(this.started=!0,O){var K=Va(),ie=Va();qu(K,this.normal,Nl),qu(ie,this.normal,Nl),M.push(ie[0],ie[1],0),M.push(K[0],K[1],0),w.push(i[0],i[1],i[2]|0,this.totalDistance-Y,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),w.push(i[0],i[1],i[2]|0,this.totalDistance-Y,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,M,i,this.normal,this.thickness,this.totalDistance-Y);if(b.push(n+0,n+1,n+2),o){cE(a,o)&&qu(o,a,Gv(o,Mg(o,a,i))),py(K0,o,a);var ze=lE(hy,Va(),Nl,K0,this.thickness),ue=Pi(ze,2),Ke=ue[0],ke=ue[1],Ce=mm(hy,this.normal)<0?-1:1,je=N;if(!je&&this.join==="miter"){var ve=Ke;ve>this.miterLimit&&(je=!0)}je?(M.push(this.normal[0],this.normal[1],0),M.push(ke[0],ke[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,zn(this.lastFlip!==-Ce?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Q0(Cx,K0),Fv(this.normal,Cx),M.push(this.normal[0],this.normal[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(w,M,a,ke,Ke,this.totalDistance),b.push.apply(b,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ce=-1,Fv(this.normal,ke),y+=2),this.lastFlip=Ce}else{if(Q0(this.normal,Nl),O){var le=Va(),Se=Va();Zy(Se,Nl,this.normal),qu(le,Nl,this.normal),M.push(Se[0],Se[1],0),M.push(le[0],le[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,M,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,y=t.normals,b=Ic([a[0],a[1]]),w=Ic([i[0],i[1]]);py(Nl,b,w);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,w),this.totalDistance+=M),this.normal||(this.normal=Va(),Q0(this.normal,Nl)),this.started||(this.started=!0,this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-M)),c.push(n+0,n+1,n+2),!o)Q0(this.normal,Nl),this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Ic([o[0],o[1]]);cE(b,O)&&qu(O,b,Gv(O,Mg(O,b,w))),py(K0,O,b);var N=lE(hy,Va(),Nl,K0,this.thickness),z=Pi(N,2),j=z[0],Y=z[1],K=mm(hy,this.normal)<0?-1:1;this.extrusions(p,y,a,Y,j,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),K=-1,Fv(this.normal,Y),l+=2,this.lastFlip=K}return l}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,y=t.normals,b=this.cap==="square",w=this.join==="bevel",M=Ic([a[0],a[1]]),O=Ic([i[0],i[1]]);py(Nl,M,O);var N=0;if(this.dash&&(N=this.lineSegmentDistance(M,O),this.totalDistance+=N),this.normal||(this.normal=Va(),Q0(this.normal,Nl)),!this.started)if(this.started=!0,b){var z=Va(),j=Va();qu(z,this.normal,Nl),qu(j,this.normal,Nl),y.push(j[0],j[1],0),y.push(z[0],z[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-N,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-N,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-N);if(c.push(n+0,n+1,n+2),o){var ie=Ic([o[0],o[1]]);cE(M,ie)&&qu(ie,M,Gv(ie,Mg(ie,M,O))),py(K0,ie,M);var le=lE(hy,Va(),Nl,K0,this.thickness),Se=Pi(le,2),ze=Se[0],ue=Se[1],Ke=mm(hy,this.normal)<0?-1:1,ke=w;if(!ke&&this.join==="miter"){var Ce=ze;Ce>this.miterLimit&&(ke=!0)}ke?(y.push(this.normal[0],this.normal[1],0),y.push(ue[0],ue[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,zn(this.lastFlip!==-Ke?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Q0(Cx,K0),Fv(this.normal,Cx),y.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,y,a,ue,ze,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ke=-1,Fv(this.normal,ue),l+=2),this.lastFlip=Ke}else{if(Q0(this.normal,Nl),b){var Y=Va(),K=Va();Zy(K,Nl,this.normal),qu(Y,Nl,this.normal),y.push(K[0],K[1],0),y.push(Y[0],Y[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function kC(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new J9({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=o[l];i.extrude_gaode2(c,p)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(w){i.extrude(w)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function Yx(e){var r=cd(e.coordinates);return{vertices:[].concat(zn(r),zn(r),zn(r),zn(r)),indices:[0,1,2,2,3,0],size:r.length}}function _O(e){var r=e.coordinates,t=jv.exports.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:jv.exports(n,a,i),vertices:n,size:i}}var ez=function(){var e=eo(Xn.mark(function r(t){var n,i,a,o,l,c,p,y,b;return Xn.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.iconMap,l={a_Color:vw,a_Position:mw,filter:gw,a_vertexId:yw,a_PickingColor:function(N,z){var j=N.id;return a?bm(j):[0,0,0]},a_DistanceAndIndex:function(N,z,j,Y,K,ie){return ie===void 0?[j[3],10]:[j[3],ie]},a_Total_Distance:function(N,z,j,Y){return[j[5]]},a_Size:function(N,z,j,Y){var K=N.size,ie=K===void 0?1:K;return Array.isArray(ie)?[ie[0],ie[1]]:[ie,0]},a_Normal:function(N,z,j,Y,K){return K},a_Miter:function(N,z,j,Y){return[j[4]]},a_iconMapUV:function(N,z,j,Y){var K=N.texture,ie=o[K]||{x:0,y:0},le=ie.x,Se=ie.y;return[le,Se]}},c={sizePerElement:0,elements:[]},p=0,y=[],b=3,i.forEach(function(O,N){var z=kC(O),j=z.indices,Y=z.vertices,K=z.normals,ie=z.size,le=z.indexes;j.forEach(function(Ke){y.push(Ke+p)}),b=ie;var Se=Y.length/ie;c.sizePerElement=b,c.elements.push({featureIdx:N,vertices:Y,normals:K,offset:p}),p+=Se;for(var ze=function(ke){var Ce=(K==null?void 0:K.slice(ke*3,ke*3+3))||[],je=Y.slice(ke*ie,ke*ie+ie),ve=0;le&&le[ke]!==void 0&&(ve=le[ke]),n.forEach(function(Ie,dt){if(Ie&&l[Ie.name]){var St;(St=Ie.buffer.data).push.apply(St,zn(l[Ie.name](O,N,je,ke,Ce,ve)))}})},ue=0;ue<Se;ue++)ze(ue)}),M.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),tz=function(){var e=eo(Xn.mark(function r(t){var n,i,a,o,l,c,p,y,b;return Xn.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.shape2d,l={a_Color:vw,a_Position:mw,filter:gw,a_vertexId:yw,a_PickingColor:function(N,z){var j=N.id;return a?bm(j):[0,0,0]},a_Shape:function(N,z,j,Y){var K=N.shape,ie=K===void 0?2:K,le=o.indexOf(ie);return[le]},a_Extrude:function(N,z,j,Y){var K=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],ie=Y%4*3;return[K[ie],K[ie+1],K[ie+2]]},a_Size:function(N,z,j,Y){var K=N.size,ie=K===void 0?5:K;return Array.isArray(ie)?[ie[0]]:[ie]}},c={sizePerElement:0,elements:[]},p=0,y=[],b=3,i.forEach(function(O,N){var z=Yx(O),j=z.indices,Y=z.vertices,K=z.normals,ie=z.size,le=z.indexes;j.forEach(function(Ke){y.push(Ke+p)}),b=ie;var Se=Y.length/ie;c.sizePerElement=b,c.elements.push({featureIdx:N,vertices:Y,normals:K,offset:p}),p+=Se;for(var ze=function(ke){var Ce=(K==null?void 0:K.slice(ke*3,ke*3+3))||[],je=Y.slice(ke*ie,ke*ie+ie),ve=0;le&&le[ke]!==void 0&&(ve=le[ke]),n.forEach(function(Ie,dt){if(Ie&&l[Ie.name]){var St;(St=Ie.buffer.data).push.apply(St,zn(l[Ie.name](O,N,je,ke,Ce,ve)))}})},ue=0;ue<Se;ue++)ze(ue)}),M.abrupt("return",{descriptors:n,featureLayout:c,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),rz=function(){var e=eo(Xn.mark(function r(t){var n,i,a,o,l,c,p,y;return Xn.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o={a_Color:vw,a_Position:mw,filter:gw,a_vertexId:yw,a_PickingColor:function(O,N){var z=O.id;return a?bm(z):[0,0,0]}},l={sizePerElement:0,elements:[]},c=0,p=[],y=3,i.forEach(function(M,O){var N=_O(M),z=N.indices,j=N.vertices,Y=N.normals,K=N.size,ie=N.indexes;z.forEach(function(ue){p.push(ue+c)}),y=K;var le=j.length/K;l.sizePerElement=y,l.elements.push({featureIdx:O,vertices:j,normals:Y,offset:c}),c+=le;for(var Se=function(Ke){var ke=(Y==null?void 0:Y.slice(Ke*3,Ke*3+3))||[],Ce=j.slice(Ke*K,Ke*K+K),je=0;ie&&ie[Ke]!==void 0&&(je=ie[Ke]),n.forEach(function(ve,Ie){if(ve&&o[ve.name]){var dt;(dt=ve.buffer.data).push.apply(dt,zn(o[ve.name](M,O,Ce,Ke,ke,je)))}})},ze=0;ze<le;ze++)Se(ze)}),w.abrupt("return",{descriptors:n,featureLayout:l,indices:p});case 8:case"end":return w.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),xO={pointFill:tz,line:ez,polygonFill:rz},FT=tr({},xO);function nz(e){return RC.apply(this,arguments)}function RC(){return RC=eo(Xn.mark(function e(r){var t,n;return Xn.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!FT[t]){a.next=3;break}return a.abrupt("return",FT[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),RC.apply(this,arguments)}bN(nz);var bO=new Map;function iz(e,r){bO.set(e,r)}function az(e){var r=bO.get(e);return r}var I1="l7-worker",oz=3,sz=!0;function uz(e){iz(I1,e)}function lz(){var e=az(I1);if(!e)throw new Error("get worker failed by workerName: ".concat(I1,"."));return e}function cz(e,r){return OC.apply(this,arguments)}function OC(){return OC=eo(Xn.mark(function e(r,t){var n,i,a,o,l;return Xn.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=lz(),i=vN.getWorkerFarm({maxConcurrency:oz,reuseWorkers:sz}),a=i.getWorkerPool({name:I1,source:n}),p.next=5,a.startJob(I1,function(y,b,w){return y.done(w)});case 5:return o=p.sent,o.postMessage("process",{input:{workerType:r,data:t}}),p.next=9,o.result;case 9:return l=p.sent,p.abrupt("return",l.result);case 11:case"end":return p.stop()}},e)})),OC.apply(this,arguments)}uz(CN);var rg={BACK:1029,FRONT:1028};function n2(e){switch(e){case"GAODE1.x":return rg.BACK;case"GAODE2.x":return rg.BACK;case"MAPBOX":return rg.FRONT;case"SIMPLE":return rg.FRONT;case"GLOBEL":return rg.BACK;case"L7MAP":return rg.FRONT;default:return rg.FRONT}}function Ew(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z;if(Array.isArray(e)){var a=Math.abs(t+n)%e.length;e=e[a]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}var zy;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(zy||(zy={}));var Mp;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Mp||(Mp={}));function fz(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[t,n],l=[t,a],c=[i,a],p=[i,n];return sw([[o,p,c,l,o]],r.properties,{bbox:e,id:r.id})}var EO=0,DT=1,i2=2;function hz(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function pz(e){e.forEach(function(r){r.properties.state=EO}),e.forEach(function(r){r.isCurrent&&!CO(r)&&Cw(r)}),e.forEach(function(r){r.isVisible=Boolean(r.properties.state&i2)})}function dz(e){e.forEach(function(t){t.properties.state=EO}),e.forEach(function(t){t.isCurrent&&CO(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=Boolean(t.properties.state&i2),t.children.length&&(t.isVisible||t.properties.state&DT)?t.children.forEach(function(n){n.properties.state=DT}):t.isCurrent&&Cw(t)})}function CO(e){for(;e;){if(e.isLoaded)return e.properties.state|=i2,!0;e=e.parent}return!1}function Cw(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=i2:Cw(r)})}var I_,SO=[-1/0,-1/0,1/0,1/0],vz=.2,mz=5,gz=(I_={},ne(I_,zy.Realtime,hz),ne(I_,zy.Overlap,pz),ne(I_,zy.Replace,dz),I_),yz=function(){};function PC(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function BT(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var _z=function(r,t,n){var i=BT(r,t,n),a=Pi(i,2),o=a[0],l=a[1],c=BT(r+1,t+1,n),p=Pi(c,2),y=p[0],b=p[1];return[o,b,y,l]};function xz(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,a=e.minZoom,o=a===void 0?0:a,l=e.zoomOffset,c=l===void 0?0:l,p=e.extent,y=p===void 0?SO:p,b=Math.ceil(r)+c;if(Number.isFinite(o)&&b<o)return[];Number.isFinite(i)&&b>i&&(b=i);for(var w=Pi(t,4),M=w[0],O=w[1],N=w[2],z=w[3],j=[Math.max(M,y[0]),Math.max(O,y[1]),Math.min(N,y[2]),Math.min(z,y[3])],Y=[],K=PC(j[0],j[1],b),ie=Pi(K,2),le=ie[0],Se=ie[1],ze=PC(j[2],j[3],b),ue=Pi(ze,2),Ke=ue[0],ke=ue[1],Ce=le;Ce<=Ke;Ce++)for(var je=ke;je<=Se;je++)Y.push({x:Ce,y:je,z:b});var ve=(Ke+le)/2,Ie=(Se+ke)/2,dt=function(Rt,$t){return Math.abs(Rt-ve)+Math.abs($t-Ie)};return Y.sort(function(St,Rt){return dt(St.x,St.y)-dt(Rt.x,Rt.y)}),Y}var bz=function(r,t,n){var i=Math.pow(2,n),a=i-1,o=i,l=r,c=t;return l<0?l=l+o:l>a&&(l=l%o),{warpX:l,warpY:c}},Ez=function(){function e(r){Kt(this,e),ne(this,"tileSize",256),ne(this,"isVisible",!1),ne(this,"isCurrent",!1),ne(this,"isVisibleChange",!1),ne(this,"parentLayerIDList",[]),ne(this,"layerIDList",[]),ne(this,"parent",null),ne(this,"children",[]),ne(this,"data",null),ne(this,"properties",{}),ne(this,"loadDataId",0);var t=r.x,n=r.y,i=r.z,a=r.tileSize;this.x=t,this.y=n,this.z=i,this.tileSize=a}return Qt(e,[{key:"isLoading",get:function(){return this.loadStatus===Mp.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Mp.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Mp.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Mp.Cancelled}},{key:"isDone",get:function(){return[Mp.Loaded,Mp.Cancelled,Mp.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return _z(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=Pi(this.bounds,4),n=t[0],i=t[1],a=t[2],o=t[3],l=[(a-n)/2,(o-i)/2],c=fz(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:l,meta:`
      `.concat(this.key,`
      `)}});return c}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var r=eo(Xn.mark(function n(i){var a,o,l,c,p,y,b,w,M,O,N,z,j,Y,K,ie;return Xn.wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return a=i.getData,o=i.onLoad,l=i.onError,this.loadDataId++,c=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Mp.Loading,p=null,Se.prev=7,b=this.x,w=this.y,M=this.z,O=this.bounds,N=this.tileSize,z=bz(b,w,M),j=z.warpX,Y=z.warpY,K=this.abortController.signal,ie={x:j,y:Y,z:M,bounds:O,tileSize:N,signal:K},Se.next=14,a(ie,this);case 14:p=Se.sent,Se.next=20;break;case 17:Se.prev=17,Se.t0=Se.catch(7),y=Se.t0;case 20:if(c===this.loadDataId){Se.next=22;break}return Se.abrupt("return");case 22:if(!(this.isCancelled&&!p)){Se.next=24;break}return Se.abrupt("return");case 24:if(!(y||!p)){Se.next=28;break}return this.loadStatus=Mp.Failure,l(y,this),Se.abrupt("return");case 28:this.loadStatus=Mp.Loaded,this.data=p,o(this);case 31:case"end":return Se.stop()}},n,this,[[7,17]])}));function t(n){return r.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Mp.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),Zd={exports:{}};(function(e){var r=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,p,y){this.fn=c,this.context=p,this.once=y||!1}function a(c,p,y,b,w){if(typeof y!="function")throw new TypeError("The listener must be a function");var M=new i(y,b||c,w),O=t?t+p:p;return c._events[O]?c._events[O].fn?c._events[O]=[c._events[O],M]:c._events[O].push(M):(c._events[O]=M,c._eventsCount++),c}function o(c,p){--c._eventsCount===0?c._events=new n:delete c._events[p]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var p=[],y,b;if(this._eventsCount===0)return p;for(b in y=this._events)r.call(y,b)&&p.push(t?b.slice(1):b);return Object.getOwnPropertySymbols?p.concat(Object.getOwnPropertySymbols(y)):p},l.prototype.listeners=function(p){var y=t?t+p:p,b=this._events[y];if(!b)return[];if(b.fn)return[b.fn];for(var w=0,M=b.length,O=new Array(M);w<M;w++)O[w]=b[w].fn;return O},l.prototype.listenerCount=function(p){var y=t?t+p:p,b=this._events[y];return b?b.fn?1:b.length:0},l.prototype.emit=function(p,y,b,w,M,O){var N=t?t+p:p;if(!this._events[N])return!1;var z=this._events[N],j=arguments.length,Y,K;if(z.fn){switch(z.once&&this.removeListener(p,z.fn,void 0,!0),j){case 1:return z.fn.call(z.context),!0;case 2:return z.fn.call(z.context,y),!0;case 3:return z.fn.call(z.context,y,b),!0;case 4:return z.fn.call(z.context,y,b,w),!0;case 5:return z.fn.call(z.context,y,b,w,M),!0;case 6:return z.fn.call(z.context,y,b,w,M,O),!0}for(K=1,Y=new Array(j-1);K<j;K++)Y[K-1]=arguments[K];z.fn.apply(z.context,Y)}else{var ie=z.length,le;for(K=0;K<ie;K++)switch(z[K].once&&this.removeListener(p,z[K].fn,void 0,!0),j){case 1:z[K].fn.call(z[K].context);break;case 2:z[K].fn.call(z[K].context,y);break;case 3:z[K].fn.call(z[K].context,y,b);break;case 4:z[K].fn.call(z[K].context,y,b,w);break;default:if(!Y)for(le=1,Y=new Array(j-1);le<j;le++)Y[le-1]=arguments[le];z[K].fn.apply(z[K].context,Y)}}return!0},l.prototype.on=function(p,y,b){return a(this,p,y,b,!1)},l.prototype.once=function(p,y,b){return a(this,p,y,b,!0)},l.prototype.removeListener=function(p,y,b,w){var M=t?t+p:p;if(!this._events[M])return this;if(!y)return o(this,M),this;var O=this._events[M];if(O.fn)O.fn===y&&(!w||O.once)&&(!b||O.context===b)&&o(this,M);else{for(var N=0,z=[],j=O.length;N<j;N++)(O[N].fn!==y||w&&!O[N].once||b&&O[N].context!==b)&&z.push(O[N]);z.length?this._events[M]=z.length===1?z[0]:z:o(this,M)}return this},l.prototype.removeAllListeners=function(p){var y;return p?(y=t?t+p:p,this._events[y]&&o(this,y)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,e.exports=l})(Zd);const Sw=Zd.exports;var Cz=function(r,t){var n=fb(r),i=Kb(n,t),a=360*3-180,o=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-o),Math.min(i[1][0],a),Math.min(i[1][1],o)];return l},Sz=function(r,t){var n=fb(r),i=fb(t),a=VR(n,i);return a};function J0(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=wz(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function wz(e,r){if(!!e){if(typeof e=="string")return NT(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return NT(e,r)}}function NT(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Az(e){var r=Tz();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Tz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Mz=function(e){On(t,e);var r=Az(t);function t(n){var i;return Kt(this,t),i=r.call(this),ne(vt(i),"currentTiles",[]),ne(vt(i),"cacheTiles",new Map),ne(vt(i),"onTileLoad",function(a){i.emit("tile-loaded",a),i.updateTileVisible()}),ne(vt(i),"onTileError",function(a,o){i.emit("tile-error",{error:a,tile:o}),i.updateTileVisible()}),ne(vt(i),"onTileUnload",function(a){i.emit("tile-unload",a)}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:SO,getTileData:yz,updateStrategy:zy.Replace},i.updateOptions(n),i}return Qt(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,o){return a.z-o.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),o=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=tr(tr(tr({},this.options),i),{},{minZoom:a,maxZoom:o})}},{key:"update",value:function(i,a){var o=this,l=Math.ceil(i);if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Sz(this.lastViewStates.latLonBoundsBuffer,a))){var c=Cz(a,vz);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:c};var p=!1,y=this.getTileIndices(l,c);this.currentTiles=y.map(function(b){var w=b.x,M=b.y,O=b.z,N=o.getTile(w,M,O);if(N){var z,j,Y=((z=N)===null||z===void 0?void 0:z.isFailure)||((j=N)===null||j===void 0?void 0:j.isCancelled);return Y&&N.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),N}return N=o.createTile(w,M,O),p=!0,N}),p&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=J0(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var o=Pi(a.value,2),l=o[0],c=o[1];this.currentTiles.includes(c)||(this.cacheTiles.delete(l),this.onTileUnload(c)),this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(p){i.e(p)}finally{i.f()}}},{key:"pruneRequests",value:function(){var i=[],a=J0(this.cacheTiles.values()),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(p){a.e(p)}finally{a.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"destroy",value:function(){var i=J0(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isLoading&&o.abortLoad()}}catch(l){i.e(l)}finally{i.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,o=J0(this.cacheTiles.values()),l;try{for(o.s();!(l=o.n()).done;){var c=l.value;a.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(O){o.e(O)}finally{o.f()}var p=J0(this.currentTiles),y;try{for(p.s();!(y=p.n()).done;){var b=y.value;b.isCurrent=!0,b.isVisible=!0}}catch(O){p.e(O)}finally{p.f()}var w=Array.from(this.cacheTiles.values());typeof i=="function"?i(w):gz[i](w);var M=!1;Array.from(this.cacheTiles.values()).forEach(function(O){O.isVisible!==a.get(O.key)?(O.isVisibleChange=!0,M=!0):O.isVisibleChange=!1}),M&&this.emit("tile-update")}},{key:"getTileIndices",value:function(i,a){var o=this.options,l=o.tileSize,c=o.extent,p=o.zoomOffset,y=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),w=xz({maxZoom:y,minZoom:b,zoomOffset:p,tileSize:l,zoom:i,latLonBounds:a,extent:c});return w}},{key:"getTileId",value:function(i,a,o){var l="".concat(i,",").concat(a,",").concat(o);return l}},{key:"getTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=this.cacheTiles.get(l);return c}},{key:"createTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=new Ez({x:i,y:a,z:o,tileSize:this.options.tileSize});return this.cacheTiles.set(l,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=mz*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var o=J0(this.cacheTiles),l;try{for(o.s();!(l=o.n()).done;){var c=Pi(l.value,2),p=c[0],y=c[1];if(!y.isVisible&&!this.currentTiles.includes(y)&&(this.cacheTiles.delete(p),this.onTileUnload(y)),this.cacheTiles.size<=i)break}}catch(b){o.e(b)}finally{o.f()}}}},{key:"rebuildTileTree",value:function(){var i=J0(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.parent=null,o.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=J0(this.cacheTiles.values()),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,y=this.getNearestAncestor(p.x,p.y,p.z);p.parent=y,y!=null&&y.children&&y.children.push(p)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,o){for(;o>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),o=o-1;var l=this.getTile(i,a,o);if(l)return l}return null}}]),t}(Sw),zT;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(zT||(zT={}));function wO(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=new Promise(function(o){e instanceof HTMLImageElement||OB(e)?o([e]):Iz(e,function(l){o(l)})}),a={originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return a}function Iz(e,r){var t=e,n=[];if(typeof t=="string")CC({url:t},function(o,l){l&&(n.push(l),r(n))});else{var i=t.length,a=0;t.forEach(function(o){CC({url:o},function(l,c){a++,c&&n.push(c),a===i&&r(n)})})}return wO}var Lz=Uy;function Uy(e,r){this.x=e,this.y=r}Uy.prototype={clone:function(){return new Uy(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,t=e.y-this.y;return r*r+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[0]*this.x+e[1]*this.y,t=e[2]*this.x+e[3]*this.y;return this.x=r,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),t=Math.sin(e),n=r*this.x-t*this.y,i=t*this.x+r*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,r){var t=Math.cos(e),n=Math.sin(e),i=r.x+t*(this.x-r.x)-n*(this.y-r.y),a=r.y+n*(this.x-r.x)+t*(this.y-r.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};Uy.convert=function(e){return e instanceof Uy?e:Array.isArray(e)?new Uy(e[0],e[1]):e};var kz=Lz,Rz=Yy;function Yy(e,r,t,n,i){this.properties={},this.extent=t,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Oz,this,r)}function Oz(e,r,t){e==1?r.id=t.readVarint():e==2?Pz(t,r):e==3?r.type=t.readVarint():e==4&&(r._geometry=t.pos)}function Pz(e,r){for(var t=e.readVarint()+e.pos;e.pos<t;){var n=r._keys[e.readVarint()],i=r._values[e.readVarint()];r.properties[n]=i}}Yy.types=["Unknown","Point","LineString","Polygon"];Yy.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint()+e.pos,t=1,n=0,i=0,a=0,o=[],l;e.pos<r;){if(n<=0){var c=e.readVarint();t=c&7,n=c>>3}if(n--,t===1||t===2)i+=e.readSVarint(),a+=e.readSVarint(),t===1&&(l&&o.push(l),l=[]),l.push(new kz(i,a));else if(t===7)l&&l.push(l[0].clone());else throw new Error("unknown command "+t)}return l&&o.push(l),o};Yy.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint()+e.pos,t=1,n=0,i=0,a=0,o=1/0,l=-1/0,c=1/0,p=-1/0;e.pos<r;){if(n<=0){var y=e.readVarint();t=y&7,n=y>>3}if(n--,t===1||t===2)i+=e.readSVarint(),a+=e.readSVarint(),i<o&&(o=i),i>l&&(l=i),a<c&&(c=a),a>p&&(p=a);else if(t!==7)throw new Error("unknown command "+t)}return[o,c,l,p]};Yy.prototype.toGeoJSON=function(e,r,t){var n=this.extent*Math.pow(2,t),i=this.extent*e,a=this.extent*r,o=this.loadGeometry(),l=Yy.types[this.type],c,p;function y(M){for(var O=0;O<M.length;O++){var N=M[O],z=180-(N.y+a)*360/n;M[O]=[(N.x+i)*360/n-180,360/Math.PI*Math.atan(Math.exp(z*Math.PI/180))-90]}}switch(this.type){case 1:var b=[];for(c=0;c<o.length;c++)b[c]=o[c][0];o=b,y(o);break;case 2:for(c=0;c<o.length;c++)y(o[c]);break;case 3:for(o=Fz(o),c=0;c<o.length;c++)for(p=0;p<o[c].length;p++)y(o[c][p]);break}o.length===1?o=o[0]:l="Multi"+l;var w={type:"Feature",geometry:{type:l,coordinates:o},properties:this.properties};return"id"in this&&(w.id=this.id),w};function Fz(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var o=Dz(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}function Dz(e){for(var r=0,t=0,n=e.length,i=n-1,a,o;t<n;i=t++)a=e[t],o=e[i],r+=(o.x-a.x)*(a.y+o.y);return r}var Bz=Rz,Nz=AO;function AO(e,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(zz,this,r),this.length=this._features.length}function zz(e,r,t){e===15?r.version=t.readVarint():e===1?r.name=t.readString():e===5?r.extent=t.readVarint():e===2?r._features.push(t.pos):e===3?r._keys.push(t.readString()):e===4&&r._values.push(Uz(t))}function Uz(e){for(var r=null,t=e.readVarint()+e.pos;e.pos<t;){var n=e.readVarint()>>3;r=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return r}AO.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var r=this._pbf.readVarint()+this._pbf.pos;return new Bz(this._pbf,r,this.extent,this._keys,this._values)};var Vz=Nz,Gz=jz;function jz(e,r){this.layers=e.readFields(Hz,{},r)}function Hz(e,r,t){if(e===3){var n=new Vz(t,t.readVarint()+t.pos);n.length&&(r[n.name]=n)}}var Wz=Gz,ww={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ww.read=function(e,r,t,n,i){var a,o,l=i*8-n-1,c=(1<<l)-1,p=c>>1,y=-7,b=t?i-1:0,w=t?-1:1,M=e[r+b];for(b+=w,a=M&(1<<-y)-1,M>>=-y,y+=l;y>0;a=a*256+e[r+b],b+=w,y-=8);for(o=a&(1<<-y)-1,a>>=-y,y+=n;y>0;o=o*256+e[r+b],b+=w,y-=8);if(a===0)a=1-p;else{if(a===c)return o?NaN:(M?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-p}return(M?-1:1)*o*Math.pow(2,a-n)};ww.write=function(e,r,t,n,i,a){var o,l,c,p=a*8-i-1,y=(1<<p)-1,b=y>>1,w=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=n?0:a-1,O=n?1:-1,N=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,o=y):(o=Math.floor(Math.log(r)/Math.LN2),r*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+b>=1?r+=w/c:r+=w*Math.pow(2,1-b),r*c>=2&&(o++,c/=2),o+b>=y?(l=0,o=y):o+b>=1?(l=(r*c-1)*Math.pow(2,i),o=o+b):(l=r*Math.pow(2,b-1)*Math.pow(2,i),o=0));i>=8;e[t+M]=l&255,M+=O,l/=256,i-=8);for(o=o<<i|l,p+=i;p>0;e[t+M]=o&255,M+=O,o/=256,p-=8);e[t+M-O]|=N*128};var $z=Qo,Sx=ww;function Qo(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Qo.Varint=0;Qo.Fixed64=1;Qo.Bytes=2;Qo.Fixed32=5;var FC=(1<<16)*(1<<16),UT=1/FC,Xz=12,TO=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Qo.prototype={destroy:function(){this.buf=null},readFields:function(e,r,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=n&7,e(i,r,this),this.pos===a&&this.skip(n)}return r},readMessage:function(e,r){return this.readFields(e,r,this.readVarint()+this.pos)},readFixed32:function(){var e=Ax(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=GT(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ax(this.buf,this.pos)+Ax(this.buf,this.pos+4)*FC;return this.pos+=8,e},readSFixed64:function(){var e=Ax(this.buf,this.pos)+GT(this.buf,this.pos+4)*FC;return this.pos+=8,e},readFloat:function(){var e=Sx.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Sx.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var r=this.buf,t,n;return n=r[this.pos++],t=n&127,n<128||(n=r[this.pos++],t|=(n&127)<<7,n<128)||(n=r[this.pos++],t|=(n&127)<<14,n<128)||(n=r[this.pos++],t|=(n&127)<<21,n<128)?t:(n=r[this.pos],t|=(n&15)<<28,Zz(t,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=Xz&&TO?uU(this.buf,r,e):sU(this.buf,r,e)},readBytes:function(){var e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r},readPackedVarint:function(e,r){if(this.type!==Qo.Bytes)return e.push(this.readVarint(r));var t=h0(this);for(e=e||[];this.pos<t;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){if(this.type!==Qo.Bytes)return e.push(this.readSVarint());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Qo.Bytes)return e.push(this.readBoolean());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Qo.Bytes)return e.push(this.readFloat());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Qo.Bytes)return e.push(this.readDouble());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Qo.Bytes)return e.push(this.readFixed32());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Qo.Bytes)return e.push(this.readSFixed32());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Qo.Bytes)return e.push(this.readFixed64());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Qo.Bytes)return e.push(this.readSFixed64());var r=h0(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=e&7;if(r===Qo.Varint)for(;this.buf[this.pos++]>127;);else if(r===Qo.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Qo.Fixed32)this.pos+=4;else if(r===Qo.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+r)},writeTag:function(e,r){this.writeVarint(e<<3|r)},realloc:function(e){for(var r=this.length||16;r<this.pos+e;)r*=2;if(r!==this.length){var t=new Uint8Array(r);t.set(this.buf),this.buf=t,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),vy(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),vy(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),vy(this.buf,e&-1,this.pos),vy(this.buf,Math.floor(e*UT),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),vy(this.buf,e&-1,this.pos),vy(this.buf,Math.floor(e*UT),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){Yz(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var r=this.pos;this.pos=lU(this.buf,e,this.pos);var t=this.pos-r;t>=128&&VT(r,t,this),this.pos=r-1,this.writeVarint(t),this.pos+=t},writeFloat:function(e){this.realloc(4),Sx.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Sx.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var r=e.length;this.writeVarint(r),this.realloc(r);for(var t=0;t<r;t++)this.buf[this.pos++]=e[t]},writeRawMessage:function(e,r){this.pos++;var t=this.pos;e(r,this);var n=this.pos-t;n>=128&&VT(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,r,t){this.writeTag(e,Qo.Bytes),this.writeRawMessage(r,t)},writePackedVarint:function(e,r){r.length&&this.writeMessage(e,Qz,r)},writePackedSVarint:function(e,r){r.length&&this.writeMessage(e,Jz,r)},writePackedBoolean:function(e,r){r.length&&this.writeMessage(e,rU,r)},writePackedFloat:function(e,r){r.length&&this.writeMessage(e,eU,r)},writePackedDouble:function(e,r){r.length&&this.writeMessage(e,tU,r)},writePackedFixed32:function(e,r){r.length&&this.writeMessage(e,nU,r)},writePackedSFixed32:function(e,r){r.length&&this.writeMessage(e,iU,r)},writePackedFixed64:function(e,r){r.length&&this.writeMessage(e,aU,r)},writePackedSFixed64:function(e,r){r.length&&this.writeMessage(e,oU,r)},writeBytesField:function(e,r){this.writeTag(e,Qo.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,Qo.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,Qo.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,Qo.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,Qo.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,Qo.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,Qo.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,Qo.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,Qo.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,Qo.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,r){this.writeVarintField(e,Boolean(r))}};function Zz(e,r,t){var n=t.buf,i,a;if(a=n[t.pos++],i=(a&112)>>4,a<128||(a=n[t.pos++],i|=(a&127)<<3,a<128)||(a=n[t.pos++],i|=(a&127)<<10,a<128)||(a=n[t.pos++],i|=(a&127)<<17,a<128)||(a=n[t.pos++],i|=(a&127)<<24,a<128)||(a=n[t.pos++],i|=(a&1)<<31,a<128))return dy(e,i,r);throw new Error("Expected varint not more than 10 bytes")}function h0(e){return e.type===Qo.Bytes?e.readVarint()+e.pos:e.pos+1}function dy(e,r,t){return t?r*4294967296+(e>>>0):(r>>>0)*4294967296+(e>>>0)}function Yz(e,r){var t,n;if(e>=0?(t=e%4294967296|0,n=e/4294967296|0):(t=~(-e%4294967296),n=~(-e/4294967296),t^4294967295?t=t+1|0:(t=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),qz(t,n,r),Kz(n,r)}function qz(e,r,t){t.buf[t.pos++]=e&127|128,e>>>=7,t.buf[t.pos++]=e&127|128,e>>>=7,t.buf[t.pos++]=e&127|128,e>>>=7,t.buf[t.pos++]=e&127|128,e>>>=7,t.buf[t.pos]=e&127}function Kz(e,r){var t=(e&7)<<4;r.buf[r.pos++]|=t|((e>>>=3)?128:0),e&&(r.buf[r.pos++]=e&127|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=e&127|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=e&127|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=e&127|((e>>>=7)?128:0),e&&(r.buf[r.pos++]=e&127)))))}function VT(e,r,t){var n=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));t.realloc(n);for(var i=t.pos-1;i>=e;i--)t.buf[i+n]=t.buf[i]}function Qz(e,r){for(var t=0;t<e.length;t++)r.writeVarint(e[t])}function Jz(e,r){for(var t=0;t<e.length;t++)r.writeSVarint(e[t])}function eU(e,r){for(var t=0;t<e.length;t++)r.writeFloat(e[t])}function tU(e,r){for(var t=0;t<e.length;t++)r.writeDouble(e[t])}function rU(e,r){for(var t=0;t<e.length;t++)r.writeBoolean(e[t])}function nU(e,r){for(var t=0;t<e.length;t++)r.writeFixed32(e[t])}function iU(e,r){for(var t=0;t<e.length;t++)r.writeSFixed32(e[t])}function aU(e,r){for(var t=0;t<e.length;t++)r.writeFixed64(e[t])}function oU(e,r){for(var t=0;t<e.length;t++)r.writeSFixed64(e[t])}function Ax(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+e[r+3]*16777216}function vy(e,r,t){e[t]=r,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24}function GT(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+(e[r+3]<<24)}function sU(e,r,t){for(var n="",i=r;i<t;){var a=e[i],o=null,l=a>239?4:a>223?3:a>191?2:1;if(i+l>t)break;var c,p,y;l===1?a<128&&(o=a):l===2?(c=e[i+1],(c&192)===128&&(o=(a&31)<<6|c&63,o<=127&&(o=null))):l===3?(c=e[i+1],p=e[i+2],(c&192)===128&&(p&192)===128&&(o=(a&15)<<12|(c&63)<<6|p&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):l===4&&(c=e[i+1],p=e[i+2],y=e[i+3],(c&192)===128&&(p&192)===128&&(y&192)===128&&(o=(a&15)<<18|(c&63)<<12|(p&63)<<6|y&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,l=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=l}return n}function uU(e,r,t){return TO.decode(e.subarray(r,t))}function lU(e,r,t){for(var n=0,i,a;n<r.length;n++){if(i=r.charCodeAt(n),i>55295&&i<57344)if(a)if(i<56320){e[t++]=239,e[t++]=191,e[t++]=189,a=i;continue}else i=a-55296<<10|i-56320|65536,a=null;else{i>56319||n+1===r.length?(e[t++]=239,e[t++]=191,e[t++]=189):a=i;continue}else a&&(e[t++]=239,e[t++]=191,e[t++]=189,a=null);i<128?e[t++]=i:(i<2048?e[t++]=i>>6|192:(i<65536?e[t++]=i>>12|224:(e[t++]=i>>18|240,e[t++]=i>>12&63|128),e[t++]=i>>6&63|128),e[t++]=i&63|128)}return t}var cU={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},jT=512;function fU(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}function hU(e){for(var r=0,t=0,n=e.length,i=n-1,a,o;t<n;i=t++)a=e[t],o=e[i],r+=(o.x-a.x)*(a.y+o.y);return r}function pU(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var o=hU(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var dU=["Unknown","Point","LineString","Polygon"];function vU(e,r){var t=r.extent,n=r.loadGeometry(),i=r.type,a=r.properties,o=r.id,l=t*Math.pow(2,e),c=dU[i],p,y;function b(O){for(var N=0;N<O.length;N++){var z=O[N];O[N]=[z.x/l*jT,z.y/l*jT]}}switch(i){case 1:var w=[];for(p=0;p<n.length;p++)w[p]=n[p][0];n=w,b(n);break;case 2:for(p=0;p<n.length;p++)b(n[p]);break;case 3:for(n=pU(n),p=0;p<n.length;p++)for(y=0;y<n[p].length;y++)b(n[p][y]);break}n.length===1?n=n[0]:c="Multi"+c;var M={type:"Feature",geometry:{type:c,coordinates:n},properties:a,id:o,tileOrigin:[0,0],coord:""};return M}var mU=function(){var e=eo(Xn.mark(function r(t,n,i,a){var o;return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=Ew(t,n),c.abrupt("return",new Promise(function(p){var y=hw({url:o},function(b,w){if(b||!w)p({layers:{}});else{for(var M=new Wz(new $z(w)),O=fU(n.x,n.y,n.z),N=n.z,z=0,j=Object.keys(M.layers);z<j.length;z++){for(var Y=j[z],K=[],ie=M.layers[Y],le=0;le<M.layers[Y].length;le++){var Se=M.layers[Y].feature(le),ze=void 0;a==="lnglat"?ze=Se.toGeoJSON(n.x,n.y,n.z):(ze=vU(N,Se),ie.l7TileOrigin=O,ie.l7TileCoord=a),K.push(ze)}ie.features=K}p(M)}});i.xhrCancel=function(){return y.abort()}}));case 2:case"end":return c.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function gU(e,r){var t=(r==null?void 0:r.coord)||"lnglat",n=function(o,l){return mU(e,o,l,t)},i=tr(tr(tr({},cU),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}function DC(e,r,t,n){for(var i=n,a=t-r>>1,o=t-r,l,c=e[r],p=e[r+1],y=e[t],b=e[t+1],w=r+3;w<t;w+=3){var M=yU(e[w],e[w+1],c,p,y,b);if(M>i)l=w,i=M;else if(M===i){var O=Math.abs(w-a);O<o&&(l=w,o=O)}}i>n&&(l-r>3&&DC(e,r,l,n),e[l+2]=i,t-l>3&&DC(e,l,t,n))}function yU(e,r,t,n,i,a){var o=i-t,l=a-n;if(o!==0||l!==0){var c=((e-t)*o+(r-n)*l)/(o*o+l*l);c>1?(t=i,n=a):c>0&&(t+=o*c,n+=l*c)}return o=e-t,l=r-n,o*o+l*l}function L1(e,r,t,n){var i={id:typeof e>"u"?null:e,type:r,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return _U(i),i}function _U(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")fE(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)fE(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)fE(e,r[n][i])}function fE(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function xU(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)qx(t,e.features[n],r,n);else e.type==="Feature"?qx(t,e,r):qx(t,{geometry:e},r);return t}function qx(e,r,t,n){if(!!r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,o=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],c=r.id;if(t.promoteId?c=r.properties[t.promoteId]:t.generateId&&(c=n||0),a==="Point")HT(i,l);else if(a==="MultiPoint")for(var p=0;p<i.length;p++)HT(i[p],l);else if(a==="LineString")BC(i,l,o,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(p=0;p<i.length;p++)l=[],BC(i[p],l,o,!1),e.push(L1(c,"LineString",l,r.properties));return}else hE(i,l,o,!1);else if(a==="Polygon")hE(i,l,o,!0);else if(a==="MultiPolygon")for(p=0;p<i.length;p++){var y=[];hE(i[p],y,o,!0),l.push(y)}else if(a==="GeometryCollection"){for(p=0;p<r.geometry.geometries.length;p++)qx(e,{id:c,geometry:r.geometry.geometries[p],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(L1(c,a,l,r.properties))}}function HT(e,r){r.push(MO(e[0])),r.push(IO(e[1])),r.push(0)}function BC(e,r,t,n){for(var i,a,o=0,l=0;l<e.length;l++){var c=MO(e[l][0]),p=IO(e[l][1]);r.push(c),r.push(p),r.push(0),l>0&&(n?o+=(i*p-c*a)/2:o+=Math.sqrt(Math.pow(c-i,2)+Math.pow(p-a,2))),i=c,a=p}var y=r.length-3;r[2]=1,DC(r,0,y,t),r[y+2]=1,r.size=Math.abs(o),r.start=0,r.end=r.size}function hE(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];BC(e[i],a,t,n),r.push(a)}}function MO(e){return e/360+.5}function IO(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function y0(e,r,t,n,i,a,o,l){if(t/=r,n/=r,a>=t&&o<n)return e;if(o<t||a>=n)return null;for(var c=[],p=0;p<e.length;p++){var y=e[p],b=y.geometry,w=y.type,M=i===0?y.minX:y.minY,O=i===0?y.maxX:y.maxY;if(M>=t&&O<n){c.push(y);continue}else if(O<t||M>=n)continue;var N=[];if(w==="Point"||w==="MultiPoint")bU(b,N,t,n,i);else if(w==="LineString")LO(b,N,t,n,i,!1,l.lineMetrics);else if(w==="MultiLineString")pE(b,N,t,n,i,!1);else if(w==="Polygon")pE(b,N,t,n,i,!0);else if(w==="MultiPolygon")for(var z=0;z<b.length;z++){var j=[];pE(b[z],j,t,n,i,!0),j.length&&N.push(j)}if(N.length){if(l.lineMetrics&&w==="LineString"){for(z=0;z<N.length;z++)c.push(L1(y.id,w,N[z],y.tags));continue}(w==="LineString"||w==="MultiLineString")&&(N.length===1?(w="LineString",N=N[0]):w="MultiLineString"),(w==="Point"||w==="MultiPoint")&&(w=N.length===3?"Point":"MultiPoint"),c.push(L1(y.id,w,N,y.tags))}}return c.length?c:null}function bU(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=t&&o<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function LO(e,r,t,n,i,a,o){for(var l=WT(e),c=i===0?EU:CU,p=e.start,y,b,w=0;w<e.length-3;w+=3){var M=e[w],O=e[w+1],N=e[w+2],z=e[w+3],j=e[w+4],Y=i===0?M:O,K=i===0?z:j,ie=!1;o&&(y=Math.sqrt(Math.pow(M-z,2)+Math.pow(O-j,2))),Y<t?K>t&&(b=c(l,M,O,z,j,t),o&&(l.start=p+y*b)):Y>n?K<n&&(b=c(l,M,O,z,j,n),o&&(l.start=p+y*b)):dE(l,M,O,N),K<t&&Y>=t&&(b=c(l,M,O,z,j,t),ie=!0),K>n&&Y<=n&&(b=c(l,M,O,z,j,n),ie=!0),!a&&ie&&(o&&(l.end=p+y*b),r.push(l),l=WT(e)),o&&(p+=y)}var le=e.length-3;M=e[le],O=e[le+1],N=e[le+2],Y=i===0?M:O,Y>=t&&Y<=n&&dE(l,M,O,N),le=l.length-3,a&&le>=3&&(l[le]!==l[0]||l[le+1]!==l[1])&&dE(l,l[0],l[1],l[2]),l.length&&r.push(l)}function WT(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function pE(e,r,t,n,i,a){for(var o=0;o<e.length;o++)LO(e[o],r,t,n,i,a,!1)}function dE(e,r,t,n){e.push(r),e.push(t),e.push(n)}function EU(e,r,t,n,i,a){var o=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*o),e.push(1),o}function CU(e,r,t,n,i,a){var o=(a-t)/(i-t);return e.push(r+(n-r)*o),e.push(a),e.push(1),o}function SU(e,r){var t=r.buffer/r.extent,n=e,i=y0(e,1,-1-t,t,0,-1,2,r),a=y0(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=y0(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=$T(i,1).concat(n)),a&&(n=n.concat($T(a,-1)))),n}function $T(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,o;if(a==="Point"||a==="MultiPoint"||a==="LineString")o=vE(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){o=[];for(var l=0;l<i.geometry.length;l++)o.push(vE(i.geometry[l],r))}else if(a==="MultiPolygon")for(o=[],l=0;l<i.geometry.length;l++){for(var c=[],p=0;p<i.geometry[l].length;p++)c.push(vE(i.geometry[l][p],r));o.push(c)}t.push(L1(i.id,a,o,i.tags))}return t}function vE(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function XT(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,o,l;for(a=0;a<e.features.length;a++){var c=e.features[a],p=c.geometry,y=c.type;if(c.geometry=[],y===1)for(o=0;o<p.length;o+=2)c.geometry.push(ZT(p[o],p[o+1],r,t,n,i));else for(o=0;o<p.length;o++){var b=[];for(l=0;l<p[o].length;l+=2)b.push(ZT(p[o][l],p[o][l+1],r,t,n,i));c.geometry.push(b)}}return e.transformed=!0,e}function ZT(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function wU(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){o.numFeatures++,AU(o,e[l],a,i);var c=e[l].minX,p=e[l].minY,y=e[l].maxX,b=e[l].maxY;c<o.minX&&(o.minX=c),p<o.minY&&(o.minY=p),y>o.maxX&&(o.maxX=y),b>o.maxY&&(o.maxY=b)}return o}function AU(e,r,t,n){var i=r.geometry,a=r.type,o=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)o.push(i[l]),o.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")mE(o,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)mE(o,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var c=0;c<i.length;c++){var p=i[c];for(l=0;l<p.length;l++)mE(o,p[l],e,t,!0,l===0)}if(o.length){var y=r.tags||null;if(a==="LineString"&&n.lineMetrics){y={};for(var b in r.tags)y[b]=r.tags[b];y.mapbox_clip_start=i.start/i.size,y.mapbox_clip_end=i.end/i.size}var w={geometry:o,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:y};r.id!==null&&(w.id=r.id),e.features.push(w)}}function mE(e,r,t,n,i,a){var o=n*n;if(n>0&&r.size<(i?o:n)){t.numPoints+=r.length/3;return}for(var l=[],c=0;c<r.length;c+=3)(n===0||r[c+2]>o)&&(t.numSimplified++,l.push(r[c]),l.push(r[c+1])),t.numPoints++;i&&TU(l,a),e.push(l)}function TU(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=l}}function MU(e,r){return new a2(e,r)}function a2(e,r){r=this.options=IU(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=xU(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=SU(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}a2.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};a2.prototype.splitTile=function(e,r,t,n,i,a,o){for(var l=[e,r,t,n],c=this.options,p=c.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var y=1<<r,b=NC(r,t,n),w=this.tiles[b];if(!w&&(p>1&&console.time("creation"),w=this.tiles[b]=wU(e,r,t,n,c),this.tileCoords.push({z:r,x:t,y:n}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,w.numFeatures,w.numPoints,w.numSimplified),console.timeEnd("creation"));var M="z"+r;this.stats[M]=(this.stats[M]||0)+1,this.total++}if(w.source=e,i){if(r===c.maxZoom||r===i)continue;var O=1<<i-r;if(t!==Math.floor(a/O)||n!==Math.floor(o/O))continue}else if(r===c.indexMaxZoom||w.numPoints<=c.indexMaxPoints)continue;if(w.source=null,e.length!==0){p>1&&console.time("clipping");var N=.5*c.buffer/c.extent,z=.5-N,j=.5+N,Y=1+N,K,ie,le,Se,ze,ue;K=ie=le=Se=null,ze=y0(e,y,t-N,t+j,0,w.minX,w.maxX,c),ue=y0(e,y,t+z,t+Y,0,w.minX,w.maxX,c),e=null,ze&&(K=y0(ze,y,n-N,n+j,1,w.minY,w.maxY,c),ie=y0(ze,y,n+z,n+Y,1,w.minY,w.maxY,c),ze=null),ue&&(le=y0(ue,y,n-N,n+j,1,w.minY,w.maxY,c),Se=y0(ue,y,n+z,n+Y,1,w.minY,w.maxY,c),ue=null),p>1&&console.timeEnd("clipping"),l.push(K||[],r+1,t*2,n*2),l.push(ie||[],r+1,t*2,n*2+1),l.push(le||[],r+1,t*2+1,n*2),l.push(Se||[],r+1,t*2+1,n*2+1)}}};a2.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e;r=(r%o+o)%o;var l=NC(e,r,t);if(this.tiles[l])return XT(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var c=e,p=r,y=t,b;!b&&c>0;)c--,p=Math.floor(p/2),y=Math.floor(y/2),b=this.tiles[NC(c,p,y)];return!b||!b.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",c,p,y),a>1&&console.time("drilling down"),this.splitTile(b.source,c,p,y,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?XT(this.tiles[l],i):null)};function NC(e,r,t){return((1<<e)*t+r)*32+e}function IU(e,r){for(var t in r)e[t]=r[t];return e}var LU={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function kU(e){for(var r=0,t=0,n=e.length,i=n-1,a,o;t<n;i=t++)a=e[t],o=e[i],r+=(o.x-a.x)*(a.y+o.y);return r}function RU(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var o=kU(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var OU=["Unknown","Point","LineString","Polygon"];function PU(e,r,t,n,i){var a=i.geometry,o=i.type,l=i.tags,c=i.id,p=e*Math.pow(2,n),y=e*r,b=e*t,w=OU[o],M,O;function N(Y){for(var K=0;K<Y.length;K++){var ie=Y[K];if(ie[3])break;var le=180-(ie[1]+b)*360/p,Se=(ie[0]+y)*360/p-180,ze=360/Math.PI*Math.atan(Math.exp(le*Math.PI/180))-90;Y[K]=[Se,ze,0,1]}}switch(o){case 1:var z=[];for(M=0;M<a.length;M++)z[M]=a[M][0];a=z,N(a);break;case 2:for(M=0;M<a.length;M++)N(a[M]);break;case 3:for(a=RU(a),M=0;M<a.length;M++)for(O=0;O<a[M].length;O++)N(a[M][O]);break}a.length===1?a=a[0]:w="Multi"+w;var j={type:"Feature",geometry:{type:w,coordinates:a},properties:l,id:c,tileOrigin:[0,0],coord:""};return j}var FU=function(){var e=eo(Xn.mark(function r(t,n,i,a){return Xn.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c){var p=n.getTile(t.z,t.x,t.y),y=[];p.features.map(function(w){var M=PU(a,i.x,i.y,i.z,w);y.push(M)});var b={layers:{geojsonvt:{features:y}}};c(b)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function DU(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions>"u"||(e.geojsonvtOptions.maxZoom&&(r.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(r.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(r.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(r.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(r.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(r.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(r.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(r.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(r.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(r.debug=e.geojsonvtOptions.debug)),r}function BU(e,r){var t=DU(r),n=t.extent||4096,i=MU(e,t),a=function(c,p){return FU(p,i,c,n)},o=tr(tr(tr({},LU),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:o,isTile:!0}}function NU(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,o=r.max,l={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:i,min:a,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return l}var mb;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(mb||(mb={}));var zU=function(){var e=eo(Xn.mark(function r(t,n,i,a){var o;return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=Ew(t,n),c.abrupt("return",new Promise(function(p,y){var b=GB({url:o},function(w,M){w?y(w):M&&p(M)},a);i.xhrCancel=function(){return b.abort()}}));case 2:case"end":return c.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),UU=function(){var e=eo(Xn.mark(function r(t,n,i){var a;return Xn.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a=Ew(t,n),l.abrupt("return",new Promise(function(c,p){var y=CC({url:a},function(b,w){b?p(b):w&&c(w)});i.xhrCancel=function(){return y.abort()}}));case 2:case"end":return l.stop()}},r)}));return function(t,n,i){return e.apply(this,arguments)}}(),VU=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},GU={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function jU(e,r){var t=(r==null?void 0:r.dataType)||mb.IMAGE,n=function(o,l){return t===mb.IMAGE?UU(e,o,l):zU(e,o,l,(r==null?void 0:r.format)||VU)},i=tr(tr(tr({},GU),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var HU={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},WU=function(){var e=eo(Xn.mark(function r(t){return Xn.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var o=Pi(t.bounds,4),l=o[0],c=o[1],p=o[2],y=o[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(l+p)/2,textLat:(c+y)/2},geometry:{type:"LineString",coordinates:[[p,y],[p,c],[l,c],[l,c]]}}]}}};a(b)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function $U(e,r){var t=function(a){return WU(a)},n=tr(tr(tr({},HU),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}function XU(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(y){try{p(n.next(y))}catch(b){o(b)}}function c(y){try{p(n.throw(y))}catch(b){o(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,r||[])).next())})}function ZU(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function YU(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],o;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){o={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return a}function qU(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,a;n<i;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return e.concat(a||Array.prototype.slice.call(r))}function Aw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var zC={exports:{}},gb={exports:{}},k1={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=r.default})(k1,k1.exports);var Yh={},UC={exports:{}},VC={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default})(VC,VC.exports);var Tm={};Object.defineProperty(Tm,"__esModule",{value:!0});Tm.fallback=kO;Tm.wrap=RO;var KU=Tm.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,QU=Tm.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,JU=Tm.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function kO(e){setTimeout(e,0)}function RO(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var Y_;KU?Y_=queueMicrotask:QU?Y_=setImmediate:JU?Y_=process.nextTick:Y_=kO;Tm.default=RO(Y_);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=c;var t=VC.exports,n=l(t),i=Tm,a=l(i),o=Yh;function l(b){return b&&b.__esModule?b:{default:b}}function c(b){return(0,o.isAsync)(b)?function(){for(var w=[],M=arguments.length;M--;)w[M]=arguments[M];var O=w.pop(),N=b.apply(this,w);return p(N,O)}:(0,n.default)(function(w,M){var O;try{O=b.apply(this,w)}catch(N){return M(N)}if(O&&typeof O.then=="function")return p(O,M);M(null,O)})}function p(b,w){return b.then(function(M){y(w,null,M)},function(M){y(w,M&&M.message?M:new Error(M))})}function y(b,w,M){try{b(w,M)}catch(O){(0,a.default)(function(N){throw N},O)}}e.exports=r.default})(UC,UC.exports);Object.defineProperty(Yh,"__esModule",{value:!0});Yh.isAsyncIterable=Yh.isAsyncGenerator=Yh.isAsync=void 0;var eV=UC.exports,tV=rV(eV);function rV(e){return e&&e.__esModule?e:{default:e}}function OO(e){return e[Symbol.toStringTag]==="AsyncFunction"}function nV(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function iV(e){return typeof e[Symbol.asyncIterator]=="function"}function aV(e){if(typeof e!="function")throw new Error("expected a function");return OO(e)?(0,tV.default)(e):e}Yh.default=aV;Yh.isAsync=OO;Yh.isAsyncGenerator=nV;Yh.isAsyncIterable=iV;var Fg={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var o=this,l=[],c=arguments.length;c--;)l[c]=arguments[c];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(p,y){l[i-1]=function(b){for(var w=[],M=arguments.length-1;M-- >0;)w[M]=arguments[M+1];if(b)return y(b);p(w.length>1?w:w[0])},n.apply(o,l)})}return a}e.exports=r.default})(Fg,Fg.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=k1.exports,n=c(t),i=Yh,a=c(i),o=Fg.exports,l=c(o);function c(p){return p&&p.__esModule?p:{default:p}}r.default=(0,l.default)(function(p,y,b){var w=(0,n.default)(y)?[]:{};p(y,function(M,O,N){(0,a.default)(M)(function(z){for(var j,Y=[],K=arguments.length-1;K-- >0;)Y[K]=arguments[K+1];Y.length<2&&(j=Y,Y=j[0]),w[O]=Y,N(z)})},function(M){return b(M,w)})},3),e.exports=r.default})(gb,gb.exports);var GC={exports:{}},yb={exports:{}},jC={exports:{}},R1={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default})(R1,R1.exports);var HC={exports:{}},WC={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(WC,WC.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=y;var t=k1.exports,n=o(t),i=WC.exports,a=o(i);function o(b){return b&&b.__esModule?b:{default:b}}function l(b){var w=-1,M=b.length;return function(){return++w<M?{value:b[w],key:w}:null}}function c(b){var w=-1;return function(){var O=b.next();return O.done?null:(w++,{value:O.value,key:w})}}function p(b){var w=b?Object.keys(b):[],M=-1,O=w.length;return function N(){var z=w[++M];return z==="__proto__"?N():M<O?{value:b[z],key:z}:null}}function y(b){if((0,n.default)(b))return l(b);var w=(0,a.default)(b);return w?c(w):p(b)}e.exports=r.default})(HC,HC.exports);var O1={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var o=n;n=null,o.apply(this,i)}}e.exports=r.default})(O1,O1.exports);var $C={exports:{}},P1={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(P1,P1.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=P1.exports,n=i(t);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,l,c,p){var y=!1,b=!1,w=!1,M=0,O=0;function N(){M>=l||w||y||(w=!0,o.next().then(function(Y){var K=Y.value,ie=Y.done;if(!(b||y)){if(w=!1,ie){y=!0,M<=0&&p(null);return}M++,c(K,O,z),O++,N()}}).catch(j))}function z(Y,K){if(M-=1,!b){if(Y)return j(Y);if(Y===!1){y=!0,b=!0;return}if(K===n.default||y&&M<=0)return y=!0,p(null);N()}}function j(Y){b||(w=!1,y=!0,p(Y))}N()}e.exports=r.default})($C,$C.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=R1.exports,n=M(t),i=HC.exports,a=M(i),o=O1.exports,l=M(o),c=Yh,p=$C.exports,y=M(p),b=P1.exports,w=M(b);function M(O){return O&&O.__esModule?O:{default:O}}r.default=function(O){return function(N,z,j){if(j=(0,n.default)(j),O<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!N)return j(null);if((0,c.isAsyncGenerator)(N))return(0,y.default)(N,O,z,j);if((0,c.isAsyncIterable)(N))return(0,y.default)(N[Symbol.asyncIterator](),O,z,j);var Y=(0,a.default)(N),K=!1,ie=!1,le=0,Se=!1;function ze(Ke,ke){if(!ie)if(le-=1,Ke)K=!0,j(Ke);else if(Ke===!1)K=!0,ie=!0;else{if(ke===w.default||K&&le<=0)return K=!0,j(null);Se||ue()}}function ue(){for(Se=!0;le<O&&!K;){var Ke=Y();if(Ke===null){K=!0,le<=0&&j(null);return}le+=1,z(Ke.value,Ke.key,(0,l.default)(ze))}Se=!1}ue()}},e.exports=r.default})(jC,jC.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=jC.exports,n=c(t),i=Yh,a=c(i),o=Fg.exports,l=c(o);function c(y){return y&&y.__esModule?y:{default:y}}function p(y,b,w,M){return(0,n.default)(b)(y,(0,a.default)(w),M)}r.default=(0,l.default)(p,4),e.exports=r.default})(yb,yb.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=yb.exports,n=o(t),i=Fg.exports,a=o(i);function o(c){return c&&c.__esModule?c:{default:c}}function l(c,p,y){return(0,n.default)(c,1,p,y)}r.default=(0,a.default)(l,3),e.exports=r.default})(GC,GC.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=gb.exports,n=o(t),i=GC.exports,a=o(i);function o(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,n.default)(a.default,c,p)}e.exports=r.default})(zC,zC.exports);var PO=Aw(zC.exports),Lv=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,PO(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,qU([],YU(n.args),!1)),i(null,r)})},e}(),XC={exports:{}},ZC={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=k1.exports,n=z(t),i=P1.exports,a=z(i),o=yb.exports,l=z(o),c=R1.exports,p=z(c),y=O1.exports,b=z(y),w=Yh,M=z(w),O=Fg.exports,N=z(O);function z(ie){return ie&&ie.__esModule?ie:{default:ie}}function j(ie,le,Se){Se=(0,p.default)(Se);var ze=0,ue=0,Ke=ie.length,ke=!1;Ke===0&&Se(null);function Ce(je,ve){je===!1&&(ke=!0),ke!==!0&&(je?Se(je):(++ue===Ke||ve===a.default)&&Se(null))}for(;ze<Ke;ze++)le(ie[ze],ze,(0,b.default)(Ce))}function Y(ie,le,Se){return(0,l.default)(ie,1/0,le,Se)}function K(ie,le,Se){var ze=(0,n.default)(ie)?j:Y;return ze(ie,(0,M.default)(le),Se)}r.default=(0,N.default)(K,3),e.exports=r.default})(ZC,ZC.exports);(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=ZC.exports,n=o(t),i=gb.exports,a=o(i);function o(c){return c&&c.__esModule?c:{default:c}}function l(c,p){return(0,a.default)(n.default,c,p)}e.exports=r.default})(XC,XC.exports);var oV=Aw(XC.exports),sV=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return oV(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return XU(n,void 0,void 0,function(){return ZU(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),YC={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=R1.exports,n=y(t),i=O1.exports,a=y(i),o=Yh,l=y(o),c=Fg.exports,p=y(c);function y(w){return w&&w.__esModule?w:{default:w}}function b(w,M){if(M=(0,n.default)(M),!Array.isArray(w))return M(new Error("First argument to waterfall must be an array of functions"));if(!w.length)return M();var O=0;function N(j){var Y=(0,l.default)(w[O++]);Y.apply(void 0,j.concat([(0,a.default)(z)]))}function z(j){for(var Y=[],K=arguments.length-1;K-- >0;)Y[K]=arguments[K+1];if(j!==!1){if(j||O===w.length)return M.apply(void 0,[j].concat(Y));N(Y)}}N([])}r.default=(0,p.default)(b),e.exports=r.default})(YC,YC.exports);var uV=Aw(YC.exports),lV=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return uV(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t();i(a?null:!1,r)})},e}(),gE=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return PO(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),Vr={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(e,r){(function(){var t,n="4.17.21",i=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",p=500,y="__lodash_placeholder__",b=1,w=2,M=4,O=1,N=2,z=1,j=2,Y=4,K=8,ie=16,le=32,Se=64,ze=128,ue=256,Ke=512,ke=30,Ce="...",je=800,ve=16,Ie=1,dt=2,St=3,Rt=1/0,$t=9007199254740991,gt=17976931348623157e292,jr=0/0,Er=4294967295,rn=Er-1,dn=Er>>>1,Rn=[["ary",ze],["bind",z],["bindKey",j],["curry",K],["curryRight",ie],["flip",Ke],["partial",le],["partialRight",Se],["rearg",ue]],Ar="[object Arguments]",xa="[object Array]",Ti="[object AsyncFunction]",Sa="[object Boolean]",hr="[object Date]",Dr="[object DOMException]",Kn="[object Error]",Wt="[object Function]",Me="[object GeneratorFunction]",Qe="[object Map]",Ct="[object Number]",Yt="[object Null]",qt="[object Object]",_r="[object Promise]",Pr="[object Proxy]",xr="[object RegExp]",kr="[object Set]",vr="[object String]",In="[object Symbol]",W="[object Undefined]",st="[object WeakMap]",zt="[object WeakSet]",mr="[object ArrayBuffer]",fr="[object DataView]",nn="[object Float32Array]",Mn="[object Float64Array]",Wn="[object Int8Array]",Bn="[object Int16Array]",Mi="[object Int32Array]",mi="[object Uint8Array]",mo="[object Uint8ClampedArray]",ca="[object Uint16Array]",Ki="[object Uint32Array]",yl=/\b__p \+= '';/g,Xi=/\b(__p \+=) '' \+/g,nu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,mu=/&(?:amp|lt|gt|quot|#39);/g,iu=/[&<>"']/g,pf=RegExp(mu.source),Fu=RegExp(iu.source),uo=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,ae=/<%=([\s\S]+?)%>/g,ce=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,be=/^\w*$/,Be=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,et=/[\\^$.*+?()[\]{}|]/g,ot=RegExp(et.source),ge=/^\s+/,Ve=/\s/,mt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Jt=/\{\n\/\* \[wrapped with (.+)\] \*/,Cr=/,? & /,Dt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,pr=/[()=,{}\[\]\/\s]/,Nr=/\\(\\)?/g,xn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Bt=/\w*$/,ln=/^[-+]0x[0-9a-f]+$/i,Wr=/^0b[01]+$/i,Zr=/^\[object .+?Constructor\]$/,gi=/^0o[0-7]+$/i,Jr=/^(?:0|[1-9]\d*)$/,bi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ci=/($^)/,Ci=/['\n\r\u2028\u2029\\]/g,Fi="\\ud800-\\udfff",Di="\\u0300-\\u036f",ls="\\ufe20-\\ufe2f",sa="\\u20d0-\\u20ff",Zi=Di+ls+sa,ia="\\u2700-\\u27bf",pi="a-z\\xdf-\\xf6\\xf8-\\xff",Li="\\xac\\xb1\\xd7\\xf7",go="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",pa="\\u2000-\\u206f",Za=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",da="A-Z\\xc0-\\xd6\\xd8-\\xde",Xf="\\ufe0e\\ufe0f",Hl=Li+go+pa+Za,ki="['\u2019]",oc="["+Fi+"]",ns="["+Hl+"]",Ya="["+Zi+"]",yo="\\d+",Da="["+ia+"]",ks="["+pi+"]",qa="[^"+Fi+Hl+yo+ia+pi+da+"]",Rc="\\ud83c[\\udffb-\\udfff]",Rs="(?:"+Ya+"|"+Rc+")",df="[^"+Fi+"]",Os="(?:\\ud83c[\\udde6-\\uddff]){2}",Ha="[\\ud800-\\udbff][\\udc00-\\udfff]",Ps="["+da+"]",se="\\u200d",we="(?:"+ks+"|"+qa+")",Je="(?:"+Ps+"|"+qa+")",Nt="(?:"+ki+"(?:d|ll|m|re|s|t|ve))?",Tr="(?:"+ki+"(?:D|LL|M|RE|S|T|VE))?",Un=Rs+"?",Qi="["+Xf+"]?",Ma="(?:"+se+"(?:"+[df,Os,Ha].join("|")+")"+Qi+Un+")*",cs="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ko="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ia=Qi+Un+Ma,Fp="(?:"+[Da,Os,Ha].join("|")+")"+Ia,Zf="(?:"+[df+Ya+"?",Ya,Os,Ha,oc].join("|")+")",qd=RegExp(ki,"g"),Kh=RegExp(Ya,"g"),gu=RegExp(Rc+"(?="+Rc+")|"+Zf+Ia,"g"),Wl=RegExp([Ps+"?"+ks+"+"+Nt+"(?="+[ns,Ps,"$"].join("|")+")",Je+"+"+Tr+"(?="+[ns,Ps+we,"$"].join("|")+")",Ps+"?"+we+"+"+Nt,Ps+"+"+Tr,ko,cs,yo,Fp].join("|"),"g"),vf=RegExp("["+se+Fi+Zi+Xf+"]"),Ku=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,yu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],mf=-1,to={};to[nn]=to[Mn]=to[Wn]=to[Bn]=to[Mi]=to[mi]=to[mo]=to[ca]=to[Ki]=!0,to[Ar]=to[xa]=to[mr]=to[Sa]=to[fr]=to[hr]=to[Kn]=to[Wt]=to[Qe]=to[Ct]=to[qt]=to[xr]=to[kr]=to[vr]=to[st]=!1;var Ji={};Ji[Ar]=Ji[xa]=Ji[mr]=Ji[fr]=Ji[Sa]=Ji[hr]=Ji[nn]=Ji[Mn]=Ji[Wn]=Ji[Bn]=Ji[Mi]=Ji[Qe]=Ji[Ct]=Ji[qt]=Ji[xr]=Ji[kr]=Ji[vr]=Ji[In]=Ji[mi]=Ji[mo]=Ji[ca]=Ji[Ki]=!0,Ji[Kn]=Ji[Wt]=Ji[st]=!1;var Ro={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},$l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dd={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Wv={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},vd=parseFloat,Qh=parseInt,_u=typeof Lp=="object"&&Lp&&Lp.Object===Object&&Lp,Ch=typeof self=="object"&&self&&self.Object===Object&&self,Yi=_u||Ch||Function("return this")(),Qu=r&&!r.nodeType&&r,gf=Qu&&!0&&e&&!e.nodeType&&e,Kd=gf&&gf.exports===Qu,Oo=Kd&&_u.process,au=function(){try{var pt=gf&&gf.require&&gf.require("util").types;return pt||Oo&&Oo.binding&&Oo.binding("util")}catch{}}(),Dp=au&&au.isArrayBuffer,Po=au&&au.isDate,Jh=au&&au.isMap,Fs=au&&au.isRegExp,Oc=au&&au.isSet,Xs=au&&au.isTypedArray;function Fo(pt,ur,Vt){switch(Vt.length){case 0:return pt.call(ur);case 1:return pt.call(ur,Vt[0]);case 2:return pt.call(ur,Vt[0],Vt[1]);case 3:return pt.call(ur,Vt[0],Vt[1],Vt[2])}return pt.apply(ur,Vt)}function yf(pt,ur,Vt,on){for(var Ei=-1,ua=pt==null?0:pt.length;++Ei<ua;){var no=pt[Ei];ur(on,no,Vt(no),pt)}return on}function Do(pt,ur){for(var Vt=-1,on=pt==null?0:pt.length;++Vt<on&&ur(pt[Vt],Vt,pt)!==!1;);return pt}function sc(pt,ur){for(var Vt=pt==null?0:pt.length;Vt--&&ur(pt[Vt],Vt,pt)!==!1;);return pt}function Du(pt,ur){for(var Vt=-1,on=pt==null?0:pt.length;++Vt<on;)if(!ur(pt[Vt],Vt,pt))return!1;return!0}function uc(pt,ur){for(var Vt=-1,on=pt==null?0:pt.length,Ei=0,ua=[];++Vt<on;){var no=pt[Vt];ur(no,Vt,pt)&&(ua[Ei++]=no)}return ua}function xu(pt,ur){var Vt=pt==null?0:pt.length;return!!Vt&&Zs(pt,ur,0)>-1}function va(pt,ur,Vt){for(var on=-1,Ei=pt==null?0:pt.length;++on<Ei;)if(Vt(ur,pt[on]))return!0;return!1}function ro(pt,ur){for(var Vt=-1,on=pt==null?0:pt.length,Ei=Array(on);++Vt<on;)Ei[Vt]=ur(pt[Vt],Vt,pt);return Ei}function ou(pt,ur){for(var Vt=-1,on=ur.length,Ei=pt.length;++Vt<on;)pt[Ei+Vt]=ur[Vt];return pt}function ep(pt,ur,Vt,on){var Ei=-1,ua=pt==null?0:pt.length;for(on&&ua&&(Vt=pt[++Ei]);++Ei<ua;)Vt=ur(Vt,pt[Ei],Ei,pt);return Vt}function tp(pt,ur,Vt,on){var Ei=pt==null?0:pt.length;for(on&&Ei&&(Vt=pt[--Ei]);Ei--;)Vt=ur(Vt,pt[Ei],Ei,pt);return Vt}function Sh(pt,ur){for(var Vt=-1,on=pt==null?0:pt.length;++Vt<on;)if(ur(pt[Vt],Vt,pt))return!0;return!1}var Qd=Ys("length");function Pc(pt){return pt.split("")}function Wa(pt){return pt.match(Dt)||[]}function lc(pt,ur,Vt){var on;return Vt(pt,function(Ei,ua,no){if(ur(Ei,ua,no))return on=ua,!1}),on}function wh(pt,ur,Vt,on){for(var Ei=pt.length,ua=Vt+(on?1:-1);on?ua--:++ua<Ei;)if(ur(pt[ua],ua,pt))return ua;return-1}function Zs(pt,ur,Vt){return ur===ur?ip(pt,ur,Vt):wh(pt,bu,Vt)}function Ah(pt,ur,Vt,on){for(var Ei=Vt-1,ua=pt.length;++Ei<ua;)if(on(pt[Ei],ur))return Ei;return-1}function bu(pt){return pt!==pt}function Fc(pt,ur){var Vt=pt==null?0:pt.length;return Vt?ka(pt,ur)/Vt:jr}function Ys(pt){return function(ur){return ur==null?t:ur[pt]}}function Bu(pt){return function(ur){return pt==null?t:pt[ur]}}function Xl(pt,ur,Vt,on,Ei){return Ei(pt,function(ua,no,Gn){Vt=on?(on=!1,ua):ur(Vt,ua,no,Gn)}),Vt}function _f(pt,ur){var Vt=pt.length;for(pt.sort(ur);Vt--;)pt[Vt]=pt[Vt].value;return pt}function ka(pt,ur){for(var Vt,on=-1,Ei=pt.length;++on<Ei;){var ua=ur(pt[on]);ua!==t&&(Vt=Vt===t?ua:Vt+ua)}return Vt}function Dc(pt,ur){for(var Vt=-1,on=Array(pt);++Vt<pt;)on[Vt]=ur(Vt);return on}function Bp(pt,ur){return ro(ur,function(Vt){return[Vt,pt[Vt]]})}function Bc(pt){return pt&&pt.slice(0,Ih(pt)+1).replace(ge,"")}function Nu(pt){return function(ur){return pt(ur)}}function rp(pt,ur){return ro(ur,function(Vt){return pt[Vt]})}function Th(pt,ur){return pt.has(ur)}function xf(pt,ur){for(var Vt=-1,on=pt.length;++Vt<on&&Zs(ur,pt[Vt],0)>-1;);return Vt}function cc(pt,ur){for(var Vt=pt.length;Vt--&&Zs(ur,pt[Vt],0)>-1;);return Vt}function Nc(pt,ur){for(var Vt=pt.length,on=0;Vt--;)pt[Vt]===ur&&++on;return on}var fc=Bu(Ro),_l=Bu($l);function hc(pt){return"\\"+Wv[pt]}function np(pt,ur){return pt==null?t:pt[ur]}function zu(pt){return vf.test(pt)}function qs(pt){return Ku.test(pt)}function zc(pt){for(var ur,Vt=[];!(ur=pt.next()).done;)Vt.push(ur.value);return Vt}function Uc(pt){var ur=-1,Vt=Array(pt.size);return pt.forEach(function(on,Ei){Vt[++ur]=[Ei,on]}),Vt}function Vc(pt,ur){return function(Vt){return pt(ur(Vt))}}function Ks(pt,ur){for(var Vt=-1,on=pt.length,Ei=0,ua=[];++Vt<on;){var no=pt[Vt];(no===ur||no===y)&&(pt[Vt]=y,ua[Ei++]=Vt)}return ua}function Zl(pt){var ur=-1,Vt=Array(pt.size);return pt.forEach(function(on){Vt[++ur]=on}),Vt}function Yf(pt){var ur=-1,Vt=Array(pt.size);return pt.forEach(function(on){Vt[++ur]=[on,on]}),Vt}function ip(pt,ur,Vt){for(var on=Vt-1,Ei=pt.length;++on<Ei;)if(pt[on]===ur)return on;return-1}function Mh(pt,ur,Vt){for(var on=Vt+1;on--;)if(pt[on]===ur)return on;return on}function Yl(pt){return zu(pt)?md(pt):Qd(pt)}function su(pt){return zu(pt)?ap(pt):Pc(pt)}function Ih(pt){for(var ur=pt.length;ur--&&Ve.test(pt.charAt(ur)););return ur}var bf=Bu(dd);function md(pt){for(var ur=gu.lastIndex=0;gu.test(pt);)++ur;return ur}function ap(pt){return pt.match(gu)||[]}function Np(pt){return pt.match(Wl)||[]}var Ef=function pt(ur){ur=ur==null?Yi:Gc.defaults(Yi.Object(),ur,Gc.pick(Yi,yu));var Vt=ur.Array,on=ur.Date,Ei=ur.Error,ua=ur.Function,no=ur.Math,Gn=ur.Object,qi=ur.RegExp,Qs=ur.String,uu=ur.TypeError,jc=Vt.prototype,Lh=ua.prototype,qf=Gn.prototype,pc=ur["__core-js_shared__"],Cf=Lh.toString,fa=qf.hasOwnProperty,ql=0,lo=function(){var f=/[^.]+$/.exec(pc&&pc.keys&&pc.keys.IE_PROTO||"");return f?"Symbol(src)_1."+f:""}(),Sf=qf.toString,op=Cf.call(Gn),ba=Yi._,mn=qi("^"+Cf.call(fa).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xo=Kd?ur.Buffer:t,Js=ur.Symbol,Ju=ur.Uint8Array,Uu=Xo?Xo.allocUnsafe:t,fs=Vc(Gn.getPrototypeOf,Gn),Kf=Gn.create,qr=qf.propertyIsEnumerable,Kl=jc.splice,Jo=Js?Js.isConcatSpreadable:t,Hc=Js?Js.iterator:t,hs=Js?Js.toStringTag:t,Bo=function(){try{var f=Wu(Gn,"defineProperty");return f({},"",{}),f}catch{}}(),kh=ur.clearTimeout!==Yi.clearTimeout&&ur.clearTimeout,sp=on&&on.now!==Yi.Date.now&&on.now,Eu=ur.setTimeout!==Yi.setTimeout&&ur.setTimeout,xl=no.ceil,dc=no.floor,bl=Gn.getOwnPropertySymbols,Qf=Xo?Xo.isBuffer:t,vc=ur.isFinite,el=jc.join,Vu=Vc(Gn.keys,Gn),ti=no.max,_o=no.min,Cu=on.now,Ds=ur.parseInt,El=no.random,Wc=jc.reverse,ps=Wu(ur,"DataView"),xo=Wu(ur,"Map"),$c=Wu(ur,"Promise"),kn=Wu(ur,"Set"),bn=Wu(ur,"WeakMap"),mc=Wu(Gn,"create"),ds=bn&&new bn,Bs={},is=Pa(ps),Cl=Pa(xo),zp=Pa($c),Su=Pa(kn),ma=Pa(bn),es=Js?Js.prototype:t,lu=es?es.valueOf:t,Sl=es?es.toString:t;function ye(f){if(po(f)&&!xi(f)&&!(f instanceof Ii)){if(f instanceof Es)return f;if(fa.call(f,"__wrapped__"))return zi(f)}return new Es(f)}var Ns=function(){function f(){}return function(m){if(!Io(m))return{};if(Kf)return Kf(m);f.prototype=m;var S=new f;return f.prototype=t,S}}();function vs(){}function Es(f,m){this.__wrapped__=f,this.__actions__=[],this.__chain__=!!m,this.__index__=0,this.__values__=t}ye.templateSettings={escape:uo,evaluate:J,interpolate:ae,variable:"",imports:{_:ye}},ye.prototype=vs.prototype,ye.prototype.constructor=ye,Es.prototype=Ns(vs.prototype),Es.prototype.constructor=Es;function Ii(f){this.__wrapped__=f,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Er,this.__views__=[]}function Jf(){var f=new Ii(this.__wrapped__);return f.__actions__=eu(this.__actions__),f.__dir__=this.__dir__,f.__filtered__=this.__filtered__,f.__iteratees__=eu(this.__iteratees__),f.__takeCount__=this.__takeCount__,f.__views__=eu(this.__views__),f}function wu(){if(this.__filtered__){var f=new Ii(this);f.__dir__=-1,f.__filtered__=!0}else f=this.clone(),f.__dir__*=-1;return f}function Rh(){var f=this.__wrapped__.value(),m=this.__dir__,S=xi(f),k=m<0,B=S?f.length:0,G=wt(0,B,this.__views__),Z=G.start,ee=G.end,_e=ee-Z,Ge=k?ee:Z-1,Xe=this.__iteratees__,it=Xe.length,bt=0,kt=_o(_e,this.__takeCount__);if(!S||!k&&B==_e&&kt==_e)return Yv(f,this.__actions__);var Xt=[];e:for(;_e--&&bt<kt;){Ge+=m;for(var Ht=-1,ir=f[Ge];++Ht<it;){var Ur=Xe[Ht],qn=Ur.iteratee,Ri=Ur.type,Ai=qn(ir);if(Ri==dt)ir=Ai;else if(!Ai){if(Ri==Ie)continue e;break e}}Xt[bt++]=ir}return Xt}Ii.prototype=Ns(vs.prototype),Ii.prototype.constructor=Ii;function wl(f){var m=-1,S=f==null?0:f.length;for(this.clear();++m<S;){var k=f[m];this.set(k[0],k[1])}}function eh(){this.__data__=mc?mc(null):{},this.size=0}function th(f){var m=this.has(f)&&delete this.__data__[f];return this.size-=m?1:0,m}function gd(f){var m=this.__data__;if(mc){var S=m[f];return S===c?t:S}return fa.call(m,f)?m[f]:t}function wf(f){var m=this.__data__;return mc?m[f]!==t:fa.call(m,f)}function Af(f,m){var S=this.__data__;return this.size+=this.has(f)?0:1,S[f]=mc&&m===t?c:m,this}wl.prototype.clear=eh,wl.prototype.delete=th,wl.prototype.get=gd,wl.prototype.has=wf,wl.prototype.set=Af;function tl(f){var m=-1,S=f==null?0:f.length;for(this.clear();++m<S;){var k=f[m];this.set(k[0],k[1])}}function gc(){this.__data__=[],this.size=0}function Al(f){var m=this.__data__,S=Ot(m,f);if(S<0)return!1;var k=m.length-1;return S==k?m.pop():Kl.call(m,S,1),--this.size,!0}function Oh(f){var m=this.__data__,S=Ot(m,f);return S<0?t:m[S][1]}function Xc(f){return Ot(this.__data__,f)>-1}function rh(f,m){var S=this.__data__,k=Ot(S,f);return k<0?(++this.size,S.push([f,m])):S[k][1]=m,this}tl.prototype.clear=gc,tl.prototype.delete=Al,tl.prototype.get=Oh,tl.prototype.has=Xc,tl.prototype.set=rh;function rl(f){var m=-1,S=f==null?0:f.length;for(this.clear();++m<S;){var k=f[m];this.set(k[0],k[1])}}function d(){this.size=0,this.__data__={hash:new wl,map:new(xo||tl),string:new wl}}function g(f){var m=Oa(this,f).delete(f);return this.size-=m?1:0,m}function v(f){return Oa(this,f).get(f)}function x(f){return Oa(this,f).has(f)}function T(f,m){var S=Oa(this,f),k=S.size;return S.set(f,m),this.size+=S.size==k?0:1,this}rl.prototype.clear=d,rl.prototype.delete=g,rl.prototype.get=v,rl.prototype.has=x,rl.prototype.set=T;function R(f){var m=-1,S=f==null?0:f.length;for(this.__data__=new rl;++m<S;)this.add(f[m])}function F(f){return this.__data__.set(f,c),this}function U(f){return this.__data__.has(f)}R.prototype.add=R.prototype.push=F,R.prototype.has=U;function X(f){var m=this.__data__=new tl(f);this.size=m.size}function re(){this.__data__=new tl,this.size=0}function he(f){var m=this.__data__,S=m.delete(f);return this.size=m.size,S}function me(f){return this.__data__.get(f)}function xe(f){return this.__data__.has(f)}function Ne(f,m){var S=this.__data__;if(S instanceof tl){var k=S.__data__;if(!xo||k.length<i-1)return k.push([f,m]),this.size=++S.size,this;S=this.__data__=new rl(k)}return S.set(f,m),this.size=S.size,this}X.prototype.clear=re,X.prototype.delete=he,X.prototype.get=me,X.prototype.has=xe,X.prototype.set=Ne;function Fe(f,m){var S=xi(f),k=!S&&Ru(f),B=!S&&!k&&Fl(f),G=!S&&!k&&!B&&hh(f),Z=S||k||B||G,ee=Z?Dc(f.length,Qs):[],_e=ee.length;for(var Ge in f)(m||fa.call(f,Ge))&&!(Z&&(Ge=="length"||B&&(Ge=="offset"||Ge=="parent")||G&&(Ge=="buffer"||Ge=="byteLength"||Ge=="byteOffset")||dr(Ge,_e)))&&ee.push(Ge);return ee}function qe(f){var m=f.length;return m?f[If(0,m-1)]:t}function Re(f,m){return Hn(eu(f),sn(m,0,f.length))}function Ze(f){return Hn(eu(f))}function at(f,m,S){(S!==t&&!Fa(f[m],S)||S===t&&!(m in f))&&Sr(f,m,S)}function ht(f,m,S){var k=f[m];(!(fa.call(f,m)&&Fa(k,S))||S===t&&!(m in f))&&Sr(f,m,S)}function Ot(f,m){for(var S=f.length;S--;)if(Fa(f[S][0],m))return S;return-1}function It(f,m,S,k){return Zn(f,function(B,G,Z){m(k,B,S(B),Z)}),k}function Ut(f,m){return f&&Rl(m,ru(m),f)}function cr(f,m){return f&&Rl(m,Ws(m),f)}function Sr(f,m,S){m=="__proto__"&&Bo?Bo(f,m,{configurable:!0,enumerable:!0,value:S,writable:!0}):f[m]=S}function zr(f,m){for(var S=-1,k=m.length,B=Vt(k),G=f==null;++S<k;)B[S]=G?t:pv(f,m[S]);return B}function sn(f,m,S){return f===f&&(S!==t&&(f=f<=S?f:S),m!==t&&(f=f>=m?f:m)),f}function Cn(f,m,S,k,B,G){var Z,ee=m&b,_e=m&w,Ge=m&M;if(S&&(Z=B?S(f,k,B,G):S(f)),Z!==t)return Z;if(!Io(f))return f;var Xe=xi(f);if(Xe){if(Z=jt(f),!ee)return eu(f,Z)}else{var it=Ue(f),bt=it==Wt||it==Me;if(Fl(f))return Hp(f,ee);if(it==qt||it==Ar||bt&&!B){if(Z=_e||bt?{}:sr(f),!ee)return _e?Bh(f,cr(Z,f)):Dh(f,Ut(Z,f))}else{if(!Ji[it])return B?f:{};Z=br(f,it,ee)}}G||(G=new X);var kt=G.get(f);if(kt)return kt;G.set(f,Z),Pd(f)?f.forEach(function(ir){Z.add(Cn(ir,m,S,ir,f,G))}):Uh(f)&&f.forEach(function(ir,Ur){Z.set(Ur,Cn(ir,m,S,Ur,f,G))});var Xt=Ge?_e?Jv:Qv:_e?Ws:ru,Ht=Xe?t:Xt(f);return Do(Ht||f,function(ir,Ur){Ht&&(Ur=ir,ir=f[Ur]),ht(Z,Ur,Cn(ir,m,S,Ur,f,G))}),Z}function Dn(f){var m=ru(f);return function(S){return Nn(S,f,m)}}function Nn(f,m,S){var k=S.length;if(f==null)return!k;for(f=Gn(f);k--;){var B=S[k],G=m[B],Z=f[B];if(Z===t&&!(B in f)||!G(Z))return!1}return!0}function ta(f,m,S){if(typeof f!="function")throw new uu(o);return si(function(){f.apply(t,S)},m)}function un(f,m,S,k){var B=-1,G=xu,Z=!0,ee=f.length,_e=[],Ge=m.length;if(!ee)return _e;S&&(m=ro(m,Nu(S))),k?(G=va,Z=!1):m.length>=i&&(G=Th,Z=!1,m=new R(m));e:for(;++B<ee;){var Xe=f[B],it=S==null?Xe:S(Xe);if(Xe=k||Xe!==0?Xe:0,Z&&it===it){for(var bt=Ge;bt--;)if(m[bt]===it)continue e;_e.push(Xe)}else G(m,it,k)||_e.push(Xe)}return _e}var Zn=tv(io),ui=tv(So,!0);function ni(f,m){var S=!0;return Zn(f,function(k,B,G){return S=!!m(k,B,G),S}),S}function jn(f,m,S){for(var k=-1,B=f.length;++k<B;){var G=f[k],Z=m(G);if(Z!=null&&(ee===t?Z===Z&&!Xu(Z):S(Z,ee)))var ee=Z,_e=G}return _e}function yi(f,m,S,k){var B=f.length;for(S=vi(S),S<0&&(S=-S>B?0:B+S),k=k===t||k>B?B:vi(k),k<0&&(k+=B),k=S>k?0:Bm(k);S<k;)f[S++]=m;return f}function Qn(f,m){var S=[];return Zn(f,function(k,B,G){m(k,B,G)&&S.push(k)}),S}function wn(f,m,S,k,B){var G=-1,Z=f.length;for(S||(S=Lr),B||(B=[]);++G<Z;){var ee=f[G];m>0&&S(ee)?m>1?wn(ee,m-1,S,k,B):ou(B,ee):k||(B[B.length]=ee)}return B}var Ba=rv(),co=rv(!0);function io(f,m){return f&&Ba(f,m,ru)}function So(f,m){return f&&co(f,m,ru)}function Ka(f,m){return uc(m,function(S){return Ec(f[S])})}function Na(f,m){m=ll(m,f);for(var S=0,k=m.length;f!=null&&S<k;)f=f[fi(m[S++])];return S&&S==k?f:t}function Cs(f,m,S){var k=m(f);return xi(f)?k:ou(k,S(f))}function Ra(f){return f==null?f===t?W:Yt:hs&&hs in Gn(f)?uh(f):Zt(f)}function Ss(f,m){return f>m}function zs(f,m){return f!=null&&fa.call(f,m)}function nl(f,m){return f!=null&&m in Gn(f)}function Au(f,m,S){return f>=_o(m,S)&&f<ti(m,S)}function Zc(f,m,S){for(var k=S?va:xu,B=f[0].length,G=f.length,Z=G,ee=Vt(G),_e=1/0,Ge=[];Z--;){var Xe=f[Z];Z&&m&&(Xe=ro(Xe,Nu(m))),_e=_o(Xe.length,_e),ee[Z]=!S&&(m||B>=120&&Xe.length>=120)?new R(Z&&Xe):t}Xe=f[0];var it=-1,bt=ee[0];e:for(;++it<B&&Ge.length<_e;){var kt=Xe[it],Xt=m?m(kt):kt;if(kt=S||kt!==0?kt:0,!(bt?Th(bt,Xt):k(Ge,Xt,S))){for(Z=G;--Z;){var Ht=ee[Z];if(!(Ht?Th(Ht,Xt):k(f[Z],Xt,S)))continue e}bt&&bt.push(Xt),Ge.push(kt)}}return Ge}function nh(f,m,S,k){return io(f,function(B,G,Z){m(k,S(B),G,Z)}),k}function il(f,m,S){m=ll(m,f),f=Yr(f,m);var k=f==null?f:f[fi(He(m))];return k==null?t:Fo(k,f,S)}function Yc(f){return po(f)&&Ra(f)==Ar}function Tf(f){return po(f)&&Ra(f)==mr}function Gu(f){return po(f)&&Ra(f)==hr}function Tu(f,m,S,k,B){return f===m?!0:f==null||m==null||!po(f)&&!po(m)?f!==f&&m!==m:Ql(f,m,S,k,Tu,B)}function Ql(f,m,S,k,B,G){var Z=xi(f),ee=xi(m),_e=Z?xa:Ue(f),Ge=ee?xa:Ue(m);_e=_e==Ar?qt:_e,Ge=Ge==Ar?qt:Ge;var Xe=_e==qt,it=Ge==qt,bt=_e==Ge;if(bt&&Fl(f)){if(!Fl(m))return!1;Z=!0,Xe=!1}if(bt&&!Xe)return G||(G=new X),Z||hh(f)?Cd(f,m,S,k,B,G):R0(f,m,_e,S,k,B,G);if(!(S&O)){var kt=Xe&&fa.call(f,"__wrapped__"),Xt=it&&fa.call(m,"__wrapped__");if(kt||Xt){var Ht=kt?f.value():f,ir=Xt?m.value():m;return G||(G=new X),B(Ht,ir,S,k,G)}}return bt?(G||(G=new X),Rm(f,m,S,k,B,G)):!1}function Zo(f){return po(f)&&Ue(f)==Qe}function al(f,m,S,k){var B=S.length,G=B,Z=!k;if(f==null)return!G;for(f=Gn(f);B--;){var ee=S[B];if(Z&&ee[2]?ee[1]!==f[ee[0]]:!(ee[0]in f))return!1}for(;++B<G;){ee=S[B];var _e=ee[0],Ge=f[_e],Xe=ee[1];if(Z&&ee[2]){if(Ge===t&&!(_e in f))return!1}else{var it=new X;if(k)var bt=k(Ge,Xe,_e,f,m,it);if(!(bt===t?Tu(Xe,Ge,O|N,k,it):bt))return!1}}return!0}function yc(f){if(!Io(f)||Ft(f))return!1;var m=Ec(f)?mn:Zr;return m.test(Pa(f))}function Mf(f){return po(f)&&Ra(f)==xr}function Bi(f){return po(f)&&Ue(f)==kr}function cu(f){return po(f)&&Cc(f.length)&&!!to[Ra(f)]}function La(f){return typeof f=="function"?f:f==null?zf:typeof f=="object"?xi(f)?ah(f[0],f[1]):ol(f):uy(f)}function Mu(f){if(!Kr(f))return Vu(f);var m=[];for(var S in Gn(f))fa.call(f,S)&&S!="constructor"&&m.push(S);return m}function ih(f){if(!Io(f))return er(f);var m=Kr(f),S=[];for(var k in f)k=="constructor"&&(m||!fa.call(f,k))||S.push(k);return S}function Iu(f,m){return f<m}function Ph(f,m){var S=-1,k=Aa(f)?Vt(f.length):[];return Zn(f,function(B,G,Z){k[++S]=m(B,G,Z)}),k}function ol(f){var m=av(f);return m.length==1&&m[0][2]?Br(m[0][0],m[0][1]):function(S){return S===f||al(S,f,m)}}function ah(f,m){return gr(f)&&ar(m)?Br(fi(f),m):function(S){var k=pv(S,f);return k===t&&k===m?dv(S,f):Tu(m,k,O|N)}}function fu(f,m,S,k,B){f!==m&&Ba(m,function(G,Z){if(B||(B=new X),Io(G))Tl(f,m,Z,S,fu,k,B);else{var ee=k?k(Qr(f,Z),G,Z+"",f,m,B):t;ee===t&&(ee=G),at(f,Z,ee)}},Ws)}function Tl(f,m,S,k,B,G,Z){var ee=Qr(f,S),_e=Qr(m,S),Ge=Z.get(_e);if(Ge){at(f,S,Ge);return}var Xe=G?G(ee,_e,S+"",f,m,Z):t,it=Xe===t;if(it){var bt=xi(_e),kt=!bt&&Fl(_e),Xt=!bt&&!kt&&hh(_e);Xe=_e,bt||kt||Xt?xi(ee)?Xe=ee:Xa(ee)?Xe=eu(ee):kt?(it=!1,Xe=Hp(_e,!0)):Xt?(it=!1,Xe=tc(_e,!0)):Xe=[]:Vh(_e)||Ru(_e)?(Xe=ee,Ru(ee)?Xe=rs(ee):(!Io(ee)||Ec(ee))&&(Xe=sr(_e))):it=!1}it&&(Z.set(_e,Xe),B(Xe,_e,k,G,Z),Z.delete(_e)),at(f,S,Xe)}function qc(f,m){var S=f.length;if(!!S)return m+=m<0?S:0,dr(m,S)?f[m]:t}function sl(f,m,S){m.length?m=ro(m,function(G){return xi(G)?function(Z){return Na(Z,G.length===1?G[0]:G)}:G}):m=[zf];var k=-1;m=ro(m,Nu(di()));var B=Ph(f,function(G,Z,ee){var _e=ro(m,function(Ge){return Ge(G)});return{criteria:_e,index:++k,value:G}});return _f(B,function(G,Z){return As(G,Z,S)})}function bo(f,m){return ul(f,m,function(S,k){return dv(f,k)})}function ul(f,m,S){for(var k=-1,B=m.length,G={};++k<B;){var Z=m[k],ee=Na(f,Z);S(ee,Z)&&Il(G,ll(Z,f),ee)}return G}function Up(f){return function(m){return Na(m,f)}}function up(f,m,S,k){var B=k?Ah:Zs,G=-1,Z=m.length,ee=f;for(f===m&&(m=eu(m)),S&&(ee=ro(f,Nu(S)));++G<Z;)for(var _e=0,Ge=m[G],Xe=S?S(Ge):Ge;(_e=B(ee,Xe,_e,k))>-1;)ee!==f&&Kl.call(ee,_e,1),Kl.call(f,_e,1);return f}function yd(f,m){for(var S=f?m.length:0,k=S-1;S--;){var B=m[S];if(S==k||B!==G){var G=B;dr(B)?Kl.call(f,B,1):Zv(f,B)}}return f}function If(f,m){return f+dc(El()*(m-f+1))}function Ml(f,m,S,k){for(var B=-1,G=ti(xl((m-f)/(S||1)),0),Z=Vt(G);G--;)Z[k?G:++B]=f,f+=S;return Z}function Vp(f,m){var S="";if(!f||m<1||m>$t)return S;do m%2&&(S+=f),m=dc(m/2),m&&(f+=f);while(m);return S}function Ni(f,m){return ai(en(f,m,zf),f+"")}function lp(f){return qe(Gh(f))}function Jd(f,m){var S=Gh(f);return Hn(S,sn(m,0,S.length))}function Il(f,m,S,k){if(!Io(f))return f;m=ll(m,f);for(var B=-1,G=m.length,Z=G-1,ee=f;ee!=null&&++B<G;){var _e=fi(m[B]),Ge=S;if(_e==="__proto__"||_e==="constructor"||_e==="prototype")return f;if(B!=Z){var Xe=ee[_e];Ge=k?k(Xe,_e,ee):t,Ge===t&&(Ge=Io(Xe)?Xe:dr(m[B+1])?[]:{})}ht(ee,_e,Ge),ee=ee[_e]}return f}var oi=ds?function(f,m){return ds.set(f,m),f}:zf,Gp=Bo?function(f,m){return Bo(f,"toString",{configurable:!0,enumerable:!1,value:xv(m),writable:!0})}:zf;function $v(f){return Hn(Gh(f))}function hu(f,m,S){var k=-1,B=f.length;m<0&&(m=-m>B?0:B+m),S=S>B?B:S,S<0&&(S+=B),B=m>S?0:S-m>>>0,m>>>=0;for(var G=Vt(B);++k<B;)G[k]=f[k+m];return G}function km(f,m){var S;return Zn(f,function(k,B,G){return S=m(k,B,G),!S}),!!S}function Kc(f,m,S){var k=0,B=f==null?k:f.length;if(typeof m=="number"&&m===m&&B<=dn){for(;k<B;){var G=k+B>>>1,Z=f[G];Z!==null&&!Xu(Z)&&(S?Z<=m:Z<m)?k=G+1:B=G}return B}return Xv(f,m,zf,S)}function Xv(f,m,S,k){var B=0,G=f==null?0:f.length;if(G===0)return 0;m=S(m);for(var Z=m!==m,ee=m===null,_e=Xu(m),Ge=m===t;B<G;){var Xe=dc((B+G)/2),it=S(f[Xe]),bt=it!==t,kt=it===null,Xt=it===it,Ht=Xu(it);if(Z)var ir=k||Xt;else Ge?ir=Xt&&(k||bt):ee?ir=Xt&&bt&&(k||!kt):_e?ir=Xt&&bt&&!kt&&(k||!Ht):kt||Ht?ir=!1:ir=k?it<=m:it<m;ir?B=Xe+1:G=Xe}return _o(G,rn)}function cp(f,m){for(var S=-1,k=f.length,B=0,G=[];++S<k;){var Z=f[S],ee=m?m(Z):Z;if(!S||!Fa(ee,_e)){var _e=ee;G[B++]=Z===0?0:Z}}return G}function ev(f){return typeof f=="number"?f:Xu(f)?jr:+f}function Jl(f){if(typeof f=="string")return f;if(xi(f))return ro(f,Jl)+"";if(Xu(f))return Sl?Sl.call(f):"";var m=f+"";return m=="0"&&1/f==-Rt?"-0":m}function ws(f,m,S){var k=-1,B=xu,G=f.length,Z=!0,ee=[],_e=ee;if(S)Z=!1,B=va;else if(G>=i){var Ge=m?null:la(f);if(Ge)return Zl(Ge);Z=!1,B=Th,_e=new R}else _e=m?[]:ee;e:for(;++k<G;){var Xe=f[k],it=m?m(Xe):Xe;if(Xe=S||Xe!==0?Xe:0,Z&&it===it){for(var bt=_e.length;bt--;)if(_e[bt]===it)continue e;m&&_e.push(it),ee.push(Xe)}else B(_e,it,S)||(_e!==ee&&_e.push(it),ee.push(Xe))}return ee}function Zv(f,m){return m=ll(m,f),f=Yr(f,m),f==null||delete f[fi(He(m))]}function ts(f,m,S,k){return Il(f,m,S(Na(f,m)),k)}function fp(f,m,S,k){for(var B=f.length,G=k?B:-1;(k?G--:++G<B)&&m(f[G],G,f););return S?hu(f,k?0:G,k?G+1:B):hu(f,k?G+1:0,k?B:G)}function Yv(f,m){var S=f;return S instanceof Ii&&(S=S.value()),ep(m,function(k,B){return B.func.apply(B.thisArg,ou([k],B.args))},S)}function jp(f,m,S){var k=f.length;if(k<2)return k?ws(f[0]):[];for(var B=-1,G=Vt(k);++B<k;)for(var Z=f[B],ee=-1;++ee<k;)ee!=B&&(G[B]=un(G[B]||Z,f[ee],m,S));return ws(wn(G,1),m,S)}function Fh(f,m,S){for(var k=-1,B=f.length,G=m.length,Z={};++k<B;){var ee=k<G?m[k]:t;S(Z,f[k],ee)}return Z}function Lf(f){return Xa(f)?f:[]}function hp(f){return typeof f=="function"?f:zf}function ll(f,m){return xi(f)?f:gr(f,m)?[f]:li(oo(f))}var pp=Ni;function ec(f,m,S){var k=f.length;return S=S===t?k:S,!m&&S>=k?f:hu(f,m,S)}var dp=kh||function(f){return Yi.clearTimeout(f)};function Hp(f,m){if(m)return f.slice();var S=f.length,k=Uu?Uu(S):new f.constructor(S);return f.copy(k),k}function Ll(f){var m=new f.constructor(f.byteLength);return new Ju(m).set(new Ju(f)),m}function _d(f,m){var S=m?Ll(f.buffer):f.buffer;return new f.constructor(S,f.byteOffset,f.byteLength)}function ju(f){var m=new f.constructor(f.source,Bt.exec(f));return m.lastIndex=f.lastIndex,m}function kl(f){return lu?Gn(lu.call(f)):{}}function tc(f,m){var S=m?Ll(f.buffer):f.buffer;return new f.constructor(S,f.byteOffset,f.length)}function Hu(f,m){if(f!==m){var S=f!==t,k=f===null,B=f===f,G=Xu(f),Z=m!==t,ee=m===null,_e=m===m,Ge=Xu(m);if(!ee&&!Ge&&!G&&f>m||G&&Z&&_e&&!ee&&!Ge||k&&Z&&_e||!S&&_e||!B)return 1;if(!k&&!G&&!Ge&&f<m||Ge&&S&&B&&!k&&!G||ee&&S&&B||!Z&&B||!_e)return-1}return 0}function As(f,m,S){for(var k=-1,B=f.criteria,G=m.criteria,Z=B.length,ee=S.length;++k<Z;){var _e=Hu(B[k],G[k]);if(_e){if(k>=ee)return _e;var Ge=S[k];return _e*(Ge=="desc"?-1:1)}}return f.index-m.index}function vp(f,m,S,k){for(var B=-1,G=f.length,Z=S.length,ee=-1,_e=m.length,Ge=ti(G-Z,0),Xe=Vt(_e+Ge),it=!k;++ee<_e;)Xe[ee]=m[ee];for(;++B<Z;)(it||B<G)&&(Xe[S[B]]=f[B]);for(;Ge--;)Xe[ee++]=f[B++];return Xe}function Wp(f,m,S,k){for(var B=-1,G=f.length,Z=-1,ee=S.length,_e=-1,Ge=m.length,Xe=ti(G-ee,0),it=Vt(Xe+Ge),bt=!k;++B<Xe;)it[B]=f[B];for(var kt=B;++_e<Ge;)it[kt+_e]=m[_e];for(;++Z<ee;)(bt||B<G)&&(it[kt+S[Z]]=f[B++]);return it}function eu(f,m){var S=-1,k=f.length;for(m||(m=Vt(k));++S<k;)m[S]=f[S];return m}function Rl(f,m,S,k){var B=!S;S||(S={});for(var G=-1,Z=m.length;++G<Z;){var ee=m[G],_e=k?k(S[ee],f[ee],ee,S,f):t;_e===t&&(_e=f[ee]),B?Sr(S,ee,_e):ht(S,ee,_e)}return S}function Dh(f,m){return Rl(f,H(f),m)}function Bh(f,m){return Rl(f,Ee(f),m)}function mp(f,m){return function(S,k){var B=xi(S)?yf:It,G=m?m():{};return B(S,f,di(k,2),G)}}function gp(f){return Ni(function(m,S){var k=-1,B=S.length,G=B>1?S[B-1]:t,Z=B>2?S[2]:t;for(G=f.length>3&&typeof G=="function"?(B--,G):t,Z&&Mr(S[0],S[1],Z)&&(G=B<3?t:G,B=1),m=Gn(m);++k<B;){var ee=S[k];ee&&f(m,ee,k,G)}return m})}function tv(f,m){return function(S,k){if(S==null)return S;if(!Aa(S))return f(S,k);for(var B=S.length,G=m?B:-1,Z=Gn(S);(m?G--:++G<B)&&k(Z[G],G,Z)!==!1;);return S}}function rv(f){return function(m,S,k){for(var B=-1,G=Gn(m),Z=k(m),ee=Z.length;ee--;){var _e=Z[f?ee:++B];if(S(G[_e],_e,G)===!1)break}return m}}function oh(f,m,S){var k=m&z,B=sh(f);function G(){var Z=this&&this!==Yi&&this instanceof G?B:f;return Z.apply(k?S:this,arguments)}return G}function qv(f){return function(m){m=oo(m);var S=zu(m)?su(m):t,k=S?S[0]:m.charAt(0),B=S?ec(S,1).join(""):m.slice(1);return k[f]()+B}}function _c(f){return function(m){return ep(y_(Nd(m).replace(qd,"")),f,"")}}function sh(f){return function(){var m=arguments;switch(m.length){case 0:return new f;case 1:return new f(m[0]);case 2:return new f(m[0],m[1]);case 3:return new f(m[0],m[1],m[2]);case 4:return new f(m[0],m[1],m[2],m[3]);case 5:return new f(m[0],m[1],m[2],m[3],m[4]);case 6:return new f(m[0],m[1],m[2],m[3],m[4],m[5]);case 7:return new f(m[0],m[1],m[2],m[3],m[4],m[5],m[6])}var S=Ns(f.prototype),k=f.apply(S,m);return Io(k)?k:S}}function kf(f,m,S){var k=sh(f);function B(){for(var G=arguments.length,Z=Vt(G),ee=G,_e=Nh(B);ee--;)Z[ee]=arguments[ee];var Ge=G<3&&Z[0]!==_e&&Z[G-1]!==_e?[]:Ks(Z,_e);if(G-=Ge.length,G<S)return Ts(f,m,cl,B.placeholder,t,Z,Ge,t,t,S-G);var Xe=this&&this!==Yi&&this instanceof B?k:f;return Fo(Xe,this,Z)}return B}function Ol(f){return function(m,S,k){var B=Gn(m);if(!Aa(m)){var G=di(S,3);m=ru(m),S=function(ee){return G(B[ee],ee,B)}}var Z=f(m,S,k);return Z>-1?B[G?m[Z]:Z]:t}}function rc(f){return Of(function(m){var S=m.length,k=S,B=Es.prototype.thru;for(f&&m.reverse();k--;){var G=m[k];if(typeof G!="function")throw new uu(o);if(B&&!Z&&$p(G)=="wrapper")var Z=new Es([],!0)}for(k=Z?k:S;++k<S;){G=m[k];var ee=$p(G),_e=ee=="wrapper"?_p(G):t;_e&&ft(_e[0])&&_e[1]==(ze|K|le|ue)&&!_e[4].length&&_e[9]==1?Z=Z[$p(_e[0])].apply(Z,_e[3]):Z=G.length==1&&ft(G)?Z[ee]():Z.thru(G)}return function(){var Ge=arguments,Xe=Ge[0];if(Z&&Ge.length==1&&xi(Xe))return Z.plant(Xe).value();for(var it=0,bt=S?m[it].apply(this,Ge):Xe;++it<S;)bt=m[it].call(this,bt);return bt}})}function cl(f,m,S,k,B,G,Z,ee,_e,Ge){var Xe=m&ze,it=m&z,bt=m&j,kt=m&(K|ie),Xt=m&Ke,Ht=bt?t:sh(f);function ir(){for(var Ur=arguments.length,qn=Vt(Ur),Ri=Ur;Ri--;)qn[Ri]=arguments[Ri];if(kt)var Ai=Nh(ir),Oi=Nc(qn,Ai);if(k&&(qn=vp(qn,k,B,kt)),G&&(qn=Wp(qn,G,Z,kt)),Ur-=Oi,kt&&Ur<Ge){var hi=Ks(qn,Ai);return Ts(f,m,cl,ir.placeholder,S,qn,hi,ee,_e,Ge-Ur)}var or=it?S:this,yr=bt?or[f]:f;return Ur=qn.length,ee?qn=Ir(qn,ee):Xt&&Ur>1&&qn.reverse(),Xe&&_e<Ur&&(qn.length=_e),this&&this!==Yi&&this instanceof ir&&(yr=Ht||sh(yr)),yr.apply(or,qn)}return ir}function nv(f,m){return function(S,k){return nh(S,f,m(k),{})}}function Rf(f,m){return function(S,k){var B;if(S===t&&k===t)return m;if(S!==t&&(B=S),k!==t){if(B===t)return k;typeof S=="string"||typeof k=="string"?(S=Jl(S),k=Jl(k)):(S=ev(S),k=ev(k)),B=f(S,k)}return B}}function Lu(f){return Of(function(m){return m=ro(m,Nu(di())),Ni(function(S){var k=this;return f(m,function(B){return Fo(B,k,S)})})})}function yp(f,m){m=m===t?" ":Jl(m);var S=m.length;if(S<2)return S?Vp(m,f):m;var k=Vp(m,xl(f/Yl(m)));return zu(m)?ec(su(k),0,f).join(""):k.slice(0,f)}function iv(f,m,S,k){var B=m&z,G=sh(f);function Z(){for(var ee=-1,_e=arguments.length,Ge=-1,Xe=k.length,it=Vt(Xe+_e),bt=this&&this!==Yi&&this instanceof Z?G:f;++Ge<Xe;)it[Ge]=k[Ge];for(;_e--;)it[Ge++]=arguments[++ee];return Fo(bt,B?S:this,it)}return Z}function xd(f){return function(m,S,k){return k&&typeof k!="number"&&Mr(m,S,k)&&(S=k=t),m=Df(m),S===t?(S=m,m=0):S=Df(S),k=k===t?m<S?1:-1:Df(k),Ml(m,S,k,f)}}function bd(f){return function(m,S){return typeof m=="string"&&typeof S=="string"||(m=Dl(m),S=Dl(S)),f(m,S)}}function Ts(f,m,S,k,B,G,Z,ee,_e,Ge){var Xe=m&K,it=Xe?Z:t,bt=Xe?t:Z,kt=Xe?G:t,Xt=Xe?t:G;m|=Xe?le:Se,m&=~(Xe?Se:le),m&Y||(m&=~(z|j));var Ht=[f,m,B,kt,it,Xt,bt,ee,_e,Ge],ir=S.apply(t,Ht);return ft(f)&&an(ir,Ht),ir.placeholder=k,cn(ir,f,m)}function Qc(f){var m=no[f];return function(S,k){if(S=Dl(S),k=k==null?0:_o(vi(k),292),k&&vc(S)){var B=(oo(S)+"e").split("e"),G=m(B[0]+"e"+(+B[1]+k));return B=(oo(G)+"e").split("e"),+(B[0]+"e"+(+B[1]-k))}return m(S)}}var la=kn&&1/Zl(new kn([,-0]))[1]==Rt?function(f){return new kn(f)}:sy;function fl(f){return function(m){var S=Ue(m);return S==Qe?Uc(m):S==kr?Yf(m):Bp(m,f(m))}}function xc(f,m,S,k,B,G,Z,ee){var _e=m&j;if(!_e&&typeof f!="function")throw new uu(o);var Ge=k?k.length:0;if(Ge||(m&=~(le|Se),k=B=t),Z=Z===t?Z:ti(vi(Z),0),ee=ee===t?ee:vi(ee),Ge-=B?B.length:0,m&Se){var Xe=k,it=B;k=B=t}var bt=_e?t:_p(f),kt=[f,m,S,k,B,Xe,it,G,Z,ee];if(bt&&En(kt,bt),f=kt[0],m=kt[1],S=kt[2],k=kt[3],B=kt[4],ee=kt[9]=kt[9]===t?_e?0:f.length:ti(kt[9]-Ge,0),!ee&&m&(K|ie)&&(m&=~(K|ie)),!m||m==z)var Xt=oh(f,m,S);else m==K||m==ie?Xt=kf(f,m,ee):(m==le||m==(z|le))&&!B.length?Xt=iv(f,m,S,k):Xt=cl.apply(t,kt);var Ht=bt?oi:an;return cn(Ht(Xt,kt),f,m)}function Ed(f,m,S,k){return f===t||Fa(f,qf[S])&&!fa.call(k,S)?m:f}function Kv(f,m,S,k,B,G){return Io(f)&&Io(m)&&(G.set(m,f),fu(f,m,t,Kv,G),G.delete(m)),f}function k0(f){return Vh(f)?t:f}function Cd(f,m,S,k,B,G){var Z=S&O,ee=f.length,_e=m.length;if(ee!=_e&&!(Z&&_e>ee))return!1;var Ge=G.get(f),Xe=G.get(m);if(Ge&&Xe)return Ge==m&&Xe==f;var it=-1,bt=!0,kt=S&N?new R:t;for(G.set(f,m),G.set(m,f);++it<ee;){var Xt=f[it],Ht=m[it];if(k)var ir=Z?k(Ht,Xt,it,m,f,G):k(Xt,Ht,it,f,m,G);if(ir!==t){if(ir)continue;bt=!1;break}if(kt){if(!Sh(m,function(Ur,qn){if(!Th(kt,qn)&&(Xt===Ur||B(Xt,Ur,S,k,G)))return kt.push(qn)})){bt=!1;break}}else if(!(Xt===Ht||B(Xt,Ht,S,k,G))){bt=!1;break}}return G.delete(f),G.delete(m),bt}function R0(f,m,S,k,B,G,Z){switch(S){case fr:if(f.byteLength!=m.byteLength||f.byteOffset!=m.byteOffset)return!1;f=f.buffer,m=m.buffer;case mr:return!(f.byteLength!=m.byteLength||!G(new Ju(f),new Ju(m)));case Sa:case hr:case Ct:return Fa(+f,+m);case Kn:return f.name==m.name&&f.message==m.message;case xr:case vr:return f==m+"";case Qe:var ee=Uc;case kr:var _e=k&O;if(ee||(ee=Zl),f.size!=m.size&&!_e)return!1;var Ge=Z.get(f);if(Ge)return Ge==m;k|=N,Z.set(f,m);var Xe=Cd(ee(f),ee(m),k,B,G,Z);return Z.delete(f),Xe;case In:if(lu)return lu.call(f)==lu.call(m)}return!1}function Rm(f,m,S,k,B,G){var Z=S&O,ee=Qv(f),_e=ee.length,Ge=Qv(m),Xe=Ge.length;if(_e!=Xe&&!Z)return!1;for(var it=_e;it--;){var bt=ee[it];if(!(Z?bt in m:fa.call(m,bt)))return!1}var kt=G.get(f),Xt=G.get(m);if(kt&&Xt)return kt==m&&Xt==f;var Ht=!0;G.set(f,m),G.set(m,f);for(var ir=Z;++it<_e;){bt=ee[it];var Ur=f[bt],qn=m[bt];if(k)var Ri=Z?k(qn,Ur,bt,m,f,G):k(Ur,qn,bt,f,m,G);if(!(Ri===t?Ur===qn||B(Ur,qn,S,k,G):Ri)){Ht=!1;break}ir||(ir=bt=="constructor")}if(Ht&&!ir){var Ai=f.constructor,Oi=m.constructor;Ai!=Oi&&"constructor"in f&&"constructor"in m&&!(typeof Ai=="function"&&Ai instanceof Ai&&typeof Oi=="function"&&Oi instanceof Oi)&&(Ht=!1)}return G.delete(f),G.delete(m),Ht}function Of(f){return ai(en(f,t,Ui),f+"")}function Qv(f){return Cs(f,ru,H)}function Jv(f){return Cs(f,Ws,Ee)}var _p=ds?function(f){return ds.get(f)}:sy;function $p(f){for(var m=f.name+"",S=Bs[m],k=fa.call(Bs,m)?S.length:0;k--;){var B=S[k],G=B.func;if(G==null||G==f)return B.name}return m}function Nh(f){var m=fa.call(ye,"placeholder")?ye:f;return m.placeholder}function di(){var f=ye.iteratee||Qm;return f=f===Qm?La:f,arguments.length?f(arguments[0],arguments[1]):f}function Oa(f,m){var S=f.__data__;return Or(m)?S[typeof m=="string"?"string":"hash"]:S.map}function av(f){for(var m=ru(f),S=m.length;S--;){var k=m[S],B=f[k];m[S]=[k,B,ar(B)]}return m}function Wu(f,m){var S=np(f,m);return yc(S)?S:t}function uh(f){var m=fa.call(f,hs),S=f[hs];try{f[hs]=t;var k=!0}catch{}var B=Sf.call(f);return k&&(m?f[hs]=S:delete f[hs]),B}var H=bl?function(f){return f==null?[]:(f=Gn(f),uc(bl(f),function(m){return qr.call(f,m)}))}:c0,Ee=bl?function(f){for(var m=[];f;)ou(m,H(f)),f=fs(f);return m}:c0,Ue=Ra;(ps&&Ue(new ps(new ArrayBuffer(1)))!=fr||xo&&Ue(new xo)!=Qe||$c&&Ue($c.resolve())!=_r||kn&&Ue(new kn)!=kr||bn&&Ue(new bn)!=st)&&(Ue=function(f){var m=Ra(f),S=m==qt?f.constructor:t,k=S?Pa(S):"";if(k)switch(k){case is:return fr;case Cl:return Qe;case zp:return _r;case Su:return kr;case ma:return st}return m});function wt(f,m,S){for(var k=-1,B=S.length;++k<B;){var G=S[k],Z=G.size;switch(G.type){case"drop":f+=Z;break;case"dropRight":m-=Z;break;case"take":m=_o(m,f+Z);break;case"takeRight":f=ti(f,m-Z);break}}return{start:f,end:m}}function rr(f){var m=f.match(Jt);return m?m[1].split(Cr):[]}function Et(f,m,S){m=ll(m,f);for(var k=-1,B=m.length,G=!1;++k<B;){var Z=fi(m[k]);if(!(G=f!=null&&S(f,Z)))break;f=f[Z]}return G||++k!=B?G:(B=f==null?0:f.length,!!B&&Cc(B)&&dr(Z,B)&&(xi(f)||Ru(f)))}function jt(f){var m=f.length,S=new f.constructor(m);return m&&typeof f[0]=="string"&&fa.call(f,"index")&&(S.index=f.index,S.input=f.input),S}function sr(f){return typeof f.constructor=="function"&&!Kr(f)?Ns(fs(f)):{}}function br(f,m,S){var k=f.constructor;switch(m){case mr:return Ll(f);case Sa:case hr:return new k(+f);case fr:return _d(f,S);case nn:case Mn:case Wn:case Bn:case Mi:case mi:case mo:case ca:case Ki:return tc(f,S);case Qe:return new k;case Ct:case vr:return new k(f);case xr:return ju(f);case kr:return new k;case In:return kl(f)}}function Rr(f,m){var S=m.length;if(!S)return f;var k=S-1;return m[k]=(S>1?"& ":"")+m[k],m=m.join(S>2?", ":" "),f.replace(mt,`{
/* [wrapped with `+m+`] */
`)}function Lr(f){return xi(f)||Ru(f)||!!(Jo&&f&&f[Jo])}function dr(f,m){var S=typeof f;return m=m==null?$t:m,!!m&&(S=="number"||S!="symbol"&&Jr.test(f))&&f>-1&&f%1==0&&f<m}function Mr(f,m,S){if(!Io(S))return!1;var k=typeof m;return(k=="number"?Aa(S)&&dr(m,S.length):k=="string"&&m in S)?Fa(S[m],f):!1}function gr(f,m){if(xi(f))return!1;var S=typeof f;return S=="number"||S=="symbol"||S=="boolean"||f==null||Xu(f)?!0:be.test(f)||!ce.test(f)||m!=null&&f in Gn(m)}function Or(f){var m=typeof f;return m=="string"||m=="number"||m=="symbol"||m=="boolean"?f!=="__proto__":f===null}function ft(f){var m=$p(f),S=ye[m];if(typeof S!="function"||!(m in Ii.prototype))return!1;if(f===S)return!0;var k=_p(S);return!!k&&f===k[0]}function Ft(f){return!!lo&&lo in f}var wr=pc?Ec:$0;function Kr(f){var m=f&&f.constructor,S=typeof m=="function"&&m.prototype||qf;return f===S}function ar(f){return f===f&&!Io(f)}function Br(f,m){return function(S){return S==null?!1:S[f]===m&&(m!==t||f in Gn(S))}}function Xr(f){var m=Eo(f,function(k){return S.size===p&&S.clear(),k}),S=m.cache;return m}function En(f,m){var S=f[1],k=m[1],B=S|k,G=B<(z|j|ze),Z=k==ze&&S==K||k==ze&&S==ue&&f[7].length<=m[8]||k==(ze|ue)&&m[7].length<=m[8]&&S==K;if(!(G||Z))return f;k&z&&(f[2]=m[2],B|=S&z?0:Y);var ee=m[3];if(ee){var _e=f[3];f[3]=_e?vp(_e,ee,m[4]):ee,f[4]=_e?Ks(f[3],y):m[4]}return ee=m[5],ee&&(_e=f[5],f[5]=_e?Wp(_e,ee,m[6]):ee,f[6]=_e?Ks(f[5],y):m[6]),ee=m[7],ee&&(f[7]=ee),k&ze&&(f[8]=f[8]==null?m[8]:_o(f[8],m[8])),f[9]==null&&(f[9]=m[9]),f[0]=m[0],f[1]=B,f}function er(f){var m=[];if(f!=null)for(var S in Gn(f))m.push(S);return m}function Zt(f){return Sf.call(f)}function en(f,m,S){return m=ti(m===t?f.length-1:m,0),function(){for(var k=arguments,B=-1,G=ti(k.length-m,0),Z=Vt(G);++B<G;)Z[B]=k[m+B];B=-1;for(var ee=Vt(m+1);++B<m;)ee[B]=k[B];return ee[m]=S(Z),Fo(f,this,ee)}}function Yr(f,m){return m.length<2?f:Na(f,hu(m,0,-1))}function Ir(f,m){for(var S=f.length,k=_o(m.length,S),B=eu(f);k--;){var G=m[k];f[k]=dr(G,S)?B[G]:t}return f}function Qr(f,m){if(!(m==="constructor"&&typeof f[m]=="function")&&m!="__proto__")return f[m]}var an=pn(oi),si=Eu||function(f,m){return Yi.setTimeout(f,m)},ai=pn(Gp);function cn(f,m,S){var k=m+"";return ai(f,Rr(k,Yo(rr(k),S)))}function pn(f){var m=0,S=0;return function(){var k=Cu(),B=ve-(k-S);if(S=k,B>0){if(++m>=je)return arguments[0]}else m=0;return f.apply(t,arguments)}}function Hn(f,m){var S=-1,k=f.length,B=k-1;for(m=m===t?k:m;++S<m;){var G=If(S,B),Z=f[G];f[G]=f[S],f[S]=Z}return f.length=m,f}var li=Xr(function(f){var m=[];return f.charCodeAt(0)===46&&m.push(""),f.replace(Be,function(S,k,B,G){m.push(B?G.replace(Nr,"$1"):k||S)}),m});function fi(f){if(typeof f=="string"||Xu(f))return f;var m=f+"";return m=="0"&&1/f==-Rt?"-0":m}function Pa(f){if(f!=null){try{return Cf.call(f)}catch{}try{return f+""}catch{}}return""}function Yo(f,m){return Do(Rn,function(S){var k="_."+S[0];m&S[1]&&!xu(f,k)&&f.push(k)}),f.sort()}function zi(f){if(f instanceof Ii)return f.clone();var m=new Es(f.__wrapped__,f.__chain__);return m.__actions__=eu(f.__actions__),m.__index__=f.__index__,m.__values__=f.__values__,m}function Us(f,m,S){(S?Mr(f,m,S):m===t)?m=1:m=ti(vi(m),0);var k=f==null?0:f.length;if(!k||m<1)return[];for(var B=0,G=0,Z=Vt(xl(k/m));B<k;)Z[G++]=hu(f,B,B+=m);return Z}function ao(f){for(var m=-1,S=f==null?0:f.length,k=0,B=[];++m<S;){var G=f[m];G&&(B[k++]=G)}return B}function ms(){var f=arguments.length;if(!f)return[];for(var m=Vt(f-1),S=arguments[0],k=f;k--;)m[k-1]=arguments[k];return ou(xi(S)?eu(S):[S],wn(m,1))}var as=Ni(function(f,m){return Xa(f)?un(f,wn(m,1,Xa,!0)):[]}),Vs=Ni(function(f,m){var S=He(m);return Xa(S)&&(S=t),Xa(f)?un(f,wn(m,1,Xa,!0),di(S,2)):[]}),Gs=Ni(function(f,m){var S=He(m);return Xa(S)&&(S=t),Xa(f)?un(f,wn(m,1,Xa,!0),t,S):[]});function Ms(f,m,S){var k=f==null?0:f.length;return k?(m=S||m===t?1:vi(m),hu(f,m<0?0:m,k)):[]}function wo(f,m,S){var k=f==null?0:f.length;return k?(m=S||m===t?1:vi(m),m=k-m,hu(f,0,m<0?0:m)):[]}function Si(f,m){return f&&f.length?fp(f,di(m,3),!0,!0):[]}function gs(f,m){return f&&f.length?fp(f,di(m,3),!0):[]}function ga(f,m,S,k){var B=f==null?0:f.length;return B?(S&&typeof S!="number"&&Mr(f,m,S)&&(S=0,k=B),yi(f,m,S,k)):[]}function No(f,m,S){var k=f==null?0:f.length;if(!k)return-1;var B=S==null?0:vi(S);return B<0&&(B=ti(k+B,0)),wh(f,di(m,3),B)}function Jn(f,m,S){var k=f==null?0:f.length;if(!k)return-1;var B=k-1;return S!==t&&(B=vi(S),B=S<0?ti(k+B,0):_o(B,k-1)),wh(f,di(m,3),B,!0)}function Ui(f){var m=f==null?0:f.length;return m?wn(f,1):[]}function $a(f){var m=f==null?0:f.length;return m?wn(f,Rt):[]}function ys(f,m){var S=f==null?0:f.length;return S?(m=m===t?1:vi(m),wn(f,m)):[]}function Pl(f){for(var m=-1,S=f==null?0:f.length,k={};++m<S;){var B=f[m];k[B[0]]=B[1]}return k}function Oe(f){return f&&f.length?f[0]:t}function Mt(f,m,S){var k=f==null?0:f.length;if(!k)return-1;var B=S==null?0:vi(S);return B<0&&(B=ti(k+B,0)),Zs(f,m,B)}function yt(f){var m=f==null?0:f.length;return m?hu(f,0,-1):[]}var gn=Ni(function(f){var m=ro(f,Lf);return m.length&&m[0]===f[0]?Zc(m):[]}),Vi=Ni(function(f){var m=He(f),S=ro(f,Lf);return m===He(S)?m=t:S.pop(),S.length&&S[0]===f[0]?Zc(S,di(m,2)):[]}),Te=Ni(function(f){var m=He(f),S=ro(f,Lf);return m=typeof m=="function"?m:t,m&&S.pop(),S.length&&S[0]===f[0]?Zc(S,t,m):[]});function pe(f,m){return f==null?"":el.call(f,m)}function He(f){var m=f==null?0:f.length;return m?f[m-1]:t}function ct(f,m,S){var k=f==null?0:f.length;if(!k)return-1;var B=k;return S!==t&&(B=vi(S),B=B<0?ti(k+B,0):_o(B,k-1)),m===m?Mh(f,m,B):wh(f,bu,B,!0)}function Tt(f,m){return f&&f.length?qc(f,vi(m)):t}var rt=Ni(Ye);function Ye(f,m){return f&&f.length&&m&&m.length?up(f,m):f}function nt(f,m,S){return f&&f.length&&m&&m.length?up(f,m,di(S,2)):f}function de(f,m,S){return f&&f.length&&m&&m.length?up(f,m,t,S):f}var $e=Of(function(f,m){var S=f==null?0:f.length,k=zr(f,m);return yd(f,ro(m,function(B){return dr(B,S)?+B:B}).sort(Hu)),k});function Le(f,m){var S=[];if(!(f&&f.length))return S;var k=-1,B=[],G=f.length;for(m=di(m,3);++k<G;){var Z=f[k];m(Z,k,f)&&(S.push(Z),B.push(k))}return yd(f,B),S}function ut(f){return f==null?f:Wc.call(f)}function _t(f,m,S){var k=f==null?0:f.length;return k?(S&&typeof S!="number"&&Mr(f,m,S)?(m=0,S=k):(m=m==null?0:vi(m),S=S===t?k:vi(S)),hu(f,m,S)):[]}function lr(f,m){return Kc(f,m)}function Hr(f,m,S){return Xv(f,m,di(S,2))}function $r(f,m){var S=f==null?0:f.length;if(S){var k=Kc(f,m);if(k<S&&Fa(f[k],m))return k}return-1}function fn(f,m){return Kc(f,m,!0)}function Gr(f,m,S){return Xv(f,m,di(S,2),!0)}function Ln(f,m){var S=f==null?0:f.length;if(S){var k=Kc(f,m,!0)-1;if(Fa(f[k],m))return k}return-1}function hn(f){return f&&f.length?cp(f):[]}function Sn(f,m){return f&&f.length?cp(f,di(m,2)):[]}function An(f){var m=f==null?0:f.length;return m?hu(f,1,m):[]}function Tn(f,m,S){return f&&f.length?(m=S||m===t?1:vi(m),hu(f,0,m<0?0:m)):[]}function ei(f,m,S){var k=f==null?0:f.length;return k?(m=S||m===t?1:vi(m),m=k-m,hu(f,m<0?0:m,k)):[]}function wa(f,m){return f&&f.length?fp(f,di(m,3),!1,!0):[]}function ya(f,m){return f&&f.length?fp(f,di(m,3)):[]}var hl=Ni(function(f){return ws(wn(f,1,Xa,!0))}),bc=Ni(function(f){var m=He(f);return Xa(m)&&(m=t),ws(wn(f,1,Xa,!0),di(m,2))}),za=Ni(function(f){var m=He(f);return m=typeof m=="function"?m:t,ws(wn(f,1,Xa,!0),t,m)});function ea(f){return f&&f.length?ws(f):[]}function Jc(f,m){return f&&f.length?ws(f,di(m,2)):[]}function nc(f,m){return m=typeof m=="function"?m:t,f&&f.length?ws(f,t,m):[]}function Sd(f){if(!(f&&f.length))return[];var m=0;return f=uc(f,function(S){if(Xa(S))return m=ti(S.length,m),!0}),Dc(m,function(S){return ro(f,Ys(S))})}function ic(f,m){if(!(f&&f.length))return[];var S=Sd(f);return m==null?S:ro(S,function(k){return Fo(m,t,k)})}var e0=Ni(function(f,m){return Xa(f)?un(f,m):[]}),Om=Ni(function(f){return jp(uc(f,Xa))}),wd=Ni(function(f){var m=He(f);return Xa(m)&&(m=t),jp(uc(f,Xa),di(m,2))}),zh=Ni(function(f){var m=He(f);return m=typeof m=="function"?m:t,jp(uc(f,Xa),t,m)}),O0=Ni(Sd);function Is(f,m){return Fh(f||[],m||[],ht)}function t0(f,m){return Fh(f||[],m||[],Il)}var xp=Ni(function(f){var m=f.length,S=m>1?f[m-1]:t;return S=typeof S=="function"?(f.pop(),S):t,ic(f,S)});function Ad(f){var m=ye(f);return m.__chain__=!0,m}function ov(f,m){return m(f),f}function Td(f,m){return m(f)}var Xp=Of(function(f){var m=f.length,S=m?f[0]:0,k=this.__wrapped__,B=function(G){return zr(G,f)};return m>1||this.__actions__.length||!(k instanceof Ii)||!dr(S)?this.thru(B):(k=k.slice(S,+S+(m?1:0)),k.__actions__.push({func:Td,args:[B],thisArg:t}),new Es(k,this.__chain__).thru(function(G){return m&&!G.length&&G.push(t),G}))});function Pf(){return Ad(this)}function lh(){return new Es(this.value(),this.__chain__)}function Zg(){this.__values__===t&&(this.__values__=F0(this.value()));var f=this.__index__>=this.__values__.length,m=f?t:this.__values__[this.__index__++];return{done:f,value:m}}function Pm(){return this}function js(f){for(var m,S=this;S instanceof vs;){var k=zi(S);k.__index__=0,k.__values__=t,m?B.__wrapped__=k:m=k;var B=k;S=S.__wrapped__}return B.__wrapped__=f,m}function Zp(){var f=this.__wrapped__;if(f instanceof Ii){var m=f;return this.__actions__.length&&(m=new Ii(this)),m=m.reverse(),m.__actions__.push({func:Td,args:[ut],thisArg:t}),new Es(m,this.__chain__)}return this.thru(ut)}function Fm(){return Yv(this.__wrapped__,this.__actions__)}var s=mp(function(f,m,S){fa.call(f,S)?++f[S]:Sr(f,S,1)});function u(f,m,S){var k=xi(f)?Du:ni;return S&&Mr(f,m,S)&&(m=t),k(f,di(m,3))}function h(f,m){var S=xi(f)?uc:Qn;return S(f,di(m,3))}var _=Ol(No),E=Ol(Jn);function A(f,m){return wn(Pe(f,m),1)}function I(f,m){return wn(Pe(f,m),Rt)}function D(f,m,S){return S=S===t?1:vi(S),wn(Pe(f,m),S)}function V(f,m){var S=xi(f)?Do:Zn;return S(f,di(m,3))}function $(f,m){var S=xi(f)?sc:ui;return S(f,di(m,3))}var q=mp(function(f,m,S){fa.call(f,S)?f[S].push(m):Sr(f,S,[m])});function te(f,m,S,k){f=Aa(f)?f:Gh(f),S=S&&!k?vi(S):0;var B=f.length;return S<0&&(S=ti(B+S,0)),Fd(f)?S<=B&&f.indexOf(m,S)>-1:!!B&&Zs(f,m,S)>-1}var oe=Ni(function(f,m,S){var k=-1,B=typeof m=="function",G=Aa(f)?Vt(f.length):[];return Zn(f,function(Z){G[++k]=B?Fo(m,Z,S):il(Z,m,S)}),G}),fe=mp(function(f,m,S){Sr(f,S,m)});function Pe(f,m){var S=xi(f)?ro:Ph;return S(f,di(m,3))}function De(f,m,S,k){return f==null?[]:(xi(m)||(m=m==null?[]:[m]),S=k?t:S,xi(S)||(S=S==null?[]:[S]),sl(f,m,S))}var tt=mp(function(f,m,S){f[S?0:1].push(m)},function(){return[[],[]]});function We(f,m,S){var k=xi(f)?ep:Xl,B=arguments.length<3;return k(f,di(m,4),S,B,Zn)}function lt(f,m,S){var k=xi(f)?tp:Xl,B=arguments.length<3;return k(f,di(m,4),S,B,ui)}function xt(f,m){var S=xi(f)?uc:Qn;return S(f,fo(di(m,3)))}function Lt(f){var m=xi(f)?qe:lp;return m(f)}function Pt(f,m,S){(S?Mr(f,m,S):m===t)?m=1:m=vi(m);var k=xi(f)?Re:Jd;return k(f,m)}function nr(f){var m=xi(f)?Ze:$v;return m(f)}function Fr(f){if(f==null)return 0;if(Aa(f))return Fd(f)?Yl(f):f.length;var m=Ue(f);return m==Qe||m==kr?f.size:Mu(f).length}function tn(f,m,S){var k=xi(f)?Sh:km;return S&&Mr(f,m,S)&&(m=t),k(f,di(m,3))}var Vn=Ni(function(f,m){if(f==null)return[];var S=m.length;return S>1&&Mr(f,m[0],m[1])?m=[]:S>2&&Mr(m[0],m[1],m[2])&&(m=[m[0]]),sl(f,wn(m,1),[])}),vn=sp||function(){return Yi.Date.now()};function $n(f,m){if(typeof m!="function")throw new uu(o);return f=vi(f),function(){if(--f<1)return m.apply(this,arguments)}}function yn(f,m,S){return m=S?t:m,m=f&&m==null?f.length:m,xc(f,ze,t,t,t,t,m)}function _i(f,m){var S;if(typeof m!="function")throw new uu(o);return f=vi(f),function(){return--f>0&&(S=m.apply(this,arguments)),f<=1&&(m=t),S}}var ii=Ni(function(f,m,S){var k=z;if(S.length){var B=Ks(S,Nh(ii));k|=le}return xc(f,k,m,S,B)}),Pn=Ni(function(f,m,S){var k=z|j;if(S.length){var B=Ks(S,Nh(Pn));k|=le}return xc(m,k,f,S,B)});function Gi(f,m,S){m=S?t:m;var k=xc(f,K,t,t,t,t,t,m);return k.placeholder=Gi.placeholder,k}function wi(f,m,S){m=S?t:m;var k=xc(f,ie,t,t,t,t,t,m);return k.placeholder=wi.placeholder,k}function aa(f,m,S){var k,B,G,Z,ee,_e,Ge=0,Xe=!1,it=!1,bt=!0;if(typeof f!="function")throw new uu(o);m=Dl(m)||0,Io(S)&&(Xe=!!S.leading,it="maxWait"in S,G=it?ti(Dl(S.maxWait)||0,m):G,bt="trailing"in S?!!S.trailing:bt);function kt(hi){var or=k,yr=B;return k=B=t,Ge=hi,Z=f.apply(yr,or),Z}function Xt(hi){return Ge=hi,ee=si(Ur,m),Xe?kt(hi):Z}function Ht(hi){var or=hi-_e,yr=hi-Ge,ri=m-or;return it?_o(ri,G-yr):ri}function ir(hi){var or=hi-_e,yr=hi-Ge;return _e===t||or>=m||or<0||it&&yr>=G}function Ur(){var hi=vn();if(ir(hi))return qn(hi);ee=si(Ur,Ht(hi))}function qn(hi){return ee=t,bt&&k?kt(hi):(k=B=t,Z)}function Ri(){ee!==t&&dp(ee),Ge=0,k=_e=B=ee=t}function Ai(){return ee===t?Z:qn(vn())}function Oi(){var hi=vn(),or=ir(hi);if(k=arguments,B=this,_e=hi,or){if(ee===t)return Xt(_e);if(it)return dp(ee),ee=si(Ur,m),kt(_e)}return ee===t&&(ee=si(Ur,m)),Z}return Oi.cancel=Ri,Oi.flush=Ai,Oi}var Yn=Ni(function(f,m){return ta(f,1,m)}),Ea=Ni(function(f,m,S){return ta(f,Dl(m)||0,S)});function Ao(f){return xc(f,Ke)}function Eo(f,m){if(typeof f!="function"||m!=null&&typeof m!="function")throw new uu(o);var S=function(){var k=arguments,B=m?m.apply(this,k):k[0],G=S.cache;if(G.has(B))return G.get(B);var Z=f.apply(this,k);return S.cache=G.set(B,Z)||G,Z};return S.cache=new(Eo.Cache||rl),S}Eo.Cache=rl;function fo(f){if(typeof f!="function")throw new uu(o);return function(){var m=arguments;switch(m.length){case 0:return!f.call(this);case 1:return!f.call(this,m[0]);case 2:return!f.call(this,m[0],m[1]);case 3:return!f.call(this,m[0],m[1],m[2])}return!f.apply(this,m)}}function To(f){return _i(2,f)}var qo=pp(function(f,m){m=m.length==1&&xi(m[0])?ro(m[0],Nu(di())):ro(wn(m,1),Nu(di()));var S=m.length;return Ni(function(k){for(var B=-1,G=_o(k.length,S);++B<G;)k[B]=m[B].call(this,k[B]);return Fo(f,this,k)})}),Ko=Ni(function(f,m){var S=Ks(m,Nh(Ko));return xc(f,le,t,m,S)}),Mo=Ni(function(f,m){var S=Ks(m,Nh(Mo));return xc(f,Se,t,m,S)}),$u=Of(function(f,m){return xc(f,ue,t,t,t,m)});function zo(f,m){if(typeof f!="function")throw new uu(o);return m=m===t?m:vi(m),Ni(f,m)}function ku(f,m){if(typeof f!="function")throw new uu(o);return m=m==null?0:ti(vi(m),0),Ni(function(S){var k=S[m],B=ec(S,0,m);return k&&ou(B,k),Fo(f,this,B)})}function Uo(f,m,S){var k=!0,B=!0;if(typeof f!="function")throw new uu(o);return Io(S)&&(k="leading"in S?!!S.leading:k,B="trailing"in S?!!S.trailing:B),aa(f,m,{leading:k,maxWait:m,trailing:B})}function tu(f){return yn(f,1)}function ra(f,m){return Ko(hp(m),f)}function Qa(){if(!arguments.length)return[];var f=arguments[0];return xi(f)?f:[f]}function Ua(f){return Cn(f,M)}function ha(f,m){return m=typeof m=="function"?m:t,Cn(f,M,m)}function pl(f){return Cn(f,b|M)}function Hs(f,m){return m=typeof m=="function"?m:t,Cn(f,b|M,m)}function ho(f,m){return m==null||Nn(f,m,ru(m))}function Fa(f,m){return f===m||f!==f&&m!==m}var Ls=bd(Ss),_a=bd(function(f,m){return f>=m}),Ru=Yc(function(){return arguments}())?Yc:function(f){return po(f)&&fa.call(f,"callee")&&!qr.call(f,"callee")},xi=Vt.isArray,ch=Dp?Nu(Dp):Tf;function Aa(f){return f!=null&&Cc(f.length)&&!Ec(f)}function Xa(f){return po(f)&&Aa(f)}function ef(f){return f===!0||f===!1||po(f)&&Ra(f)==Sa}var Fl=Qf||$0,Yp=Po?Nu(Po):Gu;function Md(f){return po(f)&&f.nodeType===1&&!Vh(f)}function fh(f){if(f==null)return!0;if(Aa(f)&&(xi(f)||typeof f=="string"||typeof f.splice=="function"||Fl(f)||hh(f)||Ru(f)))return!f.length;var m=Ue(f);if(m==Qe||m==kr)return!f.size;if(Kr(f))return!Mu(f).length;for(var S in f)if(fa.call(f,S))return!1;return!0}function Id(f,m){return Tu(f,m)}function sv(f,m,S){S=typeof S=="function"?S:t;var k=S?S(f,m):t;return k===t?Tu(f,m,t,S):!!k}function bp(f){if(!po(f))return!1;var m=Ra(f);return m==Kn||m==Dr||typeof f.message=="string"&&typeof f.name=="string"&&!Vh(f)}function Ld(f){return typeof f=="number"&&vc(f)}function Ec(f){if(!Io(f))return!1;var m=Ra(f);return m==Wt||m==Me||m==Ti||m==Pr}function kd(f){return typeof f=="number"&&f==vi(f)}function Cc(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=$t}function Io(f){var m=typeof f;return f!=null&&(m=="object"||m=="function")}function po(f){return f!=null&&typeof f=="object"}var Uh=Jh?Nu(Jh):Zo;function uv(f,m){return f===m||al(f,m,av(m))}function Rd(f,m,S){return S=typeof S=="function"?S:t,al(f,m,av(m),S)}function r0(f){return Ep(f)&&f!=+f}function lv(f){if(wr(f))throw new Ei(a);return yc(f)}function cv(f){return f===null}function Od(f){return f==null}function Ep(f){return typeof f=="number"||po(f)&&Ra(f)==Ct}function Vh(f){if(!po(f)||Ra(f)!=qt)return!1;var m=fs(f);if(m===null)return!0;var S=fa.call(m,"constructor")&&m.constructor;return typeof S=="function"&&S instanceof S&&Cf.call(S)==op}var qp=Fs?Nu(Fs):Mf;function P0(f){return kd(f)&&f>=-$t&&f<=$t}var Pd=Oc?Nu(Oc):Bi;function Fd(f){return typeof f=="string"||!xi(f)&&po(f)&&Ra(f)==vr}function Xu(f){return typeof f=="symbol"||po(f)&&Ra(f)==In}var hh=Xs?Nu(Xs):cu;function Ff(f){return f===t}function Kp(f){return po(f)&&Ue(f)==st}function fv(f){return po(f)&&Ra(f)==zt}var Dm=bd(Iu),Yg=bd(function(f,m){return f<=m});function F0(f){if(!f)return[];if(Aa(f))return Fd(f)?su(f):eu(f);if(Hc&&f[Hc])return zc(f[Hc]());var m=Ue(f),S=m==Qe?Uc:m==kr?Zl:Gh;return S(f)}function Df(f){if(!f)return f===0?f:0;if(f=Dl(f),f===Rt||f===-Rt){var m=f<0?-1:1;return m*gt}return f===f?f:0}function vi(f){var m=Df(f),S=m%1;return m===m?S?m-S:m:0}function Bm(f){return f?sn(vi(f),0,Er):0}function Dl(f){if(typeof f=="number")return f;if(Xu(f))return jr;if(Io(f)){var m=typeof f.valueOf=="function"?f.valueOf():f;f=Io(m)?m+"":m}if(typeof f!="string")return f===0?f:+f;f=Bc(f);var S=Wr.test(f);return S||gi.test(f)?Qh(f.slice(2),S?2:8):ln.test(f)?jr:+f}function rs(f){return Rl(f,Ws(f))}function ph(f){return f?sn(vi(f),-$t,$t):f===0?f:0}function oo(f){return f==null?"":Jl(f)}var pu=gp(function(f,m){if(Kr(m)||Aa(m)){Rl(m,ru(m),f);return}for(var S in m)fa.call(m,S)&&ht(f,S,m[S])}),D0=gp(function(f,m){Rl(m,Ws(m),f)}),hv=gp(function(f,m,S,k){Rl(m,Ws(m),f,k)}),n0=gp(function(f,m,S,k){Rl(m,ru(m),f,k)}),Bf=Of(zr);function B0(f,m){var S=Ns(f);return m==null?S:Ut(S,m)}var i0=Ni(function(f,m){f=Gn(f);var S=-1,k=m.length,B=k>2?m[2]:t;for(B&&Mr(m[0],m[1],B)&&(k=1);++S<k;)for(var G=m[S],Z=Ws(G),ee=-1,_e=Z.length;++ee<_e;){var Ge=Z[ee],Xe=f[Ge];(Xe===t||Fa(Xe,qf[Ge])&&!fa.call(f,Ge))&&(f[Ge]=G[Ge])}return f}),N0=Ni(function(f){return f.push(t,Kv),Fo(tf,t,f)});function z0(f,m){return lc(f,di(m,3),io)}function a0(f,m){return lc(f,di(m,3),So)}function Nm(f,m){return f==null?f:Ba(f,di(m,3),Ws)}function o0(f,m){return f==null?f:co(f,di(m,3),Ws)}function dh(f,m){return f&&io(f,di(m,3))}function qg(f,m){return f&&So(f,di(m,3))}function Kg(f){return f==null?[]:Ka(f,ru(f))}function zm(f){return f==null?[]:Ka(f,Ws(f))}function pv(f,m,S){var k=f==null?t:Na(f,m);return k===t?S:k}function Sc(f,m){return f!=null&&Et(f,m,zs)}function dv(f,m){return f!=null&&Et(f,m,nl)}var U0=nv(function(f,m,S){m!=null&&typeof m.toString!="function"&&(m=Sf.call(m)),f[m]=S},xv(zf)),Nf=nv(function(f,m,S){m!=null&&typeof m.toString!="function"&&(m=Sf.call(m)),fa.call(f,m)?f[m].push(S):f[m]=[S]},di),Um=Ni(il);function ru(f){return Aa(f)?Fe(f):Mu(f)}function Ws(f){return Aa(f)?Fe(f,!0):ih(f)}function vv(f,m){var S={};return m=di(m,3),io(f,function(k,B,G){Sr(S,m(k,B,G),k)}),S}function Cp(f,m){var S={};return m=di(m,3),io(f,function(k,B,G){Sr(S,B,m(k,B,G))}),S}var Dd=gp(function(f,m,S){fu(f,m,S)}),tf=gp(function(f,m,S,k){fu(f,m,S,k)}),mv=Of(function(f,m){var S={};if(f==null)return S;var k=!1;m=ro(m,function(G){return G=ll(G,f),k||(k=G.length>1),G}),Rl(f,Jv(f),S),k&&(S=Cn(S,b|w|M,k0));for(var B=m.length;B--;)Zv(S,m[B]);return S});function Qg(f,m){return Vm(f,fo(di(m)))}var Jg=Of(function(f,m){return f==null?{}:bo(f,m)});function Vm(f,m){if(f==null)return{};var S=ro(Jv(f),function(k){return[k]});return m=di(m),ul(f,S,function(k,B){return m(k,B[0])})}function Gm(f,m,S){m=ll(m,f);var k=-1,B=m.length;for(B||(B=1,f=t);++k<B;){var G=f==null?t:f[fi(m[k])];G===t&&(k=B,G=S),f=Ec(G)?G.call(f):G}return f}function jm(f,m,S){return f==null?f:Il(f,m,S)}function Sp(f,m,S,k){return k=typeof k=="function"?k:t,f==null?f:Il(f,m,S,k)}var Hm=fl(ru),gv=fl(Ws);function Wm(f,m,S){var k=xi(f),B=k||Fl(f)||hh(f);if(m=di(m,4),S==null){var G=f&&f.constructor;B?S=k?new G:[]:Io(f)?S=Ec(G)?Ns(fs(f)):{}:S={}}return(B?Do:io)(f,function(Z,ee,_e){return m(S,Z,ee,_e)}),S}function Bd(f,m){return f==null?!0:Zv(f,m)}function $m(f,m,S){return f==null?f:ts(f,m,hp(S))}function _s(f,m,S,k){return k=typeof k=="function"?k:t,f==null?f:ts(f,m,hp(S),k)}function Gh(f){return f==null?[]:rp(f,ru(f))}function V0(f){return f==null?[]:rp(f,Ws(f))}function s0(f,m,S){return S===t&&(S=m,m=t),S!==t&&(S=Dl(S),S=S===S?S:0),m!==t&&(m=Dl(m),m=m===m?m:0),sn(Dl(f),m,S)}function Qp(f,m,S){return m=Df(m),S===t?(S=m,m=0):S=Df(S),f=Dl(f),Au(f,m,S)}function yv(f,m,S){if(S&&typeof S!="boolean"&&Mr(f,m,S)&&(m=S=t),S===t&&(typeof m=="boolean"?(S=m,m=t):typeof f=="boolean"&&(S=f,f=t)),f===t&&m===t?(f=0,m=1):(f=Df(f),m===t?(m=f,f=0):m=Df(m)),f>m){var k=f;f=m,m=k}if(S||f%1||m%1){var B=El();return _o(f+B*(m-f+vd("1e-"+((B+"").length-1))),m)}return If(f,m)}var u0=_c(function(f,m,S){return m=m.toLowerCase(),f+(S?Xm(m):m)});function Xm(f){return g_(oo(f).toLowerCase())}function Nd(f){return f=oo(f),f&&f.replace(bi,fc).replace(Kh,"")}function Zm(f,m,S){f=oo(f),m=Jl(m);var k=f.length;S=S===t?k:sn(vi(S),0,k);var B=S;return S-=m.length,S>=0&&f.slice(S,B)==m}function Ym(f){return f=oo(f),f&&Fu.test(f)?f.replace(iu,_l):f}function ey(f){return f=oo(f),f&&ot.test(f)?f.replace(et,"\\$&"):f}var ty=_c(function(f,m,S){return f+(S?"-":"")+m.toLowerCase()}),G0=_c(function(f,m,S){return f+(S?" ":"")+m.toLowerCase()}),p_=qv("toLowerCase");function d_(f,m,S){f=oo(f),m=vi(m);var k=m?Yl(f):0;if(!m||k>=m)return f;var B=(m-k)/2;return yp(dc(B),S)+f+yp(xl(B),S)}function qm(f,m,S){f=oo(f),m=vi(m);var k=m?Yl(f):0;return m&&k<m?f+yp(m-k,S):f}function jh(f,m,S){f=oo(f),m=vi(m);var k=m?Yl(f):0;return m&&k<m?yp(m-k,S)+f:f}function j0(f,m,S){return S||m==null?m=0:m&&(m=+m),Ds(oo(f).replace(ge,""),m||0)}function ry(f,m,S){return(S?Mr(f,m,S):m===t)?m=1:m=vi(m),Vp(oo(f),m)}function l0(){var f=arguments,m=oo(f[0]);return f.length<3?m:m.replace(f[1],f[2])}var ny=_c(function(f,m,S){return f+(S?"_":"")+m.toLowerCase()});function _v(f,m,S){return S&&typeof S!="number"&&Mr(f,m,S)&&(m=S=t),S=S===t?Er:S>>>0,S?(f=oo(f),f&&(typeof m=="string"||m!=null&&!qp(m))&&(m=Jl(m),!m&&zu(f))?ec(su(f),0,S):f.split(m,S)):[]}var v_=_c(function(f,m,S){return f+(S?" ":"")+g_(m)});function A2(f,m,S){return f=oo(f),S=S==null?0:sn(vi(S),0,f.length),m=Jl(m),f.slice(S,S+m.length)==m}function T2(f,m,S){var k=ye.templateSettings;S&&Mr(f,m,S)&&(m=t),f=oo(f),m=hv({},m,k,Ed);var B=hv({},m.imports,k.imports,Ed),G=ru(B),Z=rp(B,G),ee,_e,Ge=0,Xe=m.interpolate||ci,it="__p += '",bt=qi((m.escape||ci).source+"|"+Xe.source+"|"+(Xe===ae?xn:ci).source+"|"+(m.evaluate||ci).source+"|$","g"),kt="//# sourceURL="+(fa.call(m,"sourceURL")?(m.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++mf+"]")+`
`;f.replace(bt,function(ir,Ur,qn,Ri,Ai,Oi){return qn||(qn=Ri),it+=f.slice(Ge,Oi).replace(Ci,hc),Ur&&(ee=!0,it+=`' +
__e(`+Ur+`) +
'`),Ai&&(_e=!0,it+=`';
`+Ai+`;
__p += '`),qn&&(it+=`' +
((__t = (`+qn+`)) == null ? '' : __t) +
'`),Ge=Oi+ir.length,ir}),it+=`';
`;var Xt=fa.call(m,"variable")&&m.variable;if(!Xt)it=`with (obj) {
`+it+`
}
`;else if(pr.test(Xt))throw new Ei(l);it=(_e?it.replace(yl,""):it).replace(Xi,"$1").replace(nu,"$1;"),it="function("+(Xt||"obj")+`) {
`+(Xt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ee?", __e = _.escape":"")+(_e?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+it+`return __p
}`;var Ht=__(function(){return ua(G,kt+"return "+it).apply(t,Z)});if(Ht.source=it,bp(Ht))throw Ht;return Ht}function iy(f){return oo(f).toLowerCase()}function M2(f){return oo(f).toUpperCase()}function I2(f,m,S){if(f=oo(f),f&&(S||m===t))return Bc(f);if(!f||!(m=Jl(m)))return f;var k=su(f),B=su(m),G=xf(k,B),Z=cc(k,B)+1;return ec(k,G,Z).join("")}function ay(f,m,S){if(f=oo(f),f&&(S||m===t))return f.slice(0,Ih(f)+1);if(!f||!(m=Jl(m)))return f;var k=su(f),B=cc(k,su(m))+1;return ec(k,0,B).join("")}function H0(f,m,S){if(f=oo(f),f&&(S||m===t))return f.replace(ge,"");if(!f||!(m=Jl(m)))return f;var k=su(f),B=xf(k,su(m));return ec(k,B).join("")}function nx(f,m){var S=ke,k=Ce;if(Io(m)){var B="separator"in m?m.separator:B;S="length"in m?vi(m.length):S,k="omission"in m?Jl(m.omission):k}f=oo(f);var G=f.length;if(zu(f)){var Z=su(f);G=Z.length}if(S>=G)return f;var ee=S-Yl(k);if(ee<1)return k;var _e=Z?ec(Z,0,ee).join(""):f.slice(0,ee);if(B===t)return _e+k;if(Z&&(ee+=_e.length-ee),qp(B)){if(f.slice(ee).search(B)){var Ge,Xe=_e;for(B.global||(B=qi(B.source,oo(Bt.exec(B))+"g")),B.lastIndex=0;Ge=B.exec(Xe);)var it=Ge.index;_e=_e.slice(0,it===t?ee:it)}}else if(f.indexOf(Jl(B),ee)!=ee){var bt=_e.lastIndexOf(B);bt>-1&&(_e=_e.slice(0,bt))}return _e+k}function m_(f){return f=oo(f),f&&pf.test(f)?f.replace(mu,bf):f}var L2=_c(function(f,m,S){return f+(S?" ":"")+m.toUpperCase()}),g_=qv("toUpperCase");function y_(f,m,S){return f=oo(f),m=S?t:m,m===t?qs(f)?Np(f):Wa(f):f.match(m)||[]}var __=Ni(function(f,m){try{return Fo(f,t,m)}catch(S){return bp(S)?S:new Ei(S)}}),x_=Of(function(f,m){return Do(m,function(S){S=fi(S),Sr(f,S,ii(f[S],f))}),f});function ix(f){var m=f==null?0:f.length,S=di();return f=m?ro(f,function(k){if(typeof k[1]!="function")throw new uu(o);return[S(k[0]),k[1]]}):[],Ni(function(k){for(var B=-1;++B<m;){var G=f[B];if(Fo(G[0],this,k))return Fo(G[1],this,k)}})}function Km(f){return Dn(Cn(f,b))}function xv(f){return function(){return f}}function W0(f,m){return f==null||f!==f?m:f}var b_=rc(),ax=rc(!0);function zf(f){return f}function Qm(f){return La(typeof f=="function"?f:Cn(f,b))}function bv(f){return ol(Cn(f,b))}function ox(f,m){return ah(f,Cn(m,b))}var k2=Ni(function(f,m){return function(S){return il(S,f,m)}}),R2=Ni(function(f,m){return function(S){return il(f,S,m)}});function oy(f,m,S){var k=ru(m),B=Ka(m,k);S==null&&!(Io(m)&&(B.length||!k.length))&&(S=m,m=f,f=this,B=Ka(m,ru(m)));var G=!(Io(S)&&"chain"in S)||!!S.chain,Z=Ec(f);return Do(B,function(ee){var _e=m[ee];f[ee]=_e,Z&&(f.prototype[ee]=function(){var Ge=this.__chain__;if(G||Ge){var Xe=f(this.__wrapped__),it=Xe.__actions__=eu(this.__actions__);return it.push({func:_e,args:arguments,thisArg:f}),Xe.__chain__=Ge,Xe}return _e.apply(f,ou([this.value()],arguments))})}),f}function O2(){return Yi._===this&&(Yi._=ba),this}function sy(){}function P2(f){return f=vi(f),Ni(function(m){return qc(m,f)})}var F2=Lu(ro),E_=Lu(Du),Zu=Lu(Sh);function uy(f){return gr(f)?Ys(fi(f)):Up(f)}function Jm(f){return function(m){return f==null?t:Na(f,m)}}var Jp=xd(),ly=xd(!0);function c0(){return[]}function $0(){return!1}function C_(){return{}}function cy(){return""}function Yu(){return!0}function Ev(f,m){if(f=vi(f),f<1||f>$t)return[];var S=Er,k=_o(f,Er);m=di(m),f-=Er;for(var B=Dc(k,m);++S<f;)m(S);return B}function X0(f){return xi(f)?ro(f,fi):Xu(f)?[f]:eu(li(oo(f)))}function S_(f){var m=++ql;return oo(f)+m}var Cv=Rf(function(f,m){return f+m},0),Z0=Qc("ceil"),w_=Rf(function(f,m){return f/m},1),D2=Qc("floor");function B2(f){return f&&f.length?jn(f,zf,Ss):t}function N2(f,m){return f&&f.length?jn(f,di(m,2),Ss):t}function z2(f){return Fc(f,zf)}function U2(f,m){return Fc(f,di(m,2))}function sx(f){return f&&f.length?jn(f,zf,Iu):t}function ux(f,m){return f&&f.length?jn(f,di(m,2),Iu):t}var lx=Rf(function(f,m){return f*m},1),cx=Qc("round"),C=Rf(function(f,m){return f-m},0);function L(f){return f&&f.length?ka(f,zf):0}function P(f,m){return f&&f.length?ka(f,di(m,2)):0}return ye.after=$n,ye.ary=yn,ye.assign=pu,ye.assignIn=D0,ye.assignInWith=hv,ye.assignWith=n0,ye.at=Bf,ye.before=_i,ye.bind=ii,ye.bindAll=x_,ye.bindKey=Pn,ye.castArray=Qa,ye.chain=Ad,ye.chunk=Us,ye.compact=ao,ye.concat=ms,ye.cond=ix,ye.conforms=Km,ye.constant=xv,ye.countBy=s,ye.create=B0,ye.curry=Gi,ye.curryRight=wi,ye.debounce=aa,ye.defaults=i0,ye.defaultsDeep=N0,ye.defer=Yn,ye.delay=Ea,ye.difference=as,ye.differenceBy=Vs,ye.differenceWith=Gs,ye.drop=Ms,ye.dropRight=wo,ye.dropRightWhile=Si,ye.dropWhile=gs,ye.fill=ga,ye.filter=h,ye.flatMap=A,ye.flatMapDeep=I,ye.flatMapDepth=D,ye.flatten=Ui,ye.flattenDeep=$a,ye.flattenDepth=ys,ye.flip=Ao,ye.flow=b_,ye.flowRight=ax,ye.fromPairs=Pl,ye.functions=Kg,ye.functionsIn=zm,ye.groupBy=q,ye.initial=yt,ye.intersection=gn,ye.intersectionBy=Vi,ye.intersectionWith=Te,ye.invert=U0,ye.invertBy=Nf,ye.invokeMap=oe,ye.iteratee=Qm,ye.keyBy=fe,ye.keys=ru,ye.keysIn=Ws,ye.map=Pe,ye.mapKeys=vv,ye.mapValues=Cp,ye.matches=bv,ye.matchesProperty=ox,ye.memoize=Eo,ye.merge=Dd,ye.mergeWith=tf,ye.method=k2,ye.methodOf=R2,ye.mixin=oy,ye.negate=fo,ye.nthArg=P2,ye.omit=mv,ye.omitBy=Qg,ye.once=To,ye.orderBy=De,ye.over=F2,ye.overArgs=qo,ye.overEvery=E_,ye.overSome=Zu,ye.partial=Ko,ye.partialRight=Mo,ye.partition=tt,ye.pick=Jg,ye.pickBy=Vm,ye.property=uy,ye.propertyOf=Jm,ye.pull=rt,ye.pullAll=Ye,ye.pullAllBy=nt,ye.pullAllWith=de,ye.pullAt=$e,ye.range=Jp,ye.rangeRight=ly,ye.rearg=$u,ye.reject=xt,ye.remove=Le,ye.rest=zo,ye.reverse=ut,ye.sampleSize=Pt,ye.set=jm,ye.setWith=Sp,ye.shuffle=nr,ye.slice=_t,ye.sortBy=Vn,ye.sortedUniq=hn,ye.sortedUniqBy=Sn,ye.split=_v,ye.spread=ku,ye.tail=An,ye.take=Tn,ye.takeRight=ei,ye.takeRightWhile=wa,ye.takeWhile=ya,ye.tap=ov,ye.throttle=Uo,ye.thru=Td,ye.toArray=F0,ye.toPairs=Hm,ye.toPairsIn=gv,ye.toPath=X0,ye.toPlainObject=rs,ye.transform=Wm,ye.unary=tu,ye.union=hl,ye.unionBy=bc,ye.unionWith=za,ye.uniq=ea,ye.uniqBy=Jc,ye.uniqWith=nc,ye.unset=Bd,ye.unzip=Sd,ye.unzipWith=ic,ye.update=$m,ye.updateWith=_s,ye.values=Gh,ye.valuesIn=V0,ye.without=e0,ye.words=y_,ye.wrap=ra,ye.xor=Om,ye.xorBy=wd,ye.xorWith=zh,ye.zip=O0,ye.zipObject=Is,ye.zipObjectDeep=t0,ye.zipWith=xp,ye.entries=Hm,ye.entriesIn=gv,ye.extend=D0,ye.extendWith=hv,oy(ye,ye),ye.add=Cv,ye.attempt=__,ye.camelCase=u0,ye.capitalize=Xm,ye.ceil=Z0,ye.clamp=s0,ye.clone=Ua,ye.cloneDeep=pl,ye.cloneDeepWith=Hs,ye.cloneWith=ha,ye.conformsTo=ho,ye.deburr=Nd,ye.defaultTo=W0,ye.divide=w_,ye.endsWith=Zm,ye.eq=Fa,ye.escape=Ym,ye.escapeRegExp=ey,ye.every=u,ye.find=_,ye.findIndex=No,ye.findKey=z0,ye.findLast=E,ye.findLastIndex=Jn,ye.findLastKey=a0,ye.floor=D2,ye.forEach=V,ye.forEachRight=$,ye.forIn=Nm,ye.forInRight=o0,ye.forOwn=dh,ye.forOwnRight=qg,ye.get=pv,ye.gt=Ls,ye.gte=_a,ye.has=Sc,ye.hasIn=dv,ye.head=Oe,ye.identity=zf,ye.includes=te,ye.indexOf=Mt,ye.inRange=Qp,ye.invoke=Um,ye.isArguments=Ru,ye.isArray=xi,ye.isArrayBuffer=ch,ye.isArrayLike=Aa,ye.isArrayLikeObject=Xa,ye.isBoolean=ef,ye.isBuffer=Fl,ye.isDate=Yp,ye.isElement=Md,ye.isEmpty=fh,ye.isEqual=Id,ye.isEqualWith=sv,ye.isError=bp,ye.isFinite=Ld,ye.isFunction=Ec,ye.isInteger=kd,ye.isLength=Cc,ye.isMap=Uh,ye.isMatch=uv,ye.isMatchWith=Rd,ye.isNaN=r0,ye.isNative=lv,ye.isNil=Od,ye.isNull=cv,ye.isNumber=Ep,ye.isObject=Io,ye.isObjectLike=po,ye.isPlainObject=Vh,ye.isRegExp=qp,ye.isSafeInteger=P0,ye.isSet=Pd,ye.isString=Fd,ye.isSymbol=Xu,ye.isTypedArray=hh,ye.isUndefined=Ff,ye.isWeakMap=Kp,ye.isWeakSet=fv,ye.join=pe,ye.kebabCase=ty,ye.last=He,ye.lastIndexOf=ct,ye.lowerCase=G0,ye.lowerFirst=p_,ye.lt=Dm,ye.lte=Yg,ye.max=B2,ye.maxBy=N2,ye.mean=z2,ye.meanBy=U2,ye.min=sx,ye.minBy=ux,ye.stubArray=c0,ye.stubFalse=$0,ye.stubObject=C_,ye.stubString=cy,ye.stubTrue=Yu,ye.multiply=lx,ye.nth=Tt,ye.noConflict=O2,ye.noop=sy,ye.now=vn,ye.pad=d_,ye.padEnd=qm,ye.padStart=jh,ye.parseInt=j0,ye.random=yv,ye.reduce=We,ye.reduceRight=lt,ye.repeat=ry,ye.replace=l0,ye.result=Gm,ye.round=cx,ye.runInContext=pt,ye.sample=Lt,ye.size=Fr,ye.snakeCase=ny,ye.some=tn,ye.sortedIndex=lr,ye.sortedIndexBy=Hr,ye.sortedIndexOf=$r,ye.sortedLastIndex=fn,ye.sortedLastIndexBy=Gr,ye.sortedLastIndexOf=Ln,ye.startCase=v_,ye.startsWith=A2,ye.subtract=C,ye.sum=L,ye.sumBy=P,ye.template=T2,ye.times=Ev,ye.toFinite=Df,ye.toInteger=vi,ye.toLength=Bm,ye.toLower=iy,ye.toNumber=Dl,ye.toSafeInteger=ph,ye.toString=oo,ye.toUpper=M2,ye.trim=I2,ye.trimEnd=ay,ye.trimStart=H0,ye.truncate=nx,ye.unescape=m_,ye.uniqueId=S_,ye.upperCase=L2,ye.upperFirst=g_,ye.each=V,ye.eachRight=$,ye.first=Oe,oy(ye,function(){var f={};return io(ye,function(m,S){fa.call(ye.prototype,S)||(f[S]=m)}),f}(),{chain:!1}),ye.VERSION=n,Do(["bind","bindKey","curry","curryRight","partial","partialRight"],function(f){ye[f].placeholder=ye}),Do(["drop","take"],function(f,m){Ii.prototype[f]=function(S){S=S===t?1:ti(vi(S),0);var k=this.__filtered__&&!m?new Ii(this):this.clone();return k.__filtered__?k.__takeCount__=_o(S,k.__takeCount__):k.__views__.push({size:_o(S,Er),type:f+(k.__dir__<0?"Right":"")}),k},Ii.prototype[f+"Right"]=function(S){return this.reverse()[f](S).reverse()}}),Do(["filter","map","takeWhile"],function(f,m){var S=m+1,k=S==Ie||S==St;Ii.prototype[f]=function(B){var G=this.clone();return G.__iteratees__.push({iteratee:di(B,3),type:S}),G.__filtered__=G.__filtered__||k,G}}),Do(["head","last"],function(f,m){var S="take"+(m?"Right":"");Ii.prototype[f]=function(){return this[S](1).value()[0]}}),Do(["initial","tail"],function(f,m){var S="drop"+(m?"":"Right");Ii.prototype[f]=function(){return this.__filtered__?new Ii(this):this[S](1)}}),Ii.prototype.compact=function(){return this.filter(zf)},Ii.prototype.find=function(f){return this.filter(f).head()},Ii.prototype.findLast=function(f){return this.reverse().find(f)},Ii.prototype.invokeMap=Ni(function(f,m){return typeof f=="function"?new Ii(this):this.map(function(S){return il(S,f,m)})}),Ii.prototype.reject=function(f){return this.filter(fo(di(f)))},Ii.prototype.slice=function(f,m){f=vi(f);var S=this;return S.__filtered__&&(f>0||m<0)?new Ii(S):(f<0?S=S.takeRight(-f):f&&(S=S.drop(f)),m!==t&&(m=vi(m),S=m<0?S.dropRight(-m):S.take(m-f)),S)},Ii.prototype.takeRightWhile=function(f){return this.reverse().takeWhile(f).reverse()},Ii.prototype.toArray=function(){return this.take(Er)},io(Ii.prototype,function(f,m){var S=/^(?:filter|find|map|reject)|While$/.test(m),k=/^(?:head|last)$/.test(m),B=ye[k?"take"+(m=="last"?"Right":""):m],G=k||/^find/.test(m);!B||(ye.prototype[m]=function(){var Z=this.__wrapped__,ee=k?[1]:arguments,_e=Z instanceof Ii,Ge=ee[0],Xe=_e||xi(Z),it=function(Ur){var qn=B.apply(ye,ou([Ur],ee));return k&&bt?qn[0]:qn};Xe&&S&&typeof Ge=="function"&&Ge.length!=1&&(_e=Xe=!1);var bt=this.__chain__,kt=!!this.__actions__.length,Xt=G&&!bt,Ht=_e&&!kt;if(!G&&Xe){Z=Ht?Z:new Ii(this);var ir=f.apply(Z,ee);return ir.__actions__.push({func:Td,args:[it],thisArg:t}),new Es(ir,bt)}return Xt&&Ht?f.apply(this,ee):(ir=this.thru(it),Xt?k?ir.value()[0]:ir.value():ir)})}),Do(["pop","push","shift","sort","splice","unshift"],function(f){var m=jc[f],S=/^(?:push|sort|unshift)$/.test(f)?"tap":"thru",k=/^(?:pop|shift)$/.test(f);ye.prototype[f]=function(){var B=arguments;if(k&&!this.__chain__){var G=this.value();return m.apply(xi(G)?G:[],B)}return this[S](function(Z){return m.apply(xi(Z)?Z:[],B)})}}),io(Ii.prototype,function(f,m){var S=ye[m];if(S){var k=S.name+"";fa.call(Bs,k)||(Bs[k]=[]),Bs[k].push({name:m,func:S})}}),Bs[cl(t,j).name]=[{name:"wrapper",func:t}],Ii.prototype.clone=Jf,Ii.prototype.reverse=wu,Ii.prototype.value=Rh,ye.prototype.at=Xp,ye.prototype.chain=Pf,ye.prototype.commit=lh,ye.prototype.next=Zg,ye.prototype.plant=js,ye.prototype.reverse=Zp,ye.prototype.toJSON=ye.prototype.valueOf=ye.prototype.value=Fm,ye.prototype.first=ye.prototype.head,Hc&&(ye.prototype[Hc]=Pm),ye},Gc=Ef();gf?((gf.exports=Gc)._=Gc,Qu._=Gc):Yi._=Gc}).call(Lp)})(Vr,Vr.exports);var FO={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Lp,function(){function t(ke,Ce,je,ve,Ie,dt){if(!(Ie-ve<=je)){var St=ve+Ie>>1;n(ke,Ce,St,ve,Ie,dt%2),t(ke,Ce,je,ve,St-1,dt+1),t(ke,Ce,je,St+1,Ie,dt+1)}}function n(ke,Ce,je,ve,Ie,dt){for(;Ie>ve;){if(Ie-ve>600){var St=Ie-ve+1,Rt=je-ve+1,$t=Math.log(St),gt=.5*Math.exp(2*$t/3),jr=.5*Math.sqrt($t*gt*(St-gt)/St)*(Rt-St/2<0?-1:1),Er=Math.max(ve,Math.floor(je-Rt*gt/St+jr)),rn=Math.min(Ie,Math.floor(je+(St-Rt)*gt/St+jr));n(ke,Ce,je,Er,rn,dt)}var dn=Ce[2*je+dt],Rn=ve,Ar=Ie;for(i(ke,Ce,ve,je),Ce[2*Ie+dt]>dn&&i(ke,Ce,ve,Ie);Rn<Ar;){for(i(ke,Ce,Rn,Ar),Rn++,Ar--;Ce[2*Rn+dt]<dn;)Rn++;for(;Ce[2*Ar+dt]>dn;)Ar--}Ce[2*ve+dt]===dn?i(ke,Ce,ve,Ar):(Ar++,i(ke,Ce,Ar,Ie)),Ar<=je&&(ve=Ar+1),je<=Ar&&(Ie=Ar-1)}}function i(ke,Ce,je,ve){a(ke,je,ve),a(Ce,2*je,2*ve),a(Ce,2*je+1,2*ve+1)}function a(ke,Ce,je){var ve=ke[Ce];ke[Ce]=ke[je],ke[je]=ve}function o(ke,Ce,je,ve,Ie,dt,St){for(var Rt=[0,ke.length-1,0],$t=[],gt,jr;Rt.length;){var Er=Rt.pop(),rn=Rt.pop(),dn=Rt.pop();if(rn-dn<=St){for(var Rn=dn;Rn<=rn;Rn++)gt=Ce[2*Rn],jr=Ce[2*Rn+1],gt>=je&&gt<=Ie&&jr>=ve&&jr<=dt&&$t.push(ke[Rn]);continue}var Ar=Math.floor((dn+rn)/2);gt=Ce[2*Ar],jr=Ce[2*Ar+1],gt>=je&&gt<=Ie&&jr>=ve&&jr<=dt&&$t.push(ke[Ar]);var xa=(Er+1)%2;(Er===0?je<=gt:ve<=jr)&&(Rt.push(dn),Rt.push(Ar-1),Rt.push(xa)),(Er===0?Ie>=gt:dt>=jr)&&(Rt.push(Ar+1),Rt.push(rn),Rt.push(xa))}return $t}function l(ke,Ce,je,ve,Ie,dt){for(var St=[0,ke.length-1,0],Rt=[],$t=Ie*Ie;St.length;){var gt=St.pop(),jr=St.pop(),Er=St.pop();if(jr-Er<=dt){for(var rn=Er;rn<=jr;rn++)c(Ce[2*rn],Ce[2*rn+1],je,ve)<=$t&&Rt.push(ke[rn]);continue}var dn=Math.floor((Er+jr)/2),Rn=Ce[2*dn],Ar=Ce[2*dn+1];c(Rn,Ar,je,ve)<=$t&&Rt.push(ke[dn]);var xa=(gt+1)%2;(gt===0?je-Ie<=Rn:ve-Ie<=Ar)&&(St.push(Er),St.push(dn-1),St.push(xa)),(gt===0?je+Ie>=Rn:ve+Ie>=Ar)&&(St.push(dn+1),St.push(jr),St.push(xa))}return Rt}function c(ke,Ce,je,ve){var Ie=ke-je,dt=Ce-ve;return Ie*Ie+dt*dt}var p=function(ke){return ke[0]},y=function(ke){return ke[1]},b=function(Ce,je,ve,Ie,dt){je===void 0&&(je=p),ve===void 0&&(ve=y),Ie===void 0&&(Ie=64),dt===void 0&&(dt=Float64Array),this.nodeSize=Ie,this.points=Ce;for(var St=Ce.length<65536?Uint16Array:Uint32Array,Rt=this.ids=new St(Ce.length),$t=this.coords=new dt(Ce.length*2),gt=0;gt<Ce.length;gt++)Rt[gt]=gt,$t[2*gt]=je(Ce[gt]),$t[2*gt+1]=ve(Ce[gt]);t(Rt,$t,Ie,0,Rt.length-1,0)};b.prototype.range=function(Ce,je,ve,Ie){return o(this.ids,this.coords,Ce,je,ve,Ie,this.nodeSize)},b.prototype.within=function(Ce,je,ve){return l(this.ids,this.coords,Ce,je,ve,this.nodeSize)};var w={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ke){return ke}},M=Math.fround||function(ke){return function(Ce){return ke[0]=+Ce,ke[0]}}(new Float32Array(1)),O=function(Ce){this.options=ze(Object.create(w),Ce),this.trees=new Array(this.options.maxZoom+1)};O.prototype.load=function(Ce){var je=this.options,ve=je.log,Ie=je.minZoom,dt=je.maxZoom,St=je.nodeSize;ve&&console.time("total time");var Rt="prepare "+Ce.length+" points";ve&&console.time(Rt),this.points=Ce;for(var $t=[],gt=0;gt<Ce.length;gt++)!Ce[gt].geometry||$t.push(z(Ce[gt],gt));this.trees[dt+1]=new b($t,ue,Ke,St,Float32Array),ve&&console.timeEnd(Rt);for(var jr=dt;jr>=Ie;jr--){var Er=+Date.now();$t=this._cluster($t,jr),this.trees[jr]=new b($t,ue,Ke,St,Float32Array),ve&&console.log("z%d: %d clusters in %dms",jr,$t.length,+Date.now()-Er)}return ve&&console.timeEnd("total time"),this},O.prototype.getClusters=function(Ce,je){var ve=((Ce[0]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,Ce[1])),dt=Ce[2]===180?180:((Ce[2]+180)%360+360)%360-180,St=Math.max(-90,Math.min(90,Ce[3]));if(Ce[2]-Ce[0]>=360)ve=-180,dt=180;else if(ve>dt){var Rt=this.getClusters([ve,Ie,180,St],je),$t=this.getClusters([-180,Ie,dt,St],je);return Rt.concat($t)}for(var gt=this.trees[this._limitZoom(je)],jr=gt.range(K(ve),ie(St),K(dt),ie(Ie)),Er=[],rn=0,dn=jr;rn<dn.length;rn+=1){var Rn=dn[rn],Ar=gt.points[Rn];Er.push(Ar.numPoints?j(Ar):this.points[Ar.index])}return Er},O.prototype.getChildren=function(Ce){var je=this._getOriginId(Ce),ve=this._getOriginZoom(Ce),Ie="No cluster with the specified id.",dt=this.trees[ve];if(!dt)throw new Error(Ie);var St=dt.points[je];if(!St)throw new Error(Ie);for(var Rt=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),$t=dt.within(St.x,St.y,Rt),gt=[],jr=0,Er=$t;jr<Er.length;jr+=1){var rn=Er[jr],dn=dt.points[rn];dn.parentId===Ce&&gt.push(dn.numPoints?j(dn):this.points[dn.index])}if(gt.length===0)throw new Error(Ie);return gt},O.prototype.getLeaves=function(Ce,je,ve){je=je||10,ve=ve||0;var Ie=[];return this._appendLeaves(Ie,Ce,je,ve,0),Ie},O.prototype.getTile=function(Ce,je,ve){var Ie=this.trees[this._limitZoom(Ce)],dt=Math.pow(2,Ce),St=this.options,Rt=St.extent,$t=St.radius,gt=$t/Rt,jr=(ve-gt)/dt,Er=(ve+1+gt)/dt,rn={features:[]};return this._addTileFeatures(Ie.range((je-gt)/dt,jr,(je+1+gt)/dt,Er),Ie.points,je,ve,dt,rn),je===0&&this._addTileFeatures(Ie.range(1-gt/dt,jr,1,Er),Ie.points,dt,ve,dt,rn),je===dt-1&&this._addTileFeatures(Ie.range(0,jr,gt/dt,Er),Ie.points,-1,ve,dt,rn),rn.features.length?rn:null},O.prototype.getClusterExpansionZoom=function(Ce){for(var je=this._getOriginZoom(Ce)-1;je<=this.options.maxZoom;){var ve=this.getChildren(Ce);if(je++,ve.length!==1)break;Ce=ve[0].properties.cluster_id}return je},O.prototype._appendLeaves=function(Ce,je,ve,Ie,dt){for(var St=this.getChildren(je),Rt=0,$t=St;Rt<$t.length;Rt+=1){var gt=$t[Rt],jr=gt.properties;if(jr&&jr.cluster?dt+jr.point_count<=Ie?dt+=jr.point_count:dt=this._appendLeaves(Ce,jr.cluster_id,ve,Ie,dt):dt<Ie?dt++:Ce.push(gt),Ce.length===ve)break}return dt},O.prototype._addTileFeatures=function(Ce,je,ve,Ie,dt,St){for(var Rt=0,$t=Ce;Rt<$t.length;Rt+=1){var gt=$t[Rt],jr=je[gt],Er=jr.numPoints,rn=void 0,dn=void 0,Rn=void 0;if(Er)rn=Y(jr),dn=jr.x,Rn=jr.y;else{var Ar=this.points[jr.index];rn=Ar.properties,dn=K(Ar.geometry.coordinates[0]),Rn=ie(Ar.geometry.coordinates[1])}var xa={type:1,geometry:[[Math.round(this.options.extent*(dn*dt-ve)),Math.round(this.options.extent*(Rn*dt-Ie))]],tags:rn},Ti=void 0;Er?Ti=jr.id:this.options.generateId?Ti=jr.index:this.points[jr.index].id&&(Ti=this.points[jr.index].id),Ti!==void 0&&(xa.id=Ti),St.features.push(xa)}},O.prototype._limitZoom=function(Ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ce),this.options.maxZoom+1))},O.prototype._cluster=function(Ce,je){for(var ve=[],Ie=this.options,dt=Ie.radius,St=Ie.extent,Rt=Ie.reduce,$t=Ie.minPoints,gt=dt/(St*Math.pow(2,je)),jr=0;jr<Ce.length;jr++){var Er=Ce[jr];if(!(Er.zoom<=je)){Er.zoom=je;for(var rn=this.trees[je+1],dn=rn.within(Er.x,Er.y,gt),Rn=Er.numPoints||1,Ar=Rn,xa=0,Ti=dn;xa<Ti.length;xa+=1){var Sa=Ti[xa],hr=rn.points[Sa];hr.zoom>je&&(Ar+=hr.numPoints||1)}if(Ar>Rn&&Ar>=$t){for(var Dr=Er.x*Rn,Kn=Er.y*Rn,Wt=Rt&&Rn>1?this._map(Er,!0):null,Me=(jr<<5)+(je+1)+this.points.length,Qe=0,Ct=dn;Qe<Ct.length;Qe+=1){var Yt=Ct[Qe],qt=rn.points[Yt];if(!(qt.zoom<=je)){qt.zoom=je;var _r=qt.numPoints||1;Dr+=qt.x*_r,Kn+=qt.y*_r,qt.parentId=Me,Rt&&(Wt||(Wt=this._map(Er,!0)),Rt(Wt,this._map(qt)))}}Er.parentId=Me,ve.push(N(Dr/Ar,Kn/Ar,Me,Ar,Wt))}else if(ve.push(Er),Ar>1)for(var Pr=0,xr=dn;Pr<xr.length;Pr+=1){var kr=xr[Pr],vr=rn.points[kr];vr.zoom<=je||(vr.zoom=je,ve.push(vr))}}}return ve},O.prototype._getOriginId=function(Ce){return Ce-this.points.length>>5},O.prototype._getOriginZoom=function(Ce){return(Ce-this.points.length)%32},O.prototype._map=function(Ce,je){if(Ce.numPoints)return je?ze({},Ce.properties):Ce.properties;var ve=this.points[Ce.index].properties,Ie=this.options.map(ve);return je&&Ie===ve?ze({},Ie):Ie};function N(ke,Ce,je,ve,Ie){return{x:M(ke),y:M(Ce),zoom:1/0,id:je,parentId:-1,numPoints:ve,properties:Ie}}function z(ke,Ce){var je=ke.geometry.coordinates,ve=je[0],Ie=je[1];return{x:M(K(ve)),y:M(ie(Ie)),zoom:1/0,index:Ce,parentId:-1}}function j(ke){return{type:"Feature",id:ke.id,properties:Y(ke),geometry:{type:"Point",coordinates:[le(ke.x),Se(ke.y)]}}}function Y(ke){var Ce=ke.numPoints,je=Ce>=1e4?Math.round(Ce/1e3)+"k":Ce>=1e3?Math.round(Ce/100)/10+"k":Ce;return ze(ze({},ke.properties),{cluster:!0,cluster_id:ke.id,point_count:Ce,point_count_abbreviated:je})}function K(ke){return ke/360+.5}function ie(ke){var Ce=Math.sin(ke*Math.PI/180),je=.5-.25*Math.log((1+Ce)/(1-Ce))/Math.PI;return je<0?0:je>1?1:je}function le(ke){return(ke-.5)*360}function Se(ke){var Ce=(180-ke*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ce))/Math.PI-90}function ze(ke,Ce){for(var je in Ce)ke[je]=Ce[je];return ke}function ue(ke){return ke.x}function Ke(ke){return ke.y}return O})})(FO);const cV=FO.exports;function DO(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,o=r.minZoom,l=o===void 0?0:o,c=r.zoom,p=c===void 0?2:c;if(e.pointIndex){var y=e.pointIndex.getClusters(e.extent,Math.floor(p));return e.dataArray=fV(y),e}var b=new cV({radius:n,minZoom:l,maxZoom:a}),w={type:"FeatureCollection",features:[]};return w.features=e.dataArray.map(function(M){return{type:"Feature",geometry:{type:"Point",coordinates:M.coordinates},properties:tr({},M)}}),b.load(w.features),b}function fV(e){return e.map(function(r,t){return tr({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function hV(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function pV(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function BO(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function dV(e){if(e.length===0)throw new Error("mean requires at least one data point");return BO(e)/e.length}var vV={min:pV,max:hV,mean:dV,sum:BO};function mV(e,r){return e.map(function(t){return t[r]*1})}function gV(e){var r=yV();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function yV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _V(e,r){if(Array.isArray(r))return r}var Mm=function(e){On(t,e);var r=gV(t);function t(n,i){var a;return Kt(this,t),a=r.call(this),ne(vt(a),"inited",!1),ne(vt(a),"hooks",{init:new Lv}),ne(vt(a),"parser",{type:"geojson"}),ne(vt(a),"transforms",[]),ne(vt(a),"cluster",!1),ne(vt(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),ne(vt(a),"invalidExtent",!1),ne(vt(a),"dataArrayChanged",!1),ne(vt(a),"cfg",{}),a.originData=n,a.initCfg(i),a.init(),a}return Qt(t,[{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,o=this.clusterOptions,l=o.method,c=l===void 0?"sum":l,p=o.field,y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,y.forEach(function(b){b.id||(b.properties.point_count=1)}),(p||Vr.exports.isFunction(c))&&(y=y.map(function(b){var w=b.id;if(w){var M=a.clusterIndex.getLeaves(w,1/0),O=M.map(function(j){return j.properties}),N;if(Vr.exports.isString(c)&&p){var z=mV(O,p);N=vV[c](z)}Vr.exports.isFunction(c)&&(N=c(O)),b.properties.stat=N}else b.properties.point_count=1;return b})),this.data=rT("geojson")({type:"FeatureCollection",features:y}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser.type,o=a===void 0?"geojson":a;if(o==="geojson"&&!this.cluster){var l=i<this.originData.features.length?this.originData.features[i]:"null",c=Vr.exports.cloneDeep(l);if(c!=null&&c.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var p=this.data.dataArray.find(function(y){return y._id===i});c.properties=p}return c}else return i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===i?tr(tr({},o),a):o}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(i,a){var o=this.data.dataArray.find(function(l){return l[i]===a});return o==null?void 0:o._id}},{key:"setData",value:function(i,a){this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init()}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"handleData",value:function(){var i=this;return new Promise(function(a,o){try{i.excuteParser(),i.initCluster(),i.executeTrans(),a({})}catch(l){o(l)}})}},{key:"initCfg",value:function(i){this.cfg=Vr.exports.mergeWith(this.cfg,i,_V);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=tr(tr({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var i=this;this.inited=!1,this.handleData().then(function(){i.inited=!0,i.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",o=rT(a);this.data=o(this.originData,i),this.extent=jB(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Mz(tr({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(o){var l=o.type,c=r8(l)(i.data,o);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=DO(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(a=Kb(fb(this.extent),i)),a[0].concat(a[1])}}]),t}(Zd.exports.EventEmitter);function xV(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function YT(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=bV(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function bV(e,r){if(!!e){if(typeof e=="string")return qT(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qT(e,r)}}function qT(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Tw=6378e3;function EV(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*Tw)*(256<<20)/2,o=CV(t,i),l=o.gridHash,c=o.gridOffset,p=TV(l,c,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:p}}function CV(e,r){var t=1/0,n=-1/0,i,a=YT(e),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(K){a.e(K)}finally{a.f()}var c=(t+n)/2,p=SV(r,c);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};var y={},b=YT(e),w;try{for(b.s();!(w=b.n()).done;){var M=w.value,O=M.coordinates[1],N=M.coordinates[0];if(Number.isFinite(O)&&Number.isFinite(N)){var z=Math.floor((O+90)/p.yOffset),j=Math.floor((N+180)/p.xOffset),Y="".concat(z,"-").concat(j);y[Y]=y[Y]||{count:0,points:[]},y[Y].count+=1,y[Y].points.push(M)}}}catch(K){b.e(K)}finally{b.f()}return{gridHash:y,gridOffset:p}}function SV(e,r){var t=wV(e),n=AV(r,e);return{yOffset:t,xOffset:n}}function wV(e){return e/Tw*(180/Math.PI)}function AV(e,r){return r/Tw*(180/Math.PI)/Math.cos(e*Math.PI/180)}function TV(e,r,t){return Object.keys(e).reduce(function(n,i,a){var o=i.split("-"),l=parseInt(o[0],10),c=parseInt(o[1],10),p={};if(t.field&&t.method){var y=BR(e[i].points,t.field);p[t.method]=DR[t.method](y)}return Object.assign(p,{_id:a,coordinates:Ic([-180+r.xOffset*(c+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(p),n},[])}var Ay=Math.PI/3,MV=[0,Ay,2*Ay,3*Ay,4*Ay,5*Ay];function IV(e){return e[0]}function LV(e){return e[1]}function kV(){var e=0,r=0,t=1,n=1,i=IV,a=LV,o,l,c;function p(b){var w={},M=[],O,N=b.length;for(O=0;O<N;++O)if(!(isNaN(j=+i.call(null,z=b[O],O,b))||isNaN(Y=+a.call(null,z,O,b)))){var z,j,Y,K=Math.round(Y=Y/c),ie=Math.round(j=j/l-(K&1)/2),le=Y-K;if(Math.abs(le)*3>1){var Se=j-ie,ze=ie+(j<ie?-1:1)/2,ue=K+(Y<K?-1:1),Ke=j-ze,ke=Y-ue;Se*Se+le*le>Ke*Ke+ke*ke&&(ie=ze+(K&1?1:-1)/2,K=ue)}var Ce=ie+"-"+K,je=w[Ce];je?je.push(z):(M.push(je=w[Ce]=[z]),je.x=(ie+(K&1)/2)*l,je.y=K*c)}return M}function y(b){var w=0,M=0;return MV.map(function(O){var N=Math.sin(O)*b,z=-Math.cos(O)*b,j=N-w,Y=z-M;return w=N,M=z,[j,Y]})}return p.hexagon=function(b){return"m"+y(b==null?o:+b).join("l")+"z"},p.centers=function(){for(var b=[],w=Math.round(r/c),M=Math.round(e/l),O=w*c;O<n+o;O+=c,++w)for(var N=M*l+(w&1)*l/2;N<t+l/2;N+=l)b.push([N,O]);return b},p.mesh=function(){var b=y(o).slice(0,4).join("l");return p.centers().map(function(w){return"M"+w+"m"+b}).join("")},p.x=function(b){return arguments.length?(i=b,p):i},p.y=function(b){return arguments.length?(a=b,p):a},p.radius=function(b){return arguments.length?(o=+b,l=o*2*Math.sin(Ay),c=o*1.5,p):o},p.size=function(b){return arguments.length?(e=r=0,t=+b[0],n=+b[1],p):[t-e,n-r]},p.extent=function(b){return arguments.length?(e=+b[0][0],r=+b[0][1],t=+b[1][0],n=+b[1][1],p):[[e,r],[t,n]]},p.radius(1)}var RV=6378e3;function OV(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,o=a===void 0?"sum":a,l=i/(2*Math.PI*RV)*(256<<20)/2,c=t.map(function(w){var M=Ic(w.coordinates),O=Pi(M,2),N=O[0],z=O[1];return tr(tr({},w),{},{coordinates:[N,z]})}),p=kV().radius(l).x(function(w){return w.coordinates[0]}).y(function(w){return w.coordinates[1]}),y=p(c),b={dataArray:y.map(function(w,M){var O;if(r.field&&o){var N=BR(w,r.field);w[o]=DR[o](N)}return O={},ne(O,r.method,w[o]),ne(O,"count",w.length),ne(O,"rawData",w),ne(O,"coordinates",[w.x,w.y]),ne(O,"_id",M),O}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function PV(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(o){a[o[t]]=o}),e.dataArray=e.dataArray.map(function(o){var l=o[n];return tr(tr({},o),a[l])}),e}function FV(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}T0("rasterTile",jU);T0("mvt",gU);T0("geojsonvt",BU);T0("testTile",$U);T0("geojson",C8);T0("image",wO);T0("csv",x8);T0("json",xR);T0("raster",NU);s_("cluster",DO);s_("filter",xV);s_("join",PV);s_("map",FV);s_("grid",EV);s_("hexagon",OV);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var KT;(function(e){(function(r){var t=typeof Lp=="object"?Lp:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(e);typeof t.Reflect>"u"?t.Reflect=e:n=i(t.Reflect,n),r(n);function i(a,o){return function(l,c){typeof a[l]!="function"&&Object.defineProperty(a,l,{configurable:!0,writable:!0,value:c}),o&&o(l,c)}}})(function(r){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",l={__proto__:[]}instanceof Array,c=!o&&!l,p={create:o?function(){return In(Object.create(null))}:l?function(){return In({__proto__:null})}:function(){return In({})},has:c?function(W,st){return t.call(W,st)}:function(W,st){return st in W},get:c?function(W,st){return t.call(W,st)?W[st]:void 0}:function(W,st){return W[st]}},y=Object.getPrototypeOf(Function),b=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",w=!b&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:xr(),M=!b&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:kr(),O=!b&&typeof WeakMap=="function"?WeakMap:vr(),N=new O;function z(W,st,zt,mr){if(Er(zt)){if(!Dr(W))throw new TypeError;if(!Wt(st))throw new TypeError;return ke(W,st)}else{if(!Dr(W))throw new TypeError;if(!Rn(st))throw new TypeError;if(!Rn(mr)&&!Er(mr)&&!rn(mr))throw new TypeError;return rn(mr)&&(mr=void 0),zt=hr(zt),Ce(W,st,zt,mr)}}r("decorate",z);function j(W,st){function zt(mr,fr){if(!Rn(mr))throw new TypeError;if(!Er(fr)&&!Me(fr))throw new TypeError;Rt(W,st,mr,fr)}return zt}r("metadata",j);function Y(W,st,zt,mr){if(!Rn(zt))throw new TypeError;return Er(mr)||(mr=hr(mr)),Rt(W,st,zt,mr)}r("defineMetadata",Y);function K(W,st,zt){if(!Rn(st))throw new TypeError;return Er(zt)||(zt=hr(zt)),ve(W,st,zt)}r("hasMetadata",K);function ie(W,st,zt){if(!Rn(st))throw new TypeError;return Er(zt)||(zt=hr(zt)),Ie(W,st,zt)}r("hasOwnMetadata",ie);function le(W,st,zt){if(!Rn(st))throw new TypeError;return Er(zt)||(zt=hr(zt)),dt(W,st,zt)}r("getMetadata",le);function Se(W,st,zt){if(!Rn(st))throw new TypeError;return Er(zt)||(zt=hr(zt)),St(W,st,zt)}r("getOwnMetadata",Se);function ze(W,st){if(!Rn(W))throw new TypeError;return Er(st)||(st=hr(st)),$t(W,st)}r("getMetadataKeys",ze);function ue(W,st){if(!Rn(W))throw new TypeError;return Er(st)||(st=hr(st)),gt(W,st)}r("getOwnMetadataKeys",ue);function Ke(W,st,zt){if(!Rn(st))throw new TypeError;Er(zt)||(zt=hr(zt));var mr=je(st,zt,!1);if(Er(mr)||!mr.delete(W))return!1;if(mr.size>0)return!0;var fr=N.get(st);return fr.delete(zt),fr.size>0||N.delete(st),!0}r("deleteMetadata",Ke);function ke(W,st){for(var zt=W.length-1;zt>=0;--zt){var mr=W[zt],fr=mr(st);if(!Er(fr)&&!rn(fr)){if(!Wt(fr))throw new TypeError;st=fr}}return st}function Ce(W,st,zt,mr){for(var fr=W.length-1;fr>=0;--fr){var nn=W[fr],Mn=nn(st,zt,mr);if(!Er(Mn)&&!rn(Mn)){if(!Rn(Mn))throw new TypeError;mr=Mn}}return mr}function je(W,st,zt){var mr=N.get(W);if(Er(mr)){if(!zt)return;mr=new w,N.set(W,mr)}var fr=mr.get(st);if(Er(fr)){if(!zt)return;fr=new w,mr.set(st,fr)}return fr}function ve(W,st,zt){var mr=Ie(W,st,zt);if(mr)return!0;var fr=Pr(st);return rn(fr)?!1:ve(W,fr,zt)}function Ie(W,st,zt){var mr=je(st,zt,!1);return Er(mr)?!1:Ti(mr.has(W))}function dt(W,st,zt){var mr=Ie(W,st,zt);if(mr)return St(W,st,zt);var fr=Pr(st);if(!rn(fr))return dt(W,fr,zt)}function St(W,st,zt){var mr=je(st,zt,!1);if(!Er(mr))return mr.get(W)}function Rt(W,st,zt,mr){var fr=je(zt,mr,!0);fr.set(W,st)}function $t(W,st){var zt=gt(W,st),mr=Pr(W);if(mr===null)return zt;var fr=$t(mr,st);if(fr.length<=0)return zt;if(zt.length<=0)return fr;for(var nn=new M,Mn=[],Wn=0,Bn=zt;Wn<Bn.length;Wn++){var Mi=Bn[Wn],mi=nn.has(Mi);mi||(nn.add(Mi),Mn.push(Mi))}for(var mo=0,ca=fr;mo<ca.length;mo++){var Mi=ca[mo],mi=nn.has(Mi);mi||(nn.add(Mi),Mn.push(Mi))}return Mn}function gt(W,st){var zt=[],mr=je(W,st,!1);if(Er(mr))return zt;for(var fr=mr.keys(),nn=Ct(fr),Mn=0;;){var Wn=qt(nn);if(!Wn)return zt.length=Mn,zt;var Bn=Yt(Wn);try{zt[Mn]=Bn}catch(Mi){try{_r(nn)}finally{throw Mi}}Mn++}}function jr(W){if(W===null)return 1;switch(typeof W){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return W===null?1:6;default:return 6}}function Er(W){return W===void 0}function rn(W){return W===null}function dn(W){return typeof W=="symbol"}function Rn(W){return typeof W=="object"?W!==null:typeof W=="function"}function Ar(W,st){switch(jr(W)){case 0:return W;case 1:return W;case 2:return W;case 3:return W;case 4:return W;case 5:return W}var zt=st===3?"string":st===5?"number":"default",mr=Qe(W,i);if(mr!==void 0){var fr=mr.call(W,zt);if(Rn(fr))throw new TypeError;return fr}return xa(W,zt==="default"?"number":zt)}function xa(W,st){if(st==="string"){var zt=W.toString;if(Kn(zt)){var mr=zt.call(W);if(!Rn(mr))return mr}var fr=W.valueOf;if(Kn(fr)){var mr=fr.call(W);if(!Rn(mr))return mr}}else{var fr=W.valueOf;if(Kn(fr)){var mr=fr.call(W);if(!Rn(mr))return mr}var nn=W.toString;if(Kn(nn)){var mr=nn.call(W);if(!Rn(mr))return mr}}throw new TypeError}function Ti(W){return!!W}function Sa(W){return""+W}function hr(W){var st=Ar(W,3);return dn(st)?st:Sa(st)}function Dr(W){return Array.isArray?Array.isArray(W):W instanceof Object?W instanceof Array:Object.prototype.toString.call(W)==="[object Array]"}function Kn(W){return typeof W=="function"}function Wt(W){return typeof W=="function"}function Me(W){switch(jr(W)){case 3:return!0;case 4:return!0;default:return!1}}function Qe(W,st){var zt=W[st];if(zt!=null){if(!Kn(zt))throw new TypeError;return zt}}function Ct(W){var st=Qe(W,a);if(!Kn(st))throw new TypeError;var zt=st.call(W);if(!Rn(zt))throw new TypeError;return zt}function Yt(W){return W.value}function qt(W){var st=W.next();return st.done?!1:st}function _r(W){var st=W.return;st&&st.call(W)}function Pr(W){var st=Object.getPrototypeOf(W);if(typeof W!="function"||W===y||st!==y)return st;var zt=W.prototype,mr=zt&&Object.getPrototypeOf(zt);if(mr==null||mr===Object.prototype)return st;var fr=mr.constructor;return typeof fr!="function"||fr===W?st:fr}function xr(){var W={},st=[],zt=function(){function Mn(Wn,Bn,Mi){this._index=0,this._keys=Wn,this._values=Bn,this._selector=Mi}return Mn.prototype["@@iterator"]=function(){return this},Mn.prototype[a]=function(){return this},Mn.prototype.next=function(){var Wn=this._index;if(Wn>=0&&Wn<this._keys.length){var Bn=this._selector(this._keys[Wn],this._values[Wn]);return Wn+1>=this._keys.length?(this._index=-1,this._keys=st,this._values=st):this._index++,{value:Bn,done:!1}}return{value:void 0,done:!0}},Mn.prototype.throw=function(Wn){throw this._index>=0&&(this._index=-1,this._keys=st,this._values=st),Wn},Mn.prototype.return=function(Wn){return this._index>=0&&(this._index=-1,this._keys=st,this._values=st),{value:Wn,done:!0}},Mn}();return function(){function Mn(){this._keys=[],this._values=[],this._cacheKey=W,this._cacheIndex=-2}return Object.defineProperty(Mn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Mn.prototype.has=function(Wn){return this._find(Wn,!1)>=0},Mn.prototype.get=function(Wn){var Bn=this._find(Wn,!1);return Bn>=0?this._values[Bn]:void 0},Mn.prototype.set=function(Wn,Bn){var Mi=this._find(Wn,!0);return this._values[Mi]=Bn,this},Mn.prototype.delete=function(Wn){var Bn=this._find(Wn,!1);if(Bn>=0){for(var Mi=this._keys.length,mi=Bn+1;mi<Mi;mi++)this._keys[mi-1]=this._keys[mi],this._values[mi-1]=this._values[mi];return this._keys.length--,this._values.length--,Wn===this._cacheKey&&(this._cacheKey=W,this._cacheIndex=-2),!0}return!1},Mn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=W,this._cacheIndex=-2},Mn.prototype.keys=function(){return new zt(this._keys,this._values,mr)},Mn.prototype.values=function(){return new zt(this._keys,this._values,fr)},Mn.prototype.entries=function(){return new zt(this._keys,this._values,nn)},Mn.prototype["@@iterator"]=function(){return this.entries()},Mn.prototype[a]=function(){return this.entries()},Mn.prototype._find=function(Wn,Bn){return this._cacheKey!==Wn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Wn)),this._cacheIndex<0&&Bn&&(this._cacheIndex=this._keys.length,this._keys.push(Wn),this._values.push(void 0)),this._cacheIndex},Mn}();function mr(Mn,Wn){return Mn}function fr(Mn,Wn){return Wn}function nn(Mn,Wn){return[Mn,Wn]}}function kr(){return function(){function W(){this._map=new w}return Object.defineProperty(W.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),W.prototype.has=function(st){return this._map.has(st)},W.prototype.add=function(st){return this._map.set(st,st),this},W.prototype.delete=function(st){return this._map.delete(st)},W.prototype.clear=function(){this._map.clear()},W.prototype.keys=function(){return this._map.keys()},W.prototype.values=function(){return this._map.values()},W.prototype.entries=function(){return this._map.entries()},W.prototype["@@iterator"]=function(){return this.keys()},W.prototype[a]=function(){return this.keys()},W}()}function vr(){var W=16,st=p.create(),zt=mr();return function(){function Bn(){this._key=mr()}return Bn.prototype.has=function(Mi){var mi=fr(Mi,!1);return mi!==void 0?p.has(mi,this._key):!1},Bn.prototype.get=function(Mi){var mi=fr(Mi,!1);return mi!==void 0?p.get(mi,this._key):void 0},Bn.prototype.set=function(Mi,mi){var mo=fr(Mi,!0);return mo[this._key]=mi,this},Bn.prototype.delete=function(Mi){var mi=fr(Mi,!1);return mi!==void 0?delete mi[this._key]:!1},Bn.prototype.clear=function(){this._key=mr()},Bn}();function mr(){var Bn;do Bn="@@WeakMap@@"+Wn();while(p.has(st,Bn));return st[Bn]=!0,Bn}function fr(Bn,Mi){if(!t.call(Bn,zt)){if(!Mi)return;Object.defineProperty(Bn,zt,{value:p.create()})}return Bn[zt]}function nn(Bn,Mi){for(var mi=0;mi<Mi;++mi)Bn[mi]=Math.random()*255|0;return Bn}function Mn(Bn){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Bn)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Bn)):nn(new Uint8Array(Bn),Bn):nn(new Array(Bn),Bn)}function Wn(){var Bn=Mn(W);Bn[6]=Bn[6]&79|64,Bn[8]=Bn[8]&191|128;for(var Mi="",mi=0;mi<W;++mi){var mo=Bn[mi];(mi===4||mi===6||mi===8)&&(Mi+="-"),mo<16&&(Mi+="0"),Mi+=mo.toString(16).toLowerCase()}return Mi}}function In(W){return W.__=void 0,delete W.__,W}})})(KT||(KT={}));var zv="named",NO="name",Mw="unmanaged",zO="optional",o2="inject",F1="multi_inject",UO="inversify:tagged",VO="inversify:tagged_props",qC="inversify:paramtypes",DV="design:paramtypes",s1="post_construct";function BV(){return[o2,F1,NO,Mw,zv,zO]}var QT=BV(),cf={Request:"Request",Singleton:"Singleton",Transient:"Transient"},lf={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},x0={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},NV=0;function q1(){return NV++}var zV=function(){function e(r,t){this.id=q1(),this.activated=!1,this.serviceIdentifier=r,this.scope=t,this.type=lf.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var r=new e(this.serviceIdentifier,this.scope);return r.activated=r.scope===cf.Singleton?this.activated:!1,r.implementationType=this.implementationType,r.dynamicValue=this.dynamicValue,r.scope=this.scope,r.type=this.type,r.factory=this.factory,r.provider=this.provider,r.constraint=this.constraint,r.onActivation=this.onActivation,r.cache=this.cache,r},e}(),UV="Cannot apply @injectable decorator multiple times.",VV="Metadata key was used more than once in a parameter:",L_="NULL argument",JT="Key Not Found",GV="Ambiguous match found for serviceIdentifier:",jV="Could not unbind serviceIdentifier:",HV="No matching bindings found for serviceIdentifier:",WV="Missing required @injectable annotation in:",$V="Missing required @inject or @multiInject annotation in:",XV=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},ZV="Circular dependency found:",YV="Invalid binding type:",qV="No snapshot available to restore.",KV="Invalid return type in middleware. Middleware must return!",QV="Value provided to function binding must be a function!",JV="The toSelf function can only be applied when a constructor is used as service identifier",eG="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",tG=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return"The number of constructor arguments in the derived class "+(e[0]+" must be >= than the number of constructor arguments of its base class.")},rG="Invalid Container constructor argument. Container options must be an object.",nG="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",iG="Invalid Container option. Auto bind injectable must be a boolean",aG="Invalid Container option. Skip base check must be a boolean",oG="Cannot apply @postConstruct decorator multiple times in the same class",sG=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return"@postConstruct error in class "+e[0]+": "+e[1]},uG=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return"It looks like there is a circular dependency "+("in one of the '"+e[0]+"' bindings. Please investigate bindings with")+("service identifier '"+e[1]+"'.")},lG="Maximum call stack size exceeded",cG=function(){function e(){}return e.prototype.getConstructorMetadata=function(r){var t=Reflect.getMetadata(qC,r),n=Reflect.getMetadata(UO,r);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},e.prototype.getPropertiesMetadata=function(r){var t=Reflect.getMetadata(VO,r)||[];return t},e}(),Kx={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function GO(e){return e instanceof RangeError||e.message===lG}function D1(e){if(typeof e=="function"){var r=e;return r.name}else{if(typeof e=="symbol")return e.toString();var r=e;return r}}function e5(e,r,t){var n="",i=t(e,r);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(a){var o="Object";a.implementationType!==null&&(o=s2(a.implementationType)),n=n+`
 `+o,a.constraint.metaData&&(n=n+" - "+a.constraint.metaData)})),n}function jO(e,r){return e.parentRequest===null?!1:e.parentRequest.serviceIdentifier===r?!0:jO(e.parentRequest,r)}function fG(e){function r(n,i){i===void 0&&(i=[]);var a=D1(n.serviceIdentifier);return i.push(a),n.parentRequest!==null?r(n.parentRequest,i):i}var t=r(e);return t.reverse().join(" --> ")}function HO(e){e.childRequests.forEach(function(r){if(jO(r,r.serviceIdentifier)){var t=fG(r);throw new Error(ZV+" "+t)}else HO(r)})}function hG(e,r){if(r.isTagged()||r.isNamed()){var t="",n=r.getNamedTag(),i=r.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(a){t+=a.toString()+`
`})," "+e+`
 `+e+" - "+t}else return" "+e}function s2(e){if(e.name)return e.name;var r=e.toString(),t=r.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+r}var WO=function(){function e(r){this.id=q1(),this.container=r}return e.prototype.addPlan=function(r){this.plan=r},e.prototype.setCurrentRequest=function(r){this.currentRequest=r},e}(),Em=function(){function e(r,t){this.key=r,this.value=t}return e.prototype.toString=function(){return this.key===zv?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}(),pG=function(){function e(r,t){this.parentContext=r,this.rootRequest=t}return e}();function dG(e,r,t,n){var i=UO;$O(i,e,r,n,t)}function vG(e,r,t){var n=VO;$O(n,e.constructor,r,t)}function $O(e,r,t,n,i){var a={},o=typeof i=="number",l=i!==void 0&&o?i.toString():t;if(o&&t!==void 0)throw new Error(eG);Reflect.hasOwnMetadata(e,r)&&(a=Reflect.getMetadata(e,r));var c=a[l];if(!Array.isArray(c))c=[];else for(var p=0,y=c;p<y.length;p++){var b=y[p];if(b.key===n.key)throw new Error(VV+" "+b.key.toString())}c.push(n),a[l]=c,Reflect.defineMetadata(e,a,r)}function t5(e,r){Reflect.decorate(e,r)}function mG(e,r){return function(t,n){r(t,n,e)}}function gG(e,r,t){typeof t=="number"?t5([mG(t,e)],r):typeof t=="string"?Reflect.decorate([e],r,t):t5([e],r)}var yG=function(){function e(r){this._cb=r}return e.prototype.unwrap=function(){return this._cb()},e}();function na(e){return function(r,t,n){if(e===void 0)throw new Error(XV(r.name));var i=new Em(o2,e);typeof n=="number"?dG(r,t,n,i):vG(r,t,i)}}var _G=function(){function e(r){this.str=r}return e.prototype.startsWith=function(r){return this.str.indexOf(r)===0},e.prototype.endsWith=function(r){var t="",n=r.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(r){return this.str.indexOf(r)!==-1},e.prototype.equals=function(r){return this.str===r},e.prototype.value=function(){return this.str},e}(),u2=function(){function e(r,t,n,i){this.id=q1(),this.type=r,this.serviceIdentifier=n,this.name=new _G(t||""),this.metadata=new Array;var a=null;typeof i=="string"?a=new Em(zv,i):i instanceof Em&&(a=i),a!==null&&this.metadata.push(a)}return e.prototype.hasTag=function(r){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===r)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(F1)},e.prototype.matchesArray=function(r){return this.matchesTag(F1)(r)},e.prototype.isNamed=function(){return this.hasTag(zv)},e.prototype.isTagged=function(){return this.metadata.some(function(r){return QT.every(function(t){return r.key!==t})})},e.prototype.isOptional=function(){return this.matchesTag(zO)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(r){return r.key===zv})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(r){return QT.every(function(t){return r.key!==t})}):null},e.prototype.matchesNamedTag=function(r){return this.matchesTag(zv)(r)},e.prototype.matchesTag=function(r){var t=this;return function(n){for(var i=0,a=t.metadata;i<a.length;i++){var o=a[i];if(o.key===r&&o.value===n)return!0}return!1}},e}(),_b=globalThis&&globalThis.__spreadArray||function(e,r){for(var t=0,n=r.length,i=e.length;t<n;t++,i++)e[i]=r[t];return e};function xG(e,r){var t=s2(r),n=XO(e,t,r,!1);return n}function XO(e,r,t,n){var i=e.getConstructorMetadata(t),a=i.compilerGeneratedMetadata;if(a===void 0){var o=WV+" "+r+".";throw new Error(o)}var l=i.userGeneratedMetadata,c=Object.keys(l),p=t.length===0&&c.length>0,y=c.length>t.length,b=p||y?c.length:t.length,w=EG(n,r,a,l,b),M=ZO(e,t),O=_b(_b([],w),M);return O}function bG(e,r,t,n,i){var a=i[e.toString()]||[],o=qO(a),l=o.unmanaged!==!0,c=n[e],p=o.inject||o.multiInject;if(c=p||c,c instanceof yG&&(c=c.unwrap()),l){var y=c===Object,b=c===Function,w=c===void 0,M=y||b||w;if(!r&&M){var O=$V+" argument "+e+" in class "+t+".";throw new Error(O)}var N=new u2(x0.ConstructorArgument,o.targetName,c);return N.metadata=a,N}return null}function EG(e,r,t,n,i){for(var a=[],o=0;o<i;o++){var l=o,c=bG(l,e,r,t,n);c!==null&&a.push(c)}return a}function ZO(e,r){for(var t=e.getPropertiesMetadata(r),n=[],i=Object.keys(t),a=0,o=i;a<o.length;a++){var l=o[a],c=t[l],p=qO(t[l]),y=p.targetName||l,b=p.inject||p.multiInject,w=new u2(x0.ClassProperty,y,b);w.metadata=c,n.push(w)}var M=Object.getPrototypeOf(r.prototype).constructor;if(M!==Object){var O=ZO(e,M);n=_b(_b([],n),O)}return n}function YO(e,r){var t=Object.getPrototypeOf(r.prototype).constructor;if(t!==Object){var n=s2(t),i=XO(e,n,t,!0),a=i.map(function(c){return c.metadata.filter(function(p){return p.key===Mw})}),o=[].concat.apply([],a).length,l=i.length-o;return l>0?l:YO(e,t)}else return 0}function qO(e){var r={};return e.forEach(function(t){r[t.key.toString()]=t.value}),{inject:r[o2],multiInject:r[F1],targetName:r[NO],unmanaged:r[Mw]}}var Iw=function(){function e(r,t,n,i,a){this.id=q1(),this.serviceIdentifier=r,this.parentContext=t,this.parentRequest=n,this.target=a,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return e.prototype.addChildRequest=function(r,t,n){var i=new e(r,this.parentContext,this,t,n);return this.childRequests.push(i),i},e}();function KC(e){return e._bindingDictionary}function CG(e,r,t,n,i,a){var o=e?F1:o2,l=new Em(o,t),c=new u2(r,n,t,l);if(i!==void 0){var p=new Em(i,a);c.metadata.push(p)}return c}function r5(e,r,t,n,i){var a=B1(t.container,i.serviceIdentifier),o=[];return a.length===Kx.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),a=B1(t.container,i.serviceIdentifier)),r?o=a:o=a.filter(function(l){var c=new Iw(l.serviceIdentifier,t,n,l,i);return l.constraint(c)}),SG(i.serviceIdentifier,o,i,t.container),o}function SG(e,r,t,n){switch(r.length){case Kx.NoBindingsAvailable:if(t.isOptional())return r;var i=D1(e),a=HV;throw a+=hG(i,t),a+=e5(n,i,B1),new Error(a);case Kx.OnlyOneBindingAvailable:if(!t.isArray())return r;case Kx.MultipleBindingsAvailable:default:if(t.isArray())return r;var i=D1(e),a=GV+" "+i;throw a+=e5(n,i,B1),new Error(a)}}function KO(e,r,t,n,i,a){var o,l;if(i===null){o=r5(e,r,n,null,a),l=new Iw(t,n,null,o,a);var c=new pG(n,l);n.addPlan(c)}else o=r5(e,r,n,i,a),l=i.addChildRequest(a.serviceIdentifier,o,a);o.forEach(function(p){var y=null;if(a.isArray())y=l.addChildRequest(p.serviceIdentifier,p,a);else{if(p.cache)return;y=l}if(p.type===lf.Instance&&p.implementationType!==null){var b=xG(e,p.implementationType);if(!n.container.options.skipBaseClassChecks){var w=YO(e,p.implementationType);if(b.length<w){var M=tG(s2(p.implementationType));throw new Error(M)}}b.forEach(function(O){KO(e,!1,O.serviceIdentifier,n,y,O)})}})}function B1(e,r){var t=[],n=KC(e);return n.hasKey(r)?t=n.get(r):e.parent!==null&&(t=B1(e.parent,r)),t}function wG(e,r,t,n,i,a,o,l){l===void 0&&(l=!1);var c=new WO(r),p=CG(t,n,i,"",a,o);try{return KO(e,l,i,c,null,p),c}catch(y){throw GO(y)&&c.plan&&HO(c.plan.rootRequest),y}}function AG(e,r,t,n){var i=new u2(x0.Variable,"",r,new Em(t,n)),a=new WO(e),o=new Iw(r,a,null,[],i);return o}var TG=globalThis&&globalThis.__spreadArray||function(e,r){for(var t=0,n=r.length,i=e.length;t<n;t++,i++)e[i]=r[t];return e};function MG(e,r,t){var n=r.filter(function(a){return a.target!==null&&a.target.type===x0.ClassProperty}),i=n.map(t);return n.forEach(function(a,o){var l="";l=a.target.name.value();var c=i[o];e[l]=c}),e}function IG(e,r){return new(e.bind.apply(e,TG([void 0],r)))}function LG(e,r){if(Reflect.hasMetadata(s1,e)){var t=Reflect.getMetadata(s1,e);try{r[t.value]()}catch(n){throw new Error(sG(e.name,n.message))}}}function kG(e,r,t){var n=null;if(r.length>0){var i=r.filter(function(o){return o.target!==null&&o.target.type===x0.ConstructorArgument}),a=i.map(t);n=IG(e,a),n=MG(n,r,t)}else n=new e;return LG(e,n),n}var yE=function(e,r,t){try{return t()}catch(n){throw GO(n)?new Error(uG(e,r.toString())):n}},QC=function(e){return function(r){r.parentContext.setCurrentRequest(r);var t=r.bindings,n=r.childRequests,i=r.target&&r.target.isArray(),a=!r.parentRequest||!r.parentRequest.target||!r.target||!r.parentRequest.target.matchesArray(r.target.serviceIdentifier);if(i&&a)return n.map(function(b){var w=QC(e);return w(b)});var o=null;if(r.target.isOptional()&&t.length===0)return;var l=t[0],c=l.scope===cf.Singleton,p=l.scope===cf.Request;if(c&&l.activated)return l.cache;if(p&&e!==null&&e.has(l.id))return e.get(l.id);if(l.type===lf.ConstantValue)o=l.cache,l.activated=!0;else if(l.type===lf.Function)o=l.cache,l.activated=!0;else if(l.type===lf.Constructor)o=l.implementationType;else if(l.type===lf.DynamicValue&&l.dynamicValue!==null)o=yE("toDynamicValue",l.serviceIdentifier,function(){return l.dynamicValue(r.parentContext)});else if(l.type===lf.Factory&&l.factory!==null)o=yE("toFactory",l.serviceIdentifier,function(){return l.factory(r.parentContext)});else if(l.type===lf.Provider&&l.provider!==null)o=yE("toProvider",l.serviceIdentifier,function(){return l.provider(r.parentContext)});else if(l.type===lf.Instance&&l.implementationType!==null)o=kG(l.implementationType,n,QC(e));else{var y=D1(r.serviceIdentifier);throw new Error(YV+" "+y)}return typeof l.onActivation=="function"&&(o=l.onActivation(r.parentContext,o)),c&&(l.cache=o,l.activated=!0),p&&e!==null&&!e.has(l.id)&&e.set(l.id,o),o}};function RG(e){var r=QC(e.plan.rootRequest.requestScope);return r(e.plan.rootRequest)}var v0=function(e,r){var t=e.parentRequest;return t!==null?r(t)?!0:v0(t,r):!1},q_=function(e){return function(r){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(e)(r)};return t.metaData=new Em(e,r),t}},Tx=q_(zv),_E=function(e){return function(r){var t=null;if(r!==null)if(t=r.bindings[0],typeof e=="string"){var n=t.serviceIdentifier;return n===e}else{var i=r.bindings[0].implementationType;return e===i}return!1}},Lw=function(){function e(r){this._binding=r}return e.prototype.when=function(r){return this._binding.constraint=r,new sf(this._binding)},e.prototype.whenTargetNamed=function(r){return this._binding.constraint=Tx(r),new sf(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(r){var t=r.target!==null&&!r.target.isNamed()&&!r.target.isTagged();return t},new sf(this._binding)},e.prototype.whenTargetTagged=function(r,t){return this._binding.constraint=q_(r)(t),new sf(this._binding)},e.prototype.whenInjectedInto=function(r){return this._binding.constraint=function(t){return _E(r)(t.parentRequest)},new sf(this._binding)},e.prototype.whenParentNamed=function(r){return this._binding.constraint=function(t){return Tx(r)(t.parentRequest)},new sf(this._binding)},e.prototype.whenParentTagged=function(r,t){return this._binding.constraint=function(n){return q_(r)(t)(n.parentRequest)},new sf(this._binding)},e.prototype.whenAnyAncestorIs=function(r){return this._binding.constraint=function(t){return v0(t,_E(r))},new sf(this._binding)},e.prototype.whenNoAncestorIs=function(r){return this._binding.constraint=function(t){return!v0(t,_E(r))},new sf(this._binding)},e.prototype.whenAnyAncestorNamed=function(r){return this._binding.constraint=function(t){return v0(t,Tx(r))},new sf(this._binding)},e.prototype.whenNoAncestorNamed=function(r){return this._binding.constraint=function(t){return!v0(t,Tx(r))},new sf(this._binding)},e.prototype.whenAnyAncestorTagged=function(r,t){return this._binding.constraint=function(n){return v0(n,q_(r)(t))},new sf(this._binding)},e.prototype.whenNoAncestorTagged=function(r,t){return this._binding.constraint=function(n){return!v0(n,q_(r)(t))},new sf(this._binding)},e.prototype.whenAnyAncestorMatches=function(r){return this._binding.constraint=function(t){return v0(t,r)},new sf(this._binding)},e.prototype.whenNoAncestorMatches=function(r){return this._binding.constraint=function(t){return!v0(t,r)},new sf(this._binding)},e}(),sf=function(){function e(r){this._binding=r}return e.prototype.onActivation=function(r){return this._binding.onActivation=r,new Lw(this._binding)},e}(),cm=function(){function e(r){this._binding=r,this._bindingWhenSyntax=new Lw(this._binding),this._bindingOnSyntax=new sf(this._binding)}return e.prototype.when=function(r){return this._bindingWhenSyntax.when(r)},e.prototype.whenTargetNamed=function(r){return this._bindingWhenSyntax.whenTargetNamed(r)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(r,t){return this._bindingWhenSyntax.whenTargetTagged(r,t)},e.prototype.whenInjectedInto=function(r){return this._bindingWhenSyntax.whenInjectedInto(r)},e.prototype.whenParentNamed=function(r){return this._bindingWhenSyntax.whenParentNamed(r)},e.prototype.whenParentTagged=function(r,t){return this._bindingWhenSyntax.whenParentTagged(r,t)},e.prototype.whenAnyAncestorIs=function(r){return this._bindingWhenSyntax.whenAnyAncestorIs(r)},e.prototype.whenNoAncestorIs=function(r){return this._bindingWhenSyntax.whenNoAncestorIs(r)},e.prototype.whenAnyAncestorNamed=function(r){return this._bindingWhenSyntax.whenAnyAncestorNamed(r)},e.prototype.whenAnyAncestorTagged=function(r,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(r,t)},e.prototype.whenNoAncestorNamed=function(r){return this._bindingWhenSyntax.whenNoAncestorNamed(r)},e.prototype.whenNoAncestorTagged=function(r,t){return this._bindingWhenSyntax.whenNoAncestorTagged(r,t)},e.prototype.whenAnyAncestorMatches=function(r){return this._bindingWhenSyntax.whenAnyAncestorMatches(r)},e.prototype.whenNoAncestorMatches=function(r){return this._bindingWhenSyntax.whenNoAncestorMatches(r)},e.prototype.onActivation=function(r){return this._bindingOnSyntax.onActivation(r)},e}(),OG=function(){function e(r){this._binding=r}return e.prototype.inRequestScope=function(){return this._binding.scope=cf.Request,new cm(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=cf.Transient,new cm(this._binding)},e}(),n5=function(){function e(r){this._binding=r,this._bindingWhenSyntax=new Lw(this._binding),this._bindingOnSyntax=new sf(this._binding),this._bindingInSyntax=new OG(r)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(r){return this._bindingWhenSyntax.when(r)},e.prototype.whenTargetNamed=function(r){return this._bindingWhenSyntax.whenTargetNamed(r)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(r,t){return this._bindingWhenSyntax.whenTargetTagged(r,t)},e.prototype.whenInjectedInto=function(r){return this._bindingWhenSyntax.whenInjectedInto(r)},e.prototype.whenParentNamed=function(r){return this._bindingWhenSyntax.whenParentNamed(r)},e.prototype.whenParentTagged=function(r,t){return this._bindingWhenSyntax.whenParentTagged(r,t)},e.prototype.whenAnyAncestorIs=function(r){return this._bindingWhenSyntax.whenAnyAncestorIs(r)},e.prototype.whenNoAncestorIs=function(r){return this._bindingWhenSyntax.whenNoAncestorIs(r)},e.prototype.whenAnyAncestorNamed=function(r){return this._bindingWhenSyntax.whenAnyAncestorNamed(r)},e.prototype.whenAnyAncestorTagged=function(r,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(r,t)},e.prototype.whenNoAncestorNamed=function(r){return this._bindingWhenSyntax.whenNoAncestorNamed(r)},e.prototype.whenNoAncestorTagged=function(r,t){return this._bindingWhenSyntax.whenNoAncestorTagged(r,t)},e.prototype.whenAnyAncestorMatches=function(r){return this._bindingWhenSyntax.whenAnyAncestorMatches(r)},e.prototype.whenNoAncestorMatches=function(r){return this._bindingWhenSyntax.whenNoAncestorMatches(r)},e.prototype.onActivation=function(r){return this._bindingOnSyntax.onActivation(r)},e}(),PG=function(){function e(r){this._binding=r}return e.prototype.to=function(r){return this._binding.type=lf.Instance,this._binding.implementationType=r,new n5(this._binding)},e.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+JV);var r=this._binding.serviceIdentifier;return this.to(r)},e.prototype.toConstantValue=function(r){return this._binding.type=lf.ConstantValue,this._binding.cache=r,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.toDynamicValue=function(r){return this._binding.type=lf.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=r,this._binding.implementationType=null,new n5(this._binding)},e.prototype.toConstructor=function(r){return this._binding.type=lf.Constructor,this._binding.implementationType=r,this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.toFactory=function(r){return this._binding.type=lf.Factory,this._binding.factory=r,this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.toFunction=function(r){if(typeof r!="function")throw new Error(QV);var t=this.toConstantValue(r);return this._binding.type=lf.Function,this._binding.scope=cf.Singleton,t},e.prototype.toAutoFactory=function(r){return this._binding.type=lf.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(r)};return n},this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.toProvider=function(r){return this._binding.type=lf.Provider,this._binding.provider=r,this._binding.scope=cf.Singleton,new cm(this._binding)},e.prototype.toService=function(r){this.toDynamicValue(function(t){return t.container.get(r)})},e}(),FG=function(){function e(){}return e.of=function(r,t){var n=new e;return n.bindings=r,n.middleware=t,n},e}(),i5=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(r,t){if(r==null)throw new Error(L_);if(t==null)throw new Error(L_);var n=this._map.get(r);n!==void 0?(n.push(t),this._map.set(r,n)):this._map.set(r,[t])},e.prototype.get=function(r){if(r==null)throw new Error(L_);var t=this._map.get(r);if(t!==void 0)return t;throw new Error(JT)},e.prototype.remove=function(r){if(r==null)throw new Error(L_);if(!this._map.delete(r))throw new Error(JT)},e.prototype.removeByCondition=function(r){var t=this;this._map.forEach(function(n,i){var a=n.filter(function(o){return!r(o)});a.length>0?t._map.set(i,a):t._map.delete(i)})},e.prototype.hasKey=function(r){if(r==null)throw new Error(L_);return this._map.has(r)},e.prototype.clone=function(){var r=new e;return this._map.forEach(function(t,n){t.forEach(function(i){return r.add(n,i.clone())})}),r},e.prototype.traverse=function(r){this._map.forEach(function(t,n){r(n,t)})},e}(),DG=globalThis&&globalThis.__awaiter||function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(y){try{p(n.next(y))}catch(b){o(b)}}function c(y){try{p(n.throw(y))}catch(b){o(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},BG=globalThis&&globalThis.__generator||function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},NG=globalThis&&globalThis.__spreadArray||function(e,r){for(var t=0,n=r.length,i=e.length;t<n;t++,i++)e[i]=r[t];return e},kw=function(){function e(r){this._appliedMiddleware=[];var t=r||{};if(typeof t!="object")throw new Error(""+rG);if(t.defaultScope===void 0)t.defaultScope=cf.Transient;else if(t.defaultScope!==cf.Singleton&&t.defaultScope!==cf.Transient&&t.defaultScope!==cf.Request)throw new Error(""+nG);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+iG);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+aG);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=q1(),this._bindingDictionary=new i5,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new cG}return e.merge=function(r,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a=new e,o=NG([r,t],n).map(function(p){return KC(p)}),l=KC(a);function c(p,y){p.traverse(function(b,w){w.forEach(function(M){y.add(M.serviceIdentifier,M.clone())})})}return o.forEach(function(p){c(p,l)}),a},e.prototype.load=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,a=r;i<a.length;i++){var o=a[i],l=n(o.id);o.registry(l.bindFunction,l.unbindFunction,l.isboundFunction,l.rebindFunction)}},e.prototype.loadAsync=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return DG(this,void 0,void 0,function(){var n,i,a,o,l;return BG(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,a=r,c.label=1;case 1:return i<a.length?(o=a[i],l=n(o.id),[4,o.registry(l.bindFunction,l.unbindFunction,l.isboundFunction,l.rebindFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var r=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=function(a){return function(o){return o.moduleId===a}};t.forEach(function(a){var o=i(a.id);r._bindingDictionary.removeByCondition(o)})},e.prototype.bind=function(r){var t=this.options.defaultScope||cf.Transient,n=new zV(r,t);return this._bindingDictionary.add(r,n),new PG(n)},e.prototype.rebind=function(r){return this.unbind(r),this.bind(r)},e.prototype.unbind=function(r){try{this._bindingDictionary.remove(r)}catch{throw new Error(jV+" "+D1(r))}},e.prototype.unbindAll=function(){this._bindingDictionary=new i5},e.prototype.isBound=function(r){var t=this._bindingDictionary.hasKey(r);return!t&&this.parent&&(t=this.parent.isBound(r)),t},e.prototype.isBoundNamed=function(r,t){return this.isBoundTagged(r,zv,t)},e.prototype.isBoundTagged=function(r,t,n){var i=!1;if(this._bindingDictionary.hasKey(r)){var a=this._bindingDictionary.get(r),o=AG(this,r,t,n);i=a.some(function(l){return l.constraint(o)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(r,t,n)),i},e.prototype.snapshot=function(){this._snapshots.push(FG.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var r=this._snapshots.pop();if(r===void 0)throw new Error(qV);this._bindingDictionary=r.bindings,this._middleware=r.middleware},e.prototype.createChild=function(r){var t=new e(r||this.options);return t.parent=this,t},e.prototype.applyMiddleware=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(r);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=r.reduce(function(i,a){return a(i)},n)},e.prototype.applyCustomMetadataReader=function(r){this._metadataReader=r},e.prototype.get=function(r){return this._get(!1,!1,x0.Variable,r)},e.prototype.getTagged=function(r,t,n){return this._get(!1,!1,x0.Variable,r,t,n)},e.prototype.getNamed=function(r,t){return this.getTagged(r,zv,t)},e.prototype.getAll=function(r){return this._get(!0,!0,x0.Variable,r)},e.prototype.getAllTagged=function(r,t,n){return this._get(!1,!0,x0.Variable,r,t,n)},e.prototype.getAllNamed=function(r,t){return this.getAllTagged(r,zv,t)},e.prototype.resolve=function(r){var t=this.createChild();return t.bind(r).toSelf(),this._appliedMiddleware.forEach(function(n){t.applyMiddleware(n)}),t.get(r)},e.prototype._getContainerModuleHelpersFactory=function(){var r=this,t=function(l,c){l._binding.moduleId=c},n=function(l){return function(c){var p=r.bind.bind(r),y=p(c);return t(y,l),y}},i=function(l){return function(c){var p=r.unbind.bind(r);p(c)}},a=function(l){return function(c){var p=r.isBound.bind(r);return p(c)}},o=function(l){return function(c){var p=r.rebind.bind(r),y=p(c);return t(y,l),y}};return function(l){return{bindFunction:n(l),isboundFunction:a(),rebindFunction:o(l),unbindFunction:i()}}},e.prototype._get=function(r,t,n,i,a,o){var l=null,c={avoidConstraints:r,contextInterceptor:function(p){return p},isMultiInject:t,key:a,serviceIdentifier:i,targetType:n,value:o};if(this._middleware){if(l=this._middleware(c),l==null)throw new Error(KV)}else l=this._planAndResolve()(c);return l},e.prototype._planAndResolve=function(){var r=this;return function(t){var n=wG(r._metadataReader,r,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=RG(n);return i}},e}();function oa(){return function(e){if(Reflect.hasOwnMetadata(qC,e))throw new Error(UV);var r=Reflect.getMetadata(DV,e)||[];return Reflect.defineMetadata(qC,r,e),e}}function zG(){return function(e,r,t){var n=new Em(s1,r);if(Reflect.hasOwnMetadata(s1,e.constructor))throw new Error(oG);Reflect.defineMetadata(s1,n,e.constructor)}}var k_=Symbol.for("INJECTION");function l2(e,r,t,n){function i(){return n&&!Reflect.hasMetadata(k_,this,r)&&Reflect.defineMetadata(k_,t(),this,r),Reflect.hasMetadata(k_,this,r)?Reflect.getMetadata(k_,this,r):t()}function a(o){Reflect.defineMetadata(k_,o,this,r)}Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:i,set:a})}function UG(e,r){return function(t){return function(n,i){var a=function(){return e.get(t)};l2(n,i,a,r)}}}function VG(e,r){return function(t,n){return function(i,a){var o=function(){return e.getNamed(t,n)};l2(i,a,o,r)}}}function GG(e,r){return function(t,n,i){return function(a,o){var l=function(){return e.getTagged(t,n,i)};l2(a,o,l,r)}}}function jG(e,r){return function(t){return function(n,i){var a=function(){return e.getAll(t)};l2(n,i,a,r)}}}function HG(e,r){r===void 0&&(r=!0);var t=UG(e,r),n=VG(e,r),i=GG(e,r),a=jG(e,r);return{lazyInject:t,lazyInjectNamed:n,lazyInjectTagged:i,lazyMultiInject:a}}var Gt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Rw={exports:{}};Rw.exports=K1;Rw.exports.default=K1;var Vy=1e20;function K1(e,r,t,n,i,a){this.fontSize=e||24,this.buffer=r===void 0?3:r,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=a||"normal",this.radius=t||8;var o=this.size=this.fontSize+this.buffer*2,l=o+this.buffer*2,c=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;c?this.canvas=my.createOffscreenCanvas(o,o,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,c?this.middle=Math.round(o/2*1):this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function WG(e,r,t,n,i,a,o){a.fill(Vy,0,r*t),o.fill(0,0,r*t);for(var l=(r-n)/2,c=0;c<i;c++)for(var p=0;p<n;p++){var y=(c+l)*r+p+l,b=e.data[4*(c*n+p)+3]/255;if(b===1)a[y]=0,o[y]=Vy;else if(b===0)a[y]=Vy,o[y]=0;else{var w=Math.max(0,.5-b),M=Math.max(0,b-.5);a[y]=w*w,o[y]=M*M}}}function $G(e,r,t,n,i,a,o){for(var l=0;l<r*t;l++){var c=Math.sqrt(n[l])-Math.sqrt(i[l]);e[l]=Math.round(255-255*(c/a+o))}}K1.prototype._draw=function(e,r){var t=this.ctx.measureText(e),n=t.width,i=2*this.buffer,a,o,l,c,p,y,b,w;r&&this.useMetrics?(p=Math.floor(t.actualBoundingBoxAscent),w=this.buffer+Math.ceil(t.actualBoundingBoxAscent),y=this.buffer,b=this.buffer,o=Math.min(this.size,Math.ceil(t.actualBoundingBoxRight-t.actualBoundingBoxLeft)),c=Math.min(this.size-y,Math.ceil(t.actualBoundingBoxAscent+t.actualBoundingBoxDescent)),a=o+i,l=c+i,this.ctx.textBaseline="alphabetic"):(a=o=this.size,l=c=this.size,p=19*this.fontSize/24,y=b=0,w=this.middle,this.ctx.textBaseline="middle");var M;o&&c&&(this.ctx.clearRect(b,y,o,c),this.ctx.fillText(e,this.buffer,w),M=this.ctx.getImageData(b,y,o,c));var O=new Uint8ClampedArray(a*l);return WG(M,a,l,o,c,this.gridOuter,this.gridInner),a5(this.gridOuter,a,l,this.f,this.v,this.z),a5(this.gridInner,a,l,this.f,this.v,this.z),$G(O,a,l,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:O,metrics:{width:o,height:c,sdfWidth:a,sdfHeight:l,top:p,left:0,advance:n}}};K1.prototype.draw=function(e){return this._draw(e,!1).data};K1.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function a5(e,r,t,n,i,a){for(var o=0;o<r;o++)o5(e,o,r,t,n,i,a);for(var l=0;l<t;l++)o5(e,l*r,1,r,n,i,a)}function o5(e,r,t,n,i,a,o){var l,c,p,y;for(a[0]=0,o[0]=-Vy,o[1]=Vy,l=0;l<n;l++)i[l]=e[r+l*t];for(l=1,c=0,p=0;l<n;l++){do y=a[c],p=(i[l]-i[y]+l*l-y*y)/(l-y)/2;while(p<=o[c]&&--c>-1);c++,a[c]=l,o[c]=p,o[c+1]=Vy}for(l=0,c=0;l<n;l++){for(;o[c+1]<l;)c++;y=a[c],e[r+l*t]=i[y]+(l-y)*(l-y)}}function QO(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=XG(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function XG(e,r){if(!!e){if(typeof e=="string")return s5(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s5(e,r)}}function s5(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var R_=30;function ZG(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,o=e.mapping,l=o===void 0?{}:o,c=e.xOffset,p=c===void 0?0:c,y=e.yOffset,b=y===void 0?0:y,w=0,M=p;Array.from(r).forEach(function(N,z){if(!l[N]){var j=t(N,z);M+R_>a&&(M=0,w++),l[N]={x:M,y:b+w*R_,width:R_,height:R_,advance:j},M+=R_}});var O=n+i*2;return{mapping:l,xOffset:M,yOffset:b+w*O,canvasHeight:JO(b+(w+1)*O)}}function YG(e,r,t){var n=0,i=0,a=0,o=[],l={},c=QO(e),p;try{for(c.s();!(p=c.n()).done;){var y=p.value;if(!l[y.id]){var b=y.size;n+b+r>t&&(u5(l,o,i),n=0,i=a+i+r,a=0,o=[]),o.push({icon:y,xOffset:n}),n=n+b+r,a=Math.max(a,b)}}}catch(M){c.e(M)}finally{c.f()}o.length>0&&u5(l,o,i);var w=JO(a+i+r);return{mapping:l,canvasHeight:w}}function u5(e,r,t){var n=QO(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.icon,l=a.xOffset;e[o.id]=tr(tr({},o),{},{x:l,y:t,image:o.image,width:o.width,height:o.height})}}catch(c){n.e(c)}finally{n.f()}}function JO(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var l5,c5;function f5(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=qG(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function qG(e,r){if(!!e){if(typeof e=="string")return h5(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h5(e,r)}}function h5(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var KG=oj(),QG="sans-serif",JG="normal",ej=24,tj=3,rj=.25,nj=8,p5=1024,ij=1,d5=1,aj=3;function oj(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function v5(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function m5(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var sj=(l5=oa(),l5(c5=function(){function e(){Kt(this,e),ne(this,"fontAtlas",void 0),ne(this,"iconFontMap",void 0),ne(this,"iconFontGlyphs",{}),ne(this,"fontOptions",void 0),ne(this,"key",void 0),ne(this,"cache",new qB(aj))}return Qt(e,[{key:"scale",get:function(){return d5}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:QG,fontWeight:JG,characterSet:KG,fontSize:ej,buffer:tj,sdf:!0,cutoff:rj,radius:nj,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var n=this;t.forEach(function(i){n.iconFontGlyphs[i.name]=i.unicode})}},{key:"addIconFont",value:function(t,n){this.iconFontMap.set(t,n)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=tr(tr({},this.fontOptions),t),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(!(i&&n.length===0)){var a=this.generateFontAtlas(this.key,n,i);this.fontAtlas=a,this.cache.set(this.key,a)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,n,i){var a=this.fontOptions,o=a.fontFamily,l=a.fontWeight,c=a.fontSize,p=a.buffer,y=a.sdf,b=a.radius,w=a.cutoff,M=a.iconfont,O=i&&i.data;O||(O=Ho.document.createElement("canvas"),O.width=p5);var N=O.getContext("2d");v5(N,o,c,l);var z=ZG(tr({getFontWidth:function(Rt){return N.measureText(Rt).width},fontHeight:c*d5,buffer:p,characterSet:n,maxCanvasWidth:p5},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),j=z.mapping,Y=z.canvasHeight,K=z.xOffset,ie=z.yOffset,le=N.getImageData(0,0,O.width,O.height);if(O.height=Y,N.putImageData(le,0,0),v5(N,o,c,l),y){var Se=new Rw.exports(c,p,b,w,o,l),ze=N.getImageData(0,0,Se.size,Se.size),ue=f5(n),Ke;try{for(ue.s();!(Ke=ue.n()).done;){var ke=Ke.value;if(M){var Ce=String.fromCharCode(parseInt(ke.replace("&#x","").replace(";",""),16)),je=Se.draw(Ce);m5(je,ze)}else m5(Se.draw(ke),ze);N.putImageData(ze,j[ke].x,j[ke].y)}}catch(St){ue.e(St)}finally{ue.f()}}else{var ve=f5(n),Ie;try{for(ve.s();!(Ie=ve.n()).done;){var dt=Ie.value;N.fillText(dt,j[dt].x,j[dt].y+c*ij)}}catch(St){ve.e(St)}finally{ve.f()}}return{xOffset:K,yOffset:ie,mapping:j,data:O,width:O.width,height:O.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(t,n){var i=this.cache.get(t);if(!i)return n;var a=[],o=i.mapping,l=new Set(Object.keys(o)),c=new Set(n);return c.forEach(function(p){l.has(p)||a.push(p)}),a}}]),e}())||c5),g5,y5;function uj(e){var r=lj();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function lj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cj=3,_5=1024,O_=64,fj=(g5=oa(),g5(y5=function(e){On(t,e);var r=uj(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"canvasHeight",128),ne(vt(n),"texture",void 0),ne(vt(n),"canvas",void 0),ne(vt(n),"iconData",void 0),ne(vt(n),"iconMap",void 0),ne(vt(n),"ctx",void 0),ne(vt(n),"loadingImageCount",0),n}return Qt(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ho.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(i,a){var o=this,l=new Image;if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:O_}),this.updateIconMap(),this.loadImage(a).then(function(c){l=c;var p=o.iconData.find(function(y){return y.id===i});p&&(p.image=l,p.width=l.width,p.height=l.height),o.update()})}},{key:"addImageMini",value:function(i,a,o){var l=this,c=o.getSceneConfig().canvas,p=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:O_}),this.updateIconMap(),this.loadImageMini(a,c).then(function(y){p=y;var b=l.iconData.find(function(w){return w.id===i});b&&(b.image=p,b.width=p.width,b.height=p.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,o){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){o(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=_5,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var o=i.iconMap[a],l=o.x,c=o.y,p=o.image,y=o.width,b=y===void 0?64:y,w=o.height,M=w===void 0?64:w,O=Math.max(b,M),N=O/O_,z=M/N,j=b/N;p&&i.ctx.drawImage(p,l+(O_-j)/2,c+(O_-z)/2,j,z)})}},{key:"updateIconMap",value:function(){var i=YG(this.iconData,cj,_5),a=i.mapping,o=i.canvasHeight;this.iconMap=a,this.canvasHeight=o}},{key:"loadImageMini",value:function(i,a){return new Promise(function(o,l){var c=a.createImage();c.crossOrigin="anonymous",c.onload=function(){o(c)},c.onerror=function(){l(new Error("Could not load image at "+i))},c.src=i})}}]),t}(Zd.exports.EventEmitter))||y5),x5,b5,hj=(x5=oa(),x5(b5=function(){function e(){Kt(this,e),ne(this,"viewport",void 0),ne(this,"overridedViewProjectionMatrix",void 0),ne(this,"jitteredViewProjectionMatrix",void 0),ne(this,"jitteredProjectionMatrix",void 0),ne(this,"viewMatrixInverse",void 0),ne(this,"cameraPosition",void 0)}return Qt(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=kp(),_w(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=Pi(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=eO(kp(),[t,n,0]);this.jitteredProjectionMatrix=fd(kp(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=fd(kp(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||b5),E5,C5;function pj(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=dj(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function dj(e,r){if(!!e){if(typeof e=="string")return S5(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S5(e,r)}}function S5(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var vj=(E5=oa(),E5(C5=function(){function e(){Kt(this,e),ne(this,"container",void 0),ne(this,"controlCorners",void 0),ne(this,"controlContainer",void 0),ne(this,"scene",void 0),ne(this,"mapsService",void 0),ne(this,"controls",[]),ne(this,"unAddControls",[])}return Qt(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Gt.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Gt.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=pj(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=Ul("div",n+"control-container",this.container);function a(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=o.map(function(c){return n+c}).join(" ");t[o.join("")]=Ul("div",l,i)}a(["top","left"]),a(["top","right"]),a(["bottom","left"]),a(["bottom","right"]),a(["top","center"]),a(["right","center"]),a(["left","center"]),a(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&b1(this.controlCorners[t]);this.controlContainer&&b1(this.controlContainer)}}]),e}())||C5),w5,A5,mj=(w5=oa(),w5(A5=function(){function e(){Kt(this,e),ne(this,"container",void 0),ne(this,"scene",void 0),ne(this,"mapsService",void 0),ne(this,"markers",[]),ne(this,"markerLayers",[]),ne(this,"unAddMarkers",[]),ne(this,"unAddMarkerLayers",[])}return Qt(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Gt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||A5),T5,M5,gj=(T5=oa(),T5(M5=function(){function e(){Kt(this,e),ne(this,"scene",void 0),ne(this,"popup",void 0),ne(this,"mapsService",void 0),ne(this,"unAddPopup",void 0)}return Qt(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Gt.IMapService)}}]),e}())||M5),yj={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},I5,L5,_j={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},xj={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},bj=(I5=oa(),I5(L5=function(){function e(){Kt(this,e),ne(this,"sceneConfigCache",{}),ne(this,"layerConfigCache",{})}return Qt(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return yj[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=tr(tr({},_j),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=tr({},Vr.exports.merge({},this.sceneConfigCache[t],xj,i))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||L5);function $i(e,r,t,n){!t||Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function ji(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(o,l){return l(e,r,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}var xE=Math.PI/180,Ej=512,k5=4003e4;function R5(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,o=e.highPrecision,l=o===void 0?!1:o,c=e.flipY,p=c===void 0?!1:c;a=a!==void 0?a:Math.pow(2,i);var y={},b=Ej*a,w=Math.cos(t*xE),M=b/360,O=M/w,N=b/k5/w;if(y.pixelsPerMeter=[N,-N,N],y.metersPerPixel=[1/N,-1/N,1/N],y.pixelsPerDegree=[M,-O,N],y.degreesPerPixel=[1/M,-1/O,1/N],l){var z=xE*Math.tan(t*xE)/w,j=M*z/2,Y=b/k5*z,K=Y/O*N;y.pixelsPerDegree2=[0,-j,Y],y.pixelsPerMeter2=[K,0,K],p&&(y.pixelsPerDegree2[1]=-y.pixelsPerDegree2[1],y.pixelsPerMeter2[1]=-y.pixelsPerMeter2[1])}return p&&(y.pixelsPerMeter[1]=-y.pixelsPerMeter[1],y.metersPerPixel[1]=-y.metersPerPixel[1],y.pixelsPerDegree[1]=-y.pixelsPerDegree[1],y.degreesPerPixel[1]=-y.degreesPerPixel[1]),y}var Uv;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Uv||(Uv={}));var ng={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},O5,P5,F5,bE,D5,Cj=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Sj=(O5=oa(),P5=na(Gt.ICameraService),O5(F5=(bE=function(){function e(){Kt(this,e),ne(this,"needRefresh",!0),$i(this,"cameraService",D5,this),ne(this,"coordinateSystem",void 0),ne(this,"viewportCenter",void 0),ne(this,"viewportCenterProjection",void 0),ne(this,"pixelsPerDegree",void 0),ne(this,"pixelsPerDegree2",void 0),ne(this,"pixelsPerMeter",void 0)}return Qt(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),o=R5({latitude:a[1],zoom:n}),l=o.pixelsPerMeter,c=o.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Uv.LNGLAT||this.coordinateSystem===Uv.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Uv.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===Uv.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var o=R5({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=o.pixelsPerMeter,c=o.pixelsPerDegree,p=o.pixelsPerDegree2,y=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),w=fd([],b,y),M=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=bw([],[M[0],M[1],0,1],w),y=this.cameraService.getViewMatrixUncentered()||y,w=fd([],b,y),w=fd([],w,Cj),this.cameraService.setViewProjectionMatrix(w),this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=p}}]),e}(),D5=ji(bE.prototype,"cameraService",[P5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE))||F5),eP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(r,t,n,i){var a=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,o=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u"),l=a||o,c=["","webkit","Moz","MS","ms","o"],p=l?"":t.createElement("div"),y="function",b=Math.round,w=Math.abs,M=Date.now;function O(se,we,Je){return setTimeout(Se(se,Je),we)}function N(se,we,Je){return Array.isArray(se)?(z(se,Je[we],Je),!0):!1}function z(se,we,Je){var Nt;if(!!se)if(se.forEach)se.forEach(we,Je);else if(se.length!==i)for(Nt=0;Nt<se.length;)we.call(Je,se[Nt],Nt,se),Nt++;else for(Nt in se)se.hasOwnProperty(Nt)&&we.call(Je,se[Nt],Nt,se)}function j(se,we,Je){var Nt="DEPRECATED METHOD: "+we+`
`+Je+` AT 
`;return function(){var Tr=new Error("get-stack-trace"),Un=Tr&&Tr.stack?Tr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Qi=r.console&&(r.console.warn||r.console.log);return Qi&&Qi.call(r.console,Nt,Un),se.apply(this,arguments)}}var Y;typeof Object.assign!="function"?Y=function(we){if(we===i||we===null)throw new TypeError("Cannot convert undefined or null to object");for(var Je=Object(we),Nt=1;Nt<arguments.length;Nt++){var Tr=arguments[Nt];if(Tr!==i&&Tr!==null)for(var Un in Tr)Tr.hasOwnProperty(Un)&&(Je[Un]=Tr[Un])}return Je}:Y=Object.assign;var K=j(function(we,Je,Nt){for(var Tr=Object.keys(Je),Un=0;Un<Tr.length;)(!Nt||Nt&&we[Tr[Un]]===i)&&(we[Tr[Un]]=Je[Tr[Un]]),Un++;return we},"extend","Use `assign`."),ie=j(function(we,Je){return K(we,Je,!0)},"merge","Use `assign`.");function le(se,we,Je){var Nt=we.prototype,Tr;Tr=se.prototype=Object.create(Nt),Tr.constructor=se,Tr._super=Nt,Je&&Y(Tr,Je)}function Se(se,we){return function(){return se.apply(we,arguments)}}function ze(se,we){return typeof se==y?se.apply(we&&we[0]||i,we):se}function ue(se,we){return se===i?we:se}function Ke(se,we,Je){z(ve(we),function(Nt){se.addEventListener(Nt,Je,!1)})}function ke(se,we,Je){z(ve(we),function(Nt){se.removeEventListener(Nt,Je,!1)})}function Ce(se,we){for(;se;){if(se==we)return!0;se=se.parentNode}return!1}function je(se,we){return se.indexOf(we)>-1}function ve(se){return se.trim().split(/\s+/g)}function Ie(se,we,Je){if(se.indexOf&&!Je)return se.indexOf(we);for(var Nt=0;Nt<se.length;){if(Je&&se[Nt][Je]==we||!Je&&se[Nt]===we)return Nt;Nt++}return-1}function dt(se){return Array.prototype.slice.call(se,0)}function St(se,we,Je){for(var Nt=[],Tr=[],Un=0;Un<se.length;){var Qi=we?se[Un][we]:se[Un];Ie(Tr,Qi)<0&&Nt.push(se[Un]),Tr[Un]=Qi,Un++}return Je&&(we?Nt=Nt.sort(function(cs,ko){return cs[we]>ko[we]}):Nt=Nt.sort()),Nt}function Rt(se,we){for(var Je,Nt,Tr=we[0].toUpperCase()+we.slice(1),Un=0;Un<c.length;){if(Je=c[Un],Nt=Je?Je+Tr:we,Nt in se)return Nt;Un++}return i}var $t=1;function gt(){return $t++}function jr(se){var we=se.ownerDocument||se;return we.defaultView||we.parentWindow||r}var Er=/mobile|tablet|ip(ad|hone|od)|android/i,rn="ontouchstart"in r,dn=Rt(r,"PointerEvent")!==i,Rn=rn&&Er.test(navigator.userAgent),Ar="touch",xa="pen",Ti="mouse",Sa="kinect",hr=25,Dr=1,Kn=2,Wt=4,Me=8,Qe=1,Ct=2,Yt=4,qt=8,_r=16,Pr=Ct|Yt,xr=qt|_r,kr=Pr|xr,vr=["x","y"],In=["clientX","clientY"];function W(se,we){var Je=this;this.manager=se,this.callback=we,this.element=se.element,this.target=se.options.inputTarget,this.domHandler=function(Nt){ze(se.options.enable,[se])&&Je.handler(Nt)},this.init()}W.prototype={handler:function(){},init:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(jr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ke(this.element,this.evEl,this.domHandler),this.evTarget&&ke(this.target,this.evTarget,this.domHandler),this.evWin&&ke(jr(this.element),this.evWin,this.domHandler)}};function st(se){var we,Je=se.options.inputClass;return Je?we=Je:dn?we=J:Rn?we=Ve:rn?we=Dt:we=mu,new we(se,zt)}function zt(se,we,Je){var Nt=Je.pointers.length,Tr=Je.changedPointers.length,Un=we&Dr&&Nt-Tr===0,Qi=we&(Wt|Me)&&Nt-Tr===0;Je.isFirst=!!Un,Je.isFinal=!!Qi,Un&&(se.session={}),Je.eventType=we,mr(se,Je),se.emit("hammer.input",Je),se.recognize(Je),se.session.prevInput=Je}function mr(se,we){var Je=se.session,Nt=we.pointers,Tr=Nt.length;Je.firstInput||(Je.firstInput=Mn(we)),Tr>1&&!Je.firstMultiple?Je.firstMultiple=Mn(we):Tr===1&&(Je.firstMultiple=!1);var Un=Je.firstInput,Qi=Je.firstMultiple,Ma=Qi?Qi.center:Un.center,cs=we.center=Wn(Nt);we.timeStamp=M(),we.deltaTime=we.timeStamp-Un.timeStamp,we.angle=mo(Ma,cs),we.distance=mi(Ma,cs),fr(Je,we),we.offsetDirection=Mi(we.deltaX,we.deltaY);var ko=Bn(we.deltaTime,we.deltaX,we.deltaY);we.overallVelocityX=ko.x,we.overallVelocityY=ko.y,we.overallVelocity=w(ko.x)>w(ko.y)?ko.x:ko.y,we.scale=Qi?Ki(Qi.pointers,Nt):1,we.rotation=Qi?ca(Qi.pointers,Nt):0,we.maxPointers=Je.prevInput?we.pointers.length>Je.prevInput.maxPointers?we.pointers.length:Je.prevInput.maxPointers:we.pointers.length,nn(Je,we);var Ia=se.element;Ce(we.srcEvent.target,Ia)&&(Ia=we.srcEvent.target),we.target=Ia}function fr(se,we){var Je=we.center,Nt=se.offsetDelta||{},Tr=se.prevDelta||{},Un=se.prevInput||{};(we.eventType===Dr||Un.eventType===Wt)&&(Tr=se.prevDelta={x:Un.deltaX||0,y:Un.deltaY||0},Nt=se.offsetDelta={x:Je.x,y:Je.y}),we.deltaX=Tr.x+(Je.x-Nt.x),we.deltaY=Tr.y+(Je.y-Nt.y)}function nn(se,we){var Je=se.lastInterval||we,Nt=we.timeStamp-Je.timeStamp,Tr,Un,Qi,Ma;if(we.eventType!=Me&&(Nt>hr||Je.velocity===i)){var cs=we.deltaX-Je.deltaX,ko=we.deltaY-Je.deltaY,Ia=Bn(Nt,cs,ko);Un=Ia.x,Qi=Ia.y,Tr=w(Ia.x)>w(Ia.y)?Ia.x:Ia.y,Ma=Mi(cs,ko),se.lastInterval=we}else Tr=Je.velocity,Un=Je.velocityX,Qi=Je.velocityY,Ma=Je.direction;we.velocity=Tr,we.velocityX=Un,we.velocityY=Qi,we.direction=Ma}function Mn(se){for(var we=[],Je=0;Je<se.pointers.length;)we[Je]={clientX:b(se.pointers[Je].clientX),clientY:b(se.pointers[Je].clientY)},Je++;return{timeStamp:M(),pointers:we,center:Wn(we),deltaX:se.deltaX,deltaY:se.deltaY}}function Wn(se){var we=se.length;if(we===1)return{x:b(se[0].clientX),y:b(se[0].clientY)};for(var Je=0,Nt=0,Tr=0;Tr<we;)Je+=se[Tr].clientX,Nt+=se[Tr].clientY,Tr++;return{x:b(Je/we),y:b(Nt/we)}}function Bn(se,we,Je){return{x:we/se||0,y:Je/se||0}}function Mi(se,we){return se===we?Qe:w(se)>=w(we)?se<0?Ct:Yt:we<0?qt:_r}function mi(se,we,Je){Je||(Je=vr);var Nt=we[Je[0]]-se[Je[0]],Tr=we[Je[1]]-se[Je[1]];return Math.sqrt(Nt*Nt+Tr*Tr)}function mo(se,we,Je){Je||(Je=vr);var Nt=we[Je[0]]-se[Je[0]],Tr=we[Je[1]]-se[Je[1]];return Math.atan2(Tr,Nt)*180/Math.PI}function ca(se,we){return mo(we[1],we[0],In)+mo(se[1],se[0],In)}function Ki(se,we){return mi(we[0],we[1],In)/mi(se[0],se[1],In)}var yl={mousedown:Dr,mousemove:Kn,mouseup:Wt},Xi="mousedown",nu="mousemove mouseup";function mu(){this.evEl=Xi,this.evWin=nu,this.pressed=!1,W.apply(this,arguments)}le(mu,W,{handler:function(we){var Je=yl[we.type];Je&Dr&&we.button===0&&(this.pressed=!0),Je&Kn&&we.which!==1&&(Je=Wt),this.pressed&&(Je&Wt&&(this.pressed=!1),this.callback(this.manager,Je,{pointers:[we],changedPointers:[we],pointerType:Ti,srcEvent:we}))}});var iu={pointerdown:Dr,pointermove:Kn,pointerup:Wt,pointercancel:Me,pointerout:Me},pf={2:Ar,3:xa,4:Ti,5:Sa},Fu="pointerdown",uo="pointermove pointerup pointercancel";!l&&r.MSPointerEvent&&!r.PointerEvent&&(Fu="MSPointerDown",uo="MSPointerMove MSPointerUp MSPointerCancel");function J(){this.evEl=Fu,this.evWin=uo,W.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}le(J,W,{handler:function(we){var Je=this.store,Nt=!1,Tr=we.type.toLowerCase().replace("ms",""),Un=iu[Tr],Qi=pf[we.pointerType]||we.pointerType,Ma=Qi==Ar,cs=Ie(Je,we.pointerId,"pointerId");Un&Dr&&(we.button===0||Ma)?cs<0&&(Je.push(we),cs=Je.length-1):Un&(Wt|Me)&&(Nt=!0),!(cs<0)&&(Je[cs]=we,this.callback(this.manager,Un,{pointers:Je,changedPointers:[we],pointerType:Qi,srcEvent:we}),Nt&&Je.splice(cs,1))}});var ae={touchstart:Dr,touchmove:Kn,touchend:Wt,touchcancel:Me},ce="touchstart",be="touchstart touchmove touchend touchcancel";function Be(){this.evTarget=ce,this.evWin=be,this.started=!1,W.apply(this,arguments)}le(Be,W,{handler:function(we){var Je=ae[we.type];if(Je===Dr&&(this.started=!0),!!this.started){var Nt=et.call(this,we,Je);Je&(Wt|Me)&&Nt[0].length-Nt[1].length===0&&(this.started=!1),this.callback(this.manager,Je,{pointers:Nt[0],changedPointers:Nt[1],pointerType:Ar,srcEvent:we})}}});function et(se,we){var Je=dt(se.touches),Nt=dt(se.changedTouches);return we&(Wt|Me)&&(Je=St(Je.concat(Nt),"identifier",!0)),[Je,Nt]}var ot={touchstart:Dr,touchmove:Kn,touchend:Wt,touchcancel:Me},ge="touchstart touchmove touchend touchcancel";function Ve(){this.evTarget=ge,this.targetIds={},W.apply(this,arguments)}le(Ve,W,{handler:function(we){var Je=ot[we.type],Nt=mt.call(this,we,Je);!Nt||this.callback(this.manager,Je,{pointers:Nt[0],changedPointers:Nt[1],pointerType:Ar,srcEvent:we})}});function mt(se,we){var Je=dt(se.touches),Nt=this.targetIds;if(we&(Dr|Kn)&&Je.length===1)return Nt[Je[0].identifier]=!0,[Je,Je];var Tr,Un,Qi=dt(se.changedTouches),Ma=[],cs=this.target;if(Un=Je.filter(function(ko){return Ce(ko.target,cs)}),we===Dr)for(Tr=0;Tr<Un.length;)Nt[Un[Tr].identifier]=!0,Tr++;for(Tr=0;Tr<Qi.length;)Nt[Qi[Tr].identifier]&&Ma.push(Qi[Tr]),we&(Wt|Me)&&delete Nt[Qi[Tr].identifier],Tr++;if(!!Ma.length)return[St(Un.concat(Ma),"identifier",!0),Ma]}var Jt=2500,Cr=25;function Dt(){W.apply(this,arguments);var se=Se(this.handler,this);this.touch=new Ve(this.manager,se),this.mouse=new mu(this.manager,se),this.primaryTouch=null,this.lastTouches=[]}le(Dt,W,{handler:function(we,Je,Nt){var Tr=Nt.pointerType==Ar,Un=Nt.pointerType==Ti;if(!(Un&&Nt.sourceCapabilities&&Nt.sourceCapabilities.firesTouchEvents)){if(Tr)pr.call(this,Je,Nt);else if(Un&&xn.call(this,Nt))return;this.callback(we,Je,Nt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function pr(se,we){se&Dr?(this.primaryTouch=we.changedPointers[0].identifier,Nr.call(this,we)):se&(Wt|Me)&&Nr.call(this,we)}function Nr(se){var we=se.changedPointers[0];if(we.identifier===this.primaryTouch){var Je={x:we.clientX,y:we.clientY};this.lastTouches.push(Je);var Nt=this.lastTouches,Tr=function(){var Un=Nt.indexOf(Je);Un>-1&&Nt.splice(Un,1)};setTimeout(Tr,Jt)}}function xn(se){for(var we=se.srcEvent.clientX,Je=se.srcEvent.clientY,Nt=0;Nt<this.lastTouches.length;Nt++){var Tr=this.lastTouches[Nt],Un=Math.abs(we-Tr.x),Qi=Math.abs(Je-Tr.y);if(Un<=Cr&&Qi<=Cr)return!0}return!1}var Bt=l?i:Rt(p.style,"touchAction"),ln=Bt!==i,Wr="compute",Zr="auto",gi="manipulation",Jr="none",bi="pan-x",ci="pan-y",Ci=ls();function Fi(se,we){this.manager=se,this.set(we)}Fi.prototype={set:function(se){se==Wr&&(se=this.compute()),ln&&this.manager.element.style&&Ci[se]&&(this.manager.element.style[Bt]=se),this.actions=se.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var se=[];return z(this.manager.recognizers,function(we){ze(we.options.enable,[we])&&(se=se.concat(we.getTouchAction()))}),Di(se.join(" "))},preventDefaults:function(se){var we=se.srcEvent,Je=se.offsetDirection;if(this.manager.session.prevented){we.preventDefault();return}var Nt=this.actions,Tr=je(Nt,Jr)&&!Ci[Jr],Un=je(Nt,ci)&&!Ci[ci],Qi=je(Nt,bi)&&!Ci[bi];if(Tr){var Ma=se.pointers.length===1,cs=se.distance<2,ko=se.deltaTime<250;if(Ma&&cs&&ko)return}if(!(Qi&&Un)&&(Tr||Un&&Je&Pr||Qi&&Je&xr))return this.preventSrc(we)},preventSrc:function(se){this.manager.session.prevented=!0,se.preventDefault()}};function Di(se){if(je(se,Jr))return Jr;var we=je(se,bi),Je=je(se,ci);return we&&Je?Jr:we||Je?we?bi:ci:je(se,gi)?gi:Zr}function ls(){if(!ln)return!1;var se={};if(l)return se;var we=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Je){se[Je]=we?r.CSS.supports("touch-action",Je):!0}),se}var sa=1,Zi=2,ia=4,pi=8,Li=pi,go=16,pa=32;function Za(se){this.options=Y({},this.defaults,se||{}),this.id=gt(),this.manager=null,this.options.enable=ue(this.options.enable,!0),this.state=sa,this.simultaneous={},this.requireFail=[]}Za.prototype={defaults:{},set:function(se){return Y(this.options,se),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(se){if(N(se,"recognizeWith",this))return this;var we=this.simultaneous;return se=Hl(se,this),we[se.id]||(we[se.id]=se,se.recognizeWith(this)),this},dropRecognizeWith:function(se){return N(se,"dropRecognizeWith",this)?this:(se=Hl(se,this),delete this.simultaneous[se.id],this)},requireFailure:function(se){if(N(se,"requireFailure",this))return this;var we=this.requireFail;return se=Hl(se,this),Ie(we,se)===-1&&(we.push(se),se.requireFailure(this)),this},dropRequireFailure:function(se){if(N(se,"dropRequireFailure",this))return this;se=Hl(se,this);var we=Ie(this.requireFail,se);return we>-1&&this.requireFail.splice(we,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(se){return!!this.simultaneous[se.id]},emit:function(se){var we=this,Je=this.state;function Nt(Tr){we.manager.emit(Tr,se)}Je<pi&&Nt(we.options.event+da(Je)),Nt(we.options.event),se.additionalEvent&&Nt(se.additionalEvent),Je>=pi&&Nt(we.options.event+da(Je))},tryEmit:function(se){if(this.canEmit())return this.emit(se);this.state=pa},canEmit:function(){for(var se=0;se<this.requireFail.length;){if(!(this.requireFail[se].state&(pa|sa)))return!1;se++}return!0},recognize:function(se){var we=Y({},se);if(!ze(this.options.enable,[this,we])){this.reset(),this.state=pa;return}this.state&(Li|go|pa)&&(this.state=sa),this.state=this.process(we),this.state&(Zi|ia|pi|go)&&this.tryEmit(we)},process:function(se){},getTouchAction:function(){},reset:function(){}};function da(se){return se&go?"cancel":se&pi?"end":se&ia?"move":se&Zi?"start":""}function Xf(se){return se==_r?"down":se==qt?"up":se==Ct?"left":se==Yt?"right":""}function Hl(se,we){var Je=we.manager;return Je?Je.get(se):se}function ki(){Za.apply(this,arguments)}le(ki,Za,{defaults:{pointers:1},attrTest:function(se){var we=this.options.pointers;return we===0||se.pointers.length===we},process:function(se){var we=this.state,Je=se.eventType,Nt=we&(Zi|ia),Tr=this.attrTest(se);return Nt&&(Je&Me||!Tr)?we|go:Nt||Tr?Je&Wt?we|pi:we&Zi?we|ia:Zi:pa}});function oc(){ki.apply(this,arguments),this.pX=null,this.pY=null}le(oc,ki,{defaults:{event:"pan",threshold:10,pointers:1,direction:kr},getTouchAction:function(){var se=this.options.direction,we=[];return se&Pr&&we.push(ci),se&xr&&we.push(bi),we},directionTest:function(se){var we=this.options,Je=!0,Nt=se.distance,Tr=se.direction,Un=se.deltaX,Qi=se.deltaY;return Tr&we.direction||(we.direction&Pr?(Tr=Un===0?Qe:Un<0?Ct:Yt,Je=Un!=this.pX,Nt=Math.abs(se.deltaX)):(Tr=Qi===0?Qe:Qi<0?qt:_r,Je=Qi!=this.pY,Nt=Math.abs(se.deltaY))),se.direction=Tr,Je&&Nt>we.threshold&&Tr&we.direction},attrTest:function(se){return ki.prototype.attrTest.call(this,se)&&(this.state&Zi||!(this.state&Zi)&&this.directionTest(se))},emit:function(se){this.pX=se.deltaX,this.pY=se.deltaY;var we=Xf(se.direction);we&&(se.additionalEvent=this.options.event+we),this._super.emit.call(this,se)}});function ns(){ki.apply(this,arguments)}le(ns,ki,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Jr]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.scale-1)>this.options.threshold||this.state&Zi)},emit:function(se){if(se.scale!==1){var we=se.scale<1?"in":"out";se.additionalEvent=this.options.event+we}this._super.emit.call(this,se)}});function Ya(){Za.apply(this,arguments),this._timer=null,this._input=null}le(Ya,Za,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zr]},process:function(se){var we=this.options,Je=se.pointers.length===we.pointers,Nt=se.distance<we.threshold,Tr=se.deltaTime>we.time;if(this._input=se,!Nt||!Je||se.eventType&(Wt|Me)&&!Tr)this.reset();else if(se.eventType&Dr)this.reset(),this._timer=O(function(){this.state=Li,this.tryEmit()},we.time,this);else if(se.eventType&Wt)return Li;return pa},reset:function(){clearTimeout(this._timer)},emit:function(se){this.state===Li&&(se&&se.eventType&Wt?this.manager.emit(this.options.event+"up",se):(this._input.timeStamp=M(),this.manager.emit(this.options.event,this._input)))}});function yo(){ki.apply(this,arguments)}le(yo,ki,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Jr]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.rotation)>this.options.threshold||this.state&Zi)}});function Da(){ki.apply(this,arguments)}le(Da,ki,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Pr|xr,pointers:1},getTouchAction:function(){return oc.prototype.getTouchAction.call(this)},attrTest:function(se){var we=this.options.direction,Je;return we&(Pr|xr)?Je=se.overallVelocity:we&Pr?Je=se.overallVelocityX:we&xr&&(Je=se.overallVelocityY),this._super.attrTest.call(this,se)&&we&se.offsetDirection&&se.distance>this.options.threshold&&se.maxPointers==this.options.pointers&&w(Je)>this.options.velocity&&se.eventType&Wt},emit:function(se){var we=Xf(se.offsetDirection);we&&this.manager.emit(this.options.event+we,se),this.manager.emit(this.options.event,se)}});function ks(){Za.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}le(ks,Za,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[gi]},process:function(se){var we=this.options,Je=se.pointers.length===we.pointers,Nt=se.distance<we.threshold,Tr=se.deltaTime<we.time;if(this.reset(),se.eventType&Dr&&this.count===0)return this.failTimeout();if(Nt&&Tr&&Je){if(se.eventType!=Wt)return this.failTimeout();var Un=this.pTime?se.timeStamp-this.pTime<we.interval:!0,Qi=!this.pCenter||mi(this.pCenter,se.center)<we.posThreshold;this.pTime=se.timeStamp,this.pCenter=se.center,!Qi||!Un?this.count=1:this.count+=1,this._input=se;var Ma=this.count%we.taps;if(Ma===0)return this.hasRequireFailures()?(this._timer=O(function(){this.state=Li,this.tryEmit()},we.interval,this),Zi):Li}return pa},failTimeout:function(){return this._timer=O(function(){this.state=pa},this.options.interval,this),pa},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Li&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function qa(se,we){return we=we||{},we.recognizers=ue(we.recognizers,qa.defaults.preset),new df(se,we)}qa.VERSION="2.0.7",qa.defaults={domEvents:!1,touchAction:Wr,enable:!0,inputTarget:null,inputClass:null,preset:[[yo,{enable:!1}],[ns,{enable:!1},["rotate"]],[Da,{direction:Pr}],[oc,{direction:Pr},["swipe"]],[ks],[ks,{event:"doubletap",taps:2},["tap"]],[Ya]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Rc=1,Rs=2;function df(se,we){this.options=Y({},qa.defaults,we||{}),this.options.inputTarget=this.options.inputTarget||se,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=se,this.input=st(this),this.touchAction=new Fi(this,this.options.touchAction),Os(this,!0),z(this.options.recognizers,function(Je){var Nt=this.add(new Je[0](Je[1]));Je[2]&&Nt.recognizeWith(Je[2]),Je[3]&&Nt.requireFailure(Je[3])},this)}df.prototype={set:function(se){return Y(this.options,se),se.touchAction&&this.touchAction.update(),se.inputTarget&&(this.input.destroy(),this.input.target=se.inputTarget,this.input.init()),this},stop:function(se){this.session.stopped=se?Rs:Rc},recognize:function(se){var we=this.session;if(!we.stopped){this.touchAction.preventDefaults(se);var Je,Nt=this.recognizers,Tr=we.curRecognizer;(!Tr||Tr&&Tr.state&Li)&&(Tr=we.curRecognizer=null);for(var Un=0;Un<Nt.length;)Je=Nt[Un],we.stopped!==Rs&&(!Tr||Je==Tr||Je.canRecognizeWith(Tr))?Je.recognize(se):Je.reset(),!Tr&&Je.state&(Zi|ia|pi)&&(Tr=we.curRecognizer=Je),Un++}},get:function(se){if(se instanceof Za)return se;for(var we=this.recognizers,Je=0;Je<we.length;Je++)if(we[Je].options.event==se)return we[Je];return null},add:function(se){if(N(se,"add",this))return this;var we=this.get(se.options.event);return we&&this.remove(we),this.recognizers.push(se),se.manager=this,this.touchAction.update(),se},remove:function(se){if(N(se,"remove",this))return this;if(se=this.get(se),se){var we=this.recognizers,Je=Ie(we,se);Je!==-1&&(we.splice(Je,1),this.touchAction.update())}return this},on:function(se,we){if(se!==i&&we!==i){var Je=this.handlers;return z(ve(se),function(Nt){Je[Nt]=Je[Nt]||[],Je[Nt].push(we)}),this}},off:function(se,we){if(se!==i){var Je=this.handlers;return z(ve(se),function(Nt){we?Je[Nt]&&Je[Nt].splice(Ie(Je[Nt],we),1):delete Je[Nt]}),this}},emit:function(se,we){this.options.domEvents&&Ha(se,we);var Je=this.handlers[se]&&this.handlers[se].slice();if(!(!Je||!Je.length)){we.type=se,we.preventDefault=function(){we.srcEvent.preventDefault()};for(var Nt=0;Nt<Je.length;)Je[Nt](we),Nt++}},destroy:function(){this.element&&Os(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Os(se,we){var Je=se.element;if(!!Je.style){var Nt;z(se.options.cssProps,function(Tr,Un){Nt=Rt(Je.style,Un),we?(se.oldCssProps[Nt]=Je.style[Nt],Je.style[Nt]=Tr):Je.style[Nt]=se.oldCssProps[Nt]||""}),we||(se.oldCssProps={})}}function Ha(se,we){if(!l){var Je=t.createEvent("Event");Je.initEvent(se,!0,!0),Je.gesture=we,we.target.dispatchEvent(Je)}}if(!l){Y(qa,{INPUT_START:Dr,INPUT_MOVE:Kn,INPUT_END:Wt,INPUT_CANCEL:Me,STATE_POSSIBLE:sa,STATE_BEGAN:Zi,STATE_CHANGED:ia,STATE_ENDED:pi,STATE_RECOGNIZED:Li,STATE_CANCELLED:go,STATE_FAILED:pa,DIRECTION_NONE:Qe,DIRECTION_LEFT:Ct,DIRECTION_RIGHT:Yt,DIRECTION_UP:qt,DIRECTION_DOWN:_r,DIRECTION_HORIZONTAL:Pr,DIRECTION_VERTICAL:xr,DIRECTION_ALL:kr,Manager:df,Input:W,TouchAction:Fi,TouchInput:Ve,MouseInput:mu,PointerEventInput:J,TouchMouseInput:Dt,SingleTouchInput:Be,Recognizer:Za,AttrRecognizer:ki,Tap:ks,Pan:oc,Swipe:Da,Pinch:ns,Rotate:yo,Press:Ya,on:Ke,off:ke,each:z,merge:ie,extend:K,assign:Y,inherit:le,bindFn:Se,prefixed:Rt});var Ps=typeof window<"u"?window:typeof self<"u"?self:{};Ps.Hammer=qa,typeof i=="function"&&i.amd?i(function(){return qa}):e.exports?e.exports=qa:r[n]=qa}})(typeof window<"u"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")})(eP);const P_=eP.exports;var uf;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(uf||(uf={}));var B5,N5,z5,EE,U5;function wj(e){var r=Aj();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Aj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tj={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Mj=(B5=oa(),N5=na(Gt.IMapService),B5(z5=(EE=function(e){On(t,e);var r=wj(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"indragging",!1),$i(vt(n),"mapService",U5,vt(n)),ne(vt(n),"hammertime",void 0),ne(vt(n),"lastClickTime",0),ne(vt(n),"lastClickXY",[-1,-1]),ne(vt(n),"clickTimer",void 0),ne(vt(n),"$containter",void 0),ne(vt(n),"onDrag",function(l){var c=n.interactionEvent(l);c.type=Tj[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(uf.Drag,c)}),ne(vt(n),"onHammer",function(l){l.srcEvent.stopPropagation();var c=n.interactionEvent(l);n.emit(uf.Hover,c)}),ne(vt(n),"onTouch",function(l){var c=l.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),ne(vt(n),"onHover",function(l){var c=l.clientX,p=l.clientY,y=c,b=p,w=l.type,M=n.mapService.getMapContainer();if(M)if(Zh)y=y-M.left-0,b=b-M.top-0;else{var O=M.getBoundingClientRect(),N=O.top,z=O.left;y=y-z-M.clientLeft,b=b-N-M.clientTop}var j=n.mapService.containerToLngLat([y,b]);if(w==="click"){if(!Zh&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(y,b,j);return}if(w==="touch"){n.isDoubleTap(y,b,j);return}w!=="click"&&w!=="dblclick"&&n.emit(uf.Hover,{x:y,y:b,lngLat:j,type:w,target:l})}),n}return Qt(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(uf.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,o=i.y;this.emit(uf.Hover,{x:a,y:o})}},{key:"triggerSelect",value:function(i){this.emit(uf.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(uf.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i)if(Zh)Ho.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=new P_.Manager(i);a.add(new P_.Tap({event:"dblclick",taps:2})),a.add(new P_.Tap({event:"click"})),a.add(new P_.Pan({threshold:0,pointers:0})),a.add(new P_.Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){if(Zh)Ho.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(i){var a=i.type,o=i.pointerType,l,c;o==="touch"?(c=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var p=this.mapService.getMapContainer();if(p){var y=p.getBoundingClientRect(),b=y.top,w=y.left;l-=w,c-=b}var M=this.mapService.containerToLngLat([l,c]);return{x:l,y:c,lngLat:M,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,o){var l=this,c=new Date().getTime(),p="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),p="dblclick",this.emit(uf.Hover,{x:i,y:a,lngLat:o,type:p})):(this.lastClickTime=c,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){p="click",l.emit(uf.Hover,{x:i,y:a,lngLat:o,type:p})},400))}}]),t}(Sw),U5=ji(EE.prototype,"mapService",[N5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE))||z5),Ij=0;function Lj(e){if(Zh)return null;var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Ij++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function kj(e){var r,t,n=!0;return e==null||(r=e.target)===null||r===void 0||(t=r.path)===null||t===void 0||t.map(function(i){if(i!=null&&i.classList){var a;i==null||(a=i.classList)===null||a===void 0||a.forEach(function(o){(o==="l7-marker"||o==="l7-popup")&&(n=!1)})}}),n}var Q;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Q||(Q={}));var V5,G5,j5,H5,W5,$5,X5,ig,Z5,Y5,q5,K5,Q5,Rj=(V5=oa(),G5=na(Gt.IMapService),j5=na(Gt.IRendererService),H5=na(Gt.IGlobalConfigService),W5=na(Gt.IInteractionService),$5=na(Gt.ILayerService),V5(X5=(ig=function(){function e(){var r=this;Kt(this,e),ne(this,"pickedColors",void 0),ne(this,"pickedTileLayers",[]),$i(this,"mapService",Z5,this),$i(this,"rendererService",Y5,this),$i(this,"configService",q5,this),$i(this,"interactionService",K5,this),$i(this,"layerService",Q5,this),ne(this,"pickingFBO",void 0),ne(this,"width",0),ne(this,"height",0),ne(this,"alreadyInPicking",!1),ne(this,"pickBufferScale",1),ne(this,"pickedLayers",[]),ne(this,"pickFromPickingFBO",function(t,n){var i=n.x,a=n.y,o=n.lngLat,l=n.type,c=n.target,p=!1,y=r.rendererService,b=y.readPixels,w=y.getContainer,M=r.getContainerSize(w()),O=M.width,N=M.height;O*=Ou,N*=Ou;var z=t.getLayerConfig(),j=z.enableHighlight,Y=z.enableSelect,K=i*Ou,ie=a*Ou;if(K>O-1*Ou||K<0||ie>N-1*Ou||ie<0)return!1;var le=b({x:Math.floor(K/r.pickBufferScale),y:Math.floor((N-(a+1)*Ou)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=le,le[0]!==0||le[1]!==0||le[2]!==0){var Se=Nv(le),ze=t.getSource().getFeatureById(Se);Se!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var ue={x:i,y:a,type:l,lngLat:o,featureId:Se,feature:ze,target:c};ze&&(p=!0,t.setCurrentPickId(Se),r.pickedLayers=[t],r.triggerHoverOnLayer(t,ue))}else{var Ke={x:i,y:a,lngLat:o,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:c,feature:null};r.triggerHoverOnLayer(t,tr(tr({},Ke),{},{type:"unpick"})),r.triggerHoverOnLayer(t,Ke),t.setCurrentPickId(null),r.pickedLayers=[]}if(j&&r.highlightPickedFeature(t,le),Y&&l==="click"&&(le==null?void 0:le.toString())!==[0,0,0,0].toString()){var ke=Nv(le);t.getCurrentSelectedId()===null||ke!==t.getCurrentSelectedId()?(r.selectFeature(t,le),t.setCurrentSelectedId(ke)):(r.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||r.layerService.getLayers().filter(function(Ce){return Ce.tileLayer}).map(function(Ce){Ce.tileLayer.clearPickState()})}return p})}return Qt(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,o=n.getContainer,l=this.getContainerSize(o()),c=l.width,p=l.height;c*=Ou,p*=Ou,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(c/this.pickBufferScale),height:Math.round(p/this.pickBufferScale),wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.interactionService.on(uf.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=eo(Xn.mark(function n(i,a,o){var l=this,c,p,y;return Xn.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:c=this.rendererService,p=c.useFramebuffer,y=c.clear,c.getContainer,this.resizePickingFBO(),p(this.pickingFBO,function(){y({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels(),i.hooks.afterPickingEncode.call();var M=l.pickBox(i,a);o(M)});case 3:case"end":return w.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(ke){var Ce=ke<0?0:ke;return Math.floor(Ce*Ou/i.pickBufferScale)}),o=Pi(a,4),l=o[0],c=o[1],p=o[2],y=o[3],b=this.rendererService,w=b.readPixels,M=b.getContainer,O=this.getContainerSize(M()),N=O.width,z=O.height;if(N*=Ou,z*=Ou,l>(N-1)*Ou/this.pickBufferScale||p<0||c>(z-1)*Ou/this.pickBufferScale||y<0)return[];for(var j=Math.min(N/this.pickBufferScale,p)-l,Y=Math.min(z/this.pickBufferScale,y)-c,K=w({x:l,y:Math.floor(z/this.pickBufferScale-(y+1)),width:j,height:Y,data:new Uint8Array(j*Y*4),framebuffer:this.pickingFBO}),ie=[],le={},Se=0;Se<K.length/4;Se=Se+1){var ze=K.slice(Se*4,Se*4+4),ue=Nv(ze);if(ue!==-1&&!le[ue]){var Ke=t.getSource().getFeatureById(ue);ie.push(tr(tr({},Ke),{},{pickedFeatureIdx:ue})),le[ue]=!0}}return ie}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,o=a===void 0?"":a,l=i.cursorEnabled;if(l){var c=this.mapService.version,p=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),y=p==null?void 0:p.style.getPropertyValue("cursor");n==="unmousemove"&&y!==""?p==null||p.style.setProperty("cursor",""):n==="mousemove"&&(p==null||p.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Ou,height:t.height/Ou}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=eo(Xn.mark(function n(i){return Xn.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=Ou,a*=Ou,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=eo(Xn.mark(function n(i){var a=this,o,l,c;return Xn.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:o=this.rendererService,o.getViewportSize,l=o.useFramebuffer,c=o.clear,o.getContainer,this.resizePickingFBO(),l(this.pickingFBO,function(){var b=a.layerService.getRenderList();b.filter(function(w){return w.needPick(i.type)}).reverse().some(function(w){if(c({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.pickedLayers.filter(function(O){return!O.isVector}).map(function(O){a.selectFeature(O,new Uint8Array([0,0,0,0]))}),a.pickedTileLayers.map(function(O){var N;return(N=O.tileLayer)===null||N===void 0?void 0:N.clearPick(i.type)}),w.tileLayer)return w.tileLayer.pickLayers(i);w.hooks.beforePickingEncode.call(),w.masks.length>0&&w.masks.map(function(O){O.hooks.beforeRenderData.call(),O.hooks.beforeRender.call(),O.render(),O.hooks.afterRender.call()}),w.renderModels(!0),w.hooks.afterPickingEncode.call();var M=a.pickFromPickingFBO(w,i);return a.layerService.pickedLayerId=M?+w.id:-1,M&&!w.getLayerConfig().enablePropagation})});case 3:case"end":return y.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){kj(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(t,n){var i=Pi(n,3),a=i[0],o=i[1],l=i[2];t.hooks.beforeHighlight.call([a,o,l])}},{key:"selectFeature",value:function(t,n){var i=Pi(n,3),a=i[0],o=i[1],l=i[2];t.hooks.beforeSelect.call([a,o,l])}}]),e}(),Z5=ji(ig.prototype,"mapService",[G5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y5=ji(ig.prototype,"rendererService",[j5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q5=ji(ig.prototype,"configService",[H5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K5=ji(ig.prototype,"interactionService",[W5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q5=ji(ig.prototype,"layerService",[$5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig))||X5),Oj=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;Kt(this,e),ne(this,"autoStart",void 0),ne(this,"startTime",0),ne(this,"oldTime",0),ne(this,"running",!1),ne(this,"elapsedTime",0),this.autoStart=r}return Qt(e,[{key:"start",value:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance>"u"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),J5,eM,tM,rM,nM,F_,iM,aM,oM;function Pj(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Fj(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Fj(e,r){if(!!e){if(typeof e=="string")return sM(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sM(e,r)}}function sM(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Dj=(J5=oa(),eM=na(Gt.IRendererService),tM=na(Gt.IMapService),rM=na(Gt.IGlobalConfigService),J5(nM=(F_=function(){function e(){Kt(this,e),ne(this,"pickedLayerId",-1),ne(this,"clock",new Oj),ne(this,"alreadyInRendering",!1),ne(this,"layers",[]),ne(this,"layerList",[]),ne(this,"layerRenderID",void 0),ne(this,"sceneInited",!1),ne(this,"animateInstanceCount",0),ne(this,"shaderPicking",!0),ne(this,"enableRender",!0),$i(this,"renderService",iM,this),$i(this,"mapService",aM,this),$i(this,"configService",oM,this)}return Qt(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(n){return n.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(n){return n.name===t})}},{key:"cleanRemove",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=this.layers.indexOf(t);i>-1&&this.layers.splice(i,1),n&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,n){if(n){var i=n.layerChildren.indexOf(t);i>-1&&n.layerChildren.splice(i,1)}else{var a=this.layers.indexOf(t);a>-1&&this.layers.splice(a,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var r=eo(Xn.mark(function n(){var i,a,o;return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){c.next=2;break}return c.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),i=Pj(this.layerList),c.prev=5,i.s();case 7:if((a=i.n()).done){c.next=21;break}if(o=a.value,o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(p){p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.render(),p.hooks.afterRender.call()})),!o.getLayerConfig().enableMultiPassRenderer){c.next=17;break}return c.next=15,o.renderMultiPass();case 15:c.next=18;break;case 17:o.render();case 18:o.hooks.afterRender.call();case 19:c.next=7;break;case 21:c.next=26;break;case 23:c.prev=23,c.t0=c.catch(5),i.e(c.t0);case 26:return c.prev=26,i.f(),c.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return c.stop()}},n,this,[[5,23,26,29]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,i){return n.zIndex-i.zIndex}).forEach(function(n){t.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Lo(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ho.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ho.cancelAnimationFrame(this.layerRenderID)}}]),e}(),iM=ji(F_.prototype,"renderService",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aM=ji(F_.prototype,"mapService",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oM=ji(F_.prototype,"configService",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_))||nM);function Bj(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}function b0(e,r){if(e==null)return{};var t=Bj(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}var Nj=function(){function e(r){var t=this;Kt(this,e),ne(this,"name",void 0),ne(this,"type",void 0),ne(this,"scale",void 0),ne(this,"descriptor",void 0),ne(this,"featureBufferLayout",[]),ne(this,"needRescale",!1),ne(this,"needRemapping",!1),ne(this,"needRegenerateVertices",!1),ne(this,"featureRange",{startIndex:0,endIndex:1/0}),ne(this,"vertexAttribute",void 0),ne(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,o){var l,c=(l=t.scale)===null||l===void 0?void 0:l.scalers[o].func,p=c(a);return p})}),this.setProps(r)}return Qt(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,zn(t));if(!Vr.exports.isNil(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),zj=["modelType"],Uj=["buffer","update","name"],Vj=["buffer","update","name"],Gj=["buffer","update","name"],D_,uM,lM,cM,CE,fM,jj=(D_={},ne(D_,Q.FLOAT,4),ne(D_,Q.UNSIGNED_BYTE,1),ne(D_,Q.UNSIGNED_SHORT,2),D_),Hj=(uM=oa(),lM=na(Gt.IRendererService),uM(cM=(CE=function(){function e(){Kt(this,e),ne(this,"attributesAndIndices",void 0),$i(this,"rendererService",fM,this),ne(this,"attributes",[]),ne(this,"triangulation",void 0),ne(this,"featureLayout",{sizePerElement:0,elements:[]})}return Qt(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Nj(t),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute(tr(tr({},n),{},{name:t})));var o=n.scale;o&&a&&(a.scale=o,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,o=this.attributes.find(function(ie){return ie.name===t});if(o&&o.descriptor){var l=o.descriptor,c=l.update,p=l.buffer,y=l.size,b=y===void 0?0:y,w=jj[p.type||Q.FLOAT];if(c){var M=this.featureLayout,O=M.elements,N=M.sizePerElement,z=O.slice(i,a);if(!z.length)return;var j=z[0].offset,Y=j*b*w,K=z.map(function(ie,le){for(var Se=ie.featureIdx,ze=ie.vertices,ue=ie.normals,Ke=ze.length/N,ke=[],Ce=0;Ce<Ke;Ce++){var je=ue?ue.slice(Ce*3,Ce*3+3):[];ke.push.apply(ke,zn(c(n[Se],Se,ze.slice(Ce*N,Ce*N+N),le,je)))}return ke}).reduce(function(ie,le){return ie.push.apply(ie,zn(le)),ie},[]);o.vertexAttribute.updateBuffer({data:K,offset:Y})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]};var o=this.attributes.map(function(O){return O.resetDescriptor(),O.descriptor}).filter(function(O){return O}),l=i.modelType,c=b0(i,zj),p=this.rendererService,y=p.createAttribute,b=p.createBuffer,w=p.createElements,M={};return new Promise(function(O,N){cz(l,tr({descriptors:a.getDescriptorsWithOutFunc(o),features:t,segmentNumber:n},c)).then(function(z){z.descriptors.forEach(function(Y,K){if(Y){var ie=Y.buffer;Y.update,Y.name;var le=b0(Y,Uj),Se=y(tr({buffer:b(ie)},le));M[Y.name||""]=Se,a.attributes[K].vertexAttribute=Se}}),a.featureLayout=z.featureLayout;var j=w({data:z.indices,type:Q.UNSIGNED_INT,count:z.indices.length});a.attributesAndIndices={attributes:M,elements:j,count:null},O(a.attributesAndIndices)}).catch(function(z){console.warn(z),N(z)})})}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(j){return j.resetDescriptor(),j.descriptor}),l=0,c=0,p=[],y=3;t.forEach(function(j,Y){var K=a.triangulation(j,i),ie=K.indices,le=K.vertices,Se=K.normals,ze=K.size,ue=K.indexes,Ke=K.count;typeof Ke=="number"&&(c+=Ke),ie.forEach(function(ve){p.push(ve+l)}),y=ze;var ke=le.length/ze;a.featureLayout.sizePerElement=y,a.featureLayout.elements.push({featureIdx:Y,vertices:le,normals:Se,offset:l}),l+=ke;for(var Ce=function(Ie){var dt=(Se==null?void 0:Se.slice(Ie*3,Ie*3+3))||[],St=le.slice(Ie*ze,Ie*ze+ze),Rt=0;ue&&ue[Ie]!==void 0&&(Rt=ue[Ie]),o.forEach(function($t,gt){if($t&&$t.update){var jr;(jr=$t.buffer.data).push.apply(jr,zn($t.update(j,Y,St,Ie,dt,Rt)))}})},je=0;je<ke;je++)Ce(je)});var b=this.rendererService,w=b.createAttribute,M=b.createBuffer,O=b.createElements,N={};o.forEach(function(j,Y){if(j){var K=j.buffer;j.update,j.name;var ie=b0(j,Vj),le=w(tr({buffer:M(K)},ie));N[j.name||""]=le,a.attributes[Y].vertexAttribute=le}});var z=O({data:p,type:Q.UNSIGNED_INT,count:p.length});return this.attributesAndIndices={attributes:N,elements:z,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(w){return w.resetDescriptor(),w.descriptor}),o=0,l=3;t.forEach(function(w,M){var O=i.triangulation(w),N=O.indices,z=O.vertices,j=O.normals,Y=O.size,K=O.indexes;N.forEach(function(ze){}),l=Y;var ie=z.length/Y;i.featureLayout.sizePerElement=l,i.featureLayout.elements.push({featureIdx:M,vertices:z,normals:j,offset:o}),o+=ie;for(var le=function(ue){var Ke=(j==null?void 0:j.slice(ue*3,ue*3+3))||[],ke=z.slice(ue*Y,ue*Y+Y),Ce=0;K&&K[ue]!==void 0&&(Ce=K[ue]),a.forEach(function(je,ve){if(je&&je.update){var Ie;(Ie=je.buffer.data).push.apply(Ie,zn(je.update(w,M,ke,ue,Ke,Ce)))}})},Se=0;Se<ie;Se++)le(Se)});var c=this.rendererService,p=c.createAttribute,y=c.createBuffer,b={};return a.forEach(function(w,M){if(w){var O=w.buffer;w.update,w.name;var N=b0(w,Gj),z=p(tr({buffer:y(O)},N));b[w.name||""]=z,i.attributes[M].vertexAttribute=z}}),{attributes:b}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),fM=ji(CE.prototype,"rendererService",[lM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE))||cM),Ow={exports:{}};function xb(e){var r=e.target||e.srcElement;r.__resizeRAF__&&cancelAnimationFrame(r.__resizeRAF__),r.__resizeRAF__=requestAnimationFrame(function(){var t=r.__resizeTrigger__,n=t&&t.__resizeListeners__;n&&n.forEach(function(i){i.call(t,e)})})}var hM=function(r,t){var n=this,i=n.document,a,o=i.attachEvent;typeof navigator<"u"&&(a=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function l(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",xb)}if(!r.__resizeListeners__)if(r.__resizeListeners__=[],o)r.__resizeTrigger__=r,r.attachEvent("onresize",xb);else{getComputedStyle(r).position==="static"&&(r.style.position="relative");var c=r.__resizeTrigger__=i.createElement("object");c.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),c.setAttribute("class","resize-sensor"),c.setAttribute("tabindex","-1"),c.setAttribute("title",""),c.__resizeElement__=r,c.onload=l,c.type="text/html",a&&r.appendChild(c),c.data="about:blank",a||r.appendChild(c)}r.__resizeListeners__.push(t)};Ow.exports=typeof window>"u"?hM:hM.bind(window);var Wj=Ow.exports.unbind=function(e,r){var t=document.attachEvent,n=e.__resizeListeners__||[];if(r){var i=n.indexOf(r);i!==-1&&n.splice(i,1)}else n=e.__resizeListeners__=[];if(!n.length){if(t)e.detachEvent("onresize",xb);else if(e.__resizeTrigger__){var a=e.__resizeTrigger__.contentDocument,o=a&&a.defaultView;o&&(o.removeEventListener("resize",xb),delete o.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}},pM,dM,vM,mM,gM,yM,_M,xM,bM,EM,CM,SM,wM,AM,TM,MM,IM,af,LM,kM,RM,OM,PM,FM,DM,BM,NM,zM,UM,VM,GM,jM,HM;function $j(e){var r=Xj();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Xj(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Zj=(pM=oa(),dM=na(Gt.SceneID),vM=na(Gt.IIconService),mM=na(Gt.IFontService),gM=na(Gt.IControlService),yM=na(Gt.IGlobalConfigService),_M=na(Gt.IMapService),xM=na(Gt.ICoordinateSystemService),bM=na(Gt.IRendererService),EM=na(Gt.ILayerService),CM=na(Gt.ICameraService),SM=na(Gt.IInteractionService),wM=na(Gt.IPickingService),AM=na(Gt.IShaderModuleService),TM=na(Gt.IMarkerService),MM=na(Gt.IPopupService),pM(IM=(af=function(e){On(t,e);var r=$j(t);function t(){var n;return Kt(this,t),n=r.call(this),ne(vt(n),"destroyed",!1),ne(vt(n),"loaded",!1),ne(vt(n),"loadFont",!1),ne(vt(n),"fontFamily",""),$i(vt(n),"id",LM,vt(n)),$i(vt(n),"iconService",kM,vt(n)),$i(vt(n),"fontService",RM,vt(n)),$i(vt(n),"controlService",OM,vt(n)),$i(vt(n),"configService",PM,vt(n)),$i(vt(n),"map",FM,vt(n)),$i(vt(n),"coordinateSystemService",DM,vt(n)),$i(vt(n),"rendererService",BM,vt(n)),$i(vt(n),"layerService",NM,vt(n)),$i(vt(n),"cameraService",zM,vt(n)),$i(vt(n),"interactionService",UM,vt(n)),$i(vt(n),"pickingService",VM,vt(n)),$i(vt(n),"shaderModuleService",GM,vt(n)),$i(vt(n),"markerService",jM,vt(n)),$i(vt(n),"popupService",HM,vt(n)),ne(vt(n),"inited",!1),ne(vt(n),"initPromise",void 0),ne(vt(n),"rendering",!1),ne(vt(n),"$container",void 0),ne(vt(n),"canvas",void 0),ne(vt(n),"markerContainer",void 0),ne(vt(n),"hooks",void 0),ne(vt(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),wB(),n.coordinateSystemService.needRefresh=!0,n.render())}),ne(vt(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new sV},n}return Qt(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",eo(Xn.mark(function o(){return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(p){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),a.map.version!=="GAODE2.x"&&p()}),a.map.version!=="GAODE2.x"?a.map.init():p()});case 2:if(!(a.map.version==="GAODE2.x"&&a.map.initViewPort)){c.next=6;break}return c.next=5,a.map.init();case 5:a.map.initViewPort();case 6:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(uf.Drag,a.addSceneEvent.bind(a));case 13:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",eo(Xn.mark(function o(){var l,c;return Xn.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(l=Lj(a.configService.getSceneConfig(a.id).id||""),a.$container=l,!l){y.next=12;break}return a.canvas=Ul("canvas","",l),a.setCanvas(),y.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.initContainer(),Ow.exports(a.$container,a.handleWindowResized),Ho.matchMedia&&((c=Ho.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||c===void 0||c.addListener(a.handleWindowResized)),y.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:a.pickingService.init(a.id);case 14:case"end":return y.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",eo(Xn.mark(function o(){return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(p){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),a.map.version!=="GAODE2.x"&&p()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(uf.Drag,a.addSceneEvent.bind(a));case 5:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",eo(Xn.mark(function o(){var l;return Xn.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){p.next=7;break}return p.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:p.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return p.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=eo(Xn.mark(function a(){return Xn.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=23;break}return l.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){l.next=18;break}return l.prev=8,l.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:l.next=18;break;case 13:l.prev=13,l.t0=l.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(l.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return l.stop()}},a,this,[[8,13]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontFamily=i;var o=document.createElement("style");o.type="text/css",o.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(o),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(i){var a,o=(a=this.$container)===null||a===void 0?void 0:a.getElementsByTagName("canvas")[0];this.render();var l=i==="jpg"?o==null?void 0:o.toDataURL("image/jpeg"):o==null?void 0:o.toDataURL("image/png");return l}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=Ul("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a,o;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var c;(c=i.$container)===null||c===void 0||c.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(a=this.$container)===null||a===void 0||(o=a.parentNode)===null||o===void 0||o.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,Wj(this.$container,this.handleWindowResized),Ho.matchMedia){var l;(l=Ho.matchMedia("screen and (min-resolution: 2dppx)"))===null||l===void 0||l.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var i,a,o=Ou,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p&&(p.width=l*o,p.height=c*o),this.rendererService.viewport({x:0,y:0,width:o*l,height:o*c})}},{key:"setCanvas",value:function(){var i,a,o=Ou,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p.width=l*o,p.height=c*o,p.style.width="100%",p.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Zd.exports.EventEmitter),LM=ji(af.prototype,"id",[dM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kM=ji(af.prototype,"iconService",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RM=ji(af.prototype,"fontService",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OM=ji(af.prototype,"controlService",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PM=ji(af.prototype,"configService",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=ji(af.prototype,"map",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DM=ji(af.prototype,"coordinateSystemService",[xM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=ji(af.prototype,"rendererService",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NM=ji(af.prototype,"layerService",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=ji(af.prototype,"cameraService",[CM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UM=ji(af.prototype,"interactionService",[SM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=ji(af.prototype,"pickingService",[wM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GM=ji(af.prototype,"shaderModuleService",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jM=ji(af.prototype,"markerService",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=ji(af.prototype,"popupService",[MM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),af))||IM);function Yj(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break}return r}var qj=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function WM(e){var r={};return e=e.replace(qj,function(t,n,i){var a=i.split(":"),o=a[0].trim(),l="";switch(a.length>1&&(l=a[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce(function(c,p){return c.push(Number(p.trim())),c},[]):l=new Array(Yj(n)).fill(0);break}return r[o]=l,"uniform ".concat(n," ").concat(o,`;
`)}),{content:e,uniforms:r}}var $M,XM,ZM="#define PI 3.14159265359",Kj=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Qj=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Jj=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,eH=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,tH=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,rH=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,nH=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,iH=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,aH=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,oH=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,sH=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,uH=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,lH=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,cH=/precision\s+(high|low|medium)p\s+float/,fH=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,hH=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,pH=($M=oa(),$M(XM=function(){function e(){Kt(this,e),ne(this,"moduleCache",{}),ne(this,"rawContentCache",{})}return Qt(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:ZM,fs:ZM}),this.registerModule("decode",{vs:Kj,fs:""}),this.registerModule("projection",{vs:nH,fs:""}),this.registerModule("project",{vs:rH,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:iH}),this.registerModule("lighting",{vs:Jj,fs:""}),this.registerModule("light",{vs:Qj,fs:""}),this.registerModule("picking",{vs:tH,fs:eH}),this.registerModule("styleMapping",{vs:aH,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:lH,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:oH,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:sH,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:uH,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var i=n.vs,a=n.fs,o=n.uniforms,l=WM(i),c=l.content,p=l.uniforms,y=WM(a),b=y.content,w=y.uniforms;this.rawContentCache[t]={fs:b,uniforms:tr(tr(tr({},p),w),o),vs:c}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,o=this.processModule(i,[],"vs"),l=o.content,c=o.includeList,p=this.processModule(a,[],"fs"),y=p.content,b=p.includeList,w=y,M=Vr.exports.uniq(c.concat(b).concat(t)).reduce(function(O,N){return tr(tr({},O),n.rawContentCache[N].uniforms)},{});return cH.test(y)||(w=fH+y),this.moduleCache[t]={fs:w.trim(),uniforms:M,vs:l.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,o=t.replace(hH,function(l,c){var p=c.split(" "),y=p[0].replace(/"/g,"");if(n.indexOf(y)>-1)return"";var b=a.rawContentCache[y][i];n.push(y);var w=a.processModule(b,n,i),M=w.content;return M});return{content:o,includeList:n}}}]),e}())||XM);function dH(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=At(e),e!==null););return e}function Ig(){return typeof Reflect<"u"&&Reflect.get?Ig=Reflect.get.bind():Ig=function(r,t,n){var i=dH(r,t);if(!!i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?r:n):a.value}},Ig.apply(this,arguments)}var Cm;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Cm||(Cm={}));var YM,qM,c2=(YM=oa(),YM(qM=function(){function e(){Kt(this,e),ne(this,"shaderModuleService",void 0),ne(this,"rendererService",void 0),ne(this,"cameraService",void 0),ne(this,"mapService",void 0),ne(this,"interactionService",void 0),ne(this,"layerService",void 0),ne(this,"config",void 0)}return Qt(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Cm.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Gt.IRendererService),this.cameraService=t.getContainer().get(Gt.ICameraService),this.mapService=t.getContainer().get(Gt.IMapService),this.interactionService=t.getContainer().get(Gt.IInteractionService),this.layerService=t.getContainer().get(Gt.ILayerService),this.shaderModuleService=t.getContainer().get(Gt.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||qM),KM,QM;function vH(e){var r=mH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function mH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var gH=(KM=oa(),KM(QM=function(e){On(t,e);var r=vH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Ig(At(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(c2))||QM),JM,e4,t4,SE,r4;function yH(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_H(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function _H(e,r){if(!!e){if(typeof e=="string")return n4(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n4(e,r)}}function n4(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var xH=(JM=oa(),e4=na(Gt.IPostProcessor),JM(t4=(SE=function(){function e(){Kt(this,e),ne(this,"passes",[]),$i(this,"postProcessor",r4,this),ne(this,"layer",void 0),ne(this,"renderFlag",void 0),ne(this,"width",0),ne(this,"height",0)}return Qt(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=eo(Xn.mark(function n(){var i,a,o;return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=yH(this.passes),c.prev=1,i.s();case 3:if((a=i.n()).done){c.next=9;break}return o=a.value,c.next=7,o.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Cm.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),r4=ji(SE.prototype,"postProcessor",[e4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE))||t4),i4,a4;function bH(e){var r=EH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function EH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CH=(i4=oa(),i4(a4=function(e){On(t,e);var r=bH(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"pickingFBO",void 0),ne(vt(n),"layer",void 0),ne(vt(n),"width",0),ne(vt(n),"height",0),ne(vt(n),"alreadyInRendering",!1),ne(vt(n),"pickFromPickingFBO",function(l){var c=l.x,p=l.y,y=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var w=n.rendererService,M=w.getViewportSize,O=w.readPixels,N=w.useFramebuffer,z=M(),j=z.width,Y=z.height,K=n.layer.getLayerConfig(),ie=K.enableHighlight,le=K.enableSelect,Se=c*Ou,ze=p*Ou;if(!(Se>j||Se<0||ze>Y||ze<0)){var ue;N(n.pickingFBO,function(){var Ke;if(ue=O({x:Math.round(Se),y:Math.round(Y-(p+1)*Ou),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ue[0]!==0||ue[1]!==0||ue[2]!==0){var ke=Nv(ue),Ce=n.layer.getSource().getFeatureById(ke),je={x:c,y:p,type:b,lngLat:y,featureId:ke,feature:Ce};Ce&&(n.layer.setCurrentPickId(ke),n.triggerHoverOnLayer(je))}else{var ve={x:c,y:p,lngLat:y,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(tr(tr({},ve),{},{type:"unpick"})),n.triggerHoverOnLayer(ve),n.layer.setCurrentPickId(null)}ie&&n.highlightPickedFeature(ue),le&&b==="click"&&((Ke=ue)===null||Ke===void 0?void 0:Ke.toString())!==[0,0,0,0].toString()&&n.selectFeature(ue)})}}}),n}return Qt(t,[{key:"getType",value:function(){return Cm.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Ig(At(t.prototype),"init",this).call(this,i,a),this.layer=i;var o=this.rendererService,l=o.createTexture2D,c=o.createFramebuffer,p=o.getViewportSize,y=p(),b=y.width,w=y.height;this.pickingFBO=c({color:l({width:b,height:w,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.interactionService.on(uf.Hover,this.pickFromPickingFBO),this.interactionService.on(uf.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(uf.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var o=this.rendererService,l=o.getViewportSize,c=o.useFramebuffer,p=o.clear,y=l(),b=y.width,w=y.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==w)&&(this.pickingFBO.resize({width:b,height:w}),this.width=b,this.height=w),c(this.pickingFBO,function(){p({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var M=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(M),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=Pi(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeHighlight.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=Pi(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeSelect.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,o=bm(a);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,o=bm(a);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(c2))||a4),o4,s4,u4,wE,l4,SH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,M0=(o4=oa(),s4=na(Gt.IShaderModuleService),o4(u4=(wE=function(){function e(){Kt(this,e),$i(this,"shaderModuleService",l4,this),ne(this,"rendererService",void 0),ne(this,"config",void 0),ne(this,"quad",SH),ne(this,"enabled",!0),ne(this,"renderToScreen",!1),ne(this,"model",void 0),ne(this,"name",void 0),ne(this,"optionsToUpdate",{})}return Qt(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Cm.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Gt.IRendererService),this.shaderModuleService=t.getContainer().get(Gt.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,o=i.createBuffer,l=i.createModel,c=this.setupShaders(),p=c.vs,y=c.fs,b=c.uniforms;this.model=l({vs:p,fs:y,attributes:{a_Position:a({buffer:o({data:[-4,-4,4,-4,0,4],type:Q.FLOAT}),size:2})},uniforms:tr(tr({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,l=o.useFramebuffer,c=o.getViewportSize,p=o.clear,y=c(),b=y.width,w=y.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){p({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var M=tr({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[b,w]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(M.u_BloomFinal=1,M.u_Texture2=n),i.model.draw({uniforms:M})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=tr(tr({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){Vr.exports.isNil(t[i])||(n["u_".concat(Vr.exports.upperFirst(Vr.exports.camelCase(i)))]=t[i])}),n}}]),e}(),l4=ji(wE.prototype,"shaderModuleService",[s4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE))||u4),c4,f4;function wH(e){var r=AH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function AH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TH=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,MH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,IH=(c4=oa(),c4(f4=function(e){On(t,e);var r=wH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:MH,fs:TH});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Vr.exports.isNil(i.bloomRadius)||(a.u_radius=i.bloomRadius),Vr.exports.isNil(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),Vr.exports.isNil(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(M0))||f4),h4,p4;function LH(e){var r=kH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function kH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var RH=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,OH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PH=(h4=oa(),h4(p4=function(e){On(t,e);var r=LH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:OH,fs:RH});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Vr.exports.isNil(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(M0))||p4),d4,v4;function FH(e){var r=DH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function DH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BH=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,NH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zH=(d4=oa(),d4(v4=function(e){On(t,e);var r=FH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:NH,fs:BH});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return Vr.exports.isNil(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(M0))||v4),m4,g4;function UH(e){var r=VH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function VH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var GH=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,jH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,HH=(m4=oa(),m4(g4=function(e){On(t,e);var r=UH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:jH,fs:GH});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}}]),t}(M0))||g4),y4,_4;function WH(e){var r=$H();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function $H(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var XH=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ZH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,YH=(y4=oa(),y4(_4=function(e){On(t,e);var r=WH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ZH,fs:XH}),this.shaderModuleService.getModule("copy-pass")}}]),t}(M0))||_4),x4,b4;function qH(e){var r=KH();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function KH(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var QH=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,JH=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,eW=(x4=oa(),x4(b4=function(e){On(t,e);var r=qH(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:JH,fs:QH});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}}]),t}(M0))||b4),E4,C4;function tW(e){var r=rW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function rW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nW=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,iW=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aW=(E4=oa(),E4(C4=function(e){On(t,e);var r=tW(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:iW,fs:nW});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,y=c.height;return{vs:a,fs:o,uniforms:tr(tr({},l),{},{u_ViewportSize:[p,y]})}}}]),t}(M0))||C4),S4,w4;function oW(e){var r=sW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function sW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var uW=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,lW=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cW=(S4=oa(),S4(w4=function(e){On(t,e);var r=oW(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:lW,fs:uW}),this.shaderModuleService.getModule("noise-pass")}}]),t}(M0))||w4),A4,T4;function fW(e){var r=hW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function hW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pW=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dW=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,vW=(A4=oa(),A4(T4=function(e){On(t,e);var r=fW(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:pW,fs:dW}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(M0))||T4),M4,I4,L4,k4,gy,R4,mW=(M4=oa(),I4=na(Gt.IRendererService),L4=zG(),M4(k4=(gy=function(){function e(){Kt(this,e),$i(this,"rendererService",R4,this),ne(this,"passes",[]),ne(this,"readFBO",void 0),ne(this,"writeFBO",void 0)}return Qt(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),o=a.width,l=a.height;return i({x:0,y:0,width:o,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i,a){n(t.readFBO,eo(Xn.mark(function o(){return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return c.stop()}},o)})))})}},{key:"renderBloomPass",value:function(){var r=eo(Xn.mark(function n(i,a){var o,l;return Xn.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.getReadFBOTex();case 2:o=p.sent,l=0;case 4:if(!(l<4)){p.next=11;break}return p.next=7,a.render(i,o);case 7:this.swap(),l++,p.next=4;break;case 11:case"end":return p.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=eo(Xn.mark(function n(i){var a,o;return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<this.passes.length)){c.next=15;break}if(o=this.passes[a],o.setRenderToScreen(this.isLastEnabledPass(a)),o.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,o);case 7:c.next=12;break;case 9:return c.next=11,o.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),R4=ji(gy.prototype,"rendererService",[I4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji(gy.prototype,"init",[L4],Object.getOwnPropertyDescriptor(gy.prototype,"init"),gy.prototype),gy))||k4),O4,P4;function gW(e){var r=yW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function yW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _W=(O4=oa(),O4(P4=function(e){On(t,e);var r=gW(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getType",value:function(){return Cm.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Ig(At(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,o=a.useFramebuffer,l=a.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();o(c,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(p){p.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(c2))||P4),F4,D4,B4,AE,N4;function xW(e){var r=bW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function bW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EW=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,z4=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,CW=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function U4(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var SW=1,wW=(F4=oa(),D4=na(Gt.IShaderModuleService),F4(B4=(AE=function(e){On(t,e);var r=xW(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),$i(vt(n),"shaderModuleService",N4,vt(n)),ne(vt(n),"haltonSequence",[]),ne(vt(n),"accumulatingId",0),ne(vt(n),"frame",0),ne(vt(n),"timer",void 0),ne(vt(n),"sampleRenderTarget",void 0),ne(vt(n),"prevRenderTarget",void 0),ne(vt(n),"outputRenderTarget",void 0),ne(vt(n),"copyRenderTarget",void 0),ne(vt(n),"blendModel",void 0),ne(vt(n),"outputModel",void 0),ne(vt(n),"copyModel",void 0),n}return Qt(t,[{key:"getType",value:function(){return Cm.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Ig(At(t.prototype),"init",this).call(this,i,a);var o=this.rendererService,l=o.createFramebuffer,c=o.createTexture2D;this.sampleRenderTarget=l({color:c({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:c({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:c({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:c({width:1,height:1,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE})});for(var p=0;p<30;p++)this.haltonSequence.push([U4(p,2),U4(p,3)]);this.blendModel=this.createTriangleModel("blend-pass",EW),this.outputModel=this.createTriangleModel("copy-pass",z4,{blend:{enable:!0,func:{srcRGB:Q.ONE,dstRGB:Q.ONE_MINUS_SRC_ALPHA,srcAlpha:Q.ONE,dstAlpha:Q.ONE_MINUS_SRC_ALPHA},equation:{rgb:Q.FUNC_ADD,alpha:Q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",z4)}},{key:"render",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,p=o.useFramebuffer,y=c(),b=y.width,w=y.height;this.sampleRenderTarget.resize({width:b,height:w}),this.prevRenderTarget.resize({width:b,height:w}),this.outputRenderTarget.resize({width:b,height:w}),this.copyRenderTarget.resize({width:b,height:w}),this.resetFrame(),this.stopAccumulating();var M=i.multiPassRenderer.getPostProcessor().getReadFBO();p(M,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:M}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var O=function N(z){!a.accumulatingId||z!==a.accumulatingId||a.isFinished()||(a.doRender(i),Ho.requestAnimationFrame(function(){N(z)}))};this.accumulatingId=SW++,this.timer=Ho.setTimeout(function(){O(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,p=o.useFramebuffer,y=c(),b=y.width,w=y.height,M=i.getLayerConfig(),O=M.jitterScale,N=O===void 0?1:O,z=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((z[0]*2-1)/b*N,(z[1]*2-1)/w*N),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),p(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var j=i.getLayerConfig();p(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:j.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(p(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),p(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var Y=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Y,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ho.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,o){this.shaderModuleService.registerModule(i,{vs:CW,fs:a});var l=this.shaderModuleService.getModule(i),c=l.vs,p=l.fs,y=l.uniforms,b=this.rendererService,w=b.createAttribute,M=b.createBuffer,O=b.createModel;return O(tr({vs:c,fs:p,attributes:{a_Position:w({buffer:M({data:[-4,-4,4,-4,0,4],type:Q.FLOAT}),size:2})},uniforms:tr({},y),depth:{enable:!1},count:3},o))}}]),t}(c2),N4=ji(AE.prototype,"shaderModuleService",[D4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE))||B4),hf=new kw;hf.bind(Gt.IGlobalConfigService).to(bj).inSingletonScope();gG(oa(),Zd.exports.EventEmitter);hf.bind(Gt.IEventEmitter).to(Zd.exports.EventEmitter);var AW=HG(hf,!1),Pw=function(r){var t=AW.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},TW=0;function MW(){var e=new kw;return e.parent=hf,e.bind(Gt.SceneID).toConstantValue("".concat(TW++)),e.bind(Gt.IShaderModuleService).to(pH).inSingletonScope(),e.bind(Gt.ILayerService).to(Dj).inSingletonScope(),e.bind(Gt.ISceneService).to(Zj).inSingletonScope(),e.bind(Gt.ICameraService).to(hj).inSingletonScope(),e.bind(Gt.ICoordinateSystemService).to(Sj).inSingletonScope(),e.bind(Gt.IInteractionService).to(Mj).inSingletonScope(),e.bind(Gt.IPickingService).to(Rj).inSingletonScope(),e.bind(Gt.IControlService).to(vj).inSingletonScope(),e.bind(Gt.IMarkerService).to(mj).inSingletonScope(),e.bind(Gt.IIconService).to(fj).inSingletonScope(),e.bind(Gt.IFontService).to(sj).inSingletonScope(),e.bind(Gt.IPopupService).to(gj).inSingletonScope(),e.bind(Gt.INormalPass).to(gH).whenTargetNamed("clear"),e.bind(Gt.INormalPass).to(CH).whenTargetNamed("pixelPicking"),e.bind(Gt.INormalPass).to(_W).whenTargetNamed("render"),e.bind(Gt.INormalPass).to(wW).whenTargetNamed("taa"),e.bind(Gt.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Gt.INormalPass,t)}}),e.bind(Gt.IPostProcessingPass).to(YH).whenTargetNamed("copy"),e.bind(Gt.IPostProcessingPass).to(IH).whenTargetNamed("bloom"),e.bind(Gt.IPostProcessingPass).to(PH).whenTargetNamed("blurH"),e.bind(Gt.IPostProcessingPass).to(zH).whenTargetNamed("blurV"),e.bind(Gt.IPostProcessingPass).to(cW).whenTargetNamed("noise"),e.bind(Gt.IPostProcessingPass).to(vW).whenTargetNamed("sepia"),e.bind(Gt.IPostProcessingPass).to(HH).whenTargetNamed("colorHalftone"),e.bind(Gt.IPostProcessingPass).to(eW).whenTargetNamed("hexagonalPixelate"),e.bind(Gt.IPostProcessingPass).to(aW).whenTargetNamed("ink"),e.bind(Gt.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Gt.IPostProcessingPass,t);return n.setName(t),n}}),e}function JC(e){var r=new kw;return r.parent=e,r.bind(Gt.IStyleAttributeService).to(Hj).inSingletonScope(),r.bind(Gt.IMultiPassRenderer).to(xH).inSingletonScope(),r.bind(Gt.IPostProcessor).to(mW).inSingletonScope(),r}var Ip;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Ip||(Ip={}));var jo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(jo||(jo={}));var um;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(um||(um={}));var _n;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(_n||(_n={}));var eS=["mapload","mapchange","mapAfterFrameChange"],ag={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},TE=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Sm;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Sm||(Sm={}));function IW(e){var r=LW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function LW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var kW=0,Q1=function(e){On(t,e);var r=IW(t);function t(n){var i;return Kt(this,t),i=r.call(this),i.controlOption=tr(tr({},i.getDefault()),n||{}),i}return Qt(t,[{key:"getDefault",value:function(){return{position:Sm.TOPRIGHT,name:"".concat(kW++)}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Sm.BOTTOMRIGHT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(i){this.mapsService=i.get(Gt.IMapService),this.renderService=i.get(Gt.IRendererService),this.layerService=i.get(Gt.ILayerService),this.controlService=i.get(Gt.IControlService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var a=this.container,o=this.controlOption.position,l=this.controlService.controlCorners[o];return kg(a,"l7-control"),o.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var i=this.container;kg(i,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var i=this.container;E1(i,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;b1(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}}]),t}(Zd.exports.EventEmitter);function RW(e){var r=OW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function OW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PW=function(e){On(t,e);var r=RW(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.layerControlInputs=[],i.layers=[],i.lastZIndex=0,i.handlingClick=!1,i.initLayers(),Qb(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],vt(i)),i}return Qt(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:Sm.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var i=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(a){a.layer.on("remove",i.onLayerChange),a.layer.on("add",i.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(i,a){return this.addLayer(i,a,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var i=this.renderService.getViewportSize(),a=i.height;kg(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var o=a-(this.container.offsetTop+50);return o<this.form.clientHeight?(kg(this.form,"l7-control-layers-scrollbar"),this.form.style.height=o+"px"):E1(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return E1(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var i=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(a){a.layer.off("remove",i.onLayerChange),a.layer.off("add",i.onLayerChange)}))}},{key:"initLayout",value:function(){var i="l7-control-layers",a=this.container=Ul("div",i),o=this.controlOption.collapsed;a.setAttribute("aria-haspopup","true");var l=this.form=Ul("form",i+"-list");o&&(this.mapsService.on("click",this.collapse),a.addEventListener("mouseenter",this.expand),a.addEventListener("mouseleave",this.collapse)),this.layersLink=Ul("a",i+"-toggle",a);var c=this.layersLink;c.title="Layers",o||this.expand(),this.baseLayersList=Ul("div",i+"-base",l),this.separator=Ul("div",i+"-separator",l),this.overlaysList=Ul("div",i+"-overlays",l),a.appendChild(l)}},{key:"initLayers",value:function(){var i=this,a=this.controlOption,o=a.baseLayers,l=o===void 0?{}:o,c=a.overlayers,p=c===void 0?{}:c;Object.keys(l).forEach(function(y,b){i.addLayer(l[y],y,!1)}),Object.keys(p).forEach(function(y,b){i.addLayer(p[y],y,!0)})}},{key:"update",value:function(){if(!this.container)return this;mT(this.baseLayersList),mT(this.overlaysList),this.layerControlInputs=[];var i,a,o,l,c=0;for(o=0;o<this.layers.length;o++)l=this.layers[o],this.addItem(l),a=a||l.overlay,i=i||!l.overlay,c+=l.overlay?0:1;return this.controlOption.hideSingleBase&&(i=i&&c>1,this.baseLayersList.style.display=i?"":"none"),this.separator.style.display=a&&i?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var i=this.layerControlInputs,a,o,l=this.mapsService.getZoom(),c=i.length-1;c>=0;c--)if(a=i[c],o=this.layerService.getLayer(a.layerId),o&&o.inited){var p=o.getMinZoom(),y=o.getMaxZoom();a.disabled=l<p||l>y}}},{key:"addLayer",value:function(i,a,o){this.mapsService&&(i.on("add",this.onLayerChange),i.on("remove",this.onLayerChange)),this.layers.push({layer:i,name:a,overlay:o});var l=this.controlOption,c=l.sortLayers,p=l.sortFunction,y=l.autoZIndex;c&&this.layers.sort(function(b,w){return p(b.layer,w.layer,b.name,w.name)}),y&&i.setZIndex&&(this.lastZIndex++,i.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(i){this.handlingClick||this.update();var a=this.layerService.getLayer(i.target.layerId),o=a!=null&&a.overlay?i.type==="add"?"overlayadd":"overlayremove":i.type==="add"?"baselayerchange":null;o&&this.emit(o,a)}},{key:"createRadioElement",value:function(i,a){var o='<input type="radio" class="l7-control-layers-selector" name="'+i+'"'+(a?' checked="checked"':"")+"/>",l=document.createElement("div");return l.innerHTML=o,l.firstChild}},{key:"addItem",value:function(i){var a=document.createElement("label"),o=this.layerService.getLayer(i.layer.id),l=o&&o.inited&&i.layer.isVisible(),c;i.overlay?(c=document.createElement("input"),c.type="checkbox",c.className="l7-control-layers-selector",c.defaultChecked=l):c=this.createRadioElement("l7-base-layers",l),this.layerControlInputs.push(c),c.layerId=i.layer.id,c.addEventListener("click",this.onInputClick);var p=document.createElement("span");p.innerHTML=" "+i.name;var y=document.createElement("div");a.appendChild(y),y.appendChild(c),y.appendChild(p);var b=i.overlay?this.overlaysList:this.baseLayersList;return b.appendChild(a),this.checkDisabledLayers(),a}},{key:"onInputClick",value:function(){var i=this.layerControlInputs,a,o,l=[],c=[];this.handlingClick=!0;for(var p=i.length-1;p>=0;p--)a=i[p],o=this.layerService.getLayer(a.layerId),a.checked?l.push(o):a.checked||c.push(o);c.forEach(function(y){y.hide()}),l.forEach(function(y){y.show()}),this.handlingClick=!1}}]),t}(Q1);function FW(e){var r=DW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function DW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BW=function(e){On(t,e);var r=FW(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getDefault",value:function(){return{position:Sm.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var i="l7-control-logo",a=Ul("div",i),o=Ul("a","l7-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://antv.alipay.com/l7",o.setAttribute("aria-label","AntV logo"),o.setAttribute("rel","noopener nofollow"),a.appendChild(o),a}},{key:"onRemove",value:function(){return null}}]),t}(Q1);function NW(e){var r=zW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function zW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var UW=function(e){On(t,e);var r=NW(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),Qb(["update"],vt(i)),i}return Qt(t,[{key:"getDefault",value:function(){return{position:Sm.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var i="l7-control-scale",a=Ul("div",i);this.addScales(i+"-line",a);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),this.update(),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var i=this.mapsService,a=this.controlOption.maxWidth,o=i.getSize()[1]/2,l=i.containerToLngLat([0,o]),c=i.containerToLngLat([a,o]),p=XB([l.lng,l.lat],[c.lng,c.lat]);this.updateScales(p)}},{key:"updateScales",value:function(i){var a=this.controlOption,o=a.metric,l=a.imperial;o&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),o=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,o,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,o,l,c;a>5280?(o=a/5280,l=this.getRoundNum(o),this.updateScale(this.iScale,l+" mi",l/o)):(c=this.getRoundNum(a),this.updateScale(this.iScale,c+" ft",c/a))}},{key:"updateScale",value:function(i,a,o){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*o)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),o=i/a;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,a*o}},{key:"addScales",value:function(i,a){var o=this.controlOption,l=o.metric,c=o.imperial;l&&(this.mScale=Ul("div",i,a)),c&&(this.iScale=Ul("div",i,a))}}]),t}(Q1);function VW(e){var r=GW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function GW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jW=function(e){On(t,e);var r=VW(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),Qb(["updateDisabled","zoomIn","zoomOut"],vt(i)),i}return Qt(t,[{key:"getDefault",value:function(){return{position:Sm.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var i="l7-control-zoom",a=Ul("div",i+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,i+"-in",a,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,i+"-out",a,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),a}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(i,a,o,l,c){var p=Ul("a",o,l);return p.innerHTML=i,p.title=a,p.href="javascript:void(0)",p.addEventListener("click",c),p}},{key:"updateDisabled",value:function(){var i=this.mapsService,a="l7-disabled";E1(this.zoomInButton,a),E1(this.zoomOutButton,a),(this.disabled||i.getZoom()<=i.getMinZoom())&&kg(this.zoomOutButton,a),(this.disabled||i.getZoom()>=i.getMaxZoom())&&kg(this.zoomInButton,a)}}]),t}(Q1);function HW(e){var r=WW();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function WW(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var V4=function(e){On(t,e);var r=HW(t);function t(n){var i;return Kt(this,t),i=r.call(this),ne(vt(i),"added",!1),ne(vt(i),"eventHandle",function(a){i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=tr(tr({},i.getDefault()),n),Qb(["update","onMove","onUp","addDragHandler","onMapClick"],vt(i)),i.init(),i}return Qt(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:db.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Gt.IMapService),this.sceneSerive=i.get(Gt.ISceneService);var a=this.markerOption,o=a.element;return a.draggable,this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&b1(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var o=this.markerOption.element;return o&&b1(o),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.anchor;this.updatePosition(),SB(a,"".concat(SC[o]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.offsets,l=this.lngLat,c=l.lng,p=l.lat,y=this.mapsService.lngLatToContainer([c,p]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),w=b.containerHeight,M=b.containerWidth,O=b.bounds;if(!O)return;if(Math.abs(O[0][0])>180||Math.abs(O[1][0])>180){if(y.x>M){var N=this.mapsService.lngLatToContainer([c-360,p]);y.x=N.x}if(y.x<0){var z=this.mapsService.lngLatToContainer([c+360,p]);y.x=z.x}}(y.x>M||y.x<0||y.y>w||y.y<0)&&(a.style.display="none"),a.style.left=y.x+o[0]+"px",a.style.top=y.y-o[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,o=this.markerOption,l=o.color,c=o.anchor;if(!a){this.defaultMarker=!0,a=Ul("div"),this.markerOption.element=a;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","48px"),p.setAttributeNS(null,"width","48px"),p.setAttributeNS(null,"viewBox","0 0 1024 1024");var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),y.setAttributeNS(null,"fill",l),p.appendChild(y),a.appendChild(p)}kg(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var w,M,O=((w=i.markerOption)===null||w===void 0?void 0:w.style)&&((M=i.markerOption)===null||M===void 0?void 0:M.style[b]);a&&(a.style[b]=O)}),a.addEventListener("click",function(b){i.onMapClick(b)}),a.addEventListener("click",this.eventHandle),sN(a,c,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(i){throw new Error("Method not implemented.")}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Zd.exports.EventEmitter);function $W(e,r){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}$W(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var em,tS=(em={},ne(em,Ip.additive,{enable:!0,func:{srcRGB:Q.ONE,dstRGB:Q.ONE,srcAlpha:1,dstAlpha:1}}),ne(em,Ip.none,{enable:!1}),ne(em,Ip.normal,{enable:!0,func:{srcRGB:Q.SRC_ALPHA,dstRGB:Q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),ne(em,Ip.subtractive,{enable:!0,func:{srcRGB:Q.ONE,dstRGB:Q.ONE,srcAlpha:Q.ZERO,dstAlpha:Q.ONE_MINUS_SRC_COLOR},equation:{rgb:Q.FUNC_SUBTRACT,alpha:Q.FUNC_SUBTRACT}}),ne(em,Ip.max,{enable:!0,func:{srcRGB:Q.ONE,dstRGB:Q.ONE},equation:{rgb:Q.MAX_EXT}}),ne(em,Ip.min,{enable:!0,func:{srcRGB:Q.ONE,dstRGB:Q.ONE},equation:{rgb:Q.MIN_EXT}}),em);function gh(e,r,t,n,i){r.updateStyleAttribute(e,t,n,i)}function XW(e,r){e.opacity&&Mx("opacity",r,e.opacity),e.strokeWidth&&Mx("strokeWidth",r,e.strokeWidth),e.strokeOpacity&&Mx("strokeOpacity",r,e.strokeOpacity),e.stroke&&ZW("stroke",r,e.stroke),e.offsets&&G4("offsets",r,e.offsets),e.textOffset&&G4("textOffset",r,e.textOffset),e.thetaOffset&&Mx("thetaOffset",r,e.thetaOffset)}function Mx(e,r,t){Vr.exports.isString(t)?gh(e,r,t,function(n){return n}):Vr.exports.isNumber(t)?gh(e,r,[t],void 0):Array.isArray(t)&&t.length===2?Vr.exports.isString(t[0])&&Vr.exports.isFunction(t[1])||Vr.exports.isString(t[0])&&Array.isArray(t[1])&&Vr.exports.isNumber(t[1][0])&&Vr.exports.isNumber(t[1][1])?gh(e,r,t[0],t[1]):gh(e,r,[1],void 0):gh(e,r,[1],void 0)}function G4(e,r,t){Vr.exports.isString(t)?gh(e,r,t,function(n){return n}):Array.isArray(t)&&t.length===2&&Vr.exports.isString(t[0])&&Vr.exports.isFunction(t[1])?gh(e,r,t[0],t[1]):Array.isArray(t)&&t.length===2&&Vr.exports.isNumber(t[0])&&Vr.exports.isNumber(t[1])?gh(e,r,t,void 0):gh(e,r,[0,0],void 0)}function ZW(e,r,t){Vr.exports.isString(t)?gh(e,r,t,void 0):Array.isArray(t)&&t.length===2&&(Vr.exports.isString(t[0])&&Vr.exports.isFunction(t[1])||Vr.exports.isString(t[0])&&Array.isArray(t[1])&&t[1].length>0)?gh(e,r,t[0],t[1]):gh(e,r,"#fff",void 0)}var j4,ME,H4,tP=(j4=Pw(Gt.IGlobalConfigService),ME=function(){function e(r){Kt(this,e),$i(this,"configService",H4,this),this.config=r}return Qt(e,[{key:"setContainer",value:function(t,n,i,a){t.bind(Gt.MapConfig).toConstantValue(tr(tr({},this.config),{},{id:n,canvas:i,hasBaseMap:a})),t.bind(Gt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),H4=ji(ME.prototype,"configService",[j4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME),rP={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Lp,function(){function t(b){var w=[];return b.AMapUI&&w.push(n(b.AMapUI)),b.Loca&&w.push(i(b.Loca)),Promise.all(w)}function n(b){return new Promise(function(w,M){var O=[];if(b.plugins)for(var N=0;N<b.plugins.length;N+=1)o.AMapUI.plugins.indexOf(b.plugins[N])==-1&&O.push(b.plugins[N]);if(l.AMapUI===a.failed)M("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(l.AMapUI===a.notload){l.AMapUI=a.loading,o.AMapUI.version=b.version||o.AMapUI.version,N=o.AMapUI.version;var z=document.body||document.head,j=document.createElement("script");j.type="text/javascript",j.src="https://webapi.amap.com/ui/"+N+"/main.js",j.onerror=function(Y){l.AMapUI=a.failed,M("\u8BF7\u6C42 AMapUI \u5931\u8D25")},j.onload=function(){if(l.AMapUI=a.loaded,O.length)window.AMapUI.loadUI(O,function(){for(var Y=0,K=O.length;Y<K;Y++){var ie=O[Y].split("/").slice(-1)[0];window.AMapUI[ie]=arguments[Y]}for(w();c.AMapUI.length;)c.AMapUI.splice(0,1)[0]()});else for(w();c.AMapUI.length;)c.AMapUI.splice(0,1)[0]()},z.appendChild(j)}else l.AMapUI===a.loaded?b.version&&b.version!==o.AMapUI.version?M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):O.length?window.AMapUI.loadUI(O,function(){for(var Y=0,K=O.length;Y<K;Y++){var ie=O[Y].split("/").slice(-1)[0];window.AMapUI[ie]=arguments[Y]}w()}):w():b.version&&b.version!==o.AMapUI.version?M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):c.AMapUI.push(function(Y){Y?M(Y):O.length?window.AMapUI.loadUI(O,function(){for(var K=0,ie=O.length;K<ie;K++){var le=O[K].split("/").slice(-1)[0];window.AMapUI[le]=arguments[K]}w()}):w()})})}function i(b){return new Promise(function(w,M){if(o.AMap.version.startsWith("2.0"))M("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(l.Loca===a.failed)M("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(l.Loca===a.notload){l.Loca=a.loading,o.Loca.version=b.version||o.Loca.version;var O=o.Loca.version,N=o.key,z=document.body||document.head,j=document.createElement("script");j.type="text/javascript",j.src="https://webapi.amap.com/loca?v="+O+"&key="+N,j.onerror=function(Y){l.Loca=a.failed,M("\u8BF7\u6C42 AMapUI \u5931\u8D25")},j.onload=function(){for(l.Loca=a.loaded,w();c.Loca.length;)c.Loca.splice(0,1)[0]()},z.appendChild(j)}else l.Loca===a.loaded?b.version&&b.version!==o.Loca.version?M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):w():b.version&&b.version!==o.Loca.version?M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):c.Loca.push(function(Y){Y?M(Y):M()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var a;(function(b){b.notload="notload",b.loading="loading",b.loaded="loaded",b.failed="failed"})(a||(a={}));var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},c={AMap:[],AMapUI:[],Loca:[]},p=[],y=function(b){typeof b=="function"&&(l.AMap===a.loaded?b(window.AMap):p.push(b))};return{load:function(b){return new Promise(function(w,M){if(l.AMap==a.failed)M("");else if(l.AMap==a.notload){var O=b.key,N=b.version,z=b.plugins;O?(window.AMap&&location.host!=="lbs.amap.com"&&M("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),o.key=O,o.AMap.version=N||o.AMap.version,o.AMap.plugins=z||o.AMap.plugins,l.AMap=a.loading,N=document.body||document.head,window.___onAPILoaded=function(Y){if(delete window.___onAPILoaded,Y)l.AMap=a.failed,M(Y);else for(l.AMap=a.loaded,t(b).then(function(){w(window.AMap)}).catch(M);p.length;)p.splice(0,1)[0]()},z=document.createElement("script"),z.type="text/javascript",z.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+O+"&plugin="+o.AMap.plugins.join(","),z.onerror=function(Y){l.AMap=a.failed,M(Y)},N.appendChild(z)):M("\u8BF7\u586B\u5199key")}else if(l.AMap==a.loaded)if(b.key&&b.key!==o.key)M("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(b.version&&b.version!==o.AMap.version)M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(O=[],b.plugins)for(N=0;N<b.plugins.length;N+=1)o.AMap.plugins.indexOf(b.plugins[N])==-1&&O.push(b.plugins[N]);O.length?window.AMap.plugin(O,function(){t(b).then(function(){w(window.AMap)}).catch(M)}):t(b).then(function(){w(window.AMap)}).catch(M)}else if(b.key&&b.key!==o.key)M("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(b.version&&b.version!==o.AMap.version)M("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var j=[];if(b.plugins)for(N=0;N<b.plugins.length;N+=1)o.AMap.plugins.indexOf(b.plugins[N])==-1&&j.push(b.plugins[N]);y(function(){j.length?window.AMap.plugin(j,function(){t(b).then(function(){w(window.AMap)}).catch(M)}):t(b).then(function(){w(window.AMap)}).catch(M)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},l={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},c={AMap:[],AMapUI:[],Loca:[]}}}})})(rP);const YW=rP.exports;var nP=function(){function e(r){Kt(this,e),ne(this,"size",1e4),this.size=r||1e4}return Qt(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}();function W4(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Object.assign({},r,e)}var vu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(vu||(vu={}));var $4={dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},X4=Math.PI/180,qW=function(){function e(){Kt(this,e),ne(this,"projectionMatrix",kp()),ne(this,"viewMatrix",kp()),ne(this,"viewProjectionMatrix",kp()),ne(this,"ViewProjectionMatrixUncentered",kp()),ne(this,"viewUncenteredMatrix",kp())}return Qt(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.pitch,o=a===void 0?0:a,l=t.bearing,c=l===void 0?0:l,p=t.center,y=p===void 0?[0,0]:p,b=t.offsetOrigin,w=b===void 0?[0,0]:b,M=t.cameraHeight,O=M===void 0?1:M,N=t.aspect,z=N===void 0?1:N,j=t.near,Y=j===void 0?.1:j,K=t.far,ie=K===void 0?1e3:K,le=t.fov,Se=le===void 0?0:le;this.zoom=i,this.center=y;var ze=o*X4,ue=(360-c)*X4;xw(this.projectionMatrix,Se,z,Y,ie);var Ke=Lc(O*Math.sin(ze)*Math.sin(ue),-O*Math.sin(ze)*Math.cos(ue),O*Math.cos(ze)),ke=Lc(-Math.cos(ze)*Math.sin(ue),Math.cos(ze)*Math.cos(ue),Math.sin(ze));aO(this.viewMatrix,Ke,Lc(0,0,0),ke),this.viewUncenteredMatrix=KR(this.viewMatrix),Pg(this.viewMatrix,this.viewMatrix,Lc(-w[0],w[1],0)),fd(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),fd(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=Pi(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,l=Math.PI/180,c=t[0]*l,p=a*l;p=Math.log(Math.tan(Math.PI/4+p/2));var y=.5/Math.PI,b=.5,w=-.5/Math.PI;return l=.5,c=o*(y*c+b)-215440491,p=-(o*(w*p+l)-106744817),[c,p]}}]),e}(),KW=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],Z4,Y4,q4,K4,Q4,J4,yy,eI,tI,rI,nI;function QW(e,r){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}QW(`.amap-logo{
 display: none !important;
}
`);var JW=0;window.forceWebGL=!0;var iI="15cd8a57710d40c9b7c0e3cc120f1200",e$="1.4.15",t$="amap-script",IE=!1,Ix=[],r$=12,n$=(Z4=oa(),Y4=na(Gt.IGlobalConfigService),q4=na(Gt.MapConfig),K4=na(Gt.ICoordinateSystemService),Q4=na(Gt.IEventEmitter),Z4(J4=(yy=function(){function e(){var r=this;Kt(this,e),ne(this,"version",vu["GAODE1.x"]),ne(this,"simpleMapCoord",new nP),ne(this,"bgColor","rgba(0, 0, 0, 0)"),$i(this,"configService",eI,this),$i(this,"config",tI,this),$i(this,"coordinateSystemService",rI,this),$i(this,"eventEmitter",nI,this),ne(this,"handleCameraChanged",function(t){var n=t.camera,i=n.fov,a=n.near,o=n.far,l=n.height,c=n.pitch,p=n.rotation,y=n.aspect,b=n.position,w=r.getCenter(),M=w.lng,O=w.lat;if(r.emit("mapchange"),r.cameraChangedCallback){r.viewport.syncWithMapCamera({aspect:y,bearing:360-p,far:o,fov:i,cameraHeight:l,near:a,pitch:c,zoom:r.map.getZoom()-1,center:[M,O],offsetOrigin:[b.x,b.y]});var N=r.config.offsetZoom,z=N===void 0?r$:N;r.viewport.getZoom()>z?r.coordinateSystemService.setCoordinateSystem(Uv.P20_OFFSET):r.coordinateSystemService.setCoordinateSystem(Uv.P20),r.cameraChangedCallback(r.viewport)}})}return Qt(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=Ul("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){eS.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){eS.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=Pi(i,2);a[0],a[1];var o=W4(t.padding),l=this.lngLatToPixel([n.lng,n.lat]),c=[(o.right-o.left)/2,(o.bottom-o.top)/2],p=this.pixelToLngLat([l.x-c[0],l.y-c[1]]);return p}var y=this.map.getCenter();return{lng:y.getLng(),lat:y.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=W4(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],l=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([l.lng,l.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),l=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[l,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t+1,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),i=n.x,a=n.y;return[i,-a]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=this.viewport.projectFlat(t),l=kp();return Pg(l,l,Lc(o[0],o[1],n)),$y(l,l,Lc(a[0],a[1],a[2])),Y1(l,l,i[0]),t2(l,l,i[1]),r2(l,l,i[2]),l}},{key:"init",value:function(){var r=eo(Xn.mark(function n(){var i=this,a,o,l,c,p,y,b,w,M,O,N,z,j,Y;return Xn.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return a=this.config,o=a.id,l=a.style,c=l===void 0?"light":l,p=a.minZoom,y=p===void 0?0:p,b=a.maxZoom,w=b===void 0?18:b,M=a.token,O=M===void 0?iI:M,N=a.mapInstance,z=a.plugin,j=z===void 0?[]:z,Y=b0(a,KW),ie.next=3,new Promise(function(le){var Se=function(){if(N)i.map=N,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),le()},30);else{i.$mapContainer=i.creatAmapContainer(o);var ue=tr({mapStyle:i.getMapStyle(c),zooms:[y,w],viewMode:"3D"},Y);ue.zoom&&(ue.zoom+=1);var Ke=new AMap.Map(i.$mapContainer,ue);Ke.on("camerachange",i.handleCameraChanged),Ke.on("camerachange",function(){setTimeout(function(){return i.handleAfterMapChange()})}),i.map=Ke,setTimeout(function(){le()},10)}};!IE&&!N?(O===iI&&console.warn(i.configService.getSceneWarninfo("MapToken")),IE=!0,j.push("Map3D"),YW.load({key:O,version:e$,plugins:j}).then(function(ze){Se(),Ix.length&&(Ix.forEach(function(ue){return ue()}),Ix=[])}).catch(function(ze){throw new Error(ze)})):IE&&window.AMap||N?Se():Ix.push(Se)});case 3:this.viewport=new qW;case 4:case"end":return ie.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(By(AMap.LngLat,zn(t)),By(AMap.LngLat,zn(n))),a=this.lngLatToCoord(t),o=Pi(a,2),l=o[0],c=o[1],p=this.lngLatToCoord(n),y=Pi(p,2),b=y[0],w=y[1],M=Math.sqrt(Math.pow(l-b,2)+Math.pow(c-w,2));return M/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(t$);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(t){return $4[t]?$4[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+JW++,n.appendChild(i),i}}]),e}(),eI=ji(yy.prototype,"configService",[Y4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=ji(yy.prototype,"config",[q4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=ji(yy.prototype,"coordinateSystemService",[K4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nI=ji(yy.prototype,"eventEmitter",[Q4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy))||J4);function i$(e){var r=a$();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function a$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var o$=function(e){On(t,e);var r=i$(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getServiceConstructor",value:function(){return n$}}]),t}(tP);function u1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Qx(e,r){var t=bw([],r,e);return q9(t,t,1/t[3]),t}function Dg(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var Wd=Math.PI,iP=Wd/4,gm=Wd/180,aI=180/Wd,Fw=512,oI=4003e4,s$=1.5;function aP(e){return Math.pow(2,e)}function LE(e,r){var t=Pi(e,2),n=t[0],i=t[1];Dg(Number.isFinite(n)&&Number.isFinite(r)),Dg(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=Fw;var a=n*gm,o=i*gm,l=r*(a+Wd)/(2*Wd),c=r*(Wd-Math.log(Math.tan(iP+o*.5)))/(2*Wd);return[l,c]}function sI(e,r){var t=Pi(e,2),n=t[0],i=t[1];r*=Fw;var a=n/r*(2*Wd)-Wd,o=2*(Math.atan(Math.exp(Wd-i/r*(2*Wd)))-iP);return[a*aI,o*aI]}function u$(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,o=a===void 0?!1:a;i=i!==void 0?i:aP(n),Dg(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},c=Fw*i,p=Math.cos(r*gm),y=c/360,b=y/p,w=c/oI/p;if(l.pixelsPerMeter=[w,-w,w],l.metersPerPixel=[1/w,-1/w,1/w],l.pixelsPerDegree=[y,-b,w],l.degreesPerPixel=[1/y,-1/b,1/w],o){var M=gm*Math.tan(r*gm)/p,O=y*M/2,N=c/oI*M,z=N/b*w;l.pixelsPerDegree2=[0,-O,N],l.pixelsPerMeter2=[z,0,z]}return l}function l$(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,o=a===void 0?null:a,l=e.flipY,c=l===void 0?!1:l,p=u1();return Pg(p,p,[0,0,-i]),$y(p,p,[1,1,1/r]),Y1(p,p,-t*gm),r2(p,p,n*gm),c&&$y(p,p,[1,-1,1]),o&&Pg(p,p,dO([],o)),p}function c$(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?s$:n,a=e.pitch,o=a===void 0?0:a,l=e.nearZMultiplier,c=l===void 0?1:l,p=e.farZMultiplier,y=p===void 0?1:p,b=o*gm,w=Math.atan(.5/i),M=Math.sin(w)*i/Math.sin(Math.PI/2-b-w),O=Math.cos(Math.PI/2-b)*M+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:c,far:O*y}}function f$(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,o=e.farZMultiplier,l=c$({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:o}),c=l.fov,p=l.aspect,y=l.near,b=l.far,w=xw([],c,p,y,b);return w}function h$(e,r){var t=Pi(e,3),n=t[0],i=t[1],a=t[2],o=a===void 0?0:a;return Dg(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),Qx(r,[n,i,o,1])}function oP(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Pi(e,3),i=n[0],a=n[1],o=n[2];if(Dg(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var l=Qx(r,[i,a,o,1]);return l}var c=Qx(r,[i,a,0,1]),p=Qx(r,[i,a,1,1]),y=c[2],b=p[2],w=y===b?0:((t||0)-y)/(b-y);return Q9([],c,p,w)}var uI=u1(),p$=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?uI:i,o=r.projectionMatrix,l=o===void 0?uI:o;Kt(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var c=u1();fd(c,c,this.projectionMatrix),fd(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var p=u1();$y(p,p,[this.width/2,-this.height/2,1]),Pg(p,p,[1,-1,0]),fd(p,p,this.viewProjectionMatrix);var y=_w(u1(),p);if(!y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Qt(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&MC(t.projectionMatrix,this.projectionMatrix)&&MC(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(t),l=h$(o,this.pixelProjectionMatrix),c=Pi(l,2),p=c[0],y=c[1],b=a?y:this.height-y;return t.length===2?[p,b]:[p,b,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,l=Pi(t,3),c=l[0],p=l[1],y=l[2],b=a?p:this.height-p,w=o&&o*this.pixelsPerMeter,M=oP([c,b,y],this.pixelUnprojectionMatrix,w),O=this.unprojectPosition(M),N=Pi(O,3),z=N[0],j=N[1],Y=N[2];return Number.isFinite(y)?[z,j,Y]:Number.isFinite(o)?[z,j,o]:[z,j]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=Pi(n,2),a=i[0],o=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,o,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=Pi(n,2),a=i[0],o=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,o,l]}},{key:"projectFlat",value:function(t){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,t}},{key:"unprojectFlat",value:function(t){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,t}}]),e}();function d$(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,o=e.maxZoom,l=o===void 0?24:o,c=e.padding,p=c===void 0?0:c,y=e.offset,b=y===void 0?[0,0]:y,w=Pi(n,2),M=Pi(w[0],2),O=M[0],N=M[1],z=Pi(w[1],2),j=z[0],Y=z[1];if(Number.isFinite(p)){var K=p;p={top:K,bottom:K,left:K,right:K}}else Dg(Number.isFinite(p.top)&&Number.isFinite(p.bottom)&&Number.isFinite(p.left)&&Number.isFinite(p.right));var ie=new sP({width:r,height:t,longitude:0,latitude:0,zoom:0}),le=ie.project([O,Y]),Se=ie.project([j,N]),ze=[Math.max(Math.abs(Se[0]-le[0]),a),Math.max(Math.abs(Se[1]-le[1]),a)],ue=[r-p.left-p.right-Math.abs(b[0])*2,t-p.top-p.bottom-Math.abs(b[1])*2];Dg(ue[0]>0&&ue[1]>0);var Ke=ue[0]/ze[0],ke=ue[1]/ze[1],Ce=(p.right-p.left)/2/Ke,je=(p.bottom-p.top)/2/ke,ve=[(Se[0]+le[0])/2+Ce,(Se[1]+le[1])/2+je],Ie=ie.unproject(ve),dt=ie.zoom+Math.log2(Math.abs(Math.min(Ke,ke)));return{longitude:Ie[0],latitude:Ie[1],zoom:Math.min(dt,l)}}var sP=function(e){On(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,o=n.latitude,l=o===void 0?0:o,c=n.longitude,p=c===void 0?0:c,y=n.zoom,b=y===void 0?0:y,w=n.pitch,M=w===void 0?0:w,O=n.bearing,N=O===void 0?0:O,z=n.altitude,j=z===void 0?1.5:z,Y=n.nearZMultiplier,K=n.farZMultiplier;Kt(this,r),i=i||1,a=a||1;var ie=aP(b);j=Math.max(.75,j);var le=LE([p,l],ie);le[2]=0;var Se=f$({width:i,height:a,pitch:M,bearing:N,altitude:j,nearZMultiplier:Y||1/a,farZMultiplier:K||1.01}),ze=l$({height:a,center:le,pitch:M,bearing:N,altitude:j,flipY:!0});return t=Fn(this,At(r).call(this,{width:i,height:a,viewMatrix:ze,projectionMatrix:Se})),t.latitude=l,t.longitude=p,t.zoom=b,t.pitch=M,t.bearing=N,t.altitude=j,t.scale=ie,t.center=le,t.pixelsPerMeter=u$(vt(vt(t))).pixelsPerMeter[2],Object.freeze(vt(vt(t))),t}return Qt(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return LE(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return sI(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,o=oP(a,this.pixelUnprojectionMatrix),l=LE(i,this.scale),c=qu([],l,K9([],o)),p=qu([],this.center,c);return sI(p,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,o=this.height,l=d$(Object.assign({width:a,height:o,bounds:n},i)),c=l.longitude,p=l.latitude,y=l.zoom;return new r({width:a,height:o,longitude:c,latitude:p,zoom:y})}}]),r}(p$),uP={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Lp,function(){var t,n,i;function a(o,l){if(!t)t=l;else if(!n)n=l;else{var c="var sharedChunk = {}; ("+t+")(sharedChunk); ("+n+")(sharedChunk);",p={};t(p),i=l(p),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([c],{type:"text/javascript"})))}}return a(["exports"],function(o){function l(s,u){return s(u={exports:{}},u.exports),u.exports}var c=p;function p(s,u,h,_){this.cx=3*s,this.bx=3*(h-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(_-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=_,this.p2x=h,this.p2y=_}p.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},p.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},p.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},p.prototype.solveCurveX=function(s,u){var h,_,E,A,I;for(u===void 0&&(u=1e-6),E=s,I=0;I<8;I++){if(A=this.sampleCurveX(E)-s,Math.abs(A)<u)return E;var D=this.sampleCurveDerivativeX(E);if(Math.abs(D)<1e-6)break;E-=A/D}if((E=s)<(h=0))return h;if(E>(_=1))return _;for(;h<_;){if(A=this.sampleCurveX(E),Math.abs(A-s)<u)return E;s>A?h=E:_=E,E=.5*(_-h)+h}return E},p.prototype.solve=function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))};var y=b;function b(s,u){this.x=s,this.y=u}b.prototype={clone:function(){return new b(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,u){return this.clone()._rotateAround(s,u)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var u=s.x-this.x,h=s.y-this.y;return u*u+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,u){return Math.atan2(this.x*u-this.y*s,this.x*s+this.y*u)},_matMult:function(s){var u=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=u,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var u=Math.cos(s),h=Math.sin(s),_=h*this.x+u*this.y;return this.x=u*this.x-h*this.y,this.y=_,this},_rotateAround:function(s,u){var h=Math.cos(s),_=Math.sin(s),E=u.y+_*(this.x-u.x)+h*(this.y-u.y);return this.x=u.x+h*(this.x-u.x)-_*(this.y-u.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},b.convert=function(s){return s instanceof b?s:Array.isArray(s)?new b(s[0],s[1]):s};var w=typeof self<"u"?self:{},M=Math.pow(2,53)-1;function O(s,u,h,_){var E=new c(s,u,h,_);return function(A){return E.solve(A)}}var N=O(.25,.1,.25,1);function z(s,u,h){return Math.min(h,Math.max(u,s))}function j(s,u,h){var _=h-u,E=((s-u)%_+_)%_+u;return E===u?h:E}function Y(s){for(var u=[],h=arguments.length-1;h-- >0;)u[h]=arguments[h+1];for(var _=0,E=u;_<E.length;_+=1){var A=E[_];for(var I in A)s[I]=A[I]}return s}var K=1;function ie(){return K++}function le(){return function s(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Se(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function ze(s,u){s.forEach(function(h){u[h]&&(u[h]=u[h].bind(u))})}function ue(s,u){return s.indexOf(u,s.length-u.length)!==-1}function Ke(s,u,h){var _={};for(var E in s)_[E]=u.call(h||this,s[E],E,s);return _}function ke(s,u,h){var _={};for(var E in s)u.call(h||this,s[E],E,s)&&(_[E]=s[E]);return _}function Ce(s){return Array.isArray(s)?s.map(Ce):typeof s=="object"&&s?Ke(s,Ce):s}var je={};function ve(s){je[s]||(typeof console<"u"&&console.warn(s),je[s]=!0)}function Ie(s,u,h){return(h.y-s.y)*(u.x-s.x)>(u.y-s.y)*(h.x-s.x)}function dt(s){for(var u=0,h=0,_=s.length,E=_-1,A=void 0,I=void 0;h<_;E=h++)u+=((I=s[E]).x-(A=s[h]).x)*(A.y+I.y);return u}function St(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rt(s){var u={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(_,E,A,I){var D=A||I;return u[E]=!D||D.toLowerCase(),""}),u["max-age"]){var h=parseInt(u["max-age"],10);isNaN(h)?delete u["max-age"]:u["max-age"]=h}return u}var $t=null;function gt(s){if($t==null){var u=s.navigator?s.navigator.userAgent:null;$t=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return $t}function jr(s){try{var u=w[s];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var Er,rn,dn,Rn,Ar=w.performance&&w.performance.now?w.performance.now.bind(w.performance):Date.now.bind(Date),xa=w.requestAnimationFrame||w.mozRequestAnimationFrame||w.webkitRequestAnimationFrame||w.msRequestAnimationFrame,Ti=w.cancelAnimationFrame||w.mozCancelAnimationFrame||w.webkitCancelAnimationFrame||w.msCancelAnimationFrame,Sa={now:Ar,frame:function(s){var u=xa(s);return{cancel:function(){return Ti(u)}}},getImageData:function(s,u){u===void 0&&(u=0);var h=w.document.createElement("canvas"),_=h.getContext("2d");if(!_)throw new Error("failed to create canvas 2d context");return h.width=s.width,h.height=s.height,_.drawImage(s,0,0,s.width,s.height),_.getImageData(-u,-u,s.width+2*u,s.height+2*u)},resolveURL:function(s){return Er||(Er=w.document.createElement("a")),Er.href=s,Er.href},hardwareConcurrency:w.navigator&&w.navigator.hardwareConcurrency||4,get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(rn==null&&(rn=w.matchMedia("(prefers-reduced-motion: reduce)")),rn.matches)}},hr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Dr={supported:!1,testSupport:function(s){!Kn&&Rn&&(Wt?Me(s):dn=s)}},Kn=!1,Wt=!1;function Me(s){var u=s.createTexture();s.bindTexture(s.TEXTURE_2D,u);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Rn),s.isContextLost())return;Dr.supported=!0}catch{}s.deleteTexture(u),Kn=!0}w.document&&((Rn=w.document.createElement("img")).onload=function(){dn&&Me(dn),dn=null,Wt=!0},Rn.onerror=function(){Kn=!0,dn=null},Rn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Qe="01",Ct=function(s,u){this._transformRequestFn=s,this._customAccessToken=u,this._createSkuToken()};function Yt(s){return s.indexOf("mapbox:")===0}Ct.prototype._createSkuToken=function(){var s=function(){for(var u="",h=0;h<10;h++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qe,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt},Ct.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ct.prototype.transformRequest=function(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}},Ct.prototype.normalizeStyleURL=function(s,u){if(!Yt(s))return s;var h=xr(s);return h.path="/styles/v1"+h.path,this._makeAPIURL(h,this._customAccessToken||u)},Ct.prototype.normalizeGlyphsURL=function(s,u){if(!Yt(s))return s;var h=xr(s);return h.path="/fonts/v1"+h.path,this._makeAPIURL(h,this._customAccessToken||u)},Ct.prototype.normalizeSourceURL=function(s,u){if(!Yt(s))return s;var h=xr(s);return h.path="/v4/"+h.authority+".json",h.params.push("secure"),this._makeAPIURL(h,this._customAccessToken||u)},Ct.prototype.normalizeSpriteURL=function(s,u,h,_){var E=xr(s);return Yt(s)?(E.path="/styles/v1"+E.path+"/sprite"+u+h,this._makeAPIURL(E,this._customAccessToken||_)):(E.path+=""+u+h,kr(E))},Ct.prototype.normalizeTileURL=function(s,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Yt(s))return s;var h=xr(s);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Sa.devicePixelRatio>=2||u===512?"@2x":"")+(Dr.supported?".webp":"$1")),h.path=h.path.replace(/^.+\/v4\//,"/"),h.path="/v4"+h.path;var _=this._customAccessToken||function(E){for(var A=0,I=E;A<I.length;A+=1){var D=I[A].match(/^access_token=(.*)$/);if(D)return D[1]}return null}(h.params)||hr.ACCESS_TOKEN;return hr.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&h.params.push("sku="+this._skuToken),this._makeAPIURL(h,_)},Ct.prototype.canonicalizeTileURL=function(s,u){var h=xr(s);if(!h.path.match(/(^\/v4\/)/)||!h.path.match(/\.[\w]+$/))return s;var _="mapbox://tiles/";_+=h.path.replace("/v4/","");var E=h.params;return u&&(E=E.filter(function(A){return!A.match(/^access_token=/)})),E.length&&(_+="?"+E.join("&")),_},Ct.prototype.canonicalizeTileset=function(s,u){for(var h=!!u&&Yt(u),_=[],E=0,A=s.tiles||[];E<A.length;E+=1){var I=A[E];_r(I)?_.push(this.canonicalizeTileURL(I,h)):_.push(I)}return _},Ct.prototype._makeAPIURL=function(s,u){var h="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",_=xr(hr.API_URL);if(s.protocol=_.protocol,s.authority=_.authority,s.protocol==="http"){var E=s.params.indexOf("secure");E>=0&&s.params.splice(E,1)}if(_.path!=="/"&&(s.path=""+_.path+s.path),!hr.REQUIRE_ACCESS_TOKEN)return kr(s);if(!(u=u||hr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+h);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+h);return s.params=s.params.filter(function(A){return A.indexOf("access_token")===-1}),s.params.push("access_token="+u),kr(s)};var qt=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function _r(s){return qt.test(s)}var Pr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xr(s){var u=s.match(Pr);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function kr(s){var u=s.params.length?"?"+s.params.join("&"):"";return s.protocol+"://"+s.authority+s.path+u}function vr(s){if(!s)return null;var u=s.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(u[1]).split("").map(function(h){return"%"+("00"+h.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var In=function(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};In.prototype.getStorageKey=function(s){var u,h=vr(hr.ACCESS_TOKEN);return u=h&&h.u?w.btoa(encodeURIComponent(h.u).replace(/%([0-9A-F]{2})/g,function(_,E){return String.fromCharCode(Number("0x"+E))})):hr.ACCESS_TOKEN||"",s?"mapbox.eventData."+s+":"+u:"mapbox.eventData:"+u},In.prototype.fetchEventData=function(){var s=jr("localStorage"),u=this.getStorageKey(),h=this.getStorageKey("uuid");if(s)try{var _=w.localStorage.getItem(u);_&&(this.eventData=JSON.parse(_));var E=w.localStorage.getItem(h);E&&(this.anonId=E)}catch{ve("Unable to read from LocalStorage")}},In.prototype.saveEventData=function(){var s=jr("localStorage"),u=this.getStorageKey(),h=this.getStorageKey("uuid");if(s)try{w.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ve("Unable to write to LocalStorage")}},In.prototype.processRequests=function(s){},In.prototype.postEvent=function(s,u,h,_){var E=this;if(hr.EVENTS_URL){var A=xr(hr.EVENTS_URL);A.params.push("access_token="+(_||hr.ACCESS_TOKEN||""));var I={event:this.type,created:new Date(s).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Qe,userId:this.anonId},D=u?Y(I,u):I,V={url:kr(A),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=uo(V,function($){E.pendingRequest=null,h($),E.saveEventData(),E.processRequests(_)})}},In.prototype.queueRequest=function(s,u){this.queue.push(s),this.processRequests(u)};var W,st,zt=function(s){function u(){s.call(this,"map.load"),this.success={},this.skuToken=""}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(h,_,E,A){this.skuToken=E,(hr.EVENTS_URL&&A||hr.ACCESS_TOKEN&&Array.isArray(h)&&h.some(function(I){return Yt(I)||_r(I)}))&&this.queueRequest({id:_,timestamp:Date.now()},A)},u.prototype.processRequests=function(h){var _=this;if(!this.pendingRequest&&this.queue.length!==0){var E=this.queue.shift(),A=E.id,I=E.timestamp;A&&this.success[A]||(this.anonId||this.fetchEventData(),Se(this.anonId)||(this.anonId=le()),this.postEvent(I,{skuToken:this.skuToken},function(D){D||A&&(_.success[A]=!0)},h))}},u}(In),mr=new(function(s){function u(h){s.call(this,"appUserTurnstile"),this._customAccessToken=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(h,_){hr.EVENTS_URL&&hr.ACCESS_TOKEN&&Array.isArray(h)&&h.some(function(E){return Yt(E)||_r(E)})&&this.queueRequest(Date.now(),_)},u.prototype.processRequests=function(h){var _=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var E=vr(hr.ACCESS_TOKEN),A=E?E.u:hr.ACCESS_TOKEN,I=A!==this.eventData.tokenU;Se(this.anonId)||(this.anonId=le(),I=!0);var D=this.queue.shift();if(this.eventData.lastSuccess){var V=new Date(this.eventData.lastSuccess),$=new Date(D),q=(D-this.eventData.lastSuccess)/864e5;I=I||q>=1||q<-1||V.getDate()!==$.getDate()}else I=!0;if(!I)return this.processRequests();this.postEvent(D,{"enabled.telemetry":!1},function(te){te||(_.eventData.lastSuccess=D,_.eventData.tokenU=A)},h)}},u}(In)),fr=mr.postTurnstileEvent.bind(mr),nn=new zt,Mn=nn.postMapLoadEvent.bind(nn),Wn=500,Bn=50;function Mi(){w.caches&&!W&&(W=w.caches.open("mapbox-tiles"))}function mi(s){var u=s.indexOf("?");return u<0?s:s.slice(0,u)}var mo,ca=1/0;function Ki(){return mo==null&&(mo=w.OffscreenCanvas&&new w.OffscreenCanvas(1,1).getContext("2d")&&typeof w.createImageBitmap=="function"),mo}var yl={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(yl);var Xi=function(s){function u(h,_,E){_===401&&_r(E)&&(h+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),s.call(this,h),this.status=_,this.url=E,this.name=this.constructor.name,this.message=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),nu=St()?function(){return self.worker&&self.worker.referrer}:function(){return(w.location.protocol==="blob:"?w.parent:w).location.href},mu,iu,pf=function(s,u){if(!(/^file:/.test(h=s.url)||/^file:/.test(nu())&&!/^\w+:/.test(h))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return function(_,E){var A,I=new w.AbortController,D=new w.Request(_.url,{method:_.method||"GET",body:_.body,credentials:_.credentials,headers:_.headers,referrer:nu(),signal:I.signal}),V=!1,$=!1,q=(A=D.url).indexOf("sku=")>0&&_r(A);_.type==="json"&&D.headers.set("Accept","application/json");var te=function(fe,Pe,De){if(!$){if(fe&&fe.message!=="SecurityError"&&ve(fe),Pe&&De)return oe(Pe);var tt=Date.now();w.fetch(D).then(function(We){if(We.ok){var lt=q?We.clone():null;return oe(We,lt,tt)}return E(new Xi(We.statusText,We.status,_.url))}).catch(function(We){We.code!==20&&E(new Error(We.message))})}},oe=function(fe,Pe,De){(_.type==="arrayBuffer"?fe.arrayBuffer():_.type==="json"?fe.json():fe.text()).then(function(tt){$||(Pe&&De&&function(We,lt,xt){if(Mi(),W){var Lt={status:lt.status,statusText:lt.statusText,headers:new w.Headers};lt.headers.forEach(function(nr,Fr){return Lt.headers.set(Fr,nr)});var Pt=Rt(lt.headers.get("Cache-Control")||"");Pt["no-store"]||(Pt["max-age"]&&Lt.headers.set("Expires",new Date(xt+1e3*Pt["max-age"]).toUTCString()),new Date(Lt.headers.get("Expires")).getTime()-xt<42e4||function(nr,Fr){if(st===void 0)try{new Response(new ReadableStream),st=!0}catch{st=!1}st?Fr(nr.body):nr.blob().then(Fr)}(lt,function(nr){var Fr=new w.Response(nr,Lt);Mi(),W&&W.then(function(tn){return tn.put(mi(We.url),Fr)}).catch(function(tn){return ve(tn.message)})}))}}(D,Pe,De),V=!0,E(null,tt,fe.headers.get("Cache-Control"),fe.headers.get("Expires")))}).catch(function(tt){$||E(new Error(tt.message))})};return q?function(fe,Pe){if(Mi(),!W)return Pe(null);var De=mi(fe.url);W.then(function(tt){tt.match(De).then(function(We){var lt=function(xt){if(!xt)return!1;var Lt=new Date(xt.headers.get("Expires")||0),Pt=Rt(xt.headers.get("Cache-Control")||"");return Lt>Date.now()&&!Pt["no-cache"]}(We);tt.delete(De),lt&&tt.put(De,We.clone()),Pe(null,We,lt)}).catch(Pe)}).catch(Pe)}(D,te):te(null,null),{cancel:function(){$=!0,V||I.abort()}}}(s,u);if(St()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,u,void 0,!0)}var h;return function(_,E){var A=new w.XMLHttpRequest;for(var I in A.open(_.method||"GET",_.url,!0),_.type==="arrayBuffer"&&(A.responseType="arraybuffer"),_.headers)A.setRequestHeader(I,_.headers[I]);return _.type==="json"&&(A.responseType="text",A.setRequestHeader("Accept","application/json")),A.withCredentials=_.credentials==="include",A.onerror=function(){E(new Error(A.statusText))},A.onload=function(){if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){var D=A.response;if(_.type==="json")try{D=JSON.parse(A.response)}catch(V){return E(V)}E(null,D,A.getResponseHeader("Cache-Control"),A.getResponseHeader("Expires"))}else E(new Xi(A.statusText,A.status,_.url))},A.send(_.body),{cancel:function(){return A.abort()}}}(s,u)},Fu=function(s,u){return pf(Y(s,{type:"arrayBuffer"}),u)},uo=function(s,u){return pf(Y(s,{method:"POST"}),u)},J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mu=[],iu=0;var ae=function(s,u){if(Dr.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),iu>=hr.MAX_PARALLEL_IMAGE_REQUESTS){var h={requestParameters:s,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return mu.push(h),h}iu++;var _=!1,E=function(){if(!_)for(_=!0,iu--;mu.length&&iu<hr.MAX_PARALLEL_IMAGE_REQUESTS;){var I=mu.shift();I.cancelled||(I.cancel=ae(I.requestParameters,I.callback).cancel)}},A=Fu(s,function(I,D,V,$){E(),I?u(I):D&&(Ki()?function(q,te){var oe=new w.Blob([new Uint8Array(q)],{type:"image/png"});w.createImageBitmap(oe).then(function(fe){te(null,fe)}).catch(function(fe){te(new Error("Could not load image because of "+fe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(D,u):function(q,te,oe,fe){var Pe=new w.Image,De=w.URL;Pe.onload=function(){te(null,Pe),De.revokeObjectURL(Pe.src),Pe.onload=null,w.requestAnimationFrame(function(){Pe.src=J})},Pe.onerror=function(){return te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var tt=new w.Blob([new Uint8Array(q)],{type:"image/png"});Pe.cacheControl=oe,Pe.expires=fe,Pe.src=q.byteLength?De.createObjectURL(tt):J}(D,u,V,$))});return{cancel:function(){A.cancel(),E()}}};function ce(s,u,h){h[s]&&h[s].indexOf(u)!==-1||(h[s]=h[s]||[],h[s].push(u))}function be(s,u,h){if(h&&h[s]){var _=h[s].indexOf(u);_!==-1&&h[s].splice(_,1)}}var Be=function(s,u){u===void 0&&(u={}),Y(this,u),this.type=s},et=function(s){function u(h,_){_===void 0&&(_={}),s.call(this,"error",Y({error:h},_))}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Be),ot=function(){};ot.prototype.on=function(s,u){return this._listeners=this._listeners||{},ce(s,u,this._listeners),this},ot.prototype.off=function(s,u){return be(s,u,this._listeners),be(s,u,this._oneTimeListeners),this},ot.prototype.once=function(s,u){return this._oneTimeListeners=this._oneTimeListeners||{},ce(s,u,this._oneTimeListeners),this},ot.prototype.fire=function(s,u){typeof s=="string"&&(s=new Be(s,u||{}));var h=s.type;if(this.listens(h)){s.target=this;for(var _=0,E=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];_<E.length;_+=1)E[_].call(this,s);for(var A=0,I=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];A<I.length;A+=1){var D=I[A];be(h,D,this._oneTimeListeners),D.call(this,s)}var V=this._eventedParent;V&&(Y(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(s))}else s instanceof et&&console.error(s.error);return this},ot.prototype.listens=function(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)},ot.prototype.setEventedParent=function(s,u){return this._eventedParent=s,this._eventedParentData=u,this};var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ve=function(s,u,h,_){this.message=(s?s+": ":"")+h,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)};function mt(s){var u=s.value;return u?[new Ve(s.key,u,"constants have been deprecated as of v8")]:[]}function Jt(s){for(var u=[],h=arguments.length-1;h-- >0;)u[h]=arguments[h+1];for(var _=0,E=u;_<E.length;_+=1){var A=E[_];for(var I in A)s[I]=A[I]}return s}function Cr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Dt(s){if(Array.isArray(s))return s.map(Dt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){var u={};for(var h in s)u[h]=Dt(s[h]);return u}return Cr(s)}var pr=function(s){function u(h,_){s.call(this,_),this.message=_,this.key=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Error),Nr=function(s,u){u===void 0&&(u=[]),this.parent=s,this.bindings={};for(var h=0,_=u;h<_.length;h+=1){var E=_[h];this.bindings[E[0]]=E[1]}};Nr.prototype.concat=function(s){return new Nr(this,s)},Nr.prototype.get=function(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(s+" not found in scope.")},Nr.prototype.has=function(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)};var xn={kind:"null"},Bt={kind:"number"},ln={kind:"string"},Wr={kind:"boolean"},Zr={kind:"color"},gi={kind:"object"},Jr={kind:"value"},bi={kind:"collator"},ci={kind:"formatted"},Ci={kind:"resolvedImage"};function Fi(s,u){return{kind:"array",itemType:s,N:u}}function Di(s){if(s.kind==="array"){var u=Di(s.itemType);return typeof s.N=="number"?"array<"+u+", "+s.N+">":s.itemType.kind==="value"?"array":"array<"+u+">"}return s.kind}var ls=[xn,Bt,ln,Wr,Zr,ci,gi,Fi(Jr),Ci];function sa(s,u){if(u.kind==="error")return null;if(s.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!sa(s.itemType,u.itemType))&&(typeof s.N!="number"||s.N===u.N))return null}else{if(s.kind===u.kind)return null;if(s.kind==="value"){for(var h=0,_=ls;h<_.length;h+=1)if(!sa(_[h],u))return null}}return"Expected "+Di(s)+" but found "+Di(u)+" instead."}function Zi(s,u){return u.some(function(h){return h.kind===s.kind})}function ia(s,u){return u.some(function(h){return h==="null"?s===null:h==="array"?Array.isArray(s):h==="object"?s&&!Array.isArray(s)&&typeof s=="object":h===typeof s})}var pi=l(function(s,u){var h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _(D){return(D=Math.round(D))<0?0:D>255?255:D}function E(D){return _(D[D.length-1]==="%"?parseFloat(D)/100*255:parseInt(D))}function A(D){return(V=D[D.length-1]==="%"?parseFloat(D)/100:parseFloat(D))<0?0:V>1?1:V;var V}function I(D,V,$){return $<0?$+=1:$>1&&($-=1),6*$<1?D+(V-D)*$*6:2*$<1?V:3*$<2?D+(V-D)*(2/3-$)*6:D}try{u.parseCSSColor=function(D){var V,$=D.replace(/ /g,"").toLowerCase();if($ in h)return h[$].slice();if($[0]==="#")return $.length===4?(V=parseInt($.substr(1),16))>=0&&V<=4095?[(3840&V)>>4|(3840&V)>>8,240&V|(240&V)>>4,15&V|(15&V)<<4,1]:null:$.length===7&&(V=parseInt($.substr(1),16))>=0&&V<=16777215?[(16711680&V)>>16,(65280&V)>>8,255&V,1]:null;var q=$.indexOf("("),te=$.indexOf(")");if(q!==-1&&te+1===$.length){var oe=$.substr(0,q),fe=$.substr(q+1,te-(q+1)).split(","),Pe=1;switch(oe){case"rgba":if(fe.length!==4)return null;Pe=A(fe.pop());case"rgb":return fe.length!==3?null:[E(fe[0]),E(fe[1]),E(fe[2]),Pe];case"hsla":if(fe.length!==4)return null;Pe=A(fe.pop());case"hsl":if(fe.length!==3)return null;var De=(parseFloat(fe[0])%360+360)%360/360,tt=A(fe[1]),We=A(fe[2]),lt=We<=.5?We*(tt+1):We+tt-We*tt,xt=2*We-lt;return[_(255*I(xt,lt,De+1/3)),_(255*I(xt,lt,De)),_(255*I(xt,lt,De-1/3)),Pe];default:return null}}return null}}catch{}}).parseCSSColor,Li=function(s,u,h,_){_===void 0&&(_=1),this.r=s,this.g=u,this.b=h,this.a=_};Li.parse=function(s){if(s){if(s instanceof Li)return s;if(typeof s=="string"){var u=pi(s);if(u)return new Li(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Li.prototype.toString=function(){var s=this.toArray(),u=s[1],h=s[2],_=s[3];return"rgba("+Math.round(s[0])+","+Math.round(u)+","+Math.round(h)+","+_+")"},Li.prototype.toArray=function(){var s=this.a;return s===0?[0,0,0,0]:[255*this.r/s,255*this.g/s,255*this.b/s,s]},Li.black=new Li(0,0,0,1),Li.white=new Li(1,1,1,1),Li.transparent=new Li(0,0,0,0),Li.red=new Li(1,0,0,1);var go=function(s,u,h){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};go.prototype.compare=function(s,u){return this.collator.compare(s,u)},go.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var pa=function(s,u,h,_,E){this.text=s,this.image=u,this.scale=h,this.fontStack=_,this.textColor=E},Za=function(s){this.sections=s};Za.fromString=function(s){return new Za([new pa(s,null,null,null,null)])},Za.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(s){return s.text.length!==0||s.image&&s.image.name.length!==0})},Za.factory=function(s){return s instanceof Za?s:Za.fromString(s)},Za.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(s){return s.text}).join("")},Za.prototype.serialize=function(){for(var s=["format"],u=0,h=this.sections;u<h.length;u+=1){var _=h[u];if(_.image)s.push(["image",_.image.name]);else{s.push(_.text);var E={};_.fontStack&&(E["text-font"]=["literal",_.fontStack.split(",")]),_.scale&&(E["font-scale"]=_.scale),_.textColor&&(E["text-color"]=["rgba"].concat(_.textColor.toArray())),s.push(E)}}return s};var da=function(s){this.name=s.name,this.available=s.available};function Xf(s,u,h,_){return typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof h=="number"&&h>=0&&h<=255?_===void 0||typeof _=="number"&&_>=0&&_<=1?null:"Invalid rgba value ["+[s,u,h,_].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof _=="number"?[s,u,h,_]:[s,u,h]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Hl(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Li||s instanceof go||s instanceof Za||s instanceof da)return!0;if(Array.isArray(s)){for(var u=0,h=s;u<h.length;u+=1)if(!Hl(h[u]))return!1;return!0}if(typeof s=="object"){for(var _ in s)if(!Hl(s[_]))return!1;return!0}return!1}function ki(s){if(s===null)return xn;if(typeof s=="string")return ln;if(typeof s=="boolean")return Wr;if(typeof s=="number")return Bt;if(s instanceof Li)return Zr;if(s instanceof go)return bi;if(s instanceof Za)return ci;if(s instanceof da)return Ci;if(Array.isArray(s)){for(var u,h=s.length,_=0,E=s;_<E.length;_+=1){var A=ki(E[_]);if(u){if(u===A)continue;u=Jr;break}u=A}return Fi(u||Jr,h)}return gi}function oc(s){var u=typeof s;return s===null?"":u==="string"||u==="number"||u==="boolean"?String(s):s instanceof Li||s instanceof Za||s instanceof da?s.toString():JSON.stringify(s)}da.prototype.toString=function(){return this.name},da.fromString=function(s){return s?new da({name:s,available:!1}):null},da.prototype.serialize=function(){return["image",this.name]};var ns=function(s,u){this.type=s,this.value=u};ns.parse=function(s,u){if(s.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(!Hl(s[1]))return u.error("invalid value");var h=s[1],_=ki(h),E=u.expectedType;return _.kind!=="array"||_.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(_=E),new ns(_,h)},ns.prototype.evaluate=function(){return this.value},ns.prototype.eachChild=function(){},ns.prototype.outputDefined=function(){return!0},ns.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Li?["rgba"].concat(this.value.toArray()):this.value instanceof Za?this.value.serialize():this.value};var Ya=function(s){this.name="ExpressionEvaluationError",this.message=s};Ya.prototype.toJSON=function(){return this.message};var yo={string:ln,number:Bt,boolean:Wr,object:gi},Da=function(s,u){this.type=s,this.args=u};Da.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var h,_=1,E=s[0];if(E==="array"){var A,I;if(s.length>2){var D=s[1];if(typeof D!="string"||!(D in yo)||D==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=yo[D],_++}else A=Jr;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);I=s[2],_++}h=Fi(A,I)}else h=yo[E];for(var V=[];_<s.length;_++){var $=u.parse(s[_],_,Jr);if(!$)return null;V.push($)}return new Da(h,V)},Da.prototype.evaluate=function(s){for(var u=0;u<this.args.length;u++){var h=this.args[u].evaluate(s);if(!sa(this.type,ki(h)))return h;if(u===this.args.length-1)throw new Ya("Expected value to be of type "+Di(this.type)+", but found "+Di(ki(h))+" instead.")}return null},Da.prototype.eachChild=function(s){this.args.forEach(s)},Da.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Da.prototype.serialize=function(){var s=this.type,u=[s.kind];if(s.kind==="array"){var h=s.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){u.push(h.kind);var _=s.N;(typeof _=="number"||this.args.length>1)&&u.push(_)}}return u.concat(this.args.map(function(E){return E.serialize()}))};var ks=function(s){this.type=ci,this.sections=s};ks.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var h=s[1];if(!Array.isArray(h)&&typeof h=="object")return u.error("First argument must be an image or text section.");for(var _=[],E=!1,A=1;A<=s.length-1;++A){var I=s[A];if(E&&typeof I=="object"&&!Array.isArray(I)){E=!1;var D=null;if(I["font-scale"]&&!(D=u.parse(I["font-scale"],1,Bt)))return null;var V=null;if(I["text-font"]&&!(V=u.parse(I["text-font"],1,Fi(ln))))return null;var $=null;if(I["text-color"]&&!($=u.parse(I["text-color"],1,Zr)))return null;var q=_[_.length-1];q.scale=D,q.font=V,q.textColor=$}else{var te=u.parse(s[A],1,Jr);if(!te)return null;var oe=te.type.kind;if(oe!=="string"&&oe!=="value"&&oe!=="null"&&oe!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,_.push({content:te,scale:null,font:null,textColor:null})}}return new ks(_)},ks.prototype.evaluate=function(s){return new Za(this.sections.map(function(u){var h=u.content.evaluate(s);return ki(h)===Ci?new pa("",h,null,null,null):new pa(oc(h),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))},ks.prototype.eachChild=function(s){for(var u=0,h=this.sections;u<h.length;u+=1){var _=h[u];s(_.content),_.scale&&s(_.scale),_.font&&s(_.font),_.textColor&&s(_.textColor)}},ks.prototype.outputDefined=function(){return!1},ks.prototype.serialize=function(){for(var s=["format"],u=0,h=this.sections;u<h.length;u+=1){var _=h[u];s.push(_.content.serialize());var E={};_.scale&&(E["font-scale"]=_.scale.serialize()),_.font&&(E["text-font"]=_.font.serialize()),_.textColor&&(E["text-color"]=_.textColor.serialize()),s.push(E)}return s};var qa=function(s){this.type=Ci,this.input=s};qa.parse=function(s,u){if(s.length!==2)return u.error("Expected two arguments.");var h=u.parse(s[1],1,ln);return h?new qa(h):u.error("No image name provided.")},qa.prototype.evaluate=function(s){var u=this.input.evaluate(s),h=da.fromString(u);return h&&s.availableImages&&(h.available=s.availableImages.indexOf(u)>-1),h},qa.prototype.eachChild=function(s){s(this.input)},qa.prototype.outputDefined=function(){return!1},qa.prototype.serialize=function(){return["image",this.input.serialize()]};var Rc={"to-boolean":Wr,"to-color":Zr,"to-number":Bt,"to-string":ln},Rs=function(s,u){this.type=s,this.args=u};Rs.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var h=s[0];if((h==="to-boolean"||h==="to-string")&&s.length!==2)return u.error("Expected one argument.");for(var _=Rc[h],E=[],A=1;A<s.length;A++){var I=u.parse(s[A],A,Jr);if(!I)return null;E.push(I)}return new Rs(_,E)},Rs.prototype.evaluate=function(s){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(s));if(this.type.kind==="color"){for(var u,h,_=0,E=this.args;_<E.length;_+=1){if(h=null,(u=E[_].evaluate(s))instanceof Li)return u;if(typeof u=="string"){var A=s.parseColor(u);if(A)return A}else if(Array.isArray(u)&&!(h=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Xf(u[0],u[1],u[2],u[3])))return new Li(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ya(h||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var I=null,D=0,V=this.args;D<V.length;D+=1){if((I=V[D].evaluate(s))===null)return 0;var $=Number(I);if(!isNaN($))return $}throw new Ya("Could not convert "+JSON.stringify(I)+" to number.")}return this.type.kind==="formatted"?Za.fromString(oc(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?da.fromString(oc(this.args[0].evaluate(s))):oc(this.args[0].evaluate(s))},Rs.prototype.eachChild=function(s){this.args.forEach(s)},Rs.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Rs.prototype.serialize=function(){if(this.type.kind==="formatted")return new ks([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new qa(this.args[0]).serialize();var s=["to-"+this.type.kind];return this.eachChild(function(u){s.push(u.serialize())}),s};var df=["Unknown","Point","LineString","Polygon"],Os=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Os.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Os.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?df[this.feature.type]:this.feature.type:null},Os.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Os.prototype.canonicalID=function(){return this.canonical},Os.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Os.prototype.parseColor=function(s){var u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=Li.parse(s)),u};var Ha=function(s,u,h,_){this.name=s,this.type=u,this._evaluate=h,this.args=_};Ha.prototype.evaluate=function(s){return this._evaluate(s,this.args)},Ha.prototype.eachChild=function(s){this.args.forEach(s)},Ha.prototype.outputDefined=function(){return!1},Ha.prototype.serialize=function(){return[this.name].concat(this.args.map(function(s){return s.serialize()}))},Ha.parse=function(s,u){var h,_=s[0],E=Ha.definitions[_];if(!E)return u.error('Unknown expression "'+_+'". If you wanted a literal array, use ["literal", [...]].',0);for(var A=Array.isArray(E)?E[0]:E.type,I=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,D=I.filter(function($n){var yn=$n[0];return!Array.isArray(yn)||yn.length===s.length-1}),V=null,$=0,q=D;$<q.length;$+=1){var te=q[$],oe=te[0],fe=te[1];V=new mf(u.registry,u.path,null,u.scope);for(var Pe=[],De=!1,tt=1;tt<s.length;tt++){var We=s[tt],lt=Array.isArray(oe)?oe[tt-1]:oe.type,xt=V.parse(We,1+Pe.length,lt);if(!xt){De=!0;break}Pe.push(xt)}if(!De)if(Array.isArray(oe)&&oe.length!==Pe.length)V.error("Expected "+oe.length+" arguments, but found "+Pe.length+" instead.");else{for(var Lt=0;Lt<Pe.length;Lt++){var Pt=Array.isArray(oe)?oe[Lt]:oe.type,nr=Pe[Lt];V.concat(Lt+1).checkSubtype(Pt,nr.type)}if(V.errors.length===0)return new Ha(_,A,fe,Pe)}}if(D.length===1)(h=u.errors).push.apply(h,V.errors);else{for(var Fr=(D.length?D:I).map(function($n){var yn;return yn=$n[0],Array.isArray(yn)?"("+yn.map(Di).join(", ")+")":"("+Di(yn.type)+"...)"}).join(" | "),tn=[],Vn=1;Vn<s.length;Vn++){var vn=u.parse(s[Vn],1+tn.length);if(!vn)return null;tn.push(Di(vn.type))}u.error("Expected arguments of type "+Fr+", but found ("+tn.join(", ")+") instead.")}return null},Ha.register=function(s,u){for(var h in Ha.definitions=u,u)s[h]=Ha};var Ps=function(s,u,h){this.type=bi,this.locale=h,this.caseSensitive=s,this.diacriticSensitive=u};function se(s,u){s[0]=Math.min(s[0],u[0]),s[1]=Math.min(s[1],u[1]),s[2]=Math.max(s[2],u[0]),s[3]=Math.max(s[3],u[1])}function we(s,u){return!(s[0]<=u[0]||s[2]>=u[2]||s[1]<=u[1]||s[3]>=u[3])}function Je(s,u){var h=(180+s[0])/360,_=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,E=Math.pow(2,u.z);return[Math.round(h*E*8192),Math.round(_*E*8192)]}function Nt(s,u,h){return u[1]>s[1]!=h[1]>s[1]&&s[0]<(h[0]-u[0])*(s[1]-u[1])/(h[1]-u[1])+u[0]}function Tr(s,u){for(var h,_,E,A,I,D,V,$=!1,q=0,te=u.length;q<te;q++)for(var oe=u[q],fe=0,Pe=oe.length;fe<Pe-1;fe++){if((A=(h=s)[0]-(_=oe[fe])[0])*(V=h[1]-(E=oe[fe+1])[1])-(D=h[0]-E[0])*(I=h[1]-_[1])==0&&A*D<=0&&I*V<=0)return!1;Nt(s,oe[fe],oe[fe+1])&&($=!$)}return $}function Un(s,u){for(var h=0;h<u.length;h++)if(Tr(s,u[h]))return!0;return!1}function Qi(s,u,h,_){var E=_[0]-h[0],A=_[1]-h[1],I=(s[0]-h[0])*A-E*(s[1]-h[1]),D=(u[0]-h[0])*A-E*(u[1]-h[1]);return I>0&&D<0||I<0&&D>0}function Ma(s,u,h){for(var _=0,E=h;_<E.length;_+=1)for(var A=E[_],I=0;I<A.length-1;++I)if((te=[(q=A[I+1])[0]-($=A[I])[0],q[1]-$[1]])[0]*(oe=[(V=u)[0]-(D=s)[0],V[1]-D[1]])[1]-te[1]*oe[0]!=0&&Qi(D,V,$,q)&&Qi($,q,D,V))return!0;var D,V,$,q,te,oe;return!1}function cs(s,u){for(var h=0;h<s.length;++h)if(!Tr(s[h],u))return!1;for(var _=0;_<s.length-1;++_)if(Ma(s[_],s[_+1],u))return!1;return!0}function ko(s,u){for(var h=0;h<u.length;h++)if(cs(s,u[h]))return!0;return!1}function Ia(s,u,h){for(var _=[],E=0;E<s.length;E++){for(var A=[],I=0;I<s[E].length;I++){var D=Je(s[E][I],h);se(u,D),A.push(D)}_.push(A)}return _}function Fp(s,u,h){for(var _=[],E=0;E<s.length;E++){var A=Ia(s[E],u,h);_.push(A)}return _}function Zf(s,u,h,_){if(s[0]<h[0]||s[0]>h[2]){var E=.5*_,A=s[0]-h[0]>E?-_:h[0]-s[0]>E?_:0;A===0&&(A=s[0]-h[2]>E?-_:h[2]-s[0]>E?_:0),s[0]+=A}se(u,s)}function qd(s,u,h,_){for(var E=8192*Math.pow(2,_.z),A=[8192*_.x,8192*_.y],I=[],D=0,V=s;D<V.length;D+=1)for(var $=0,q=V[D];$<q.length;$+=1){var te=q[$],oe=[te.x+A[0],te.y+A[1]];Zf(oe,u,h,E),I.push(oe)}return I}function Kh(s,u,h,_){for(var E,A=8192*Math.pow(2,_.z),I=[8192*_.x,8192*_.y],D=[],V=0,$=s;V<$.length;V+=1){for(var q=[],te=0,oe=$[V];te<oe.length;te+=1){var fe=oe[te],Pe=[fe.x+I[0],fe.y+I[1]];se(u,Pe),q.push(Pe)}D.push(q)}if(u[2]-u[0]<=A/2){(E=u)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(var De=0,tt=D;De<tt.length;De+=1)for(var We=0,lt=tt[De];We<lt.length;We+=1)Zf(lt[We],u,h,A)}return D}Ps.parse=function(s,u){if(s.length!==2)return u.error("Expected one argument.");var h=s[1];if(typeof h!="object"||Array.isArray(h))return u.error("Collator options argument must be an object.");var _=u.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,Wr);if(!_)return null;var E=u.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,Wr);if(!E)return null;var A=null;return h.locale&&!(A=u.parse(h.locale,1,ln))?null:new Ps(_,E,A)},Ps.prototype.evaluate=function(s){return new go(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)},Ps.prototype.eachChild=function(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){var s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]};var gu=function(s,u){this.type=Wr,this.geojson=s,this.geometries=u};function Wl(s){if(s instanceof Ha&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof gu)return!1;var u=!0;return s.eachChild(function(h){u&&!Wl(h)&&(u=!1)}),u}function vf(s){if(s instanceof Ha&&s.name==="feature-state")return!1;var u=!0;return s.eachChild(function(h){u&&!vf(h)&&(u=!1)}),u}function Ku(s,u){if(s instanceof Ha&&u.indexOf(s.name)>=0)return!1;var h=!0;return s.eachChild(function(_){h&&!Ku(_,u)&&(h=!1)}),h}gu.parse=function(s,u){if(s.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(Hl(s[1])){var h=s[1];if(h.type==="FeatureCollection")for(var _=0;_<h.features.length;++_){var E=h.features[_].geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new gu(h,h.features[_].geometry)}else if(h.type==="Feature"){var A=h.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new gu(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new gu(h,h)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},gu.prototype.evaluate=function(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,h){var _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(h.type==="Polygon"){var I=Ia(h.coordinates,E,A),D=qd(u.geometry(),_,E,A);if(!we(_,E))return!1;for(var V=0,$=D;V<$.length;V+=1)if(!Tr($[V],I))return!1}if(h.type==="MultiPolygon"){var q=Fp(h.coordinates,E,A),te=qd(u.geometry(),_,E,A);if(!we(_,E))return!1;for(var oe=0,fe=te;oe<fe.length;oe+=1)if(!Un(fe[oe],q))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,h){var _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(h.type==="Polygon"){var I=Ia(h.coordinates,E,A),D=Kh(u.geometry(),_,E,A);if(!we(_,E))return!1;for(var V=0,$=D;V<$.length;V+=1)if(!cs($[V],I))return!1}if(h.type==="MultiPolygon"){var q=Fp(h.coordinates,E,A),te=Kh(u.geometry(),_,E,A);if(!we(_,E))return!1;for(var oe=0,fe=te;oe<fe.length;oe+=1)if(!ko(fe[oe],q))return!1}return!0}(s,this.geometries)}return!1},gu.prototype.eachChild=function(){},gu.prototype.outputDefined=function(){return!0},gu.prototype.serialize=function(){return["within",this.geojson]};var yu=function(s,u){this.type=u.type,this.name=s,this.boundExpression=u};yu.parse=function(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var h=s[1];return u.scope.has(h)?new yu(h,u.scope.get(h)):u.error('Unknown variable "'+h+'". Make sure "'+h+'" has been bound in an enclosing "let" expression before using it.',1)},yu.prototype.evaluate=function(s){return this.boundExpression.evaluate(s)},yu.prototype.eachChild=function(){},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){return["var",this.name]};var mf=function(s,u,h,_,E){u===void 0&&(u=[]),_===void 0&&(_=new Nr),E===void 0&&(E=[]),this.registry=s,this.path=u,this.key=u.map(function(A){return"["+A+"]"}).join(""),this.scope=_,this.errors=E,this.expectedType=h};function to(s,u){for(var h,_=s.length-1,E=0,A=_,I=0;E<=A;)if((h=s[I=Math.floor((E+A)/2)])<=u){if(I===_||u<s[I+1])return I;E=I+1}else{if(!(h>u))throw new Ya("Input is not a number.");A=I-1}return 0}mf.prototype.parse=function(s,u,h,_,E){return E===void 0&&(E={}),u?this.concat(u,h,_)._parse(s,E):this._parse(s,E)},mf.prototype._parse=function(s,u){function h($,q,te){return te==="assert"?new Da(q,[$]):te==="coerce"?new Rs(q,[$]):$}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var _=s[0];if(typeof _!="string")return this.error("Expression name must be a string, but found "+typeof _+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var E=this.registry[_];if(E){var A=E.parse(s,this);if(!A)return null;if(this.expectedType){var I=this.expectedType,D=A.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||D.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||D.kind!=="value"&&D.kind!=="string"){if(this.checkSubtype(I,D))return null}else A=h(A,I,u.typeAnnotation||"coerce");else A=h(A,I,u.typeAnnotation||"assert")}if(!(A instanceof ns)&&A.type.kind!=="resolvedImage"&&function $(q){if(q instanceof yu)return $(q.boundExpression);if(q instanceof Ha&&q.name==="error"||q instanceof Ps||q instanceof gu)return!1;var te=q instanceof Rs||q instanceof Da,oe=!0;return q.eachChild(function(fe){oe=te?oe&&$(fe):oe&&fe instanceof ns}),!!oe&&Wl(q)&&Ku(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(A)){var V=new Os;try{A=new ns(A.type,A.evaluate(V))}catch($){return this.error($.message),null}}return A}return this.error('Unknown expression "'+_+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof s+" instead.")},mf.prototype.concat=function(s,u,h){var _=typeof s=="number"?this.path.concat(s):this.path,E=h?this.scope.concat(h):this.scope;return new mf(this.registry,_,u||null,E,this.errors)},mf.prototype.error=function(s){for(var u=[],h=arguments.length-1;h-- >0;)u[h]=arguments[h+1];var _=""+this.key+u.map(function(E){return"["+E+"]"}).join("");this.errors.push(new pr(_,s))},mf.prototype.checkSubtype=function(s,u){var h=sa(s,u);return h&&this.error(h),h};var Ji=function(s,u,h){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(var _=0,E=h;_<E.length;_+=1){var A=E[_],I=A[1];this.labels.push(A[0]),this.outputs.push(I)}};function Ro(s,u,h){return s*(1-h)+u*h}Ji.parse=function(s,u){if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");var h=u.parse(s[1],1,Bt);if(!h)return null;var _=[],E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(var A=1;A<s.length;A+=2){var I=A===1?-1/0:s[A],D=s[A+1],V=A,$=A+1;if(typeof I!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(_.length&&_[_.length-1][0]>=I)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);var q=u.parse(D,$,E);if(!q)return null;E=E||q.type,_.push([I,q])}return new Ji(E,h,_)},Ji.prototype.evaluate=function(s){var u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(s);var _=this.input.evaluate(s);if(_<=u[0])return h[0].evaluate(s);var E=u.length;return _>=u[E-1]?h[E-1].evaluate(s):h[to(u,_)].evaluate(s)},Ji.prototype.eachChild=function(s){s(this.input);for(var u=0,h=this.outputs;u<h.length;u+=1)s(h[u])},Ji.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},Ji.prototype.serialize=function(){for(var s=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&s.push(this.labels[u]),s.push(this.outputs[u].serialize());return s};var $l=Object.freeze({__proto__:null,number:Ro,color:function(s,u,h){return new Li(Ro(s.r,u.r,h),Ro(s.g,u.g,h),Ro(s.b,u.b,h),Ro(s.a,u.a,h))},array:function(s,u,h){return s.map(function(_,E){return Ro(_,u[E],h)})}}),dd=6/29*3*(6/29),Wv=Math.PI/180,vd=180/Math.PI;function Qh(s){return s>.008856451679035631?Math.pow(s,1/3):s/dd+4/29}function _u(s){return s>6/29?s*s*s:dd*(s-4/29)}function Ch(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Yi(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Qu(s){var u=Yi(s.r),h=Yi(s.g),_=Yi(s.b),E=Qh((.4124564*u+.3575761*h+.1804375*_)/.95047),A=Qh((.2126729*u+.7151522*h+.072175*_)/1);return{l:116*A-16,a:500*(E-A),b:200*(A-Qh((.0193339*u+.119192*h+.9503041*_)/1.08883)),alpha:s.a}}function gf(s){var u=(s.l+16)/116,h=isNaN(s.a)?u:u+s.a/500,_=isNaN(s.b)?u:u-s.b/200;return u=1*_u(u),h=.95047*_u(h),_=1.08883*_u(_),new Li(Ch(3.2404542*h-1.5371385*u-.4985314*_),Ch(-.969266*h+1.8760108*u+.041556*_),Ch(.0556434*h-.2040259*u+1.0572252*_),s.alpha)}function Kd(s,u,h){var _=u-s;return s+h*(_>180||_<-180?_-360*Math.round(_/360):_)}var Oo={forward:Qu,reverse:gf,interpolate:function(s,u,h){return{l:Ro(s.l,u.l,h),a:Ro(s.a,u.a,h),b:Ro(s.b,u.b,h),alpha:Ro(s.alpha,u.alpha,h)}}},au={forward:function(s){var u=Qu(s),h=u.l,_=u.a,E=u.b,A=Math.atan2(E,_)*vd;return{h:A<0?A+360:A,c:Math.sqrt(_*_+E*E),l:h,alpha:s.a}},reverse:function(s){var u=s.h*Wv,h=s.c;return gf({l:s.l,a:Math.cos(u)*h,b:Math.sin(u)*h,alpha:s.alpha})},interpolate:function(s,u,h){return{h:Kd(s.h,u.h,h),c:Ro(s.c,u.c,h),l:Ro(s.l,u.l,h),alpha:Ro(s.alpha,u.alpha,h)}}},Dp=Object.freeze({__proto__:null,lab:Oo,hcl:au}),Po=function(s,u,h,_,E){this.type=s,this.operator=u,this.interpolation=h,this.input=_,this.labels=[],this.outputs=[];for(var A=0,I=E;A<I.length;A+=1){var D=I[A],V=D[1];this.labels.push(D[0]),this.outputs.push(V)}};function Jh(s,u,h,_){var E=_-h,A=s-h;return E===0?0:u===1?A/E:(Math.pow(u,A)-1)/(Math.pow(u,E)-1)}Po.interpolationFactor=function(s,u,h,_){var E=0;if(s.name==="exponential")E=Jh(u,s.base,h,_);else if(s.name==="linear")E=Jh(u,1,h,_);else if(s.name==="cubic-bezier"){var A=s.controlPoints;E=new c(A[0],A[1],A[2],A[3]).solve(Jh(u,1,h,_))}return E},Po.parse=function(s,u){var h=s[0],_=s[1],E=s[2],A=s.slice(3);if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){var I=_[1];if(typeof I!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:I}}else{if(_[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(_[0]),1,0);var D=_.slice(1);if(D.length!==4||D.some(function(tt){return typeof tt!="number"||tt<0||tt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:D}}if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(E=u.parse(E,2,Bt)))return null;var V=[],$=null;h==="interpolate-hcl"||h==="interpolate-lab"?$=Zr:u.expectedType&&u.expectedType.kind!=="value"&&($=u.expectedType);for(var q=0;q<A.length;q+=2){var te=A[q],oe=A[q+1],fe=q+3,Pe=q+4;if(typeof te!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',fe);if(V.length&&V[V.length-1][0]>=te)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',fe);var De=u.parse(oe,Pe,$);if(!De)return null;$=$||De.type,V.push([te,De])}return $.kind==="number"||$.kind==="color"||$.kind==="array"&&$.itemType.kind==="number"&&typeof $.N=="number"?new Po($,h,_,E,V):u.error("Type "+Di($)+" is not interpolatable.")},Po.prototype.evaluate=function(s){var u=this.labels,h=this.outputs;if(u.length===1)return h[0].evaluate(s);var _=this.input.evaluate(s);if(_<=u[0])return h[0].evaluate(s);var E=u.length;if(_>=u[E-1])return h[E-1].evaluate(s);var A=to(u,_),I=Po.interpolationFactor(this.interpolation,_,u[A],u[A+1]),D=h[A].evaluate(s),V=h[A+1].evaluate(s);return this.operator==="interpolate"?$l[this.type.kind.toLowerCase()](D,V,I):this.operator==="interpolate-hcl"?au.reverse(au.interpolate(au.forward(D),au.forward(V),I)):Oo.reverse(Oo.interpolate(Oo.forward(D),Oo.forward(V),I))},Po.prototype.eachChild=function(s){s(this.input);for(var u=0,h=this.outputs;u<h.length;u+=1)s(h[u])},Po.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},Po.prototype.serialize=function(){var s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,s,this.input.serialize()],h=0;h<this.labels.length;h++)u.push(this.labels[h],this.outputs[h].serialize());return u};var Fs=function(s,u){this.type=s,this.args=u};Fs.parse=function(s,u){if(s.length<2)return u.error("Expectected at least one argument.");var h=null,_=u.expectedType;_&&_.kind!=="value"&&(h=_);for(var E=[],A=0,I=s.slice(1);A<I.length;A+=1){var D=u.parse(I[A],1+E.length,h,void 0,{typeAnnotation:"omit"});if(!D)return null;h=h||D.type,E.push(D)}var V=_&&E.some(function($){return sa(_,$.type)});return new Fs(V?Jr:h,E)},Fs.prototype.evaluate=function(s){for(var u,h=null,_=0,E=0,A=this.args;E<A.length&&(_++,(h=A[E].evaluate(s))&&h instanceof da&&!h.available&&(u||(u=h.name),h=null,_===this.args.length&&(h=u)),h===null);E+=1);return h},Fs.prototype.eachChild=function(s){this.args.forEach(s)},Fs.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Fs.prototype.serialize=function(){var s=["coalesce"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Oc=function(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u};Oc.prototype.evaluate=function(s){return this.result.evaluate(s)},Oc.prototype.eachChild=function(s){for(var u=0,h=this.bindings;u<h.length;u+=1)s(h[u][1]);s(this.result)},Oc.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found "+(s.length-1)+" instead.");for(var h=[],_=1;_<s.length-1;_+=2){var E=s[_];if(typeof E!="string")return u.error("Expected string, but found "+typeof E+" instead.",_);if(/[^a-zA-Z0-9_]/.test(E))return u.error("Variable names must contain only alphanumeric characters or '_'.",_);var A=u.parse(s[_+1],_+1);if(!A)return null;h.push([E,A])}var I=u.parse(s[s.length-1],s.length-1,u.expectedType,h);return I?new Oc(h,I):null},Oc.prototype.outputDefined=function(){return this.result.outputDefined()},Oc.prototype.serialize=function(){for(var s=["let"],u=0,h=this.bindings;u<h.length;u+=1){var _=h[u];s.push(_[0],_[1].serialize())}return s.push(this.result.serialize()),s};var Xs=function(s,u,h){this.type=s,this.index=u,this.input=h};Xs.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var h=u.parse(s[1],1,Bt),_=u.parse(s[2],2,Fi(u.expectedType||Jr));return h&&_?new Xs(_.type.itemType,h,_):null},Xs.prototype.evaluate=function(s){var u=this.index.evaluate(s),h=this.input.evaluate(s);if(u<0)throw new Ya("Array index out of bounds: "+u+" < 0.");if(u>=h.length)throw new Ya("Array index out of bounds: "+u+" > "+(h.length-1)+".");if(u!==Math.floor(u))throw new Ya("Array index must be an integer, but found "+u+" instead.");return h[u]},Xs.prototype.eachChild=function(s){s(this.index),s(this.input)},Xs.prototype.outputDefined=function(){return!1},Xs.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Fo=function(s,u){this.type=Wr,this.needle=s,this.haystack=u};Fo.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var h=u.parse(s[1],1,Jr),_=u.parse(s[2],2,Jr);return h&&_?Zi(h.type,[Wr,ln,Bt,xn,Jr])?new Fo(h,_):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Di(h.type)+" instead"):null},Fo.prototype.evaluate=function(s){var u=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!h)return!1;if(!ia(u,["boolean","string","number","null"]))throw new Ya("Expected first argument to be of type boolean, string, number or null, but found "+Di(ki(u))+" instead.");if(!ia(h,["string","array"]))throw new Ya("Expected second argument to be of type array or string, but found "+Di(ki(h))+" instead.");return h.indexOf(u)>=0},Fo.prototype.eachChild=function(s){s(this.needle),s(this.haystack)},Fo.prototype.outputDefined=function(){return!0},Fo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var yf=function(s,u,h){this.type=Bt,this.needle=s,this.haystack=u,this.fromIndex=h};yf.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var h=u.parse(s[1],1,Jr),_=u.parse(s[2],2,Jr);if(!h||!_)return null;if(!Zi(h.type,[Wr,ln,Bt,xn,Jr]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Di(h.type)+" instead");if(s.length===4){var E=u.parse(s[3],3,Bt);return E?new yf(h,_,E):null}return new yf(h,_)},yf.prototype.evaluate=function(s){var u=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!ia(u,["boolean","string","number","null"]))throw new Ya("Expected first argument to be of type boolean, string, number or null, but found "+Di(ki(u))+" instead.");if(!ia(h,["string","array"]))throw new Ya("Expected second argument to be of type array or string, but found "+Di(ki(h))+" instead.");if(this.fromIndex){var _=this.fromIndex.evaluate(s);return h.indexOf(u,_)}return h.indexOf(u)},yf.prototype.eachChild=function(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)},yf.prototype.outputDefined=function(){return!1},yf.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Do=function(s,u,h,_,E,A){this.inputType=s,this.type=u,this.input=h,this.cases=_,this.outputs=E,this.otherwise=A};Do.parse=function(s,u){if(s.length<5)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if(s.length%2!=1)return u.error("Expected an even number of arguments.");var h,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);for(var E={},A=[],I=2;I<s.length-1;I+=2){var D=s[I],V=s[I+1];Array.isArray(D)||(D=[D]);var $=u.concat(I);if(D.length===0)return $.error("Expected at least one branch label.");for(var q=0,te=D;q<te.length;q+=1){var oe=te[q];if(typeof oe!="number"&&typeof oe!="string")return $.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return $.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof oe=="number"&&Math.floor(oe)!==oe)return $.error("Numeric branch labels must be integer values.");if(h){if($.checkSubtype(h,ki(oe)))return null}else h=ki(oe);if(E[String(oe)]!==void 0)return $.error("Branch labels must be unique.");E[String(oe)]=A.length}var fe=u.parse(V,I,_);if(!fe)return null;_=_||fe.type,A.push(fe)}var Pe=u.parse(s[1],1,Jr);if(!Pe)return null;var De=u.parse(s[s.length-1],s.length-1,_);return De?Pe.type.kind!=="value"&&u.concat(1).checkSubtype(h,Pe.type)?null:new Do(h,_,Pe,E,A,De):null},Do.prototype.evaluate=function(s){var u=this.input.evaluate(s);return(ki(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)},Do.prototype.eachChild=function(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)},Do.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})&&this.otherwise.outputDefined()},Do.prototype.serialize=function(){for(var s=this,u=["match",this.input.serialize()],h=[],_={},E=0,A=Object.keys(this.cases).sort();E<A.length;E+=1){var I=A[E];(te=_[this.cases[I]])===void 0?(_[this.cases[I]]=h.length,h.push([this.cases[I],[I]])):h[te][1].push(I)}for(var D=function(fe){return s.inputType.kind==="number"?Number(fe):fe},V=0,$=h;V<$.length;V+=1){var q=$[V],te=q[0],oe=q[1];u.push(oe.length===1?D(oe[0]):oe.map(D)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var sc=function(s,u,h){this.type=s,this.branches=u,this.otherwise=h};sc.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found only "+(s.length-1)+".");if(s.length%2!=0)return u.error("Expected an odd number of arguments.");var h;u.expectedType&&u.expectedType.kind!=="value"&&(h=u.expectedType);for(var _=[],E=1;E<s.length-1;E+=2){var A=u.parse(s[E],E,Wr);if(!A)return null;var I=u.parse(s[E+1],E+1,h);if(!I)return null;_.push([A,I]),h=h||I.type}var D=u.parse(s[s.length-1],s.length-1,h);return D?new sc(h,_,D):null},sc.prototype.evaluate=function(s){for(var u=0,h=this.branches;u<h.length;u+=1){var _=h[u],E=_[1];if(_[0].evaluate(s))return E.evaluate(s)}return this.otherwise.evaluate(s)},sc.prototype.eachChild=function(s){for(var u=0,h=this.branches;u<h.length;u+=1){var _=h[u],E=_[1];s(_[0]),s(E)}s(this.otherwise)},sc.prototype.outputDefined=function(){return this.branches.every(function(s){return s[1].outputDefined()})&&this.otherwise.outputDefined()},sc.prototype.serialize=function(){var s=["case"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Du=function(s,u,h,_){this.type=s,this.input=u,this.beginIndex=h,this.endIndex=_};function uc(s,u){return s==="=="||s==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function xu(s,u,h,_){return _.compare(u,h)===0}function va(s,u,h){var _=s!=="=="&&s!=="!=";return function(){function E(A,I,D){this.type=Wr,this.lhs=A,this.rhs=I,this.collator=D,this.hasUntypedArgument=A.type.kind==="value"||I.type.kind==="value"}return E.parse=function(A,I){if(A.length!==3&&A.length!==4)return I.error("Expected two or three arguments.");var D=A[0],V=I.parse(A[1],1,Jr);if(!V)return null;if(!uc(D,V.type))return I.concat(1).error('"'+D+`" comparisons are not supported for type '`+Di(V.type)+"'.");var $=I.parse(A[2],2,Jr);if(!$)return null;if(!uc(D,$.type))return I.concat(2).error('"'+D+`" comparisons are not supported for type '`+Di($.type)+"'.");if(V.type.kind!==$.type.kind&&V.type.kind!=="value"&&$.type.kind!=="value")return I.error("Cannot compare types '"+Di(V.type)+"' and '"+Di($.type)+"'.");_&&(V.type.kind==="value"&&$.type.kind!=="value"?V=new Da($.type,[V]):V.type.kind!=="value"&&$.type.kind==="value"&&($=new Da(V.type,[$])));var q=null;if(A.length===4){if(V.type.kind!=="string"&&$.type.kind!=="string"&&V.type.kind!=="value"&&$.type.kind!=="value")return I.error("Cannot use collator to compare non-string types.");if(!(q=I.parse(A[3],3,bi)))return null}return new E(V,$,q)},E.prototype.evaluate=function(A){var I=this.lhs.evaluate(A),D=this.rhs.evaluate(A);if(_&&this.hasUntypedArgument){var V=ki(I),$=ki(D);if(V.kind!==$.kind||V.kind!=="string"&&V.kind!=="number")throw new Ya('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+V.kind+", "+$.kind+") instead.")}if(this.collator&&!_&&this.hasUntypedArgument){var q=ki(I),te=ki(D);if(q.kind!=="string"||te.kind!=="string")return u(A,I,D)}return this.collator?h(A,I,D,this.collator.evaluate(A)):u(A,I,D)},E.prototype.eachChild=function(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)},E.prototype.outputDefined=function(){return!0},E.prototype.serialize=function(){var A=[s];return this.eachChild(function(I){A.push(I.serialize())}),A},E}()}Du.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var h=u.parse(s[1],1,Jr),_=u.parse(s[2],2,Bt);if(!h||!_)return null;if(!Zi(h.type,[Fi(Jr),ln,Jr]))return u.error("Expected first argument to be of type array or string, but found "+Di(h.type)+" instead");if(s.length===4){var E=u.parse(s[3],3,Bt);return E?new Du(h.type,h,_,E):null}return new Du(h.type,h,_)},Du.prototype.evaluate=function(s){var u=this.input.evaluate(s),h=this.beginIndex.evaluate(s);if(!ia(u,["string","array"]))throw new Ya("Expected first argument to be of type array or string, but found "+Di(ki(u))+" instead.");if(this.endIndex){var _=this.endIndex.evaluate(s);return u.slice(h,_)}return u.slice(h)},Du.prototype.eachChild=function(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)},Du.prototype.outputDefined=function(){return!1},Du.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ro=va("==",function(s,u,h){return u===h},xu),ou=va("!=",function(s,u,h){return u!==h},function(s,u,h,_){return!xu(0,u,h,_)}),ep=va("<",function(s,u,h){return u<h},function(s,u,h,_){return _.compare(u,h)<0}),tp=va(">",function(s,u,h){return u>h},function(s,u,h,_){return _.compare(u,h)>0}),Sh=va("<=",function(s,u,h){return u<=h},function(s,u,h,_){return _.compare(u,h)<=0}),Qd=va(">=",function(s,u,h){return u>=h},function(s,u,h,_){return _.compare(u,h)>=0}),Pc=function(s,u,h,_,E){this.type=ln,this.number=s,this.locale=u,this.currency=h,this.minFractionDigits=_,this.maxFractionDigits=E};Pc.parse=function(s,u){if(s.length!==3)return u.error("Expected two arguments.");var h=u.parse(s[1],1,Bt);if(!h)return null;var _=s[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");var E=null;if(_.locale&&!(E=u.parse(_.locale,1,ln)))return null;var A=null;if(_.currency&&!(A=u.parse(_.currency,1,ln)))return null;var I=null;if(_["min-fraction-digits"]&&!(I=u.parse(_["min-fraction-digits"],1,Bt)))return null;var D=null;return _["max-fraction-digits"]&&!(D=u.parse(_["max-fraction-digits"],1,Bt))?null:new Pc(h,E,A,I,D)},Pc.prototype.evaluate=function(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))},Pc.prototype.eachChild=function(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)},Pc.prototype.outputDefined=function(){return!1},Pc.prototype.serialize=function(){var s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]};var Wa=function(s){this.type=Bt,this.input=s};Wa.parse=function(s,u){if(s.length!==2)return u.error("Expected 1 argument, but found "+(s.length-1)+" instead.");var h=u.parse(s[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Di(h.type)+" instead."):new Wa(h):null},Wa.prototype.evaluate=function(s){var u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Ya("Expected value to be of type string or array, but found "+Di(ki(u))+" instead.")},Wa.prototype.eachChild=function(s){s(this.input)},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){var s=["length"];return this.eachChild(function(u){s.push(u.serialize())}),s};var lc={"==":ro,"!=":ou,">":tp,"<":ep,">=":Qd,"<=":Sh,array:Da,at:Xs,boolean:Da,case:sc,coalesce:Fs,collator:Ps,format:ks,image:qa,in:Fo,"index-of":yf,interpolate:Po,"interpolate-hcl":Po,"interpolate-lab":Po,length:Wa,let:Oc,literal:ns,match:Do,number:Da,"number-format":Pc,object:Da,slice:Du,step:Ji,string:Da,"to-boolean":Rs,"to-color":Rs,"to-number":Rs,"to-string":Rs,var:yu,within:gu};function wh(s,u){var h=u[0],_=u[1],E=u[2],A=u[3];h=h.evaluate(s),_=_.evaluate(s),E=E.evaluate(s);var I=A?A.evaluate(s):1,D=Xf(h,_,E,I);if(D)throw new Ya(D);return new Li(h/255*I,_/255*I,E/255*I,I)}function Zs(s,u){return s in u}function Ah(s,u){var h=u[s];return h===void 0?null:h}function bu(s){return{type:s}}function Fc(s){return{result:"success",value:s}}function Ys(s){return{result:"error",value:s}}function Bu(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Xl(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function _f(s){return!!s.expression&&s.expression.interpolated}function ka(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Dc(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Bp(s){return s}function Bc(s,u,h){return s!==void 0?s:u!==void 0?u:h!==void 0?h:void 0}function Nu(s,u,h,_,E){return Bc(typeof h===E?_[h]:void 0,s.default,u.default)}function rp(s,u,h){if(ka(h)!=="number")return Bc(s.default,u.default);var _=s.stops.length;if(_===1||h<=s.stops[0][0])return s.stops[0][1];if(h>=s.stops[_-1][0])return s.stops[_-1][1];var E=to(s.stops.map(function(A){return A[0]}),h);return s.stops[E][1]}function Th(s,u,h){var _=s.base!==void 0?s.base:1;if(ka(h)!=="number")return Bc(s.default,u.default);var E=s.stops.length;if(E===1||h<=s.stops[0][0])return s.stops[0][1];if(h>=s.stops[E-1][0])return s.stops[E-1][1];var A=to(s.stops.map(function(te){return te[0]}),h),I=function(te,oe,fe,Pe){var De=Pe-fe,tt=te-fe;return De===0?0:oe===1?tt/De:(Math.pow(oe,tt)-1)/(Math.pow(oe,De)-1)}(h,_,s.stops[A][0],s.stops[A+1][0]),D=s.stops[A][1],V=s.stops[A+1][1],$=$l[u.type]||Bp;if(s.colorSpace&&s.colorSpace!=="rgb"){var q=Dp[s.colorSpace];$=function(te,oe){return q.reverse(q.interpolate(q.forward(te),q.forward(oe),I))}}return typeof D.evaluate=="function"?{evaluate:function(){for(var te=[],oe=arguments.length;oe--;)te[oe]=arguments[oe];var fe=D.evaluate.apply(void 0,te),Pe=V.evaluate.apply(void 0,te);if(fe!==void 0&&Pe!==void 0)return $(fe,Pe,I)}}:$(D,V,I)}function xf(s,u,h){return u.type==="color"?h=Li.parse(h):u.type==="formatted"?h=Za.fromString(h.toString()):u.type==="resolvedImage"?h=da.fromString(h.toString()):ka(h)===u.type||u.type==="enum"&&u.values[h]||(h=void 0),Bc(h,s.default,u.default)}Ha.register(lc,{error:[{kind:"error"},[ln],function(s,u){throw new Ya(u[0].evaluate(s))}],typeof:[ln,[Jr],function(s,u){return Di(ki(u[0].evaluate(s)))}],"to-rgba":[Fi(Bt,4),[Zr],function(s,u){return u[0].evaluate(s).toArray()}],rgb:[Zr,[Bt,Bt,Bt],wh],rgba:[Zr,[Bt,Bt,Bt,Bt],wh],has:{type:Wr,overloads:[[[ln],function(s,u){return Zs(u[0].evaluate(s),s.properties())}],[[ln,gi],function(s,u){var h=u[1];return Zs(u[0].evaluate(s),h.evaluate(s))}]]},get:{type:Jr,overloads:[[[ln],function(s,u){return Ah(u[0].evaluate(s),s.properties())}],[[ln,gi],function(s,u){var h=u[1];return Ah(u[0].evaluate(s),h.evaluate(s))}]]},"feature-state":[Jr,[ln],function(s,u){return Ah(u[0].evaluate(s),s.featureState||{})}],properties:[gi,[],function(s){return s.properties()}],"geometry-type":[ln,[],function(s){return s.geometryType()}],id:[Jr,[],function(s){return s.id()}],zoom:[Bt,[],function(s){return s.globals.zoom}],"heatmap-density":[Bt,[],function(s){return s.globals.heatmapDensity||0}],"line-progress":[Bt,[],function(s){return s.globals.lineProgress||0}],accumulated:[Jr,[],function(s){return s.globals.accumulated===void 0?null:s.globals.accumulated}],"+":[Bt,bu(Bt),function(s,u){for(var h=0,_=0,E=u;_<E.length;_+=1)h+=E[_].evaluate(s);return h}],"*":[Bt,bu(Bt),function(s,u){for(var h=1,_=0,E=u;_<E.length;_+=1)h*=E[_].evaluate(s);return h}],"-":{type:Bt,overloads:[[[Bt,Bt],function(s,u){var h=u[1];return u[0].evaluate(s)-h.evaluate(s)}],[[Bt],function(s,u){return-u[0].evaluate(s)}]]},"/":[Bt,[Bt,Bt],function(s,u){var h=u[1];return u[0].evaluate(s)/h.evaluate(s)}],"%":[Bt,[Bt,Bt],function(s,u){var h=u[1];return u[0].evaluate(s)%h.evaluate(s)}],ln2:[Bt,[],function(){return Math.LN2}],pi:[Bt,[],function(){return Math.PI}],e:[Bt,[],function(){return Math.E}],"^":[Bt,[Bt,Bt],function(s,u){var h=u[1];return Math.pow(u[0].evaluate(s),h.evaluate(s))}],sqrt:[Bt,[Bt],function(s,u){return Math.sqrt(u[0].evaluate(s))}],log10:[Bt,[Bt],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN10}],ln:[Bt,[Bt],function(s,u){return Math.log(u[0].evaluate(s))}],log2:[Bt,[Bt],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN2}],sin:[Bt,[Bt],function(s,u){return Math.sin(u[0].evaluate(s))}],cos:[Bt,[Bt],function(s,u){return Math.cos(u[0].evaluate(s))}],tan:[Bt,[Bt],function(s,u){return Math.tan(u[0].evaluate(s))}],asin:[Bt,[Bt],function(s,u){return Math.asin(u[0].evaluate(s))}],acos:[Bt,[Bt],function(s,u){return Math.acos(u[0].evaluate(s))}],atan:[Bt,[Bt],function(s,u){return Math.atan(u[0].evaluate(s))}],min:[Bt,bu(Bt),function(s,u){return Math.min.apply(Math,u.map(function(h){return h.evaluate(s)}))}],max:[Bt,bu(Bt),function(s,u){return Math.max.apply(Math,u.map(function(h){return h.evaluate(s)}))}],abs:[Bt,[Bt],function(s,u){return Math.abs(u[0].evaluate(s))}],round:[Bt,[Bt],function(s,u){var h=u[0].evaluate(s);return h<0?-Math.round(-h):Math.round(h)}],floor:[Bt,[Bt],function(s,u){return Math.floor(u[0].evaluate(s))}],ceil:[Bt,[Bt],function(s,u){return Math.ceil(u[0].evaluate(s))}],"filter-==":[Wr,[ln,Jr],function(s,u){var h=u[0],_=u[1];return s.properties()[h.value]===_.value}],"filter-id-==":[Wr,[Jr],function(s,u){var h=u[0];return s.id()===h.value}],"filter-type-==":[Wr,[ln],function(s,u){var h=u[0];return s.geometryType()===h.value}],"filter-<":[Wr,[ln,Jr],function(s,u){var h=u[0],_=u[1],E=s.properties()[h.value],A=_.value;return typeof E==typeof A&&E<A}],"filter-id-<":[Wr,[Jr],function(s,u){var h=u[0],_=s.id(),E=h.value;return typeof _==typeof E&&_<E}],"filter->":[Wr,[ln,Jr],function(s,u){var h=u[0],_=u[1],E=s.properties()[h.value],A=_.value;return typeof E==typeof A&&E>A}],"filter-id->":[Wr,[Jr],function(s,u){var h=u[0],_=s.id(),E=h.value;return typeof _==typeof E&&_>E}],"filter-<=":[Wr,[ln,Jr],function(s,u){var h=u[0],_=u[1],E=s.properties()[h.value],A=_.value;return typeof E==typeof A&&E<=A}],"filter-id-<=":[Wr,[Jr],function(s,u){var h=u[0],_=s.id(),E=h.value;return typeof _==typeof E&&_<=E}],"filter->=":[Wr,[ln,Jr],function(s,u){var h=u[0],_=u[1],E=s.properties()[h.value],A=_.value;return typeof E==typeof A&&E>=A}],"filter-id->=":[Wr,[Jr],function(s,u){var h=u[0],_=s.id(),E=h.value;return typeof _==typeof E&&_>=E}],"filter-has":[Wr,[Jr],function(s,u){return u[0].value in s.properties()}],"filter-has-id":[Wr,[],function(s){return s.id()!==null&&s.id()!==void 0}],"filter-type-in":[Wr,[Fi(ln)],function(s,u){return u[0].value.indexOf(s.geometryType())>=0}],"filter-id-in":[Wr,[Fi(Jr)],function(s,u){return u[0].value.indexOf(s.id())>=0}],"filter-in-small":[Wr,[ln,Fi(Jr)],function(s,u){var h=u[0];return u[1].value.indexOf(s.properties()[h.value])>=0}],"filter-in-large":[Wr,[ln,Fi(Jr)],function(s,u){var h=u[0],_=u[1];return function(E,A,I,D){for(;I<=D;){var V=I+D>>1;if(A[V]===E)return!0;A[V]>E?D=V-1:I=V+1}return!1}(s.properties()[h.value],_.value,0,_.value.length-1)}],all:{type:Wr,overloads:[[[Wr,Wr],function(s,u){var h=u[1];return u[0].evaluate(s)&&h.evaluate(s)}],[bu(Wr),function(s,u){for(var h=0,_=u;h<_.length;h+=1)if(!_[h].evaluate(s))return!1;return!0}]]},any:{type:Wr,overloads:[[[Wr,Wr],function(s,u){var h=u[1];return u[0].evaluate(s)||h.evaluate(s)}],[bu(Wr),function(s,u){for(var h=0,_=u;h<_.length;h+=1)if(_[h].evaluate(s))return!0;return!1}]]},"!":[Wr,[Wr],function(s,u){return!u[0].evaluate(s)}],"is-supported-script":[Wr,[ln],function(s,u){var h=s.globals&&s.globals.isSupportedScript;return!h||h(u[0].evaluate(s))}],upcase:[ln,[ln],function(s,u){return u[0].evaluate(s).toUpperCase()}],downcase:[ln,[ln],function(s,u){return u[0].evaluate(s).toLowerCase()}],concat:[ln,bu(Jr),function(s,u){return u.map(function(h){return oc(h.evaluate(s))}).join("")}],"resolved-locale":[ln,[bi],function(s,u){return u[0].evaluate(s).resolvedLocale()}]});var cc=function(s,u){this.expression=s,this._warningHistory={},this._evaluator=new Os,this._defaultValue=u?function(h){return h.type==="color"&&Dc(h.default)?new Li(0,0,0,0):h.type==="color"?Li.parse(h.default)||null:h.default===void 0?null:h.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Nc(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in lc}function fc(s,u){var h=new mf(lc,[],u?function(E){var A={color:Zr,string:ln,number:Bt,enum:ln,boolean:Wr,formatted:ci,resolvedImage:Ci};return E.type==="array"?Fi(A[E.value]||Jr,E.length):A[E.type]}(u):void 0),_=h.parse(s,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Fc(new cc(_,u)):Ys(h.errors)}cc.prototype.evaluateWithoutErrorHandling=function(s,u,h,_,E,A){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=h,this._evaluator.canonical=_,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)},cc.prototype.evaluate=function(s,u,h,_,E,A){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=h||null,this._evaluator.canonical=_,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{var I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Ya("Expected value to be one of "+Object.keys(this._enumValues).map(function(D){return JSON.stringify(D)}).join(", ")+", but found "+JSON.stringify(I)+" instead.");return I}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}};var _l=function(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!vf(u.expression)};_l.prototype.evaluateWithoutErrorHandling=function(s,u,h,_,E,A){return this._styleExpression.evaluateWithoutErrorHandling(s,u,h,_,E,A)},_l.prototype.evaluate=function(s,u,h,_,E,A){return this._styleExpression.evaluate(s,u,h,_,E,A)};var hc=function(s,u,h,_){this.kind=s,this.zoomStops=h,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!vf(u.expression),this.interpolationType=_};function np(s,u){if((s=fc(s,u)).result==="error")return s;var h=s.value.expression,_=Wl(h);if(!_&&!Bu(u))return Ys([new pr("","data expressions not supported")]);var E=Ku(h,["zoom"]);if(!E&&!Xl(u))return Ys([new pr("","zoom expressions not supported")]);var A=function I(D){var V=null;if(D instanceof Oc)V=I(D.result);else if(D instanceof Fs)for(var $=0,q=D.args;$<q.length&&!(V=I(q[$]));$+=1);else(D instanceof Ji||D instanceof Po)&&D.input instanceof Ha&&D.input.name==="zoom"&&(V=D);return V instanceof pr||D.eachChild(function(te){var oe=I(te);oe instanceof pr?V=oe:!V&&oe?V=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):V&&oe&&V!==oe&&(V=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),V}(h);return A||E?A instanceof pr?Ys([A]):A instanceof Po&&!_f(u)?Ys([new pr("",'"interpolate" expressions cannot be used with this property')]):Fc(A?new hc(_?"camera":"composite",s.value,A.labels,A instanceof Po?A.interpolation:void 0):new _l(_?"constant":"source",s.value)):Ys([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}hc.prototype.evaluateWithoutErrorHandling=function(s,u,h,_,E,A){return this._styleExpression.evaluateWithoutErrorHandling(s,u,h,_,E,A)},hc.prototype.evaluate=function(s,u,h,_,E,A){return this._styleExpression.evaluate(s,u,h,_,E,A)},hc.prototype.interpolationFactor=function(s,u,h){return this.interpolationType?Po.interpolationFactor(this.interpolationType,s,u,h):0};var zu=function(s,u){this._parameters=s,this._specification=u,Jt(this,function h(_,E){var A,I,D,V=E.type==="color",$=_.stops&&typeof _.stops[0][0]=="object",q=$||!($||_.property!==void 0),te=_.type||(_f(E)?"exponential":"interval");if(V&&((_=Jt({},_)).stops&&(_.stops=_.stops.map(function(vn){return[vn[0],Li.parse(vn[1])]})),_.default=Li.parse(_.default?_.default:E.default)),_.colorSpace&&_.colorSpace!=="rgb"&&!Dp[_.colorSpace])throw new Error("Unknown color space: "+_.colorSpace);if(te==="exponential")A=Th;else if(te==="interval")A=rp;else if(te==="categorical"){A=Nu,I=Object.create(null);for(var oe=0,fe=_.stops;oe<fe.length;oe+=1){var Pe=fe[oe];I[Pe[0]]=Pe[1]}D=typeof _.stops[0][0]}else{if(te!=="identity")throw new Error('Unknown function type "'+te+'"');A=xf}if($){for(var De={},tt=[],We=0;We<_.stops.length;We++){var lt=_.stops[We],xt=lt[0].zoom;De[xt]===void 0&&(De[xt]={zoom:xt,type:_.type,property:_.property,default:_.default,stops:[]},tt.push(xt)),De[xt].stops.push([lt[0].value,lt[1]])}for(var Lt=[],Pt=0,nr=tt;Pt<nr.length;Pt+=1){var Fr=nr[Pt];Lt.push([De[Fr].zoom,h(De[Fr],E)])}var tn={name:"linear"};return{kind:"composite",interpolationType:tn,interpolationFactor:Po.interpolationFactor.bind(void 0,tn),zoomStops:Lt.map(function(vn){return vn[0]}),evaluate:function(vn,$n){var yn=vn.zoom;return Th({stops:Lt,base:_.base},E,yn).evaluate(yn,$n)}}}if(q){var Vn=te==="exponential"?{name:"exponential",base:_.base!==void 0?_.base:1}:null;return{kind:"camera",interpolationType:Vn,interpolationFactor:Po.interpolationFactor.bind(void 0,Vn),zoomStops:_.stops.map(function(vn){return vn[0]}),evaluate:function(vn){return A(_,E,vn.zoom,I,D)}}}return{kind:"source",evaluate:function(vn,$n){var yn=$n&&$n.properties?$n.properties[_.property]:void 0;return yn===void 0?Bc(_.default,E.default):A(_,E,yn,I,D)}}}(this._parameters,this._specification))};function qs(s){var u=s.key,h=s.value,_=s.valueSpec||{},E=s.objectElementValidators||{},A=s.style,I=s.styleSpec,D=[],V=ka(h);if(V!=="object")return[new Ve(u,h,"object expected, "+V+" found")];for(var $ in h){var q=$.split(".")[0],te=_[q]||_["*"],oe=void 0;if(E[q])oe=E[q];else if(_[q])oe=Gn;else if(E["*"])oe=E["*"];else{if(!_["*"]){D.push(new Ve(u,h[$],'unknown property "'+$+'"'));continue}oe=Gn}D=D.concat(oe({key:(u&&u+".")+$,value:h[$],valueSpec:te,style:A,styleSpec:I,object:h,objectKey:$},h))}for(var fe in _)E[fe]||_[fe].required&&_[fe].default===void 0&&h[fe]===void 0&&D.push(new Ve(u,h,'missing required property "'+fe+'"'));return D}function zc(s){var u=s.value,h=s.valueSpec,_=s.style,E=s.styleSpec,A=s.key,I=s.arrayElementValidator||Gn;if(ka(u)!=="array")return[new Ve(A,u,"array expected, "+ka(u)+" found")];if(h.length&&u.length!==h.length)return[new Ve(A,u,"array length "+h.length+" expected, length "+u.length+" found")];if(h["min-length"]&&u.length<h["min-length"])return[new Ve(A,u,"array length at least "+h["min-length"]+" expected, length "+u.length+" found")];var D={type:h.value,values:h.values};E.$version<7&&(D.function=h.function),ka(h.value)==="object"&&(D=h.value);for(var V=[],$=0;$<u.length;$++)V=V.concat(I({array:u,arrayIndex:$,value:u[$],valueSpec:D,style:_,styleSpec:E,key:A+"["+$+"]"}));return V}function Uc(s){var u=s.key,h=s.value,_=s.valueSpec,E=ka(h);return E==="number"&&h!=h&&(E="NaN"),E!=="number"?[new Ve(u,h,"number expected, "+E+" found")]:"minimum"in _&&h<_.minimum?[new Ve(u,h,h+" is less than the minimum value "+_.minimum)]:"maximum"in _&&h>_.maximum?[new Ve(u,h,h+" is greater than the maximum value "+_.maximum)]:[]}function Vc(s){var u,h,_,E=s.valueSpec,A=Cr(s.value.type),I={},D=A!=="categorical"&&s.value.property===void 0,V=!D,$=ka(s.value.stops)==="array"&&ka(s.value.stops[0])==="array"&&ka(s.value.stops[0][0])==="object",q=qs({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(fe){if(A==="identity")return[new Ve(fe.key,fe.value,'identity function may not have a "stops" property')];var Pe=[],De=fe.value;return Pe=Pe.concat(zc({key:fe.key,value:De,valueSpec:fe.valueSpec,style:fe.style,styleSpec:fe.styleSpec,arrayElementValidator:te})),ka(De)==="array"&&De.length===0&&Pe.push(new Ve(fe.key,De,"array must have at least one stop")),Pe},default:function(fe){return Gn({key:fe.key,value:fe.value,valueSpec:E,style:fe.style,styleSpec:fe.styleSpec})}}});return A==="identity"&&D&&q.push(new Ve(s.key,s.value,'missing required property "property"')),A==="identity"||s.value.stops||q.push(new Ve(s.key,s.value,'missing required property "stops"')),A==="exponential"&&s.valueSpec.expression&&!_f(s.valueSpec)&&q.push(new Ve(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(V&&!Bu(s.valueSpec)?q.push(new Ve(s.key,s.value,"property functions not supported")):D&&!Xl(s.valueSpec)&&q.push(new Ve(s.key,s.value,"zoom functions not supported"))),A!=="categorical"&&!$||s.value.property!==void 0||q.push(new Ve(s.key,s.value,'"property" property is required')),q;function te(fe){var Pe=[],De=fe.value,tt=fe.key;if(ka(De)!=="array")return[new Ve(tt,De,"array expected, "+ka(De)+" found")];if(De.length!==2)return[new Ve(tt,De,"array length 2 expected, length "+De.length+" found")];if($){if(ka(De[0])!=="object")return[new Ve(tt,De,"object expected, "+ka(De[0])+" found")];if(De[0].zoom===void 0)return[new Ve(tt,De,"object stop key must have zoom")];if(De[0].value===void 0)return[new Ve(tt,De,"object stop key must have value")];if(_&&_>Cr(De[0].zoom))return[new Ve(tt,De[0].zoom,"stop zoom values must appear in ascending order")];Cr(De[0].zoom)!==_&&(_=Cr(De[0].zoom),h=void 0,I={}),Pe=Pe.concat(qs({key:tt+"[0]",value:De[0],valueSpec:{zoom:{}},style:fe.style,styleSpec:fe.styleSpec,objectElementValidators:{zoom:Uc,value:oe}}))}else Pe=Pe.concat(oe({key:tt+"[0]",value:De[0],valueSpec:{},style:fe.style,styleSpec:fe.styleSpec},De));return Nc(Dt(De[1]))?Pe.concat([new Ve(tt+"[1]",De[1],"expressions are not allowed in function stops.")]):Pe.concat(Gn({key:tt+"[1]",value:De[1],valueSpec:E,style:fe.style,styleSpec:fe.styleSpec}))}function oe(fe,Pe){var De=ka(fe.value),tt=Cr(fe.value),We=fe.value!==null?fe.value:Pe;if(u){if(De!==u)return[new Ve(fe.key,We,De+" stop domain type must match previous stop domain type "+u)]}else u=De;if(De!=="number"&&De!=="string"&&De!=="boolean")return[new Ve(fe.key,We,"stop domain value must be a number, string, or boolean")];if(De!=="number"&&A!=="categorical"){var lt="number expected, "+De+" found";return Bu(E)&&A===void 0&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(fe.key,We,lt)]}return A!=="categorical"||De!=="number"||isFinite(tt)&&Math.floor(tt)===tt?A!=="categorical"&&De==="number"&&h!==void 0&&tt<h?[new Ve(fe.key,We,"stop domain values must appear in ascending order")]:(h=tt,A==="categorical"&&tt in I?[new Ve(fe.key,We,"stop domain values must be unique")]:(I[tt]=!0,[])):[new Ve(fe.key,We,"integer expected, found "+tt)]}}function Ks(s){var u=(s.expressionContext==="property"?np:fc)(Dt(s.value),s.valueSpec);if(u.result==="error")return u.value.map(function(_){return new Ve(""+s.key+_.key,s.value,_.message)});var h=u.value.expression||u.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!h.outputDefined())return[new Ve(s.key,s.value,'Invalid data expression for "'+s.propertyKey+'". Output values must be contained as literals within the expression.')];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!vf(h))return[new Ve(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!vf(h))return[new Ve(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Ku(h,["zoom","feature-state"]))return[new Ve(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Wl(h))return[new Ve(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zl(s){var u=s.key,h=s.value,_=s.valueSpec,E=[];return Array.isArray(_.values)?_.values.indexOf(Cr(h))===-1&&E.push(new Ve(u,h,"expected one of ["+_.values.join(", ")+"], "+JSON.stringify(h)+" found")):Object.keys(_.values).indexOf(Cr(h))===-1&&E.push(new Ve(u,h,"expected one of ["+Object.keys(_.values).join(", ")+"], "+JSON.stringify(h)+" found")),E}function Yf(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(var u=0,h=s.slice(1);u<h.length;u+=1){var _=h[u];if(!Yf(_)&&typeof _!="boolean")return!1}return!0;default:return!0}}zu.deserialize=function(s){return new zu(s._parameters,s._specification)},zu.serialize=function(s){return{_parameters:s._parameters,_specification:s._specification}};var ip={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Mh(s){if(s==null)return{filter:function(){return!0},needGeometry:!1};Yf(s)||(s=su(s));var u=fc(s,ip);if(u.result==="error")throw new Error(u.value.map(function(h){return h.key+": "+h.message}).join(", "));return{filter:function(h,_,E){return u.value.evaluate(h,_,{},E)},needGeometry:function h(_){if(!Array.isArray(_))return!1;if(_[0]==="within")return!0;for(var E=1;E<_.length;E++)if(h(_[E]))return!0;return!1}(s)}}function Yl(s,u){return s<u?-1:s>u?1:0}function su(s){if(!s)return!0;var u,h=s[0];return s.length<=1?h!=="any":h==="=="?Ih(s[1],s[2],"=="):h==="!="?ap(Ih(s[1],s[2],"==")):h==="<"||h===">"||h==="<="||h===">="?Ih(s[1],s[2],h):h==="any"?(u=s.slice(1),["any"].concat(u.map(su))):h==="all"?["all"].concat(s.slice(1).map(su)):h==="none"?["all"].concat(s.slice(1).map(su).map(ap)):h==="in"?bf(s[1],s.slice(2)):h==="!in"?ap(bf(s[1],s.slice(2))):h==="has"?md(s[1]):h==="!has"?ap(md(s[1])):h!=="within"||s}function Ih(s,u,h){switch(s){case"$type":return["filter-type-"+h,u];case"$id":return["filter-id-"+h,u];default:return["filter-"+h,s,u]}}function bf(s,u){if(u.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(h){return typeof h!=typeof u[0]})?["filter-in-large",s,["literal",u.sort(Yl)]]:["filter-in-small",s,["literal",u]]}}function md(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ap(s){return["!",s]}function Np(s){return Yf(Dt(s.value))?Ks(Jt({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(h){var _=h.value,E=h.key;if(ka(_)!=="array")return[new Ve(E,_,"array expected, "+ka(_)+" found")];var A,I=h.styleSpec,D=[];if(_.length<1)return[new Ve(E,_,"filter array must have at least 1 element")];switch(D=D.concat(Zl({key:E+"[0]",value:_[0],valueSpec:I.filter_operator,style:h.style,styleSpec:h.styleSpec})),Cr(_[0])){case"<":case"<=":case">":case">=":_.length>=2&&Cr(_[1])==="$type"&&D.push(new Ve(E,_,'"$type" cannot be use with operator "'+_[0]+'"'));case"==":case"!=":_.length!==3&&D.push(new Ve(E,_,'filter array for operator "'+_[0]+'" must have 3 elements'));case"in":case"!in":_.length>=2&&(A=ka(_[1]))!=="string"&&D.push(new Ve(E+"[1]",_[1],"string expected, "+A+" found"));for(var V=2;V<_.length;V++)A=ka(_[V]),Cr(_[1])==="$type"?D=D.concat(Zl({key:E+"["+V+"]",value:_[V],valueSpec:I.geometry_type,style:h.style,styleSpec:h.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&D.push(new Ve(E+"["+V+"]",_[V],"string, number, or boolean expected, "+A+" found"));break;case"any":case"all":case"none":for(var $=1;$<_.length;$++)D=D.concat(u({key:E+"["+$+"]",value:_[$],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":A=ka(_[1]),_.length!==2?D.push(new Ve(E,_,'filter array for "'+_[0]+'" operator must have 2 elements')):A!=="string"&&D.push(new Ve(E+"[1]",_[1],"string expected, "+A+" found"));break;case"within":A=ka(_[1]),_.length!==2?D.push(new Ve(E,_,'filter array for "'+_[0]+'" operator must have 2 elements')):A!=="object"&&D.push(new Ve(E+"[1]",_[1],"object expected, "+A+" found"))}return D}(s)}function Ef(s,u){var h=s.key,_=s.style,E=s.styleSpec,A=s.value,I=s.objectKey,D=E[u+"_"+s.layerType];if(!D)return[];var V=I.match(/^(.*)-transition$/);if(u==="paint"&&V&&D[V[1]]&&D[V[1]].transition)return Gn({key:h,value:A,valueSpec:E.transition,style:_,styleSpec:E});var $,q=s.valueSpec||D[I];if(!q)return[new Ve(h,A,'unknown property "'+I+'"')];if(ka(A)==="string"&&Bu(q)&&!q.tokens&&($=/^{([^}]+)}$/.exec(A)))return[new Ve(h,A,'"'+I+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify($[1])+" }`.")];var te=[];return s.layerType==="symbol"&&(I==="text-field"&&_&&!_.glyphs&&te.push(new Ve(h,A,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Dc(Dt(A))&&Cr(A.type)==="identity"&&te.push(new Ve(h,A,'"text-font" does not support identity functions'))),te.concat(Gn({key:s.key,value:A,valueSpec:q,style:_,styleSpec:E,expressionContext:"property",propertyType:u,propertyKey:I}))}function Gc(s){return Ef(s,"paint")}function pt(s){return Ef(s,"layout")}function ur(s){var u=[],h=s.value,_=s.key,E=s.style,A=s.styleSpec;h.type||h.ref||u.push(new Ve(_,h,'either "type" or "ref" is required'));var I,D=Cr(h.type),V=Cr(h.ref);if(h.id)for(var $=Cr(h.id),q=0;q<s.arrayIndex;q++){var te=E.layers[q];Cr(te.id)===$&&u.push(new Ve(_,h.id,'duplicate layer id "'+h.id+'", previously used at line '+te.id.__line__))}if("ref"in h)["type","source","source-layer","filter","layout"].forEach(function(Pe){Pe in h&&u.push(new Ve(_,h[Pe],'"'+Pe+'" is prohibited for ref layers'))}),E.layers.forEach(function(Pe){Cr(Pe.id)===V&&(I=Pe)}),I?I.ref?u.push(new Ve(_,h.ref,"ref cannot reference another ref layer")):D=Cr(I.type):u.push(new Ve(_,h.ref,'ref layer "'+V+'" not found'));else if(D!=="background")if(h.source){var oe=E.sources&&E.sources[h.source],fe=oe&&Cr(oe.type);oe?fe==="vector"&&D==="raster"?u.push(new Ve(_,h.source,'layer "'+h.id+'" requires a raster source')):fe==="raster"&&D!=="raster"?u.push(new Ve(_,h.source,'layer "'+h.id+'" requires a vector source')):fe!=="vector"||h["source-layer"]?fe==="raster-dem"&&D!=="hillshade"?u.push(new Ve(_,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="line"||!h.paint||!h.paint["line-gradient"]||fe==="geojson"&&oe.lineMetrics||u.push(new Ve(_,h,'layer "'+h.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Ve(_,h,'layer "'+h.id+'" must specify a "source-layer"')):u.push(new Ve(_,h.source,'source "'+h.source+'" not found'))}else u.push(new Ve(_,h,'missing required property "source"'));return u=u.concat(qs({key:_,value:h,valueSpec:A.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gn({key:_+".type",value:h.type,valueSpec:A.layer.type,style:s.style,styleSpec:s.styleSpec,object:h,objectKey:"type"})},filter:Np,layout:function(Pe){return qs({layer:h,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(De){return pt(Jt({layerType:D},De))}}})},paint:function(Pe){return qs({layer:h,key:Pe.key,value:Pe.value,style:Pe.style,styleSpec:Pe.styleSpec,objectElementValidators:{"*":function(De){return Gc(Jt({layerType:D},De))}}})}}}))}function Vt(s){var u=s.value,h=s.key,_=ka(u);return _!=="string"?[new Ve(h,u,"string expected, "+_+" found")]:[]}var on={promoteId:function(s){var u=s.key,h=s.value;if(ka(h)==="string")return Vt({key:u,value:h});var _=[];for(var E in h)_.push.apply(_,Vt({key:u+"."+E,value:h[E]}));return _}};function Ei(s){var u=s.value,h=s.key,_=s.styleSpec,E=s.style;if(!u.type)return[new Ve(h,u,'"type" is required')];var A,I=Cr(u.type);switch(I){case"vector":case"raster":case"raster-dem":return qs({key:h,value:u,valueSpec:_["source_"+I.replace("-","_")],style:s.style,styleSpec:_,objectElementValidators:on});case"geojson":if(A=qs({key:h,value:u,valueSpec:_.source_geojson,style:E,styleSpec:_,objectElementValidators:on}),u.cluster)for(var D in u.clusterProperties){var V=u.clusterProperties[D],$=V[0],q=typeof $=="string"?[$,["accumulated"],["get",D]]:$;A.push.apply(A,Ks({key:h+"."+D+".map",value:V[1],expressionContext:"cluster-map"})),A.push.apply(A,Ks({key:h+"."+D+".reduce",value:q,expressionContext:"cluster-reduce"}))}return A;case"video":return qs({key:h,value:u,valueSpec:_.source_video,style:E,styleSpec:_});case"image":return qs({key:h,value:u,valueSpec:_.source_image,style:E,styleSpec:_});case"canvas":return[new Ve(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zl({key:h+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,styleSpec:_})}}function ua(s){var u=s.value,h=s.styleSpec,_=h.light,E=s.style,A=[],I=ka(u);if(u===void 0)return A;if(I!=="object")return A.concat([new Ve("light",u,"object expected, "+I+" found")]);for(var D in u){var V=D.match(/^(.*)-transition$/);A=A.concat(V&&_[V[1]]&&_[V[1]].transition?Gn({key:D,value:u[D],valueSpec:h.transition,style:E,styleSpec:h}):_[D]?Gn({key:D,value:u[D],valueSpec:_[D],style:E,styleSpec:h}):[new Ve(D,u[D],'unknown property "'+D+'"')])}return A}var no={"*":function(){return[]},array:zc,boolean:function(s){var u=s.value,h=s.key,_=ka(u);return _!=="boolean"?[new Ve(h,u,"boolean expected, "+_+" found")]:[]},number:Uc,color:function(s){var u=s.key,h=s.value,_=ka(h);return _!=="string"?[new Ve(u,h,"color expected, "+_+" found")]:pi(h)===null?[new Ve(u,h,'color expected, "'+h+'" found')]:[]},constants:mt,enum:Zl,filter:Np,function:Vc,layer:ur,object:qs,source:Ei,light:ua,string:Vt,formatted:function(s){return Vt(s).length===0?[]:Ks(s)},resolvedImage:function(s){return Vt(s).length===0?[]:Ks(s)}};function Gn(s){var u=s.value,h=s.valueSpec,_=s.styleSpec;return h.expression&&Dc(Cr(u))?Vc(s):h.expression&&Nc(Dt(u))?Ks(s):h.type&&no[h.type]?no[h.type](s):qs(Jt({},s,{valueSpec:h.type?_[h.type]:h}))}function qi(s){var u=s.value,h=s.key,_=Vt(s);return _.length||(u.indexOf("{fontstack}")===-1&&_.push(new Ve(h,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&_.push(new Ve(h,u,'"glyphs" url must include a "{range}" token'))),_}function Qs(s,u){u===void 0&&(u=ge);var h=[];return h=h.concat(Gn({key:"",value:s,valueSpec:u.$root,styleSpec:u,style:s,objectElementValidators:{glyphs:qi,"*":function(){return[]}}})),s.constants&&(h=h.concat(mt({key:"constants",value:s.constants,style:s,styleSpec:u}))),uu(h)}function uu(s){return[].concat(s).sort(function(u,h){return u.line-h.line})}function jc(s){return function(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];return uu(s.apply(this,u))}}Qs.source=jc(Ei),Qs.light=jc(ua),Qs.layer=jc(ur),Qs.filter=jc(Np),Qs.paintProperty=jc(Gc),Qs.layoutProperty=jc(pt);var Lh=Qs,qf=Lh.light,pc=Lh.paintProperty,Cf=Lh.layoutProperty;function fa(s,u){var h=!1;if(u&&u.length)for(var _=0,E=u;_<E.length;_+=1)s.fire(new et(new Error(E[_].message))),h=!0;return h}var ql=lo;function lo(s,u,h){var _=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var E=new Int32Array(this.arrayBuffer);s=E[0],this.d=(u=E[1])+2*(h=E[2]);for(var A=0;A<this.d*this.d;A++){var I=E[3+A],D=E[3+A+1];_.push(I===D?null:E.subarray(I,D))}var V=E[3+_.length+1];this.keys=E.subarray(E[3+_.length],V),this.bboxes=E.subarray(V),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var $=0;$<this.d*this.d;$++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=h,this.scale=u/s,this.uid=0;var q=h/u*s;this.min=-q,this.max=s+q}lo.prototype.insert=function(s,u,h,_,E){this._forEachCell(u,h,_,E,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(E)},lo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},lo.prototype._insertCell=function(s,u,h,_,E,A){this.cells[E].push(A)},lo.prototype.query=function(s,u,h,_,E){var A=this.min,I=this.max;if(s<=A&&u<=A&&I<=h&&I<=_&&!E)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(s,u,h,_,this._queryCell,D,{},E),D},lo.prototype._queryCell=function(s,u,h,_,E,A,I,D){var V=this.cells[E];if(V!==null)for(var $=this.keys,q=this.bboxes,te=0;te<V.length;te++){var oe=V[te];if(I[oe]===void 0){var fe=4*oe;(D?D(q[fe+0],q[fe+1],q[fe+2],q[fe+3]):s<=q[fe+2]&&u<=q[fe+3]&&h>=q[fe+0]&&_>=q[fe+1])?(I[oe]=!0,A.push($[oe])):I[oe]=!1}}},lo.prototype._forEachCell=function(s,u,h,_,E,A,I,D){for(var V=this._convertToCellCoord(s),$=this._convertToCellCoord(u),q=this._convertToCellCoord(h),te=this._convertToCellCoord(_),oe=V;oe<=q;oe++)for(var fe=$;fe<=te;fe++){var Pe=this.d*fe+oe;if((!D||D(this._convertFromCellCoord(oe),this._convertFromCellCoord(fe),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(fe+1)))&&E.call(this,s,u,h,_,Pe,A,I,D))return}},lo.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},lo.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},lo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=3+this.cells.length+1+1,h=0,_=0;_<this.cells.length;_++)h+=this.cells[_].length;var E=new Int32Array(u+h+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;for(var A=u,I=0;I<s.length;I++){var D=s[I];E[3+I]=A,E.set(D,A),A+=D.length}return E[3+s.length]=A,E.set(this.keys,A),E[3+s.length+1]=A+=this.keys.length,E.set(this.bboxes,A),A+=this.bboxes.length,E.buffer};var Sf=w.ImageData,op=w.ImageBitmap,ba={};function mn(s,u,h){h===void 0&&(h={}),Object.defineProperty(u,"_classRegistryKey",{value:s,writeable:!1}),ba[s]={klass:u,omit:h.omit||[],shallow:h.shallow||[]}}for(var Xo in mn("Object",Object),ql.serialize=function(s,u){var h=s.toArrayBuffer();return u&&u.push(h),{buffer:h}},ql.deserialize=function(s){return new ql(s.buffer)},mn("Grid",ql),mn("Color",Li),mn("Error",Error),mn("ResolvedImage",da),mn("StylePropertyFunction",zu),mn("StyleExpression",cc,{omit:["_evaluator"]}),mn("ZoomDependentExpression",hc),mn("ZoomConstantExpression",_l),mn("CompoundExpression",Ha,{omit:["_evaluate"]}),lc)lc[Xo]._classRegistryKey||mn("Expression_"+Xo,lc[Xo]);function Js(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Ju(s){return op&&s instanceof op}function Uu(s,u){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Js(s)||Ju(s))return u&&u.push(s),s;if(ArrayBuffer.isView(s)){var h=s;return u&&u.push(h.buffer),h}if(s instanceof Sf)return u&&u.push(s.data.buffer),s;if(Array.isArray(s)){for(var _=[],E=0,A=s;E<A.length;E+=1)_.push(Uu(A[E],u));return _}if(typeof s=="object"){var I=s.constructor,D=I._classRegistryKey;if(!D)throw new Error("can't serialize object of unregistered class");var V=I.serialize?I.serialize(s,u):{};if(!I.serialize){for(var $ in s)if(s.hasOwnProperty($)&&!(ba[D].omit.indexOf($)>=0)){var q=s[$];V[$]=ba[D].shallow.indexOf($)>=0?q:Uu(q,u)}s instanceof Error&&(V.message=s.message)}if(V.$name)throw new Error("$name property is reserved for worker serialization logic.");return D!=="Object"&&(V.$name=D),V}throw new Error("can't serialize object of type "+typeof s)}function fs(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Js(s)||Ju(s)||ArrayBuffer.isView(s)||s instanceof Sf)return s;if(Array.isArray(s))return s.map(fs);if(typeof s=="object"){var u=s.$name||"Object",h=ba[u].klass;if(!h)throw new Error("can't deserialize unregistered class "+u);if(h.deserialize)return h.deserialize(s);for(var _=Object.create(h.prototype),E=0,A=Object.keys(s);E<A.length;E+=1){var I=A[E];if(I!=="$name"){var D=s[I];_[I]=ba[u].shallow.indexOf(I)>=0?D:fs(D)}}return _}throw new Error("can't deserialize object of type "+typeof s)}var Kf=function(){this.first=!0};Kf.prototype.update=function(s,u){var h=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=h,!0))};var qr={"Latin-1 Supplement":function(s){return s>=128&&s<=255},Arabic:function(s){return s>=1536&&s<=1791},"Arabic Supplement":function(s){return s>=1872&&s<=1919},"Arabic Extended-A":function(s){return s>=2208&&s<=2303},"Hangul Jamo":function(s){return s>=4352&&s<=4607},"Unified Canadian Aboriginal Syllabics":function(s){return s>=5120&&s<=5759},Khmer:function(s){return s>=6016&&s<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(s){return s>=6320&&s<=6399},"General Punctuation":function(s){return s>=8192&&s<=8303},"Letterlike Symbols":function(s){return s>=8448&&s<=8527},"Number Forms":function(s){return s>=8528&&s<=8591},"Miscellaneous Technical":function(s){return s>=8960&&s<=9215},"Control Pictures":function(s){return s>=9216&&s<=9279},"Optical Character Recognition":function(s){return s>=9280&&s<=9311},"Enclosed Alphanumerics":function(s){return s>=9312&&s<=9471},"Geometric Shapes":function(s){return s>=9632&&s<=9727},"Miscellaneous Symbols":function(s){return s>=9728&&s<=9983},"Miscellaneous Symbols and Arrows":function(s){return s>=11008&&s<=11263},"CJK Radicals Supplement":function(s){return s>=11904&&s<=12031},"Kangxi Radicals":function(s){return s>=12032&&s<=12255},"Ideographic Description Characters":function(s){return s>=12272&&s<=12287},"CJK Symbols and Punctuation":function(s){return s>=12288&&s<=12351},Hiragana:function(s){return s>=12352&&s<=12447},Katakana:function(s){return s>=12448&&s<=12543},Bopomofo:function(s){return s>=12544&&s<=12591},"Hangul Compatibility Jamo":function(s){return s>=12592&&s<=12687},Kanbun:function(s){return s>=12688&&s<=12703},"Bopomofo Extended":function(s){return s>=12704&&s<=12735},"CJK Strokes":function(s){return s>=12736&&s<=12783},"Katakana Phonetic Extensions":function(s){return s>=12784&&s<=12799},"Enclosed CJK Letters and Months":function(s){return s>=12800&&s<=13055},"CJK Compatibility":function(s){return s>=13056&&s<=13311},"CJK Unified Ideographs Extension A":function(s){return s>=13312&&s<=19903},"Yijing Hexagram Symbols":function(s){return s>=19904&&s<=19967},"CJK Unified Ideographs":function(s){return s>=19968&&s<=40959},"Yi Syllables":function(s){return s>=40960&&s<=42127},"Yi Radicals":function(s){return s>=42128&&s<=42191},"Hangul Jamo Extended-A":function(s){return s>=43360&&s<=43391},"Hangul Syllables":function(s){return s>=44032&&s<=55215},"Hangul Jamo Extended-B":function(s){return s>=55216&&s<=55295},"Private Use Area":function(s){return s>=57344&&s<=63743},"CJK Compatibility Ideographs":function(s){return s>=63744&&s<=64255},"Arabic Presentation Forms-A":function(s){return s>=64336&&s<=65023},"Vertical Forms":function(s){return s>=65040&&s<=65055},"CJK Compatibility Forms":function(s){return s>=65072&&s<=65103},"Small Form Variants":function(s){return s>=65104&&s<=65135},"Arabic Presentation Forms-B":function(s){return s>=65136&&s<=65279},"Halfwidth and Fullwidth Forms":function(s){return s>=65280&&s<=65519}};function Kl(s){for(var u=0,h=s;u<h.length;u+=1)if(Jo(h[u].charCodeAt(0)))return!0;return!1}function Jo(s){return!(s!==746&&s!==747&&(s<4352||!(qr["Bopomofo Extended"](s)||qr.Bopomofo(s)||qr["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||qr["CJK Compatibility Ideographs"](s)||qr["CJK Compatibility"](s)||qr["CJK Radicals Supplement"](s)||qr["CJK Strokes"](s)||!(!qr["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||qr["CJK Unified Ideographs Extension A"](s)||qr["CJK Unified Ideographs"](s)||qr["Enclosed CJK Letters and Months"](s)||qr["Hangul Compatibility Jamo"](s)||qr["Hangul Jamo Extended-A"](s)||qr["Hangul Jamo Extended-B"](s)||qr["Hangul Jamo"](s)||qr["Hangul Syllables"](s)||qr.Hiragana(s)||qr["Ideographic Description Characters"](s)||qr.Kanbun(s)||qr["Kangxi Radicals"](s)||qr["Katakana Phonetic Extensions"](s)||qr.Katakana(s)&&s!==12540||!(!qr["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!qr["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||qr["Unified Canadian Aboriginal Syllabics"](s)||qr["Unified Canadian Aboriginal Syllabics Extended"](s)||qr["Vertical Forms"](s)||qr["Yijing Hexagram Symbols"](s)||qr["Yi Syllables"](s)||qr["Yi Radicals"](s))))}function Hc(s){return!(Jo(s)||function(u){return!!(qr["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||qr["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||qr["Letterlike Symbols"](u)||qr["Number Forms"](u)||qr["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||qr["Control Pictures"](u)&&u!==9251||qr["Optical Character Recognition"](u)||qr["Enclosed Alphanumerics"](u)||qr["Geometric Shapes"](u)||qr["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||qr["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||qr["CJK Symbols and Punctuation"](u)||qr.Katakana(u)||qr["Private Use Area"](u)||qr["CJK Compatibility Forms"](u)||qr["Small Form Variants"](u)||qr["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(s))}function hs(s){return s>=1424&&s<=2303||qr["Arabic Presentation Forms-A"](s)||qr["Arabic Presentation Forms-B"](s)}function Bo(s,u){return!(!u&&hs(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||qr.Khmer(s))}function kh(s){for(var u=0,h=s;u<h.length;u+=1)if(hs(h[u].charCodeAt(0)))return!0;return!1}var sp=null,Eu="unavailable",xl=null,dc=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Eu="error"),sp&&sp(s)};function bl(){Qf.fire(new Be("pluginStateChange",{pluginStatus:Eu,pluginURL:xl}))}var Qf=new ot,vc=function(){return Eu},el=function(){if(Eu!=="deferred"||!xl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Eu="loading",bl(),xl&&Fu({url:xl},function(s){s?dc(s):(Eu="loaded",bl())})},Vu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Eu==="loaded"||Vu.applyArabicShaping!=null},isLoading:function(){return Eu==="loading"},setState:function(s){Eu=s.pluginStatus,xl=s.pluginURL},isParsed:function(){return Vu.applyArabicShaping!=null&&Vu.processBidirectionalText!=null&&Vu.processStyledBidirectionalText!=null},getPluginURL:function(){return xl}},ti=function(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kf,this.transition={})};ti.prototype.isSupportedScript=function(s){return function(u,h){for(var _=0,E=u;_<E.length;_+=1)if(!Bo(E[_].charCodeAt(0),h))return!1;return!0}(s,Vu.isLoaded())},ti.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ti.prototype.getCrossfadeParameters=function(){var s=this.zoom,u=s-Math.floor(s),h=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*u}};var _o=function(s,u){this.property=s,this.value=u,this.expression=function(h,_){if(Dc(h))return new zu(h,_);if(Nc(h)){var E=np(h,_);if(E.result==="error")throw new Error(E.value.map(function(I){return I.key+": "+I.message}).join(", "));return E.value}var A=h;return typeof h=="string"&&_.type==="color"&&(A=Li.parse(h)),{kind:"constant",evaluate:function(){return A}}}(u===void 0?s.specification.default:u,s.specification)};_o.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},_o.prototype.possiblyEvaluate=function(s,u,h){return this.property.possiblyEvaluate(this,s,u,h)};var Cu=function(s){this.property=s,this.value=new _o(s,void 0)};Cu.prototype.transitioned=function(s,u){return new El(this.property,this.value,u,Y({},s.transition,this.transition),s.now)},Cu.prototype.untransitioned=function(){return new El(this.property,this.value,null,{},0)};var Ds=function(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)};Ds.prototype.getValue=function(s){return Ce(this._values[s].value.value)},Ds.prototype.setValue=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new Cu(this._values[s].property)),this._values[s].value=new _o(this._values[s].property,u===null?void 0:Ce(u))},Ds.prototype.getTransition=function(s){return Ce(this._values[s].transition)},Ds.prototype.setTransition=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new Cu(this._values[s].property)),this._values[s].transition=Ce(u)||void 0},Ds.prototype.serialize=function(){for(var s={},u=0,h=Object.keys(this._values);u<h.length;u+=1){var _=h[u],E=this.getValue(_);E!==void 0&&(s[_]=E);var A=this.getTransition(_);A!==void 0&&(s[_+"-transition"]=A)}return s},Ds.prototype.transitioned=function(s,u){for(var h=new Wc(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var A=E[_];h._values[A]=this._values[A].transitioned(s,u._values[A])}return h},Ds.prototype.untransitioned=function(){for(var s=new Wc(this._properties),u=0,h=Object.keys(this._values);u<h.length;u+=1){var _=h[u];s._values[_]=this._values[_].untransitioned()}return s};var El=function(s,u,h,_,E){this.property=s,this.value=u,this.begin=E+_.delay||0,this.end=this.begin+_.duration||0,s.specification.transition&&(_.delay||_.duration)&&(this.prior=h)};El.prototype.possiblyEvaluate=function(s,u,h){var _=s.now||0,E=this.value.possiblyEvaluate(s,u,h),A=this.prior;if(A){if(_>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(_<this.begin)return A.possiblyEvaluate(s,u,h);var I=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(s,u,h),E,function(D){if(D<=0)return 0;if(D>=1)return 1;var V=D*D,$=V*D;return 4*(D<.5?$:3*(D-V)+$-.75)}(I))}return E};var Wc=function(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)};Wc.prototype.possiblyEvaluate=function(s,u,h){for(var _=new $c(this._properties),E=0,A=Object.keys(this._values);E<A.length;E+=1){var I=A[E];_._values[I]=this._values[I].possiblyEvaluate(s,u,h)}return _},Wc.prototype.hasTransition=function(){for(var s=0,u=Object.keys(this._values);s<u.length;s+=1)if(this._values[u[s]].prior)return!0;return!1};var ps=function(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)};ps.prototype.getValue=function(s){return Ce(this._values[s].value)},ps.prototype.setValue=function(s,u){this._values[s]=new _o(this._values[s].property,u===null?void 0:Ce(u))},ps.prototype.serialize=function(){for(var s={},u=0,h=Object.keys(this._values);u<h.length;u+=1){var _=h[u],E=this.getValue(_);E!==void 0&&(s[_]=E)}return s},ps.prototype.possiblyEvaluate=function(s,u,h){for(var _=new $c(this._properties),E=0,A=Object.keys(this._values);E<A.length;E+=1){var I=A[E];_._values[I]=this._values[I].possiblyEvaluate(s,u,h)}return _};var xo=function(s,u,h){this.property=s,this.value=u,this.parameters=h};xo.prototype.isConstant=function(){return this.value.kind==="constant"},xo.prototype.constantOr=function(s){return this.value.kind==="constant"?this.value.value:s},xo.prototype.evaluate=function(s,u,h,_){return this.property.evaluate(this.value,this.parameters,s,u,h,_)};var $c=function(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)};$c.prototype.get=function(s){return this._values[s]};var kn=function(s){this.specification=s};kn.prototype.possiblyEvaluate=function(s,u){return s.expression.evaluate(u)},kn.prototype.interpolate=function(s,u,h){var _=$l[this.specification.type];return _?_(s,u,h):s};var bn=function(s,u){this.specification=s,this.overrides=u};bn.prototype.possiblyEvaluate=function(s,u,h,_){return new xo(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},h,_)}:s.expression,u)},bn.prototype.interpolate=function(s,u,h){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},s.parameters);var _=$l[this.specification.type];return _?new xo(this,{kind:"constant",value:_(s.value.value,u.value.value,h)},s.parameters):s},bn.prototype.evaluate=function(s,u,h,_,E,A){return s.kind==="constant"?s.value:s.evaluate(u,h,_,E,A)};var mc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(h,_,E,A){if(h.value===void 0)return new xo(this,{kind:"constant",value:void 0},_);if(h.expression.kind==="constant"){var I=h.expression.evaluate(_,null,{},E,A),D=h.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,V=this._calculate(D,D,D,_);return new xo(this,{kind:"constant",value:V},_)}if(h.expression.kind==="camera"){var $=this._calculate(h.expression.evaluate({zoom:_.zoom-1}),h.expression.evaluate({zoom:_.zoom}),h.expression.evaluate({zoom:_.zoom+1}),_);return new xo(this,{kind:"constant",value:$},_)}return new xo(this,h.expression,_)},u.prototype.evaluate=function(h,_,E,A,I,D){if(h.kind==="source"){var V=h.evaluate(_,E,A,I,D);return this._calculate(V,V,V,_)}return h.kind==="composite"?this._calculate(h.evaluate({zoom:Math.floor(_.zoom)-1},E,A),h.evaluate({zoom:Math.floor(_.zoom)},E,A),h.evaluate({zoom:Math.floor(_.zoom)+1},E,A),_):h.value},u.prototype._calculate=function(h,_,E,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:h,to:_}:{from:E,to:_}},u.prototype.interpolate=function(h){return h},u}(bn),ds=function(s){this.specification=s};ds.prototype.possiblyEvaluate=function(s,u,h,_){if(s.value!==void 0){if(s.expression.kind==="constant"){var E=s.expression.evaluate(u,null,{},h,_);return this._calculate(E,E,E,u)}return this._calculate(s.expression.evaluate(new ti(Math.floor(u.zoom-1),u)),s.expression.evaluate(new ti(Math.floor(u.zoom),u)),s.expression.evaluate(new ti(Math.floor(u.zoom+1),u)),u)}},ds.prototype._calculate=function(s,u,h,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:h,to:u}},ds.prototype.interpolate=function(s){return s};var Bs=function(s){this.specification=s};Bs.prototype.possiblyEvaluate=function(s,u,h,_){return!!s.expression.evaluate(u,null,{},h,_)},Bs.prototype.interpolate=function(){return!1};var is=function(s){for(var u in this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],s){var h=s[u];h.specification.overridable&&this.overridableProperties.push(u);var _=this.defaultPropertyValues[u]=new _o(h,void 0),E=this.defaultTransitionablePropertyValues[u]=new Cu(h);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate({})}};mn("DataDrivenProperty",bn),mn("DataConstantProperty",kn),mn("CrossFadedDataDrivenProperty",mc),mn("CrossFadedProperty",ds),mn("ColorRampProperty",Bs);var Cl=function(s){function u(h,_){if(s.call(this),this.id=h.id,this.type=h.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},h.type!=="custom"&&(this.metadata=(h=h).metadata,this.minzoom=h.minzoom,this.maxzoom=h.maxzoom,h.type!=="background"&&(this.source=h.source,this.sourceLayer=h["source-layer"],this.filter=h.filter),_.layout&&(this._unevaluatedLayout=new ps(_.layout)),_.paint)){for(var E in this._transitionablePaint=new Ds(_.paint),h.paint)this.setPaintProperty(E,h.paint[E],{validate:!1});for(var A in h.layout)this.setLayoutProperty(A,h.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $c(_.paint)}}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(h){return h==="visibility"?this.visibility:this._unevaluatedLayout.getValue(h)},u.prototype.setLayoutProperty=function(h,_,E){E===void 0&&(E={}),_!=null&&this._validate(Cf,"layers."+this.id+".layout."+h,h,_,E)||(h!=="visibility"?this._unevaluatedLayout.setValue(h,_):this.visibility=_)},u.prototype.getPaintProperty=function(h){return ue(h,"-transition")?this._transitionablePaint.getTransition(h.slice(0,-11)):this._transitionablePaint.getValue(h)},u.prototype.setPaintProperty=function(h,_,E){if(E===void 0&&(E={}),_!=null&&this._validate(pc,"layers."+this.id+".paint."+h,h,_,E))return!1;if(ue(h,"-transition"))return this._transitionablePaint.setTransition(h.slice(0,-11),_||void 0),!1;var A=this._transitionablePaint._values[h],I=A.property.specification["property-type"]==="cross-faded-data-driven",D=A.value.isDataDriven(),V=A.value;this._transitionablePaint.setValue(h,_),this._handleSpecialPaintPropertyUpdate(h);var $=this._transitionablePaint._values[h].value;return $.isDataDriven()||D||I||this._handleOverridablePaintPropertyUpdate(h,V,$)},u.prototype._handleSpecialPaintPropertyUpdate=function(h){},u.prototype._handleOverridablePaintPropertyUpdate=function(h,_,E){return!1},u.prototype.isHidden=function(h){return!!(this.minzoom&&h<this.minzoom)||!!(this.maxzoom&&h>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(h){this._transitioningPaint=this._transitionablePaint.transitioned(h,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(h,_){h.getCrossfadeParameters&&(this._crossfadeParameters=h.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(h,void 0,_)),this.paint=this._transitioningPaint.possiblyEvaluate(h,void 0,_)},u.prototype.serialize=function(){var h={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(h.layout=h.layout||{},h.layout.visibility=this.visibility),ke(h,function(_,E){return!(_===void 0||E==="layout"&&!Object.keys(_).length||E==="paint"&&!Object.keys(_).length)})},u.prototype._validate=function(h,_,E,A,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&fa(this,h.call(Lh,{key:_,layerType:this.type,objectKey:E,value:A,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var h in this.paint._values){var _=this.paint.get(h);if(_ instanceof xo&&Bu(_.property.specification)&&(_.value.kind==="source"||_.value.kind==="composite")&&_.value.isStateDependent)return!0}return!1},u}(ot),zp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Su=function(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ma=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function es(s,u){u===void 0&&(u=1);var h=0,_=0;return{members:s.map(function(E){var A=zp[E.type].BYTES_PER_ELEMENT,I=h=lu(h,Math.max(u,A)),D=E.components||1;return _=Math.max(_,A),h+=A*D,{name:E.name,type:E.type,components:D,offset:I}}),size:lu(h,Math.max(_,u)),alignment:u}}function lu(s,u){return Math.ceil(s/u)*u}ma.serialize=function(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}},ma.deserialize=function(s){var u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},ma.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ma.prototype.clear=function(){this.length=0},ma.prototype.resize=function(s){this.reserve(s),this.length=s},ma.prototype.reserve=function(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},ma.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Sl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_){var E=this.length;return this.resize(E+1),this.emplace(E,h,_)},u.prototype.emplace=function(h,_,E){var A=2*h;return this.int16[A+0]=_,this.int16[A+1]=E,h},u}(ma);Sl.prototype.bytesPerElement=4,mn("StructArrayLayout2i4",Sl);var ye=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A){var I=this.length;return this.resize(I+1),this.emplace(I,h,_,E,A)},u.prototype.emplace=function(h,_,E,A,I){var D=4*h;return this.int16[D+0]=_,this.int16[D+1]=E,this.int16[D+2]=A,this.int16[D+3]=I,h},u}(ma);ye.prototype.bytesPerElement=8,mn("StructArrayLayout4i8",ye);var Ns=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D){var V=this.length;return this.resize(V+1),this.emplace(V,h,_,E,A,I,D)},u.prototype.emplace=function(h,_,E,A,I,D,V){var $=6*h;return this.int16[$+0]=_,this.int16[$+1]=E,this.int16[$+2]=A,this.int16[$+3]=I,this.int16[$+4]=D,this.int16[$+5]=V,h},u}(ma);Ns.prototype.bytesPerElement=12,mn("StructArrayLayout2i4i12",Ns);var vs=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D){var V=this.length;return this.resize(V+1),this.emplace(V,h,_,E,A,I,D)},u.prototype.emplace=function(h,_,E,A,I,D,V){var $=4*h,q=8*h;return this.int16[$+0]=_,this.int16[$+1]=E,this.uint8[q+4]=A,this.uint8[q+5]=I,this.uint8[q+6]=D,this.uint8[q+7]=V,h},u}(ma);vs.prototype.bytesPerElement=8,mn("StructArrayLayout2i4ub8",vs);var Es=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_){var E=this.length;return this.resize(E+1),this.emplace(E,h,_)},u.prototype.emplace=function(h,_,E){var A=2*h;return this.float32[A+0]=_,this.float32[A+1]=E,h},u}(ma);Es.prototype.bytesPerElement=8,mn("StructArrayLayout2f8",Es);var Ii=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D,V,$,q,te){var oe=this.length;return this.resize(oe+1),this.emplace(oe,h,_,E,A,I,D,V,$,q,te)},u.prototype.emplace=function(h,_,E,A,I,D,V,$,q,te,oe){var fe=10*h;return this.uint16[fe+0]=_,this.uint16[fe+1]=E,this.uint16[fe+2]=A,this.uint16[fe+3]=I,this.uint16[fe+4]=D,this.uint16[fe+5]=V,this.uint16[fe+6]=$,this.uint16[fe+7]=q,this.uint16[fe+8]=te,this.uint16[fe+9]=oe,h},u}(ma);Ii.prototype.bytesPerElement=20,mn("StructArrayLayout10ui20",Ii);var Jf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D,V,$,q,te,oe,fe){var Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,h,_,E,A,I,D,V,$,q,te,oe,fe)},u.prototype.emplace=function(h,_,E,A,I,D,V,$,q,te,oe,fe,Pe){var De=12*h;return this.int16[De+0]=_,this.int16[De+1]=E,this.int16[De+2]=A,this.int16[De+3]=I,this.uint16[De+4]=D,this.uint16[De+5]=V,this.uint16[De+6]=$,this.uint16[De+7]=q,this.int16[De+8]=te,this.int16[De+9]=oe,this.int16[De+10]=fe,this.int16[De+11]=Pe,h},u}(ma);Jf.prototype.bytesPerElement=24,mn("StructArrayLayout4i4ui4i24",Jf);var wu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,h,_,E)},u.prototype.emplace=function(h,_,E,A){var I=3*h;return this.float32[I+0]=_,this.float32[I+1]=E,this.float32[I+2]=A,h},u}(ma);wu.prototype.bytesPerElement=12,mn("StructArrayLayout3f12",wu);var Rh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h){var _=this.length;return this.resize(_+1),this.emplace(_,h)},u.prototype.emplace=function(h,_){return this.uint32[1*h+0]=_,h},u}(ma);Rh.prototype.bytesPerElement=4,mn("StructArrayLayout1ul4",Rh);var wl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D,V,$,q){var te=this.length;return this.resize(te+1),this.emplace(te,h,_,E,A,I,D,V,$,q)},u.prototype.emplace=function(h,_,E,A,I,D,V,$,q,te){var oe=10*h,fe=5*h;return this.int16[oe+0]=_,this.int16[oe+1]=E,this.int16[oe+2]=A,this.int16[oe+3]=I,this.int16[oe+4]=D,this.int16[oe+5]=V,this.uint32[fe+3]=$,this.uint16[oe+8]=q,this.uint16[oe+9]=te,h},u}(ma);wl.prototype.bytesPerElement=20,mn("StructArrayLayout6i1ul2ui20",wl);var eh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D){var V=this.length;return this.resize(V+1),this.emplace(V,h,_,E,A,I,D)},u.prototype.emplace=function(h,_,E,A,I,D,V){var $=6*h;return this.int16[$+0]=_,this.int16[$+1]=E,this.int16[$+2]=A,this.int16[$+3]=I,this.int16[$+4]=D,this.int16[$+5]=V,h},u}(ma);eh.prototype.bytesPerElement=12,mn("StructArrayLayout2i2i2i12",eh);var th=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I){var D=this.length;return this.resize(D+1),this.emplace(D,h,_,E,A,I)},u.prototype.emplace=function(h,_,E,A,I,D){var V=4*h,$=8*h;return this.float32[V+0]=_,this.float32[V+1]=E,this.float32[V+2]=A,this.int16[$+6]=I,this.int16[$+7]=D,h},u}(ma);th.prototype.bytesPerElement=16,mn("StructArrayLayout2f1f2i16",th);var gd=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A){var I=this.length;return this.resize(I+1),this.emplace(I,h,_,E,A)},u.prototype.emplace=function(h,_,E,A,I){var D=12*h,V=3*h;return this.uint8[D+0]=_,this.uint8[D+1]=E,this.float32[V+1]=A,this.float32[V+2]=I,h},u}(ma);gd.prototype.bytesPerElement=12,mn("StructArrayLayout2ub2f12",gd);var wf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,h,_,E)},u.prototype.emplace=function(h,_,E,A){var I=3*h;return this.uint16[I+0]=_,this.uint16[I+1]=E,this.uint16[I+2]=A,h},u}(ma);wf.prototype.bytesPerElement=6,mn("StructArrayLayout3ui6",wf);var Af=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt){var xt=this.length;return this.resize(xt+1),this.emplace(xt,h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt)},u.prototype.emplace=function(h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt,xt){var Lt=24*h,Pt=12*h,nr=48*h;return this.int16[Lt+0]=_,this.int16[Lt+1]=E,this.uint16[Lt+2]=A,this.uint16[Lt+3]=I,this.uint32[Pt+2]=D,this.uint32[Pt+3]=V,this.uint32[Pt+4]=$,this.uint16[Lt+10]=q,this.uint16[Lt+11]=te,this.uint16[Lt+12]=oe,this.float32[Pt+7]=fe,this.float32[Pt+8]=Pe,this.uint8[nr+36]=De,this.uint8[nr+37]=tt,this.uint8[nr+38]=We,this.uint32[Pt+10]=lt,this.int16[Lt+22]=xt,h},u}(ma);Af.prototype.bytesPerElement=48,mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Af);var tl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt,xt,Lt,Pt,nr,Fr,tn,Vn,vn,$n,yn,_i){var ii=this.length;return this.resize(ii+1),this.emplace(ii,h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt,xt,Lt,Pt,nr,Fr,tn,Vn,vn,$n,yn,_i)},u.prototype.emplace=function(h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De,tt,We,lt,xt,Lt,Pt,nr,Fr,tn,Vn,vn,$n,yn,_i,ii){var Pn=34*h,Gi=17*h;return this.int16[Pn+0]=_,this.int16[Pn+1]=E,this.int16[Pn+2]=A,this.int16[Pn+3]=I,this.int16[Pn+4]=D,this.int16[Pn+5]=V,this.int16[Pn+6]=$,this.int16[Pn+7]=q,this.uint16[Pn+8]=te,this.uint16[Pn+9]=oe,this.uint16[Pn+10]=fe,this.uint16[Pn+11]=Pe,this.uint16[Pn+12]=De,this.uint16[Pn+13]=tt,this.uint16[Pn+14]=We,this.uint16[Pn+15]=lt,this.uint16[Pn+16]=xt,this.uint16[Pn+17]=Lt,this.uint16[Pn+18]=Pt,this.uint16[Pn+19]=nr,this.uint16[Pn+20]=Fr,this.uint16[Pn+21]=tn,this.uint16[Pn+22]=Vn,this.uint32[Gi+12]=vn,this.float32[Gi+13]=$n,this.float32[Gi+14]=yn,this.float32[Gi+15]=_i,this.float32[Gi+16]=ii,h},u}(ma);tl.prototype.bytesPerElement=68,mn("StructArrayLayout8i15ui1ul4f68",tl);var gc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h){var _=this.length;return this.resize(_+1),this.emplace(_,h)},u.prototype.emplace=function(h,_){return this.float32[1*h+0]=_,h},u}(ma);gc.prototype.bytesPerElement=4,mn("StructArrayLayout1f4",gc);var Al=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,h,_,E)},u.prototype.emplace=function(h,_,E,A){var I=3*h;return this.int16[I+0]=_,this.int16[I+1]=E,this.int16[I+2]=A,h},u}(ma);Al.prototype.bytesPerElement=6,mn("StructArrayLayout3i6",Al);var Oh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,h,_,E)},u.prototype.emplace=function(h,_,E,A){var I=4*h;return this.uint32[2*h+0]=_,this.uint16[I+2]=E,this.uint16[I+3]=A,h},u}(ma);Oh.prototype.bytesPerElement=8,mn("StructArrayLayout1ul2ui8",Oh);var Xc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_){var E=this.length;return this.resize(E+1),this.emplace(E,h,_)},u.prototype.emplace=function(h,_,E){var A=2*h;return this.uint16[A+0]=_,this.uint16[A+1]=E,h},u}(ma);Xc.prototype.bytesPerElement=4,mn("StructArrayLayout2ui4",Xc);var rh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h){var _=this.length;return this.resize(_+1),this.emplace(_,h)},u.prototype.emplace=function(h,_){return this.uint16[1*h+0]=_,h},u}(ma);rh.prototype.bytesPerElement=2,mn("StructArrayLayout1ui2",rh);var rl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(h,_,E,A){var I=this.length;return this.resize(I+1),this.emplace(I,h,_,E,A)},u.prototype.emplace=function(h,_,E,A,I){var D=4*h;return this.float32[D+0]=_,this.float32[D+1]=E,this.float32[D+2]=A,this.float32[D+3]=I,h},u}(ma);rl.prototype.bytesPerElement=16,mn("StructArrayLayout4f16",rl);var d=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var h={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return h.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},h.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},h.x1.get=function(){return this._structArray.int16[this._pos2+2]},h.y1.get=function(){return this._structArray.int16[this._pos2+3]},h.x2.get=function(){return this._structArray.int16[this._pos2+4]},h.y2.get=function(){return this._structArray.int16[this._pos2+5]},h.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},h.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},h.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},h.anchorPoint.get=function(){return new y(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,h),u}(Su);d.prototype.size=20;var g=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(h){return new d(this,h)},u}(wl);mn("CollisionBoxArray",g);var v=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var h={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return h.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},h.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},h.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},h.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},h.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},h.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},h.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},h.segment.get=function(){return this._structArray.uint16[this._pos2+10]},h.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},h.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},h.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},h.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},h.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},h.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},h.placedOrientation.set=function(_){this._structArray.uint8[this._pos1+37]=_},h.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},h.hidden.set=function(_){this._structArray.uint8[this._pos1+38]=_},h.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},h.crossTileID.set=function(_){this._structArray.uint32[this._pos4+10]=_},h.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,h),u}(Su);v.prototype.size=48;var x=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(h){return new v(this,h)},u}(Af);mn("PlacedSymbolArray",x);var T=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var h={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return h.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},h.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},h.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},h.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},h.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},h.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},h.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},h.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},h.key.get=function(){return this._structArray.uint16[this._pos2+8]},h.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},h.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},h.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},h.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},h.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},h.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},h.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},h.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},h.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},h.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},h.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},h.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},h.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},h.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},h.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},h.crossTileID.set=function(_){this._structArray.uint32[this._pos4+12]=_},h.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},h.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},h.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},h.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,h),u}(Su);T.prototype.size=68;var R=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(h){return new T(this,h)},u}(tl);mn("SymbolInstanceArray",R);var F=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getoffsetX=function(h){return this.float32[1*h+0]},u}(gc);mn("GlyphOffsetArray",F);var U=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getx=function(h){return this.int16[3*h+0]},u.prototype.gety=function(h){return this.int16[3*h+1]},u.prototype.gettileUnitDistanceFromAnchor=function(h){return this.int16[3*h+2]},u}(Al);mn("SymbolLineVertexArray",U);var X=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var h={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return h.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},h.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},h.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,h),u}(Su);X.prototype.size=8;var re=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(h){return new X(this,h)},u}(Oh);mn("FeatureIndexArray",re);var he=es([{name:"a_pos",components:2,type:"Int16"}],4).members,me=function(s){s===void 0&&(s=[]),this.segments=s};function xe(s,u){return 256*(s=z(Math.floor(s),0,255))+z(Math.floor(u),0,255)}me.prototype.prepareSegment=function(s,u,h,_){var E=this.segments[this.segments.length-1];return s>me.MAX_VERTEX_ARRAY_LENGTH&&ve("Max vertices per segment is "+me.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+s),(!E||E.vertexLength+s>me.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==_)&&(E={vertexOffset:u.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},_!==void 0&&(E.sortKey=_),this.segments.push(E)),E},me.prototype.get=function(){return this.segments},me.prototype.destroy=function(){for(var s=0,u=this.segments;s<u.length;s+=1){var h=u[s];for(var _ in h.vaos)h.vaos[_].destroy()}},me.simpleSegment=function(s,u,h,_){return new me([{vertexOffset:s,primitiveOffset:u,vertexLength:h,primitiveLength:_,vaos:{},sortKey:0}])},me.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mn("SegmentVector",me);var Ne=es([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fe=l(function(s){s.exports=function(u,h){var _,E,A,I,D,V,$,q;for(E=u.length-(_=3&u.length),A=h,D=3432918353,V=461845907,q=0;q<E;)$=255&u.charCodeAt(q)|(255&u.charCodeAt(++q))<<8|(255&u.charCodeAt(++q))<<16|(255&u.charCodeAt(++q))<<24,++q,A=27492+(65535&(I=5*(65535&(A=(A^=$=(65535&($=($=(65535&$)*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*V+((($>>>16)*V&65535)<<16)&4294967295)<<13|A>>>19))+((5*(A>>>16)&65535)<<16)&4294967295))+((58964+(I>>>16)&65535)<<16);switch($=0,_){case 3:$^=(255&u.charCodeAt(q+2))<<16;case 2:$^=(255&u.charCodeAt(q+1))<<8;case 1:A^=$=(65535&($=($=(65535&($^=255&u.charCodeAt(q)))*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*V+((($>>>16)*V&65535)<<16)&4294967295}return A^=u.length,A=2246822507*(65535&(A^=A>>>16))+((2246822507*(A>>>16)&65535)<<16)&4294967295,A=3266489909*(65535&(A^=A>>>13))+((3266489909*(A>>>16)&65535)<<16)&4294967295,(A^=A>>>16)>>>0}}),qe=l(function(s){s.exports=function(u,h){for(var _,E=u.length,A=h^E,I=0;E>=4;)_=1540483477*(65535&(_=255&u.charCodeAt(I)|(255&u.charCodeAt(++I))<<8|(255&u.charCodeAt(++I))<<16|(255&u.charCodeAt(++I))<<24))+((1540483477*(_>>>16)&65535)<<16),A=1540483477*(65535&A)+((1540483477*(A>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),E-=4,++I;switch(E){case 3:A^=(255&u.charCodeAt(I+2))<<16;case 2:A^=(255&u.charCodeAt(I+1))<<8;case 1:A=1540483477*(65535&(A^=255&u.charCodeAt(I)))+((1540483477*(A>>>16)&65535)<<16)}return A=1540483477*(65535&(A^=A>>>13))+((1540483477*(A>>>16)&65535)<<16),(A^=A>>>15)>>>0}}),Re=Fe,Ze=qe;Re.murmur3=Fe,Re.murmur2=Ze;var at=function(){this.ids=[],this.positions=[],this.indexed=!1};at.prototype.add=function(s,u,h,_){this.ids.push(Ot(s)),this.positions.push(u,h,_)},at.prototype.getPositions=function(s){for(var u=Ot(s),h=0,_=this.ids.length-1;h<_;){var E=h+_>>1;this.ids[E]>=u?_=E:h=E+1}for(var A=[];this.ids[h]===u;)A.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return A},at.serialize=function(s,u){var h=new Float64Array(s.ids),_=new Uint32Array(s.positions);return function E(A,I,D,V){for(;D<V;){for(var $=A[D+V>>1],q=D-1,te=V+1;;){do q++;while(A[q]<$);do te--;while(A[te]>$);if(q>=te)break;It(A,q,te),It(I,3*q,3*te),It(I,3*q+1,3*te+1),It(I,3*q+2,3*te+2)}te-D<V-te?(E(A,I,D,te),D=te+1):(E(A,I,te+1,V),V=te)}}(h,_,0,h.length-1),u&&u.push(h.buffer,_.buffer),{ids:h,positions:_}},at.deserialize=function(s){var u=new at;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u};var ht=Math.pow(2,53)-1;function Ot(s){var u=+s;return!isNaN(u)&&u<=ht?u:Re(String(s))}function It(s,u,h){var _=s[u];s[u]=s[h],s[h]=_}mn("FeaturePositionMap",at);var Ut=function(s,u){this.gl=s.gl,this.location=u},cr=function(s){function u(h,_){s.call(this,h,_),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))},u}(Ut),Sr=function(s){function u(h,_){s.call(this,h,_),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))},u}(Ut),zr=function(s){function u(h,_){s.call(this,h,_),this.current=[0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))},u}(Ut),sn=function(s){function u(h,_){s.call(this,h,_),this.current=[0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))},u}(Ut),Cn=function(s){function u(h,_){s.call(this,h,_),this.current=[0,0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3]))},u}(Ut),Dn=function(s){function u(h,_){s.call(this,h,_),this.current=Li.transparent}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a))},u}(Ut),Nn=new Float32Array(16),ta=function(s){function u(h,_){s.call(this,h,_),this.current=Nn}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(var _=1;_<16;_++)if(h[_]!==this.current[_]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}},u}(Ut);function un(s){return[xe(255*s.r,255*s.g),xe(255*s.b,255*s.a)]}var Zn=function(s,u,h){this.value=s,this.uniformNames=u.map(function(_){return"u_"+_}),this.type=h};Zn.prototype.setUniform=function(s,u,h){s.set(h.constantOr(this.value))},Zn.prototype.getBinding=function(s,u,h){return this.type==="color"?new Dn(s,u):new Sr(s,u)};var ui=function(s,u){this.uniformNames=u.map(function(h){return"u_"+h}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ui.prototype.setConstantPatternPositions=function(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr},ui.prototype.setUniform=function(s,u,h,_){var E=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&s.set(E)},ui.prototype.getBinding=function(s,u,h){return h.substr(0,9)==="u_pattern"?new Cn(s,u):new Sr(s,u)};var ni=function(s,u,h,_){this.expression=s,this.type=h,this.maxValue=0,this.paintVertexAttributes=u.map(function(E){return{name:"a_"+E,type:"Float32",components:h==="color"?2:1,offset:0}}),this.paintVertexArray=new _};ni.prototype.populatePaintArray=function(s,u,h,_,E){var A=this.paintVertexArray.length,I=this.expression.evaluate(new ti(0),u,{},_,[],E);this.paintVertexArray.resize(s),this._setPaintValue(A,s,I)},ni.prototype.updatePaintArray=function(s,u,h,_){var E=this.expression.evaluate({zoom:0},h,_);this._setPaintValue(s,u,E)},ni.prototype._setPaintValue=function(s,u,h){if(this.type==="color")for(var _=un(h),E=s;E<u;E++)this.paintVertexArray.emplace(E,_[0],_[1]);else{for(var A=s;A<u;A++)this.paintVertexArray.emplace(A,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}},ni.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var jn=function(s,u,h,_,E,A){this.expression=s,this.uniformNames=u.map(function(I){return"u_"+I+"_t"}),this.type=h,this.useIntegerZoom=_,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(function(I){return{name:"a_"+I,type:"Float32",components:h==="color"?4:2,offset:0}}),this.paintVertexArray=new A};jn.prototype.populatePaintArray=function(s,u,h,_,E){var A=this.expression.evaluate(new ti(this.zoom),u,{},_,[],E),I=this.expression.evaluate(new ti(this.zoom+1),u,{},_,[],E),D=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(D,s,A,I)},jn.prototype.updatePaintArray=function(s,u,h,_){var E=this.expression.evaluate({zoom:this.zoom},h,_),A=this.expression.evaluate({zoom:this.zoom+1},h,_);this._setPaintValue(s,u,E,A)},jn.prototype._setPaintValue=function(s,u,h,_){if(this.type==="color")for(var E=un(h),A=un(_),I=s;I<u;I++)this.paintVertexArray.emplace(I,E[0],E[1],A[0],A[1]);else{for(var D=s;D<u;D++)this.paintVertexArray.emplace(D,h,_);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(_))}},jn.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},jn.prototype.setUniform=function(s,u){var h=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,_=z(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);s.set(_)},jn.prototype.getBinding=function(s,u,h){return new Sr(s,u)};var yi=function(s,u,h,_,E,A){this.expression=s,this.type=u,this.useIntegerZoom=h,this.zoom=_,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E};yi.prototype.populatePaintArray=function(s,u,h){var _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(_,s,u.patterns&&u.patterns[this.layerId],h)},yi.prototype.updatePaintArray=function(s,u,h,_,E){this._setPaintValues(s,u,h.patterns&&h.patterns[this.layerId],E)},yi.prototype._setPaintValues=function(s,u,h,_){if(_&&h){var E=_[h.min],A=_[h.mid],I=_[h.max];if(E&&A&&I)for(var D=s;D<u;D++)this.zoomInPaintVertexArray.emplace(D,A.tl[0],A.tl[1],A.br[0],A.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],A.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,A.tl[0],A.tl[1],A.br[0],A.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],A.pixelRatio,I.pixelRatio)}},yi.prototype.upload=function(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Ne.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Ne.members,this.expression.isStateDependent))},yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Qn=function(s,u,h){this.binders={},this._buffers=[];var _=[];for(var E in s.paint._values)if(h(E)){var A=s.paint.get(E);if(A instanceof xo&&Bu(A.property.specification)){var I=Ba(E,s.type),D=A.value,V=A.property.specification.type,$=A.property.useIntegerZoom,q=A.property.specification["property-type"],te=q==="cross-faded"||q==="cross-faded-data-driven";if(D.kind==="constant")this.binders[E]=te?new ui(D.value,I):new Zn(D.value,I,V),_.push("/u_"+E);else if(D.kind==="source"||te){var oe=co(E,V,"source");this.binders[E]=te?new yi(D,V,$,u,oe,s.id):new ni(D,I,V,oe),_.push("/a_"+E)}else{var fe=co(E,V,"composite");this.binders[E]=new jn(D,I,V,$,u,fe),_.push("/z_"+E)}}}this.cacheKey=_.sort().join("")};Qn.prototype.getMaxValue=function(s){var u=this.binders[s];return u instanceof ni||u instanceof jn?u.maxValue:0},Qn.prototype.populatePaintArrays=function(s,u,h,_,E){for(var A in this.binders){var I=this.binders[A];(I instanceof ni||I instanceof jn||I instanceof yi)&&I.populatePaintArray(s,u,h,_,E)}},Qn.prototype.setConstantPatternPositions=function(s,u){for(var h in this.binders){var _=this.binders[h];_ instanceof ui&&_.setConstantPatternPositions(s,u)}},Qn.prototype.updatePaintArrays=function(s,u,h,_,E){var A=!1;for(var I in s)for(var D=0,V=u.getPositions(I);D<V.length;D+=1){var $=V[D],q=h.feature($.index);for(var te in this.binders){var oe=this.binders[te];if((oe instanceof ni||oe instanceof jn||oe instanceof yi)&&oe.expression.isStateDependent===!0){var fe=_.paint.get(te);oe.expression=fe.value,oe.updatePaintArray($.start,$.end,q,s[I],E),A=!0}}}return A},Qn.prototype.defines=function(){var s=[];for(var u in this.binders){var h=this.binders[u];(h instanceof Zn||h instanceof ui)&&s.push.apply(s,h.uniformNames.map(function(_){return"#define HAS_UNIFORM_"+_}))}return s},Qn.prototype.getBinderAttributes=function(){var s=[];for(var u in this.binders){var h=this.binders[u];if(h instanceof ni||h instanceof jn)for(var _=0;_<h.paintVertexAttributes.length;_++)s.push(h.paintVertexAttributes[_].name);else if(h instanceof yi)for(var E=0;E<Ne.members.length;E++)s.push(Ne.members[E].name)}return s},Qn.prototype.getBinderUniforms=function(){var s=[];for(var u in this.binders){var h=this.binders[u];if(h instanceof Zn||h instanceof ui||h instanceof jn)for(var _=0,E=h.uniformNames;_<E.length;_+=1)s.push(E[_])}return s},Qn.prototype.getPaintVertexBuffers=function(){return this._buffers},Qn.prototype.getUniforms=function(s,u){var h=[];for(var _ in this.binders){var E=this.binders[_];if(E instanceof Zn||E instanceof ui||E instanceof jn)for(var A=0,I=E.uniformNames;A<I.length;A+=1){var D=I[A];if(u[D]){var V=E.getBinding(s,u[D],D);h.push({name:D,property:_,binding:V})}}}return h},Qn.prototype.setUniforms=function(s,u,h,_){for(var E=0,A=u;E<A.length;E+=1){var I=A[E],D=I.name,V=I.property;this.binders[V].setUniform(I.binding,_,h.get(V),D)}},Qn.prototype.updatePaintBuffers=function(s){for(var u in this._buffers=[],this.binders){var h=this.binders[u];if(s&&h instanceof yi){var _=s.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(h instanceof ni||h instanceof jn)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}},Qn.prototype.upload=function(s){for(var u in this.binders){var h=this.binders[u];(h instanceof ni||h instanceof jn||h instanceof yi)&&h.upload(s)}this.updatePaintBuffers()},Qn.prototype.destroy=function(){for(var s in this.binders){var u=this.binders[s];(u instanceof ni||u instanceof jn||u instanceof yi)&&u.destroy()}};var wn=function(s,u,h){h===void 0&&(h=function(){return!0}),this.programConfigurations={};for(var _=0,E=s;_<E.length;_+=1){var A=E[_];this.programConfigurations[A.id]=new Qn(A,u,h)}this.needsUpload=!1,this._featureMap=new at,this._bufferOffset=0};function Ba(s,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(u+"-","").replace(/-/g,"_")]}function co(s,u,h){var _={color:{source:Es,composite:rl},number:{source:gc,composite:Es}},E=function(A){return{"line-pattern":{source:Ii,composite:Ii},"fill-pattern":{source:Ii,composite:Ii},"fill-extrusion-pattern":{source:Ii,composite:Ii}}[A]}(s);return E&&E[h]||_[u][h]}wn.prototype.populatePaintArrays=function(s,u,h,_,E,A){for(var I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(s,u,_,E,A);u.id!==void 0&&this._featureMap.add(u.id,h,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0},wn.prototype.updatePaintArrays=function(s,u,h,_){for(var E=0,A=h;E<A.length;E+=1){var I=A[E];this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(s,this._featureMap,u,I,_)||this.needsUpload}},wn.prototype.get=function(s){return this.programConfigurations[s]},wn.prototype.upload=function(s){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}},wn.prototype.destroy=function(){for(var s in this.programConfigurations)this.programConfigurations[s].destroy()},mn("ConstantBinder",Zn),mn("CrossFadedConstantBinder",ui),mn("SourceExpressionBinder",ni),mn("CrossFadedCompositeBinder",yi),mn("CompositeExpressionBinder",jn),mn("ProgramConfiguration",Qn,{omit:["_buffers"]}),mn("ProgramConfigurationSet",wn);var io=Math.pow(2,14)-1,So=-io-1;function Ka(s){for(var u=8192/s.extent,h=s.loadGeometry(),_=0;_<h.length;_++)for(var E=h[_],A=0;A<E.length;A++){var I=E[A],D=Math.round(I.x*u),V=Math.round(I.y*u);I.x=z(D,So,io),I.y=z(V,So,io),(D<I.x||D>I.x+1||V<I.y||V>I.y+1)&&ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return h}function Na(s,u){return{type:s.type,id:s.id,properties:s.properties,geometry:u?Ka(s):[]}}function Cs(s,u,h,_,E){s.emplaceBack(2*u+(_+1)/2,2*h+(E+1)/2)}var Ra=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Sl,this.indexArray=new wf,this.segments=new me,this.programConfigurations=new wn(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Ss(s,u){for(var h=0;h<s.length;h++)if(Gu(u,s[h]))return!0;for(var _=0;_<u.length;_++)if(Gu(s,u[_]))return!0;return!!Zc(s,u)}function zs(s,u,h){return!!Gu(s,u)||!!il(u,s,h)}function nl(s,u){if(s.length===1)return Tf(u,s[0]);for(var h=0;h<u.length;h++)for(var _=u[h],E=0;E<_.length;E++)if(Gu(s,_[E]))return!0;for(var A=0;A<s.length;A++)if(Tf(u,s[A]))return!0;for(var I=0;I<u.length;I++)if(Zc(s,u[I]))return!0;return!1}function Au(s,u,h){if(s.length>1){if(Zc(s,u))return!0;for(var _=0;_<u.length;_++)if(il(u[_],s,h))return!0}for(var E=0;E<s.length;E++)if(il(s[E],u,h))return!0;return!1}function Zc(s,u){if(s.length===0||u.length===0)return!1;for(var h=0;h<s.length-1;h++)for(var _=s[h],E=s[h+1],A=0;A<u.length-1;A++)if(nh(_,E,u[A],u[A+1]))return!0;return!1}function nh(s,u,h,_){return Ie(s,h,_)!==Ie(u,h,_)&&Ie(s,u,h)!==Ie(s,u,_)}function il(s,u,h){var _=h*h;if(u.length===1)return s.distSqr(u[0])<_;for(var E=1;E<u.length;E++)if(Yc(s,u[E-1],u[E])<_)return!0;return!1}function Yc(s,u,h){var _=u.distSqr(h);if(_===0)return s.distSqr(u);var E=((s.x-u.x)*(h.x-u.x)+(s.y-u.y)*(h.y-u.y))/_;return s.distSqr(E<0?u:E>1?h:h.sub(u)._mult(E)._add(u))}function Tf(s,u){for(var h,_,E,A=!1,I=0;I<s.length;I++)for(var D=0,V=(h=s[I]).length-1;D<h.length;V=D++)(_=h[D]).y>u.y!=(E=h[V]).y>u.y&&u.x<(E.x-_.x)*(u.y-_.y)/(E.y-_.y)+_.x&&(A=!A);return A}function Gu(s,u){for(var h=!1,_=0,E=s.length-1;_<s.length;E=_++){var A=s[_],I=s[E];A.y>u.y!=I.y>u.y&&u.x<(I.x-A.x)*(u.y-A.y)/(I.y-A.y)+A.x&&(h=!h)}return h}function Tu(s,u,h){var _=h[0],E=h[2];if(s.x<_.x&&u.x<_.x||s.x>E.x&&u.x>E.x||s.y<_.y&&u.y<_.y||s.y>E.y&&u.y>E.y)return!1;var A=Ie(s,u,h[0]);return A!==Ie(s,u,h[1])||A!==Ie(s,u,h[2])||A!==Ie(s,u,h[3])}function Ql(s,u,h){var _=u.paint.get(s).value;return _.kind==="constant"?_.value:h.programConfigurations.get(u.id).getMaxValue(s)}function Zo(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function al(s,u,h,_,E){if(!u[0]&&!u[1])return s;var A=y.convert(u)._mult(E);h==="viewport"&&A._rotate(-_);for(var I=[],D=0;D<s.length;D++)I.push(s[D].sub(A));return I}Ra.prototype.populate=function(s,u,h){var _=this.layers[0],E=[],A=null;_.type==="circle"&&(A=_.layout.get("circle-sort-key"));for(var I=0,D=s;I<D.length;I+=1){var V=D[I],$=V.feature,q=V.id,te=V.index,oe=V.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,Pe=Na($,fe);if(this.layers[0]._featureFilter.filter(new ti(this.zoom),Pe,h)){var De=A?A.evaluate(Pe,{},h):void 0,tt={id:q,properties:$.properties,type:$.type,sourceLayerIndex:oe,index:te,geometry:fe?Pe.geometry:Ka($),patterns:{},sortKey:De};E.push(tt)}}A&&E.sort(function(tn,Vn){return tn.sortKey-Vn.sortKey});for(var We=0,lt=E;We<lt.length;We+=1){var xt=lt[We],Lt=xt.geometry,Pt=xt.index,nr=xt.sourceLayerIndex,Fr=s[Pt].feature;this.addFeature(xt,Lt,Pt,h),u.featureIndex.insert(Fr,Lt,Pt,nr,this.index)}},Ra.prototype.update=function(s,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,h)},Ra.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ra.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ra.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,he),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Ra.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ra.prototype.addFeature=function(s,u,h,_){for(var E=0,A=u;E<A.length;E+=1)for(var I=0,D=A[E];I<D.length;I+=1){var V=D[I],$=V.x,q=V.y;if(!($<0||$>=8192||q<0||q>=8192)){var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),oe=te.vertexLength;Cs(this.layoutVertexArray,$,q,-1,-1),Cs(this.layoutVertexArray,$,q,1,-1),Cs(this.layoutVertexArray,$,q,1,1),Cs(this.layoutVertexArray,$,q,-1,1),this.indexArray.emplaceBack(oe,oe+1,oe+2),this.indexArray.emplaceBack(oe,oe+3,oe+2),te.vertexLength+=4,te.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{},_)},mn("CircleBucket",Ra,{omit:["layers"]});var yc=new is({"circle-sort-key":new bn(ge.layout_circle["circle-sort-key"])}),Mf={paint:new is({"circle-radius":new bn(ge.paint_circle["circle-radius"]),"circle-color":new bn(ge.paint_circle["circle-color"]),"circle-blur":new bn(ge.paint_circle["circle-blur"]),"circle-opacity":new bn(ge.paint_circle["circle-opacity"]),"circle-translate":new kn(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new kn(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kn(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kn(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bn(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bn(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bn(ge.paint_circle["circle-stroke-opacity"])}),layout:yc},Bi=typeof Float32Array<"u"?Float32Array:Array;function cu(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function La(s,u,h){var _=u[0],E=u[1],A=u[2],I=u[3],D=u[4],V=u[5],$=u[6],q=u[7],te=u[8],oe=u[9],fe=u[10],Pe=u[11],De=u[12],tt=u[13],We=u[14],lt=u[15],xt=h[0],Lt=h[1],Pt=h[2],nr=h[3];return s[0]=xt*_+Lt*D+Pt*te+nr*De,s[1]=xt*E+Lt*V+Pt*oe+nr*tt,s[2]=xt*A+Lt*$+Pt*fe+nr*We,s[3]=xt*I+Lt*q+Pt*Pe+nr*lt,s[4]=(xt=h[4])*_+(Lt=h[5])*D+(Pt=h[6])*te+(nr=h[7])*De,s[5]=xt*E+Lt*V+Pt*oe+nr*tt,s[6]=xt*A+Lt*$+Pt*fe+nr*We,s[7]=xt*I+Lt*q+Pt*Pe+nr*lt,s[8]=(xt=h[8])*_+(Lt=h[9])*D+(Pt=h[10])*te+(nr=h[11])*De,s[9]=xt*E+Lt*V+Pt*oe+nr*tt,s[10]=xt*A+Lt*$+Pt*fe+nr*We,s[11]=xt*I+Lt*q+Pt*Pe+nr*lt,s[12]=(xt=h[12])*_+(Lt=h[13])*D+(Pt=h[14])*te+(nr=h[15])*De,s[13]=xt*E+Lt*V+Pt*oe+nr*tt,s[14]=xt*A+Lt*$+Pt*fe+nr*We,s[15]=xt*I+Lt*q+Pt*Pe+nr*lt,s}Math.hypot||(Math.hypot=function(){for(var s=arguments,u=0,h=arguments.length;h--;)u+=s[h]*s[h];return Math.sqrt(u)});var Mu,ih=La;function Iu(s,u,h){var _=u[0],E=u[1],A=u[2],I=u[3];return s[0]=h[0]*_+h[4]*E+h[8]*A+h[12]*I,s[1]=h[1]*_+h[5]*E+h[9]*A+h[13]*I,s[2]=h[2]*_+h[6]*E+h[10]*A+h[14]*I,s[3]=h[3]*_+h[7]*E+h[11]*A+h[15]*I,s}Mu=new Bi(3),Bi!=Float32Array&&(Mu[0]=0,Mu[1]=0,Mu[2]=0),function(){var s=new Bi(4);Bi!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0)}();var Ph=(function(){var s=new Bi(2);Bi!=Float32Array&&(s[0]=0,s[1]=0)}(),function(s){function u(h){s.call(this,h,Mf)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(h){return new Ra(h)},u.prototype.queryRadius=function(h){var _=h;return Ql("circle-radius",this,_)+Ql("circle-stroke-width",this,_)+Zo(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(h,_,E,A,I,D,V,$){for(var q=al(h,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),D.angle,V),te=this.paint.get("circle-radius").evaluate(_,E)+this.paint.get("circle-stroke-width").evaluate(_,E),oe=this.paint.get("circle-pitch-alignment")==="map",fe=oe?q:function(Fr,tn){return Fr.map(function(Vn){return ol(Vn,tn)})}(q,$),Pe=oe?te*V:te,De=0,tt=A;De<tt.length;De+=1)for(var We=0,lt=tt[De];We<lt.length;We+=1){var xt=lt[We],Lt=oe?xt:ol(xt,$),Pt=Pe,nr=Iu([],[xt.x,xt.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pt*=nr[3]/D.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pt*=D.cameraToCenterDistance/nr[3]),zs(fe,Lt,Pt))return!0}return!1},u}(Cl));function ol(s,u){var h=Iu([],[s.x,s.y,0,1],u);return new y(h[0]/h[3],h[1]/h[3])}var ah=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Ra);function fu(s,u,h,_){var E=u.width,A=u.height;if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==E*A*h)throw new RangeError("mismatched image size")}else _=new Uint8Array(E*A*h);return s.width=E,s.height=A,s.data=_,s}function Tl(s,u,h){var _=u.width,E=u.height;if(_!==s.width||E!==s.height){var A=fu({},{width:_,height:E},h);qc(s,A,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,_),height:Math.min(s.height,E)},h),s.width=_,s.height=E,s.data=A.data}}function qc(s,u,h,_,E,A){if(E.width===0||E.height===0)return u;if(E.width>s.width||E.height>s.height||h.x>s.width-E.width||h.y>s.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>u.width||E.height>u.height||_.x>u.width-E.width||_.y>u.height-E.height)throw new RangeError("out of range destination coordinates for image copy");for(var I=s.data,D=u.data,V=0;V<E.height;V++)for(var $=((h.y+V)*s.width+h.x)*A,q=((_.y+V)*u.width+_.x)*A,te=0;te<E.width*A;te++)D[q+te]=I[$+te];return u}mn("HeatmapBucket",ah,{omit:["layers"]});var sl=function(s,u){fu(this,s,1,u)};sl.prototype.resize=function(s){Tl(this,s,1)},sl.prototype.clone=function(){return new sl({width:this.width,height:this.height},new Uint8Array(this.data))},sl.copy=function(s,u,h,_,E){qc(s,u,h,_,E,1)};var bo=function(s,u){fu(this,s,4,u)};bo.prototype.resize=function(s){Tl(this,s,4)},bo.prototype.replace=function(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s},bo.prototype.clone=function(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))},bo.copy=function(s,u,h,_,E){qc(s,u,h,_,E,4)},mn("AlphaImage",sl),mn("RGBAImage",bo);var ul={paint:new is({"heatmap-radius":new bn(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bn(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kn(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bs(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kn(ge.paint_heatmap["heatmap-opacity"])})};function Up(s){var u={},h=s.resolution||256,_=s.clips?s.clips.length:1,E=s.image||new bo({width:h,height:_}),A=function(Pe,De,tt){u[s.evaluationKey]=tt;var We=s.expression.evaluate(u);E.data[Pe+De+0]=Math.floor(255*We.r/We.a),E.data[Pe+De+1]=Math.floor(255*We.g/We.a),E.data[Pe+De+2]=Math.floor(255*We.b/We.a),E.data[Pe+De+3]=Math.floor(255*We.a)};if(s.clips)for(var I=0,D=0;I<_;++I,D+=4*h)for(var V=0,$=0;V<h;V++,$+=4){var q=V/(h-1),te=s.clips[I];A(D,$,te.start*(1-q)+te.end*q)}else for(var oe=0,fe=0;oe<h;oe++,fe+=4)A(0,fe,oe/(h-1));return E}var up=function(s){function u(h){s.call(this,h,ul),this._updateColorRamp()}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(h){return new ah(h)},u.prototype._handleSpecialPaintPropertyUpdate=function(h){h==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=Up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Cl),yd={paint:new is({"hillshade-illumination-direction":new kn(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kn(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kn(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kn(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kn(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kn(ge.paint_hillshade["hillshade-accent-color"])})},If=function(s){function u(h){s.call(this,h,yd)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Cl),Ml=es([{name:"a_pos",components:2,type:"Int16"}],4).members,Vp=lp,Ni=lp;function lp(s,u,h){h=h||2;var _,E,A,I,D,V,$,q=u&&u.length,te=q?u[0]*h:s.length,oe=Jd(s,0,te,h,!0),fe=[];if(!oe||oe.next===oe.prev)return fe;if(q&&(oe=function(De,tt,We,lt){var xt,Lt,Pt,nr=[];for(xt=0,Lt=tt.length;xt<Lt;xt++)(Pt=Jd(De,tt[xt]*lt,xt<Lt-1?tt[xt+1]*lt:De.length,lt,!1))===Pt.next&&(Pt.steiner=!0),nr.push(Jl(Pt));for(nr.sort(Kc),xt=0;xt<nr.length;xt++)Xv(nr[xt],We),We=Il(We,We.next);return We}(s,u,oe,h)),s.length>80*h){_=A=s[0],E=I=s[1];for(var Pe=h;Pe<te;Pe+=h)(D=s[Pe])<_&&(_=D),(V=s[Pe+1])<E&&(E=V),D>A&&(A=D),V>I&&(I=V);$=($=Math.max(A-_,I-E))!==0?1/$:0}return oi(oe,fe,h,_,E,$),fe}function Jd(s,u,h,_,E){var A,I;if(E===dp(s,u,h,_)>0)for(A=u;A<h;A+=_)I=ll(A,s[A],s[A+1],I);else for(A=h-_;A>=u;A-=_)I=ll(A,s[A],s[A+1],I);return I&&fp(I,I.next)&&(pp(I),I=I.next),I}function Il(s,u){if(!s)return s;u||(u=s);var h,_=s;do if(h=!1,_.steiner||!fp(_,_.next)&&ts(_.prev,_,_.next)!==0)_=_.next;else{if(pp(_),(_=u=_.prev)===_.next)break;h=!0}while(h||_!==u);return u}function oi(s,u,h,_,E,A,I){if(s){!I&&A&&function(q,te,oe,fe){var Pe=q;do Pe.z===null&&(Pe.z=ev(Pe.x,Pe.y,te,oe,fe)),Pe.prevZ=Pe.prev,Pe.nextZ=Pe.next,Pe=Pe.next;while(Pe!==q);Pe.prevZ.nextZ=null,Pe.prevZ=null,function(De){var tt,We,lt,xt,Lt,Pt,nr,Fr,tn=1;do{for(We=De,De=null,Lt=null,Pt=0;We;){for(Pt++,lt=We,nr=0,tt=0;tt<tn&&(nr++,lt=lt.nextZ);tt++);for(Fr=tn;nr>0||Fr>0&&lt;)nr!==0&&(Fr===0||!lt||We.z<=lt.z)?(xt=We,We=We.nextZ,nr--):(xt=lt,lt=lt.nextZ,Fr--),Lt?Lt.nextZ=xt:De=xt,xt.prevZ=Lt,Lt=xt;We=lt}Lt.nextZ=null,tn*=2}while(Pt>1)}(Pe)}(s,_,E,A);for(var D,V,$=s;s.prev!==s.next;)if(D=s.prev,V=s.next,A?$v(s,_,E,A):Gp(s))u.push(D.i/h),u.push(s.i/h),u.push(V.i/h),pp(s),s=V.next,$=V.next;else if((s=V)===$){I?I===1?oi(s=hu(Il(s),u,h),u,h,_,E,A,2):I===2&&km(s,u,h,_,E,A):oi(Il(s),u,h,_,E,A,1);break}}}function Gp(s){var u=s.prev,h=s,_=s.next;if(ts(u,h,_)>=0)return!1;for(var E=s.next.next;E!==s.prev;){if(ws(u.x,u.y,h.x,h.y,_.x,_.y,E.x,E.y)&&ts(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function $v(s,u,h,_){var E=s.prev,A=s,I=s.next;if(ts(E,A,I)>=0)return!1;for(var D=E.x>A.x?E.x>I.x?E.x:I.x:A.x>I.x?A.x:I.x,V=E.y>A.y?E.y>I.y?E.y:I.y:A.y>I.y?A.y:I.y,$=ev(E.x<A.x?E.x<I.x?E.x:I.x:A.x<I.x?A.x:I.x,E.y<A.y?E.y<I.y?E.y:I.y:A.y<I.y?A.y:I.y,u,h,_),q=ev(D,V,u,h,_),te=s.prevZ,oe=s.nextZ;te&&te.z>=$&&oe&&oe.z<=q;){if(te!==s.prev&&te!==s.next&&ws(E.x,E.y,A.x,A.y,I.x,I.y,te.x,te.y)&&ts(te.prev,te,te.next)>=0||(te=te.prevZ,oe!==s.prev&&oe!==s.next&&ws(E.x,E.y,A.x,A.y,I.x,I.y,oe.x,oe.y)&&ts(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;te&&te.z>=$;){if(te!==s.prev&&te!==s.next&&ws(E.x,E.y,A.x,A.y,I.x,I.y,te.x,te.y)&&ts(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;oe&&oe.z<=q;){if(oe!==s.prev&&oe!==s.next&&ws(E.x,E.y,A.x,A.y,I.x,I.y,oe.x,oe.y)&&ts(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function hu(s,u,h){var _=s;do{var E=_.prev,A=_.next.next;!fp(E,A)&&Yv(E,_,_.next,A)&&Lf(E,A)&&Lf(A,E)&&(u.push(E.i/h),u.push(_.i/h),u.push(A.i/h),pp(_),pp(_.next),_=s=A),_=_.next}while(_!==s);return Il(_)}function km(s,u,h,_,E,A){var I=s;do{for(var D=I.next.next;D!==I.prev;){if(I.i!==D.i&&Zv(I,D)){var V=hp(I,D);return I=Il(I,I.next),V=Il(V,V.next),oi(I,u,h,_,E,A),void oi(V,u,h,_,E,A)}D=D.next}I=I.next}while(I!==s)}function Kc(s,u){return s.x-u.x}function Xv(s,u){if(u=function(_,E){var A,I=E,D=_.x,V=_.y,$=-1/0;do{if(V<=I.y&&V>=I.next.y&&I.next.y!==I.y){var q=I.x+(V-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(q<=D&&q>$){if($=q,q===D){if(V===I.y)return I;if(V===I.next.y)return I.next}A=I.x<I.next.x?I:I.next}}I=I.next}while(I!==E);if(!A)return null;if(D===$)return A;var te,oe=A,fe=A.x,Pe=A.y,De=1/0;I=A;do D>=I.x&&I.x>=fe&&D!==I.x&&ws(V<Pe?D:$,V,fe,Pe,V<Pe?$:D,V,I.x,I.y)&&(te=Math.abs(V-I.y)/(D-I.x),Lf(I,_)&&(te<De||te===De&&(I.x>A.x||I.x===A.x&&cp(A,I)))&&(A=I,De=te)),I=I.next;while(I!==oe);return A}(s,u)){var h=hp(u,s);Il(u,u.next),Il(h,h.next)}}function cp(s,u){return ts(s.prev,s,u.prev)<0&&ts(u.next,s,s.next)<0}function ev(s,u,h,_,E){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-h)*E)|s<<8))|s<<4))|s<<2))|s<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-_)*E)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function Jl(s){var u=s,h=s;do(u.x<h.x||u.x===h.x&&u.y<h.y)&&(h=u),u=u.next;while(u!==s);return h}function ws(s,u,h,_,E,A,I,D){return(E-I)*(u-D)-(s-I)*(A-D)>=0&&(s-I)*(_-D)-(h-I)*(u-D)>=0&&(h-I)*(A-D)-(E-I)*(_-D)>=0}function Zv(s,u){return s.next.i!==u.i&&s.prev.i!==u.i&&!function(h,_){var E=h;do{if(E.i!==h.i&&E.next.i!==h.i&&E.i!==_.i&&E.next.i!==_.i&&Yv(E,E.next,h,_))return!0;E=E.next}while(E!==h);return!1}(s,u)&&(Lf(s,u)&&Lf(u,s)&&function(h,_){var E=h,A=!1,I=(h.x+_.x)/2,D=(h.y+_.y)/2;do E.y>D!=E.next.y>D&&E.next.y!==E.y&&I<(E.next.x-E.x)*(D-E.y)/(E.next.y-E.y)+E.x&&(A=!A),E=E.next;while(E!==h);return A}(s,u)&&(ts(s.prev,s,u.prev)||ts(s,u.prev,u))||fp(s,u)&&ts(s.prev,s,s.next)>0&&ts(u.prev,u,u.next)>0)}function ts(s,u,h){return(u.y-s.y)*(h.x-u.x)-(u.x-s.x)*(h.y-u.y)}function fp(s,u){return s.x===u.x&&s.y===u.y}function Yv(s,u,h,_){var E=Fh(ts(s,u,h)),A=Fh(ts(s,u,_)),I=Fh(ts(h,_,s)),D=Fh(ts(h,_,u));return E!==A&&I!==D||!(E!==0||!jp(s,h,u))||!(A!==0||!jp(s,_,u))||!(I!==0||!jp(h,s,_))||!(D!==0||!jp(h,u,_))}function jp(s,u,h){return u.x<=Math.max(s.x,h.x)&&u.x>=Math.min(s.x,h.x)&&u.y<=Math.max(s.y,h.y)&&u.y>=Math.min(s.y,h.y)}function Fh(s){return s>0?1:s<0?-1:0}function Lf(s,u){return ts(s.prev,s,s.next)<0?ts(s,u,s.next)>=0&&ts(s,s.prev,u)>=0:ts(s,u,s.prev)<0||ts(s,s.next,u)<0}function hp(s,u){var h=new ec(s.i,s.x,s.y),_=new ec(u.i,u.x,u.y),E=s.next,A=u.prev;return s.next=u,u.prev=s,h.next=E,E.prev=h,_.next=h,h.prev=_,A.next=_,_.prev=A,_}function ll(s,u,h,_){var E=new ec(s,u,h);return _?(E.next=_.next,E.prev=_,_.next.prev=E,_.next=E):(E.prev=E,E.next=E),E}function pp(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ec(s,u,h){this.i=s,this.x=u,this.y=h,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dp(s,u,h,_){for(var E=0,A=u,I=h-_;A<h;A+=_)E+=(s[I]-s[A])*(s[A+1]+s[I+1]),I=A;return E}function Hp(s,u,h,_,E){(function A(I,D,V,$,q){for(;$>V;){if($-V>600){var te=$-V+1,oe=D-V+1,fe=Math.log(te),Pe=.5*Math.exp(2*fe/3),De=.5*Math.sqrt(fe*Pe*(te-Pe)/te)*(oe-te/2<0?-1:1);A(I,D,Math.max(V,Math.floor(D-oe*Pe/te+De)),Math.min($,Math.floor(D+(te-oe)*Pe/te+De)),q)}var tt=I[D],We=V,lt=$;for(Ll(I,V,D),q(I[$],tt)>0&&Ll(I,V,$);We<lt;){for(Ll(I,We,lt),We++,lt--;q(I[We],tt)<0;)We++;for(;q(I[lt],tt)>0;)lt--}q(I[V],tt)===0?Ll(I,V,lt):Ll(I,++lt,$),lt<=D&&(V=lt+1),D<=lt&&($=lt-1)}})(s,u,h||0,_||s.length-1,E||_d)}function Ll(s,u,h){var _=s[u];s[u]=s[h],s[h]=_}function _d(s,u){return s<u?-1:s>u?1:0}function ju(s,u){var h=s.length;if(h<=1)return[s];for(var _,E,A=[],I=0;I<h;I++){var D=dt(s[I]);D!==0&&(s[I].area=Math.abs(D),E===void 0&&(E=D<0),E===D<0?(_&&A.push(_),_=[s[I]]):_.push(s[I]))}if(_&&A.push(_),u>1)for(var V=0;V<A.length;V++)A[V].length<=u||(Hp(A[V],u,1,A[V].length-1,kl),A[V]=A[V].slice(0,u));return A}function kl(s,u){return u.area-s.area}function tc(s,u,h){for(var _=h.patternDependencies,E=!1,A=0,I=u;A<I.length;A+=1){var D=I[A].paint.get(s+"-pattern");D.isConstant()||(E=!0);var V=D.constantOr(null);V&&(E=!0,_[V.to]=!0,_[V.from]=!0)}return E}function Hu(s,u,h,_,E){for(var A=E.patternDependencies,I=0,D=u;I<D.length;I+=1){var V=D[I],$=V.paint.get(s+"-pattern").value;if($.kind!=="constant"){var q=$.evaluate({zoom:_-1},h,{},E.availableImages),te=$.evaluate({zoom:_},h,{},E.availableImages),oe=$.evaluate({zoom:_+1},h,{},E.availableImages);te=te&&te.name?te.name:te,oe=oe&&oe.name?oe.name:oe,A[q=q&&q.name?q.name:q]=!0,A[te]=!0,A[oe]=!0,h.patterns[V.id]={min:q,mid:te,max:oe}}}return h}lp.deviation=function(s,u,h,_){var E=u&&u.length,A=Math.abs(dp(s,0,E?u[0]*h:s.length,h));if(E)for(var I=0,D=u.length;I<D;I++)A-=Math.abs(dp(s,u[I]*h,I<D-1?u[I+1]*h:s.length,h));var V=0;for(I=0;I<_.length;I+=3){var $=_[I]*h,q=_[I+1]*h,te=_[I+2]*h;V+=Math.abs((s[$]-s[te])*(s[q+1]-s[$+1])-(s[$]-s[q])*(s[te+1]-s[$+1]))}return A===0&&V===0?0:Math.abs((V-A)/A)},lp.flatten=function(s){for(var u=s[0][0].length,h={vertices:[],holes:[],dimensions:u},_=0,E=0;E<s.length;E++){for(var A=0;A<s[E].length;A++)for(var I=0;I<u;I++)h.vertices.push(s[E][A][I]);E>0&&h.holes.push(_+=s[E-1].length)}return h},Vp.default=Ni;var As=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Sl,this.indexArray=new wf,this.indexArray2=new Xc,this.programConfigurations=new wn(s.layers,s.zoom),this.segments=new me,this.segments2=new me,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};As.prototype.populate=function(s,u,h){this.hasPattern=tc("fill",this.layers,u);for(var _=this.layers[0].layout.get("fill-sort-key"),E=[],A=0,I=s;A<I.length;A+=1){var D=I[A],V=D.feature,$=D.id,q=D.index,te=D.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,fe=Na(V,oe);if(this.layers[0]._featureFilter.filter(new ti(this.zoom),fe,h)){var Pe=_?_.evaluate(fe,{},h,u.availableImages):void 0,De={id:$,properties:V.properties,type:V.type,sourceLayerIndex:te,index:q,geometry:oe?fe.geometry:Ka(V),patterns:{},sortKey:Pe};E.push(De)}}_&&E.sort(function(Fr,tn){return Fr.sortKey-tn.sortKey});for(var tt=0,We=E;tt<We.length;tt+=1){var lt=We[tt],xt=lt.geometry,Lt=lt.index,Pt=lt.sourceLayerIndex;if(this.hasPattern){var nr=Hu("fill",this.layers,lt,this.zoom,u);this.patternFeatures.push(nr)}else this.addFeature(lt,xt,Lt,h,{});u.featureIndex.insert(s[Lt].feature,xt,Lt,Pt,this.index)}},As.prototype.update=function(s,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,h)},As.prototype.addFeatures=function(s,u,h){for(var _=0,E=this.patternFeatures;_<E.length;_+=1){var A=E[_];this.addFeature(A,A.geometry,A.index,u,h)}},As.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},As.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},As.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ml),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0},As.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},As.prototype.addFeature=function(s,u,h,_,E){for(var A=0,I=ju(u,500);A<I.length;A+=1){for(var D=I[A],V=0,$=0,q=D;$<q.length;$+=1)V+=q[$].length;for(var te=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),oe=te.vertexLength,fe=[],Pe=[],De=0,tt=D;De<tt.length;De+=1){var We=tt[De];if(We.length!==0){We!==D[0]&&Pe.push(fe.length/2);var lt=this.segments2.prepareSegment(We.length,this.layoutVertexArray,this.indexArray2),xt=lt.vertexLength;this.layoutVertexArray.emplaceBack(We[0].x,We[0].y),this.indexArray2.emplaceBack(xt+We.length-1,xt),fe.push(We[0].x),fe.push(We[0].y);for(var Lt=1;Lt<We.length;Lt++)this.layoutVertexArray.emplaceBack(We[Lt].x,We[Lt].y),this.indexArray2.emplaceBack(xt+Lt-1,xt+Lt),fe.push(We[Lt].x),fe.push(We[Lt].y);lt.vertexLength+=We.length,lt.primitiveLength+=We.length}}for(var Pt=Vp(fe,Pe),nr=0;nr<Pt.length;nr+=3)this.indexArray.emplaceBack(oe+Pt[nr],oe+Pt[nr+1],oe+Pt[nr+2]);te.vertexLength+=V,te.primitiveLength+=Pt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,E,_)},mn("FillBucket",As,{omit:["layers","patternFeatures"]});var vp=new is({"fill-sort-key":new bn(ge.layout_fill["fill-sort-key"])}),Wp={paint:new is({"fill-antialias":new kn(ge.paint_fill["fill-antialias"]),"fill-opacity":new bn(ge.paint_fill["fill-opacity"]),"fill-color":new bn(ge.paint_fill["fill-color"]),"fill-outline-color":new bn(ge.paint_fill["fill-outline-color"]),"fill-translate":new kn(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new kn(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new mc(ge.paint_fill["fill-pattern"])}),layout:vp},eu=function(s){function u(h){s.call(this,h,Wp)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(h,_){s.prototype.recalculate.call(this,h,_);var E=this.paint._values["fill-outline-color"];E.value.kind==="constant"&&E.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(h){return new As(h)},u.prototype.queryRadius=function(){return Zo(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(h,_,E,A,I,D,V){return nl(al(h,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),D.angle,V),A)},u.prototype.isTileClipped=function(){return!0},u}(Cl),Rl=es([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dh=Bh;function Bh(s,u,h,_,E){this.properties={},this.extent=h,this.type=0,this._pbf=s,this._geometry=-1,this._keys=_,this._values=E,s.readFields(mp,this,u)}function mp(s,u,h){s==1?u.id=h.readVarint():s==2?function(_,E){for(var A=_.readVarint()+_.pos;_.pos<A;){var I=E._keys[_.readVarint()],D=E._values[_.readVarint()];E.properties[I]=D}}(h,u):s==3?u.type=h.readVarint():s==4&&(u._geometry=h.pos)}function gp(s){for(var u,h,_=0,E=0,A=s.length,I=A-1;E<A;I=E++)_+=((h=s[I]).x-(u=s[E]).x)*(u.y+h.y);return _}Bh.types=["Unknown","Point","LineString","Polygon"],Bh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var u,h=s.readVarint()+s.pos,_=1,E=0,A=0,I=0,D=[];s.pos<h;){if(E<=0){var V=s.readVarint();_=7&V,E=V>>3}if(E--,_===1||_===2)A+=s.readSVarint(),I+=s.readSVarint(),_===1&&(u&&D.push(u),u=[]),u.push(new y(A,I));else{if(_!==7)throw new Error("unknown command "+_);u&&u.push(u[0].clone())}}return u&&D.push(u),D},Bh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var u=s.readVarint()+s.pos,h=1,_=0,E=0,A=0,I=1/0,D=-1/0,V=1/0,$=-1/0;s.pos<u;){if(_<=0){var q=s.readVarint();h=7&q,_=q>>3}if(_--,h===1||h===2)(E+=s.readSVarint())<I&&(I=E),E>D&&(D=E),(A+=s.readSVarint())<V&&(V=A),A>$&&($=A);else if(h!==7)throw new Error("unknown command "+h)}return[I,V,D,$]},Bh.prototype.toGeoJSON=function(s,u,h){var _,E,A=this.extent*Math.pow(2,h),I=this.extent*s,D=this.extent*u,V=this.loadGeometry(),$=Bh.types[this.type];function q(fe){for(var Pe=0;Pe<fe.length;Pe++){var De=fe[Pe];fe[Pe]=[360*(De.x+I)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(De.y+D)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(_=0;_<V.length;_++)te[_]=V[_][0];q(V=te);break;case 2:for(_=0;_<V.length;_++)q(V[_]);break;case 3:for(V=function(fe){var Pe=fe.length;if(Pe<=1)return[fe];for(var De,tt,We=[],lt=0;lt<Pe;lt++){var xt=gp(fe[lt]);xt!==0&&(tt===void 0&&(tt=xt<0),tt===xt<0?(De&&We.push(De),De=[fe[lt]]):De.push(fe[lt]))}return De&&We.push(De),We}(V),_=0;_<V.length;_++)for(E=0;E<V[_].length;E++)q(V[_][E])}V.length===1?V=V[0]:$="Multi"+$;var oe={type:"Feature",geometry:{type:$,coordinates:V},properties:this.properties};return"id"in this&&(oe.id=this.id),oe};var tv=rv;function rv(s,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(oh,this,u),this.length=this._features.length}function oh(s,u,h){s===15?u.version=h.readVarint():s===1?u.name=h.readString():s===5?u.extent=h.readVarint():s===2?u._features.push(h.pos):s===3?u._keys.push(h.readString()):s===4&&u._values.push(function(_){for(var E=null,A=_.readVarint()+_.pos;_.pos<A;){var I=_.readVarint()>>3;E=I===1?_.readString():I===2?_.readFloat():I===3?_.readDouble():I===4?_.readVarint64():I===5?_.readVarint():I===6?_.readSVarint():I===7?_.readBoolean():null}return E}(h))}function qv(s,u,h){if(s===3){var _=new tv(h,h.readVarint()+h.pos);_.length&&(u[_.name]=_)}}rv.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var u=this._pbf.readVarint()+this._pbf.pos;return new Dh(this._pbf,u,this.extent,this._keys,this._values)};var _c={VectorTile:function(s,u){this.layers=s.readFields(qv,{},u)},VectorTileFeature:Dh,VectorTileLayer:tv},sh=_c.VectorTileFeature.types,kf=Math.pow(2,13);function Ol(s,u,h,_,E,A,I,D){s.emplaceBack(u,h,2*Math.floor(_*kf)+I,E*kf*2,A*kf*2,Math.round(D))}var rc=function(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new Ns,this.indexArray=new wf,this.programConfigurations=new wn(s.layers,s.zoom),this.segments=new me,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function cl(s,u){return s.x===u.x&&(s.x<0||s.x>8192)||s.y===u.y&&(s.y<0||s.y>8192)}rc.prototype.populate=function(s,u,h){this.features=[],this.hasPattern=tc("fill-extrusion",this.layers,u);for(var _=0,E=s;_<E.length;_+=1){var A=E[_],I=A.feature,D=A.id,V=A.index,$=A.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,te=Na(I,q);if(this.layers[0]._featureFilter.filter(new ti(this.zoom),te,h)){var oe={id:D,sourceLayerIndex:$,index:V,geometry:q?te.geometry:Ka(I),properties:I.properties,type:I.type,patterns:{}};this.hasPattern?this.features.push(Hu("fill-extrusion",this.layers,oe,this.zoom,u)):this.addFeature(oe,oe.geometry,V,h,{}),u.featureIndex.insert(I,oe.geometry,V,$,this.index,!0)}}},rc.prototype.addFeatures=function(s,u,h){for(var _=0,E=this.features;_<E.length;_+=1){var A=E[_];this.addFeature(A,A.geometry,A.index,u,h)}},rc.prototype.update=function(s,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,h)},rc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},rc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},rc.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Rl),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},rc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},rc.prototype.addFeature=function(s,u,h,_,E){for(var A=0,I=ju(u,500);A<I.length;A+=1){for(var D=I[A],V=0,$=0,q=D;$<q.length;$+=1)V+=q[$].length;for(var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),oe=0,fe=D;oe<fe.length;oe+=1){var Pe=fe[oe];if(Pe.length!==0&&!((Gi=Pe).every(function(wi){return wi.x<0})||Gi.every(function(wi){return wi.x>8192})||Gi.every(function(wi){return wi.y<0})||Gi.every(function(wi){return wi.y>8192})))for(var De=0,tt=0;tt<Pe.length;tt++){var We=Pe[tt];if(tt>=1){var lt=Pe[tt-1];if(!cl(We,lt)){te.vertexLength+4>me.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var xt=We.sub(lt)._perp()._unit(),Lt=lt.dist(We);De+Lt>32768&&(De=0),Ol(this.layoutVertexArray,We.x,We.y,xt.x,xt.y,0,0,De),Ol(this.layoutVertexArray,We.x,We.y,xt.x,xt.y,0,1,De),Ol(this.layoutVertexArray,lt.x,lt.y,xt.x,xt.y,0,0,De+=Lt),Ol(this.layoutVertexArray,lt.x,lt.y,xt.x,xt.y,0,1,De);var Pt=te.vertexLength;this.indexArray.emplaceBack(Pt,Pt+2,Pt+1),this.indexArray.emplaceBack(Pt+1,Pt+2,Pt+3),te.vertexLength+=4,te.primitiveLength+=2}}}}if(te.vertexLength+V>me.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),sh[s.type]==="Polygon"){for(var nr=[],Fr=[],tn=te.vertexLength,Vn=0,vn=D;Vn<vn.length;Vn+=1){var $n=vn[Vn];if($n.length!==0){$n!==D[0]&&Fr.push(nr.length/2);for(var yn=0;yn<$n.length;yn++){var _i=$n[yn];Ol(this.layoutVertexArray,_i.x,_i.y,0,0,1,1,0),nr.push(_i.x),nr.push(_i.y)}}}for(var ii=Vp(nr,Fr),Pn=0;Pn<ii.length;Pn+=3)this.indexArray.emplaceBack(tn+ii[Pn],tn+ii[Pn+2],tn+ii[Pn+1]);te.primitiveLength+=ii.length/3,te.vertexLength+=V}}var Gi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,E,_)},mn("FillExtrusionBucket",rc,{omit:["layers","features"]});var nv={paint:new is({"fill-extrusion-opacity":new kn(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bn(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kn(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kn(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mc(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bn(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bn(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kn(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Rf=function(s){function u(h){s.call(this,h,nv)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(h){return new rc(h)},u.prototype.queryRadius=function(){return Zo(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(h,_,E,A,I,D,V,$){var q=al(h,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),D.angle,V),te=this.paint.get("fill-extrusion-height").evaluate(_,E),oe=this.paint.get("fill-extrusion-base").evaluate(_,E),fe=function(De,tt,We,lt){for(var xt=[],Lt=0,Pt=De;Lt<Pt.length;Lt+=1){var nr=Pt[Lt],Fr=[nr.x,nr.y,0,1];Iu(Fr,Fr,tt),xt.push(new y(Fr[0]/Fr[3],Fr[1]/Fr[3]))}return xt}(q,$),Pe=function(De,tt,We,lt){for(var xt=[],Lt=[],Pt=lt[8]*tt,nr=lt[9]*tt,Fr=lt[10]*tt,tn=lt[11]*tt,Vn=lt[8]*We,vn=lt[9]*We,$n=lt[10]*We,yn=lt[11]*We,_i=0,ii=De;_i<ii.length;_i+=1){for(var Pn=[],Gi=[],wi=0,aa=ii[_i];wi<aa.length;wi+=1){var Yn=aa[wi],Ea=Yn.x,Ao=Yn.y,Eo=lt[0]*Ea+lt[4]*Ao+lt[12],fo=lt[1]*Ea+lt[5]*Ao+lt[13],To=lt[2]*Ea+lt[6]*Ao+lt[14],qo=lt[3]*Ea+lt[7]*Ao+lt[15],Ko=To+Fr,Mo=qo+tn,$u=Eo+Vn,zo=fo+vn,ku=To+$n,Uo=qo+yn,tu=new y((Eo+Pt)/Mo,(fo+nr)/Mo);tu.z=Ko/Mo,Pn.push(tu);var ra=new y($u/Uo,zo/Uo);ra.z=ku/Uo,Gi.push(ra)}xt.push(Pn),Lt.push(Gi)}return[xt,Lt]}(A,oe,te,$);return function(De,tt,We){var lt=1/0;nl(We,tt)&&(lt=yp(We,tt[0]));for(var xt=0;xt<tt.length;xt++)for(var Lt=tt[xt],Pt=De[xt],nr=0;nr<Lt.length-1;nr++){var Fr=Lt[nr],tn=[Fr,Lt[nr+1],Pt[nr+1],Pt[nr],Fr];Ss(We,tn)&&(lt=Math.min(lt,yp(We,tn)))}return lt!==1/0&&lt}(Pe[0],Pe[1],fe)},u}(Cl);function Lu(s,u){return s.x*u.x+s.y*u.y}function yp(s,u){if(s.length===1){for(var h,_=0,E=u[_++];!h||E.equals(h);)if(!(h=u[_++]))return 1/0;for(;_<u.length;_++){var A=u[_],I=s[0],D=h.sub(E),V=A.sub(E),$=I.sub(E),q=Lu(D,D),te=Lu(D,V),oe=Lu(V,V),fe=Lu($,D),Pe=Lu($,V),De=q*oe-te*te,tt=(oe*fe-te*Pe)/De,We=(q*Pe-te*fe)/De,lt=E.z*(1-tt-We)+h.z*tt+A.z*We;if(isFinite(lt))return lt}return 1/0}for(var xt=1/0,Lt=0,Pt=u;Lt<Pt.length;Lt+=1)xt=Math.min(xt,Pt[Lt].z);return xt}var iv=es([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,xd=es([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,bd=_c.VectorTileFeature.types,Ts=Math.cos(Math.PI/180*37.5),Qc=Math.pow(2,14)/.5,la=function(s){var u=this;this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(h){return h.id}),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(h){u.gradients[h.id]={}}),this.layoutVertexArray=new vs,this.layoutVertexArray2=new Es,this.indexArray=new wf,this.programConfigurations=new wn(s.layers,s.zoom),this.segments=new me,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(h){return h.isStateDependent()}).map(function(h){return h.id})};la.prototype.populate=function(s,u,h){this.hasPattern=tc("line",this.layers,u);for(var _=this.layers[0].layout.get("line-sort-key"),E=[],A=0,I=s;A<I.length;A+=1){var D=I[A],V=D.feature,$=D.id,q=D.index,te=D.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,fe=Na(V,oe);if(this.layers[0]._featureFilter.filter(new ti(this.zoom),fe,h)){var Pe=_?_.evaluate(fe,{},h):void 0,De={id:$,properties:V.properties,type:V.type,sourceLayerIndex:te,index:q,geometry:oe?fe.geometry:Ka(V),patterns:{},sortKey:Pe};E.push(De)}}_&&E.sort(function(Fr,tn){return Fr.sortKey-tn.sortKey});for(var tt=0,We=E;tt<We.length;tt+=1){var lt=We[tt],xt=lt.geometry,Lt=lt.index,Pt=lt.sourceLayerIndex;if(this.hasPattern){var nr=Hu("line",this.layers,lt,this.zoom,u);this.patternFeatures.push(nr)}else this.addFeature(lt,xt,Lt,h,{});u.featureIndex.insert(s[Lt].feature,xt,Lt,Pt,this.index)}},la.prototype.update=function(s,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,h)},la.prototype.addFeatures=function(s,u,h){for(var _=0,E=this.patternFeatures;_<E.length;_+=1){var A=E[_];this.addFeature(A,A.geometry,A.index,u,h)}},la.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},la.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},la.prototype.upload=function(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,xd)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,iv),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},la.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},la.prototype.lineFeatureClips=function(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}},la.prototype.addFeature=function(s,u,h,_,E){var A=this.layers[0].layout,I=A.get("line-join").evaluate(s,{}),D=A.get("line-cap"),V=A.get("line-miter-limit"),$=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(var q=0,te=u;q<te.length;q+=1)this.addLine(te[q],s,I,D,V,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,E,_)},la.prototype.addLine=function(s,u,h,_,E,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var I=0;I<s.length-1;I++)this.totalDistance+=s[I].dist(s[I+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var D=bd[u.type]==="Polygon",V=s.length;V>=2&&s[V-1].equals(s[V-2]);)V--;for(var $=0;$<V-1&&s[$].equals(s[$+1]);)$++;if(!(V<(D?3:2))){h==="bevel"&&(E=1.05);var q,te=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray),fe=void 0,Pe=void 0,De=void 0,tt=void 0;this.e1=this.e2=-1,D&&(tt=s[$].sub(q=s[V-2])._unit()._perp());for(var We=$;We<V;We++)if(!(Pe=We===V-1?D?s[$+1]:void 0:s[We+1])||!s[We].equals(Pe)){tt&&(De=tt),q&&(fe=q),q=s[We],tt=Pe?Pe.sub(q)._unit()._perp():De;var lt=(De=De||tt).add(tt);lt.x===0&&lt.y===0||lt._unit();var xt=De.x*tt.x+De.y*tt.y,Lt=lt.x*tt.x+lt.y*tt.y,Pt=Lt!==0?1/Lt:1/0,nr=2*Math.sqrt(2-2*Lt),Fr=Lt<Ts&&fe&&Pe,tn=De.x*tt.y-De.y*tt.x>0;if(Fr&&We>$){var Vn=q.dist(fe);if(Vn>2*te){var vn=q.sub(q.sub(fe)._mult(te/Vn)._round());this.updateDistance(fe,vn),this.addCurrentVertex(vn,De,0,0,oe),fe=vn}}var $n=fe&&Pe,yn=$n?h:D?"butt":_;if($n&&yn==="round"&&(Pt<A?yn="miter":Pt<=2&&(yn="fakeround")),yn==="miter"&&Pt>E&&(yn="bevel"),yn==="bevel"&&(Pt>2&&(yn="flipbevel"),Pt<E&&(yn="miter")),fe&&this.updateDistance(fe,q),yn==="miter")lt._mult(Pt),this.addCurrentVertex(q,lt,0,0,oe);else if(yn==="flipbevel"){if(Pt>100)lt=tt.mult(-1);else{var _i=Pt*De.add(tt).mag()/De.sub(tt).mag();lt._perp()._mult(_i*(tn?-1:1))}this.addCurrentVertex(q,lt,0,0,oe),this.addCurrentVertex(q,lt.mult(-1),0,0,oe)}else if(yn==="bevel"||yn==="fakeround"){var ii=-Math.sqrt(Pt*Pt-1),Pn=tn?ii:0,Gi=tn?0:ii;if(fe&&this.addCurrentVertex(q,De,Pn,Gi,oe),yn==="fakeround")for(var wi=Math.round(180*nr/Math.PI/20),aa=1;aa<wi;aa++){var Yn=aa/wi;if(Yn!==.5){var Ea=Yn-.5;Yn+=Yn*Ea*(Yn-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*Ea*Ea+(.848013+xt*(.215638*xt-1.06021)))}var Ao=tt.sub(De)._mult(Yn)._add(De)._unit()._mult(tn?-1:1);this.addHalfVertex(q,Ao.x,Ao.y,!1,tn,0,oe)}Pe&&this.addCurrentVertex(q,tt,-Pn,-Gi,oe)}else if(yn==="butt")this.addCurrentVertex(q,lt,0,0,oe);else if(yn==="square"){var Eo=fe?1:-1;this.addCurrentVertex(q,lt,Eo,Eo,oe)}else yn==="round"&&(fe&&(this.addCurrentVertex(q,De,0,0,oe),this.addCurrentVertex(q,De,1,1,oe,!0)),Pe&&(this.addCurrentVertex(q,tt,-1,-1,oe,!0),this.addCurrentVertex(q,tt,0,0,oe)));if(Fr&&We<V-1){var fo=q.dist(Pe);if(fo>2*te){var To=q.add(Pe.sub(q)._mult(te/fo)._round());this.updateDistance(q,To),this.addCurrentVertex(To,tt,0,0,oe),q=To}}}}},la.prototype.addCurrentVertex=function(s,u,h,_,E,A){A===void 0&&(A=!1);var I=u.y*_-u.x,D=-u.y-u.x*_;this.addHalfVertex(s,u.x+u.y*h,u.y-u.x*h,A,!1,h,E),this.addHalfVertex(s,I,D,A,!0,-_,E),this.distance>Qc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,u,h,_,E,A))},la.prototype.addHalfVertex=function(s,u,h,_,E,A,I){var D=.5*(this.lineClips?this.scaledDistance*(Qc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s.x<<1)+(_?1:0),(s.y<<1)+(E?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(A===0?0:A<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var V=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),I.primitiveLength++),E?this.e2=V:this.e1=V},la.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},la.prototype.updateDistance=function(s,u){this.distance+=s.dist(u),this.updateScaledDistance()},mn("LineBucket",la,{omit:["layers","patternFeatures"]});var fl=new is({"line-cap":new kn(ge.layout_line["line-cap"]),"line-join":new bn(ge.layout_line["line-join"]),"line-miter-limit":new kn(ge.layout_line["line-miter-limit"]),"line-round-limit":new kn(ge.layout_line["line-round-limit"]),"line-sort-key":new bn(ge.layout_line["line-sort-key"])}),xc={paint:new is({"line-opacity":new bn(ge.paint_line["line-opacity"]),"line-color":new bn(ge.paint_line["line-color"]),"line-translate":new kn(ge.paint_line["line-translate"]),"line-translate-anchor":new kn(ge.paint_line["line-translate-anchor"]),"line-width":new bn(ge.paint_line["line-width"]),"line-gap-width":new bn(ge.paint_line["line-gap-width"]),"line-offset":new bn(ge.paint_line["line-offset"]),"line-blur":new bn(ge.paint_line["line-blur"]),"line-dasharray":new ds(ge.paint_line["line-dasharray"]),"line-pattern":new mc(ge.paint_line["line-pattern"]),"line-gradient":new Bs(ge.paint_line["line-gradient"])}),layout:fl},Ed=new(function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(h,_){return _=new ti(Math.floor(_.zoom),{now:_.now,fadeDuration:_.fadeDuration,zoomHistory:_.zoomHistory,transition:_.transition}),s.prototype.possiblyEvaluate.call(this,h,_)},u.prototype.evaluate=function(h,_,E,A){return _=Y({},_,{zoom:Math.floor(_.zoom)}),s.prototype.evaluate.call(this,h,_,E,A)},u}(bn))(xc.paint.properties["line-width"].specification);Ed.useIntegerZoom=!0;var Kv=function(s){function u(h){s.call(this,h,xc),this.gradientVersion=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(h){h==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ji,this.gradientVersion=(this.gradientVersion+1)%M)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(h,_){s.prototype.recalculate.call(this,h,_),this.paint._values["line-floorwidth"]=Ed.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)},u.prototype.createBucket=function(h){return new la(h)},u.prototype.queryRadius=function(h){var _=h,E=k0(Ql("line-width",this,_),Ql("line-gap-width",this,_)),A=Ql("line-offset",this,_);return E/2+Math.abs(A)+Zo(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(h,_,E,A,I,D,V){var $=al(h,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),D.angle,V),q=V/2*k0(this.paint.get("line-width").evaluate(_,E),this.paint.get("line-gap-width").evaluate(_,E)),te=this.paint.get("line-offset").evaluate(_,E);return te&&(A=function(oe,fe){for(var Pe=[],De=new y(0,0),tt=0;tt<oe.length;tt++){for(var We=oe[tt],lt=[],xt=0;xt<We.length;xt++){var Lt=We[xt],Pt=We[xt+1],nr=xt===0?De:Lt.sub(We[xt-1])._unit()._perp(),Fr=xt===We.length-1?De:Pt.sub(Lt)._unit()._perp(),tn=nr._add(Fr)._unit();tn._mult(1/(tn.x*Fr.x+tn.y*Fr.y)),lt.push(tn._mult(fe)._add(Lt))}Pe.push(lt)}return Pe}(A,te*V)),function(oe,fe,Pe){for(var De=0;De<fe.length;De++){var tt=fe[De];if(oe.length>=3){for(var We=0;We<tt.length;We++)if(Gu(oe,tt[We]))return!0}if(Au(oe,tt,Pe))return!0}return!1}($,A,q)},u.prototype.isTileClipped=function(){return!0},u}(Cl);function k0(s,u){return u>0?u+2*s:s}var Cd=es([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),R0=es([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rm=(es([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),es([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Of=(es([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),es([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Qv=es([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Jv(s,u,h){return s.sections.forEach(function(_){_.text=function(E,A,I){var D=A.layout.get("text-transform").evaluate(I,{});return D==="uppercase"?E=E.toLocaleUpperCase():D==="lowercase"&&(E=E.toLocaleLowerCase()),Vu.applyArabicShaping&&(E=Vu.applyArabicShaping(E)),E}(_.text,u,h)}),s}es([{name:"triangle",components:3,type:"Uint16"}]),es([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),es([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),es([{type:"Float32",name:"offsetX"}]),es([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var _p={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},$p=function(s,u,h,_,E){var A,I,D=8*E-_-1,V=(1<<D)-1,$=V>>1,q=-7,te=h?E-1:0,oe=h?-1:1,fe=s[u+te];for(te+=oe,A=fe&(1<<-q)-1,fe>>=-q,q+=D;q>0;A=256*A+s[u+te],te+=oe,q-=8);for(I=A&(1<<-q)-1,A>>=-q,q+=_;q>0;I=256*I+s[u+te],te+=oe,q-=8);if(A===0)A=1-$;else{if(A===V)return I?NaN:1/0*(fe?-1:1);I+=Math.pow(2,_),A-=$}return(fe?-1:1)*I*Math.pow(2,A-_)},Nh=function(s,u,h,_,E,A){var I,D,V,$=8*A-E-1,q=(1<<$)-1,te=q>>1,oe=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,fe=_?0:A-1,Pe=_?1:-1,De=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(D=isNaN(u)?1:0,I=q):(I=Math.floor(Math.log(u)/Math.LN2),u*(V=Math.pow(2,-I))<1&&(I--,V*=2),(u+=I+te>=1?oe/V:oe*Math.pow(2,1-te))*V>=2&&(I++,V/=2),I+te>=q?(D=0,I=q):I+te>=1?(D=(u*V-1)*Math.pow(2,E),I+=te):(D=u*Math.pow(2,te-1)*Math.pow(2,E),I=0));E>=8;s[h+fe]=255&D,fe+=Pe,D/=256,E-=8);for(I=I<<E|D,$+=E;$>0;s[h+fe]=255&I,fe+=Pe,I/=256,$-=8);s[h+fe-Pe]|=128*De},di=Oa;function Oa(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Oa.Varint=0,Oa.Fixed64=1,Oa.Bytes=2,Oa.Fixed32=5;var av=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wu(s){return s.type===Oa.Bytes?s.readVarint()+s.pos:s.pos+1}function uh(s,u,h){return h?4294967296*u+(s>>>0):4294967296*(u>>>0)+(s>>>0)}function H(s,u,h){var _=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));h.realloc(_);for(var E=h.pos-1;E>=s;E--)h.buf[E+_]=h.buf[E]}function Ee(s,u){for(var h=0;h<s.length;h++)u.writeVarint(s[h])}function Ue(s,u){for(var h=0;h<s.length;h++)u.writeSVarint(s[h])}function wt(s,u){for(var h=0;h<s.length;h++)u.writeFloat(s[h])}function rr(s,u){for(var h=0;h<s.length;h++)u.writeDouble(s[h])}function Et(s,u){for(var h=0;h<s.length;h++)u.writeBoolean(s[h])}function jt(s,u){for(var h=0;h<s.length;h++)u.writeFixed32(s[h])}function sr(s,u){for(var h=0;h<s.length;h++)u.writeSFixed32(s[h])}function br(s,u){for(var h=0;h<s.length;h++)u.writeFixed64(s[h])}function Rr(s,u){for(var h=0;h<s.length;h++)u.writeSFixed64(s[h])}function Lr(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+16777216*s[u+3]}function dr(s,u,h){s[h]=u,s[h+1]=u>>>8,s[h+2]=u>>>16,s[h+3]=u>>>24}function Mr(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+(s[u+3]<<24)}function gr(s,u,h){s===1&&h.readMessage(Or,u)}function Or(s,u,h){if(s===3){var _=h.readMessage(ft,{}),E=_.width,A=_.height,I=_.left,D=_.top,V=_.advance;u.push({id:_.id,bitmap:new sl({width:E+6,height:A+6},_.bitmap),metrics:{width:E,height:A,left:I,top:D,advance:V}})}}function ft(s,u,h){s===1?u.id=h.readVarint():s===2?u.bitmap=h.readBytes():s===3?u.width=h.readVarint():s===4?u.height=h.readVarint():s===5?u.left=h.readSVarint():s===6?u.top=h.readSVarint():s===7&&(u.advance=h.readVarint())}function Ft(s){for(var u=0,h=0,_=0,E=s;_<E.length;_+=1){var A=E[_];u+=A.w*A.h,h=Math.max(h,A.w)}s.sort(function(De,tt){return tt.h-De.h});for(var I=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),h),h:1/0}],D=0,V=0,$=0,q=s;$<q.length;$+=1)for(var te=q[$],oe=I.length-1;oe>=0;oe--){var fe=I[oe];if(!(te.w>fe.w||te.h>fe.h)){if(te.x=fe.x,te.y=fe.y,V=Math.max(V,te.y+te.h),D=Math.max(D,te.x+te.w),te.w===fe.w&&te.h===fe.h){var Pe=I.pop();oe<I.length&&(I[oe]=Pe)}else te.h===fe.h?(fe.x+=te.w,fe.w-=te.w):te.w===fe.w?(fe.y+=te.h,fe.h-=te.h):(I.push({x:fe.x+te.w,y:fe.y,w:fe.w-te.w,h:te.h}),fe.y+=te.h,fe.h-=te.h);break}}return{w:D,h:V,fill:u/(D*V)||0}}Oa.prototype={destroy:function(){this.buf=null},readFields:function(s,u,h){for(h=h||this.length;this.pos<h;){var _=this.readVarint(),E=_>>3,A=this.pos;this.type=7&_,s(E,u,this),this.pos===A&&this.skip(_)}return u},readMessage:function(s,u){return this.readFields(s,u,this.readVarint()+this.pos)},readFixed32:function(){var s=Lr(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Mr(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Lr(this.buf,this.pos)+4294967296*Lr(this.buf,this.pos+4);return this.pos+=8,s},readSFixed64:function(){var s=Lr(this.buf,this.pos)+4294967296*Mr(this.buf,this.pos+4);return this.pos+=8,s},readFloat:function(){var s=$p(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=$p(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var u,h,_=this.buf;return u=127&(h=_[this.pos++]),h<128?u:(u|=(127&(h=_[this.pos++]))<<7,h<128?u:(u|=(127&(h=_[this.pos++]))<<14,h<128?u:(u|=(127&(h=_[this.pos++]))<<21,h<128?u:function(E,A,I){var D,V,$=I.buf;if(D=(112&(V=$[I.pos++]))>>4,V<128||(D|=(127&(V=$[I.pos++]))<<3,V<128)||(D|=(127&(V=$[I.pos++]))<<10,V<128)||(D|=(127&(V=$[I.pos++]))<<17,V<128)||(D|=(127&(V=$[I.pos++]))<<24,V<128)||(D|=(1&(V=$[I.pos++]))<<31,V<128))return uh(E,D,A);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(h=_[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,u=this.pos;return this.pos=s,s-u>=12&&av?function(h,_,E){return av.decode(h.subarray(_,E))}(this.buf,u,s):function(h,_,E){for(var A="",I=_;I<E;){var D,V,$,q=h[I],te=null,oe=q>239?4:q>223?3:q>191?2:1;if(I+oe>E)break;oe===1?q<128&&(te=q):oe===2?(192&(D=h[I+1]))==128&&(te=(31&q)<<6|63&D)<=127&&(te=null):oe===3?(V=h[I+2],(192&(D=h[I+1]))==128&&(192&V)==128&&((te=(15&q)<<12|(63&D)<<6|63&V)<=2047||te>=55296&&te<=57343)&&(te=null)):oe===4&&(V=h[I+2],$=h[I+3],(192&(D=h[I+1]))==128&&(192&V)==128&&(192&$)==128&&((te=(15&q)<<18|(63&D)<<12|(63&V)<<6|63&$)<=65535||te>=1114112)&&(te=null)),te===null?(te=65533,oe=1):te>65535&&(te-=65536,A+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),A+=String.fromCharCode(te),I+=oe}return A}(this.buf,u,s)},readBytes:function(){var s=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,s);return this.pos=s,u},readPackedVarint:function(s,u){if(this.type!==Oa.Bytes)return s.push(this.readVarint(u));var h=Wu(this);for(s=s||[];this.pos<h;)s.push(this.readVarint(u));return s},readPackedSVarint:function(s){if(this.type!==Oa.Bytes)return s.push(this.readSVarint());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Oa.Bytes)return s.push(this.readBoolean());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Oa.Bytes)return s.push(this.readFloat());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Oa.Bytes)return s.push(this.readDouble());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Oa.Bytes)return s.push(this.readFixed32());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Oa.Bytes)return s.push(this.readSFixed32());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Oa.Bytes)return s.push(this.readFixed64());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Oa.Bytes)return s.push(this.readSFixed64());var u=Wu(this);for(s=s||[];this.pos<u;)s.push(this.readSFixed64());return s},skip:function(s){var u=7&s;if(u===Oa.Varint)for(;this.buf[this.pos++]>127;);else if(u===Oa.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Oa.Fixed32)this.pos+=4;else{if(u!==Oa.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(s,u){this.writeVarint(s<<3|u)},realloc:function(s){for(var u=this.length||16;u<this.pos+s;)u*=2;if(u!==this.length){var h=new Uint8Array(u);h.set(this.buf),this.buf=h,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),dr(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),dr(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),dr(this.buf,-1&s,this.pos),dr(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),dr(this.buf,-1&s,this.pos),dr(this.buf,Math.floor(s*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(u,h){var _,E;if(u>=0?(_=u%4294967296|0,E=u/4294967296|0):(E=~(-u/4294967296),4294967295^(_=~(-u%4294967296))?_=_+1|0:(_=0,E=E+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(A,I,D){D.buf[D.pos++]=127&A|128,A>>>=7,D.buf[D.pos++]=127&A|128,A>>>=7,D.buf[D.pos++]=127&A|128,A>>>=7,D.buf[D.pos++]=127&A|128,D.buf[D.pos]=127&(A>>>=7)}(_,0,h),function(A,I){var D=(7&A)<<4;I.buf[I.pos++]|=D|((A>>>=3)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A|((A>>>=7)?128:0),A&&(I.buf[I.pos++]=127&A)))))}(E,h)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var u=this.pos;this.pos=function(_,E,A){for(var I,D,V=0;V<E.length;V++){if((I=E.charCodeAt(V))>55295&&I<57344){if(!D){I>56319||V+1===E.length?(_[A++]=239,_[A++]=191,_[A++]=189):D=I;continue}if(I<56320){_[A++]=239,_[A++]=191,_[A++]=189,D=I;continue}I=D-55296<<10|I-56320|65536,D=null}else D&&(_[A++]=239,_[A++]=191,_[A++]=189,D=null);I<128?_[A++]=I:(I<2048?_[A++]=I>>6|192:(I<65536?_[A++]=I>>12|224:(_[A++]=I>>18|240,_[A++]=I>>12&63|128),_[A++]=I>>6&63|128),_[A++]=63&I|128)}return A}(this.buf,s,this.pos);var h=this.pos-u;h>=128&&H(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeFloat:function(s){this.realloc(4),Nh(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Nh(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var u=s.length;this.writeVarint(u),this.realloc(u);for(var h=0;h<u;h++)this.buf[this.pos++]=s[h]},writeRawMessage:function(s,u){this.pos++;var h=this.pos;s(u,this);var _=this.pos-h;_>=128&&H(h,_,this),this.pos=h-1,this.writeVarint(_),this.pos+=_},writeMessage:function(s,u,h){this.writeTag(s,Oa.Bytes),this.writeRawMessage(u,h)},writePackedVarint:function(s,u){u.length&&this.writeMessage(s,Ee,u)},writePackedSVarint:function(s,u){u.length&&this.writeMessage(s,Ue,u)},writePackedBoolean:function(s,u){u.length&&this.writeMessage(s,Et,u)},writePackedFloat:function(s,u){u.length&&this.writeMessage(s,wt,u)},writePackedDouble:function(s,u){u.length&&this.writeMessage(s,rr,u)},writePackedFixed32:function(s,u){u.length&&this.writeMessage(s,jt,u)},writePackedSFixed32:function(s,u){u.length&&this.writeMessage(s,sr,u)},writePackedFixed64:function(s,u){u.length&&this.writeMessage(s,br,u)},writePackedSFixed64:function(s,u){u.length&&this.writeMessage(s,Rr,u)},writeBytesField:function(s,u){this.writeTag(s,Oa.Bytes),this.writeBytes(u)},writeFixed32Field:function(s,u){this.writeTag(s,Oa.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(s,u){this.writeTag(s,Oa.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(s,u){this.writeTag(s,Oa.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(s,u){this.writeTag(s,Oa.Fixed64),this.writeSFixed64(u)},writeVarintField:function(s,u){this.writeTag(s,Oa.Varint),this.writeVarint(u)},writeSVarintField:function(s,u){this.writeTag(s,Oa.Varint),this.writeSVarint(u)},writeStringField:function(s,u){this.writeTag(s,Oa.Bytes),this.writeString(u)},writeFloatField:function(s,u){this.writeTag(s,Oa.Fixed32),this.writeFloat(u)},writeDoubleField:function(s,u){this.writeTag(s,Oa.Fixed64),this.writeDouble(u)},writeBooleanField:function(s,u){this.writeVarintField(s,Boolean(u))}};var wr=function(s,u){var h=u.pixelRatio,_=u.version,E=u.stretchX,A=u.stretchY,I=u.content;this.paddedRect=s,this.pixelRatio=h,this.stretchX=E,this.stretchY=A,this.content=I,this.version=_},Kr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Kr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Kr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Kr.tlbr.get=function(){return this.tl.concat(this.br)},Kr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(wr.prototype,Kr);var ar=function(s,u){var h={},_={};this.haveRenderCallbacks=[];var E=[];this.addImages(s,h,E),this.addImages(u,_,E);var A=Ft(E),I=new bo({width:A.w||1,height:A.h||1});for(var D in s){var V=s[D],$=h[D].paddedRect;bo.copy(V.data,I,{x:0,y:0},{x:$.x+1,y:$.y+1},V.data)}for(var q in u){var te=u[q],oe=_[q].paddedRect,fe=oe.x+1,Pe=oe.y+1,De=te.data.width,tt=te.data.height;bo.copy(te.data,I,{x:0,y:0},{x:fe,y:Pe},te.data),bo.copy(te.data,I,{x:0,y:tt-1},{x:fe,y:Pe-1},{width:De,height:1}),bo.copy(te.data,I,{x:0,y:0},{x:fe,y:Pe+tt},{width:De,height:1}),bo.copy(te.data,I,{x:De-1,y:0},{x:fe-1,y:Pe},{width:1,height:tt}),bo.copy(te.data,I,{x:0,y:0},{x:fe+De,y:Pe},{width:1,height:tt})}this.image=I,this.iconPositions=h,this.patternPositions=_};ar.prototype.addImages=function(s,u,h){for(var _ in s){var E=s[_],A={x:0,y:0,w:E.data.width+2,h:E.data.height+2};h.push(A),u[_]=new wr(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(_)}},ar.prototype.patchUpdatedImages=function(s,u){for(var h in s.dispatchRenderCallbacks(this.haveRenderCallbacks),s.updatedImages)this.patchUpdatedImage(this.iconPositions[h],s.getImage(h),u),this.patchUpdatedImage(this.patternPositions[h],s.getImage(h),u)},ar.prototype.patchUpdatedImage=function(s,u,h){if(s&&u&&s.version!==u.version){s.version=u.version;var _=s.tl;h.update(u.data,void 0,{x:_[0],y:_[1]})}},mn("ImagePosition",wr),mn("ImageAtlas",ar);var Br={horizontal:1,vertical:2,horizontalOnly:3},Xr=function(){this.scale=1,this.fontStack="",this.imageName=null};Xr.forText=function(s,u){var h=new Xr;return h.scale=s||1,h.fontStack=u,h},Xr.forImage=function(s){var u=new Xr;return u.imageName=s,u};var En=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function er(s,u,h,_,E,A,I,D,V,$,q,te,oe,fe,Pe,De){var tt,We=En.fromFeature(s,E);te===Br.vertical&&We.verticalizePunctuation();var lt=Vu.processBidirectionalText,xt=Vu.processStyledBidirectionalText;if(lt&&We.sections.length===1){tt=[];for(var Lt=0,Pt=lt(We.toString(),si(We,$,A,u,_,fe,Pe));Lt<Pt.length;Lt+=1){var nr=Pt[Lt],Fr=new En;Fr.text=nr,Fr.sections=We.sections;for(var tn=0;tn<nr.length;tn++)Fr.sectionIndex.push(0);tt.push(Fr)}}else if(xt){tt=[];for(var Vn=0,vn=xt(We.text,We.sectionIndex,si(We,$,A,u,_,fe,Pe));Vn<vn.length;Vn+=1){var $n=vn[Vn],yn=new En;yn.text=$n[0],yn.sectionIndex=$n[1],yn.sections=We.sections,tt.push(yn)}}else tt=function(Pn,Gi){for(var wi=[],aa=Pn.text,Yn=0,Ea=0,Ao=Gi;Ea<Ao.length;Ea+=1){var Eo=Ao[Ea];wi.push(Pn.substring(Yn,Eo)),Yn=Eo}return Yn<aa.length&&wi.push(Pn.substring(Yn,aa.length)),wi}(We,si(We,$,A,u,_,fe,Pe));var _i=[],ii={positionedLines:_i,text:We.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(Pn,Gi,wi,aa,Yn,Ea,Ao,Eo,fo,To,qo,Ko){for(var Mo=0,$u=-17,zo=0,ku=0,Uo=Eo==="right"?1:Eo==="left"?0:.5,tu=0,ra=0,Qa=Yn;ra<Qa.length;ra+=1){var Ua=Qa[ra];Ua.trim();var ha=Ua.getMaxScale(),pl=24*(ha-1),Hs={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[tu]=Hs;var ho=Hs.positionedGlyphs,Fa=0;if(Ua.length()){for(var Ls=0;Ls<Ua.length();Ls++){var _a=Ua.getSection(Ls),Ru=Ua.getSectionIndex(Ls),xi=Ua.getCharCode(Ls),ch=0,Aa=null,Xa=null,ef=null,Fl=24,Yp=!(fo===Br.horizontal||!qo&&!Jo(xi)||qo&&(Zt[xi]||(Cc=xi,qr.Arabic(Cc)||qr["Arabic Supplement"](Cc)||qr["Arabic Extended-A"](Cc)||qr["Arabic Presentation Forms-A"](Cc)||qr["Arabic Presentation Forms-B"](Cc))));if(_a.imageName){var Md=aa[_a.imageName];if(!Md)continue;ef=_a.imageName,Pn.iconsInText=Pn.iconsInText||!0,Xa=Md.paddedRect;var fh=Md.displaySize;_a.scale=24*_a.scale/Ko,ch=pl+(24-fh[1]*_a.scale),Fl=(Aa={width:fh[0],height:fh[1],left:1,top:-3,advance:Yp?fh[1]:fh[0]}).advance;var Id=Yp?fh[0]*_a.scale-24*ha:fh[1]*_a.scale-24*ha;Id>0&&Id>Fa&&(Fa=Id)}else{var sv=wi[_a.fontStack],bp=sv&&sv[xi];if(bp&&bp.rect)Xa=bp.rect,Aa=bp.metrics;else{var Ld=Gi[_a.fontStack],Ec=Ld&&Ld[xi];if(!Ec)continue;Aa=Ec.metrics}ch=24*(ha-_a.scale)}Yp?(Pn.verticalizable=!0,ho.push({glyph:xi,imageName:ef,x:Mo,y:$u+ch,vertical:Yp,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:Ru,metrics:Aa,rect:Xa}),Mo+=Fl*_a.scale+To):(ho.push({glyph:xi,imageName:ef,x:Mo,y:$u+ch,vertical:Yp,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:Ru,metrics:Aa,rect:Xa}),Mo+=Aa.advance*_a.scale+To)}ho.length!==0&&(zo=Math.max(Mo-To,zo),cn(ho,0,ho.length-1,Uo,Fa)),Mo=0;var kd=Ea*ha+Fa;Hs.lineOffset=Math.max(Fa,pl),$u+=kd,ku=Math.max(kd,ku),++tu}else $u+=Ea,++tu}var Cc,Io=$u- -17,po=ai(Ao),Uh=po.horizontalAlign,uv=po.verticalAlign;(function(Rd,r0,lv,cv,Od,Ep,Vh,qp,P0){var Pd,Fd=(r0-lv)*Od;Pd=Ep!==Vh?-qp*cv- -17:(-cv*P0+.5)*Vh;for(var Xu=0,hh=Rd;Xu<hh.length;Xu+=1)for(var Ff=0,Kp=hh[Xu].positionedGlyphs;Ff<Kp.length;Ff+=1){var fv=Kp[Ff];fv.x+=Fd,fv.y+=Pd}})(Pn.positionedLines,Uo,Uh,uv,zo,ku,Ea,Io,Yn.length),Pn.top+=-uv*Io,Pn.bottom=Pn.top+Io,Pn.left+=-Uh*zo,Pn.right=Pn.left+zo}(ii,u,h,_,tt,I,D,V,te,$,oe,De),!function(Pn){for(var Gi=0,wi=Pn;Gi<wi.length;Gi+=1)if(wi[Gi].positionedGlyphs.length!==0)return!1;return!0}(_i)&&ii}En.fromFeature=function(s,u){for(var h=new En,_=0;_<s.sections.length;_++){var E=s.sections[_];E.image?h.addImageSection(E):h.addTextSection(E,u)}return h},En.prototype.length=function(){return this.text.length},En.prototype.getSection=function(s){return this.sections[this.sectionIndex[s]]},En.prototype.getSectionIndex=function(s){return this.sectionIndex[s]},En.prototype.getCharCode=function(s){return this.text.charCodeAt(s)},En.prototype.verticalizePunctuation=function(){this.text=function(s){for(var u="",h=0;h<s.length;h++){var _=s.charCodeAt(h+1)||null,E=s.charCodeAt(h-1)||null;u+=_&&Hc(_)&&!_p[s[h+1]]||E&&Hc(E)&&!_p[s[h-1]]||!_p[s[h]]?s[h]:_p[s[h]]}return u}(this.text)},En.prototype.trim=function(){for(var s=0,u=0;u<this.text.length&&Zt[this.text.charCodeAt(u)];u++)s++;for(var h=this.text.length,_=this.text.length-1;_>=0&&_>=s&&Zt[this.text.charCodeAt(_)];_--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)},En.prototype.substring=function(s,u){var h=new En;return h.text=this.text.substring(s,u),h.sectionIndex=this.sectionIndex.slice(s,u),h.sections=this.sections,h},En.prototype.toString=function(){return this.text},En.prototype.getMaxScale=function(){var s=this;return this.sectionIndex.reduce(function(u,h){return Math.max(u,s.sections[h].scale)},0)},En.prototype.addTextSection=function(s,u){this.text+=s.text,this.sections.push(Xr.forText(s.scale,s.fontStack||u));for(var h=this.sections.length-1,_=0;_<s.text.length;++_)this.sectionIndex.push(h)},En.prototype.addImageSection=function(s){var u=s.image?s.image.name:"";if(u.length!==0){var h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Xr.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ve("Reached maximum number of images 6401")}else ve("Can't add FormattedSection with an empty image.")},En.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Zt={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},en={};function Yr(s,u,h,_,E,A){if(u.imageName){var I=_[u.imageName];return I?I.displaySize[0]*u.scale*24/A+E:0}var D=h[u.fontStack],V=D&&D[s];return V?V.metrics.advance*u.scale+E:0}function Ir(s,u,h,_){var E=Math.pow(s-u,2);return _?s<u?E/2:2*E:E+Math.abs(h)*h}function Qr(s,u,h){var _=0;return s===10&&(_-=1e4),h&&(_+=150),s!==40&&s!==65288||(_+=50),u!==41&&u!==65289||(_+=50),_}function an(s,u,h,_,E,A){for(var I=null,D=Ir(u,h,E,A),V=0,$=_;V<$.length;V+=1){var q=$[V],te=Ir(u-q.x,h,E,A)+q.badness;te<=D&&(I=q,D=te)}return{index:s,x:u,priorBreak:I,badness:D}}function si(s,u,h,_,E,A,I){if(A!=="point")return[];if(!s)return[];for(var D,V=[],$=function(tt,We,lt,xt,Lt,Pt){for(var nr=0,Fr=0;Fr<tt.length();Fr++){var tn=tt.getSection(Fr);nr+=Yr(tt.getCharCode(Fr),tn,xt,Lt,We,Pt)}return nr/Math.max(1,Math.ceil(nr/lt))}(s,u,h,_,E,I),q=s.text.indexOf("\u200B")>=0,te=0,oe=0;oe<s.length();oe++){var fe=s.getSection(oe),Pe=s.getCharCode(oe);if(Zt[Pe]||(te+=Yr(Pe,fe,_,E,u,I)),oe<s.length()-1){var De=!((D=Pe)<11904||!(qr["Bopomofo Extended"](D)||qr.Bopomofo(D)||qr["CJK Compatibility Forms"](D)||qr["CJK Compatibility Ideographs"](D)||qr["CJK Compatibility"](D)||qr["CJK Radicals Supplement"](D)||qr["CJK Strokes"](D)||qr["CJK Symbols and Punctuation"](D)||qr["CJK Unified Ideographs Extension A"](D)||qr["CJK Unified Ideographs"](D)||qr["Enclosed CJK Letters and Months"](D)||qr["Halfwidth and Fullwidth Forms"](D)||qr.Hiragana(D)||qr["Ideographic Description Characters"](D)||qr["Kangxi Radicals"](D)||qr["Katakana Phonetic Extensions"](D)||qr.Katakana(D)||qr["Vertical Forms"](D)||qr["Yi Radicals"](D)||qr["Yi Syllables"](D)));(en[Pe]||De||fe.imageName)&&V.push(an(oe+1,te,$,V,Qr(Pe,s.getCharCode(oe+1),De&&q),!1))}}return function tt(We){return We?tt(We.priorBreak).concat(We.index):[]}(an(s.length(),te,$,V,0,!0))}function ai(s){var u=.5,h=.5;switch(s){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:u,verticalAlign:h}}function cn(s,u,h,_,E){if(_||E)for(var A=s[h],I=(s[h].x+A.metrics.advance*A.scale)*_,D=u;D<=h;D++)s[D].x-=I,s[D].y+=E}function pn(s,u,h,_,E,A){var I,D=s.image;if(D.content){var V=D.content,$=D.pixelRatio||1;I=[V[0]/$,V[1]/$,D.displaySize[0]-V[2]/$,D.displaySize[1]-V[3]/$]}var q,te,oe,fe,Pe=u.left*A,De=u.right*A;h==="width"||h==="both"?(fe=E[0]+Pe-_[3],te=E[0]+De+_[1]):te=(fe=E[0]+(Pe+De-D.displaySize[0])/2)+D.displaySize[0];var tt=u.top*A,We=u.bottom*A;return h==="height"||h==="both"?(q=E[1]+tt-_[0],oe=E[1]+We+_[2]):oe=(q=E[1]+(tt+We-D.displaySize[1])/2)+D.displaySize[1],{image:D,top:q,right:te,bottom:oe,left:fe,collisionPadding:I}}en[10]=!0,en[32]=!0,en[38]=!0,en[40]=!0,en[41]=!0,en[43]=!0,en[45]=!0,en[47]=!0,en[173]=!0,en[183]=!0,en[8203]=!0,en[8208]=!0,en[8211]=!0,en[8231]=!0;var Hn=function(s){function u(h,_,E,A){s.call(this,h,_),this.angle=E,A!==void 0&&(this.segment=A)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(y);function li(s,u){var h=u.expression;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new ti(s+1))};if(h.kind==="source")return{kind:"source"};for(var _=h.zoomStops,E=h.interpolationType,A=0;A<_.length&&_[A]<=s;)A++;for(var I=A=Math.max(0,A-1);I<_.length&&_[I]<s+1;)I++;I=Math.min(_.length-1,I);var D=_[A],V=_[I];return h.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:V,interpolationType:E}:{kind:"camera",minZoom:D,maxZoom:V,minSize:h.evaluate(new ti(D)),maxSize:h.evaluate(new ti(V)),interpolationType:E}}function fi(s,u,h){var _=u.uSize,E=h.lowerSize;return s.kind==="source"?E/128:s.kind==="composite"?Ro(E/128,h.upperSize/128,u.uSizeT):_}function Pa(s,u){var h=0,_=0;if(s.kind==="constant")_=s.layoutSize;else if(s.kind!=="source"){var E=s.interpolationType,A=E?z(Po.interpolationFactor(E,u,s.minZoom,s.maxZoom),0,1):0;s.kind==="camera"?_=Ro(s.minSize,s.maxSize,A):h=A}return{uSizeT:h,uSize:_}}mn("Anchor",Hn);var Yo=Object.freeze({__proto__:null,getSizeData:li,evaluateSizeForFeature:fi,evaluateSizeForZoom:Pa,SIZE_PACK_FACTOR:128});function zi(s,u,h,_,E){if(u.segment===void 0)return!0;for(var A=u,I=u.segment+1,D=0;D>-h/2;){if(--I<0)return!1;D-=s[I].dist(A),A=s[I]}D+=s[I].dist(s[I+1]),I++;for(var V=[],$=0;D<h/2;){var q=s[I],te=s[I+1];if(!te)return!1;var oe=s[I-1].angleTo(q)-q.angleTo(te);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:D,angleDelta:oe}),$+=oe;D-V[0].distance>_;)$-=V.shift().angleDelta;if($>E)return!1;I++,D+=q.dist(te)}return!0}function Us(s){for(var u=0,h=0;h<s.length-1;h++)u+=s[h].dist(s[h+1]);return u}function ao(s,u,h){return s?.6*u*h:0}function ms(s,u){return Math.max(s?s.right-s.left:0,u?u.right-u.left:0)}function as(s,u,h,_,E,A){for(var I=ao(h,E,A),D=ms(h,_)*A,V=0,$=Us(s)/2,q=0;q<s.length-1;q++){var te=s[q],oe=s[q+1],fe=te.dist(oe);if(V+fe>$){var Pe=($-V)/fe,De=Ro(te.x,oe.x,Pe),tt=Ro(te.y,oe.y,Pe),We=new Hn(De,tt,oe.angleTo(te),q);return We._round(),!I||zi(s,We,D,I,u)?We:void 0}V+=fe}}function Vs(s,u,h,_,E,A,I,D,V){var $=ao(_,A,I),q=ms(_,E),te=q*I,oe=s[0].x===0||s[0].x===V||s[0].y===0||s[0].y===V;return u-te<u/4&&(u=te+u/4),function fe(Pe,De,tt,We,lt,xt,Lt,Pt,nr){for(var Fr=xt/2,tn=Us(Pe),Vn=0,vn=De-tt,$n=[],yn=0;yn<Pe.length-1;yn++){for(var _i=Pe[yn],ii=Pe[yn+1],Pn=_i.dist(ii),Gi=ii.angleTo(_i);vn+tt<Vn+Pn;){var wi=((vn+=tt)-Vn)/Pn,aa=Ro(_i.x,ii.x,wi),Yn=Ro(_i.y,ii.y,wi);if(aa>=0&&aa<nr&&Yn>=0&&Yn<nr&&vn-Fr>=0&&vn+Fr<=tn){var Ea=new Hn(aa,Yn,Gi,yn);Ea._round(),We&&!zi(Pe,Ea,xt,We,lt)||$n.push(Ea)}}Vn+=Pn}return Pt||$n.length||Lt||($n=fe(Pe,Vn/2,tt,We,lt,xt,Lt,!0,nr)),$n}(s,oe?u/2*D%u:(q/2+2*A)*I*D%u,u,$,h,te,oe,!1,V)}function Gs(s,u,h,_,E){for(var A=[],I=0;I<s.length;I++)for(var D=s[I],V=void 0,$=0;$<D.length-1;$++){var q=D[$],te=D[$+1];q.x<u&&te.x<u||(q.x<u?q=new y(u,q.y+(u-q.x)/(te.x-q.x)*(te.y-q.y))._round():te.x<u&&(te=new y(u,q.y+(u-q.x)/(te.x-q.x)*(te.y-q.y))._round()),q.y<h&&te.y<h||(q.y<h?q=new y(q.x+(h-q.y)/(te.y-q.y)*(te.x-q.x),h)._round():te.y<h&&(te=new y(q.x+(h-q.y)/(te.y-q.y)*(te.x-q.x),h)._round()),q.x>=_&&te.x>=_||(q.x>=_?q=new y(_,q.y+(_-q.x)/(te.x-q.x)*(te.y-q.y))._round():te.x>=_&&(te=new y(_,q.y+(_-q.x)/(te.x-q.x)*(te.y-q.y))._round()),q.y>=E&&te.y>=E||(q.y>=E?q=new y(q.x+(E-q.y)/(te.y-q.y)*(te.x-q.x),E)._round():te.y>=E&&(te=new y(q.x+(E-q.y)/(te.y-q.y)*(te.x-q.x),E)._round()),V&&q.equals(V[V.length-1])||A.push(V=[q]),V.push(te)))))}return A}function Ms(s,u,h,_){var E=[],A=s.image,I=A.pixelRatio,D=A.paddedRect.w-2,V=A.paddedRect.h-2,$=s.right-s.left,q=s.bottom-s.top,te=A.stretchX||[[0,D]],oe=A.stretchY||[[0,V]],fe=function(aa,Yn){return aa+Yn[1]-Yn[0]},Pe=te.reduce(fe,0),De=oe.reduce(fe,0),tt=D-Pe,We=V-De,lt=0,xt=Pe,Lt=0,Pt=De,nr=0,Fr=tt,tn=0,Vn=We;if(A.content&&_){var vn=A.content;lt=wo(te,0,vn[0]),Lt=wo(oe,0,vn[1]),xt=wo(te,vn[0],vn[2]),Pt=wo(oe,vn[1],vn[3]),nr=vn[0]-lt,tn=vn[1]-Lt,Fr=vn[2]-vn[0]-xt,Vn=vn[3]-vn[1]-Pt}var $n=function(aa,Yn,Ea,Ao){var Eo=gs(aa.stretch-lt,xt,$,s.left),fo=ga(aa.fixed-nr,Fr,aa.stretch,Pe),To=gs(Yn.stretch-Lt,Pt,q,s.top),qo=ga(Yn.fixed-tn,Vn,Yn.stretch,De),Ko=gs(Ea.stretch-lt,xt,$,s.left),Mo=ga(Ea.fixed-nr,Fr,Ea.stretch,Pe),$u=gs(Ao.stretch-Lt,Pt,q,s.top),zo=ga(Ao.fixed-tn,Vn,Ao.stretch,De),ku=new y(Eo,To),Uo=new y(Ko,To),tu=new y(Ko,$u),ra=new y(Eo,$u),Qa=new y(fo/I,qo/I),Ua=new y(Mo/I,zo/I),ha=u*Math.PI/180;if(ha){var pl=Math.sin(ha),Hs=Math.cos(ha),ho=[Hs,-pl,pl,Hs];ku._matMult(ho),Uo._matMult(ho),ra._matMult(ho),tu._matMult(ho)}var Fa=aa.stretch+aa.fixed,Ls=Yn.stretch+Yn.fixed;return{tl:ku,tr:Uo,bl:ra,br:tu,tex:{x:A.paddedRect.x+1+Fa,y:A.paddedRect.y+1+Ls,w:Ea.stretch+Ea.fixed-Fa,h:Ao.stretch+Ao.fixed-Ls},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qa,pixelOffsetBR:Ua,minFontScaleX:Fr/I/$,minFontScaleY:Vn/I/q,isSDF:h}};if(_&&(A.stretchX||A.stretchY))for(var yn=Si(te,tt,Pe),_i=Si(oe,We,De),ii=0;ii<yn.length-1;ii++)for(var Pn=yn[ii],Gi=yn[ii+1],wi=0;wi<_i.length-1;wi++)E.push($n(Pn,_i[wi],Gi,_i[wi+1]));else E.push($n({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:V+1}));return E}function wo(s,u,h){for(var _=0,E=0,A=s;E<A.length;E+=1){var I=A[E];_+=Math.max(u,Math.min(h,I[1]))-Math.max(u,Math.min(h,I[0]))}return _}function Si(s,u,h){for(var _=[{fixed:-1,stretch:0}],E=0,A=s;E<A.length;E+=1){var I=A[E],D=I[0],V=I[1],$=_[_.length-1];_.push({fixed:D-$.stretch,stretch:$.stretch}),_.push({fixed:D-$.stretch,stretch:$.stretch+(V-D)})}return _.push({fixed:u+1,stretch:h}),_}function gs(s,u,h,_){return s/u*h+_}function ga(s,u,h,_){return s-u*h/_}var No=function(s,u,h,_,E,A,I,D,V,$){if(this.boxStartIndex=s.length,V){var q=A.top,te=A.bottom,oe=A.collisionPadding;oe&&(q-=oe[1],te+=oe[3]);var fe=te-q;fe>0&&(fe=Math.max(10,fe),this.circleDiameter=fe)}else{var Pe=A.top*I-D,De=A.bottom*I+D,tt=A.left*I-D,We=A.right*I+D,lt=A.collisionPadding;if(lt&&(tt-=lt[0]*I,Pe-=lt[1]*I,We+=lt[2]*I,De+=lt[3]*I),$){var xt=new y(tt,Pe),Lt=new y(We,Pe),Pt=new y(tt,De),nr=new y(We,De),Fr=$*Math.PI/180;xt._rotate(Fr),Lt._rotate(Fr),Pt._rotate(Fr),nr._rotate(Fr),tt=Math.min(xt.x,Lt.x,Pt.x,nr.x),We=Math.max(xt.x,Lt.x,Pt.x,nr.x),Pe=Math.min(xt.y,Lt.y,Pt.y,nr.y),De=Math.max(xt.y,Lt.y,Pt.y,nr.y)}s.emplaceBack(u.x,u.y,tt,Pe,We,De,h,_,E)}this.boxEndIndex=s.length},Jn=function(s,u){if(s===void 0&&(s=[]),u===void 0&&(u=Ui),this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function Ui(s,u){return s<u?-1:s>u?1:0}function $a(s,u,h){u===void 0&&(u=1),h===void 0&&(h=!1);for(var _=1/0,E=1/0,A=-1/0,I=-1/0,D=s[0],V=0;V<D.length;V++){var $=D[V];(!V||$.x<_)&&(_=$.x),(!V||$.y<E)&&(E=$.y),(!V||$.x>A)&&(A=$.x),(!V||$.y>I)&&(I=$.y)}var q=Math.min(A-_,I-E),te=q/2,oe=new Jn([],ys);if(q===0)return new y(_,E);for(var fe=_;fe<A;fe+=q)for(var Pe=E;Pe<I;Pe+=q)oe.push(new Pl(fe+te,Pe+te,te,s));for(var De=function(lt){for(var xt=0,Lt=0,Pt=0,nr=lt[0],Fr=0,tn=nr.length,Vn=tn-1;Fr<tn;Vn=Fr++){var vn=nr[Fr],$n=nr[Vn],yn=vn.x*$n.y-$n.x*vn.y;Lt+=(vn.x+$n.x)*yn,Pt+=(vn.y+$n.y)*yn,xt+=3*yn}return new Pl(Lt/xt,Pt/xt,0,lt)}(s),tt=oe.length;oe.length;){var We=oe.pop();(We.d>De.d||!De.d)&&(De=We,h&&console.log("found best %d after %d probes",Math.round(1e4*We.d)/1e4,tt)),We.max-De.d<=u||(oe.push(new Pl(We.p.x-(te=We.h/2),We.p.y-te,te,s)),oe.push(new Pl(We.p.x+te,We.p.y-te,te,s)),oe.push(new Pl(We.p.x-te,We.p.y+te,te,s)),oe.push(new Pl(We.p.x+te,We.p.y+te,te,s)),tt+=4)}return h&&(console.log("num probes: "+tt),console.log("best distance: "+De.d)),De.p}function ys(s,u){return u.max-s.max}function Pl(s,u,h,_){this.p=new y(s,u),this.h=h,this.d=function(E,A){for(var I=!1,D=1/0,V=0;V<A.length;V++)for(var $=A[V],q=0,te=$.length,oe=te-1;q<te;oe=q++){var fe=$[q],Pe=$[oe];fe.y>E.y!=Pe.y>E.y&&E.x<(Pe.x-fe.x)*(E.y-fe.y)/(Pe.y-fe.y)+fe.x&&(I=!I),D=Math.min(D,Yc(E,fe,Pe))}return(I?1:-1)*Math.sqrt(D)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}Jn.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},Jn.prototype.pop=function(){if(this.length!==0){var s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}},Jn.prototype.peek=function(){return this.data[0]},Jn.prototype._up=function(s){for(var u=this.data,h=this.compare,_=u[s];s>0;){var E=s-1>>1,A=u[E];if(h(_,A)>=0)break;u[s]=A,s=E}u[s]=_},Jn.prototype._down=function(s){for(var u=this.data,h=this.compare,_=this.length>>1,E=u[s];s<_;){var A=1+(s<<1),I=u[A],D=A+1;if(D<this.length&&h(u[D],I)<0&&(A=D,I=u[D]),h(I,E)>=0)break;u[s]=I,s=A}u[s]=E};var Oe=Number.POSITIVE_INFINITY;function Mt(s,u){return u[1]!==Oe?function(h,_,E){var A=0,I=0;switch(_=Math.abs(_),E=Math.abs(E),h){case"top-right":case"top-left":case"top":I=E-7;break;case"bottom-right":case"bottom-left":case"bottom":I=7-E}switch(h){case"top-right":case"bottom-right":case"right":A=-_;break;case"top-left":case"bottom-left":case"left":A=_}return[A,I]}(s,u[0],u[1]):function(h,_){var E=0,A=0;_<0&&(_=0);var I=_/Math.sqrt(2);switch(h){case"top-right":case"top-left":A=I-7;break;case"bottom-right":case"bottom-left":A=7-I;break;case"bottom":A=7-_;break;case"top":A=_-7}switch(h){case"top-right":case"bottom-right":E=-I;break;case"top-left":case"bottom-left":E=I;break;case"left":E=_;break;case"right":E=-_}return[E,A]}(s,u[0])}function yt(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gn(s,u,h,_,E,A,I,D,V,$,q,te,oe,fe,Pe){var De=function(Lt,Pt,nr,Fr,tn,Vn,vn,$n){for(var yn=Fr.layout.get("text-rotate").evaluate(Vn,{})*Math.PI/180,_i=[],ii=0,Pn=Pt.positionedLines;ii<Pn.length;ii+=1)for(var Gi=Pn[ii],wi=0,aa=Gi.positionedGlyphs;wi<aa.length;wi+=1){var Yn=aa[wi];if(Yn.rect){var Ea=Yn.rect||{},Ao=4,Eo=!0,fo=1,To=0,qo=(tn||$n)&&Yn.vertical,Ko=Yn.metrics.advance*Yn.scale/2;if($n&&Pt.verticalizable&&(To=Gi.lineOffset/2-(Yn.imageName?-(24-Yn.metrics.width*Yn.scale)/2:24*(Yn.scale-1))),Yn.imageName){var Mo=vn[Yn.imageName];Eo=Mo.sdf,Ao=1/(fo=Mo.pixelRatio)}var $u=tn?[Yn.x+Ko,Yn.y]:[0,0],zo=tn?[0,0]:[Yn.x+Ko+nr[0],Yn.y+nr[1]-To],ku=[0,0];qo&&(ku=zo,zo=[0,0]);var Uo=(Yn.metrics.left-Ao)*Yn.scale-Ko+zo[0],tu=(-Yn.metrics.top-Ao)*Yn.scale+zo[1],ra=Uo+Ea.w*Yn.scale/fo,Qa=tu+Ea.h*Yn.scale/fo,Ua=new y(Uo,tu),ha=new y(ra,tu),pl=new y(Uo,Qa),Hs=new y(ra,Qa);if(qo){var ho=new y(-Ko,Ko- -17),Fa=-Math.PI/2,Ls=12-Ko,_a=new y(22-Ls,-(Yn.imageName?Ls:0)),Ru=new(Function.prototype.bind.apply(y,[null].concat(ku)));Ua._rotateAround(Fa,ho)._add(_a)._add(Ru),ha._rotateAround(Fa,ho)._add(_a)._add(Ru),pl._rotateAround(Fa,ho)._add(_a)._add(Ru),Hs._rotateAround(Fa,ho)._add(_a)._add(Ru)}if(yn){var xi=Math.sin(yn),ch=Math.cos(yn),Aa=[ch,-xi,xi,ch];Ua._matMult(Aa),ha._matMult(Aa),pl._matMult(Aa),Hs._matMult(Aa)}var Xa=new y(0,0),ef=new y(0,0);_i.push({tl:Ua,tr:ha,bl:pl,br:Hs,tex:Ea,writingMode:Pt.writingMode,glyphOffset:$u,sectionIndex:Yn.sectionIndex,isSDF:Eo,pixelOffsetTL:Xa,pixelOffsetBR:ef,minFontScaleX:0,minFontScaleY:0})}}return _i}(0,h,D,E,A,I,_,s.allowVerticalPlacement),tt=s.textSizeData,We=null;tt.kind==="source"?(We=[128*E.layout.get("text-size").evaluate(I,{})])[0]>32640&&ve(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):tt.kind==="composite"&&((We=[128*fe.compositeTextSizes[0].evaluate(I,{},Pe),128*fe.compositeTextSizes[1].evaluate(I,{},Pe)])[0]>32640||We[1]>32640)&&ve(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),s.addSymbols(s.text,De,We,D,A,I,$,u,V.lineStartIndex,V.lineLength,oe,Pe);for(var lt=0,xt=q;lt<xt.length;lt+=1)te[xt[lt]]=s.text.placedSymbolArray.length-1;return 4*De.length}function Vi(s){for(var u in s)return s[u];return null}function Te(s,u,h,_){var E=s.compareText;if(u in E){for(var A=E[u],I=A.length-1;I>=0;I--)if(_.dist(A[I])<h)return!0}else E[u]=[];return E[u].push(_),!1}var pe=_c.VectorTileFeature.types,He=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ct(s,u,h,_,E,A,I,D,V,$,q,te,oe){var fe=D?Math.min(32640,Math.round(D[0])):0,Pe=D?Math.min(32640,Math.round(D[1])):0;s.emplaceBack(u,h,Math.round(32*_),Math.round(32*E),A,I,(fe<<1)+(V?1:0),Pe,16*$,16*q,256*te,256*oe)}function Tt(s,u,h){s.emplaceBack(u.x,u.y,h),s.emplaceBack(u.x,u.y,h),s.emplaceBack(u.x,u.y,h),s.emplaceBack(u.x,u.y,h)}function rt(s){for(var u=0,h=s.sections;u<h.length;u+=1)if(kh(h[u].text))return!0;return!1}var Ye=function(s){this.layoutVertexArray=new Jf,this.indexArray=new wf,this.programConfigurations=s,this.segments=new me,this.dynamicLayoutVertexArray=new wu,this.opacityVertexArray=new Rh,this.placedSymbolArray=new x};Ye.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ye.prototype.upload=function(s,u,h,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Cd.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,R0.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,He,!0),this.opacityVertexBuffer.itemSize=1),(h||_)&&this.programConfigurations.upload(s))},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},mn("SymbolBuffers",Ye);var nt=function(s,u,h){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new h,this.segments=new me,this.collisionVertexArray=new gd};nt.prototype.upload=function(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Rm.members,!0)},nt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},mn("CollisionBuffers",nt);var de=function(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(function(A){return A.id}),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cu([]),this.placementViewportMatrix=cu([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=li(this.zoom,u["text-size"]),this.iconSizeData=li(this.zoom,u["icon-size"]);var h=this.layers[0].layout,_=h.get("symbol-sort-key"),E=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&_.constantOr(1)!==void 0,this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(function(A){return Br[A]})),this.stateDependentLayerIds=this.layers.filter(function(A){return A.isStateDependent()}).map(function(A){return A.id}),this.sourceID=s.sourceID};de.prototype.createArrays=function(){this.text=new Ye(new wn(this.layers,this.zoom,function(s){return/^text/.test(s)})),this.icon=new Ye(new wn(this.layers,this.zoom,function(s){return/^icon/.test(s)})),this.glyphOffsetArray=new F,this.lineVertexArray=new U,this.symbolInstances=new R},de.prototype.calculateGlyphDependencies=function(s,u,h,_,E){for(var A=0;A<s.length;A++)if(u[s.charCodeAt(A)]=!0,(h||_)&&E){var I=_p[s.charAt(A)];I&&(u[I.charCodeAt(0)]=!0)}},de.prototype.populate=function(s,u,h){var _=this.layers[0],E=_.layout,A=E.get("text-font"),I=E.get("text-field"),D=E.get("icon-image"),V=(I.value.kind!=="constant"||I.value.value instanceof Za&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),$=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,q=E.get("symbol-sort-key");if(this.features=[],V||$){for(var te=u.iconDependencies,oe=u.glyphDependencies,fe=u.availableImages,Pe=new ti(this.zoom),De=0,tt=s;De<tt.length;De+=1){var We=tt[De],lt=We.feature,xt=We.id,Lt=We.index,Pt=We.sourceLayerIndex,nr=_._featureFilter.needGeometry,Fr=Na(lt,nr);if(_._featureFilter.filter(Pe,Fr,h)){nr||(Fr.geometry=Ka(lt));var tn=void 0;if(V){var Vn=_.getValueAndResolveTokens("text-field",Fr,h,fe),vn=Za.factory(Vn);rt(vn)&&(this.hasRTLText=!0),(!this.hasRTLText||vc()==="unavailable"||this.hasRTLText&&Vu.isParsed())&&(tn=Jv(vn,_,Fr))}var $n=void 0;if($){var yn=_.getValueAndResolveTokens("icon-image",Fr,h,fe);$n=yn instanceof da?yn:da.fromString(yn)}if(tn||$n){var _i=this.sortFeaturesByKey?q.evaluate(Fr,{},h):void 0;if(this.features.push({id:xt,text:tn,icon:$n,index:Lt,sourceLayerIndex:Pt,geometry:Fr.geometry,properties:lt.properties,type:pe[lt.type],sortKey:_i}),$n&&(te[$n.name]=!0),tn){var ii=A.evaluate(Fr,{},h).join(","),Pn=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Br.vertical)>=0;for(var Gi=0,wi=tn.sections;Gi<wi.length;Gi+=1){var aa=wi[Gi];if(aa.image)te[aa.image.name]=!0;else{var Yn=Kl(tn.toString()),Ea=aa.fontStack||ii,Ao=oe[Ea]=oe[Ea]||{};this.calculateGlyphDependencies(aa.text,Ao,Pn,this.allowVerticalPlacement,Yn)}}}}}}E.get("symbol-placement")==="line"&&(this.features=function(Eo){var fo={},To={},qo=[],Ko=0;function Mo(ho){qo.push(Eo[ho]),Ko++}function $u(ho,Fa,Ls){var _a=To[ho];return delete To[ho],To[Fa]=_a,qo[_a].geometry[0].pop(),qo[_a].geometry[0]=qo[_a].geometry[0].concat(Ls[0]),_a}function zo(ho,Fa,Ls){var _a=fo[Fa];return delete fo[Fa],fo[ho]=_a,qo[_a].geometry[0].shift(),qo[_a].geometry[0]=Ls[0].concat(qo[_a].geometry[0]),_a}function ku(ho,Fa,Ls){var _a=Ls?Fa[0][Fa[0].length-1]:Fa[0][0];return ho+":"+_a.x+":"+_a.y}for(var Uo=0;Uo<Eo.length;Uo++){var tu=Eo[Uo],ra=tu.geometry,Qa=tu.text?tu.text.toString():null;if(Qa){var Ua=ku(Qa,ra),ha=ku(Qa,ra,!0);if(Ua in To&&ha in fo&&To[Ua]!==fo[ha]){var pl=zo(Ua,ha,ra),Hs=$u(Ua,ha,qo[pl].geometry);delete fo[Ua],delete To[ha],To[ku(Qa,qo[Hs].geometry,!0)]=Hs,qo[pl].geometry=null}else Ua in To?$u(Ua,ha,ra):ha in fo?zo(Ua,ha,ra):(Mo(Uo),fo[Ua]=Ko-1,To[ha]=Ko-1)}else Mo(Uo)}return qo.filter(function(ho){return ho.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Eo,fo){return Eo.sortKey-fo.sortKey})}},de.prototype.update=function(s,u,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,h),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,h))},de.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},de.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},de.prototype.upload=function(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},de.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},de.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},de.prototype.addToLineVertexArray=function(s,u){var h=this.lineVertexArray.length;if(s.segment!==void 0){for(var _=s.dist(u[s.segment+1]),E=s.dist(u[s.segment]),A={},I=s.segment+1;I<u.length;I++)A[I]={x:u[I].x,y:u[I].y,tileUnitDistanceFromAnchor:_},I<u.length-1&&(_+=u[I+1].dist(u[I]));for(var D=s.segment||0;D>=0;D--)A[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:E},D>0&&(E+=u[D-1].dist(u[D]));for(var V=0;V<u.length;V++){var $=A[V];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}},de.prototype.addSymbols=function(s,u,h,_,E,A,I,D,V,$,q,te){for(var oe=s.indexArray,fe=s.layoutVertexArray,Pe=s.segments.prepareSegment(4*u.length,fe,oe,this.canOverlap?A.sortKey:void 0),De=this.glyphOffsetArray.length,tt=Pe.vertexLength,We=this.allowVerticalPlacement&&I===Br.vertical?Math.PI/2:0,lt=A.text&&A.text.sections,xt=0;xt<u.length;xt++){var Lt=u[xt],Pt=Lt.tl,nr=Lt.tr,Fr=Lt.bl,tn=Lt.br,Vn=Lt.tex,vn=Lt.pixelOffsetTL,$n=Lt.pixelOffsetBR,yn=Lt.minFontScaleX,_i=Lt.minFontScaleY,ii=Lt.glyphOffset,Pn=Lt.isSDF,Gi=Lt.sectionIndex,wi=Pe.vertexLength,aa=ii[1];ct(fe,D.x,D.y,Pt.x,aa+Pt.y,Vn.x,Vn.y,h,Pn,vn.x,vn.y,yn,_i),ct(fe,D.x,D.y,nr.x,aa+nr.y,Vn.x+Vn.w,Vn.y,h,Pn,$n.x,vn.y,yn,_i),ct(fe,D.x,D.y,Fr.x,aa+Fr.y,Vn.x,Vn.y+Vn.h,h,Pn,vn.x,$n.y,yn,_i),ct(fe,D.x,D.y,tn.x,aa+tn.y,Vn.x+Vn.w,Vn.y+Vn.h,h,Pn,$n.x,$n.y,yn,_i),Tt(s.dynamicLayoutVertexArray,D,We),oe.emplaceBack(wi,wi+1,wi+2),oe.emplaceBack(wi+1,wi+2,wi+3),Pe.vertexLength+=4,Pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),xt!==u.length-1&&Gi===u[xt+1].sectionIndex||s.programConfigurations.populatePaintArrays(fe.length,A,A.index,{},te,lt&&lt[Gi])}s.placedSymbolArray.emplaceBack(D.x,D.y,De,this.glyphOffsetArray.length-De,tt,V,$,D.segment,h?h[0]:0,h?h[1]:0,_[0],_[1],I,0,!1,0,q)},de.prototype._addCollisionDebugVertex=function(s,u,h,_,E,A){return u.emplaceBack(0,0),s.emplaceBack(h.x,h.y,_,E,Math.round(A.x),Math.round(A.y))},de.prototype.addCollisionDebugVertices=function(s,u,h,_,E,A,I){var D=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),V=D.vertexLength,$=E.layoutVertexArray,q=E.collisionVertexArray,te=I.anchorX,oe=I.anchorY;this._addCollisionDebugVertex($,q,A,te,oe,new y(s,u)),this._addCollisionDebugVertex($,q,A,te,oe,new y(h,u)),this._addCollisionDebugVertex($,q,A,te,oe,new y(h,_)),this._addCollisionDebugVertex($,q,A,te,oe,new y(s,_)),D.vertexLength+=4;var fe=E.indexArray;fe.emplaceBack(V,V+1),fe.emplaceBack(V+1,V+2),fe.emplaceBack(V+2,V+3),fe.emplaceBack(V+3,V),D.primitiveLength+=4},de.prototype.addDebugCollisionBoxes=function(s,u,h,_){for(var E=s;E<u;E++){var A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,_?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,h)}},de.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nt(eh,Of.members,Xc),this.iconCollisionBox=new nt(eh,Of.members,Xc);for(var s=0;s<this.symbolInstances.length;s++){var u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},de.prototype._deserializeCollisionBoxesForSymbol=function(s,u,h,_,E,A,I,D,V){for(var $={},q=u;q<h;q++){var te=s.get(q);$.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},$.textFeatureIndex=te.featureIndex;break}for(var oe=_;oe<E;oe++){var fe=s.get(oe);$.verticalTextBox={x1:fe.x1,y1:fe.y1,x2:fe.x2,y2:fe.y2,anchorPointX:fe.anchorPointX,anchorPointY:fe.anchorPointY},$.verticalTextFeatureIndex=fe.featureIndex;break}for(var Pe=A;Pe<I;Pe++){var De=s.get(Pe);$.iconBox={x1:De.x1,y1:De.y1,x2:De.x2,y2:De.y2,anchorPointX:De.anchorPointX,anchorPointY:De.anchorPointY},$.iconFeatureIndex=De.featureIndex;break}for(var tt=D;tt<V;tt++){var We=s.get(tt);$.verticalIconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},$.verticalIconFeatureIndex=We.featureIndex;break}return $},de.prototype.deserializeCollisionBoxes=function(s){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var h=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}},de.prototype.hasTextData=function(){return this.text.segments.get().length>0},de.prototype.hasIconData=function(){return this.icon.segments.get().length>0},de.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},de.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},de.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},de.prototype.addIndicesForPlacedSymbol=function(s,u){for(var h=s.placedSymbolArray.get(u),_=h.vertexStartIndex+4*h.numGlyphs,E=h.vertexStartIndex;E<_;E+=4)s.indexArray.emplaceBack(E,E+1,E+2),s.indexArray.emplaceBack(E+1,E+2,E+3)},de.prototype.getSortedSymbolIndexes=function(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(s),h=Math.cos(s),_=[],E=[],A=[],I=0;I<this.symbolInstances.length;++I){A.push(I);var D=this.symbolInstances.get(I);_.push(0|Math.round(u*D.anchorX+h*D.anchorY)),E.push(D.featureIndex)}return A.sort(function(V,$){return _[V]-_[$]||E[$]-E[V]}),A},de.prototype.addToSortKeyRanges=function(s,u){var h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===u?h.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})},de.prototype.sortFeatures=function(s){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var h=0,_=this.symbolInstanceIndexes;h<_.length;h+=1){var E=this.symbolInstances.get(_[h]);this.featureSortOrder.push(E.featureIndex),[E.rightJustifiedTextSymbolIndex,E.centerJustifiedTextSymbolIndex,E.leftJustifiedTextSymbolIndex].forEach(function(A,I,D){A>=0&&D.indexOf(A)===I&&u.addIndicesForPlacedSymbol(u.text,A)}),E.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,E.verticalPlacedTextSymbolIndex),E.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.placedIconSymbolIndex),E.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,E.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},mn("SymbolBucket",de,{omit:["layers","collisionBoxArray","features","compareText"]}),de.MAX_GLYPHS=65535,de.addDynamicAttributes=Tt;var $e=new is({"symbol-placement":new kn(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new kn(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kn(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bn(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kn(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new kn(ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kn(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new kn(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kn(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new bn(ge.layout_symbol["icon-size"]),"icon-text-fit":new kn(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kn(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new bn(ge.layout_symbol["icon-image"]),"icon-rotate":new bn(ge.layout_symbol["icon-rotate"]),"icon-padding":new kn(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new kn(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new bn(ge.layout_symbol["icon-offset"]),"icon-anchor":new bn(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kn(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kn(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kn(ge.layout_symbol["text-rotation-alignment"]),"text-field":new bn(ge.layout_symbol["text-field"]),"text-font":new bn(ge.layout_symbol["text-font"]),"text-size":new bn(ge.layout_symbol["text-size"]),"text-max-width":new bn(ge.layout_symbol["text-max-width"]),"text-line-height":new kn(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new bn(ge.layout_symbol["text-letter-spacing"]),"text-justify":new bn(ge.layout_symbol["text-justify"]),"text-radial-offset":new bn(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kn(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new bn(ge.layout_symbol["text-anchor"]),"text-max-angle":new kn(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new kn(ge.layout_symbol["text-writing-mode"]),"text-rotate":new bn(ge.layout_symbol["text-rotate"]),"text-padding":new kn(ge.layout_symbol["text-padding"]),"text-keep-upright":new kn(ge.layout_symbol["text-keep-upright"]),"text-transform":new bn(ge.layout_symbol["text-transform"]),"text-offset":new bn(ge.layout_symbol["text-offset"]),"text-allow-overlap":new kn(ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kn(ge.layout_symbol["text-ignore-placement"]),"text-optional":new kn(ge.layout_symbol["text-optional"])}),Le={paint:new is({"icon-opacity":new bn(ge.paint_symbol["icon-opacity"]),"icon-color":new bn(ge.paint_symbol["icon-color"]),"icon-halo-color":new bn(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new bn(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bn(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new kn(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new kn(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new bn(ge.paint_symbol["text-opacity"]),"text-color":new bn(ge.paint_symbol["text-color"],{runtimeType:Zr,getOverride:function(s){return s.textColor},hasOverride:function(s){return!!s.textColor}}),"text-halo-color":new bn(ge.paint_symbol["text-halo-color"]),"text-halo-width":new bn(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new bn(ge.paint_symbol["text-halo-blur"]),"text-translate":new kn(ge.paint_symbol["text-translate"]),"text-translate-anchor":new kn(ge.paint_symbol["text-translate-anchor"])}),layout:$e},ut=function(s){this.type=s.property.overrides?s.property.overrides.runtimeType:xn,this.defaultValue=s};ut.prototype.evaluate=function(s){if(s.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default},ut.prototype.eachChild=function(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)},ut.prototype.outputDefined=function(){return!1},ut.prototype.serialize=function(){return null},mn("FormatSectionOverride",ut,{omit:["defaultValue"]});var _t=function(s){function u(h){s.call(this,h,Le)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(h,_){if(s.prototype.recalculate.call(this,h,_),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var E=this.layout.get("text-writing-mode");if(E){for(var A=[],I=0,D=E;I<D.length;I+=1){var V=D[I];A.indexOf(V)<0&&A.push(V)}this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(h,_,E,A){var I=this.layout.get(h).evaluate(_,{},E,A),D=this._unevaluatedLayout._values[h];return D.isDataDriven()||Nc(D.value)||!I?I:function(V,$){return $.replace(/{([^{}]+)}/g,function(q,te){return te in V?String(V[te]):""})}(_.properties,I)},u.prototype.createBucket=function(h){return new de(h)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var h=0,_=Le.paint.overridableProperties;h<_.length;h+=1){var E=_[h];if(u.hasPaintOverride(this.layout,E)){var A,I=this.paint.get(E),D=new ut(I),V=new cc(D,I.property.specification);A=I.value.kind==="constant"||I.value.kind==="source"?new _l("source",V):new hc("composite",V,I.value.zoomStops,I.value._interpolationType),this.paint._values[E]=new xo(I.property,A,I.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(h,_,E){return!(!this.layout||_.isDataDriven()||E.isDataDriven())&&u.hasPaintOverride(this.layout,h)},u.hasPaintOverride=function(h,_){var E=h.get("text-field"),A=Le.paint.properties[_],I=!1,D=function(q){for(var te=0,oe=q;te<oe.length;te+=1)if(A.overrides&&A.overrides.hasOverride(oe[te]))return void(I=!0)};if(E.value.kind==="constant"&&E.value.value instanceof Za)D(E.value.value.sections);else if(E.value.kind==="source"){var V=function(q){I||(q instanceof ns&&ki(q.value)===ci?D(q.value.sections):q instanceof ks?D(q.sections):q.eachChild(V))},$=E.value;$._styleExpression&&V($._styleExpression.expression)}return I},u}(Cl),lr={paint:new is({"background-color":new kn(ge.paint_background["background-color"]),"background-pattern":new ds(ge.paint_background["background-pattern"]),"background-opacity":new kn(ge.paint_background["background-opacity"])})},Hr=function(s){function u(h){s.call(this,h,lr)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Cl),$r={paint:new is({"raster-opacity":new kn(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new kn(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kn(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kn(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new kn(ge.paint_raster["raster-saturation"]),"raster-contrast":new kn(ge.paint_raster["raster-contrast"]),"raster-resampling":new kn(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new kn(ge.paint_raster["raster-fade-duration"])})},fn=function(s){function u(h){s.call(this,h,$r)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Cl),Gr=function(s){function u(h){s.call(this,h,{}),this.implementation=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(h){this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},u.prototype.onRemove=function(h){this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},u}(Cl),Ln={circle:Ph,heatmap:up,hillshade:If,fill:eu,"fill-extrusion":Rf,line:Kv,symbol:_t,background:Hr,raster:fn},hn=w.HTMLImageElement,Sn=w.HTMLCanvasElement,An=w.HTMLVideoElement,Tn=w.ImageData,ei=w.ImageBitmap,wa=function(s,u,h,_){this.context=s,this.format=h,this.texture=s.gl.createTexture(),this.update(u,_)};wa.prototype.update=function(s,u,h){var _=s.width,E=s.height,A=!(this.size&&this.size[0]===_&&this.size[1]===E||h),I=this.context,D=I.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!u||u.premultiply!==!1)),A)this.size=[_,E],s instanceof hn||s instanceof Sn||s instanceof An||s instanceof Tn||ei&&s instanceof ei?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,s):D.texImage2D(D.TEXTURE_2D,0,this.format,_,E,0,this.format,D.UNSIGNED_BYTE,s.data);else{var V=h||{x:0,y:0},$=V.x,q=V.y;s instanceof hn||s instanceof Sn||s instanceof An||s instanceof Tn||ei&&s instanceof ei?D.texSubImage2D(D.TEXTURE_2D,0,$,q,D.RGBA,D.UNSIGNED_BYTE,s):D.texSubImage2D(D.TEXTURE_2D,0,$,q,_,E,D.RGBA,D.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)},wa.prototype.bind=function(s,u,h){var _=this.context.gl;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),s!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,s),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||s),this.filter=s),u!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrap=u)},wa.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},wa.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ya=function(s){var u=this;this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};ya.prototype.trigger=function(){var s=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){s._triggered=!1,s._callback()},0))},ya.prototype.remove=function(){delete this._channel,this._callback=function(){}};var hl=function(s,u,h){this.target=s,this.parent=u,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ze(["receive","process"],this),this.invoker=new ya(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=St()?s:w};function bc(s,u,h){var _=2*Math.PI*6378137/256/Math.pow(2,h);return[s*_-2*Math.PI*6378137/2,u*_-2*Math.PI*6378137/2]}hl.prototype.send=function(s,u,h,_,E){var A=this;E===void 0&&(E=!1);var I=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(this.callbacks[I]=h);var D=gt(this.globalScope)?void 0:[];return this.target.postMessage({id:I,type:s,hasCallback:!!h,targetMapId:_,mustQueue:E,sourceMapId:this.mapId,data:Uu(u,D)},D),{cancel:function(){h&&delete A.callbacks[I],A.target.postMessage({id:I,type:"<cancel>",targetMapId:_,sourceMapId:A.mapId})}}},hl.prototype.receive=function(s){var u=s.data,h=u.id;if(h&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[h];var _=this.cancelCallbacks[h];delete this.cancelCallbacks[h],_&&_()}else St()||u.mustQueue?(this.tasks[h]=u,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,u)},hl.prototype.process=function(){if(this.taskQueue.length){var s=this.taskQueue.shift(),u=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(s,u)}},hl.prototype.processTask=function(s,u){var h=this;if(u.type==="<response>"){var _=this.callbacks[s];delete this.callbacks[s],_&&(u.error?_(fs(u.error)):_(null,fs(u.data)))}else{var E=!1,A=gt(this.globalScope)?void 0:[],I=u.hasCallback?function(q,te){E=!0,delete h.cancelCallbacks[s],h.target.postMessage({id:s,type:"<response>",sourceMapId:h.mapId,error:q?Uu(q):null,data:Uu(te,A)},A)}:function(q){E=!0},D=null,V=fs(u.data);if(this.parent[u.type])D=this.parent[u.type](u.sourceMapId,V,I);else if(this.parent.getWorkerSource){var $=u.type.split(".");D=this.parent.getWorkerSource(u.sourceMapId,$[0],V.source)[$[1]](V,I)}else I(new Error("Could not find function "+u.type));!E&&D&&D.cancel&&(this.cancelCallbacks[s]=D.cancel)}},hl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var za=function(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))};za.prototype.setNorthEast=function(s){return this._ne=s instanceof ea?new ea(s.lng,s.lat):ea.convert(s),this},za.prototype.setSouthWest=function(s){return this._sw=s instanceof ea?new ea(s.lng,s.lat):ea.convert(s),this},za.prototype.extend=function(s){var u,h,_=this._sw,E=this._ne;if(s instanceof ea)u=s,h=s;else{if(!(s instanceof za))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(za.convert(s)):this.extend(ea.convert(s)):this;if(h=s._ne,!(u=s._sw)||!h)return this}return _||E?(_.lng=Math.min(u.lng,_.lng),_.lat=Math.min(u.lat,_.lat),E.lng=Math.max(h.lng,E.lng),E.lat=Math.max(h.lat,E.lat)):(this._sw=new ea(u.lng,u.lat),this._ne=new ea(h.lng,h.lat)),this},za.prototype.getCenter=function(){return new ea((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},za.prototype.getSouthWest=function(){return this._sw},za.prototype.getNorthEast=function(){return this._ne},za.prototype.getNorthWest=function(){return new ea(this.getWest(),this.getNorth())},za.prototype.getSouthEast=function(){return new ea(this.getEast(),this.getSouth())},za.prototype.getWest=function(){return this._sw.lng},za.prototype.getSouth=function(){return this._sw.lat},za.prototype.getEast=function(){return this._ne.lng},za.prototype.getNorth=function(){return this._ne.lat},za.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},za.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},za.prototype.isEmpty=function(){return!(this._sw&&this._ne)},za.prototype.contains=function(s){var u=ea.convert(s),h=u.lng,_=u.lat,E=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(E=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&E},za.convert=function(s){return!s||s instanceof za?s:new za(s)};var ea=function(s,u){if(isNaN(s)||isNaN(u))throw new Error("Invalid LngLat object: ("+s+", "+u+")");if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ea.prototype.wrap=function(){return new ea(j(this.lng,-180,180),this.lat)},ea.prototype.toArray=function(){return[this.lng,this.lat]},ea.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ea.prototype.distanceTo=function(s){var u=Math.PI/180,h=this.lat*u,_=s.lat*u,E=Math.sin(h)*Math.sin(_)+Math.cos(h)*Math.cos(_)*Math.cos((s.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(E,1))},ea.prototype.toBounds=function(s){s===void 0&&(s=0);var u=360*s/40075017,h=u/Math.cos(Math.PI/180*this.lat);return new za(new ea(this.lng-h,this.lat-u),new ea(this.lng+h,this.lat+u))},ea.convert=function(s){if(s instanceof ea)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ea(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ea(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Jc=2*Math.PI*63710088e-1;function nc(s){return Jc*Math.cos(s*Math.PI/180)}function Sd(s){return(180+s)/360}function ic(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function e0(s,u){return s/nc(u)}function Om(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}var wd=function(s,u,h){h===void 0&&(h=0),this.x=+s,this.y=+u,this.z=+h};wd.fromLngLat=function(s,u){u===void 0&&(u=0);var h=ea.convert(s);return new wd(Sd(h.lng),ic(h.lat),e0(u,h.lat))},wd.prototype.toLngLat=function(){return new ea(360*this.x-180,Om(this.y))},wd.prototype.toAltitude=function(){return this.z*nc(Om(this.y))},wd.prototype.meterInMercatorCoordinateUnits=function(){return 1/Jc*(s=Om(this.y),1/Math.cos(s*Math.PI/180));var s};var zh=function(s,u,h){this.z=s,this.x=u,this.y=h,this.key=t0(0,s,s,u,h)};zh.prototype.equals=function(s){return this.z===s.z&&this.x===s.x&&this.y===s.y},zh.prototype.url=function(s,u){var h,_,E,A,I,D=(_=this.y,E=this.z,A=bc(256*(h=this.x),256*(_=Math.pow(2,E)-_-1),E),I=bc(256*(h+1),256*(_+1),E),A[0]+","+A[1]+","+I[0]+","+I[1]),V=function($,q,te){for(var oe,fe="",Pe=$;Pe>0;Pe--)fe+=(q&(oe=1<<Pe-1)?1:0)+(te&oe?2:0);return fe}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",V).replace("{bbox-epsg-3857}",D)},zh.prototype.getTilePoint=function(s){var u=Math.pow(2,this.z);return new y(8192*(s.x*u-this.x),8192*(s.y*u-this.y))},zh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var O0=function(s,u){this.wrap=s,this.canonical=u,this.key=t0(s,u.z,u.z,u.x,u.y)},Is=function(s,u,h,_,E){this.overscaledZ=s,this.wrap=u,this.canonical=new zh(h,+_,+E),this.key=t0(u,s,h,_,E)};function t0(s,u,h,_,E){(s*=2)<0&&(s=-1*s-1);var A=1<<h;return(A*A*s+A*E+_).toString(36)+h.toString(36)+u.toString(36)}Is.prototype.equals=function(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)},Is.prototype.scaledTo=function(s){var u=this.canonical.z-s;return s>this.canonical.z?new Is(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)},Is.prototype.calculateScaledKey=function(s,u){var h=this.canonical.z-s;return s>this.canonical.z?t0(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):t0(this.wrap*+u,s,s,this.canonical.x>>h,this.canonical.y>>h)},Is.prototype.isChildOf=function(s){if(s.wrap!==this.wrap)return!1;var u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u},Is.prototype.children=function(s){if(this.overscaledZ>=s)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,h=2*this.canonical.x,_=2*this.canonical.y;return[new Is(u,this.wrap,u,h,_),new Is(u,this.wrap,u,h+1,_),new Is(u,this.wrap,u,h,_+1),new Is(u,this.wrap,u,h+1,_+1)]},Is.prototype.isLessThan=function(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))},Is.prototype.wrapped=function(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Is.prototype.unwrapTo=function(s){return new Is(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)},Is.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Is.prototype.toUnwrapped=function(){return new O0(this.wrap,this.canonical)},Is.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Is.prototype.getTilePoint=function(s){return this.canonical.getTilePoint(new wd(s.x-this.wrap,s.y))},mn("CanonicalTileID",zh),mn("OverscaledTileID",Is,{omit:["posMatrix"]});var xp=function(s,u,h){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return ve('"'+h+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var _=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=h||"mapbox";for(var E=0;E<_;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(_,E)]=this.data[this._idx(_-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,_)]=this.data[this._idx(E,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)]};xp.prototype.get=function(s,u){var h=new Uint8Array(this.data.buffer),_=4*this._idx(s,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(h[_],h[_+1],h[_+2])},xp.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},xp.prototype._idx=function(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)},xp.prototype._unpackMapbox=function(s,u,h){return(256*s*256+256*u+h)/10-1e4},xp.prototype._unpackTerrarium=function(s,u,h){return 256*s+u+h/256-32768},xp.prototype.getPixels=function(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},xp.prototype.backfillBorder=function(s,u,h){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");var _=u*this.dim,E=u*this.dim+this.dim,A=h*this.dim,I=h*this.dim+this.dim;switch(u){case-1:_=E-1;break;case 1:E=_+1}switch(h){case-1:A=I-1;break;case 1:I=A+1}for(var D=-u*this.dim,V=-h*this.dim,$=A;$<I;$++)for(var q=_;q<E;q++)this.data[this._idx(q,$)]=s.data[this._idx(q+D,$+V)]},mn("DEMData",xp);var Ad=function(s){this._stringToNumber={},this._numberToString=[];for(var u=0;u<s.length;u++){var h=s[u];this._stringToNumber[h]=u,this._numberToString[u]=h}};Ad.prototype.encode=function(s){return this._stringToNumber[s]},Ad.prototype.decode=function(s){return this._numberToString[s]};var ov=function(s,u,h,_,E){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=h,s._y=_,this.properties=s.properties,this.id=E},Td={geometry:{configurable:!0}};Td.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Td.geometry.set=function(s){this._geometry=s},ov.prototype.toJSON=function(){var s={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s},Object.defineProperties(ov.prototype,Td);var Xp=function(){this.state={},this.stateChanges={},this.deletedStates={}};Xp.prototype.updateState=function(s,u,h){var _=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][_]=this.stateChanges[s][_]||{},Y(this.stateChanges[s][_],h),this.deletedStates[s]===null)for(var E in this.deletedStates[s]={},this.state[s])E!==_&&(this.deletedStates[s][E]=null);else if(this.deletedStates[s]&&this.deletedStates[s][_]===null)for(var A in this.deletedStates[s][_]={},this.state[s][_])h[A]||(this.deletedStates[s][_][A]=null);else for(var I in h)this.deletedStates[s]&&this.deletedStates[s][_]&&this.deletedStates[s][_][I]===null&&delete this.deletedStates[s][_][I]},Xp.prototype.removeFeatureState=function(s,u,h){if(this.deletedStates[s]!==null){var _=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},h&&u!==void 0)this.deletedStates[s][_]!==null&&(this.deletedStates[s][_]=this.deletedStates[s][_]||{},this.deletedStates[s][_][h]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][_])for(h in this.deletedStates[s][_]={},this.stateChanges[s][_])this.deletedStates[s][_][h]=null;else this.deletedStates[s][_]=null;else this.deletedStates[s]=null}},Xp.prototype.getState=function(s,u){var h=String(u),_=Y({},(this.state[s]||{})[h],(this.stateChanges[s]||{})[h]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){var E=this.deletedStates[s][u];if(E===null)return{};for(var A in E)delete _[A]}return _},Xp.prototype.initializeTileState=function(s,u){s.setFeatureState(this.state,u)},Xp.prototype.coalesceChanges=function(s,u){var h={};for(var _ in this.stateChanges){this.state[_]=this.state[_]||{};var E={};for(var A in this.stateChanges[_])this.state[_][A]||(this.state[_][A]={}),Y(this.state[_][A],this.stateChanges[_][A]),E[A]=this.state[_][A];h[_]=E}for(var I in this.deletedStates){this.state[I]=this.state[I]||{};var D={};if(this.deletedStates[I]===null)for(var V in this.state[I])D[V]={},this.state[I][V]={};else for(var $ in this.deletedStates[I]){if(this.deletedStates[I][$]===null)this.state[I][$]={};else for(var q=0,te=Object.keys(this.deletedStates[I][$]);q<te.length;q+=1)delete this.state[I][$][te[q]];D[$]=this.state[I][$]}h[I]=h[I]||{},Y(h[I],D)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(var oe in s)s[oe].setFeatureState(h,u)};var Pf=function(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new ql(8192,16,0),this.grid3D=new ql(8192,16,0),this.featureIndexArray=new re,this.promoteId=u};function lh(s,u,h,_,E){return Ke(s,function(A,I){var D=u instanceof $c?u.get(I):null;return D&&D.evaluate?D.evaluate(h,_,E):D})}function Zg(s){for(var u=1/0,h=1/0,_=-1/0,E=-1/0,A=0,I=s;A<I.length;A+=1){var D=I[A];u=Math.min(u,D.x),h=Math.min(h,D.y),_=Math.max(_,D.x),E=Math.max(E,D.y)}return{minX:u,minY:h,maxX:_,maxY:E}}function Pm(s,u){return u-s}Pf.prototype.insert=function(s,u,h,_,E,A){var I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,_,E);for(var D=A?this.grid3D:this.grid,V=0;V<u.length;V++){for(var $=u[V],q=[1/0,1/0,-1/0,-1/0],te=0;te<$.length;te++){var oe=$[te];q[0]=Math.min(q[0],oe.x),q[1]=Math.min(q[1],oe.y),q[2]=Math.max(q[2],oe.x),q[3]=Math.max(q[3],oe.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&D.insert(I,q[0],q[1],q[2],q[3])}},Pf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new _c.VectorTile(new di(this.rawTileData)).layers,this.sourceLayerCoder=new Ad(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Pf.prototype.query=function(s,u,h,_){var E=this;this.loadVTLayers();for(var A=s.params||{},I=8192/s.tileSize/s.scale,D=Mh(A.filter),V=s.queryGeometry,$=s.queryPadding*I,q=Zg(V),te=this.grid.query(q.minX-$,q.minY-$,q.maxX+$,q.maxY+$),oe=Zg(s.cameraQueryGeometry),fe=this.grid3D.query(oe.minX-$,oe.minY-$,oe.maxX+$,oe.maxY+$,function(Lt,Pt,nr,Fr){return function(tn,Vn,vn,$n,yn){for(var _i=0,ii=tn;_i<ii.length;_i+=1){var Pn=ii[_i];if(Vn<=Pn.x&&vn<=Pn.y&&$n>=Pn.x&&yn>=Pn.y)return!0}var Gi=[new y(Vn,vn),new y(Vn,yn),new y($n,yn),new y($n,vn)];if(tn.length>2){for(var wi=0,aa=Gi;wi<aa.length;wi+=1)if(Gu(tn,aa[wi]))return!0}for(var Yn=0;Yn<tn.length-1;Yn++)if(Tu(tn[Yn],tn[Yn+1],Gi))return!0;return!1}(s.cameraQueryGeometry,Lt-$,Pt-$,nr+$,Fr+$)}),Pe=0,De=fe;Pe<De.length;Pe+=1)te.push(De[Pe]);te.sort(Pm);for(var tt,We={},lt=function(Lt){var Pt=te[Lt];if(Pt!==tt){tt=Pt;var nr=E.featureIndexArray.get(Pt),Fr=null;E.loadMatchingFeature(We,nr.bucketIndex,nr.sourceLayerIndex,nr.featureIndex,D,A.layers,A.availableImages,u,h,_,function(tn,Vn,vn){return Fr||(Fr=Ka(tn)),Vn.queryIntersectsFeature(V,tn,vn,Fr,E.z,s.transform,I,s.pixelPosMatrix)})}},xt=0;xt<te.length;xt++)lt(xt);return We},Pf.prototype.loadMatchingFeature=function(s,u,h,_,E,A,I,D,V,$,q){var te=this.bucketLayerIDs[u];if(!A||function(tn,Vn){for(var vn=0;vn<tn.length;vn++)if(Vn.indexOf(tn[vn])>=0)return!0;return!1}(A,te)){var oe=this.sourceLayerCoder.decode(h),fe=this.vtLayers[oe].feature(_);if(E.needGeometry){var Pe=Na(fe,!0);if(!E.filter(new ti(this.tileID.overscaledZ),Pe,this.tileID.canonical))return}else if(!E.filter(new ti(this.tileID.overscaledZ),fe))return;for(var De=this.getId(fe,oe),tt=0;tt<te.length;tt++){var We=te[tt];if(!(A&&A.indexOf(We)<0)){var lt=D[We];if(lt){var xt={};De!==void 0&&$&&(xt=$.getState(lt.sourceLayer||"_geojsonTileLayer",De));var Lt=Y({},V[We]);Lt.paint=lh(Lt.paint,lt.paint,fe,xt,I),Lt.layout=lh(Lt.layout,lt.layout,fe,xt,I);var Pt=!q||q(fe,lt,xt);if(Pt){var nr=new ov(fe,this.z,this.x,this.y,De);nr.layer=Lt;var Fr=s[We];Fr===void 0&&(Fr=s[We]=[]),Fr.push({featureIndex:_,feature:nr,intersectionZ:Pt})}}}}}},Pf.prototype.lookupSymbolFeatures=function(s,u,h,_,E,A,I,D){var V={};this.loadVTLayers();for(var $=Mh(E),q=0,te=s;q<te.length;q+=1)this.loadMatchingFeature(V,h,_,te[q],$,A,I,D,u);return V},Pf.prototype.hasLayer=function(s){for(var u=0,h=this.bucketLayerIDs;u<h.length;u+=1)for(var _=0,E=h[u];_<E.length;_+=1)if(s===E[_])return!0;return!1},Pf.prototype.getId=function(s,u){var h=s.id;return this.promoteId&&typeof(h=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(h=Number(h)),h},mn("FeatureIndex",Pf,{omit:["rawTileData","sourceLayerCoder"]});var js=function(s,u){this.tileID=s,this.uid=ie(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};js.prototype.registerFadeDuration=function(s){var u=s+this.timeAdded;u<Sa.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},js.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},js.prototype.loadVectorData=function(s,u,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){for(var _ in s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function($,q){var te={};if(!q)return te;for(var oe=function(){var De=Pe[fe],tt=De.layerIds.map(function(xt){return q.getLayer(xt)}).filter(Boolean);if(tt.length!==0){De.layers=tt,De.stateDependentLayerIds&&(De.stateDependentLayers=De.stateDependentLayerIds.map(function(xt){return tt.filter(function(Lt){return Lt.id===xt})[0]}));for(var We=0,lt=tt;We<lt.length;We+=1)te[lt[We].id]=De}},fe=0,Pe=$;fe<Pe.length;fe+=1)oe();return te}(s.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var E=this.buckets[_];if(E instanceof de){if(this.hasSymbolBuckets=!0,!h)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var A in this.buckets){var I=this.buckets[A];if(I instanceof de&&I.hasRTLText){this.hasRTLText=!0,Vu.isLoading()||Vu.isLoaded()||vc()!=="deferred"||el();break}}for(var D in this.queryPadding=0,this.buckets){var V=this.buckets[D];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(D).queryRadius(V))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new g},js.prototype.unloadVectorData=function(){for(var s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},js.prototype.getBucket=function(s){return this.buckets[s.id]},js.prototype.upload=function(s){for(var u in this.buckets){var h=this.buckets[u];h.uploadPending()&&h.upload(s)}var _=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wa(s,this.imageAtlas.image,_.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wa(s,this.glyphAtlasImage,_.ALPHA),this.glyphAtlasImage=null)},js.prototype.prepare=function(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)},js.prototype.queryRenderedFeatures=function(s,u,h,_,E,A,I,D,V,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:E,scale:A,tileSize:this.tileSize,pixelPosMatrix:$,transform:D,params:I,queryPadding:this.queryPadding*V},s,u,h):{}},js.prototype.querySourceFeatures=function(s,u){var h=this.latestFeatureIndex;if(h&&h.rawTileData){var _=h.loadVTLayers(),E=u?u.sourceLayer:"",A=_._geojsonTileLayer||_[E];if(A)for(var I=Mh(u&&u.filter),D=this.tileID.canonical,V=D.z,$=D.x,q=D.y,te={z:V,x:$,y:q},oe=0;oe<A.length;oe++){var fe=A.feature(oe);if(I.needGeometry){var Pe=Na(fe,!0);if(!I.filter(new ti(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!I.filter(new ti(this.tileID.overscaledZ),fe))continue;var De=h.getId(fe,E),tt=new ov(fe,V,$,q,De);tt.tile=te,s.push(tt)}}},js.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},js.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},js.prototype.setExpiryData=function(s){var u=this.expirationTime;if(s.cacheControl){var h=Rt(s.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){var _=Date.now(),E=!1;if(this.expirationTime>_)E=!1;else if(u)if(this.expirationTime<u)E=!0;else{var A=this.expirationTime-u;A?this.expirationTime=_+Math.max(A,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},js.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},js.prototype.setFeatureState=function(s,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var h=this.latestFeatureIndex.loadVTLayers();for(var _ in this.buckets)if(u.style.hasLayer(_)){var E=this.buckets[_],A=E.layers[0].sourceLayer||"_geojsonTileLayer",I=h[A],D=s[A];if(I&&D&&Object.keys(D).length!==0){E.update(D,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});var V=u&&u.style&&u.style.getLayer(_);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(E)))}}}},js.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},js.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Sa.now()},js.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},js.prototype.setHoldDuration=function(s){this.symbolFadeHoldUntil=Sa.now()+s},js.prototype.setDependencies=function(s,u){for(var h={},_=0,E=u;_<E.length;_+=1)h[E[_]]=!0;this.dependencies[s]=h},js.prototype.hasDependency=function(s,u){for(var h=0,_=s;h<_.length;h+=1){var E=this.dependencies[_[h]];if(E){for(var A=0,I=u;A<I.length;A+=1)if(E[I[A]])return!0}}return!1};var Zp=w.performance,Fm=function(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},Zp.mark(this._marks.start)};Fm.prototype.finish=function(){Zp.mark(this._marks.end);var s=Zp.getEntriesByName(this._marks.measure);return s.length===0&&(Zp.measure(this._marks.measure,this._marks.start,this._marks.end),s=Zp.getEntriesByName(this._marks.measure),Zp.clearMarks(this._marks.start),Zp.clearMarks(this._marks.end),Zp.clearMeasures(this._marks.measure)),s},o.Actor=hl,o.AlphaImage=sl,o.CanonicalTileID=zh,o.CollisionBoxArray=g,o.Color=Li,o.DEMData=xp,o.DataConstantProperty=kn,o.DictionaryCoder=Ad,o.EXTENT=8192,o.ErrorEvent=et,o.EvaluationParameters=ti,o.Event=Be,o.Evented=ot,o.FeatureIndex=Pf,o.FillBucket=As,o.FillExtrusionBucket=rc,o.ImageAtlas=ar,o.ImagePosition=wr,o.LineBucket=la,o.LngLat=ea,o.LngLatBounds=za,o.MercatorCoordinate=wd,o.ONE_EM=24,o.OverscaledTileID=Is,o.Point=y,o.Point$1=y,o.Properties=is,o.Protobuf=di,o.RGBAImage=bo,o.RequestManager=Ct,o.RequestPerformance=Fm,o.ResourceType=yl,o.SegmentVector=me,o.SourceFeatureState=Xp,o.StructArrayLayout1ui2=rh,o.StructArrayLayout2f1f2i16=th,o.StructArrayLayout2i4=Sl,o.StructArrayLayout3ui6=wf,o.StructArrayLayout4i8=ye,o.SymbolBucket=de,o.Texture=wa,o.Tile=js,o.Transitionable=Ds,o.Uniform1f=Sr,o.Uniform1i=cr,o.Uniform2f=zr,o.Uniform3f=sn,o.Uniform4f=Cn,o.UniformColor=Dn,o.UniformMatrix4f=ta,o.UnwrappedTileID=O0,o.ValidationError=Ve,o.WritingMode=Br,o.ZoomHistory=Kf,o.add=function(s,u,h){return s[0]=u[0]+h[0],s[1]=u[1]+h[1],s[2]=u[2]+h[2],s},o.addDynamicAttributes=Tt,o.asyncAll=function(s,u,h){if(!s.length)return h(null,[]);var _=s.length,E=new Array(s.length),A=null;s.forEach(function(I,D){u(I,function(V,$){V&&(A=V),E[D]=$,--_==0&&h(A,E)})})},o.bezier=O,o.bindAll=ze,o.browser=Sa,o.cacheEntryPossiblyAdded=function(s){++ca>Bn&&(s.getActor().send("enforceCacheSizeLimit",Wn),ca=0)},o.clamp=z,o.clearTileCache=function(s){var u=w.caches.delete("mapbox-tiles");s&&u.catch(s).then(function(){return s()})},o.clipLine=Gs,o.clone=function(s){var u=new Bi(16);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},o.clone$1=Ce,o.clone$2=function(s){var u=new Bi(3);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u},o.collisionCircleLayout=Qv,o.config=hr,o.create=function(){var s=new Bi(16);return Bi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},o.create$1=function(){var s=new Bi(9);return Bi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s},o.create$2=function(){var s=new Bi(4);return Bi!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},o.createCommonjsModule=l,o.createExpression=fc,o.createLayout=es,o.createStyleLayer=function(s){return s.type==="custom"?new Gr(s):new Ln[s.type](s)},o.cross=function(s,u,h){var _=u[0],E=u[1],A=u[2],I=h[0],D=h[1],V=h[2];return s[0]=E*V-A*D,s[1]=A*I-_*V,s[2]=_*D-E*I,s},o.deepEqual=function s(u,h){if(Array.isArray(u)){if(!Array.isArray(h)||u.length!==h.length)return!1;for(var _=0;_<u.length;_++)if(!s(u[_],h[_]))return!1;return!0}if(typeof u=="object"&&u!==null&&h!==null){if(typeof h!="object"||Object.keys(u).length!==Object.keys(h).length)return!1;for(var E in u)if(!s(u[E],h[E]))return!1;return!0}return u===h},o.dot=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]},o.dot$1=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]*u[3]},o.ease=N,o.emitValidationErrors=fa,o.endsWith=ue,o.enforceCacheSizeLimit=function(s){Mi(),W&&W.then(function(u){u.keys().then(function(h){for(var _=0;_<h.length-s;_++)u.delete(h[_])})})},o.evaluateSizeForFeature=fi,o.evaluateSizeForZoom=Pa,o.evaluateVariableOffset=Mt,o.evented=Qf,o.extend=Y,o.featureFilter=Mh,o.filterObject=ke,o.fromRotation=function(s,u){var h=Math.sin(u),_=Math.cos(u);return s[0]=_,s[1]=h,s[2]=0,s[3]=-h,s[4]=_,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.getAnchorAlignment=ai,o.getAnchorJustification=yt,o.getArrayBuffer=Fu,o.getImage=ae,o.getJSON=function(s,u){return pf(Y(s,{type:"json"}),u)},o.getRTLTextPluginStatus=vc,o.getReferrer=nu,o.getVideo=function(s,u){var h,_,E=w.document.createElement("video");E.muted=!0,E.onloadstart=function(){u(null,E)};for(var A=0;A<s.length;A++){var I=w.document.createElement("source");h=s[A],_=void 0,(_=w.document.createElement("a")).href=h,(_.protocol!==w.document.location.protocol||_.host!==w.document.location.host)&&(E.crossOrigin="Anonymous"),I.src=s[A],E.appendChild(I)}return{cancel:function(){}}},o.identity=cu,o.invert=function(s,u){var h=u[0],_=u[1],E=u[2],A=u[3],I=u[4],D=u[5],V=u[6],$=u[7],q=u[8],te=u[9],oe=u[10],fe=u[11],Pe=u[12],De=u[13],tt=u[14],We=u[15],lt=h*D-_*I,xt=h*V-E*I,Lt=h*$-A*I,Pt=_*V-E*D,nr=_*$-A*D,Fr=E*$-A*V,tn=q*De-te*Pe,Vn=q*tt-oe*Pe,vn=q*We-fe*Pe,$n=te*tt-oe*De,yn=te*We-fe*De,_i=oe*We-fe*tt,ii=lt*_i-xt*yn+Lt*$n+Pt*vn-nr*Vn+Fr*tn;return ii?(s[0]=(D*_i-V*yn+$*$n)*(ii=1/ii),s[1]=(E*yn-_*_i-A*$n)*ii,s[2]=(De*Fr-tt*nr+We*Pt)*ii,s[3]=(oe*nr-te*Fr-fe*Pt)*ii,s[4]=(V*vn-I*_i-$*Vn)*ii,s[5]=(h*_i-E*vn+A*Vn)*ii,s[6]=(tt*Lt-Pe*Fr-We*xt)*ii,s[7]=(q*Fr-oe*Lt+fe*xt)*ii,s[8]=(I*yn-D*vn+$*tn)*ii,s[9]=(_*vn-h*yn-A*tn)*ii,s[10]=(Pe*nr-De*Lt+We*lt)*ii,s[11]=(te*Lt-q*nr-fe*lt)*ii,s[12]=(D*Vn-I*$n-V*tn)*ii,s[13]=(h*$n-_*Vn+E*tn)*ii,s[14]=(De*xt-Pe*Pt-tt*lt)*ii,s[15]=(q*Pt-te*xt+oe*lt)*ii,s):null},o.isChar=qr,o.isMapboxURL=Yt,o.keysDifference=function(s,u){var h=[];for(var _ in s)_ in u||h.push(_);return h},o.makeRequest=pf,o.mapObject=Ke,o.mercatorXfromLng=Sd,o.mercatorYfromLat=ic,o.mercatorZfromAltitude=e0,o.mul=ih,o.multiply=La,o.mvt=_c,o.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},o.normalize=function(s,u){var h=u[0],_=u[1],E=u[2],A=h*h+_*_+E*E;return A>0&&(A=1/Math.sqrt(A)),s[0]=u[0]*A,s[1]=u[1]*A,s[2]=u[2]*A,s},o.number=Ro,o.offscreenCanvasSupported=Ki,o.ortho=function(s,u,h,_,E,A,I){var D=1/(u-h),V=1/(_-E),$=1/(A-I);return s[0]=-2*D,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*V,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*$,s[11]=0,s[12]=(u+h)*D,s[13]=(E+_)*V,s[14]=(I+A)*$,s[15]=1,s},o.parseGlyphPBF=function(s){return new di(s).readFields(gr,[])},o.pbf=di,o.performSymbolLayout=function(s,u,h,_,E,A,I){s.createArrays(),s.tilePixelRatio=8192/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;var D=s.layers[0].layout,V=s.layers[0]._unevaluatedLayout._values,$={};if(s.textSizeData.kind==="composite"){var q=s.textSizeData,te=q.maxZoom;$.compositeTextSizes=[V["text-size"].possiblyEvaluate(new ti(q.minZoom),I),V["text-size"].possiblyEvaluate(new ti(te),I)]}if(s.iconSizeData.kind==="composite"){var oe=s.iconSizeData,fe=oe.maxZoom;$.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new ti(oe.minZoom),I),V["icon-size"].possiblyEvaluate(new ti(fe),I)]}$.layoutTextSize=V["text-size"].possiblyEvaluate(new ti(s.zoom+1),I),$.layoutIconSize=V["icon-size"].possiblyEvaluate(new ti(s.zoom+1),I),$.textMaxSize=V["text-size"].possiblyEvaluate(new ti(18));for(var Pe=24*D.get("text-line-height"),De=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",tt=D.get("text-keep-upright"),We=D.get("text-size"),lt=function(){var Pt=Lt[xt],nr=D.get("text-font").evaluate(Pt,{},I).join(","),Fr=We.evaluate(Pt,{},I),tn=$.layoutTextSize.evaluate(Pt,{},I),Vn=$.layoutIconSize.evaluate(Pt,{},I),vn={horizontal:{},vertical:void 0},$n=Pt.text,yn=[0,0];if($n){var _i=$n.toString(),ii=24*D.get("text-letter-spacing").evaluate(Pt,{},I),Pn=function(ra){for(var Qa=0,Ua=ra;Qa<Ua.length;Qa+=1)if(ha=Ua[Qa].charCodeAt(0),qr.Arabic(ha)||qr["Arabic Supplement"](ha)||qr["Arabic Extended-A"](ha)||qr["Arabic Presentation Forms-A"](ha)||qr["Arabic Presentation Forms-B"](ha))return!1;var ha;return!0}(_i)?ii:0,Gi=D.get("text-anchor").evaluate(Pt,{},I),wi=D.get("text-variable-anchor");if(!wi){var aa=D.get("text-radial-offset").evaluate(Pt,{},I);yn=aa?Mt(Gi,[24*aa,Oe]):D.get("text-offset").evaluate(Pt,{},I).map(function(ra){return 24*ra})}var Yn=De?"center":D.get("text-justify").evaluate(Pt,{},I),Ea=D.get("symbol-placement"),Ao=Ea==="point"?24*D.get("text-max-width").evaluate(Pt,{},I):0,Eo=function(){s.allowVerticalPlacement&&Kl(_i)&&(vn.vertical=er($n,u,h,E,nr,Ao,Pe,Gi,"left",Pn,yn,Br.vertical,!0,Ea,tn,Fr))};if(!De&&wi){for(var fo=Yn==="auto"?wi.map(function(ra){return yt(ra)}):[Yn],To=!1,qo=0;qo<fo.length;qo++){var Ko=fo[qo];if(!vn.horizontal[Ko])if(To)vn.horizontal[Ko]=vn.horizontal[0];else{var Mo=er($n,u,h,E,nr,Ao,Pe,"center",Ko,Pn,yn,Br.horizontal,!1,Ea,tn,Fr);Mo&&(vn.horizontal[Ko]=Mo,To=Mo.positionedLines.length===1)}}Eo()}else{Yn==="auto"&&(Yn=yt(Gi));var $u=er($n,u,h,E,nr,Ao,Pe,Gi,Yn,Pn,yn,Br.horizontal,!1,Ea,tn,Fr);$u&&(vn.horizontal[Yn]=$u),Eo(),Kl(_i)&&De&&tt&&(vn.vertical=er($n,u,h,E,nr,Ao,Pe,Gi,Yn,Pn,yn,Br.vertical,!1,Ea,tn,Fr))}}var zo=void 0,ku=!1;if(Pt.icon&&Pt.icon.name){var Uo=_[Pt.icon.name];Uo&&(zo=function(ra,Qa,Ua){var ha=ai(Ua),pl=Qa[0]-ra.displaySize[0]*ha.horizontalAlign,Hs=Qa[1]-ra.displaySize[1]*ha.verticalAlign;return{image:ra,top:Hs,bottom:Hs+ra.displaySize[1],left:pl,right:pl+ra.displaySize[0]}}(E[Pt.icon.name],D.get("icon-offset").evaluate(Pt,{},I),D.get("icon-anchor").evaluate(Pt,{},I)),ku=Uo.sdf,s.sdfIcons===void 0?s.sdfIcons=Uo.sdf:s.sdfIcons!==Uo.sdf&&ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Uo.pixelRatio!==s.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}var tu=Vi(vn.horizontal)||vn.vertical;s.iconsInText=!!tu&&tu.iconsInText,(tu||zo)&&function(ra,Qa,Ua,ha,pl,Hs,ho,Fa,Ls,_a,Ru){var xi=Hs.textMaxSize.evaluate(Qa,{});xi===void 0&&(xi=ho);var ch,Aa=ra.layers[0].layout,Xa=Aa.get("icon-offset").evaluate(Qa,{},Ru),ef=Vi(Ua.horizontal),Fl=ho/24,Yp=ra.tilePixelRatio*Fl,Md=ra.tilePixelRatio*xi/24,fh=ra.tilePixelRatio*Fa,Id=ra.tilePixelRatio*Aa.get("symbol-spacing"),sv=Aa.get("text-padding")*ra.tilePixelRatio,bp=Aa.get("icon-padding")*ra.tilePixelRatio,Ld=Aa.get("text-max-angle")/180*Math.PI,Ec=Aa.get("text-rotation-alignment")==="map"&&Aa.get("symbol-placement")!=="point",kd=Aa.get("icon-rotation-alignment")==="map"&&Aa.get("symbol-placement")!=="point",Cc=Aa.get("symbol-placement"),Io=Id/2,po=Aa.get("icon-text-fit");ha&&po!=="none"&&(ra.allowVerticalPlacement&&Ua.vertical&&(ch=pn(ha,Ua.vertical,po,Aa.get("icon-text-fit-padding"),Xa,Fl)),ef&&(ha=pn(ha,ef,po,Aa.get("icon-text-fit-padding"),Xa,Fl)));var Uh=function(Bm,Dl){Dl.x<0||Dl.x>=8192||Dl.y<0||Dl.y>=8192||function(rs,ph,oo,pu,D0,hv,n0,Bf,B0,i0,N0,z0,a0,Nm,o0,dh,qg,Kg,zm,pv,Sc,dv,U0,Nf,Um){var ru,Ws,vv,Cp,Dd,tf=rs.addToLineVertexArray(ph,oo),mv=0,Qg=0,Jg=0,Vm=0,Gm=-1,jm=-1,Sp={},Hm=Re(""),gv=0,Wm=0;if(Bf._unevaluatedLayout.getValue("text-radial-offset")===void 0?(gv=(ru=Bf.layout.get("text-offset").evaluate(Sc,{},Nf).map(function(l0){return 24*l0}))[0],Wm=ru[1]):(gv=24*Bf.layout.get("text-radial-offset").evaluate(Sc,{},Nf),Wm=Oe),rs.allowVerticalPlacement&&pu.vertical){var Bd=Bf.layout.get("text-rotate").evaluate(Sc,{},Nf)+90;Cp=new No(B0,ph,i0,N0,z0,pu.vertical,a0,Nm,o0,Bd),n0&&(Dd=new No(B0,ph,i0,N0,z0,n0,qg,Kg,o0,Bd))}if(D0){var $m=Bf.layout.get("icon-rotate").evaluate(Sc,{}),_s=Bf.layout.get("icon-text-fit")!=="none",Gh=Ms(D0,$m,U0,_s),V0=n0?Ms(n0,$m,U0,_s):void 0;vv=new No(B0,ph,i0,N0,z0,D0,qg,Kg,!1,$m),mv=4*Gh.length;var s0=rs.iconSizeData,Qp=null;s0.kind==="source"?(Qp=[128*Bf.layout.get("icon-size").evaluate(Sc,{})])[0]>32640&&ve(rs.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):s0.kind==="composite"&&((Qp=[128*dv.compositeIconSizes[0].evaluate(Sc,{},Nf),128*dv.compositeIconSizes[1].evaluate(Sc,{},Nf)])[0]>32640||Qp[1]>32640)&&ve(rs.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),rs.addSymbols(rs.icon,Gh,Qp,pv,zm,Sc,!1,ph,tf.lineStartIndex,tf.lineLength,-1,Nf),Gm=rs.icon.placedSymbolArray.length-1,V0&&(Qg=4*V0.length,rs.addSymbols(rs.icon,V0,Qp,pv,zm,Sc,Br.vertical,ph,tf.lineStartIndex,tf.lineLength,-1,Nf),jm=rs.icon.placedSymbolArray.length-1)}for(var yv in pu.horizontal){var u0=pu.horizontal[yv];if(!Ws){Hm=Re(u0.text);var Xm=Bf.layout.get("text-rotate").evaluate(Sc,{},Nf);Ws=new No(B0,ph,i0,N0,z0,u0,a0,Nm,o0,Xm)}var Nd=u0.positionedLines.length===1;if(Jg+=gn(rs,ph,u0,hv,Bf,o0,Sc,dh,tf,pu.vertical?Br.horizontal:Br.horizontalOnly,Nd?Object.keys(pu.horizontal):[yv],Sp,Gm,dv,Nf),Nd)break}pu.vertical&&(Vm+=gn(rs,ph,pu.vertical,hv,Bf,o0,Sc,dh,tf,Br.vertical,["vertical"],Sp,jm,dv,Nf));var Zm=Ws?Ws.boxStartIndex:rs.collisionBoxArray.length,Ym=Ws?Ws.boxEndIndex:rs.collisionBoxArray.length,ey=Cp?Cp.boxStartIndex:rs.collisionBoxArray.length,ty=Cp?Cp.boxEndIndex:rs.collisionBoxArray.length,G0=vv?vv.boxStartIndex:rs.collisionBoxArray.length,p_=vv?vv.boxEndIndex:rs.collisionBoxArray.length,d_=Dd?Dd.boxStartIndex:rs.collisionBoxArray.length,qm=Dd?Dd.boxEndIndex:rs.collisionBoxArray.length,jh=-1,j0=function(l0,ny){return l0&&l0.circleDiameter?Math.max(l0.circleDiameter,ny):ny};jh=j0(Ws,jh),jh=j0(Cp,jh),jh=j0(vv,jh);var ry=(jh=j0(Dd,jh))>-1?1:0;ry&&(jh*=Um/24),rs.glyphOffsetArray.length>=de.MAX_GLYPHS&&ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Sc.sortKey!==void 0&&rs.addToSortKeyRanges(rs.symbolInstances.length,Sc.sortKey),rs.symbolInstances.emplaceBack(ph.x,ph.y,Sp.right>=0?Sp.right:-1,Sp.center>=0?Sp.center:-1,Sp.left>=0?Sp.left:-1,Sp.vertical||-1,Gm,jm,Hm,Zm,Ym,ey,ty,G0,p_,d_,qm,i0,Jg,Vm,mv,Qg,ry,0,a0,gv,Wm,jh)}(ra,Dl,Bm,Ua,ha,pl,ch,ra.layers[0],ra.collisionBoxArray,Qa.index,Qa.sourceLayerIndex,ra.index,Yp,sv,Ec,Ls,fh,bp,kd,Xa,Qa,Hs,_a,Ru,ho)};if(Cc==="line")for(var uv=0,Rd=Gs(Qa.geometry,0,0,8192,8192);uv<Rd.length;uv+=1)for(var r0=Rd[uv],lv=0,cv=Vs(r0,Id,Ld,Ua.vertical||ef,ha,24,Md,ra.overscaling,8192);lv<cv.length;lv+=1){var Od=cv[lv];ef&&Te(ra,ef.text,Io,Od)||Uh(r0,Od)}else if(Cc==="line-center")for(var Ep=0,Vh=Qa.geometry;Ep<Vh.length;Ep+=1){var qp=Vh[Ep];if(qp.length>1){var P0=as(qp,Ld,Ua.vertical||ef,ha,24,Md);P0&&Uh(qp,P0)}}else if(Qa.type==="Polygon")for(var Pd=0,Fd=ju(Qa.geometry,0);Pd<Fd.length;Pd+=1){var Xu=Fd[Pd],hh=$a(Xu,16);Uh(Xu[0],new Hn(hh.x,hh.y,0))}else if(Qa.type==="LineString")for(var Ff=0,Kp=Qa.geometry;Ff<Kp.length;Ff+=1){var fv=Kp[Ff];Uh(fv,new Hn(fv[0].x,fv[0].y,0))}else if(Qa.type==="Point")for(var Dm=0,Yg=Qa.geometry;Dm<Yg.length;Dm+=1)for(var F0=0,Df=Yg[Dm];F0<Df.length;F0+=1){var vi=Df[F0];Uh([vi],new Hn(vi.x,vi.y,0))}}(s,Pt,vn,zo,_,$,tn,Vn,yn,ku,I)},xt=0,Lt=s.features;xt<Lt.length;xt+=1)lt();A&&s.generateCollisionDebugBuffers()},o.perspective=function(s,u,h,_,E){var A,I=1/Math.tan(u/2);return s[0]=I/h,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,E!=null&&E!==1/0?(s[10]=(E+_)*(A=1/(_-E)),s[14]=2*E*_*A):(s[10]=-1,s[14]=-2*_),s},o.pick=function(s,u){for(var h={},_=0;_<u.length;_++){var E=u[_];E in s&&(h[E]=s[E])}return h},o.plugin=Vu,o.polygonIntersectsPolygon=Ss,o.postMapLoadEvent=Mn,o.postTurnstileEvent=fr,o.potpack=Ft,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=mn,o.registerForPluginStateChange=function(s){return s({pluginStatus:Eu,pluginURL:xl}),Qf.on("pluginStateChange",s),s},o.renderColorRamp=Up,o.rotate=function(s,u,h){var _=u[0],E=u[1],A=u[2],I=u[3],D=Math.sin(h),V=Math.cos(h);return s[0]=_*V+A*D,s[1]=E*V+I*D,s[2]=_*-D+A*V,s[3]=E*-D+I*V,s},o.rotateX=function(s,u,h){var _=Math.sin(h),E=Math.cos(h),A=u[4],I=u[5],D=u[6],V=u[7],$=u[8],q=u[9],te=u[10],oe=u[11];return u!==s&&(s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[4]=A*E+$*_,s[5]=I*E+q*_,s[6]=D*E+te*_,s[7]=V*E+oe*_,s[8]=$*E-A*_,s[9]=q*E-I*_,s[10]=te*E-D*_,s[11]=oe*E-V*_,s},o.rotateZ=function(s,u,h){var _=Math.sin(h),E=Math.cos(h),A=u[0],I=u[1],D=u[2],V=u[3],$=u[4],q=u[5],te=u[6],oe=u[7];return u!==s&&(s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[0]=A*E+$*_,s[1]=I*E+q*_,s[2]=D*E+te*_,s[3]=V*E+oe*_,s[4]=$*E-A*_,s[5]=q*E-I*_,s[6]=te*E-D*_,s[7]=oe*E-V*_,s},o.scale=function(s,u,h){var _=h[0],E=h[1],A=h[2];return s[0]=u[0]*_,s[1]=u[1]*_,s[2]=u[2]*_,s[3]=u[3]*_,s[4]=u[4]*E,s[5]=u[5]*E,s[6]=u[6]*E,s[7]=u[7]*E,s[8]=u[8]*A,s[9]=u[9]*A,s[10]=u[10]*A,s[11]=u[11]*A,s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},o.scale$1=function(s,u,h){return s[0]=u[0]*h,s[1]=u[1]*h,s[2]=u[2]*h,s[3]=u[3]*h,s},o.scale$2=function(s,u,h){return s[0]=u[0]*h,s[1]=u[1]*h,s[2]=u[2]*h,s},o.setCacheLimits=function(s,u){Wn=s,Bn=u},o.setRTLTextPlugin=function(s,u,h){if(h===void 0&&(h=!1),Eu==="deferred"||Eu==="loading"||Eu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xl=Sa.resolveURL(s),Eu="deferred",sp=u,bl(),h||el()},o.sphericalToCartesian=function(s){var u=s[0],h=s[1],_=s[2];return h+=90,h*=Math.PI/180,_*=Math.PI/180,{x:u*Math.cos(h)*Math.sin(_),y:u*Math.sin(h)*Math.sin(_),z:u*Math.cos(_)}},o.sqrLen=function(s){var u=s[0],h=s[1];return u*u+h*h},o.styleSpec=ge,o.sub=function(s,u,h){return s[0]=u[0]-h[0],s[1]=u[1]-h[1],s[2]=u[2]-h[2],s},o.symbolSize=Yo,o.transformMat3=function(s,u,h){var _=u[0],E=u[1],A=u[2];return s[0]=_*h[0]+E*h[3]+A*h[6],s[1]=_*h[1]+E*h[4]+A*h[7],s[2]=_*h[2]+E*h[5]+A*h[8],s},o.transformMat4=Iu,o.translate=function(s,u,h){var _,E,A,I,D,V,$,q,te,oe,fe,Pe,De=h[0],tt=h[1],We=h[2];return u===s?(s[12]=u[0]*De+u[4]*tt+u[8]*We+u[12],s[13]=u[1]*De+u[5]*tt+u[9]*We+u[13],s[14]=u[2]*De+u[6]*tt+u[10]*We+u[14],s[15]=u[3]*De+u[7]*tt+u[11]*We+u[15]):(E=u[1],A=u[2],I=u[3],D=u[4],V=u[5],$=u[6],q=u[7],te=u[8],oe=u[9],fe=u[10],Pe=u[11],s[0]=_=u[0],s[1]=E,s[2]=A,s[3]=I,s[4]=D,s[5]=V,s[6]=$,s[7]=q,s[8]=te,s[9]=oe,s[10]=fe,s[11]=Pe,s[12]=_*De+D*tt+te*We+u[12],s[13]=E*De+V*tt+oe*We+u[13],s[14]=A*De+$*tt+fe*We+u[14],s[15]=I*De+q*tt+Pe*We+u[15]),s},o.triggerPluginCompletionEvent=dc,o.uniqueId=ie,o.validateCustomStyleLayer=function(s){var u=[],h=s.id;return h===void 0&&u.push({message:"layers."+h+': missing required property "id"'}),s.render===void 0&&u.push({message:"layers."+h+': missing required method "render"'}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&u.push({message:"layers."+h+': property "renderingMode" must be either "2d" or "3d"'}),u},o.validateLight=qf,o.validateStyle=Lh,o.values=function(s){var u=[];for(var h in s)u.push(s[h]);return u},o.vectorTile=_c,o.version="1.13.2",o.warnOnce=ve,o.webpSupported=Dr,o.window=w,o.wrap=j}),a(["./shared"],function(o){function l(J){var ae=typeof J;if(ae==="number"||ae==="boolean"||ae==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){for(var ce="[",be=0,Be=J;be<Be.length;be+=1)ce+=l(Be[be])+",";return ce+"]"}for(var et=Object.keys(J).sort(),ot="{",ge=0;ge<et.length;ge++)ot+=JSON.stringify(et[ge])+":"+l(J[et[ge]])+",";return ot+"}"}function c(J){for(var ae="",ce=0,be=o.refProperties;ce<be.length;ce+=1)ae+="/"+l(J[be[ce]]);return ae}var p=function(J){this.keyCache={},J&&this.replace(J)};p.prototype.replace=function(J){this._layerConfigs={},this._layers={},this.update(J,[])},p.prototype.update=function(J,ae){for(var ce=this,be=0,Be=J;be<Be.length;be+=1){var et=Be[be];this._layerConfigs[et.id]=et;var ot=this._layers[et.id]=o.createStyleLayer(et);ot._featureFilter=o.featureFilter(ot.filter),this.keyCache[et.id]&&delete this.keyCache[et.id]}for(var ge=0,Ve=ae;ge<Ve.length;ge+=1){var mt=Ve[ge];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var Jt=0,Cr=function(Wr,Zr){for(var gi={},Jr=0;Jr<Wr.length;Jr++){var bi=Zr&&Zr[Wr[Jr].id]||c(Wr[Jr]);Zr&&(Zr[Wr[Jr].id]=bi);var ci=gi[bi];ci||(ci=gi[bi]=[]),ci.push(Wr[Jr])}var Ci=[];for(var Fi in gi)Ci.push(gi[Fi]);return Ci}(o.values(this._layerConfigs),this.keyCache);Jt<Cr.length;Jt+=1){var Dt=Cr[Jt].map(function(Wr){return ce._layers[Wr.id]}),pr=Dt[0];if(pr.visibility!=="none"){var Nr=pr.source||"",xn=this.familiesBySource[Nr];xn||(xn=this.familiesBySource[Nr]={});var Bt=pr.sourceLayer||"_geojsonTileLayer",ln=xn[Bt];ln||(ln=xn[Bt]=[]),ln.push(Dt)}}};var y=function(J){var ae={},ce=[];for(var be in J){var Be=J[be],et=ae[be]={};for(var ot in Be){var ge=Be[+ot];if(ge&&ge.bitmap.width!==0&&ge.bitmap.height!==0){var Ve={x:0,y:0,w:ge.bitmap.width+2,h:ge.bitmap.height+2};ce.push(Ve),et[ot]={rect:Ve,metrics:ge.metrics}}}}var mt=o.potpack(ce),Jt=new o.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Cr in J){var Dt=J[Cr];for(var pr in Dt){var Nr=Dt[+pr];if(Nr&&Nr.bitmap.width!==0&&Nr.bitmap.height!==0){var xn=ae[Cr][pr].rect;o.AlphaImage.copy(Nr.bitmap,Jt,{x:0,y:0},{x:xn.x+1,y:xn.y+1},Nr.bitmap)}}}this.image=Jt,this.positions=ae};o.register("GlyphAtlas",y);var b=function(J){this.tileID=new o.OverscaledTileID(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId};function w(J,ae,ce){for(var be=new o.EvaluationParameters(ae),Be=0,et=J;Be<et.length;Be+=1)et[Be].recalculate(be,ce)}function M(J,ae){var ce=o.getArrayBuffer(J.request,function(be,Be,et,ot){be?ae(be):Be&&ae(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(Be)),rawData:Be,cacheControl:et,expires:ot})});return function(){ce.cancel(),ae()}}b.prototype.parse=function(J,ae,ce,be,Be){var et=this;this.status="parsing",this.data=J,this.collisionBoxArray=new o.CollisionBoxArray;var ot=new o.DictionaryCoder(Object.keys(J.layers).sort()),ge=new o.FeatureIndex(this.tileID,this.promoteId);ge.bucketLayerIDs=[];var Ve,mt,Jt,Cr,Dt={},pr={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},Nr=ae.familiesBySource[this.source];for(var xn in Nr){var Bt=J.layers[xn];if(Bt){Bt.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+xn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var ln=ot.encode(xn),Wr=[],Zr=0;Zr<Bt.length;Zr++){var gi=Bt.feature(Zr),Jr=ge.getId(gi,xn);Wr.push({feature:gi,id:Jr,index:Zr,sourceLayerIndex:ln})}for(var bi=0,ci=Nr[xn];bi<ci.length;bi+=1){var Ci=ci[bi],Fi=Ci[0];Fi.minzoom&&this.zoom<Math.floor(Fi.minzoom)||Fi.maxzoom&&this.zoom>=Fi.maxzoom||Fi.visibility!=="none"&&(w(Ci,this.zoom,ce),(Dt[Fi.id]=Fi.createBucket({index:ge.bucketLayerIDs.length,layers:Ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ln,sourceID:this.source})).populate(Wr,pr,this.tileID.canonical),ge.bucketLayerIDs.push(Ci.map(function(ia){return ia.id})))}}}var Di=o.mapObject(pr.glyphDependencies,function(ia){return Object.keys(ia).map(Number)});Object.keys(Di).length?be.send("getGlyphs",{uid:this.uid,stacks:Di},function(ia,pi){Ve||(Ve=ia,mt=pi,Zi.call(et))}):mt={};var ls=Object.keys(pr.iconDependencies);ls.length?be.send("getImages",{icons:ls,source:this.source,tileID:this.tileID,type:"icons"},function(ia,pi){Ve||(Ve=ia,Jt=pi,Zi.call(et))}):Jt={};var sa=Object.keys(pr.patternDependencies);function Zi(){if(Ve)return Be(Ve);if(mt&&Jt&&Cr){var ia=new y(mt),pi=new o.ImageAtlas(Jt,Cr);for(var Li in Dt){var go=Dt[Li];go instanceof o.SymbolBucket?(w(go.layers,this.zoom,ce),o.performSymbolLayout(go,mt,ia.positions,Jt,pi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):go.hasPattern&&(go instanceof o.LineBucket||go instanceof o.FillBucket||go instanceof o.FillExtrusionBucket)&&(w(go.layers,this.zoom,ce),go.addFeatures(pr,this.tileID.canonical,pi.patternPositions))}this.status="done",Be(null,{buckets:o.values(Dt).filter(function(pa){return!pa.isEmpty()}),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ia.image,imageAtlas:pi,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?Jt:null,glyphPositions:this.returnDependencies?ia.positions:null})}}sa.length?be.send("getImages",{icons:sa,source:this.source,tileID:this.tileID,type:"patterns"},function(ia,pi){Ve||(Ve=ia,Cr=pi,Zi.call(et))}):Cr={},Zi.call(this)};var O=function(J,ae,ce,be){this.actor=J,this.layerIndex=ae,this.availableImages=ce,this.loadVectorData=be||M,this.loading={},this.loaded={}};O.prototype.loadTile=function(J,ae){var ce=this,be=J.uid;this.loading||(this.loading={});var Be=!!(J&&J.request&&J.request.collectResourceTiming)&&new o.RequestPerformance(J.request),et=this.loading[be]=new b(J);et.abort=this.loadVectorData(J,function(ot,ge){if(delete ce.loading[be],ot||!ge)return et.status="done",ce.loaded[be]=et,ae(ot);var Ve=ge.rawData,mt={};ge.expires&&(mt.expires=ge.expires),ge.cacheControl&&(mt.cacheControl=ge.cacheControl);var Jt={};if(Be){var Cr=Be.finish();Cr&&(Jt.resourceTiming=JSON.parse(JSON.stringify(Cr)))}et.vectorTile=ge.vectorTile,et.parse(ge.vectorTile,ce.layerIndex,ce.availableImages,ce.actor,function(Dt,pr){if(Dt||!pr)return ae(Dt);ae(null,o.extend({rawTileData:Ve.slice(0)},pr,mt,Jt))}),ce.loaded=ce.loaded||{},ce.loaded[be]=et})},O.prototype.reloadTile=function(J,ae){var ce=this,be=this.loaded,Be=J.uid,et=this;if(be&&be[Be]){var ot=be[Be];ot.showCollisionBoxes=J.showCollisionBoxes;var ge=function(Ve,mt){var Jt=ot.reloadCallback;Jt&&(delete ot.reloadCallback,ot.parse(ot.vectorTile,et.layerIndex,ce.availableImages,et.actor,Jt)),ae(Ve,mt)};ot.status==="parsing"?ot.reloadCallback=ge:ot.status==="done"&&(ot.vectorTile?ot.parse(ot.vectorTile,this.layerIndex,this.availableImages,this.actor,ge):ge())}},O.prototype.abortTile=function(J,ae){var ce=this.loading,be=J.uid;ce&&ce[be]&&ce[be].abort&&(ce[be].abort(),delete ce[be]),ae()},O.prototype.removeTile=function(J,ae){var ce=this.loaded,be=J.uid;ce&&ce[be]&&delete ce[be],ae()};var N=o.window.ImageBitmap,z=function(){this.loaded={}};function j(J,ae){if(J.length!==0){Y(J[0],ae);for(var ce=1;ce<J.length;ce++)Y(J[ce],!ae)}}function Y(J,ae){for(var ce=0,be=0,Be=J.length,et=Be-1;be<Be;et=be++)ce+=(J[be][0]-J[et][0])*(J[et][1]+J[be][1]);ce>=0!=!!ae&&J.reverse()}z.prototype.loadTile=function(J,ae){var ce=J.uid,be=J.encoding,Be=J.rawImageData,et=N&&Be instanceof N?this.getImageData(Be):Be,ot=new o.DEMData(ce,et,be);this.loaded=this.loaded||{},this.loaded[ce]=ot,ae(null,ot)},z.prototype.getImageData=function(J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);var ae=this.offscreenCanvasContext.getImageData(-1,-1,J.width+2,J.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:ae.width,height:ae.height},ae.data)},z.prototype.removeTile=function(J){var ae=this.loaded,ce=J.uid;ae&&ae[ce]&&delete ae[ce]};var K=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,ie=function(J){this._feature=J,this.extent=o.EXTENT,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))};ie.prototype.loadGeometry=function(){if(this._feature.type===1){for(var J=[],ae=0,ce=this._feature.geometry;ae<ce.length;ae+=1){var be=ce[ae];J.push([new o.Point$1(be[0],be[1])])}return J}for(var Be=[],et=0,ot=this._feature.geometry;et<ot.length;et+=1){for(var ge=[],Ve=0,mt=ot[et];Ve<mt.length;Ve+=1){var Jt=mt[Ve];ge.push(new o.Point$1(Jt[0],Jt[1]))}Be.push(ge)}return Be},ie.prototype.toGeoJSON=function(J,ae,ce){return K.call(this,J,ae,ce)};var le=function(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=J.length,this._features=J};le.prototype.feature=function(J){return new ie(this._features[J])};var Se=o.vectorTile.VectorTileFeature,ze=ue;function ue(J,ae){this.options=ae||{},this.features=J,this.length=J.length}function Ke(J,ae){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=ae||4096}ue.prototype.feature=function(J){return new Ke(this.features[J],this.options.extent)},Ke.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var ae=0;ae<J.length;ae++){for(var ce=J[ae],be=[],Be=0;Be<ce.length;Be++)be.push(new o.Point$1(ce[Be][0],ce[Be][1]));this.geometry.push(be)}return this.geometry},Ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,ae=1/0,ce=-1/0,be=1/0,Be=-1/0,et=0;et<J.length;et++)for(var ot=J[et],ge=0;ge<ot.length;ge++){var Ve=ot[ge];ae=Math.min(ae,Ve.x),ce=Math.max(ce,Ve.x),be=Math.min(be,Ve.y),Be=Math.max(Be,Ve.y)}return[ae,be,ce,Be]},Ke.prototype.toGeoJSON=Se.prototype.toGeoJSON;var ke=je,Ce=ze;function je(J){var ae=new o.pbf;return function(ce,be){for(var Be in ce.layers)be.writeMessage(3,ve,ce.layers[Be])}(J,ae),ae.finish()}function ve(J,ae){var ce;ae.writeVarintField(15,J.version||1),ae.writeStringField(1,J.name||""),ae.writeVarintField(5,J.extent||4096);var be={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<J.length;ce++)be.feature=J.feature(ce),ae.writeMessage(2,Ie,be);var Be=be.keys;for(ce=0;ce<Be.length;ce++)ae.writeStringField(3,Be[ce]);var et=be.values;for(ce=0;ce<et.length;ce++)ae.writeMessage(4,gt,et[ce])}function Ie(J,ae){var ce=J.feature;ce.id!==void 0&&ae.writeVarintField(1,ce.id),ae.writeMessage(2,dt,J),ae.writeVarintField(3,ce.type),ae.writeMessage(4,$t,ce)}function dt(J,ae){var ce=J.feature,be=J.keys,Be=J.values,et=J.keycache,ot=J.valuecache;for(var ge in ce.properties){var Ve=et[ge];Ve===void 0&&(be.push(ge),et[ge]=Ve=be.length-1),ae.writeVarint(Ve);var mt=ce.properties[ge],Jt=typeof mt;Jt!=="string"&&Jt!=="boolean"&&Jt!=="number"&&(mt=JSON.stringify(mt));var Cr=Jt+":"+mt,Dt=ot[Cr];Dt===void 0&&(Be.push(mt),ot[Cr]=Dt=Be.length-1),ae.writeVarint(Dt)}}function St(J,ae){return(ae<<3)+(7&J)}function Rt(J){return J<<1^J>>31}function $t(J,ae){for(var ce=J.loadGeometry(),be=J.type,Be=0,et=0,ot=ce.length,ge=0;ge<ot;ge++){var Ve=ce[ge],mt=1;be===1&&(mt=Ve.length),ae.writeVarint(St(1,mt));for(var Jt=be===3?Ve.length-1:Ve.length,Cr=0;Cr<Jt;Cr++){Cr===1&&be!==1&&ae.writeVarint(St(2,Jt-1));var Dt=Ve[Cr].x-Be,pr=Ve[Cr].y-et;ae.writeVarint(Rt(Dt)),ae.writeVarint(Rt(pr)),Be+=Dt,et+=pr}be===3&&ae.writeVarint(St(7,1))}}function gt(J,ae){var ce=typeof J;ce==="string"?ae.writeStringField(1,J):ce==="boolean"?ae.writeBooleanField(7,J):ce==="number"&&(J%1!=0?ae.writeDoubleField(3,J):J<0?ae.writeSVarintField(6,J):ae.writeVarintField(5,J))}function jr(J,ae,ce,be){Er(J,ce,be),Er(ae,2*ce,2*be),Er(ae,2*ce+1,2*be+1)}function Er(J,ae,ce){var be=J[ae];J[ae]=J[ce],J[ce]=be}function rn(J,ae,ce,be){var Be=J-ce,et=ae-be;return Be*Be+et*et}ke.fromVectorTileJs=je,ke.fromGeojsonVt=function(J,ae){ae=ae||{};var ce={};for(var be in J)ce[be]=new ze(J[be].features,ae),ce[be].name=be,ce[be].version=ae.version,ce[be].extent=ae.extent;return je({layers:ce})},ke.GeoJSONWrapper=Ce;var dn=function(J){return J[0]},Rn=function(J){return J[1]},Ar=function(J,ae,ce,be,Be){ae===void 0&&(ae=dn),ce===void 0&&(ce=Rn),be===void 0&&(be=64),Be===void 0&&(Be=Float64Array),this.nodeSize=be,this.points=J;for(var et=J.length<65536?Uint16Array:Uint32Array,ot=this.ids=new et(J.length),ge=this.coords=new Be(2*J.length),Ve=0;Ve<J.length;Ve++)ot[Ve]=Ve,ge[2*Ve]=ae(J[Ve]),ge[2*Ve+1]=ce(J[Ve]);(function mt(Jt,Cr,Dt,pr,Nr,xn){if(!(Nr-pr<=Dt)){var Bt=pr+Nr>>1;(function ln(Wr,Zr,gi,Jr,bi,ci){for(;bi>Jr;){if(bi-Jr>600){var Ci=bi-Jr+1,Fi=gi-Jr+1,Di=Math.log(Ci),ls=.5*Math.exp(2*Di/3),sa=.5*Math.sqrt(Di*ls*(Ci-ls)/Ci)*(Fi-Ci/2<0?-1:1);ln(Wr,Zr,gi,Math.max(Jr,Math.floor(gi-Fi*ls/Ci+sa)),Math.min(bi,Math.floor(gi+(Ci-Fi)*ls/Ci+sa)),ci)}var Zi=Zr[2*gi+ci],ia=Jr,pi=bi;for(jr(Wr,Zr,Jr,gi),Zr[2*bi+ci]>Zi&&jr(Wr,Zr,Jr,bi);ia<pi;){for(jr(Wr,Zr,ia,pi),ia++,pi--;Zr[2*ia+ci]<Zi;)ia++;for(;Zr[2*pi+ci]>Zi;)pi--}Zr[2*Jr+ci]===Zi?jr(Wr,Zr,Jr,pi):jr(Wr,Zr,++pi,bi),pi<=gi&&(Jr=pi+1),gi<=pi&&(bi=pi-1)}})(Jt,Cr,Bt,pr,Nr,xn%2),mt(Jt,Cr,Dt,pr,Bt-1,xn+1),mt(Jt,Cr,Dt,Bt+1,Nr,xn+1)}})(ot,ge,be,0,ot.length-1,0)};Ar.prototype.range=function(J,ae,ce,be){return function(Be,et,ot,ge,Ve,mt,Jt){for(var Cr,Dt,pr=[0,Be.length-1,0],Nr=[];pr.length;){var xn=pr.pop(),Bt=pr.pop(),ln=pr.pop();if(Bt-ln<=Jt)for(var Wr=ln;Wr<=Bt;Wr++)Dt=et[2*Wr+1],(Cr=et[2*Wr])>=ot&&Cr<=Ve&&Dt>=ge&&Dt<=mt&&Nr.push(Be[Wr]);else{var Zr=Math.floor((ln+Bt)/2);Dt=et[2*Zr+1],(Cr=et[2*Zr])>=ot&&Cr<=Ve&&Dt>=ge&&Dt<=mt&&Nr.push(Be[Zr]);var gi=(xn+1)%2;(xn===0?ot<=Cr:ge<=Dt)&&(pr.push(ln),pr.push(Zr-1),pr.push(gi)),(xn===0?Ve>=Cr:mt>=Dt)&&(pr.push(Zr+1),pr.push(Bt),pr.push(gi))}}return Nr}(this.ids,this.coords,J,ae,ce,be,this.nodeSize)},Ar.prototype.within=function(J,ae,ce){return function(be,Be,et,ot,ge,Ve){for(var mt=[0,be.length-1,0],Jt=[],Cr=ge*ge;mt.length;){var Dt=mt.pop(),pr=mt.pop(),Nr=mt.pop();if(pr-Nr<=Ve)for(var xn=Nr;xn<=pr;xn++)rn(Be[2*xn],Be[2*xn+1],et,ot)<=Cr&&Jt.push(be[xn]);else{var Bt=Math.floor((Nr+pr)/2),ln=Be[2*Bt],Wr=Be[2*Bt+1];rn(ln,Wr,et,ot)<=Cr&&Jt.push(be[Bt]);var Zr=(Dt+1)%2;(Dt===0?et-ge<=ln:ot-ge<=Wr)&&(mt.push(Nr),mt.push(Bt-1),mt.push(Zr)),(Dt===0?et+ge>=ln:ot+ge>=Wr)&&(mt.push(Bt+1),mt.push(pr),mt.push(Zr))}}return Jt}(this.ids,this.coords,J,ae,ce,this.nodeSize)};var xa={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(J){return J}},Ti=function(J){this.options=Qe(Object.create(xa),J),this.trees=new Array(this.options.maxZoom+1)};function Sa(J,ae,ce,be,Be){return{x:J,y:ae,zoom:1/0,id:ce,parentId:-1,numPoints:be,properties:Be}}function hr(J,ae){var ce=J.geometry.coordinates,be=ce[1];return{x:Wt(ce[0]),y:Me(be),zoom:1/0,index:ae,parentId:-1}}function Dr(J){return{type:"Feature",id:J.id,properties:Kn(J),geometry:{type:"Point",coordinates:[(be=J.x,360*(be-.5)),(ae=J.y,ce=(180-360*ae)*Math.PI/180,360*Math.atan(Math.exp(ce))/Math.PI-90)]}};var ae,ce,be}function Kn(J){var ae=J.numPoints,ce=ae>=1e4?Math.round(ae/1e3)+"k":ae>=1e3?Math.round(ae/100)/10+"k":ae;return Qe(Qe({},J.properties),{cluster:!0,cluster_id:J.id,point_count:ae,point_count_abbreviated:ce})}function Wt(J){return J/360+.5}function Me(J){var ae=Math.sin(J*Math.PI/180),ce=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return ce<0?0:ce>1?1:ce}function Qe(J,ae){for(var ce in ae)J[ce]=ae[ce];return J}function Ct(J){return J.x}function Yt(J){return J.y}function qt(J,ae,ce,be,Be,et){var ot=Be-ce,ge=et-be;if(ot!==0||ge!==0){var Ve=((J-ce)*ot+(ae-be)*ge)/(ot*ot+ge*ge);Ve>1?(ce=Be,be=et):Ve>0&&(ce+=ot*Ve,be+=ge*Ve)}return(ot=J-ce)*ot+(ge=ae-be)*ge}function _r(J,ae,ce,be){var Be={id:J===void 0?null:J,type:ae,geometry:ce,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(et){var ot=et.geometry,ge=et.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Pr(et,ot);else if(ge==="Polygon"||ge==="MultiLineString")for(var Ve=0;Ve<ot.length;Ve++)Pr(et,ot[Ve]);else if(ge==="MultiPolygon")for(Ve=0;Ve<ot.length;Ve++)for(var mt=0;mt<ot[Ve].length;mt++)Pr(et,ot[Ve][mt])}(Be),Be}function Pr(J,ae){for(var ce=0;ce<ae.length;ce+=3)J.minX=Math.min(J.minX,ae[ce]),J.minY=Math.min(J.minY,ae[ce+1]),J.maxX=Math.max(J.maxX,ae[ce]),J.maxY=Math.max(J.maxY,ae[ce+1])}function xr(J,ae,ce,be){if(ae.geometry){var Be=ae.geometry.coordinates,et=ae.geometry.type,ot=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),ge=[],Ve=ae.id;if(ce.promoteId?Ve=ae.properties[ce.promoteId]:ce.generateId&&(Ve=be||0),et==="Point")kr(Be,ge);else if(et==="MultiPoint")for(var mt=0;mt<Be.length;mt++)kr(Be[mt],ge);else if(et==="LineString")vr(Be,ge,ot,!1);else if(et==="MultiLineString"){if(ce.lineMetrics){for(mt=0;mt<Be.length;mt++)vr(Be[mt],ge=[],ot,!1),J.push(_r(Ve,"LineString",ge,ae.properties));return}In(Be,ge,ot,!1)}else if(et==="Polygon")In(Be,ge,ot,!0);else{if(et!=="MultiPolygon"){if(et==="GeometryCollection"){for(mt=0;mt<ae.geometry.geometries.length;mt++)xr(J,{id:Ve,geometry:ae.geometry.geometries[mt],properties:ae.properties},ce,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<Be.length;mt++){var Jt=[];In(Be[mt],Jt,ot,!0),ge.push(Jt)}}J.push(_r(Ve,et,ge,ae.properties))}}function kr(J,ae){ae.push(W(J[0])),ae.push(st(J[1])),ae.push(0)}function vr(J,ae,ce,be){for(var Be,et,ot=0,ge=0;ge<J.length;ge++){var Ve=W(J[ge][0]),mt=st(J[ge][1]);ae.push(Ve),ae.push(mt),ae.push(0),ge>0&&(ot+=be?(Be*mt-Ve*et)/2:Math.sqrt(Math.pow(Ve-Be,2)+Math.pow(mt-et,2))),Be=Ve,et=mt}var Jt=ae.length-3;ae[2]=1,function Cr(Dt,pr,Nr,xn){for(var Bt,ln=xn,Wr=Nr-pr>>1,Zr=Nr-pr,gi=Dt[pr],Jr=Dt[pr+1],bi=Dt[Nr],ci=Dt[Nr+1],Ci=pr+3;Ci<Nr;Ci+=3){var Fi=qt(Dt[Ci],Dt[Ci+1],gi,Jr,bi,ci);if(Fi>ln)Bt=Ci,ln=Fi;else if(Fi===ln){var Di=Math.abs(Ci-Wr);Di<Zr&&(Bt=Ci,Zr=Di)}}ln>xn&&(Bt-pr>3&&Cr(Dt,pr,Bt,xn),Dt[Bt+2]=ln,Nr-Bt>3&&Cr(Dt,Bt,Nr,xn))}(ae,0,Jt,ce),ae[Jt+2]=1,ae.size=Math.abs(ot),ae.start=0,ae.end=ae.size}function In(J,ae,ce,be){for(var Be=0;Be<J.length;Be++){var et=[];vr(J[Be],et,ce,be),ae.push(et)}}function W(J){return J/360+.5}function st(J){var ae=Math.sin(J*Math.PI/180),ce=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return ce<0?0:ce>1?1:ce}function zt(J,ae,ce,be,Be,et,ot,ge){if(be/=ae,et>=(ce/=ae)&&ot<be)return J;if(ot<ce||et>=be)return null;for(var Ve=[],mt=0;mt<J.length;mt++){var Jt=J[mt],Cr=Jt.geometry,Dt=Jt.type,pr=Be===0?Jt.minX:Jt.minY,Nr=Be===0?Jt.maxX:Jt.maxY;if(pr>=ce&&Nr<be)Ve.push(Jt);else if(!(Nr<ce||pr>=be)){var xn=[];if(Dt==="Point"||Dt==="MultiPoint")mr(Cr,xn,ce,be,Be);else if(Dt==="LineString")fr(Cr,xn,ce,be,Be,!1,ge.lineMetrics);else if(Dt==="MultiLineString")Mn(Cr,xn,ce,be,Be,!1);else if(Dt==="Polygon")Mn(Cr,xn,ce,be,Be,!0);else if(Dt==="MultiPolygon")for(var Bt=0;Bt<Cr.length;Bt++){var ln=[];Mn(Cr[Bt],ln,ce,be,Be,!0),ln.length&&xn.push(ln)}if(xn.length){if(ge.lineMetrics&&Dt==="LineString"){for(Bt=0;Bt<xn.length;Bt++)Ve.push(_r(Jt.id,Dt,xn[Bt],Jt.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(xn.length===1?(Dt="LineString",xn=xn[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=xn.length===3?"Point":"MultiPoint"),Ve.push(_r(Jt.id,Dt,xn,Jt.tags))}}}return Ve.length?Ve:null}function mr(J,ae,ce,be,Be){for(var et=0;et<J.length;et+=3){var ot=J[et+Be];ot>=ce&&ot<=be&&(ae.push(J[et]),ae.push(J[et+1]),ae.push(J[et+2]))}}function fr(J,ae,ce,be,Be,et,ot){for(var ge,Ve,mt=nn(J),Jt=Be===0?Bn:Mi,Cr=J.start,Dt=0;Dt<J.length-3;Dt+=3){var pr=J[Dt],Nr=J[Dt+1],xn=J[Dt+2],Bt=J[Dt+3],ln=J[Dt+4],Wr=Be===0?pr:Nr,Zr=Be===0?Bt:ln,gi=!1;ot&&(ge=Math.sqrt(Math.pow(pr-Bt,2)+Math.pow(Nr-ln,2))),Wr<ce?Zr>ce&&(Ve=Jt(mt,pr,Nr,Bt,ln,ce),ot&&(mt.start=Cr+ge*Ve)):Wr>be?Zr<be&&(Ve=Jt(mt,pr,Nr,Bt,ln,be),ot&&(mt.start=Cr+ge*Ve)):Wn(mt,pr,Nr,xn),Zr<ce&&Wr>=ce&&(Ve=Jt(mt,pr,Nr,Bt,ln,ce),gi=!0),Zr>be&&Wr<=be&&(Ve=Jt(mt,pr,Nr,Bt,ln,be),gi=!0),!et&&gi&&(ot&&(mt.end=Cr+ge*Ve),ae.push(mt),mt=nn(J)),ot&&(Cr+=ge)}var Jr=J.length-3;pr=J[Jr],Nr=J[Jr+1],xn=J[Jr+2],(Wr=Be===0?pr:Nr)>=ce&&Wr<=be&&Wn(mt,pr,Nr,xn),Jr=mt.length-3,et&&Jr>=3&&(mt[Jr]!==mt[0]||mt[Jr+1]!==mt[1])&&Wn(mt,mt[0],mt[1],mt[2]),mt.length&&ae.push(mt)}function nn(J){var ae=[];return ae.size=J.size,ae.start=J.start,ae.end=J.end,ae}function Mn(J,ae,ce,be,Be,et){for(var ot=0;ot<J.length;ot++)fr(J[ot],ae,ce,be,Be,et,!1)}function Wn(J,ae,ce,be){J.push(ae),J.push(ce),J.push(be)}function Bn(J,ae,ce,be,Be,et){var ot=(et-ae)/(be-ae);return J.push(et),J.push(ce+(Be-ce)*ot),J.push(1),ot}function Mi(J,ae,ce,be,Be,et){var ot=(et-ce)/(Be-ce);return J.push(ae+(be-ae)*ot),J.push(et),J.push(1),ot}function mi(J,ae){for(var ce=[],be=0;be<J.length;be++){var Be,et=J[be],ot=et.type;if(ot==="Point"||ot==="MultiPoint"||ot==="LineString")Be=mo(et.geometry,ae);else if(ot==="MultiLineString"||ot==="Polygon"){Be=[];for(var ge=0;ge<et.geometry.length;ge++)Be.push(mo(et.geometry[ge],ae))}else if(ot==="MultiPolygon")for(Be=[],ge=0;ge<et.geometry.length;ge++){for(var Ve=[],mt=0;mt<et.geometry[ge].length;mt++)Ve.push(mo(et.geometry[ge][mt],ae));Be.push(Ve)}ce.push(_r(et.id,ot,Be,et.tags))}return ce}function mo(J,ae){var ce=[];ce.size=J.size,J.start!==void 0&&(ce.start=J.start,ce.end=J.end);for(var be=0;be<J.length;be+=3)ce.push(J[be]+ae,J[be+1],J[be+2]);return ce}function ca(J,ae){if(J.transformed)return J;var ce,be,Be,et=1<<J.z,ot=J.x,ge=J.y;for(ce=0;ce<J.features.length;ce++){var Ve=J.features[ce],mt=Ve.geometry,Jt=Ve.type;if(Ve.geometry=[],Jt===1)for(be=0;be<mt.length;be+=2)Ve.geometry.push(Ki(mt[be],mt[be+1],ae,et,ot,ge));else for(be=0;be<mt.length;be++){var Cr=[];for(Be=0;Be<mt[be].length;Be+=2)Cr.push(Ki(mt[be][Be],mt[be][Be+1],ae,et,ot,ge));Ve.geometry.push(Cr)}}return J.transformed=!0,J}function Ki(J,ae,ce,be,Be,et){return[Math.round(ce*(J*be-Be)),Math.round(ce*(ae*be-et))]}function yl(J,ae,ce,be,Be){for(var et=ae===Be.maxZoom?0:Be.tolerance/((1<<ae)*Be.extent),ot={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:be,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<J.length;ge++){ot.numFeatures++,Xi(ot,J[ge],et,Be);var Ve=J[ge].minX,mt=J[ge].minY,Jt=J[ge].maxX,Cr=J[ge].maxY;Ve<ot.minX&&(ot.minX=Ve),mt<ot.minY&&(ot.minY=mt),Jt>ot.maxX&&(ot.maxX=Jt),Cr>ot.maxY&&(ot.maxY=Cr)}return ot}function Xi(J,ae,ce,be){var Be=ae.geometry,et=ae.type,ot=[];if(et==="Point"||et==="MultiPoint")for(var ge=0;ge<Be.length;ge+=3)ot.push(Be[ge]),ot.push(Be[ge+1]),J.numPoints++,J.numSimplified++;else if(et==="LineString")nu(ot,Be,J,ce,!1,!1);else if(et==="MultiLineString"||et==="Polygon")for(ge=0;ge<Be.length;ge++)nu(ot,Be[ge],J,ce,et==="Polygon",ge===0);else if(et==="MultiPolygon")for(var Ve=0;Ve<Be.length;Ve++){var mt=Be[Ve];for(ge=0;ge<mt.length;ge++)nu(ot,mt[ge],J,ce,!0,ge===0)}if(ot.length){var Jt=ae.tags||null;if(et==="LineString"&&be.lineMetrics){for(var Cr in Jt={},ae.tags)Jt[Cr]=ae.tags[Cr];Jt.mapbox_clip_start=Be.start/Be.size,Jt.mapbox_clip_end=Be.end/Be.size}var Dt={geometry:ot,type:et==="Polygon"||et==="MultiPolygon"?3:et==="LineString"||et==="MultiLineString"?2:1,tags:Jt};ae.id!==null&&(Dt.id=ae.id),J.features.push(Dt)}}function nu(J,ae,ce,be,Be,et){var ot=be*be;if(be>0&&ae.size<(Be?ot:be))ce.numPoints+=ae.length/3;else{for(var ge=[],Ve=0;Ve<ae.length;Ve+=3)(be===0||ae[Ve+2]>ot)&&(ce.numSimplified++,ge.push(ae[Ve]),ge.push(ae[Ve+1])),ce.numPoints++;Be&&function(mt,Jt){for(var Cr=0,Dt=0,pr=mt.length,Nr=pr-2;Dt<pr;Nr=Dt,Dt+=2)Cr+=(mt[Dt]-mt[Nr])*(mt[Dt+1]+mt[Nr+1]);if(Cr>0===Jt)for(Dt=0,pr=mt.length;Dt<pr/2;Dt+=2){var xn=mt[Dt],Bt=mt[Dt+1];mt[Dt]=mt[pr-2-Dt],mt[Dt+1]=mt[pr-1-Dt],mt[pr-2-Dt]=xn,mt[pr-1-Dt]=Bt}}(ge,et),J.push(ge)}}function mu(J,ae){var ce=(ae=this.options=function(Be,et){for(var ot in et)Be[ot]=et[ot];return Be}(Object.create(this.options),ae)).debug;if(ce&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var be=function(Be,et){var ot=[];if(Be.type==="FeatureCollection")for(var ge=0;ge<Be.features.length;ge++)xr(ot,Be.features[ge],et,ge);else xr(ot,Be.type==="Feature"?Be:{geometry:Be},et);return ot}(J,ae);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(be=function(Be,et){var ot=et.buffer/et.extent,ge=Be,Ve=zt(Be,1,-1-ot,ot,0,-1,2,et),mt=zt(Be,1,1-ot,2+ot,0,-1,2,et);return(Ve||mt)&&(ge=zt(Be,1,-ot,1+ot,0,-1,2,et)||[],Ve&&(ge=mi(Ve,1).concat(ge)),mt&&(ge=ge.concat(mi(mt,-1)))),ge}(be,ae)).length&&this.splitTile(be,0,0,0),ce&&(be.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function iu(J,ae,ce){return 32*((1<<J)*ce+ae)+J}function pf(J,ae){var ce=J.tileID.canonical;if(!this._geoJSONIndex)return ae(null,null);var be=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!be)return ae(null,null);var Be=new le(be.features),et=ke(Be);et.byteOffset===0&&et.byteLength===et.buffer.byteLength||(et=new Uint8Array(et)),ae(null,{vectorTile:Be,rawData:et.buffer})}Ti.prototype.load=function(J){var ae=this.options,ce=ae.log,be=ae.minZoom,Be=ae.maxZoom,et=ae.nodeSize;ce&&console.time("total time");var ot="prepare "+J.length+" points";ce&&console.time(ot),this.points=J;for(var ge=[],Ve=0;Ve<J.length;Ve++)J[Ve].geometry&&ge.push(hr(J[Ve],Ve));this.trees[Be+1]=new Ar(ge,Ct,Yt,et,Float32Array),ce&&console.timeEnd(ot);for(var mt=Be;mt>=be;mt--){var Jt=+Date.now();ge=this._cluster(ge,mt),this.trees[mt]=new Ar(ge,Ct,Yt,et,Float32Array),ce&&console.log("z%d: %d clusters in %dms",mt,ge.length,+Date.now()-Jt)}return ce&&console.timeEnd("total time"),this},Ti.prototype.getClusters=function(J,ae){var ce=((J[0]+180)%360+360)%360-180,be=Math.max(-90,Math.min(90,J[1])),Be=J[2]===180?180:((J[2]+180)%360+360)%360-180,et=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)ce=-180,Be=180;else if(ce>Be){var ot=this.getClusters([ce,be,180,et],ae),ge=this.getClusters([-180,be,Be,et],ae);return ot.concat(ge)}for(var Ve=this.trees[this._limitZoom(ae)],mt=[],Jt=0,Cr=Ve.range(Wt(ce),Me(et),Wt(Be),Me(be));Jt<Cr.length;Jt+=1){var Dt=Ve.points[Cr[Jt]];mt.push(Dt.numPoints?Dr(Dt):this.points[Dt.index])}return mt},Ti.prototype.getChildren=function(J){var ae=this._getOriginId(J),ce=this._getOriginZoom(J),be="No cluster with the specified id.",Be=this.trees[ce];if(!Be)throw new Error(be);var et=Be.points[ae];if(!et)throw new Error(be);for(var ot=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),ge=[],Ve=0,mt=Be.within(et.x,et.y,ot);Ve<mt.length;Ve+=1){var Jt=Be.points[mt[Ve]];Jt.parentId===J&&ge.push(Jt.numPoints?Dr(Jt):this.points[Jt.index])}if(ge.length===0)throw new Error(be);return ge},Ti.prototype.getLeaves=function(J,ae,ce){var be=[];return this._appendLeaves(be,J,ae=ae||10,ce=ce||0,0),be},Ti.prototype.getTile=function(J,ae,ce){var be=this.trees[this._limitZoom(J)],Be=Math.pow(2,J),et=this.options,ot=et.radius/et.extent,ge=(ce-ot)/Be,Ve=(ce+1+ot)/Be,mt={features:[]};return this._addTileFeatures(be.range((ae-ot)/Be,ge,(ae+1+ot)/Be,Ve),be.points,ae,ce,Be,mt),ae===0&&this._addTileFeatures(be.range(1-ot/Be,ge,1,Ve),be.points,Be,ce,Be,mt),ae===Be-1&&this._addTileFeatures(be.range(0,ge,ot/Be,Ve),be.points,-1,ce,Be,mt),mt.features.length?mt:null},Ti.prototype.getClusterExpansionZoom=function(J){for(var ae=this._getOriginZoom(J)-1;ae<=this.options.maxZoom;){var ce=this.getChildren(J);if(ae++,ce.length!==1)break;J=ce[0].properties.cluster_id}return ae},Ti.prototype._appendLeaves=function(J,ae,ce,be,Be){for(var et=0,ot=this.getChildren(ae);et<ot.length;et+=1){var ge=ot[et],Ve=ge.properties;if(Ve&&Ve.cluster?Be+Ve.point_count<=be?Be+=Ve.point_count:Be=this._appendLeaves(J,Ve.cluster_id,ce,be,Be):Be<be?Be++:J.push(ge),J.length===ce)break}return Be},Ti.prototype._addTileFeatures=function(J,ae,ce,be,Be,et){for(var ot=0,ge=J;ot<ge.length;ot+=1){var Ve=ae[ge[ot]],mt=Ve.numPoints,Jt={type:1,geometry:[[Math.round(this.options.extent*(Ve.x*Be-ce)),Math.round(this.options.extent*(Ve.y*Be-be))]],tags:mt?Kn(Ve):this.points[Ve.index].properties},Cr=void 0;mt?Cr=Ve.id:this.options.generateId?Cr=Ve.index:this.points[Ve.index].id&&(Cr=this.points[Ve.index].id),Cr!==void 0&&(Jt.id=Cr),et.features.push(Jt)}},Ti.prototype._limitZoom=function(J){return Math.max(this.options.minZoom,Math.min(+J,this.options.maxZoom+1))},Ti.prototype._cluster=function(J,ae){for(var ce=[],be=this.options,Be=be.reduce,et=be.minPoints,ot=be.radius/(be.extent*Math.pow(2,ae)),ge=0;ge<J.length;ge++){var Ve=J[ge];if(!(Ve.zoom<=ae)){Ve.zoom=ae;for(var mt=this.trees[ae+1],Jt=mt.within(Ve.x,Ve.y,ot),Cr=Ve.numPoints||1,Dt=Cr,pr=0,Nr=Jt;pr<Nr.length;pr+=1){var xn=mt.points[Nr[pr]];xn.zoom>ae&&(Dt+=xn.numPoints||1)}if(Dt>=et){for(var Bt=Ve.x*Cr,ln=Ve.y*Cr,Wr=Be&&Cr>1?this._map(Ve,!0):null,Zr=(ge<<5)+(ae+1)+this.points.length,gi=0,Jr=Jt;gi<Jr.length;gi+=1){var bi=mt.points[Jr[gi]];if(!(bi.zoom<=ae)){bi.zoom=ae;var ci=bi.numPoints||1;Bt+=bi.x*ci,ln+=bi.y*ci,bi.parentId=Zr,Be&&(Wr||(Wr=this._map(Ve,!0)),Be(Wr,this._map(bi)))}}Ve.parentId=Zr,ce.push(Sa(Bt/Dt,ln/Dt,Zr,Dt,Wr))}else if(ce.push(Ve),Dt>1)for(var Ci=0,Fi=Jt;Ci<Fi.length;Ci+=1){var Di=mt.points[Fi[Ci]];Di.zoom<=ae||(Di.zoom=ae,ce.push(Di))}}}return ce},Ti.prototype._getOriginId=function(J){return J-this.points.length>>5},Ti.prototype._getOriginZoom=function(J){return(J-this.points.length)%32},Ti.prototype._map=function(J,ae){if(J.numPoints)return ae?Qe({},J.properties):J.properties;var ce=this.points[J.index].properties,be=this.options.map(ce);return ae&&be===ce?Qe({},be):be},mu.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mu.prototype.splitTile=function(J,ae,ce,be,Be,et,ot){for(var ge=[J,ae,ce,be],Ve=this.options,mt=Ve.debug;ge.length;){be=ge.pop(),ce=ge.pop(),ae=ge.pop(),J=ge.pop();var Jt=1<<ae,Cr=iu(ae,ce,be),Dt=this.tiles[Cr];if(!Dt&&(mt>1&&console.time("creation"),Dt=this.tiles[Cr]=yl(J,ae,ce,be,Ve),this.tileCoords.push({z:ae,x:ce,y:be}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,ce,be,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var pr="z"+ae;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Dt.source=J,Be){if(ae===Ve.maxZoom||ae===Be)continue;var Nr=1<<Be-ae;if(ce!==Math.floor(et/Nr)||be!==Math.floor(ot/Nr))continue}else if(ae===Ve.indexMaxZoom||Dt.numPoints<=Ve.indexMaxPoints)continue;if(Dt.source=null,J.length!==0){mt>1&&console.time("clipping");var xn,Bt,ln,Wr,Zr,gi,Jr=.5*Ve.buffer/Ve.extent,bi=.5-Jr,ci=.5+Jr,Ci=1+Jr;xn=Bt=ln=Wr=null,Zr=zt(J,Jt,ce-Jr,ce+ci,0,Dt.minX,Dt.maxX,Ve),gi=zt(J,Jt,ce+bi,ce+Ci,0,Dt.minX,Dt.maxX,Ve),J=null,Zr&&(xn=zt(Zr,Jt,be-Jr,be+ci,1,Dt.minY,Dt.maxY,Ve),Bt=zt(Zr,Jt,be+bi,be+Ci,1,Dt.minY,Dt.maxY,Ve),Zr=null),gi&&(ln=zt(gi,Jt,be-Jr,be+ci,1,Dt.minY,Dt.maxY,Ve),Wr=zt(gi,Jt,be+bi,be+Ci,1,Dt.minY,Dt.maxY,Ve),gi=null),mt>1&&console.timeEnd("clipping"),ge.push(xn||[],ae+1,2*ce,2*be),ge.push(Bt||[],ae+1,2*ce,2*be+1),ge.push(ln||[],ae+1,2*ce+1,2*be),ge.push(Wr||[],ae+1,2*ce+1,2*be+1)}}},mu.prototype.getTile=function(J,ae,ce){var be=this.options,Be=be.extent,et=be.debug;if(J<0||J>24)return null;var ot=1<<J,ge=iu(J,ae=(ae%ot+ot)%ot,ce);if(this.tiles[ge])return ca(this.tiles[ge],Be);et>1&&console.log("drilling down to z%d-%d-%d",J,ae,ce);for(var Ve,mt=J,Jt=ae,Cr=ce;!Ve&&mt>0;)mt--,Jt=Math.floor(Jt/2),Cr=Math.floor(Cr/2),Ve=this.tiles[iu(mt,Jt,Cr)];return Ve&&Ve.source?(et>1&&console.log("found parent tile z%d-%d-%d",mt,Jt,Cr),et>1&&console.time("drilling down"),this.splitTile(Ve.source,mt,Jt,Cr,J,ae,ce),et>1&&console.timeEnd("drilling down"),this.tiles[ge]?ca(this.tiles[ge],Be):null):null};var Fu=function(J){function ae(ce,be,Be,et){J.call(this,ce,be,Be,pf),et&&(this.loadGeoJSON=et)}return J&&(ae.__proto__=J),(ae.prototype=Object.create(J&&J.prototype)).constructor=ae,ae.prototype.loadData=function(ce,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=be,this._pendingLoadDataParams=ce,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ae.prototype._loadData=function(){var ce=this;if(this._pendingCallback&&this._pendingLoadDataParams){var be=this._pendingCallback,Be=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var et=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new o.RequestPerformance(Be.request);this.loadGeoJSON(Be,function(ot,ge){if(ot||!ge)return be(ot);if(typeof ge!="object")return be(new Error("Input data given to '"+Be.source+"' is not a valid GeoJSON object."));(function Dt(pr,Nr){var xn,Bt=pr&&pr.type;if(Bt==="FeatureCollection")for(xn=0;xn<pr.features.length;xn++)Dt(pr.features[xn],Nr);else if(Bt==="GeometryCollection")for(xn=0;xn<pr.geometries.length;xn++)Dt(pr.geometries[xn],Nr);else if(Bt==="Feature")Dt(pr.geometry,Nr);else if(Bt==="Polygon")j(pr.coordinates,Nr);else if(Bt==="MultiPolygon")for(xn=0;xn<pr.coordinates.length;xn++)j(pr.coordinates[xn],Nr);return pr})(ge,!0);try{if(Be.filter){var Ve=o.createExpression(Be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(function(Dt){return Dt.key+": "+Dt.message}).join(", "));var mt=ge.features.filter(function(Dt){return Ve.value.evaluate({zoom:0},Dt)});ge={type:"FeatureCollection",features:mt}}ce._geoJSONIndex=Be.cluster?new Ti(function(Dt){var pr=Dt.superclusterOptions,Nr=Dt.clusterProperties;if(!Nr||!pr)return pr;for(var xn={},Bt={},ln={accumulated:null,zoom:0},Wr={properties:null},Zr=Object.keys(Nr),gi=0,Jr=Zr;gi<Jr.length;gi+=1){var bi=Jr[gi],ci=Nr[bi],Ci=ci[0],Fi=o.createExpression(ci[1]),Di=o.createExpression(typeof Ci=="string"?[Ci,["accumulated"],["get",bi]]:Ci);xn[bi]=Fi.value,Bt[bi]=Di.value}return pr.map=function(ls){Wr.properties=ls;for(var sa={},Zi=0,ia=Zr;Zi<ia.length;Zi+=1){var pi=ia[Zi];sa[pi]=xn[pi].evaluate(ln,Wr)}return sa},pr.reduce=function(ls,sa){Wr.properties=sa;for(var Zi=0,ia=Zr;Zi<ia.length;Zi+=1){var pi=ia[Zi];ln.accumulated=ls[pi],ls[pi]=Bt[pi].evaluate(ln,Wr)}},pr}(Be)).load(ge.features):function(Dt,pr){return new mu(Dt,pr)}(ge,Be.geojsonVtOptions)}catch(Dt){return be(Dt)}ce.loaded={};var Jt={};if(et){var Cr=et.finish();Cr&&(Jt.resourceTiming={},Jt.resourceTiming[Be.source]=JSON.parse(JSON.stringify(Cr)))}be(null,Jt)})}},ae.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ae.prototype.reloadTile=function(ce,be){var Be=this.loaded;return Be&&Be[ce.uid]?J.prototype.reloadTile.call(this,ce,be):this.loadTile(ce,be)},ae.prototype.loadGeoJSON=function(ce,be){if(ce.request)o.getJSON(ce.request,be);else{if(typeof ce.data!="string")return be(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."));try{return be(null,JSON.parse(ce.data))}catch{return be(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."))}}},ae.prototype.removeSource=function(ce,be){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),be()},ae.prototype.getClusterExpansionZoom=function(ce,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(Be){be(Be)}},ae.prototype.getClusterChildren=function(ce,be){try{be(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(Be){be(Be)}},ae.prototype.getClusterLeaves=function(ce,be){try{be(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(Be){be(Be)}},ae}(O),uo=function(J){var ae=this;this.self=J,this.actor=new o.Actor(J,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:O,geojson:Fu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ce,be){if(ae.workerSourceTypes[ce])throw new Error('Worker source with name "'+ce+'" already registered.');ae.workerSourceTypes[ce]=be},this.self.registerRTLTextPlugin=function(ce){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ce.applyArabicShaping,o.plugin.processBidirectionalText=ce.processBidirectionalText,o.plugin.processStyledBidirectionalText=ce.processStyledBidirectionalText}};return uo.prototype.setReferrer=function(J,ae){this.referrer=ae},uo.prototype.setImages=function(J,ae,ce){for(var be in this.availableImages[J]=ae,this.workerSources[J]){var Be=this.workerSources[J][be];for(var et in Be)Be[et].availableImages=ae}ce()},uo.prototype.setLayers=function(J,ae,ce){this.getLayerIndex(J).replace(ae),ce()},uo.prototype.updateLayers=function(J,ae,ce){this.getLayerIndex(J).update(ae.layers,ae.removedIds),ce()},uo.prototype.loadTile=function(J,ae,ce){this.getWorkerSource(J,ae.type,ae.source).loadTile(ae,ce)},uo.prototype.loadDEMTile=function(J,ae,ce){this.getDEMWorkerSource(J,ae.source).loadTile(ae,ce)},uo.prototype.reloadTile=function(J,ae,ce){this.getWorkerSource(J,ae.type,ae.source).reloadTile(ae,ce)},uo.prototype.abortTile=function(J,ae,ce){this.getWorkerSource(J,ae.type,ae.source).abortTile(ae,ce)},uo.prototype.removeTile=function(J,ae,ce){this.getWorkerSource(J,ae.type,ae.source).removeTile(ae,ce)},uo.prototype.removeDEMTile=function(J,ae){this.getDEMWorkerSource(J,ae.source).removeTile(ae)},uo.prototype.removeSource=function(J,ae,ce){if(this.workerSources[J]&&this.workerSources[J][ae.type]&&this.workerSources[J][ae.type][ae.source]){var be=this.workerSources[J][ae.type][ae.source];delete this.workerSources[J][ae.type][ae.source],be.removeSource!==void 0?be.removeSource(ae,ce):ce()}},uo.prototype.loadWorkerSource=function(J,ae,ce){try{this.self.importScripts(ae.url),ce()}catch(be){ce(be.toString())}},uo.prototype.syncRTLPluginState=function(J,ae,ce){try{o.plugin.setState(ae);var be=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&be!=null){this.self.importScripts(be);var Be=o.plugin.isParsed();ce(Be?void 0:new Error("RTL Text Plugin failed to import scripts from "+be),Be)}}catch(et){ce(et.toString())}},uo.prototype.getAvailableImages=function(J){var ae=this.availableImages[J];return ae||(ae=[]),ae},uo.prototype.getLayerIndex=function(J){var ae=this.layerIndexes[J];return ae||(ae=this.layerIndexes[J]=new p),ae},uo.prototype.getWorkerSource=function(J,ae,ce){var be=this;return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][ae]||(this.workerSources[J][ae]={}),this.workerSources[J][ae][ce]||(this.workerSources[J][ae][ce]=new this.workerSourceTypes[ae]({send:function(Be,et,ot){be.actor.send(Be,et,ot,J)}},this.getLayerIndex(J),this.getAvailableImages(J))),this.workerSources[J][ae][ce]},uo.prototype.getDEMWorkerSource=function(J,ae){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][ae]||(this.demWorkerSources[J][ae]=new z),this.demWorkerSources[J][ae]},uo.prototype.enforceCacheSizeLimit=function(J,ae){o.enforceCacheSizeLimit(ae)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new uo(self)),uo}),a(["./shared"],function(o){var l=o.createCommonjsModule(function(d){function g(T){return!v(T)}function v(T){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var F,U,X=new Blob([""],{type:"text/javascript"}),re=URL.createObjectURL(X);try{U=new Worker(re),F=!0}catch{F=!1}return U&&U.terminate(),URL.revokeObjectURL(re),F}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var F=document.createElement("canvas");F.width=F.height=1;var U=F.getContext("2d");if(!U)return!1;var X=U.getImageData(0,0,1,1);return X&&X.width===F.width}()?(x[R=T&&T.failIfMajorPerformanceCaveat]===void 0&&(x[R]=function(F){var U=function(re){var he=document.createElement("canvas"),me=Object.create(g.webGLContextAttributes);return me.failIfMajorPerformanceCaveat=re,he.probablySupportsContext?he.probablySupportsContext("webgl",me)||he.probablySupportsContext("experimental-webgl",me):he.supportsContext?he.supportsContext("webgl",me)||he.supportsContext("experimental-webgl",me):he.getContext("webgl",me)||he.getContext("experimental-webgl",me)}(F);if(!U)return!1;var X=U.createShader(U.VERTEX_SHADER);return!(!X||U.isContextLost())&&(U.shaderSource(X,"void main() {}"),U.compileShader(X),U.getShaderParameter(X,U.COMPILE_STATUS)===!0)}(R)),x[R]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var R}d.exports?d.exports=g:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=g,window.mapboxgl.notSupportedReason=v);var x={};g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),c={create:function(d,g,v){var x=o.window.document.createElement(d);return g!==void 0&&(x.className=g),v&&v.appendChild(x),x},createNS:function(d,g){return o.window.document.createElementNS(d,g)}},p=o.window.document&&o.window.document.documentElement.style;function y(d){if(!p)return d[0];for(var g=0;g<d.length;g++)if(d[g]in p)return d[g];return d[0]}var b,w=y(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);c.disableDrag=function(){p&&w&&(b=p[w],p[w]="none")},c.enableDrag=function(){p&&w&&(p[w]=b)};var M=y(["transform","WebkitTransform"]);c.setTransform=function(d,g){d.style[M]=g};var O=!1;try{var N=Object.defineProperty({},"passive",{get:function(){O=!0}});o.window.addEventListener("test",N,N),o.window.removeEventListener("test",N,N)}catch{O=!1}c.addEventListener=function(d,g,v,x){x===void 0&&(x={}),d.addEventListener(g,v,"passive"in x&&O?x:x.capture)},c.removeEventListener=function(d,g,v,x){x===void 0&&(x={}),d.removeEventListener(g,v,"passive"in x&&O?x:x.capture)};var z=function(d){d.preventDefault(),d.stopPropagation(),o.window.removeEventListener("click",z,!0)};function j(d){var g=d.userImage;return!!(g&&g.render&&g.render())&&(d.data.replace(new Uint8Array(g.data.buffer)),!0)}c.suppressClick=function(){o.window.addEventListener("click",z,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",z,!0)},0)},c.mousePos=function(d,g){var v=d.getBoundingClientRect();return new o.Point(g.clientX-v.left-d.clientLeft,g.clientY-v.top-d.clientTop)},c.touchPos=function(d,g){for(var v=d.getBoundingClientRect(),x=[],T=0;T<g.length;T++)x.push(new o.Point(g[T].clientX-v.left-d.clientLeft,g[T].clientY-v.top-d.clientTop));return x},c.mouseButton=function(d){return o.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button},c.remove=function(d){d.parentNode&&d.parentNode.removeChild(d)};var Y=function(d){function g(){d.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.isLoaded=function(){return this.loaded},g.prototype.setLoaded=function(v){if(this.loaded!==v&&(this.loaded=v,v)){for(var x=0,T=this.requestors;x<T.length;x+=1){var R=T[x];this._notify(R.ids,R.callback)}this.requestors=[]}},g.prototype.getImage=function(v){return this.images[v]},g.prototype.addImage=function(v,x){this._validate(v,x)&&(this.images[v]=x)},g.prototype._validate=function(v,x){var T=!0;return this._validateStretch(x.stretchX,x.data&&x.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+v+'" has invalid "stretchX" value'))),T=!1),this._validateStretch(x.stretchY,x.data&&x.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+v+'" has invalid "stretchY" value'))),T=!1),this._validateContent(x.content,x)||(this.fire(new o.ErrorEvent(new Error('Image "'+v+'" has invalid "content" value'))),T=!1),T},g.prototype._validateStretch=function(v,x){if(!v)return!0;for(var T=0,R=0,F=v;R<F.length;R+=1){var U=F[R];if(U[0]<T||U[1]<U[0]||x<U[1])return!1;T=U[1]}return!0},g.prototype._validateContent=function(v,x){return!(v&&(v.length!==4||v[0]<0||x.data.width<v[0]||v[1]<0||x.data.height<v[1]||v[2]<0||x.data.width<v[2]||v[3]<0||x.data.height<v[3]||v[2]<v[0]||v[3]<v[1]))},g.prototype.updateImage=function(v,x){x.version=this.images[v].version+1,this.images[v]=x,this.updatedImages[v]=!0},g.prototype.removeImage=function(v){var x=this.images[v];delete this.images[v],delete this.patterns[v],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()},g.prototype.listImages=function(){return Object.keys(this.images)},g.prototype.getImages=function(v,x){var T=!0;if(!this.isLoaded())for(var R=0,F=v;R<F.length;R+=1)this.images[F[R]]||(T=!1);this.isLoaded()||T?this._notify(v,x):this.requestors.push({ids:v,callback:x})},g.prototype._notify=function(v,x){for(var T={},R=0,F=v;R<F.length;R+=1){var U=F[R];this.images[U]||this.fire(new o.Event("styleimagemissing",{id:U}));var X=this.images[U];X?T[U]={data:X.data.clone(),pixelRatio:X.pixelRatio,sdf:X.sdf,version:X.version,stretchX:X.stretchX,stretchY:X.stretchY,content:X.content,hasRenderCallback:Boolean(X.userImage&&X.userImage.render)}:o.warnOnce('Image "'+U+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}x(null,T)},g.prototype.getPixelSize=function(){var v=this.atlasImage;return{width:v.width,height:v.height}},g.prototype.getPattern=function(v){var x=this.patterns[v],T=this.getImage(v);if(!T)return null;if(x&&x.position.version===T.version)return x.position;if(x)x.position.version=T.version;else{var R={w:T.data.width+2,h:T.data.height+2,x:0,y:0},F=new o.ImagePosition(R,T);this.patterns[v]={bin:R,position:F}}return this._updatePatternAtlas(),this.patterns[v].position},g.prototype.bind=function(v){var x=v.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(v,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)},g.prototype._updatePatternAtlas=function(){var v=[];for(var x in this.patterns)v.push(this.patterns[x].bin);var T=o.potpack(v),R=T.w,F=T.h,U=this.atlasImage;for(var X in U.resize({width:R||1,height:F||1}),this.patterns){var re=this.patterns[X].bin,he=re.x+1,me=re.y+1,xe=this.images[X].data,Ne=xe.width,Fe=xe.height;o.RGBAImage.copy(xe,U,{x:0,y:0},{x:he,y:me},{width:Ne,height:Fe}),o.RGBAImage.copy(xe,U,{x:0,y:Fe-1},{x:he,y:me-1},{width:Ne,height:1}),o.RGBAImage.copy(xe,U,{x:0,y:0},{x:he,y:me+Fe},{width:Ne,height:1}),o.RGBAImage.copy(xe,U,{x:Ne-1,y:0},{x:he-1,y:me},{width:1,height:Fe}),o.RGBAImage.copy(xe,U,{x:0,y:0},{x:he+Ne,y:me},{width:1,height:Fe})}this.dirty=!0},g.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},g.prototype.dispatchRenderCallbacks=function(v){for(var x=0,T=v;x<T.length;x+=1){var R=T[x];if(!this.callbackDispatchedThisFrame[R]){this.callbackDispatchedThisFrame[R]=!0;var F=this.images[R];j(F)&&this.updateImage(R,F)}}},g}(o.Evented),K=Se,ie=Se,le=1e20;function Se(d,g,v,x,T,R){this.fontSize=d||24,this.buffer=g===void 0?3:g,this.cutoff=x||.25,this.fontFamily=T||"sans-serif",this.fontWeight=R||"normal",this.radius=v||8;var F=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=F,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.d=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Int16Array(F),this.middle=Math.round(F/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ze(d,g,v,x,T,R,F){for(var U=0;U<g;U++){for(var X=0;X<v;X++)x[X]=d[X*g+U];for(ue(x,T,R,F,v),X=0;X<v;X++)d[X*g+U]=T[X]}for(X=0;X<v;X++){for(U=0;U<g;U++)x[U]=d[X*g+U];for(ue(x,T,R,F,g),U=0;U<g;U++)d[X*g+U]=Math.sqrt(T[U])}}function ue(d,g,v,x,T){v[0]=0,x[0]=-le,x[1]=+le;for(var R=1,F=0;R<T;R++){for(var U=(d[R]+R*R-(d[v[F]]+v[F]*v[F]))/(2*R-2*v[F]);U<=x[F];)F--,U=(d[R]+R*R-(d[v[F]]+v[F]*v[F]))/(2*R-2*v[F]);v[++F]=R,x[F]=U,x[F+1]=+le}for(R=0,F=0;R<T;R++){for(;x[F+1]<R;)F++;g[R]=(R-v[F])*(R-v[F])+d[v[F]]}}Se.prototype.draw=function(d){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(d,this.buffer,this.middle);for(var g=this.ctx.getImageData(0,0,this.size,this.size),v=new Uint8ClampedArray(this.size*this.size),x=0;x<this.size*this.size;x++){var T=g.data[4*x+3]/255;this.gridOuter[x]=T===1?0:T===0?le:Math.pow(Math.max(0,.5-T),2),this.gridInner[x]=T===1?le:T===0?0:Math.pow(Math.max(0,T-.5),2)}for(ze(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ze(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),x=0;x<this.size*this.size;x++)v[x]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[x]-this.gridInner[x])/this.radius+this.cutoff))));return v},K.default=ie;var Ke=function(d,g){this.requestManager=d,this.localIdeographFontFamily=g,this.entries={}};Ke.prototype.setURL=function(d){this.url=d},Ke.prototype.getGlyphs=function(d,g){var v=this,x=[];for(var T in d)for(var R=0,F=d[T];R<F.length;R+=1)x.push({stack:T,id:F[R]});o.asyncAll(x,function(U,X){var re=U.stack,he=U.id,me=v.entries[re];me||(me=v.entries[re]={glyphs:{},requests:{},ranges:{}});var xe=me.glyphs[he];if(xe===void 0){if(xe=v._tinySDF(me,re,he))return me.glyphs[he]=xe,void X(null,{stack:re,id:he,glyph:xe});var Ne=Math.floor(he/256);if(256*Ne>65535)X(new Error("glyphs > 65535 not supported"));else if(me.ranges[Ne])X(null,{stack:re,id:he,glyph:xe});else{var Fe=me.requests[Ne];Fe||(Fe=me.requests[Ne]=[],Ke.loadGlyphRange(re,Ne,v.url,v.requestManager,function(qe,Re){if(Re){for(var Ze in Re)v._doesCharSupportLocalGlyph(+Ze)||(me.glyphs[+Ze]=Re[+Ze]);me.ranges[Ne]=!0}for(var at=0,ht=Fe;at<ht.length;at+=1)(0,ht[at])(qe,Re);delete me.requests[Ne]})),Fe.push(function(qe,Re){qe?X(qe):Re&&X(null,{stack:re,id:he,glyph:Re[he]||null})})}}else X(null,{stack:re,id:he,glyph:xe})},function(U,X){if(U)g(U);else if(X){for(var re={},he=0,me=X;he<me.length;he+=1){var xe=me[he],Ne=xe.stack,Fe=xe.id,qe=xe.glyph;(re[Ne]||(re[Ne]={}))[Fe]=qe&&{id:qe.id,bitmap:qe.bitmap.clone(),metrics:qe.metrics}}g(null,re)}})},Ke.prototype._doesCharSupportLocalGlyph=function(d){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](d)||o.isChar["Hangul Syllables"](d)||o.isChar.Hiragana(d)||o.isChar.Katakana(d))},Ke.prototype._tinySDF=function(d,g,v){var x=this.localIdeographFontFamily;if(x&&this._doesCharSupportLocalGlyph(v)){var T=d.tinySDF;if(!T){var R="400";/bold/i.test(g)?R="900":/medium/i.test(g)?R="500":/light/i.test(g)&&(R="200"),T=d.tinySDF=new Ke.TinySDF(24,3,8,.25,x,R)}return{id:v,bitmap:new o.AlphaImage({width:30,height:30},T.draw(String.fromCharCode(v))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ke.loadGlyphRange=function(d,g,v,x,T){var R=256*g,F=R+255,U=x.transformRequest(x.normalizeGlyphsURL(v).replace("{fontstack}",d).replace("{range}",R+"-"+F),o.ResourceType.Glyphs);o.getArrayBuffer(U,function(X,re){if(X)T(X);else if(re){for(var he={},me=0,xe=o.parseGlyphPBF(re);me<xe.length;me+=1){var Ne=xe[me];he[Ne.id]=Ne}T(null,he)}})},Ke.TinySDF=K;var ke=function(){this.specification=o.styleSpec.light.position};ke.prototype.possiblyEvaluate=function(d,g){return o.sphericalToCartesian(d.expression.evaluate(g))},ke.prototype.interpolate=function(d,g,v){return{x:o.number(d.x,g.x,v),y:o.number(d.y,g.y,v),z:o.number(d.z,g.z,v)}};var Ce=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new ke,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),je=function(d){function g(v){d.call(this),this._transitionable=new o.Transitionable(Ce),this.setLight(v),this._transitioning=this._transitionable.untransitioned()}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getLight=function(){return this._transitionable.serialize()},g.prototype.setLight=function(v,x){if(x===void 0&&(x={}),!this._validate(o.validateLight,v,x))for(var T in v){var R=v[T];o.endsWith(T,"-transition")?this._transitionable.setTransition(T.slice(0,-11),R):this._transitionable.setValue(T,R)}},g.prototype.updateTransitions=function(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)},g.prototype.hasTransition=function(){return this._transitioning.hasTransition()},g.prototype.recalculate=function(v){this.properties=this._transitioning.possiblyEvaluate(v)},g.prototype._validate=function(v,x,T){return(!T||T.validate!==!1)&&o.emitValidationErrors(this,v.call(o.validateStyle,o.extend({value:x,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},g}(o.Evented),ve=function(d,g){this.width=d,this.height=g,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ve.prototype.getDash=function(d,g){var v=d.join(",")+String(g);return this.dashEntry[v]||(this.dashEntry[v]=this.addDash(d,g)),this.dashEntry[v]},ve.prototype.getDashRanges=function(d,g,v){var x=[],T=d.length%2==1?-d[d.length-1]*v:0,R=d[0]*v,F=!0;x.push({left:T,right:R,isDash:F,zeroLength:d[0]===0});for(var U=d[0],X=1;X<d.length;X++){var re=d[X];x.push({left:T=U*v,right:R=(U+=re)*v,isDash:F=!F,zeroLength:re===0})}return x},ve.prototype.addRoundDash=function(d,g,v){for(var x=g/2,T=-v;T<=v;T++)for(var R=this.width*(this.nextRow+v+T),F=0,U=d[F],X=0;X<this.width;X++){X/U.right>1&&(U=d[++F]);var re=Math.abs(X-U.left),he=Math.abs(X-U.right),me=Math.min(re,he),xe=void 0,Ne=T/v*(x+1);if(U.isDash){var Fe=x-Math.abs(Ne);xe=Math.sqrt(me*me+Fe*Fe)}else xe=x-Math.sqrt(me*me+Ne*Ne);this.data[R+X]=Math.max(0,Math.min(255,xe+128))}},ve.prototype.addRegularDash=function(d){for(var g=d.length-1;g>=0;--g){var v=d[g],x=d[g+1];v.zeroLength?d.splice(g,1):x&&x.isDash===v.isDash&&(x.left=v.left,d.splice(g,1))}var T=d[0],R=d[d.length-1];T.isDash===R.isDash&&(T.left=R.left-this.width,R.right=T.right+this.width);for(var F=this.width*this.nextRow,U=0,X=d[U],re=0;re<this.width;re++){re/X.right>1&&(X=d[++U]);var he=Math.abs(re-X.left),me=Math.abs(re-X.right),xe=Math.min(he,me);this.data[F+re]=Math.max(0,Math.min(255,(X.isDash?xe:-xe)+128))}},ve.prototype.addDash=function(d,g){var v=g?7:0,x=2*v+1;if(this.nextRow+x>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var T=0,R=0;R<d.length;R++)T+=d[R];if(T!==0){var F=this.width/T,U=this.getDashRanges(d,this.width,F);g?this.addRoundDash(U,F,v):this.addRegularDash(U)}var X={y:(this.nextRow+v+.5)/this.height,height:2*v/this.height,width:T};return this.nextRow+=x,this.dirty=!0,X},ve.prototype.bind=function(d){var g=d.gl;this.texture?(g.bindTexture(g.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.width,this.height,g.ALPHA,g.UNSIGNED_BYTE,this.data))):(this.texture=g.createTexture(),g.bindTexture(g.TEXTURE_2D,this.texture),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.REPEAT),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texImage2D(g.TEXTURE_2D,0,g.ALPHA,this.width,this.height,0,g.ALPHA,g.UNSIGNED_BYTE,this.data))};var Ie=function d(g,v){this.workerPool=g,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var x=this.workerPool.acquire(this.id),T=0;T<x.length;T++){var R=new d.Actor(x[T],v,this.id);R.name="Worker "+T,this.actors.push(R)}};function dt(d,g,v){var x=function(T,R){if(T)return v(T);if(R){var F=o.pick(o.extend(R,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(F.vectorLayers=R.vector_layers,F.vectorLayerIds=F.vectorLayers.map(function(U){return U.id})),F.tiles=g.canonicalizeTileset(F,d.url),v(null,F)}};return d.url?o.getJSON(g.transformRequest(g.normalizeSourceURL(d.url),o.ResourceType.Source),x):o.browser.frame(function(){return x(null,d)})}Ie.prototype.broadcast=function(d,g,v){o.asyncAll(this.actors,function(x,T){x.send(d,g,T)},v=v||function(){})},Ie.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ie.prototype.remove=function(){this.actors.forEach(function(d){d.remove()}),this.actors=[],this.workerPool.release(this.id)},Ie.Actor=o.Actor;var St=function(d,g,v){this.bounds=o.LngLatBounds.convert(this.validateBounds(d)),this.minzoom=g||0,this.maxzoom=v||24};St.prototype.validateBounds=function(d){return Array.isArray(d)&&d.length===4?[Math.max(-180,d[0]),Math.max(-90,d[1]),Math.min(180,d[2]),Math.min(90,d[3])]:[-180,-90,180,90]},St.prototype.contains=function(d){var g=Math.pow(2,d.z),v=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*g),x=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*g),T=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*g),R=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*g);return d.x>=v&&d.x<T&&d.y>=x&&d.y<R};var Rt=function(d){function g(v,x,T,R){if(d.call(this),this.id=v,this.dispatcher=T,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(x,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(R)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(){var v=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,function(x,T){v._tileJSONRequest=null,v._loaded=!0,x?v.fire(new o.ErrorEvent(x)):T&&(o.extend(v,T),T.bounds&&(v.tileBounds=new St(T.bounds,v.minzoom,v.maxzoom)),o.postTurnstileEvent(T.tiles,v.map._requestManager._customAccessToken),o.postMapLoadEvent(T.tiles,v.map._getMapId(),v.map._requestManager._skuToken,v.map._requestManager._customAccessToken),v.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),v.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},g.prototype.loaded=function(){return this._loaded},g.prototype.hasTile=function(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)},g.prototype.onAdd=function(v){this.map=v,this.load()},g.prototype.setSourceProperty=function(v){this._tileJSONRequest&&this._tileJSONRequest.cancel(),v(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},g.prototype.setTiles=function(v){var x=this;return this.setSourceProperty(function(){x._options.tiles=v}),this},g.prototype.setUrl=function(v){var x=this;return this.setSourceProperty(function(){x.url=v,x._options.url=v}),this},g.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},g.prototype.serialize=function(){return o.extend({},this._options)},g.prototype.loadTile=function(v,x){var T=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),R={request:this.map._requestManager.transformRequest(T,o.ResourceType.Tile),uid:v.uid,tileID:v.tileID,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function F(U,X){return delete v.request,v.aborted?x(null):U&&U.status!==404?x(U):(X&&X.resourceTiming&&(v.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&v.setExpiryData(X),v.loadVectorData(X,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),x(null),void(v.reloadCallback&&(this.loadTile(v,v.reloadCallback),v.reloadCallback=null)))}R.request.collectResourceTiming=this._collectResourceTiming,v.actor&&v.state!=="expired"?v.state==="loading"?v.reloadCallback=x:v.request=v.actor.send("reloadTile",R,F.bind(this)):(v.actor=this.dispatcher.getActor(),v.request=v.actor.send("loadTile",R,F.bind(this)))},g.prototype.abortTile=function(v){v.request&&(v.request.cancel(),delete v.request),v.actor&&v.actor.send("abortTile",{uid:v.uid,type:this.type,source:this.id},void 0)},g.prototype.unloadTile=function(v){v.unloadVectorData(),v.actor&&v.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id},void 0)},g.prototype.hasTransition=function(){return!1},g}(o.Evented),$t=function(d){function g(v,x,T,R){d.call(this),this.id=v,this.dispatcher=T,this.setEventedParent(R),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},x),o.extend(this,o.pick(x,["url","scheme","tileSize"]))}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(){var v=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,function(x,T){v._tileJSONRequest=null,v._loaded=!0,x?v.fire(new o.ErrorEvent(x)):T&&(o.extend(v,T),T.bounds&&(v.tileBounds=new St(T.bounds,v.minzoom,v.maxzoom)),o.postTurnstileEvent(T.tiles),o.postMapLoadEvent(T.tiles,v.map._getMapId(),v.map._requestManager._skuToken),v.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),v.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},g.prototype.loaded=function(){return this._loaded},g.prototype.onAdd=function(v){this.map=v,this.load()},g.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},g.prototype.serialize=function(){return o.extend({},this._options)},g.prototype.hasTile=function(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)},g.prototype.loadTile=function(v,x){var T=this,R=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);v.request=o.getImage(this.map._requestManager.transformRequest(R,o.ResourceType.Tile),function(F,U){if(delete v.request,v.aborted)v.state="unloaded",x(null);else if(F)v.state="errored",x(F);else if(U){T.map._refreshExpiredTiles&&v.setExpiryData(U),delete U.cacheControl,delete U.expires;var X=T.map.painter.context,re=X.gl;v.texture=T.map.painter.getTileTexture(U.width),v.texture?v.texture.update(U,{useMipmap:!0}):(v.texture=new o.Texture(X,U,re.RGBA,{useMipmap:!0}),v.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),X.extTextureFilterAnisotropic&&re.texParameterf(re.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),v.state="loaded",o.cacheEntryPossiblyAdded(T.dispatcher),x(null)}})},g.prototype.abortTile=function(v,x){v.request&&(v.request.cancel(),delete v.request),x()},g.prototype.unloadTile=function(v,x){v.texture&&this.map.painter.saveTileTexture(v.texture),x()},g.prototype.hasTransition=function(){return!1},g}(o.Evented),gt=function(d){function g(v,x,T,R){d.call(this,v,x,T,R),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox"}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},g.prototype.loadTile=function(v,x){var T=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function R(F,U){F&&(v.state="errored",x(F)),U&&(v.dem=U,v.needsHillshadePrepare=!0,v.state="loaded",x(null))}v.request=o.getImage(this.map._requestManager.transformRequest(T,o.ResourceType.Tile),function(F,U){if(delete v.request,v.aborted)v.state="unloaded",x(null);else if(F)v.state="errored",x(F);else if(U){this.map._refreshExpiredTiles&&v.setExpiryData(U),delete U.cacheControl,delete U.expires;var X=o.window.ImageBitmap&&U instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?U:o.browser.getImageData(U,1),re={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:X,encoding:this.encoding};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",re,R.bind(this)))}}.bind(this)),v.neighboringTiles=this._getNeighboringTiles(v.tileID)},g.prototype._getNeighboringTiles=function(v){var x=v.canonical,T=Math.pow(2,x.z),R=(x.x-1+T)%T,F=x.x===0?v.wrap-1:v.wrap,U=(x.x+1+T)%T,X=x.x+1===T?v.wrap+1:v.wrap,re={};return re[new o.OverscaledTileID(v.overscaledZ,F,x.z,R,x.y).key]={backfilled:!1},re[new o.OverscaledTileID(v.overscaledZ,X,x.z,U,x.y).key]={backfilled:!1},x.y>0&&(re[new o.OverscaledTileID(v.overscaledZ,F,x.z,R,x.y-1).key]={backfilled:!1},re[new o.OverscaledTileID(v.overscaledZ,v.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},re[new o.OverscaledTileID(v.overscaledZ,X,x.z,U,x.y-1).key]={backfilled:!1}),x.y+1<T&&(re[new o.OverscaledTileID(v.overscaledZ,F,x.z,R,x.y+1).key]={backfilled:!1},re[new o.OverscaledTileID(v.overscaledZ,v.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},re[new o.OverscaledTileID(v.overscaledZ,X,x.z,U,x.y+1).key]={backfilled:!1}),re},g.prototype.unloadTile=function(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded",v.actor&&v.actor.send("removeDEMTile",{uid:v.uid,source:this.id})},g}($t),jr=function(d){function g(v,x,T,R){d.call(this),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=T.getActor(),this.setEventedParent(R),this._data=x.data,this._options=o.extend({},x),this._collectResourceTiming=x.collectResourceTiming,this._resourceTiming=[],x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;var F=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*F,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*F,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?Math.min(x.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:o.EXTENT,radius:(x.clusterRadius||50)*F,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(){var v=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)v.fire(new o.ErrorEvent(x));else{var T={dataType:"source",sourceDataType:"metadata"};v._collectResourceTiming&&v._resourceTiming&&v._resourceTiming.length>0&&(T.resourceTiming=v._resourceTiming,v._resourceTiming=[]),v.fire(new o.Event("data",T))}})},g.prototype.onAdd=function(v){this.map=v,this.load()},g.prototype.setData=function(v){var x=this;return this._data=v,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(T){if(T)x.fire(new o.ErrorEvent(T));else{var R={dataType:"source",sourceDataType:"content"};x._collectResourceTiming&&x._resourceTiming&&x._resourceTiming.length>0&&(R.resourceTiming=x._resourceTiming,x._resourceTiming=[]),x.fire(new o.Event("data",R))}}),this},g.prototype.getClusterExpansionZoom=function(v,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},x),this},g.prototype.getClusterChildren=function(v,x){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},x),this},g.prototype.getClusterLeaves=function(v,x,T,R){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:x,offset:T},R),this},g.prototype._updateWorkerData=function(v){var x=this;this._loaded=!1;var T=o.extend({},this.workerOptions),R=this._data;typeof R=="string"?(T.request=this.map._requestManager.transformRequest(o.browser.resolveURL(R),o.ResourceType.Source),T.request.collectResourceTiming=this._collectResourceTiming):T.data=JSON.stringify(R),this.actor.send(this.type+".loadData",T,function(F,U){x._removed||U&&U.abandoned||(x._loaded=!0,U&&U.resourceTiming&&U.resourceTiming[x.id]&&(x._resourceTiming=U.resourceTiming[x.id].slice(0)),x.actor.send(x.type+".coalesce",{source:T.source},null),v(F))})},g.prototype.loaded=function(){return this._loaded},g.prototype.loadTile=function(v,x){var T=this,R=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(R,{type:this.type,uid:v.uid,tileID:v.tileID,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(F,U){return delete v.request,v.unloadVectorData(),v.aborted?x(null):F?x(F):(v.loadVectorData(U,T.map.painter,R==="reloadTile"),x(null))})},g.prototype.abortTile=function(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0},g.prototype.unloadTile=function(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})},g.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},g.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},g.prototype.hasTransition=function(){return!1},g}(o.Evented),Er=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),rn=function(d){function g(v,x,T,R){d.call(this),this.id=v,this.dispatcher=T,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(R),this.options=x}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(v,x){var T=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(R,F){T._loaded=!0,R?T.fire(new o.ErrorEvent(R)):F&&(T.image=F,v&&(T.coordinates=v),x&&x(),T._finishLoading())})},g.prototype.loaded=function(){return this._loaded},g.prototype.updateImage=function(v){var x=this;return this.image&&v.url?(this.options.url=v.url,this.load(v.coordinates,function(){x.texture=null}),this):this},g.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},g.prototype.onAdd=function(v){this.map=v,this.load()},g.prototype.setCoordinates=function(v){var x=this;this.coordinates=v;var T=v.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(F){for(var U=1/0,X=1/0,re=-1/0,he=-1/0,me=0,xe=F;me<xe.length;me+=1){var Ne=xe[me];U=Math.min(U,Ne.x),X=Math.min(X,Ne.y),re=Math.max(re,Ne.x),he=Math.max(he,Ne.y)}var Fe=Math.max(re-U,he-X),qe=Math.max(0,Math.floor(-Math.log(Fe)/Math.LN2)),Re=Math.pow(2,qe);return new o.CanonicalTileID(qe,Math.floor((U+re)/2*Re),Math.floor((X+he)/2*Re))}(T),this.minzoom=this.maxzoom=this.tileID.z;var R=T.map(function(F){return x.tileID.getTilePoint(F)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(R[0].x,R[0].y,0,0),this._boundsArray.emplaceBack(R[1].x,R[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(R[3].x,R[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(R[2].x,R[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},g.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var v=this.map.painter.context,x=v.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Er.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(v,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE)),this.tiles){var R=this.tiles[T];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},g.prototype.loadTile=function(v,x){this.tileID&&this.tileID.equals(v.tileID.canonical)?(this.tiles[String(v.tileID.wrap)]=v,v.buckets={},x(null)):(v.state="errored",x(null))},g.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},g.prototype.hasTransition=function(){return!1},g}(o.Evented),dn=function(d){function g(v,x,T,R){d.call(this,v,x,T,R),this.roundZoom=!0,this.type="video",this.options=x}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(){var v=this;this._loaded=!1;var x=this.options;this.urls=[];for(var T=0,R=x.urls;T<R.length;T+=1)this.urls.push(this.map._requestManager.transformRequest(R[T],o.ResourceType.Source).url);o.getVideo(this.urls,function(F,U){v._loaded=!0,F?v.fire(new o.ErrorEvent(F)):U&&(v.video=U,v.video.loop=!0,v.video.addEventListener("playing",function(){v.map.triggerRepaint()}),v.map&&v.video.play(),v._finishLoading())})},g.prototype.pause=function(){this.video&&this.video.pause()},g.prototype.play=function(){this.video&&this.video.play()},g.prototype.seek=function(v){if(this.video){var x=this.video.seekable;v<x.start(0)||v>x.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+x.start(0)+" and "+x.end(0)+"-second mark."))):this.video.currentTime=v}},g.prototype.getVideo=function(){return this.video},g.prototype.onAdd=function(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},g.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var v=this.map.painter.context,x=v.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Er.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(v,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE)),this.tiles){var R=this.tiles[T];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},g.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},g.prototype.hasTransition=function(){return this.video&&!this.video.paused},g}(rn),Rn=function(d){function g(v,x,T,R){d.call(this,v,x,T,R),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(function(F){return!Array.isArray(F)||F.length!==2||F.some(function(U){return typeof U!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+v,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+v,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+v,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+v,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+v,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},g.prototype.getCanvas=function(){return this.canvas},g.prototype.onAdd=function(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()},g.prototype.onRemove=function(){this.pause()},g.prototype.prepare=function(){var v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var x=this.map.painter.context,T=x.gl;for(var R in this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,Er.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(x,this.canvas,T.RGBA,{premultiply:!0}),this.tiles){var F=this.tiles[R];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}}},g.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},g.prototype.hasTransition=function(){return this._playing},g.prototype._hasInvalidDimensions=function(){for(var v=0,x=[this.canvas.width,this.canvas.height];v<x.length;v+=1){var T=x[v];if(isNaN(T)||T<=0)return!0}return!1},g}(rn),Ar={vector:Rt,raster:$t,"raster-dem":gt,geojson:jr,video:dn,image:rn,canvas:Rn};function xa(d,g){var v=o.identity([]);return o.translate(v,v,[1,1,0]),o.scale(v,v,[.5*d.width,.5*d.height,1]),o.multiply(v,v,d.calculatePosMatrix(g.toUnwrapped()))}function Ti(d,g,v,x,T,R){var F=function(qe,Re,Ze){if(qe)for(var at=0,ht=qe;at<ht.length;at+=1){var Ot=Re[ht[at]];if(Ot&&Ot.source===Ze&&Ot.type==="fill-extrusion")return!0}else for(var It in Re){var Ut=Re[It];if(Ut.source===Ze&&Ut.type==="fill-extrusion")return!0}return!1}(T&&T.layers,g,d.id),U=R.maxPitchScaleFactor(),X=d.tilesIn(x,U,F);X.sort(Sa);for(var re=[],he=0,me=X;he<me.length;he+=1){var xe=me[he];re.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(g,v,d._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,T,R,U,xa(d.transform,xe.tileID))})}var Ne=function(qe){for(var Re={},Ze={},at=0,ht=qe;at<ht.length;at+=1){var Ot=ht[at],It=Ot.queryResults,Ut=Ot.wrappedTileID,cr=Ze[Ut]=Ze[Ut]||{};for(var Sr in It)for(var zr=It[Sr],sn=cr[Sr]=cr[Sr]||{},Cn=Re[Sr]=Re[Sr]||[],Dn=0,Nn=zr;Dn<Nn.length;Dn+=1){var ta=Nn[Dn];sn[ta.featureIndex]||(sn[ta.featureIndex]=!0,Cn.push(ta))}}return Re}(re);for(var Fe in Ne)Ne[Fe].forEach(function(qe){var Re=qe.feature,Ze=d.getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=Ze});return Ne}function Sa(d,g){var v=d.tileID,x=g.tileID;return v.overscaledZ-x.overscaledZ||v.canonical.y-x.canonical.y||v.wrap-x.wrap||v.canonical.x-x.canonical.x}var hr=function(d,g){this.max=d,this.onRemove=g,this.reset()};hr.prototype.reset=function(){for(var d in this.data)for(var g=0,v=this.data[d];g<v.length;g+=1){var x=v[g];x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value)}return this.data={},this.order=[],this},hr.prototype.add=function(d,g,v){var x=this,T=d.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);var R={value:g,timeout:void 0};if(v!==void 0&&(R.timeout=setTimeout(function(){x.remove(d,R)},v)),this.data[T].push(R),this.order.push(T),this.order.length>this.max){var F=this._getAndRemoveByKey(this.order[0]);F&&this.onRemove(F)}return this},hr.prototype.has=function(d){return d.wrapped().key in this.data},hr.prototype.getAndRemove=function(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null},hr.prototype._getAndRemoveByKey=function(d){var g=this.data[d].shift();return g.timeout&&clearTimeout(g.timeout),this.data[d].length===0&&delete this.data[d],this.order.splice(this.order.indexOf(d),1),g.value},hr.prototype.getByKey=function(d){var g=this.data[d];return g?g[0].value:null},hr.prototype.get=function(d){return this.has(d)?this.data[d.wrapped().key][0].value:null},hr.prototype.remove=function(d,g){if(!this.has(d))return this;var v=d.wrapped().key,x=g===void 0?0:this.data[v].indexOf(g),T=this.data[v][x];return this.data[v].splice(x,1),T.timeout&&clearTimeout(T.timeout),this.data[v].length===0&&delete this.data[v],this.onRemove(T.value),this.order.splice(this.order.indexOf(v),1),this},hr.prototype.setMaxSize=function(d){for(this.max=d;this.order.length>this.max;){var g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this},hr.prototype.filter=function(d){var g=[];for(var v in this.data)for(var x=0,T=this.data[v];x<T.length;x+=1){var R=T[x];d(R.value)||g.push(R)}for(var F=0,U=g;F<U.length;F+=1){var X=U[F];this.remove(X.value.tileID,X)}};var Dr=function(d,g,v){this.context=d;var x=d.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer};Dr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Dr.prototype.updateData=function(d){var g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,d.arrayBuffer)},Dr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Kn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Wt=function(d,g,v,x){this.length=g.length,this.attributes=v,this.itemSize=g.bytesPerElement,this.dynamicDraw=x,this.context=d;var T=d.gl;this.buffer=T.createBuffer(),d.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete g.arrayBuffer};Wt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Wt.prototype.updateData=function(d){var g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,d.arrayBuffer)},Wt.prototype.enableAttributes=function(d,g){for(var v=0;v<this.attributes.length;v++){var x=g.attributes[this.attributes[v].name];x!==void 0&&d.enableVertexAttribArray(x)}},Wt.prototype.setVertexAttribPointers=function(d,g,v){for(var x=0;x<this.attributes.length;x++){var T=this.attributes[x],R=g.attributes[T.name];R!==void 0&&d.vertexAttribPointer(R,T.components,d[Kn[T.type]],!1,this.itemSize,T.offset+this.itemSize*(v||0))}},Wt.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Me=function(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Me.prototype.get=function(){return this.current},Me.prototype.set=function(d){},Me.prototype.getDefault=function(){return this.default},Me.prototype.setDefault=function(){this.set(this.default)};var Qe=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return o.Color.transparent},g.prototype.set=function(v){var x=this.current;(v.r!==x.r||v.g!==x.g||v.b!==x.b||v.a!==x.a||this.dirty)&&(this.gl.clearColor(v.r,v.g,v.b,v.a),this.current=v,this.dirty=!1)},g}(Me),Ct=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return 1},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.clearDepth(v),this.current=v,this.dirty=!1)},g}(Me),Yt=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return 0},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.clearStencil(v),this.current=v,this.dirty=!1)},g}(Me),qt=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return[!0,!0,!0,!0]},g.prototype.set=function(v){var x=this.current;(v[0]!==x[0]||v[1]!==x[1]||v[2]!==x[2]||v[3]!==x[3]||this.dirty)&&(this.gl.colorMask(v[0],v[1],v[2],v[3]),this.current=v,this.dirty=!1)},g}(Me),_r=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!0},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.depthMask(v),this.current=v,this.dirty=!1)},g}(Me),Pr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return 255},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.stencilMask(v),this.current=v,this.dirty=!1)},g}(Me),xr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},g.prototype.set=function(v){var x=this.current;(v.func!==x.func||v.ref!==x.ref||v.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(v.func,v.ref,v.mask),this.current=v,this.dirty=!1)},g}(Me),kr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){var v=this.gl;return[v.KEEP,v.KEEP,v.KEEP]},g.prototype.set=function(v){var x=this.current;(v[0]!==x[0]||v[1]!==x[1]||v[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(v[0],v[1],v[2]),this.current=v,this.dirty=!1)},g}(Me),vr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;v?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=v,this.dirty=!1}},g}(Me),In=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return[0,1]},g.prototype.set=function(v){var x=this.current;(v[0]!==x[0]||v[1]!==x[1]||this.dirty)&&(this.gl.depthRange(v[0],v[1]),this.current=v,this.dirty=!1)},g}(Me),W=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;v?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=v,this.dirty=!1}},g}(Me),st=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return this.gl.LESS},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.depthFunc(v),this.current=v,this.dirty=!1)},g}(Me),zt=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;v?x.enable(x.BLEND):x.disable(x.BLEND),this.current=v,this.dirty=!1}},g}(Me),mr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){var v=this.gl;return[v.ONE,v.ZERO]},g.prototype.set=function(v){var x=this.current;(v[0]!==x[0]||v[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(v[0],v[1]),this.current=v,this.dirty=!1)},g}(Me),fr=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return o.Color.transparent},g.prototype.set=function(v){var x=this.current;(v.r!==x.r||v.g!==x.g||v.b!==x.b||v.a!==x.a||this.dirty)&&(this.gl.blendColor(v.r,v.g,v.b,v.a),this.current=v,this.dirty=!1)},g}(Me),nn=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return this.gl.FUNC_ADD},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.blendEquation(v),this.current=v,this.dirty=!1)},g}(Me),Mn=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;v?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=v,this.dirty=!1}},g}(Me),Wn=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return this.gl.BACK},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.cullFace(v),this.current=v,this.dirty=!1)},g}(Me),Bn=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return this.gl.CCW},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.frontFace(v),this.current=v,this.dirty=!1)},g}(Me),Mi=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)},g}(Me),mi=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return this.gl.TEXTURE0},g.prototype.set=function(v){(v!==this.current||this.dirty)&&(this.gl.activeTexture(v),this.current=v,this.dirty=!1)},g}(Me),mo=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){var v=this.gl;return[0,0,v.drawingBufferWidth,v.drawingBufferHeight]},g.prototype.set=function(v){var x=this.current;(v[0]!==x[0]||v[1]!==x[1]||v[2]!==x[2]||v[3]!==x[3]||this.dirty)&&(this.gl.viewport(v[0],v[1],v[2],v[3]),this.current=v,this.dirty=!1)},g}(Me),ca=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,v),this.current=v,this.dirty=!1}},g}(Me),Ki=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,v),this.current=v,this.dirty=!1}},g}(Me),yl=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.bindTexture(x.TEXTURE_2D,v),this.current=v,this.dirty=!1}},g}(Me),Xi=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,v),this.current=v,this.dirty=!1}},g}(Me),nu=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){var x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,v),this.current=v,this.dirty=!1},g}(Me),mu=function(d){function g(v){d.call(this,v),this.vao=v.extVertexArrayObject}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g.prototype.set=function(v){this.vao&&(v!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(v),this.current=v,this.dirty=!1)},g}(Me),iu=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return 4},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,v),this.current=v,this.dirty=!1}},g}(Me),pf=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,v),this.current=v,this.dirty=!1}},g}(Me),Fu=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return!1},g.prototype.set=function(v){if(v!==this.current||this.dirty){var x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,v),this.current=v,this.dirty=!1}},g}(Me),uo=function(d){function g(v,x){d.call(this,v),this.context=v,this.parent=x}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getDefault=function(){return null},g}(Me),J=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.setDirty=function(){this.dirty=!0},g.prototype.set=function(v){if(v!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,v,0),this.current=v,this.dirty=!1}},g}(uo),ae=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.set=function(v){if(v!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,v),this.current=v,this.dirty=!1}},g}(uo),ce=function(d,g,v,x){this.context=d,this.width=g,this.height=v;var T=this.framebuffer=d.gl.createFramebuffer();this.colorAttachment=new J(d,T),x&&(this.depthAttachment=new ae(d,T))};ce.prototype.destroy=function(){var d=this.context.gl,g=this.colorAttachment.get();if(g&&d.deleteTexture(g),this.depthAttachment){var v=this.depthAttachment.get();v&&d.deleteRenderbuffer(v)}d.deleteFramebuffer(this.framebuffer)};var be=function(d,g,v){this.func=d,this.mask=g,this.range=v};be.ReadOnly=!1,be.ReadWrite=!0,be.disabled=new be(519,be.ReadOnly,[0,1]);var Be=function(d,g,v,x,T,R){this.test=d,this.ref=g,this.mask=v,this.fail=x,this.depthFail=T,this.pass=R};Be.disabled=new Be({func:519,mask:0},0,0,7680,7680,7680);var et=function(d,g,v){this.blendFunction=d,this.blendColor=g,this.mask=v};et.disabled=new et(et.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),et.unblended=new et(et.Replace,o.Color.transparent,[!0,!0,!0,!0]),et.alphaBlended=new et([1,771],o.Color.transparent,[!0,!0,!0,!0]);var ot=function(d,g,v){this.enable=d,this.mode=g,this.frontFace=v};ot.disabled=new ot(!1,1029,2305),ot.backCCW=new ot(!0,1029,2305);var ge=function(d){this.gl=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Qe(this),this.clearDepth=new Ct(this),this.clearStencil=new Yt(this),this.colorMask=new qt(this),this.depthMask=new _r(this),this.stencilMask=new Pr(this),this.stencilFunc=new xr(this),this.stencilOp=new kr(this),this.stencilTest=new vr(this),this.depthRange=new In(this),this.depthTest=new W(this),this.depthFunc=new st(this),this.blend=new zt(this),this.blendFunc=new mr(this),this.blendColor=new fr(this),this.blendEquation=new nn(this),this.cullFace=new Mn(this),this.cullFaceSide=new Wn(this),this.frontFace=new Bn(this),this.program=new Mi(this),this.activeTexture=new mi(this),this.viewport=new mo(this),this.bindFramebuffer=new ca(this),this.bindRenderbuffer=new Ki(this),this.bindTexture=new yl(this),this.bindVertexBuffer=new Xi(this),this.bindElementBuffer=new nu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mu(this),this.pixelStoreUnpack=new iu(this),this.pixelStoreUnpackPremultiplyAlpha=new pf(this),this.pixelStoreUnpackFlipY=new Fu(this),this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=d.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(d.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE)};ge.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ge.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ge.prototype.createIndexBuffer=function(d,g){return new Dr(this,d,g)},ge.prototype.createVertexBuffer=function(d,g,v){return new Wt(this,d,g,v)},ge.prototype.createRenderbuffer=function(d,g,v){var x=this.gl,T=x.createRenderbuffer();return this.bindRenderbuffer.set(T),x.renderbufferStorage(x.RENDERBUFFER,d,g,v),this.bindRenderbuffer.set(null),T},ge.prototype.createFramebuffer=function(d,g,v){return new ce(this,d,g,v)},ge.prototype.clear=function(d){var g=d.color,v=d.depth,x=this.gl,T=0;g&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(g),this.colorMask.set([!0,!0,!0,!0])),v!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(v),this.depthMask.set(!0)),x.clear(T)},ge.prototype.setCullFace=function(d){d.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(d.mode),this.frontFace.set(d.frontFace))},ge.prototype.setDepthMode=function(d){d.func!==this.gl.ALWAYS||d.mask?(this.depthTest.set(!0),this.depthFunc.set(d.func),this.depthMask.set(d.mask),this.depthRange.set(d.range)):this.depthTest.set(!1)},ge.prototype.setStencilMode=function(d){d.test.func!==this.gl.ALWAYS||d.mask?(this.stencilTest.set(!0),this.stencilMask.set(d.mask),this.stencilOp.set([d.fail,d.depthFail,d.pass]),this.stencilFunc.set({func:d.test.func,ref:d.ref,mask:d.test.mask})):this.stencilTest.set(!1)},ge.prototype.setColorMode=function(d){o.deepEqual(d.blendFunction,et.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(d.blendFunction),this.blendColor.set(d.blendColor)),this.colorMask.set(d.mask)},ge.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ve=function(d){function g(v,x,T){var R=this;d.call(this),this.id=v,this.dispatcher=T,this.on("data",function(F){F.dataType==="source"&&F.sourceDataType==="metadata"&&(R._sourceLoaded=!0),R._sourceLoaded&&!R._paused&&F.dataType==="source"&&F.sourceDataType==="content"&&(R.reload(),R.transform&&R.update(R.transform))}),this.on("error",function(){R._sourceErrored=!0}),this._source=function(F,U,X,re){var he=new Ar[U.type](F,U,X,re);if(he.id!==F)throw new Error("Expected Source id to be "+F+" instead of "+he.id);return o.bindAll(["load","abort","unload","serialize","prepare"],he),he}(v,x,T,this),this._tiles={},this._cache=new hr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.onAdd=function(v){this.map=v,this._maxTileCacheSize=v?v._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(v)},g.prototype.onRemove=function(v){this._source&&this._source.onRemove&&this._source.onRemove(v)},g.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var v in this._tiles){var x=this._tiles[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0},g.prototype.getSource=function(){return this._source},g.prototype.pause=function(){this._paused=!0},g.prototype.resume=function(){if(this._paused){var v=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,v&&this.reload(),this.transform&&this.update(this.transform)}},g.prototype._loadTile=function(v,x){return this._source.loadTile(v,x)},g.prototype._unloadTile=function(v){if(this._source.unloadTile)return this._source.unloadTile(v,function(){})},g.prototype._abortTile=function(v){if(this._source.abortTile)return this._source.abortTile(v,function(){})},g.prototype.serialize=function(){return this._source.serialize()},g.prototype.prepare=function(v){for(var x in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var T=this._tiles[x];T.upload(v),T.prepare(this.map.style.imageManager)}},g.prototype.getIds=function(){return o.values(this._tiles).map(function(v){return v.tileID}).sort(mt).map(function(v){return v.key})},g.prototype.getRenderableIds=function(v){var x=this,T=[];for(var R in this._tiles)this._isIdRenderable(R,v)&&T.push(this._tiles[R]);return v?T.sort(function(F,U){var X=F.tileID,re=U.tileID,he=new o.Point(X.canonical.x,X.canonical.y)._rotate(x.transform.angle),me=new o.Point(re.canonical.x,re.canonical.y)._rotate(x.transform.angle);return X.overscaledZ-re.overscaledZ||me.y-he.y||me.x-he.x}).map(function(F){return F.tileID.key}):T.map(function(F){return F.tileID}).sort(mt).map(function(F){return F.key})},g.prototype.hasRenderableParent=function(v){var x=this.findLoadedParent(v,0);return!!x&&this._isIdRenderable(x.tileID.key)},g.prototype._isIdRenderable=function(v,x){return this._tiles[v]&&this._tiles[v].hasData()&&!this._coveredTiles[v]&&(x||!this._tiles[v].holdingForFade())},g.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var v in this._cache.reset(),this._tiles)this._tiles[v].state!=="errored"&&this._reloadTile(v,"reloading")},g.prototype._reloadTile=function(v,x){var T=this._tiles[v];T&&(T.state!=="loading"&&(T.state=x),this._loadTile(T,this._tileLoaded.bind(this,T,v,x)))},g.prototype._tileLoaded=function(v,x,T,R){if(R)return v.state="errored",void(R.status!==404?this._source.fire(new o.ErrorEvent(R,{tile:v})):this.update(this.transform));v.timeAdded=o.browser.now(),T==="expired"&&(v.refreshedUponExpiration=!0),this._setTileReloadTimer(x,v),this.getSource().type==="raster-dem"&&v.dem&&this._backfillDEM(v),this._state.initializeTileState(v,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:v,coord:v.tileID}))},g.prototype._backfillDEM=function(v){for(var x=this.getRenderableIds(),T=0;T<x.length;T++){var R=x[T];if(v.neighboringTiles&&v.neighboringTiles[R]){var F=this.getTileByID(R);U(v,F),U(F,v)}}function U(X,re){X.needsHillshadePrepare=!0;var he=re.tileID.canonical.x-X.tileID.canonical.x,me=re.tileID.canonical.y-X.tileID.canonical.y,xe=Math.pow(2,X.tileID.canonical.z),Ne=re.tileID.key;he===0&&me===0||Math.abs(me)>1||(Math.abs(he)>1&&(Math.abs(he+xe)===1?he+=xe:Math.abs(he-xe)===1&&(he-=xe)),re.dem&&X.dem&&(X.dem.backfillBorder(re.dem,he,me),X.neighboringTiles&&X.neighboringTiles[Ne]&&(X.neighboringTiles[Ne].backfilled=!0)))}},g.prototype.getTile=function(v){return this.getTileByID(v.key)},g.prototype.getTileByID=function(v){return this._tiles[v]},g.prototype._retainLoadedChildren=function(v,x,T,R){for(var F in this._tiles){var U=this._tiles[F];if(!(R[F]||!U.hasData()||U.tileID.overscaledZ<=x||U.tileID.overscaledZ>T)){for(var X=U.tileID;U&&U.tileID.overscaledZ>x+1;){var re=U.tileID.scaledTo(U.tileID.overscaledZ-1);(U=this._tiles[re.key])&&U.hasData()&&(X=re)}for(var he=X;he.overscaledZ>x;)if(v[(he=he.scaledTo(he.overscaledZ-1)).key]){R[X.key]=X;break}}}},g.prototype.findLoadedParent=function(v,x){if(v.key in this._loadedParentTiles){var T=this._loadedParentTiles[v.key];return T&&T.tileID.overscaledZ>=x?T:null}for(var R=v.overscaledZ-1;R>=x;R--){var F=v.scaledTo(R),U=this._getLoadedTile(F);if(U)return U}},g.prototype._getLoadedTile=function(v){var x=this._tiles[v.key];return x&&x.hasData()?x:this._cache.getByKey(v.wrapped().key)},g.prototype.updateCacheSize=function(v){var x=Math.ceil(v.width/this._source.tileSize)+1,T=Math.ceil(v.height/this._source.tileSize)+1,R=Math.floor(x*T*5),F=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,R):R;this._cache.setMaxSize(F)},g.prototype.handleWrapJump=function(v){var x=Math.round((v-(this._prevLng===void 0?v:this._prevLng))/360);if(this._prevLng=v,x){var T={};for(var R in this._tiles){var F=this._tiles[R];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+x),T[F.tileID.key]=F}for(var U in this._tiles=T,this._timers)clearTimeout(this._timers[U]),delete this._timers[U];for(var X in this._tiles)this._setTileReloadTimer(X,this._tiles[X])}},g.prototype.update=function(v){var x=this;if(this.transform=v,this._sourceLoaded&&!this._paused){var T;this.updateCacheSize(v),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?T=v.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(cr){return new o.OverscaledTileID(cr.canonical.z,cr.wrap,cr.canonical.z,cr.canonical.x,cr.canonical.y)}):(T=v.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(T=T.filter(function(cr){return x._source.hasTile(cr)}))):T=[];var R=v.coveringZoomLevel(this._source),F=Math.max(R-g.maxOverzooming,this._source.minzoom),U=Math.max(R+g.maxUnderzooming,this._source.minzoom),X=this._updateRetainedTiles(T,R);if(Jt(this._source.type)){for(var re={},he={},me=0,xe=Object.keys(X);me<xe.length;me+=1){var Ne=xe[me],Fe=X[Ne],qe=this._tiles[Ne];if(qe&&!(qe.fadeEndTime&&qe.fadeEndTime<=o.browser.now())){var Re=this.findLoadedParent(Fe,F);Re&&(this._addTile(Re.tileID),re[Re.tileID.key]=Re.tileID),he[Ne]=Fe}}for(var Ze in this._retainLoadedChildren(he,R,U,X),re)X[Ze]||(this._coveredTiles[Ze]=!0,X[Ze]=re[Ze])}for(var at in X)this._tiles[at].clearFadeHold();for(var ht=0,Ot=o.keysDifference(this._tiles,X);ht<Ot.length;ht+=1){var It=Ot[ht],Ut=this._tiles[It];Ut.hasSymbolBuckets&&!Ut.holdingForFade()?Ut.setHoldDuration(this.map._fadeDuration):Ut.hasSymbolBuckets&&!Ut.symbolFadeFinished()||this._removeTile(It)}this._updateLoadedParentTileCache()}},g.prototype.releaseSymbolFadeTiles=function(){for(var v in this._tiles)this._tiles[v].holdingForFade()&&this._removeTile(v)},g.prototype._updateRetainedTiles=function(v,x){for(var T={},R={},F=Math.max(x-g.maxOverzooming,this._source.minzoom),U=Math.max(x+g.maxUnderzooming,this._source.minzoom),X={},re=0,he=v;re<he.length;re+=1){var me=he[re],xe=this._addTile(me);T[me.key]=me,xe.hasData()||x<this._source.maxzoom&&(X[me.key]=me)}this._retainLoadedChildren(X,x,U,T);for(var Ne=0,Fe=v;Ne<Fe.length;Ne+=1){var qe=Fe[Ne],Re=this._tiles[qe.key];if(!Re.hasData()){if(x+1>this._source.maxzoom){var Ze=qe.children(this._source.maxzoom)[0],at=this.getTile(Ze);if(at&&at.hasData()){T[Ze.key]=Ze;continue}}else{var ht=qe.children(this._source.maxzoom);if(T[ht[0].key]&&T[ht[1].key]&&T[ht[2].key]&&T[ht[3].key])continue}for(var Ot=Re.wasRequested(),It=qe.overscaledZ-1;It>=F;--It){var Ut=qe.scaledTo(It);if(R[Ut.key]||(R[Ut.key]=!0,!(Re=this.getTile(Ut))&&Ot&&(Re=this._addTile(Ut)),Re&&(T[Ut.key]=Ut,Ot=Re.wasRequested(),Re.hasData())))break}}}return T},g.prototype._updateLoadedParentTileCache=function(){for(var v in this._loadedParentTiles={},this._tiles){for(var x=[],T=void 0,R=this._tiles[v].tileID;R.overscaledZ>0;){if(R.key in this._loadedParentTiles){T=this._loadedParentTiles[R.key];break}x.push(R.key);var F=R.scaledTo(R.overscaledZ-1);if(T=this._getLoadedTile(F))break;R=F}for(var U=0,X=x;U<X.length;U+=1)this._loadedParentTiles[X[U]]=T}},g.prototype._addTile=function(v){var x=this._tiles[v.key];if(x)return x;(x=this._cache.getAndRemove(v))&&(this._setTileReloadTimer(v.key,x),x.tileID=v,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[v.key]&&(clearTimeout(this._cacheTimers[v.key]),delete this._cacheTimers[v.key],this._setTileReloadTimer(v.key,x)));var T=Boolean(x);return T||(x=new o.Tile(v,this._source.tileSize*v.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,v.key,x.state))),x?(x.uses++,this._tiles[v.key]=x,T||this._source.fire(new o.Event("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x):null},g.prototype._setTileReloadTimer=function(v,x){var T=this;v in this._timers&&(clearTimeout(this._timers[v]),delete this._timers[v]);var R=x.getExpiryTimeout();R&&(this._timers[v]=setTimeout(function(){T._reloadTile(v,"expired"),delete T._timers[v]},R))},g.prototype._removeTile=function(v){var x=this._tiles[v];x&&(x.uses--,delete this._tiles[v],this._timers[v]&&(clearTimeout(this._timers[v]),delete this._timers[v]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))},g.prototype.clearTiles=function(){for(var v in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(v);this._cache.reset()},g.prototype.tilesIn=function(v,x,T){var R=this,F=[],U=this.transform;if(!U)return F;for(var X=T?U.getCameraQueryGeometry(v):v,re=v.map(function(It){return U.pointCoordinate(It)}),he=X.map(function(It){return U.pointCoordinate(It)}),me=this.getIds(),xe=1/0,Ne=1/0,Fe=-1/0,qe=-1/0,Re=0,Ze=he;Re<Ze.length;Re+=1){var at=Ze[Re];xe=Math.min(xe,at.x),Ne=Math.min(Ne,at.y),Fe=Math.max(Fe,at.x),qe=Math.max(qe,at.y)}for(var ht=function(It){var Ut=R._tiles[me[It]];if(!Ut.holdingForFade()){var cr=Ut.tileID,Sr=Math.pow(2,U.zoom-Ut.tileID.overscaledZ),zr=x*Ut.queryPadding*o.EXTENT/Ut.tileSize/Sr,sn=[cr.getTilePoint(new o.MercatorCoordinate(xe,Ne)),cr.getTilePoint(new o.MercatorCoordinate(Fe,qe))];if(sn[0].x-zr<o.EXTENT&&sn[0].y-zr<o.EXTENT&&sn[1].x+zr>=0&&sn[1].y+zr>=0){var Cn=re.map(function(Nn){return cr.getTilePoint(Nn)}),Dn=he.map(function(Nn){return cr.getTilePoint(Nn)});F.push({tile:Ut,tileID:cr,queryGeometry:Cn,cameraQueryGeometry:Dn,scale:Sr})}}},Ot=0;Ot<me.length;Ot++)ht(Ot);return F},g.prototype.getVisibleCoordinates=function(v){for(var x=this,T=this.getRenderableIds(v).map(function(X){return x._tiles[X].tileID}),R=0,F=T;R<F.length;R+=1){var U=F[R];U.posMatrix=this.transform.calculatePosMatrix(U.toUnwrapped())}return T},g.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Jt(this._source.type))for(var v in this._tiles){var x=this._tiles[v];if(x.fadeEndTime!==void 0&&x.fadeEndTime>=o.browser.now())return!0}return!1},g.prototype.setFeatureState=function(v,x,T){this._state.updateState(v=v||"_geojsonTileLayer",x,T)},g.prototype.removeFeatureState=function(v,x,T){this._state.removeFeatureState(v=v||"_geojsonTileLayer",x,T)},g.prototype.getFeatureState=function(v,x){return this._state.getState(v=v||"_geojsonTileLayer",x)},g.prototype.setDependencies=function(v,x,T){var R=this._tiles[v];R&&R.setDependencies(x,T)},g.prototype.reloadTilesForDependencies=function(v,x){for(var T in this._tiles)this._tiles[T].hasDependency(v,x)&&this._reloadTile(T,"reloading");this._cache.filter(function(R){return!R.hasDependency(v,x)})},g}(o.Evented);function mt(d,g){var v=Math.abs(2*d.wrap)-+(d.wrap<0),x=Math.abs(2*g.wrap)-+(g.wrap<0);return d.overscaledZ-g.overscaledZ||x-v||g.canonical.y-d.canonical.y||g.canonical.x-d.canonical.x}function Jt(d){return d==="raster"||d==="image"||d==="video"}function Cr(){return new o.window.Worker(rl.workerUrl)}Ve.maxOverzooming=10,Ve.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(d){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new Cr);return this.active[d]=!0,this.workers.slice()},pr.prototype.release=function(d){delete this.active[d],this.numActive()===0&&(this.workers.forEach(function(g){g.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[Dt]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var Nr,xn=Math.floor(o.browser.hardwareConcurrency/2);function Bt(){return Nr||(Nr=new pr),Nr}function ln(d,g){var v={};for(var x in d)x!=="ref"&&(v[x]=d[x]);return o.refProperties.forEach(function(T){T in g&&(v[T]=g[T])}),v}function Wr(d){d=d.slice();for(var g=Object.create(null),v=0;v<d.length;v++)g[d[v].id]=d[v];for(var x=0;x<d.length;x++)"ref"in d[x]&&(d[x]=ln(d[x],g[d[x].ref]));return d}pr.workerCount=Math.max(Math.min(xn,6),1);var Zr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(d,g,v){v.push({command:Zr.addSource,args:[d,g[d]]})}function Jr(d,g,v){g.push({command:Zr.removeSource,args:[d]}),v[d]=!0}function bi(d,g,v,x){Jr(d,v,x),gi(d,g,v)}function ci(d,g,v){var x;for(x in d[v])if(d[v].hasOwnProperty(x)&&x!=="data"&&!o.deepEqual(d[v][x],g[v][x]))return!1;for(x in g[v])if(g[v].hasOwnProperty(x)&&x!=="data"&&!o.deepEqual(d[v][x],g[v][x]))return!1;return!0}function Ci(d,g,v,x,T,R){var F;for(F in g=g||{},d=d||{})d.hasOwnProperty(F)&&(o.deepEqual(d[F],g[F])||v.push({command:R,args:[x,F,g[F],T]}));for(F in g)g.hasOwnProperty(F)&&!d.hasOwnProperty(F)&&(o.deepEqual(d[F],g[F])||v.push({command:R,args:[x,F,g[F],T]}))}function Fi(d){return d.id}function Di(d,g){return d[g.id]=g,d}var ls=function(d,g){this.reset(d,g)};ls.prototype.reset=function(d,g){this.points=d||[],this._distances=[0];for(var v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ls.prototype.lerp=function(d){if(this.points.length===1)return this.points[0];d=o.clamp(d,0,1);for(var g=1,v=this._distances[g],x=d*this.paddedLength+this.padding;v<x&&g<this._distances.length;)v=this._distances[++g];var T=g-1,R=this._distances[T],F=v-R,U=F>0?(x-R)/F:0;return this.points[T].mult(1-U).add(this.points[g].mult(U))};var sa=function(d,g,v){var x=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(d/v),this.yCellCount=Math.ceil(g/v);for(var R=0;R<this.xCellCount*this.yCellCount;R++)x.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=g,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0};function Zi(d,g,v,x,T){var R=o.create();return g?(o.scale(R,R,[1/T,1/T,1]),v||o.rotateZ(R,R,x.angle)):o.multiply(R,x.labelPlaneMatrix,d),R}function ia(d,g,v,x,T){if(g){var R=o.clone(d);return o.scale(R,R,[T,T,1]),v||o.rotateZ(R,R,-x.angle),R}return x.glCoordMatrix}function pi(d,g){var v=[d.x,d.y,0,1];Ya(v,v,g);var x=v[3];return{point:new o.Point(v[0]/x,v[1]/x),signedDistanceFromCamera:x}}function Li(d,g){return .5+d/g*.5}function go(d,g){var v=d[0]/d[3],x=d[1]/d[3];return v>=-g[0]&&v<=g[0]&&x>=-g[1]&&x<=g[1]}function pa(d,g,v,x,T,R,F,U){var X=x?d.textSizeData:d.iconSizeData,re=o.evaluateSizeForZoom(X,v.transform.zoom),he=[256/v.width*2+1,256/v.height*2+1],me=x?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;me.clear();for(var xe=d.lineVertexArray,Ne=x?d.text.placedSymbolArray:d.icon.placedSymbolArray,Fe=v.transform.width/v.transform.height,qe=!1,Re=0;Re<Ne.length;Re++){var Ze=Ne.get(Re);if(Ze.hidden||Ze.writingMode===o.WritingMode.vertical&&!qe)ns(Ze.numGlyphs,me);else{qe=!1;var at=[Ze.anchorX,Ze.anchorY,0,1];if(o.transformMat4(at,at,g),go(at,he)){var ht=Li(v.transform.cameraToCenterDistance,at[3]),Ot=o.evaluateSizeForFeature(X,re,Ze),It=F?Ot/ht:Ot*ht,Ut=new o.Point(Ze.anchorX,Ze.anchorY),cr=pi(Ut,T).point,Sr={},zr=Xf(Ze,It,!1,U,g,T,R,d.glyphOffsetArray,xe,me,cr,Ut,Sr,Fe);qe=zr.useVertical,(zr.notEnoughRoom||qe||zr.needsFlipping&&Xf(Ze,It,!0,U,g,T,R,d.glyphOffsetArray,xe,me,cr,Ut,Sr,Fe).notEnoughRoom)&&ns(Ze.numGlyphs,me)}else ns(Ze.numGlyphs,me)}}x?d.text.dynamicLayoutVertexBuffer.updateData(me):d.icon.dynamicLayoutVertexBuffer.updateData(me)}function Za(d,g,v,x,T,R,F,U,X,re,he){var me=U.glyphStartIndex+U.numGlyphs,xe=U.lineStartIndex,Ne=U.lineStartIndex+U.lineLength,Fe=g.getoffsetX(U.glyphStartIndex),qe=g.getoffsetX(me-1),Re=ki(d*Fe,v,x,T,R,F,U.segment,xe,Ne,X,re,he);if(!Re)return null;var Ze=ki(d*qe,v,x,T,R,F,U.segment,xe,Ne,X,re,he);return Ze?{first:Re,last:Ze}:null}function da(d,g,v,x){return d===o.WritingMode.horizontal&&Math.abs(v.y-g.y)>Math.abs(v.x-g.x)*x?{useVertical:!0}:(d===o.WritingMode.vertical?g.y<v.y:g.x>v.x)?{needsFlipping:!0}:null}function Xf(d,g,v,x,T,R,F,U,X,re,he,me,xe,Ne){var Fe,qe=g/24,Re=d.lineOffsetX*qe,Ze=d.lineOffsetY*qe;if(d.numGlyphs>1){var at=d.glyphStartIndex+d.numGlyphs,ht=d.lineStartIndex,Ot=d.lineStartIndex+d.lineLength,It=Za(qe,U,Re,Ze,v,he,me,d,X,R,xe);if(!It)return{notEnoughRoom:!0};var Ut=pi(It.first.point,F).point,cr=pi(It.last.point,F).point;if(x&&!v){var Sr=da(d.writingMode,Ut,cr,Ne);if(Sr)return Sr}Fe=[It.first];for(var zr=d.glyphStartIndex+1;zr<at-1;zr++)Fe.push(ki(qe*U.getoffsetX(zr),Re,Ze,v,he,me,d.segment,ht,Ot,X,R,xe));Fe.push(It.last)}else{if(x&&!v){var sn=pi(me,T).point,Cn=d.lineStartIndex+d.segment+1,Dn=new o.Point(X.getx(Cn),X.gety(Cn)),Nn=pi(Dn,T),ta=Nn.signedDistanceFromCamera>0?Nn.point:Hl(me,Dn,sn,1,T),un=da(d.writingMode,sn,ta,Ne);if(un)return un}var Zn=ki(qe*U.getoffsetX(d.glyphStartIndex),Re,Ze,v,he,me,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,X,R,xe);if(!Zn)return{notEnoughRoom:!0};Fe=[Zn]}for(var ui=0,ni=Fe;ui<ni.length;ui+=1){var jn=ni[ui];o.addDynamicAttributes(re,jn.point,jn.angle)}return{}}function Hl(d,g,v,x,T){var R=pi(d.add(d.sub(g)._unit()),T).point,F=v.sub(R);return v.add(F._mult(x/F.mag()))}function ki(d,g,v,x,T,R,F,U,X,re,he,me){var xe=x?d-g:d+g,Ne=xe>0?1:-1,Fe=0;x&&(Ne*=-1,Fe=Math.PI),Ne<0&&(Fe+=Math.PI);for(var qe=Ne>0?U+F:U+F+1,Re=T,Ze=T,at=0,ht=0,Ot=Math.abs(xe),It=[];at+ht<=Ot;){if((qe+=Ne)<U||qe>=X)return null;if(Ze=Re,It.push(Re),(Re=me[qe])===void 0){var Ut=new o.Point(re.getx(qe),re.gety(qe)),cr=pi(Ut,he);if(cr.signedDistanceFromCamera>0)Re=me[qe]=cr.point;else{var Sr=qe-Ne;Re=Hl(at===0?R:new o.Point(re.getx(Sr),re.gety(Sr)),Ut,Ze,Ot-at+1,he)}}at+=ht,ht=Ze.dist(Re)}var zr=(Ot-at)/ht,sn=Re.sub(Ze),Cn=sn.mult(zr)._add(Ze);Cn._add(sn._unit()._perp()._mult(v*Ne));var Dn=Fe+Math.atan2(Re.y-Ze.y,Re.x-Ze.x);return It.push(Cn),{point:Cn,angle:Dn,path:It}}sa.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},sa.prototype.insert=function(d,g,v,x,T){this._forEachCell(g,v,x,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(d),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(x),this.bboxes.push(T)},sa.prototype.insertCircle=function(d,g,v,x){this._forEachCell(g-x,v-x,g+x,v+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(d),this.circles.push(g),this.circles.push(v),this.circles.push(x)},sa.prototype._insertBoxCell=function(d,g,v,x,T,R){this.boxCells[T].push(R)},sa.prototype._insertCircleCell=function(d,g,v,x,T,R){this.circleCells[T].push(R)},sa.prototype._query=function(d,g,v,x,T,R){if(v<0||d>this.width||x<0||g>this.height)return!T&&[];var F=[];if(d<=0&&g<=0&&this.width<=v&&this.height<=x){if(T)return!0;for(var U=0;U<this.boxKeys.length;U++)F.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(var X=0;X<this.circleKeys.length;X++){var re=this.circles[3*X],he=this.circles[3*X+1],me=this.circles[3*X+2];F.push({key:this.circleKeys[X],x1:re-me,y1:he-me,x2:re+me,y2:he+me})}return R?F.filter(R):F}return this._forEachCell(d,g,v,x,this._queryCell,F,{hitTest:T,seenUids:{box:{},circle:{}}},R),T?F.length>0:F},sa.prototype._queryCircle=function(d,g,v,x,T){var R=d-v,F=d+v,U=g-v,X=g+v;if(F<0||R>this.width||X<0||U>this.height)return!x&&[];var re=[];return this._forEachCell(R,U,F,X,this._queryCellCircle,re,{hitTest:x,circle:{x:d,y:g,radius:v},seenUids:{box:{},circle:{}}},T),x?re.length>0:re},sa.prototype.query=function(d,g,v,x,T){return this._query(d,g,v,x,!1,T)},sa.prototype.hitTest=function(d,g,v,x,T){return this._query(d,g,v,x,!0,T)},sa.prototype.hitTestCircle=function(d,g,v,x){return this._queryCircle(d,g,v,!0,x)},sa.prototype._queryCell=function(d,g,v,x,T,R,F,U){var X=F.seenUids,re=this.boxCells[T];if(re!==null)for(var he=this.bboxes,me=0,xe=re;me<xe.length;me+=1){var Ne=xe[me];if(!X.box[Ne]){X.box[Ne]=!0;var Fe=4*Ne;if(d<=he[Fe+2]&&g<=he[Fe+3]&&v>=he[Fe+0]&&x>=he[Fe+1]&&(!U||U(this.boxKeys[Ne]))){if(F.hitTest)return R.push(!0),!0;R.push({key:this.boxKeys[Ne],x1:he[Fe],y1:he[Fe+1],x2:he[Fe+2],y2:he[Fe+3]})}}}var qe=this.circleCells[T];if(qe!==null)for(var Re=this.circles,Ze=0,at=qe;Ze<at.length;Ze+=1){var ht=at[Ze];if(!X.circle[ht]){X.circle[ht]=!0;var Ot=3*ht;if(this._circleAndRectCollide(Re[Ot],Re[Ot+1],Re[Ot+2],d,g,v,x)&&(!U||U(this.circleKeys[ht]))){if(F.hitTest)return R.push(!0),!0;var It=Re[Ot],Ut=Re[Ot+1],cr=Re[Ot+2];R.push({key:this.circleKeys[ht],x1:It-cr,y1:Ut-cr,x2:It+cr,y2:Ut+cr})}}}},sa.prototype._queryCellCircle=function(d,g,v,x,T,R,F,U){var X=F.circle,re=F.seenUids,he=this.boxCells[T];if(he!==null)for(var me=this.bboxes,xe=0,Ne=he;xe<Ne.length;xe+=1){var Fe=Ne[xe];if(!re.box[Fe]){re.box[Fe]=!0;var qe=4*Fe;if(this._circleAndRectCollide(X.x,X.y,X.radius,me[qe+0],me[qe+1],me[qe+2],me[qe+3])&&(!U||U(this.boxKeys[Fe])))return R.push(!0),!0}}var Re=this.circleCells[T];if(Re!==null)for(var Ze=this.circles,at=0,ht=Re;at<ht.length;at+=1){var Ot=ht[at];if(!re.circle[Ot]){re.circle[Ot]=!0;var It=3*Ot;if(this._circlesCollide(Ze[It],Ze[It+1],Ze[It+2],X.x,X.y,X.radius)&&(!U||U(this.circleKeys[Ot])))return R.push(!0),!0}}},sa.prototype._forEachCell=function(d,g,v,x,T,R,F,U){for(var X=this._convertToXCellCoord(d),re=this._convertToYCellCoord(g),he=this._convertToXCellCoord(v),me=this._convertToYCellCoord(x),xe=X;xe<=he;xe++)for(var Ne=re;Ne<=me;Ne++)if(T.call(this,d,g,v,x,this.xCellCount*Ne+xe,R,F,U))return},sa.prototype._convertToXCellCoord=function(d){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(d*this.xScale)))},sa.prototype._convertToYCellCoord=function(d){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(d*this.yScale)))},sa.prototype._circlesCollide=function(d,g,v,x,T,R){var F=x-d,U=T-g,X=v+R;return X*X>F*F+U*U},sa.prototype._circleAndRectCollide=function(d,g,v,x,T,R,F){var U=(R-x)/2,X=Math.abs(d-(x+U));if(X>U+v)return!1;var re=(F-T)/2,he=Math.abs(g-(T+re));if(he>re+v)return!1;if(X<=U||he<=re)return!0;var me=X-U,xe=he-re;return me*me+xe*xe<=v*v};var oc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ns(d,g){for(var v=0;v<d;v++){var x=g.length;g.resize(x+4),g.float32.set(oc,3*x)}}function Ya(d,g,v){var x=g[0],T=g[1];return d[0]=v[0]*x+v[4]*T+v[12],d[1]=v[1]*x+v[5]*T+v[13],d[3]=v[3]*x+v[7]*T+v[15],d}var yo=function(d,g,v){g===void 0&&(g=new sa(d.width+200,d.height+200,25)),v===void 0&&(v=new sa(d.width+200,d.height+200,25)),this.transform=d,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+100,this.screenBottomBoundary=d.height+100,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200};function Da(d,g,v){return g*(o.EXTENT/(d.tileSize*Math.pow(2,v-d.tileID.overscaledZ)))}yo.prototype.placeCollisionBox=function(d,g,v,x,T){var R=this.projectAndGetPerspectiveRatio(x,d.anchorPointX,d.anchorPointY),F=v*R.perspectiveRatio,U=d.x1*F+R.point.x,X=d.y1*F+R.point.y,re=d.x2*F+R.point.x,he=d.y2*F+R.point.y;return!this.isInsideGrid(U,X,re,he)||!g&&this.grid.hitTest(U,X,re,he,T)?{box:[],offscreen:!1}:{box:[U,X,re,he],offscreen:this.isOffscreen(U,X,re,he)}},yo.prototype.placeCollisionCircles=function(d,g,v,x,T,R,F,U,X,re,he,me,xe){var Ne=[],Fe=new o.Point(g.anchorX,g.anchorY),qe=pi(Fe,R),Re=Li(this.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),Ze=(re?T/Re:T*Re)/o.ONE_EM,at=pi(Fe,F).point,ht=Za(Ze,x,g.lineOffsetX*Ze,g.lineOffsetY*Ze,!1,at,Fe,g,v,F,{}),Ot=!1,It=!1,Ut=!0;if(ht){for(var cr=.5*me*Re+xe,Sr=new o.Point(-100,-100),zr=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new ls,Cn=ht.first,Dn=ht.last,Nn=[],ta=Cn.path.length-1;ta>=1;ta--)Nn.push(Cn.path[ta]);for(var un=1;un<Dn.path.length;un++)Nn.push(Dn.path[un]);var Zn=2.5*cr;if(U){var ui=Nn.map(function(Au){return pi(Au,U)});Nn=ui.some(function(Au){return Au.signedDistanceFromCamera<=0})?[]:ui.map(function(Au){return Au.point})}var ni=[];if(Nn.length>0){for(var jn=Nn[0].clone(),yi=Nn[0].clone(),Qn=1;Qn<Nn.length;Qn++)jn.x=Math.min(jn.x,Nn[Qn].x),jn.y=Math.min(jn.y,Nn[Qn].y),yi.x=Math.max(yi.x,Nn[Qn].x),yi.y=Math.max(yi.y,Nn[Qn].y);ni=jn.x>=Sr.x&&yi.x<=zr.x&&jn.y>=Sr.y&&yi.y<=zr.y?[Nn]:yi.x<Sr.x||jn.x>zr.x||yi.y<Sr.y||jn.y>zr.y?[]:o.clipLine([Nn],Sr.x,Sr.y,zr.x,zr.y)}for(var wn=0,Ba=ni;wn<Ba.length;wn+=1){var co;sn.reset(Ba[wn],.25*cr),co=sn.length<=.5*cr?1:Math.ceil(sn.paddedLength/Zn)+1;for(var io=0;io<co;io++){var So=io/Math.max(co-1,1),Ka=sn.lerp(So),Na=Ka.x+100,Cs=Ka.y+100;Ne.push(Na,Cs,cr,0);var Ra=Na-cr,Ss=Cs-cr,zs=Na+cr,nl=Cs+cr;if(Ut=Ut&&this.isOffscreen(Ra,Ss,zs,nl),It=It||this.isInsideGrid(Ra,Ss,zs,nl),!d&&this.grid.hitTestCircle(Na,Cs,cr,he)&&(Ot=!0,!X))return{circles:[],offscreen:!1,collisionDetected:Ot}}}}return{circles:!X&&Ot||!It?[]:Ne,offscreen:Ut,collisionDetected:Ot}},yo.prototype.queryRenderedSymbols=function(d){if(d.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var g=[],v=1/0,x=1/0,T=-1/0,R=-1/0,F=0,U=d;F<U.length;F+=1){var X=U[F],re=new o.Point(X.x+100,X.y+100);v=Math.min(v,re.x),x=Math.min(x,re.y),T=Math.max(T,re.x),R=Math.max(R,re.y),g.push(re)}for(var he={},me={},xe=0,Ne=this.grid.query(v,x,T,R).concat(this.ignoredGrid.query(v,x,T,R));xe<Ne.length;xe+=1){var Fe=Ne[xe],qe=Fe.key;if(he[qe.bucketInstanceId]===void 0&&(he[qe.bucketInstanceId]={}),!he[qe.bucketInstanceId][qe.featureIndex]){var Re=[new o.Point(Fe.x1,Fe.y1),new o.Point(Fe.x2,Fe.y1),new o.Point(Fe.x2,Fe.y2),new o.Point(Fe.x1,Fe.y2)];o.polygonIntersectsPolygon(g,Re)&&(he[qe.bucketInstanceId][qe.featureIndex]=!0,me[qe.bucketInstanceId]===void 0&&(me[qe.bucketInstanceId]=[]),me[qe.bucketInstanceId].push(qe.featureIndex))}}return me},yo.prototype.insertCollisionBox=function(d,g,v,x,T){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:x,collisionGroupID:T},d[0],d[1],d[2],d[3])},yo.prototype.insertCollisionCircles=function(d,g,v,x,T){for(var R=g?this.ignoredGrid:this.grid,F={bucketInstanceId:v,featureIndex:x,collisionGroupID:T},U=0;U<d.length;U+=4)R.insertCircle(F,d[U],d[U+1],d[U+2])},yo.prototype.projectAndGetPerspectiveRatio=function(d,g,v){var x=[g,v,0,1];return Ya(x,x,d),{point:new o.Point((x[0]/x[3]+1)/2*this.transform.width+100,(-x[1]/x[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}},yo.prototype.isOffscreen=function(d,g,v,x){return v<100||d>=this.screenRightBoundary||x<100||g>this.screenBottomBoundary},yo.prototype.isInsideGrid=function(d,g,v,x){return v>=0&&d<this.gridRightBoundary&&x>=0&&g<this.gridBottomBoundary},yo.prototype.getViewportMatrix=function(){var d=o.identity([]);return o.translate(d,d,[-100,-100,0]),d};var ks=function(d,g,v,x){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?g:-g))):x&&v?1:0,this.placed=v};ks.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var qa=function(d,g,v,x,T){this.text=new ks(d?d.text:null,g,v,T),this.icon=new ks(d?d.icon:null,g,x,T)};qa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Rc=function(d,g,v){this.text=d,this.icon=g,this.skipFade=v},Rs=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},df=function(d,g,v,x,T){this.bucketInstanceId=d,this.featureIndex=g,this.sourceLayerIndex=v,this.bucketIndex=x,this.tileID=T},Os=function(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}};function Ha(d,g,v,x,T){var R=o.getAnchorAlignment(d),F=-(R.horizontalAlign-.5)*g,U=-(R.verticalAlign-.5)*v,X=o.evaluateVariableOffset(d,x);return new o.Point(F+X[0]*T,U+X[1]*T)}function Ps(d,g,v,x,T,R){var F=d.x1,U=d.x2,X=d.y1,re=d.y2,he=d.anchorPointX,me=d.anchorPointY,xe=new o.Point(g,v);return x&&xe._rotate(T?R:-R),{x1:F+xe.x,y1:X+xe.y,x2:U+xe.x,y2:re+xe.y,anchorPointX:he,anchorPointY:me}}Os.prototype.get=function(d){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[d]){var g=++this.maxGroupID;this.collisionGroups[d]={ID:g,predicate:function(v){return v.collisionGroupID===g}}}return this.collisionGroups[d]};var se=function(d,g,v,x){this.transform=d.clone(),this.collisionIndex=new yo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Os(v),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}};function we(d,g,v,x,T){d.emplaceBack(g?1:0,v?1:0,x||0,T||0),d.emplaceBack(g?1:0,v?1:0,x||0,T||0),d.emplaceBack(g?1:0,v?1:0,x||0,T||0),d.emplaceBack(g?1:0,v?1:0,x||0,T||0)}se.prototype.getBucketParts=function(d,g,v,x){var T=v.getBucket(g),R=v.latestFeatureIndex;if(T&&R&&g.id===T.layerIds[0]){var F=v.collisionBoxArray,U=T.layers[0].layout,X=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),re=v.tileSize/o.EXTENT,he=this.transform.calculatePosMatrix(v.tileID.toUnwrapped()),me=U.get("text-pitch-alignment")==="map",xe=U.get("text-rotation-alignment")==="map",Ne=Da(v,1,this.transform.zoom),Fe=Zi(he,me,xe,this.transform,Ne),qe=null;if(me){var Re=ia(he,me,xe,this.transform,Ne);qe=o.multiply([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[T.bucketInstanceId]=new df(T.bucketInstanceId,R,T.sourceLayerIndex,T.index,v.tileID);var Ze={bucket:T,layout:U,posMatrix:he,textLabelPlaneMatrix:Fe,labelToScreenMatrix:qe,scale:X,textPixelRatio:re,holdingForFade:v.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(x)for(var at=0,ht=T.sortKeyRanges;at<ht.length;at+=1){var Ot=ht[at];d.push({sortKey:Ot.sortKey,symbolInstanceStart:Ot.symbolInstanceStart,symbolInstanceEnd:Ot.symbolInstanceEnd,parameters:Ze})}else d.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ze})}},se.prototype.attemptAnchorPlacement=function(d,g,v,x,T,R,F,U,X,re,he,me,xe,Ne,Fe){var qe,Re=[me.textOffset0,me.textOffset1],Ze=Ha(d,v,x,Re,T),at=this.collisionIndex.placeCollisionBox(Ps(g,Ze.x,Ze.y,R,F,this.transform.angle),he,U,X,re.predicate);if(!Fe||this.collisionIndex.placeCollisionBox(Ps(Fe,Ze.x,Ze.y,R,F,this.transform.angle),he,U,X,re.predicate).box.length!==0)return at.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(qe=this.prevPlacement.variableOffsets[me.crossTileID].anchor),this.variableOffsets[me.crossTileID]={textOffset:Re,width:v,height:x,anchor:d,textBoxScale:T,prevAnchor:qe},this.markUsedJustification(xe,d,me,Ne),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,Ne,me),this.placedOrientations[me.crossTileID]=Ne),{shift:Ze,placedGlyphBoxes:at}):void 0},se.prototype.placeLayerBucketPart=function(d,g,v){var x=this,T=d.parameters,R=T.bucket,F=T.layout,U=T.posMatrix,X=T.textLabelPlaneMatrix,re=T.labelToScreenMatrix,he=T.textPixelRatio,me=T.holdingForFade,xe=T.collisionBoxArray,Ne=T.partiallyEvaluatedTextSize,Fe=T.collisionGroup,qe=F.get("text-optional"),Re=F.get("icon-optional"),Ze=F.get("text-allow-overlap"),at=F.get("icon-allow-overlap"),ht=F.get("text-rotation-alignment")==="map",Ot=F.get("text-pitch-alignment")==="map",It=F.get("icon-text-fit")!=="none",Ut=F.get("symbol-z-order")==="viewport-y",cr=Ze&&(at||!R.hasIconData()||Re),Sr=at&&(Ze||!R.hasTextData()||qe);!R.collisionArrays&&xe&&R.deserializeCollisionBoxes(xe);var zr=function(un,Zn){if(!g[un.crossTileID])if(me)x.placements[un.crossTileID]=new Rc(!1,!1,!1);else{var ui,ni=!1,jn=!1,yi=!0,Qn=null,wn={box:null,offscreen:null},Ba={box:null,offscreen:null},co=null,io=null,So=0,Ka=0,Na=0;Zn.textFeatureIndex?So=Zn.textFeatureIndex:un.useRuntimeCollisionCircles&&(So=un.featureIndex),Zn.verticalTextFeatureIndex&&(Ka=Zn.verticalTextFeatureIndex);var Cs=Zn.textBox;if(Cs){var Ra=function(Bi){var cu=o.WritingMode.horizontal;if(R.allowVerticalPlacement&&!Bi&&x.prevPlacement){var La=x.prevPlacement.placedOrientations[un.crossTileID];La&&(x.placedOrientations[un.crossTileID]=La,x.markUsedOrientation(R,cu=La,un))}return cu},Ss=function(Bi,cu){if(R.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&Zn.verticalTextBox)for(var La=0,Mu=R.writingModes;La<Mu.length&&(Mu[La]===o.WritingMode.vertical?(wn=cu(),Ba=wn):wn=Bi(),!(wn&&wn.box&&wn.box.length));La+=1);else wn=Bi()};if(F.get("text-variable-anchor")){var zs=F.get("text-variable-anchor");if(x.prevPlacement&&x.prevPlacement.variableOffsets[un.crossTileID]){var nl=x.prevPlacement.variableOffsets[un.crossTileID];zs.indexOf(nl.anchor)>0&&(zs=zs.filter(function(Bi){return Bi!==nl.anchor})).unshift(nl.anchor)}var Au=function(Bi,cu,La){for(var Mu=Bi.x2-Bi.x1,ih=Bi.y2-Bi.y1,Iu=un.textBoxScale,Ph=It&&!at?cu:null,ol={box:[],offscreen:!1},ah=Ze?2*zs.length:zs.length,fu=0;fu<ah;++fu){var Tl=x.attemptAnchorPlacement(zs[fu%zs.length],Bi,Mu,ih,Iu,ht,Ot,he,U,Fe,fu>=zs.length,un,R,La,Ph);if(Tl&&(ol=Tl.placedGlyphBoxes)&&ol.box&&ol.box.length){ni=!0,Qn=Tl.shift;break}}return ol};Ss(function(){return Au(Cs,Zn.iconBox,o.WritingMode.horizontal)},function(){var Bi=Zn.verticalTextBox;return R.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&un.numVerticalGlyphVertices>0&&Bi?Au(Bi,Zn.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),wn&&(ni=wn.box,yi=wn.offscreen);var Zc=Ra(wn&&wn.box);if(!ni&&x.prevPlacement){var nh=x.prevPlacement.variableOffsets[un.crossTileID];nh&&(x.variableOffsets[un.crossTileID]=nh,x.markUsedJustification(R,nh.anchor,un,Zc))}}else{var il=function(Bi,cu){var La=x.collisionIndex.placeCollisionBox(Bi,Ze,he,U,Fe.predicate);return La&&La.box&&La.box.length&&(x.markUsedOrientation(R,cu,un),x.placedOrientations[un.crossTileID]=cu),La};Ss(function(){return il(Cs,o.WritingMode.horizontal)},function(){var Bi=Zn.verticalTextBox;return R.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&Bi?il(Bi,o.WritingMode.vertical):{box:null,offscreen:null}}),Ra(wn&&wn.box&&wn.box.length)}}if(ni=(ui=wn)&&ui.box&&ui.box.length>0,yi=ui&&ui.offscreen,un.useRuntimeCollisionCircles){var Yc=R.text.placedSymbolArray.get(un.centerJustifiedTextSymbolIndex),Tf=o.evaluateSizeForFeature(R.textSizeData,Ne,Yc),Gu=F.get("text-padding");co=x.collisionIndex.placeCollisionCircles(Ze,Yc,R.lineVertexArray,R.glyphOffsetArray,Tf,U,X,re,v,Ot,Fe.predicate,un.collisionCircleDiameter,Gu),ni=Ze||co.circles.length>0&&!co.collisionDetected,yi=yi&&co.offscreen}if(Zn.iconFeatureIndex&&(Na=Zn.iconFeatureIndex),Zn.iconBox){var Tu=function(Bi){var cu=It&&Qn?Ps(Bi,Qn.x,Qn.y,ht,Ot,x.transform.angle):Bi;return x.collisionIndex.placeCollisionBox(cu,at,he,U,Fe.predicate)};jn=Ba&&Ba.box&&Ba.box.length&&Zn.verticalIconBox?(io=Tu(Zn.verticalIconBox)).box.length>0:(io=Tu(Zn.iconBox)).box.length>0,yi=yi&&io.offscreen}var Ql=qe||un.numHorizontalGlyphVertices===0&&un.numVerticalGlyphVertices===0,Zo=Re||un.numIconVertices===0;if(Ql||Zo?Zo?Ql||(jn=jn&&ni):ni=jn&&ni:jn=ni=jn&&ni,ni&&ui&&ui.box&&x.collisionIndex.insertCollisionBox(ui.box,F.get("text-ignore-placement"),R.bucketInstanceId,Ba&&Ba.box&&Ka?Ka:So,Fe.ID),jn&&io&&x.collisionIndex.insertCollisionBox(io.box,F.get("icon-ignore-placement"),R.bucketInstanceId,Na,Fe.ID),co&&(ni&&x.collisionIndex.insertCollisionCircles(co.circles,F.get("text-ignore-placement"),R.bucketInstanceId,So,Fe.ID),v)){var al=R.bucketInstanceId,yc=x.collisionCircleArrays[al];yc===void 0&&(yc=x.collisionCircleArrays[al]=new Rs);for(var Mf=0;Mf<co.circles.length;Mf+=4)yc.circles.push(co.circles[Mf+0]),yc.circles.push(co.circles[Mf+1]),yc.circles.push(co.circles[Mf+2]),yc.circles.push(co.collisionDetected?1:0)}x.placements[un.crossTileID]=new Rc(ni||cr,jn||Sr,yi||R.justReloaded),g[un.crossTileID]=!0}};if(Ut)for(var sn=R.getSortedSymbolIndexes(this.transform.angle),Cn=sn.length-1;Cn>=0;--Cn){var Dn=sn[Cn];zr(R.symbolInstances.get(Dn),R.collisionArrays[Dn])}else for(var Nn=d.symbolInstanceStart;Nn<d.symbolInstanceEnd;Nn++)zr(R.symbolInstances.get(Nn),R.collisionArrays[Nn]);if(v&&R.bucketInstanceId in this.collisionCircleArrays){var ta=this.collisionCircleArrays[R.bucketInstanceId];o.invert(ta.invProjMatrix,U),ta.viewportMatrix=this.collisionIndex.getViewportMatrix()}R.justReloaded=!1},se.prototype.markUsedJustification=function(d,g,v,x){var T;T=x===o.WritingMode.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(g)];for(var R=0,F=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];R<F.length;R+=1){var U=F[R];U>=0&&(d.text.placedSymbolArray.get(U).crossTileID=T>=0&&U!==T?0:v.crossTileID)}},se.prototype.markUsedOrientation=function(d,g,v){for(var x=g===o.WritingMode.horizontal||g===o.WritingMode.horizontalOnly?g:0,T=g===o.WritingMode.vertical?g:0,R=0,F=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];R<F.length;R+=1)d.text.placedSymbolArray.get(F[R]).placedOrientation=x;v.verticalPlacedTextSymbolIndex&&(d.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=T)},se.prototype.commit=function(d){this.commitTime=d,this.zoomAtLastRecencyCheck=this.transform.zoom;var g=this.prevPlacement,v=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;var x=g?g.symbolFadeChange(d):1,T=g?g.opacities:{},R=g?g.variableOffsets:{},F=g?g.placedOrientations:{};for(var U in this.placements){var X=this.placements[U],re=T[U];re?(this.opacities[U]=new qa(re,x,X.text,X.icon),v=v||X.text!==re.text.placed||X.icon!==re.icon.placed):(this.opacities[U]=new qa(null,x,X.text,X.icon,X.skipFade),v=v||X.text||X.icon)}for(var he in T){var me=T[he];if(!this.opacities[he]){var xe=new qa(me,x,!1,!1);xe.isHidden()||(this.opacities[he]=xe,v=v||me.text.placed||me.icon.placed)}}for(var Ne in R)this.variableOffsets[Ne]||!this.opacities[Ne]||this.opacities[Ne].isHidden()||(this.variableOffsets[Ne]=R[Ne]);for(var Fe in F)this.placedOrientations[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.placedOrientations[Fe]=F[Fe]);v?this.lastPlacementChangeTime=d:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:d)},se.prototype.updateLayerOpacities=function(d,g){for(var v={},x=0,T=g;x<T.length;x+=1){var R=T[x],F=R.getBucket(d);F&&R.latestFeatureIndex&&d.id===F.layerIds[0]&&this.updateBucketOpacities(F,v,R.collisionBoxArray)}},se.prototype.updateBucketOpacities=function(d,g,v){var x=this;d.hasTextData()&&d.text.opacityVertexArray.clear(),d.hasIconData()&&d.icon.opacityVertexArray.clear(),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexArray.clear(),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexArray.clear();var T=d.layers[0].layout,R=new qa(null,0,!1,!1,!0),F=T.get("text-allow-overlap"),U=T.get("icon-allow-overlap"),X=T.get("text-variable-anchor"),re=T.get("text-rotation-alignment")==="map",he=T.get("text-pitch-alignment")==="map",me=T.get("icon-text-fit")!=="none",xe=new qa(null,0,F&&(U||!d.hasIconData()||T.get("icon-optional")),U&&(F||!d.hasTextData()||T.get("text-optional")),!0);!d.collisionArrays&&v&&(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData())&&d.deserializeCollisionBoxes(v);for(var Ne=function(Ze,at,ht){for(var Ot=0;Ot<at/4;Ot++)Ze.opacityVertexArray.emplaceBack(ht)},Fe=function(Ze){var at=d.symbolInstances.get(Ze),ht=at.numHorizontalGlyphVertices,Ot=at.numVerticalGlyphVertices,It=at.crossTileID,Ut=x.opacities[It];g[It]?Ut=R:Ut||(x.opacities[It]=Ut=xe),g[It]=!0;var cr=at.numIconVertices>0,Sr=x.placedOrientations[at.crossTileID],zr=Sr===o.WritingMode.vertical,sn=Sr===o.WritingMode.horizontal||Sr===o.WritingMode.horizontalOnly;if(ht>0||Ot>0){var Cn=ko(Ut.text);Ne(d.text,ht,zr?Ia:Cn),Ne(d.text,Ot,sn?Ia:Cn);var Dn=Ut.text.isHidden();[at.rightJustifiedTextSymbolIndex,at.centerJustifiedTextSymbolIndex,at.leftJustifiedTextSymbolIndex].forEach(function(wn){wn>=0&&(d.text.placedSymbolArray.get(wn).hidden=Dn||zr?1:0)}),at.verticalPlacedTextSymbolIndex>=0&&(d.text.placedSymbolArray.get(at.verticalPlacedTextSymbolIndex).hidden=Dn||sn?1:0);var Nn=x.variableOffsets[at.crossTileID];Nn&&x.markUsedJustification(d,Nn.anchor,at,Sr);var ta=x.placedOrientations[at.crossTileID];ta&&(x.markUsedJustification(d,"left",at,ta),x.markUsedOrientation(d,ta,at))}if(cr){var un=ko(Ut.icon),Zn=!(me&&at.verticalPlacedIconSymbolIndex&&zr);at.placedIconSymbolIndex>=0&&(Ne(d.icon,at.numIconVertices,Zn?un:Ia),d.icon.placedSymbolArray.get(at.placedIconSymbolIndex).hidden=Ut.icon.isHidden()),at.verticalPlacedIconSymbolIndex>=0&&(Ne(d.icon,at.numVerticalIconVertices,Zn?Ia:un),d.icon.placedSymbolArray.get(at.verticalPlacedIconSymbolIndex).hidden=Ut.icon.isHidden())}if(d.hasIconCollisionBoxData()||d.hasTextCollisionBoxData()){var ui=d.collisionArrays[Ze];if(ui){var ni=new o.Point(0,0);if(ui.textBox||ui.verticalTextBox){var jn=!0;if(X){var yi=x.variableOffsets[It];yi?(ni=Ha(yi.anchor,yi.width,yi.height,yi.textOffset,yi.textBoxScale),re&&ni._rotate(he?x.transform.angle:-x.transform.angle)):jn=!1}ui.textBox&&we(d.textCollisionBox.collisionVertexArray,Ut.text.placed,!jn||zr,ni.x,ni.y),ui.verticalTextBox&&we(d.textCollisionBox.collisionVertexArray,Ut.text.placed,!jn||sn,ni.x,ni.y)}var Qn=Boolean(!sn&&ui.verticalIconBox);ui.iconBox&&we(d.iconCollisionBox.collisionVertexArray,Ut.icon.placed,Qn,me?ni.x:0,me?ni.y:0),ui.verticalIconBox&&we(d.iconCollisionBox.collisionVertexArray,Ut.icon.placed,!Qn,me?ni.x:0,me?ni.y:0)}}},qe=0;qe<d.symbolInstances.length;qe++)Fe(qe);if(d.sortFeatures(this.transform.angle),this.retainedQueryData[d.bucketInstanceId]&&(this.retainedQueryData[d.bucketInstanceId].featureSortOrder=d.featureSortOrder),d.hasTextData()&&d.text.opacityVertexBuffer&&d.text.opacityVertexBuffer.updateData(d.text.opacityVertexArray),d.hasIconData()&&d.icon.opacityVertexBuffer&&d.icon.opacityVertexBuffer.updateData(d.icon.opacityVertexArray),d.hasIconCollisionBoxData()&&d.iconCollisionBox.collisionVertexBuffer&&d.iconCollisionBox.collisionVertexBuffer.updateData(d.iconCollisionBox.collisionVertexArray),d.hasTextCollisionBoxData()&&d.textCollisionBox.collisionVertexBuffer&&d.textCollisionBox.collisionVertexBuffer.updateData(d.textCollisionBox.collisionVertexArray),d.bucketInstanceId in this.collisionCircleArrays){var Re=this.collisionCircleArrays[d.bucketInstanceId];d.placementInvProjMatrix=Re.invProjMatrix,d.placementViewportMatrix=Re.viewportMatrix,d.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[d.bucketInstanceId]}},se.prototype.symbolFadeChange=function(d){return this.fadeDuration===0?1:(d-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},se.prototype.zoomAdjustment=function(d){return Math.max(0,(this.transform.zoom-d)/1.5)},se.prototype.hasTransitions=function(d){return this.stale||d-this.lastPlacementChangeTime<this.fadeDuration},se.prototype.stillRecent=function(d,g){var v=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*v>d},se.prototype.setStale=function(){this.stale=!0};var Je=Math.pow(2,25),Nt=Math.pow(2,24),Tr=Math.pow(2,17),Un=Math.pow(2,16),Qi=Math.pow(2,9),Ma=Math.pow(2,8),cs=Math.pow(2,1);function ko(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;var g=d.placed?1:0,v=Math.floor(127*d.opacity);return v*Je+g*Nt+v*Tr+g*Un+v*Qi+g*Ma+v*cs+g}var Ia=0,Fp=function(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Fp.prototype.continuePlacement=function(d,g,v,x,T){for(var R=this._bucketParts;this._currentTileIndex<d.length;)if(g.getBucketParts(R,x,d[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort(function(F,U){return F.sortKey-U.sortKey}));this._currentPartIndex<R.length;)if(g.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,v),this._currentPartIndex++,T())return!0;return!1};var Zf=function(d,g,v,x,T,R,F){this.placement=new se(d,T,R,F),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=x,this._done=!1};Zf.prototype.isDone=function(){return this._done},Zf.prototype.continuePlacement=function(d,g,v){for(var x=this,T=o.browser.now(),R=function(){var X=o.browser.now()-T;return!x._forceFullPlacement&&X>2};this._currentPlacementIndex>=0;){var F=g[d[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=U)&&(!F.maxzoom||F.maxzoom>U)){if(this._inProgressLayer||(this._inProgressLayer=new Fp(F)),this._inProgressLayer.continuePlacement(v[F.source],this.placement,this._showCollisionBoxes,F,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Zf.prototype.commit=function(d){return this.placement.commit(d),this.placement};var qd=512/o.EXTENT/2,Kh=function(d,g,v){this.tileID=d,this.indexedSymbolInstances={},this.bucketInstanceId=v;for(var x=0;x<g.length;x++){var T=g.get(x),R=T.key;this.indexedSymbolInstances[R]||(this.indexedSymbolInstances[R]=[]),this.indexedSymbolInstances[R].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,d)})}};Kh.prototype.getScaledCoordinates=function(d,g){var v=qd/Math.pow(2,g.canonical.z-this.tileID.canonical.z);return{x:Math.floor((g.canonical.x*o.EXTENT+d.anchorX)*v),y:Math.floor((g.canonical.y*o.EXTENT+d.anchorY)*v)}},Kh.prototype.findMatches=function(d,g,v){for(var x=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),T=0;T<d.length;T++){var R=d.get(T);if(!R.crossTileID){var F=this.indexedSymbolInstances[R.key];if(F)for(var U=this.getScaledCoordinates(R,g),X=0,re=F;X<re.length;X+=1){var he=re[X];if(Math.abs(he.coord.x-U.x)<=x&&Math.abs(he.coord.y-U.y)<=x&&!v[he.crossTileID]){v[he.crossTileID]=!0,R.crossTileID=he.crossTileID;break}}}}};var gu=function(){this.maxCrossTileID=0};gu.prototype.generate=function(){return++this.maxCrossTileID};var Wl=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Wl.prototype.handleWrapJump=function(d){var g=Math.round((d-this.lng)/360);if(g!==0)for(var v in this.indexes){var x=this.indexes[v],T={};for(var R in x){var F=x[R];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+g),T[F.tileID.key]=F}this.indexes[v]=T}this.lng=d},Wl.prototype.addBucket=function(d,g,v){if(this.indexes[d.overscaledZ]&&this.indexes[d.overscaledZ][d.key]){if(this.indexes[d.overscaledZ][d.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(d.overscaledZ,this.indexes[d.overscaledZ][d.key])}for(var x=0;x<g.symbolInstances.length;x++)g.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[d.overscaledZ]||(this.usedCrossTileIDs[d.overscaledZ]={});var T=this.usedCrossTileIDs[d.overscaledZ];for(var R in this.indexes){var F=this.indexes[R];if(Number(R)>d.overscaledZ)for(var U in F){var X=F[U];X.tileID.isChildOf(d)&&X.findMatches(g.symbolInstances,d,T)}else{var re=F[d.scaledTo(Number(R)).key];re&&re.findMatches(g.symbolInstances,d,T)}}for(var he=0;he<g.symbolInstances.length;he++){var me=g.symbolInstances.get(he);me.crossTileID||(me.crossTileID=v.generate(),T[me.crossTileID]=!0)}return this.indexes[d.overscaledZ]===void 0&&(this.indexes[d.overscaledZ]={}),this.indexes[d.overscaledZ][d.key]=new Kh(d,g.symbolInstances,g.bucketInstanceId),!0},Wl.prototype.removeBucketCrossTileIDs=function(d,g){for(var v in g.indexedSymbolInstances)for(var x=0,T=g.indexedSymbolInstances[v];x<T.length;x+=1)delete this.usedCrossTileIDs[d][T[x].crossTileID]},Wl.prototype.removeStaleBuckets=function(d){var g=!1;for(var v in this.indexes){var x=this.indexes[v];for(var T in x)d[x[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,x[T]),delete x[T],g=!0)}return g};var vf=function(){this.layerIndexes={},this.crossTileIDs=new gu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};vf.prototype.addLayer=function(d,g,v){var x=this.layerIndexes[d.id];x===void 0&&(x=this.layerIndexes[d.id]=new Wl);var T=!1,R={};x.handleWrapJump(v);for(var F=0,U=g;F<U.length;F+=1){var X=U[F],re=X.getBucket(d);re&&d.id===re.layerIds[0]&&(re.bucketInstanceId||(re.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(X.tileID,re,this.crossTileIDs)&&(T=!0),R[re.bucketInstanceId]=!0)}return x.removeStaleBuckets(R)&&(T=!0),T},vf.prototype.pruneUnusedLayers=function(d){var g={};for(var v in d.forEach(function(x){g[x]=!0}),this.layerIndexes)g[v]||delete this.layerIndexes[v]};var Ku=function(d,g){return o.emitValidationErrors(d,g&&g.filter(function(v){return v.identifier!=="source.canvas"}))},yu=o.pick(Zr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),mf=o.pick(Zr,["setCenter","setZoom","setBearing","setPitch"]),to=function(){var d={},g=o.styleSpec.$version;for(var v in o.styleSpec.$root){var x,T=o.styleSpec.$root[v];T.required&&(x=v==="version"?g:T.type==="array"?[]:{})!=null&&(d[v]=x)}return d}(),Ji=function(d){function g(v,x){var T=this;x===void 0&&(x={}),d.call(this),this.map=v,this.dispatcher=new Ie(Bt(),this),this.imageManager=new Y,this.imageManager.setEventedParent(this),this.glyphManager=new Ke(v._requestManager,x.localIdeographFontFamily),this.lineAtlas=new ve(256,512),this.crossTileSymbolIndex=new vf,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var R=this;this._rtlTextPluginCallback=g.registerForPluginStateChange(function(F){R.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:F.pluginStatus,pluginURL:F.pluginURL},function(U,X){if(o.triggerPluginCompletionEvent(U),X&&X.every(function(he){return he}))for(var re in R.sourceCaches)R.sourceCaches[re].reload()})}),this.on("data",function(F){if(F.dataType==="source"&&F.sourceDataType==="metadata"){var U=T.sourceCaches[F.sourceId];if(U){var X=U.getSource();if(X&&X.vectorLayerIds)for(var re in T._layers){var he=T._layers[re];he.source===X.id&&T._validateLayer(he)}}}})}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.loadURL=function(v,x){var T=this;x===void 0&&(x={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var R=typeof x.validate=="boolean"?x.validate:!o.isMapboxURL(v);v=this.map._requestManager.normalizeStyleURL(v,x.accessToken);var F=this.map._requestManager.transformRequest(v,o.ResourceType.Style);this._request=o.getJSON(F,function(U,X){T._request=null,U?T.fire(new o.ErrorEvent(U)):X&&T._load(X,R)})},g.prototype.loadJSON=function(v,x){var T=this;x===void 0&&(x={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){T._request=null,T._load(v,x.validate!==!1)})},g.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(to,!1)},g.prototype._load=function(v,x){if(!x||!Ku(this,o.validateStyle(v))){for(var T in this._loaded=!0,this.stylesheet=v,v.sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs);var R=Wr(this.stylesheet.layers);this._order=R.map(function(re){return re.id}),this._layers={},this._serializedLayers={};for(var F=0,U=R;F<U.length;F+=1){var X=U[F];(X=o.createStyleLayer(X)).setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new je(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},g.prototype._loadSprite=function(v){var x=this;this._spriteRequest=function(T,R,F){var U,X,re,he=o.browser.devicePixelRatio>1?"@2x":"",me=o.getJSON(R.transformRequest(R.normalizeSpriteURL(T,he,".json"),o.ResourceType.SpriteJSON),function(Fe,qe){me=null,re||(re=Fe,U=qe,Ne())}),xe=o.getImage(R.transformRequest(R.normalizeSpriteURL(T,he,".png"),o.ResourceType.SpriteImage),function(Fe,qe){xe=null,re||(re=Fe,X=qe,Ne())});function Ne(){if(re)F(re);else if(U&&X){var Fe=o.browser.getImageData(X),qe={};for(var Re in U){var Ze=U[Re],at=Ze.width,ht=Ze.height,Ot=Ze.x,It=Ze.y,Ut=Ze.sdf,cr=Ze.pixelRatio,Sr=Ze.stretchX,zr=Ze.stretchY,sn=Ze.content,Cn=new o.RGBAImage({width:at,height:ht});o.RGBAImage.copy(Fe,Cn,{x:Ot,y:It},{x:0,y:0},{width:at,height:ht}),qe[Re]={data:Cn,pixelRatio:cr,sdf:Ut,stretchX:Sr,stretchY:zr,content:sn}}F(null,qe)}}return{cancel:function(){me&&(me.cancel(),me=null),xe&&(xe.cancel(),xe=null)}}}(v,this.map._requestManager,function(T,R){if(x._spriteRequest=null,T)x.fire(new o.ErrorEvent(T));else if(R)for(var F in R)x.imageManager.addImage(F,R[F]);x.imageManager.setLoaded(!0),x._availableImages=x.imageManager.listImages(),x.dispatcher.broadcast("setImages",x._availableImages),x.fire(new o.Event("data",{dataType:"style"}))})},g.prototype._validateLayer=function(v){var x=this.sourceCaches[v.source];if(x){var T=v.sourceLayer;if(T){var R=x.getSource();(R.type==="geojson"||R.vectorLayerIds&&R.vectorLayerIds.indexOf(T)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+T+'" does not exist on source "'+R.id+'" as specified by style layer "'+v.id+'"')))}}},g.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var v in this.sourceCaches)if(!this.sourceCaches[v].loaded())return!1;return!!this.imageManager.isLoaded()},g.prototype._serializeLayers=function(v){for(var x=[],T=0,R=v;T<R.length;T+=1){var F=this._layers[R[T]];F.type!=="custom"&&x.push(F.serialize())}return x},g.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var v in this.sourceCaches)if(this.sourceCaches[v].hasTransition())return!0;for(var x in this._layers)if(this._layers[x].hasTransition())return!0;return!1},g.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},g.prototype.update=function(v){if(this._loaded){var x=this._changed;if(this._changed){var T=Object.keys(this._updatedLayers),R=Object.keys(this._removedLayers);for(var F in(T.length||R.length)&&this._updateWorkerLayers(T,R),this._updatedSources){var U=this._updatedSources[F];U==="reload"?this._reloadSource(F):U==="clear"&&this._clearSource(F)}for(var X in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[X].updateTransitions(v);this.light.updateTransitions(v),this._resetUpdates()}var re={};for(var he in this.sourceCaches){var me=this.sourceCaches[he];re[he]=me.used,me.used=!1}for(var xe=0,Ne=this._order;xe<Ne.length;xe+=1){var Fe=this._layers[Ne[xe]];Fe.recalculate(v,this._availableImages),!Fe.isHidden(v.zoom)&&Fe.source&&(this.sourceCaches[Fe.source].used=!0)}for(var qe in re){var Re=this.sourceCaches[qe];re[qe]!==Re.used&&Re.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:qe}))}this.light.recalculate(v),this.z=v.zoom,x&&this.fire(new o.Event("data",{dataType:"style"}))}},g.prototype._updateTilesForChangedImages=function(){var v=Object.keys(this._changedImages);if(v.length){for(var x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],v);this._changedImages={}}},g.prototype._updateWorkerLayers=function(v,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(v),removedIds:x})},g.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},g.prototype.setState=function(v){var x=this;if(this._checkLoaded(),Ku(this,o.validateStyle(v)))return!1;(v=o.clone$1(v)).layers=Wr(v.layers);var T=function(F,U){if(!F)return[{command:Zr.setStyle,args:[U]}];var X=[];try{if(!o.deepEqual(F.version,U.version))return[{command:Zr.setStyle,args:[U]}];o.deepEqual(F.center,U.center)||X.push({command:Zr.setCenter,args:[U.center]}),o.deepEqual(F.zoom,U.zoom)||X.push({command:Zr.setZoom,args:[U.zoom]}),o.deepEqual(F.bearing,U.bearing)||X.push({command:Zr.setBearing,args:[U.bearing]}),o.deepEqual(F.pitch,U.pitch)||X.push({command:Zr.setPitch,args:[U.pitch]}),o.deepEqual(F.sprite,U.sprite)||X.push({command:Zr.setSprite,args:[U.sprite]}),o.deepEqual(F.glyphs,U.glyphs)||X.push({command:Zr.setGlyphs,args:[U.glyphs]}),o.deepEqual(F.transition,U.transition)||X.push({command:Zr.setTransition,args:[U.transition]}),o.deepEqual(F.light,U.light)||X.push({command:Zr.setLight,args:[U.light]});var re={},he=[];(function(xe,Ne,Fe,qe){var Re;for(Re in Ne=Ne||{},xe=xe||{})xe.hasOwnProperty(Re)&&(Ne.hasOwnProperty(Re)||Jr(Re,Fe,qe));for(Re in Ne)Ne.hasOwnProperty(Re)&&(xe.hasOwnProperty(Re)?o.deepEqual(xe[Re],Ne[Re])||(xe[Re].type==="geojson"&&Ne[Re].type==="geojson"&&ci(xe,Ne,Re)?Fe.push({command:Zr.setGeoJSONSourceData,args:[Re,Ne[Re].data]}):bi(Re,Ne,Fe,qe)):gi(Re,Ne,Fe))})(F.sources,U.sources,he,re);var me=[];F.layers&&F.layers.forEach(function(xe){re[xe.source]?X.push({command:Zr.removeLayer,args:[xe.id]}):me.push(xe)}),X=X.concat(he),function(xe,Ne,Fe){Ne=Ne||[];var qe,Re,Ze,at,ht,Ot,It,Ut=(xe=xe||[]).map(Fi),cr=Ne.map(Fi),Sr=xe.reduce(Di,{}),zr=Ne.reduce(Di,{}),sn=Ut.slice(),Cn=Object.create(null);for(qe=0,Re=0;qe<Ut.length;qe++)zr.hasOwnProperty(Ze=Ut[qe])?Re++:(Fe.push({command:Zr.removeLayer,args:[Ze]}),sn.splice(sn.indexOf(Ze,Re),1));for(qe=0,Re=0;qe<cr.length;qe++)sn[sn.length-1-qe]!==(Ze=cr[cr.length-1-qe])&&(Sr.hasOwnProperty(Ze)?(Fe.push({command:Zr.removeLayer,args:[Ze]}),sn.splice(sn.lastIndexOf(Ze,sn.length-Re),1)):Re++,Fe.push({command:Zr.addLayer,args:[zr[Ze],Ot=sn[sn.length-qe]]}),sn.splice(sn.length-qe,0,Ze),Cn[Ze]=!0);for(qe=0;qe<cr.length;qe++)if(at=Sr[Ze=cr[qe]],ht=zr[Ze],!Cn[Ze]&&!o.deepEqual(at,ht))if(o.deepEqual(at.source,ht.source)&&o.deepEqual(at["source-layer"],ht["source-layer"])&&o.deepEqual(at.type,ht.type)){for(It in Ci(at.layout,ht.layout,Fe,Ze,null,Zr.setLayoutProperty),Ci(at.paint,ht.paint,Fe,Ze,null,Zr.setPaintProperty),o.deepEqual(at.filter,ht.filter)||Fe.push({command:Zr.setFilter,args:[Ze,ht.filter]}),o.deepEqual(at.minzoom,ht.minzoom)&&o.deepEqual(at.maxzoom,ht.maxzoom)||Fe.push({command:Zr.setLayerZoomRange,args:[Ze,ht.minzoom,ht.maxzoom]}),at)at.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&(It.indexOf("paint.")===0?Ci(at[It],ht[It],Fe,Ze,It.slice(6),Zr.setPaintProperty):o.deepEqual(at[It],ht[It])||Fe.push({command:Zr.setLayerProperty,args:[Ze,It,ht[It]]}));for(It in ht)ht.hasOwnProperty(It)&&!at.hasOwnProperty(It)&&It!=="layout"&&It!=="paint"&&It!=="filter"&&It!=="metadata"&&It!=="minzoom"&&It!=="maxzoom"&&(It.indexOf("paint.")===0?Ci(at[It],ht[It],Fe,Ze,It.slice(6),Zr.setPaintProperty):o.deepEqual(at[It],ht[It])||Fe.push({command:Zr.setLayerProperty,args:[Ze,It,ht[It]]}))}else Fe.push({command:Zr.removeLayer,args:[Ze]}),Ot=sn[sn.lastIndexOf(Ze)+1],Fe.push({command:Zr.addLayer,args:[ht,Ot]})}(me,U.layers,X)}catch(xe){console.warn("Unable to compute style diff:",xe),X=[{command:Zr.setStyle,args:[U]}]}return X}(this.serialize(),v).filter(function(F){return!(F.command in mf)});if(T.length===0)return!1;var R=T.filter(function(F){return!(F.command in yu)});if(R.length>0)throw new Error("Unimplemented: "+R.map(function(F){return F.command}).join(", ")+".");return T.forEach(function(F){F.command!=="setTransition"&&x[F.command].apply(x,F.args)}),this.stylesheet=v,!0},g.prototype.addImage=function(v,x){if(this.getImage(v))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(v,x),this._afterImageUpdated(v)},g.prototype.updateImage=function(v,x){this.imageManager.updateImage(v,x)},g.prototype.getImage=function(v){return this.imageManager.getImage(v)},g.prototype.removeImage=function(v){if(!this.getImage(v))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(v),this._afterImageUpdated(v)},g.prototype._afterImageUpdated=function(v){this._availableImages=this.imageManager.listImages(),this._changedImages[v]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},g.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},g.prototype.addSource=function(v,x,T){var R=this;if(T===void 0&&(T={}),this._checkLoaded(),this.sourceCaches[v]!==void 0)throw new Error("There is already a source with this ID");if(!x.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(x).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(o.validateStyle.source,"sources."+v,x,null,T))){this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);var F=this.sourceCaches[v]=new Ve(v,x,this.dispatcher);F.style=this,F.setEventedParent(this,function(){return{isSourceLoaded:R.loaded(),source:F.serialize(),sourceId:v}}),F.onAdd(this.map),this._changed=!0}},g.prototype.removeSource=function(v){if(this._checkLoaded(),this.sourceCaches[v]===void 0)throw new Error("There is no source with this ID");for(var x in this._layers)if(this._layers[x].source===v)return this.fire(new o.ErrorEvent(new Error('Source "'+v+'" cannot be removed while layer "'+x+'" is using it.')));var T=this.sourceCaches[v];delete this.sourceCaches[v],delete this._updatedSources[v],T.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v})),T.setEventedParent(null),T.clearTiles(),T.onRemove&&T.onRemove(this.map),this._changed=!0},g.prototype.setGeoJSONSourceData=function(v,x){this._checkLoaded(),this.sourceCaches[v].getSource().setData(x),this._changed=!0},g.prototype.getSource=function(v){return this.sourceCaches[v]&&this.sourceCaches[v].getSource()},g.prototype.addLayer=function(v,x,T){T===void 0&&(T={}),this._checkLoaded();var R=v.id;if(this.getLayer(R))this.fire(new o.ErrorEvent(new Error('Layer with id "'+R+'" already exists on this map')));else{var F;if(v.type==="custom"){if(Ku(this,o.validateCustomStyleLayer(v)))return;F=o.createStyleLayer(v)}else{if(typeof v.source=="object"&&(this.addSource(R,v.source),v=o.clone$1(v),v=o.extend(v,{source:R})),this._validate(o.validateStyle.layer,"layers."+R,v,{arrayIndex:-1},T))return;F=o.createStyleLayer(v),this._validateLayer(F),F.setEventedParent(this,{layer:{id:R}}),this._serializedLayers[F.id]=F.serialize()}var U=x?this._order.indexOf(x):this._order.length;if(x&&U===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+x+'" does not exist on this map.')));else{if(this._order.splice(U,0,R),this._layerOrderChanged=!0,this._layers[R]=F,this._removedLayers[R]&&F.source&&F.type!=="custom"){var X=this._removedLayers[R];delete this._removedLayers[R],X.type!==F.type?this._updatedSources[F.source]="clear":(this._updatedSources[F.source]="reload",this.sourceCaches[F.source].pause())}this._updateLayer(F),F.onAdd&&F.onAdd(this.map)}}},g.prototype.moveLayer=function(v,x){if(this._checkLoaded(),this._changed=!0,this._layers[v]){if(v!==x){var T=this._order.indexOf(v);this._order.splice(T,1);var R=x?this._order.indexOf(x):this._order.length;x&&R===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+x+'" does not exist on this map.'))):(this._order.splice(R,0,v),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot be moved.")))},g.prototype.removeLayer=function(v){this._checkLoaded();var x=this._layers[v];if(x){x.setEventedParent(null);var T=this._order.indexOf(v);this._order.splice(T,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[v]=x,delete this._layers[v],delete this._serializedLayers[v],delete this._updatedLayers[v],delete this._updatedPaintProps[v],x.onRemove&&x.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot be removed.")))},g.prototype.getLayer=function(v){return this._layers[v]},g.prototype.hasLayer=function(v){return v in this._layers},g.prototype.setLayerZoomRange=function(v,x,T){this._checkLoaded();var R=this.getLayer(v);R?R.minzoom===x&&R.maxzoom===T||(x!=null&&(R.minzoom=x),T!=null&&(R.maxzoom=T),this._updateLayer(R)):this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot have zoom extent.")))},g.prototype.setFilter=function(v,x,T){T===void 0&&(T={}),this._checkLoaded();var R=this.getLayer(v);if(R){if(!o.deepEqual(R.filter,x))return x==null?(R.filter=void 0,void this._updateLayer(R)):void(this._validate(o.validateStyle.filter,"layers."+R.id+".filter",x,null,T)||(R.filter=o.clone$1(x),this._updateLayer(R)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot be filtered.")))},g.prototype.getFilter=function(v){return o.clone$1(this.getLayer(v).filter)},g.prototype.setLayoutProperty=function(v,x,T,R){R===void 0&&(R={}),this._checkLoaded();var F=this.getLayer(v);F?o.deepEqual(F.getLayoutProperty(x),T)||(F.setLayoutProperty(x,T,R),this._updateLayer(F)):this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot be styled.")))},g.prototype.getLayoutProperty=function(v,x){var T=this.getLayer(v);if(T)return T.getLayoutProperty(x);this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style.")))},g.prototype.setPaintProperty=function(v,x,T,R){R===void 0&&(R={}),this._checkLoaded();var F=this.getLayer(v);F?o.deepEqual(F.getPaintProperty(x),T)||(F.setPaintProperty(x,T,R)&&this._updateLayer(F),this._changed=!0,this._updatedPaintProps[v]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+v+"' does not exist in the map's style and cannot be styled.")))},g.prototype.getPaintProperty=function(v,x){return this.getLayer(v).getPaintProperty(x)},g.prototype.setFeatureState=function(v,x){this._checkLoaded();var T=v.source,R=v.sourceLayer,F=this.sourceCaches[T];if(F!==void 0){var U=F.getSource().type;U==="geojson"&&R?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||R?(v.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),F.setFeatureState(R,v.id,x)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},g.prototype.removeFeatureState=function(v,x){this._checkLoaded();var T=v.source,R=this.sourceCaches[T];if(R!==void 0){var F=R.getSource().type,U=F==="vector"?v.sourceLayer:void 0;F!=="vector"||U?x&&typeof v.id!="string"&&typeof v.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):R.removeFeatureState(U,v.id,x):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},g.prototype.getFeatureState=function(v){this._checkLoaded();var x=v.source,T=v.sourceLayer,R=this.sourceCaches[x];if(R!==void 0){if(R.getSource().type!=="vector"||T)return v.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),R.getFeatureState(T,v.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},g.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},g.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(v){return v.serialize()}),layers:this._serializeLayers(this._order)},function(v){return v!==void 0})},g.prototype._updateLayer=function(v){this._updatedLayers[v.id]=!0,v.source&&!this._updatedSources[v.source]&&this.sourceCaches[v.source].getSource().type!=="raster"&&(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause()),this._changed=!0},g.prototype._flattenAndSortRenderedFeatures=function(v){for(var x=this,T=function(Sr){return x._layers[Sr].type==="fill-extrusion"},R={},F=[],U=this._order.length-1;U>=0;U--){var X=this._order[U];if(T(X)){R[X]=U;for(var re=0,he=v;re<he.length;re+=1){var me=he[re][X];if(me)for(var xe=0,Ne=me;xe<Ne.length;xe+=1)F.push(Ne[xe])}}}F.sort(function(Sr,zr){return zr.intersectionZ-Sr.intersectionZ});for(var Fe=[],qe=this._order.length-1;qe>=0;qe--){var Re=this._order[qe];if(T(Re))for(var Ze=F.length-1;Ze>=0;Ze--){var at=F[Ze].feature;if(R[at.layer.id]<qe)break;Fe.push(at),F.pop()}else for(var ht=0,Ot=v;ht<Ot.length;ht+=1){var It=Ot[ht][Re];if(It)for(var Ut=0,cr=It;Ut<cr.length;Ut+=1)Fe.push(cr[Ut].feature)}}return Fe},g.prototype.queryRenderedFeatures=function(v,x,T){x&&x.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",x.filter,null,x);var R={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var F=0,U=x.layers;F<U.length;F+=1){var X=U[F],re=this._layers[X];if(!re)return this.fire(new o.ErrorEvent(new Error("The layer '"+X+"' does not exist in the map's style and cannot be queried for features."))),[];R[re.source]=!0}}var he=[];for(var me in x.availableImages=this._availableImages,this.sourceCaches)x.layers&&!R[me]||he.push(Ti(this.sourceCaches[me],this._layers,this._serializedLayers,v,x,T));return this.placement&&he.push(function(xe,Ne,Fe,qe,Re,Ze,at){for(var ht={},Ot=Ze.queryRenderedSymbols(qe),It=[],Ut=0,cr=Object.keys(Ot).map(Number);Ut<cr.length;Ut+=1)It.push(at[cr[Ut]]);It.sort(Sa);for(var Sr=function(){var Nn=sn[zr],ta=Nn.featureIndex.lookupSymbolFeatures(Ot[Nn.bucketInstanceId],Ne,Nn.bucketIndex,Nn.sourceLayerIndex,Re.filter,Re.layers,Re.availableImages,xe);for(var un in ta){var Zn=ht[un]=ht[un]||[],ui=ta[un];ui.sort(function(yi,Qn){var wn=Nn.featureSortOrder;if(wn){var Ba=wn.indexOf(yi.featureIndex);return wn.indexOf(Qn.featureIndex)-Ba}return Qn.featureIndex-yi.featureIndex});for(var ni=0,jn=ui;ni<jn.length;ni+=1)Zn.push(jn[ni])}},zr=0,sn=It;zr<sn.length;zr+=1)Sr();var Cn=function(Nn){ht[Nn].forEach(function(ta){var un=ta.feature,Zn=Fe[xe[Nn].source].getFeatureState(un.layer["source-layer"],un.id);un.source=un.layer.source,un.layer["source-layer"]&&(un.sourceLayer=un.layer["source-layer"]),un.state=Zn})};for(var Dn in ht)Cn(Dn);return ht}(this._layers,this._serializedLayers,this.sourceCaches,v,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(he)},g.prototype.querySourceFeatures=function(v,x){x&&x.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",x.filter,null,x);var T=this.sourceCaches[v];return T?function(R,F){for(var U=R.getRenderableIds().map(function(Ne){return R.getTileByID(Ne)}),X=[],re={},he=0;he<U.length;he++){var me=U[he],xe=me.tileID.canonical.key;re[xe]||(re[xe]=!0,me.querySourceFeatures(X,F))}return X}(T,x):[]},g.prototype.addSourceType=function(v,x,T){return g.getSourceType(v)?T(new Error('A source type called "'+v+'" already exists.')):(g.setSourceType(v,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:v,url:x.workerSourceURL},T):T(null,null))},g.prototype.getLight=function(){return this.light.getLight()},g.prototype.setLight=function(v,x){x===void 0&&(x={}),this._checkLoaded();var T=this.light.getLight(),R=!1;for(var F in v)if(!o.deepEqual(v[F],T[F])){R=!0;break}if(R){var U={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(v,x),this.light.updateTransitions(U)}},g.prototype._validate=function(v,x,T,R,F){return F===void 0&&(F={}),(!F||F.validate!==!1)&&Ku(this,v.call(o.validateStyle,o.extend({key:x,style:this.serialize(),value:T,styleSpec:o.styleSpec},R)))},g.prototype._remove=function(){for(var v in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[v].setEventedParent(null);for(var x in this.sourceCaches)this.sourceCaches[x].clearTiles(),this.sourceCaches[x].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},g.prototype._clearSource=function(v){this.sourceCaches[v].clearTiles()},g.prototype._reloadSource=function(v){this.sourceCaches[v].resume(),this.sourceCaches[v].reload()},g.prototype._updateSources=function(v){for(var x in this.sourceCaches)this.sourceCaches[x].update(v)},g.prototype._generateCollisionBoxes=function(){for(var v in this.sourceCaches)this._reloadSource(v)},g.prototype._updatePlacement=function(v,x,T,R,F){F===void 0&&(F=!1);for(var U=!1,X=!1,re={},he=0,me=this._order;he<me.length;he+=1){var xe=this._layers[me[he]];if(xe.type==="symbol"){if(!re[xe.source]){var Ne=this.sourceCaches[xe.source];re[xe.source]=Ne.getRenderableIds(!0).map(function(at){return Ne.getTileByID(at)}).sort(function(at,ht){return ht.tileID.overscaledZ-at.tileID.overscaledZ||(at.tileID.isLessThan(ht.tileID)?-1:1)})}var Fe=this.crossTileSymbolIndex.addLayer(xe,re[xe.source],v.center.lng);U=U||Fe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((F=F||this._layerOrderChanged||T===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),v.zoom))&&(this.pauseablePlacement=new Zf(v,this._order,F,x,T,R,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,re),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),X=!0),U&&this.pauseablePlacement.placement.setStale()),X||U)for(var qe=0,Re=this._order;qe<Re.length;qe+=1){var Ze=this._layers[Re[qe]];Ze.type==="symbol"&&this.placement.updateLayerOpacities(Ze,re[Ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},g.prototype._releaseSymbolFadeTiles=function(){for(var v in this.sourceCaches)this.sourceCaches[v].releaseSymbolFadeTiles()},g.prototype.getImages=function(v,x,T){this.imageManager.getImages(x.icons,T),this._updateTilesForChangedImages();var R=this.sourceCaches[x.source];R&&R.setDependencies(x.tileID.key,x.type,x.icons)},g.prototype.getGlyphs=function(v,x,T){this.glyphManager.getGlyphs(x.stacks,T)},g.prototype.getResource=function(v,x,T){return o.makeRequest(x,T)},g}(o.Evented);Ji.getSourceType=function(d){return Ar[d]},Ji.setSourceType=function(d,g){Ar[d]=g},Ji.registerForPluginStateChange=o.registerForPluginStateChange;var Ro=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),$l=va(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),dd=va(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Wv=va(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),vd=va(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Qh=va("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),_u=va(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ch=va(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Yi=va("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qu=va("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),gf=va("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Kd=va(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Oo=va(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),au=va(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Dp=va(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Po=va(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Jh=va(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Fs=va(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Oc=va(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Xs=va(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Fo=va(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),yf=va(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Do=va(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),sc=va(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Du=va(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),uc=va(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),xu=va(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function va(d,g){var v=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=g.match(/attribute ([\w]+) ([\w]+)/g),T=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=R?R.concat(T):T,U={};return{fragmentSource:d=d.replace(v,function(X,re,he,me,xe){return U[xe]=!0,re==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+he+" "+me+" "+xe+`;
#else
uniform `+he+" "+me+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+he+" "+me+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:g=g.replace(v,function(X,re,he,me,xe){var Ne=me==="float"?"vec2":"vec4",Fe=xe.match(/color/)?"color":Ne;return U[xe]?re==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+he+" "+Ne+" a_"+xe+`;
varying `+he+" "+me+" "+xe+`;
#else
uniform `+he+" "+me+" u_"+xe+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+he+" "+me+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Fe+"(a_"+xe+", u_"+xe+`_t);
#else
    `+he+" "+me+" "+xe+" = u_"+xe+`;
#endif
`:re==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+he+" "+Ne+" a_"+xe+`;
#else
uniform `+he+" "+me+" u_"+xe+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+he+" "+me+" "+xe+" = a_"+xe+`;
#else
    `+he+" "+me+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+he+" "+me+" "+xe+" = unpack_mix_"+Fe+"(a_"+xe+", u_"+xe+`_t);
#else
    `+he+" "+me+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:x,staticUniforms:F}}var ro=Object.freeze({__proto__:null,prelude:$l,background:dd,backgroundPattern:Wv,circle:vd,clippingMask:Qh,heatmap:_u,heatmapTexture:Ch,collisionBox:Yi,collisionCircle:Qu,debug:gf,fill:Kd,fillOutline:Oo,fillOutlinePattern:au,fillPattern:Dp,fillExtrusion:Po,fillExtrusionPattern:Jh,hillshadePrepare:Fs,hillshade:Oc,line:Xs,lineGradient:Fo,linePattern:yf,lineSDF:Do,raster:sc,symbolIcon:Du,symbolSDF:uc,symbolTextAndIcon:xu}),ou=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ep(d){for(var g=[],v=0;v<d.length;v++)if(d[v]!==null){var x=d[v].split(" ");g.push(x.pop())}return g}ou.prototype.bind=function(d,g,v,x,T,R,F,U){this.context=d;for(var X=this.boundPaintVertexBuffers.length!==x.length,re=0;!X&&re<x.length;re++)this.boundPaintVertexBuffers[re]!==x[re]&&(X=!0);d.extVertexArrayObject&&this.vao&&this.boundProgram===g&&this.boundLayoutVertexBuffer===v&&!X&&this.boundIndexBuffer===T&&this.boundVertexOffset===R&&this.boundDynamicVertexBuffer===F&&this.boundDynamicVertexBuffer2===U?(d.bindVertexArrayOES.set(this.vao),F&&F.bind(),T&&T.dynamicDraw&&T.bind(),U&&U.bind()):this.freshBind(g,v,x,T,R,F,U)},ou.prototype.freshBind=function(d,g,v,x,T,R,F){var U,X=d.numAttributes,re=this.context,he=re.gl;if(re.extVertexArrayObject)this.vao&&this.destroy(),this.vao=re.extVertexArrayObject.createVertexArrayOES(),re.bindVertexArrayOES.set(this.vao),U=0,this.boundProgram=d,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=x,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=F;else{U=re.currentNumAttributes||0;for(var me=X;me<U;me++)he.disableVertexAttribArray(me)}g.enableAttributes(he,d);for(var xe=0,Ne=v;xe<Ne.length;xe+=1)Ne[xe].enableAttributes(he,d);R&&R.enableAttributes(he,d),F&&F.enableAttributes(he,d),g.bind(),g.setVertexAttribPointers(he,d,T);for(var Fe=0,qe=v;Fe<qe.length;Fe+=1){var Re=qe[Fe];Re.bind(),Re.setVertexAttribPointers(he,d,T)}R&&(R.bind(),R.setVertexAttribPointers(he,d,T)),x&&x.bind(),F&&(F.bind(),F.setVertexAttribPointers(he,d,T)),re.currentNumAttributes=X},ou.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var tp=function(d,g,v,x,T,R){var F=d.gl;this.program=F.createProgram();for(var U=ep(v.staticAttributes),X=x?x.getBinderAttributes():[],re=U.concat(X),he=v.staticUniforms?ep(v.staticUniforms):[],me=x?x.getBinderUniforms():[],xe=[],Ne=0,Fe=he.concat(me);Ne<Fe.length;Ne+=1){var qe=Fe[Ne];xe.indexOf(qe)<0&&xe.push(qe)}var Re=x?x.defines():[];R&&Re.push("#define OVERDRAW_INSPECTOR;");var Ze=Re.concat($l.fragmentSource,v.fragmentSource).join(`
`),at=Re.concat($l.vertexSource,v.vertexSource).join(`
`),ht=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(ht,Ze),F.compileShader(ht),F.attachShader(this.program,ht);var Ot=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(Ot,at),F.compileShader(Ot),F.attachShader(this.program,Ot),this.attributes={};var It={};this.numAttributes=re.length;for(var Ut=0;Ut<this.numAttributes;Ut++)re[Ut]&&(F.bindAttribLocation(this.program,Ut,re[Ut]),this.attributes[re[Ut]]=Ut);F.linkProgram(this.program),F.deleteShader(Ot),F.deleteShader(ht);for(var cr=0;cr<xe.length;cr++){var Sr=xe[cr];if(Sr&&!It[Sr]){var zr=F.getUniformLocation(this.program,Sr);zr&&(It[Sr]=zr)}}this.fixedUniforms=T(d,It),this.binderUniforms=x?x.getUniforms(d,It):[]}}};function Sh(d,g,v){var x=1/Da(v,1,g.transform.tileZoom),T=Math.pow(2,v.tileID.overscaledZ),R=v.tileSize*Math.pow(2,g.transform.tileZoom)/T,F=R*(v.tileID.canonical.x+v.tileID.wrap*T),U=R*v.tileID.canonical.y;return{u_image:0,u_texsize:v.imageAtlasTexture.size,u_scale:[x,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[F>>16,U>>16],u_pixel_coord_lower:[65535&F,65535&U]}}tp.prototype.draw=function(d,g,v,x,T,R,F,U,X,re,he,me,xe,Ne,Fe,qe){var Re,Ze=d.gl;if(!this.failedToCreate){for(var at in d.program.set(this.program),d.setDepthMode(v),d.setStencilMode(x),d.setColorMode(T),d.setCullFace(R),this.fixedUniforms)this.fixedUniforms[at].set(F[at]);Ne&&Ne.setUniforms(d,this.binderUniforms,me,{zoom:xe});for(var ht=(Re={},Re[Ze.LINES]=2,Re[Ze.TRIANGLES]=3,Re[Ze.LINE_STRIP]=1,Re)[g],Ot=0,It=he.get();Ot<It.length;Ot+=1){var Ut=It[Ot],cr=Ut.vaos||(Ut.vaos={});(cr[U]||(cr[U]=new ou)).bind(d,this,X,Ne?Ne.getPaintVertexBuffers():[],re,Ut.vertexOffset,Fe,qe),Ze.drawElements(g,Ut.primitiveLength*ht,Ze.UNSIGNED_SHORT,Ut.primitiveOffset*ht*2)}}};var Qd=function(d,g,v,x){var T=g.style.light,R=T.properties.get("position"),F=[R.x,R.y,R.z],U=o.create$1();T.properties.get("anchor")==="viewport"&&o.fromRotation(U,-g.transform.angle),o.transformMat3(F,F,U);var X=T.properties.get("color");return{u_matrix:d,u_lightpos:F,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+v,u_opacity:x}},Pc=function(d,g,v,x,T,R,F){return o.extend(Qd(d,g,v,x),Sh(R,g,F),{u_height_factor:-Math.pow(2,T.overscaledZ)/F.tileSize/8})},Wa=function(d){return{u_matrix:d}},lc=function(d,g,v,x){return o.extend(Wa(d),Sh(v,g,x))},wh=function(d,g){return{u_matrix:d,u_world:g}},Zs=function(d,g,v,x,T){return o.extend(lc(d,g,v,x),{u_world:T})},Ah=function(d,g,v,x){var T,R,F=d.transform;if(x.paint.get("circle-pitch-alignment")==="map"){var U=Da(v,1,F.zoom);T=!0,R=[U,U]}else T=!1,R=F.pixelsToGLUnits;return{u_camera_to_center_distance:F.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(g.posMatrix,v,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:R}},bu=function(d,g,v){var x=Da(v,1,g.zoom),T=Math.pow(2,g.zoom-v.tileID.overscaledZ),R=v.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:g.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[g.pixelsToGLUnits[0]/(x*T),g.pixelsToGLUnits[1]/(x*T)],u_overscale_factor:R}},Fc=function(d,g,v){return{u_matrix:d,u_inv_matrix:g,u_camera_to_center_distance:v.cameraToCenterDistance,u_viewport_size:[v.width,v.height]}},Ys=function(d,g,v){return v===void 0&&(v=1),{u_matrix:d,u_color:g,u_overlay:0,u_overlay_scale:v}},Bu=function(d){return{u_matrix:d}},Xl=function(d,g,v,x){return{u_matrix:d,u_extrude_scale:Da(g,1,v),u_intensity:x}},_f=function(d,g,v){var x=d.transform;return{u_matrix:Nu(d,g,v),u_ratio:1/Da(g,1,x.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},ka=function(d,g,v,x){return o.extend(_f(d,g,v),{u_image:0,u_image_height:x})},Dc=function(d,g,v,x){var T=d.transform,R=Bc(g,T);return{u_matrix:Nu(d,g,v),u_texsize:g.imageAtlasTexture.size,u_ratio:1/Da(g,1,T.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[R,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Bp=function(d,g,v,x,T){var R=d.lineAtlas,F=Bc(g,d.transform),U=v.layout.get("line-cap")==="round",X=R.getDash(x.from,U),re=R.getDash(x.to,U),he=X.width*T.fromScale,me=re.width*T.toScale;return o.extend(_f(d,g,v),{u_patternscale_a:[F/he,-X.height/2],u_patternscale_b:[F/me,-re.height/2],u_sdfgamma:R.width/(256*Math.min(he,me)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:X.y,u_tex_y_b:re.y,u_mix:T.t})};function Bc(d,g){return 1/Da(d,1,g.tileZoom)}function Nu(d,g,v){return d.translatePosMatrix(g.tileID.posMatrix,g,v.paint.get("line-translate"),v.paint.get("line-translate-anchor"))}var rp=function(d,g,v,x,T){return{u_matrix:d,u_tl_parent:g,u_scale_parent:v,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(F=T.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(R=T.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:Th(T.paint.get("raster-hue-rotate"))};var R,F};function Th(d){d*=Math.PI/180;var g=Math.sin(d),v=Math.cos(d);return[(2*v+1)/3,(-Math.sqrt(3)*g-v+1)/3,(Math.sqrt(3)*g-v+1)/3]}var xf,cc=function(d,g,v,x,T,R,F,U,X,re){var he=T.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:g?g.uSizeT:0,u_size:g?g.uSize:0,u_camera_to_center_distance:he.cameraToCenterDistance,u_pitch:he.pitch/360*2*Math.PI,u_rotate_symbol:+v,u_aspect_ratio:he.width/he.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:R,u_label_plane_matrix:F,u_coord_matrix:U,u_is_text:+X,u_pitch_with_map:+x,u_texsize:re,u_texture:0}},Nc=function(d,g,v,x,T,R,F,U,X,re,he){var me=T.transform;return o.extend(cc(d,g,v,x,T,R,F,U,X,re),{u_gamma_scale:x?Math.cos(me._pitch)*me.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:+he})},fc=function(d,g,v,x,T,R,F,U,X,re){return o.extend(Nc(d,g,v,x,T,R,F,U,!0,X,!0),{u_texsize_icon:re,u_texture_icon:1})},_l=function(d,g,v){return{u_matrix:d,u_opacity:g,u_color:v}},hc=function(d,g,v,x,T,R){return o.extend(function(F,U,X,re){var he=X.imageManager.getPattern(F.from.toString()),me=X.imageManager.getPattern(F.to.toString()),xe=X.imageManager.getPixelSize(),Ne=xe.width,Fe=xe.height,qe=Math.pow(2,re.tileID.overscaledZ),Re=re.tileSize*Math.pow(2,X.transform.tileZoom)/qe,Ze=Re*(re.tileID.canonical.x+re.tileID.wrap*qe),at=Re*re.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:he.tl,u_pattern_br_a:he.br,u_pattern_tl_b:me.tl,u_pattern_br_b:me.br,u_texsize:[Ne,Fe],u_mix:U.t,u_pattern_size_a:he.displaySize,u_pattern_size_b:me.displaySize,u_scale_a:U.fromScale,u_scale_b:U.toScale,u_tile_units_to_pixels:1/Da(re,1,X.transform.tileZoom),u_pixel_coord_upper:[Ze>>16,at>>16],u_pixel_coord_lower:[65535&Ze,65535&at]}}(x,R,v,T),{u_matrix:d,u_opacity:g})},np={fillExtrusion:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_lightpos:new o.Uniform3f(d,g.u_lightpos),u_lightintensity:new o.Uniform1f(d,g.u_lightintensity),u_lightcolor:new o.Uniform3f(d,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,g.u_vertical_gradient),u_opacity:new o.Uniform1f(d,g.u_opacity)}},fillExtrusionPattern:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_lightpos:new o.Uniform3f(d,g.u_lightpos),u_lightintensity:new o.Uniform1f(d,g.u_lightintensity),u_lightcolor:new o.Uniform3f(d,g.u_lightcolor),u_vertical_gradient:new o.Uniform1f(d,g.u_vertical_gradient),u_height_factor:new o.Uniform1f(d,g.u_height_factor),u_image:new o.Uniform1i(d,g.u_image),u_texsize:new o.Uniform2f(d,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,g.u_scale),u_fade:new o.Uniform1f(d,g.u_fade),u_opacity:new o.Uniform1f(d,g.u_opacity)}},fill:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix)}},fillPattern:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_image:new o.Uniform1i(d,g.u_image),u_texsize:new o.Uniform2f(d,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,g.u_scale),u_fade:new o.Uniform1f(d,g.u_fade)}},fillOutline:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_world:new o.Uniform2f(d,g.u_world)}},fillOutlinePattern:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_world:new o.Uniform2f(d,g.u_world),u_image:new o.Uniform1i(d,g.u_image),u_texsize:new o.Uniform2f(d,g.u_texsize),u_pixel_coord_upper:new o.Uniform2f(d,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,g.u_pixel_coord_lower),u_scale:new o.Uniform3f(d,g.u_scale),u_fade:new o.Uniform1f(d,g.u_fade)}},circle:function(d,g){return{u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(d,g.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(d,g.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(d,g.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(d,g.u_matrix)}},collisionBox:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(d,g.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(d,g.u_extrude_scale),u_overscale_factor:new o.Uniform1f(d,g.u_overscale_factor)}},collisionCircle:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_inv_matrix:new o.UniformMatrix4f(d,g.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(d,g.u_viewport_size)}},debug:function(d,g){return{u_color:new o.UniformColor(d,g.u_color),u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_overlay:new o.Uniform1i(d,g.u_overlay),u_overlay_scale:new o.Uniform1f(d,g.u_overlay_scale)}},clippingMask:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix)}},heatmap:function(d,g){return{u_extrude_scale:new o.Uniform1f(d,g.u_extrude_scale),u_intensity:new o.Uniform1f(d,g.u_intensity),u_matrix:new o.UniformMatrix4f(d,g.u_matrix)}},heatmapTexture:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_world:new o.Uniform2f(d,g.u_world),u_image:new o.Uniform1i(d,g.u_image),u_color_ramp:new o.Uniform1i(d,g.u_color_ramp),u_opacity:new o.Uniform1f(d,g.u_opacity)}},hillshade:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_image:new o.Uniform1i(d,g.u_image),u_latrange:new o.Uniform2f(d,g.u_latrange),u_light:new o.Uniform2f(d,g.u_light),u_shadow:new o.UniformColor(d,g.u_shadow),u_highlight:new o.UniformColor(d,g.u_highlight),u_accent:new o.UniformColor(d,g.u_accent)}},hillshadePrepare:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_image:new o.Uniform1i(d,g.u_image),u_dimension:new o.Uniform2f(d,g.u_dimension),u_zoom:new o.Uniform1f(d,g.u_zoom),u_unpack:new o.Uniform4f(d,g.u_unpack)}},line:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_ratio:new o.Uniform1f(d,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,g.u_units_to_pixels)}},lineGradient:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_ratio:new o.Uniform1f(d,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,g.u_units_to_pixels),u_image:new o.Uniform1i(d,g.u_image),u_image_height:new o.Uniform1f(d,g.u_image_height)}},linePattern:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_texsize:new o.Uniform2f(d,g.u_texsize),u_ratio:new o.Uniform1f(d,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_image:new o.Uniform1i(d,g.u_image),u_units_to_pixels:new o.Uniform2f(d,g.u_units_to_pixels),u_scale:new o.Uniform3f(d,g.u_scale),u_fade:new o.Uniform1f(d,g.u_fade)}},lineSDF:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_ratio:new o.Uniform1f(d,g.u_ratio),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(d,g.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(d,g.u_patternscale_a),u_patternscale_b:new o.Uniform2f(d,g.u_patternscale_b),u_sdfgamma:new o.Uniform1f(d,g.u_sdfgamma),u_image:new o.Uniform1i(d,g.u_image),u_tex_y_a:new o.Uniform1f(d,g.u_tex_y_a),u_tex_y_b:new o.Uniform1f(d,g.u_tex_y_b),u_mix:new o.Uniform1f(d,g.u_mix)}},raster:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_tl_parent:new o.Uniform2f(d,g.u_tl_parent),u_scale_parent:new o.Uniform1f(d,g.u_scale_parent),u_buffer_scale:new o.Uniform1f(d,g.u_buffer_scale),u_fade_t:new o.Uniform1f(d,g.u_fade_t),u_opacity:new o.Uniform1f(d,g.u_opacity),u_image0:new o.Uniform1i(d,g.u_image0),u_image1:new o.Uniform1i(d,g.u_image1),u_brightness_low:new o.Uniform1f(d,g.u_brightness_low),u_brightness_high:new o.Uniform1f(d,g.u_brightness_high),u_saturation_factor:new o.Uniform1f(d,g.u_saturation_factor),u_contrast_factor:new o.Uniform1f(d,g.u_contrast_factor),u_spin_weights:new o.Uniform3f(d,g.u_spin_weights)}},symbolIcon:function(d,g){return{u_is_size_zoom_constant:new o.Uniform1i(d,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,g.u_size_t),u_size:new o.Uniform1f(d,g.u_size),u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,g.u_pitch),u_rotate_symbol:new o.Uniform1i(d,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,g.u_fade_change),u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,g.u_coord_matrix),u_is_text:new o.Uniform1i(d,g.u_is_text),u_pitch_with_map:new o.Uniform1i(d,g.u_pitch_with_map),u_texsize:new o.Uniform2f(d,g.u_texsize),u_texture:new o.Uniform1i(d,g.u_texture)}},symbolSDF:function(d,g){return{u_is_size_zoom_constant:new o.Uniform1i(d,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,g.u_size_t),u_size:new o.Uniform1f(d,g.u_size),u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,g.u_pitch),u_rotate_symbol:new o.Uniform1i(d,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,g.u_fade_change),u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,g.u_coord_matrix),u_is_text:new o.Uniform1i(d,g.u_is_text),u_pitch_with_map:new o.Uniform1i(d,g.u_pitch_with_map),u_texsize:new o.Uniform2f(d,g.u_texsize),u_texture:new o.Uniform1i(d,g.u_texture),u_gamma_scale:new o.Uniform1f(d,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,g.u_is_halo)}},symbolTextAndIcon:function(d,g){return{u_is_size_zoom_constant:new o.Uniform1i(d,g.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(d,g.u_is_size_feature_constant),u_size_t:new o.Uniform1f(d,g.u_size_t),u_size:new o.Uniform1f(d,g.u_size),u_camera_to_center_distance:new o.Uniform1f(d,g.u_camera_to_center_distance),u_pitch:new o.Uniform1f(d,g.u_pitch),u_rotate_symbol:new o.Uniform1i(d,g.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(d,g.u_aspect_ratio),u_fade_change:new o.Uniform1f(d,g.u_fade_change),u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(d,g.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(d,g.u_coord_matrix),u_is_text:new o.Uniform1i(d,g.u_is_text),u_pitch_with_map:new o.Uniform1i(d,g.u_pitch_with_map),u_texsize:new o.Uniform2f(d,g.u_texsize),u_texsize_icon:new o.Uniform2f(d,g.u_texsize_icon),u_texture:new o.Uniform1i(d,g.u_texture),u_texture_icon:new o.Uniform1i(d,g.u_texture_icon),u_gamma_scale:new o.Uniform1f(d,g.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(d,g.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(d,g.u_is_halo)}},background:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_opacity:new o.Uniform1f(d,g.u_opacity),u_color:new o.UniformColor(d,g.u_color)}},backgroundPattern:function(d,g){return{u_matrix:new o.UniformMatrix4f(d,g.u_matrix),u_opacity:new o.Uniform1f(d,g.u_opacity),u_image:new o.Uniform1i(d,g.u_image),u_pattern_tl_a:new o.Uniform2f(d,g.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(d,g.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(d,g.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(d,g.u_pattern_br_b),u_texsize:new o.Uniform2f(d,g.u_texsize),u_mix:new o.Uniform1f(d,g.u_mix),u_pattern_size_a:new o.Uniform2f(d,g.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(d,g.u_pattern_size_b),u_scale_a:new o.Uniform1f(d,g.u_scale_a),u_scale_b:new o.Uniform1f(d,g.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(d,g.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(d,g.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(d,g.u_tile_units_to_pixels)}}};function zu(d,g,v,x,T,R,F){for(var U=d.context,X=U.gl,re=d.useProgram("collisionBox"),he=[],me=0,xe=0,Ne=0;Ne<x.length;Ne++){var Fe=x[Ne],qe=g.getTile(Fe),Re=qe.getBucket(v);if(Re){var Ze=Fe.posMatrix;T[0]===0&&T[1]===0||(Ze=d.translatePosMatrix(Fe.posMatrix,qe,T,R));var at=F?Re.textCollisionBox:Re.iconCollisionBox,ht=Re.collisionCircleArray;if(ht.length>0){var Ot=o.create(),It=Ze;o.mul(Ot,Re.placementInvProjMatrix,d.transform.glCoordMatrix),o.mul(Ot,Ot,Re.placementViewportMatrix),he.push({circleArray:ht,circleOffset:xe,transform:It,invTransform:Ot}),xe=me+=ht.length/4}at&&re.draw(U,X.LINES,be.disabled,Be.disabled,d.colorModeForRenderPass(),ot.disabled,bu(Ze,d.transform,qe),v.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,d.transform.zoom,null,null,at.collisionVertexBuffer)}}if(F&&he.length){var Ut=d.useProgram("collisionCircle"),cr=new o.StructArrayLayout2f1f2i16;cr.resize(4*me),cr._trim();for(var Sr=0,zr=0,sn=he;zr<sn.length;zr+=1)for(var Cn=sn[zr],Dn=0;Dn<Cn.circleArray.length/4;Dn++){var Nn=4*Dn,ta=Cn.circleArray[Nn+0],un=Cn.circleArray[Nn+1],Zn=Cn.circleArray[Nn+2],ui=Cn.circleArray[Nn+3];cr.emplace(Sr++,ta,un,Zn,ui,0),cr.emplace(Sr++,ta,un,Zn,ui,1),cr.emplace(Sr++,ta,un,Zn,ui,2),cr.emplace(Sr++,ta,un,Zn,ui,3)}(!xf||xf.length<2*me)&&(xf=function(co){var io=2*co,So=new o.StructArrayLayout3ui6;So.resize(io),So._trim();for(var Ka=0;Ka<io;Ka++){var Na=6*Ka;So.uint16[Na+0]=4*Ka+0,So.uint16[Na+1]=4*Ka+1,So.uint16[Na+2]=4*Ka+2,So.uint16[Na+3]=4*Ka+2,So.uint16[Na+4]=4*Ka+3,So.uint16[Na+5]=4*Ka+0}return So}(me));for(var ni=U.createIndexBuffer(xf,!0),jn=U.createVertexBuffer(cr,o.collisionCircleLayout.members,!0),yi=0,Qn=he;yi<Qn.length;yi+=1){var wn=Qn[yi],Ba=Fc(wn.transform,wn.invTransform,d.transform);Ut.draw(U,X.TRIANGLES,be.disabled,Be.disabled,d.colorModeForRenderPass(),ot.disabled,Ba,v.id,jn,ni,o.SegmentVector.simpleSegment(0,2*wn.circleOffset,wn.circleArray.length,wn.circleArray.length/2),null,d.transform.zoom,null,null,null)}jn.destroy(),ni.destroy()}}var qs=o.identity(new Float32Array(16));function zc(d,g,v,x,T,R){var F=o.getAnchorAlignment(d),U=-(F.horizontalAlign-.5)*g,X=-(F.verticalAlign-.5)*v,re=o.evaluateVariableOffset(d,x);return new o.Point((U/T+re[0])*R,(X/T+re[1])*R)}function Uc(d,g,v,x,T,R,F,U,X,re,he){var me=d.text.placedSymbolArray,xe=d.text.dynamicLayoutVertexArray,Ne=d.icon.dynamicLayoutVertexArray,Fe={};xe.clear();for(var qe=0;qe<me.length;qe++){var Re=me.get(qe),Ze=Re.hidden||!Re.crossTileID||d.allowVerticalPlacement&&!Re.placedOrientation?null:x[Re.crossTileID];if(Ze){var at=new o.Point(Re.anchorX,Re.anchorY),ht=pi(at,v?U:F),Ot=Li(R.cameraToCenterDistance,ht.signedDistanceFromCamera),It=T.evaluateSizeForFeature(d.textSizeData,re,Re)*Ot/o.ONE_EM;v&&(It*=d.tilePixelRatio/X);for(var Ut=zc(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale,It),cr=v?pi(at.add(Ut),F).point:ht.point.add(g?Ut.rotate(-R.angle):Ut),Sr=d.allowVerticalPlacement&&Re.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,zr=0;zr<Re.numGlyphs;zr++)o.addDynamicAttributes(xe,cr,Sr);he&&Re.associatedIconIndex>=0&&(Fe[Re.associatedIconIndex]={shiftedAnchor:cr,angle:Sr})}else ns(Re.numGlyphs,xe)}if(he){Ne.clear();for(var sn=d.icon.placedSymbolArray,Cn=0;Cn<sn.length;Cn++){var Dn=sn.get(Cn);if(Dn.hidden)ns(Dn.numGlyphs,Ne);else{var Nn=Fe[Cn];if(Nn)for(var ta=0;ta<Dn.numGlyphs;ta++)o.addDynamicAttributes(Ne,Nn.shiftedAnchor,Nn.angle);else ns(Dn.numGlyphs,Ne)}}d.icon.dynamicLayoutVertexBuffer.updateData(Ne)}d.text.dynamicLayoutVertexBuffer.updateData(xe)}function Vc(d,g,v){return v.iconsInText&&g?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Ks(d,g,v,x,T,R,F,U,X,re,he,me){for(var xe=d.context,Ne=xe.gl,Fe=d.transform,qe=U==="map",Re=X==="map",Ze=qe&&v.layout.get("symbol-placement")!=="point",at=qe&&!Re&&!Ze,ht=v.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ot=!1,It=d.depthModeForSublayer(0,be.ReadOnly),Ut=v.layout.get("text-variable-anchor"),cr=[],Sr=0,zr=x;Sr<zr.length;Sr+=1){var sn=zr[Sr],Cn=g.getTile(sn),Dn=Cn.getBucket(v);if(Dn){var Nn=T?Dn.text:Dn.icon;if(Nn&&Nn.segments.get().length){var ta=Nn.programConfigurations.get(v.id),un=T||Dn.sdfIcons,Zn=T?Dn.textSizeData:Dn.iconSizeData,ui=Re||Fe.pitch!==0,ni=d.useProgram(Vc(un,T,Dn),ta),jn=o.evaluateSizeForZoom(Zn,Fe.zoom),yi=void 0,Qn=[0,0],wn=void 0,Ba=void 0,co=null,io=void 0;if(T)wn=Cn.glyphAtlasTexture,Ba=Ne.LINEAR,yi=Cn.glyphAtlasTexture.size,Dn.iconsInText&&(Qn=Cn.imageAtlasTexture.size,co=Cn.imageAtlasTexture,io=ui||d.options.rotating||d.options.zooming||Zn.kind==="composite"||Zn.kind==="camera"?Ne.LINEAR:Ne.NEAREST);else{var So=v.layout.get("icon-size").constantOr(0)!==1||Dn.iconsNeedLinear;wn=Cn.imageAtlasTexture,Ba=un||d.options.rotating||d.options.zooming||So||ui?Ne.LINEAR:Ne.NEAREST,yi=Cn.imageAtlasTexture.size}var Ka=Da(Cn,1,d.transform.zoom),Na=Zi(sn.posMatrix,Re,qe,d.transform,Ka),Cs=ia(sn.posMatrix,Re,qe,d.transform,Ka),Ra=Ut&&Dn.hasTextData(),Ss=v.layout.get("icon-text-fit")!=="none"&&Ra&&Dn.hasIconData();Ze&&pa(Dn,sn.posMatrix,d,T,Na,Cs,Re,re);var zs=d.translatePosMatrix(sn.posMatrix,Cn,R,F),nl=Ze||T&&Ut||Ss?qs:Na,Au=d.translatePosMatrix(Cs,Cn,R,F,!0),Zc=un&&v.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0,nh={program:ni,buffers:Nn,uniformValues:un?Dn.iconsInText?fc(Zn.kind,jn,at,Re,d,zs,nl,Au,yi,Qn):Nc(Zn.kind,jn,at,Re,d,zs,nl,Au,T,yi,!0):cc(Zn.kind,jn,at,Re,d,zs,nl,Au,T,yi),atlasTexture:wn,atlasTextureIcon:co,atlasInterpolation:Ba,atlasInterpolationIcon:io,isSDF:un,hasHalo:Zc};if(ht&&Dn.canOverlap){Ot=!0;for(var il=0,Yc=Nn.segments.get();il<Yc.length;il+=1){var Tf=Yc[il];cr.push({segments:new o.SegmentVector([Tf]),sortKey:Tf.sortKey,state:nh})}}else cr.push({segments:Nn.segments,sortKey:0,state:nh})}}}Ot&&cr.sort(function(yc,Mf){return yc.sortKey-Mf.sortKey});for(var Gu=0,Tu=cr;Gu<Tu.length;Gu+=1){var Ql=Tu[Gu],Zo=Ql.state;if(xe.activeTexture.set(Ne.TEXTURE0),Zo.atlasTexture.bind(Zo.atlasInterpolation,Ne.CLAMP_TO_EDGE),Zo.atlasTextureIcon&&(xe.activeTexture.set(Ne.TEXTURE1),Zo.atlasTextureIcon&&Zo.atlasTextureIcon.bind(Zo.atlasInterpolationIcon,Ne.CLAMP_TO_EDGE)),Zo.isSDF){var al=Zo.uniformValues;Zo.hasHalo&&(al.u_is_halo=1,Zl(Zo.buffers,Ql.segments,v,d,Zo.program,It,he,me,al)),al.u_is_halo=0}Zl(Zo.buffers,Ql.segments,v,d,Zo.program,It,he,me,Zo.uniformValues)}}function Zl(d,g,v,x,T,R,F,U,X){var re=x.context;T.draw(re,re.gl.TRIANGLES,R,F,U,ot.disabled,X,v.id,d.layoutVertexBuffer,d.indexBuffer,g,v.paint,x.transform.zoom,d.programConfigurations.get(v.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Yf(d,g,v,x,T,R,F){var U,X,re,he,me,xe=d.context.gl,Ne=v.paint.get("fill-pattern"),Fe=Ne&&Ne.constantOr(1),qe=v.getCrossfadeParameters();F?(X=Fe&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=xe.LINES):(X=Fe?"fillPattern":"fill",U=xe.TRIANGLES);for(var Re=0,Ze=x;Re<Ze.length;Re+=1){var at=Ze[Re],ht=g.getTile(at);if(!Fe||ht.patternsLoaded()){var Ot=ht.getBucket(v);if(Ot){var It=Ot.programConfigurations.get(v.id),Ut=d.useProgram(X,It);Fe&&(d.context.activeTexture.set(xe.TEXTURE0),ht.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),It.updatePaintBuffers(qe));var cr=Ne.constantOr(null);if(cr&&ht.imageAtlas){var Sr=ht.imageAtlas,zr=Sr.patternPositions[cr.to.toString()],sn=Sr.patternPositions[cr.from.toString()];zr&&sn&&It.setConstantPatternPositions(zr,sn)}var Cn=d.translatePosMatrix(at.posMatrix,ht,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));if(F){he=Ot.indexBuffer2,me=Ot.segments2;var Dn=[xe.drawingBufferWidth,xe.drawingBufferHeight];re=X==="fillOutlinePattern"&&Fe?Zs(Cn,d,qe,ht,Dn):wh(Cn,Dn)}else he=Ot.indexBuffer,me=Ot.segments,re=Fe?lc(Cn,d,qe,ht):Wa(Cn);Ut.draw(d.context,U,T,d.stencilModeForClipping(at),R,ot.disabled,re,v.id,Ot.layoutVertexBuffer,he,me,v.paint,d.transform.zoom,It)}}}}function ip(d,g,v,x,T,R,F){for(var U=d.context,X=U.gl,re=v.paint.get("fill-extrusion-pattern"),he=re.constantOr(1),me=v.getCrossfadeParameters(),xe=v.paint.get("fill-extrusion-opacity"),Ne=0,Fe=x;Ne<Fe.length;Ne+=1){var qe=Fe[Ne],Re=g.getTile(qe),Ze=Re.getBucket(v);if(Ze){var at=Ze.programConfigurations.get(v.id),ht=d.useProgram(he?"fillExtrusionPattern":"fillExtrusion",at);he&&(d.context.activeTexture.set(X.TEXTURE0),Re.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),at.updatePaintBuffers(me));var Ot=re.constantOr(null);if(Ot&&Re.imageAtlas){var It=Re.imageAtlas,Ut=It.patternPositions[Ot.to.toString()],cr=It.patternPositions[Ot.from.toString()];Ut&&cr&&at.setConstantPatternPositions(Ut,cr)}var Sr=d.translatePosMatrix(qe.posMatrix,Re,v.paint.get("fill-extrusion-translate"),v.paint.get("fill-extrusion-translate-anchor")),zr=v.paint.get("fill-extrusion-vertical-gradient"),sn=he?Pc(Sr,d,zr,xe,qe,me,Re):Qd(Sr,d,zr,xe);ht.draw(U,U.gl.TRIANGLES,T,R,F,ot.backCCW,sn,v.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,v.paint,d.transform.zoom,at)}}}function Mh(d,g,v,x,T,R){var F=d.context,U=F.gl,X=g.fbo;if(X){var re=d.useProgram("hillshade");F.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,X.colorAttachment.get());var he=function(me,xe,Ne){var Fe=Ne.paint.get("hillshade-shadow-color"),qe=Ne.paint.get("hillshade-highlight-color"),Re=Ne.paint.get("hillshade-accent-color"),Ze=Ne.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ne.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ze-=me.transform.angle);var at,ht,Ot,It=!me.options.moving;return{u_matrix:me.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),It),u_image:0,u_latrange:(at=xe.tileID,ht=Math.pow(2,at.canonical.z),Ot=at.canonical.y,[new o.MercatorCoordinate(0,Ot/ht).toLngLat().lat,new o.MercatorCoordinate(0,(Ot+1)/ht).toLngLat().lat]),u_light:[Ne.paint.get("hillshade-exaggeration"),Ze],u_shadow:Fe,u_highlight:qe,u_accent:Re}}(d,g,v);re.draw(F,U.TRIANGLES,x,T,R,ot.disabled,he,v.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}}function Yl(d,g,v,x,T,R){var F=d.context,U=F.gl,X=g.dem;if(X&&X.data){var re=X.dim,he=X.stride,me=X.getPixels();if(F.activeTexture.set(U.TEXTURE1),F.pixelStoreUnpackPremultiplyAlpha.set(!1),g.demTexture=g.demTexture||d.getTileTexture(he),g.demTexture){var xe=g.demTexture;xe.update(me,{premultiply:!1}),xe.bind(U.NEAREST,U.CLAMP_TO_EDGE)}else g.demTexture=new o.Texture(F,me,U.RGBA,{premultiply:!1}),g.demTexture.bind(U.NEAREST,U.CLAMP_TO_EDGE);F.activeTexture.set(U.TEXTURE0);var Ne=g.fbo;if(!Ne){var Fe=new o.Texture(F,{width:re,height:re,data:null},U.RGBA);Fe.bind(U.LINEAR,U.CLAMP_TO_EDGE),(Ne=g.fbo=F.createFramebuffer(re,re,!0)).colorAttachment.set(Fe.texture)}F.bindFramebuffer.set(Ne.framebuffer),F.viewport.set([0,0,re,re]),d.useProgram("hillshadePrepare").draw(F,U.TRIANGLES,x,T,R,ot.disabled,function(qe,Re){var Ze=Re.stride,at=o.create();return o.ortho(at,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(at,at,[0,-o.EXTENT,0]),{u_matrix:at,u_image:1,u_dimension:[Ze,Ze],u_zoom:qe.overscaledZ,u_unpack:Re.getUnpackVector()}}(g.tileID,X),v.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),g.needsHillshadePrepare=!1}}function su(d,g,v,x,T){var R=x.paint.get("raster-fade-duration");if(R>0){var F=o.browser.now(),U=(F-d.timeAdded)/R,X=g?(F-g.timeAdded)/R:-1,re=v.getSource(),he=T.coveringZoomLevel({tileSize:re.tileSize,roundZoom:re.roundZoom}),me=!g||Math.abs(g.tileID.overscaledZ-he)>Math.abs(d.tileID.overscaledZ-he),xe=me&&d.refreshedUponExpiration?1:o.clamp(me?U:1-X,0,1);return d.refreshedUponExpiration&&U>=1&&(d.refreshedUponExpiration=!1),g?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var Ih=new o.Color(1,0,0,1),bf=new o.Color(0,1,0,1),md=new o.Color(0,0,1,1),ap=new o.Color(1,0,1,1),Np=new o.Color(0,1,1,1);function Ef(d,g,v,x){pt(d,0,g+v/2,d.transform.width,v,x)}function Gc(d,g,v,x){pt(d,g-v/2,0,v,d.transform.height,x)}function pt(d,g,v,x,T,R){var F=d.context,U=F.gl;U.enable(U.SCISSOR_TEST),U.scissor(g*o.browser.devicePixelRatio,v*o.browser.devicePixelRatio,x*o.browser.devicePixelRatio,T*o.browser.devicePixelRatio),F.clear({color:R}),U.disable(U.SCISSOR_TEST)}function ur(d,g,v){var x=d.context,T=x.gl,R=v.posMatrix,F=d.useProgram("debug"),U=be.disabled,X=Be.disabled,re=d.colorModeForRenderPass();x.activeTexture.set(T.TEXTURE0),d.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),F.draw(x,T.LINE_STRIP,U,X,re,ot.disabled,Ys(R,o.Color.red),"$debug",d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments);var he=g.getTileByID(v.key).latestRawTileData,me=Math.floor((he&&he.byteLength||0)/1024),xe=g.getTile(v).tileSize,Ne=512/Math.min(xe,512)*(v.overscaledZ/d.transform.zoom)*.5,Fe=v.canonical.toString();v.overscaledZ!==v.canonical.z&&(Fe+=" => "+v.overscaledZ),function(qe,Re){qe.initDebugOverlayCanvas();var Ze=qe.debugOverlayCanvas,at=qe.context.gl,ht=qe.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,Ze.width,Ze.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(Re,5,5),ht.strokeText(Re,5,5),qe.debugOverlayTexture.update(Ze),qe.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(d,Fe+" "+me+"kb"),F.draw(x,T.TRIANGLES,U,X,et.alphaBlended,ot.disabled,Ys(R,o.Color.transparent,Ne),"$debug",d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}var Vt={symbol:function(d,g,v,x,T){if(d.renderPass==="translucent"){var R=Be.disabled,F=d.colorModeForRenderPass();v.layout.get("text-variable-anchor")&&function(U,X,re,he,me,xe,Ne){for(var Fe=X.transform,qe=me==="map",Re=xe==="map",Ze=0,at=U;Ze<at.length;Ze+=1){var ht=at[Ze],Ot=he.getTile(ht),It=Ot.getBucket(re);if(It&&It.text&&It.text.segments.get().length){var Ut=o.evaluateSizeForZoom(It.textSizeData,Fe.zoom),cr=Da(Ot,1,X.transform.zoom),Sr=Zi(ht.posMatrix,Re,qe,X.transform,cr),zr=re.layout.get("icon-text-fit")!=="none"&&It.hasIconData();if(Ut){var sn=Math.pow(2,Fe.zoom-Ot.tileID.overscaledZ);Uc(It,qe,Re,Ne,o.symbolSize,Fe,Sr,ht.posMatrix,sn,Ut,zr)}}}}(x,d,v,g,v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),T),v.paint.get("icon-opacity").constantOr(1)!==0&&Ks(d,g,v,x,!1,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),v.layout.get("icon-rotation-alignment"),v.layout.get("icon-pitch-alignment"),v.layout.get("icon-keep-upright"),R,F),v.paint.get("text-opacity").constantOr(1)!==0&&Ks(d,g,v,x,!0,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),v.layout.get("text-rotation-alignment"),v.layout.get("text-pitch-alignment"),v.layout.get("text-keep-upright"),R,F),g.map.showCollisionBoxes&&(zu(d,g,v,x,v.paint.get("text-translate"),v.paint.get("text-translate-anchor"),!0),zu(d,g,v,x,v.paint.get("icon-translate"),v.paint.get("icon-translate-anchor"),!1))}},circle:function(d,g,v,x){if(d.renderPass==="translucent"){var T=v.paint.get("circle-opacity"),R=v.paint.get("circle-stroke-width"),F=v.paint.get("circle-stroke-opacity"),U=v.layout.get("circle-sort-key").constantOr(1)!==void 0;if(T.constantOr(1)!==0||R.constantOr(1)!==0&&F.constantOr(1)!==0){for(var X=d.context,re=X.gl,he=d.depthModeForSublayer(0,be.ReadOnly),me=Be.disabled,xe=d.colorModeForRenderPass(),Ne=[],Fe=0;Fe<x.length;Fe++){var qe=x[Fe],Re=g.getTile(qe),Ze=Re.getBucket(v);if(Ze){var at=Ze.programConfigurations.get(v.id),ht={programConfiguration:at,program:d.useProgram("circle",at),layoutVertexBuffer:Ze.layoutVertexBuffer,indexBuffer:Ze.indexBuffer,uniformValues:Ah(d,qe,Re,v)};if(U)for(var Ot=0,It=Ze.segments.get();Ot<It.length;Ot+=1){var Ut=It[Ot];Ne.push({segments:new o.SegmentVector([Ut]),sortKey:Ut.sortKey,state:ht})}else Ne.push({segments:Ze.segments,sortKey:0,state:ht})}}U&&Ne.sort(function(Cn,Dn){return Cn.sortKey-Dn.sortKey});for(var cr=0,Sr=Ne;cr<Sr.length;cr+=1){var zr=Sr[cr],sn=zr.state;sn.program.draw(X,re.TRIANGLES,he,me,xe,ot.disabled,sn.uniformValues,v.id,sn.layoutVertexBuffer,sn.indexBuffer,zr.segments,v.paint,d.transform.zoom,sn.programConfiguration)}}}},heatmap:function(d,g,v,x){if(v.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){var T=d.context,R=T.gl,F=Be.disabled,U=new et([R.ONE,R.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Ne,Fe,qe){var Re=Ne.gl;Ne.activeTexture.set(Re.TEXTURE1),Ne.viewport.set([0,0,Fe.width/4,Fe.height/4]);var Ze=qe.heatmapFbo;if(Ze)Re.bindTexture(Re.TEXTURE_2D,Ze.colorAttachment.get()),Ne.bindFramebuffer.set(Ze.framebuffer);else{var at=Re.createTexture();Re.bindTexture(Re.TEXTURE_2D,at),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_WRAP_S,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_WRAP_T,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_MIN_FILTER,Re.LINEAR),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_MAG_FILTER,Re.LINEAR),Ze=qe.heatmapFbo=Ne.createFramebuffer(Fe.width/4,Fe.height/4,!1),function(ht,Ot,It,Ut){var cr=ht.gl;cr.texImage2D(cr.TEXTURE_2D,0,cr.RGBA,Ot.width/4,Ot.height/4,0,cr.RGBA,ht.extRenderToTextureHalfFloat?ht.extTextureHalfFloat.HALF_FLOAT_OES:cr.UNSIGNED_BYTE,null),Ut.colorAttachment.set(It)}(Ne,Fe,at,Ze)}})(T,d,v),T.clear({color:o.Color.transparent});for(var X=0;X<x.length;X++){var re=x[X];if(!g.hasRenderableParent(re)){var he=g.getTile(re),me=he.getBucket(v);if(me){var xe=me.programConfigurations.get(v.id);d.useProgram("heatmap",xe).draw(T,R.TRIANGLES,be.disabled,F,U,ot.disabled,Xl(re.posMatrix,he,d.transform.zoom,v.paint.get("heatmap-intensity")),v.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,v.paint,d.transform.zoom,xe)}}}T.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(Ne,Fe){var qe=Ne.context,Re=qe.gl,Ze=Fe.heatmapFbo;if(Ze){qe.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_2D,Ze.colorAttachment.get()),qe.activeTexture.set(Re.TEXTURE1);var at=Fe.colorRampTexture;at||(at=Fe.colorRampTexture=new o.Texture(qe,Fe.colorRamp,Re.RGBA)),at.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),Ne.useProgram("heatmapTexture").draw(qe,Re.TRIANGLES,be.disabled,Be.disabled,Ne.colorModeForRenderPass(),ot.disabled,function(ht,Ot,It,Ut){var cr=o.create();o.ortho(cr,0,ht.width,ht.height,0,0,1);var Sr=ht.context.gl;return{u_matrix:cr,u_world:[Sr.drawingBufferWidth,Sr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ot.paint.get("heatmap-opacity")}}(Ne,Fe),Fe.id,Ne.viewportBuffer,Ne.quadTriangleIndexBuffer,Ne.viewportSegments,Fe.paint,Ne.transform.zoom)}}(d,v))},line:function(d,g,v,x){if(d.renderPass==="translucent"){var T=v.paint.get("line-opacity"),R=v.paint.get("line-width");if(T.constantOr(1)!==0&&R.constantOr(1)!==0)for(var F=d.depthModeForSublayer(0,be.ReadOnly),U=d.colorModeForRenderPass(),X=v.paint.get("line-dasharray"),re=v.paint.get("line-pattern"),he=re.constantOr(1),me=v.paint.get("line-gradient"),xe=v.getCrossfadeParameters(),Ne=he?"linePattern":X?"lineSDF":me?"lineGradient":"line",Fe=d.context,qe=Fe.gl,Re=!0,Ze=0,at=x;Ze<at.length;Ze+=1){var ht=at[Ze],Ot=g.getTile(ht);if(!he||Ot.patternsLoaded()){var It=Ot.getBucket(v);if(It){var Ut=It.programConfigurations.get(v.id),cr=d.context.program.get(),Sr=d.useProgram(Ne,Ut),zr=Re||Sr.program!==cr,sn=re.constantOr(null);if(sn&&Ot.imageAtlas){var Cn=Ot.imageAtlas,Dn=Cn.patternPositions[sn.to.toString()],Nn=Cn.patternPositions[sn.from.toString()];Dn&&Nn&&Ut.setConstantPatternPositions(Dn,Nn)}var ta=he?Dc(d,Ot,v,xe):X?Bp(d,Ot,v,X,xe):me?ka(d,Ot,v,It.lineClipsArray.length):_f(d,Ot,v);if(he)Fe.activeTexture.set(qe.TEXTURE0),Ot.imageAtlasTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE),Ut.updatePaintBuffers(xe);else if(X&&(zr||d.lineAtlas.dirty))Fe.activeTexture.set(qe.TEXTURE0),d.lineAtlas.bind(Fe);else if(me){var un=It.gradients[v.id],Zn=un.texture;if(v.gradientVersion!==un.version){var ui=256;if(v.stepInterpolant){var ni=g.getSource().maxzoom,jn=ht.canonical.z===ni?Math.ceil(1<<d.transform.maxZoom-ht.canonical.z):1;ui=o.clamp(o.nextPowerOfTwo(It.maxLineLength/o.EXTENT*1024*jn),256,Fe.maxTextureSize)}un.gradient=o.renderColorRamp({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:ui,image:un.gradient||void 0,clips:It.lineClipsArray}),un.texture?un.texture.update(un.gradient):un.texture=new o.Texture(Fe,un.gradient,qe.RGBA),un.version=v.gradientVersion,Zn=un.texture}Fe.activeTexture.set(qe.TEXTURE0),Zn.bind(v.stepInterpolant?qe.NEAREST:qe.LINEAR,qe.CLAMP_TO_EDGE)}Sr.draw(Fe,qe.TRIANGLES,F,d.stencilModeForClipping(ht),U,ot.disabled,ta,v.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,v.paint,d.transform.zoom,Ut,It.layoutVertexBuffer2),Re=!1}}}}},fill:function(d,g,v,x){var T=v.paint.get("fill-color"),R=v.paint.get("fill-opacity");if(R.constantOr(1)!==0){var F=d.colorModeForRenderPass(),U=v.paint.get("fill-pattern"),X=d.opaquePassEnabledForLayer()&&!U.constantOr(1)&&T.constantOr(o.Color.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===X){var re=d.depthModeForSublayer(1,d.renderPass==="opaque"?be.ReadWrite:be.ReadOnly);Yf(d,g,v,x,re,F,!1)}if(d.renderPass==="translucent"&&v.paint.get("fill-antialias")){var he=d.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,be.ReadOnly);Yf(d,g,v,x,he,F,!0)}}},"fill-extrusion":function(d,g,v,x){var T=v.paint.get("fill-extrusion-opacity");if(T!==0&&d.renderPass==="translucent"){var R=new be(d.context.gl.LEQUAL,be.ReadWrite,d.depthRangeFor3D);if(T!==1||v.paint.get("fill-extrusion-pattern").constantOr(1))ip(d,g,v,x,R,Be.disabled,et.disabled),ip(d,g,v,x,R,d.stencilModeFor3D(),d.colorModeForRenderPass());else{var F=d.colorModeForRenderPass();ip(d,g,v,x,R,Be.disabled,F)}}},hillshade:function(d,g,v,x){if(d.renderPass==="offscreen"||d.renderPass==="translucent"){for(var T=d.context,R=d.depthModeForSublayer(0,be.ReadOnly),F=d.colorModeForRenderPass(),U=d.renderPass==="translucent"?d.stencilConfigForOverlap(x):[{},x],X=U[0],re=0,he=U[1];re<he.length;re+=1){var me=he[re],xe=g.getTile(me);xe.needsHillshadePrepare&&d.renderPass==="offscreen"?Yl(d,xe,v,R,Be.disabled,F):d.renderPass==="translucent"&&Mh(d,xe,v,R,X[me.overscaledZ],F)}T.viewport.set([0,0,d.width,d.height])}},raster:function(d,g,v,x){if(d.renderPass==="translucent"&&v.paint.get("raster-opacity")!==0&&x.length)for(var T=d.context,R=T.gl,F=g.getSource(),U=d.useProgram("raster"),X=d.colorModeForRenderPass(),re=F instanceof rn?[{},x]:d.stencilConfigForOverlap(x),he=re[0],me=re[1],xe=me[me.length-1].overscaledZ,Ne=!d.options.moving,Fe=0,qe=me;Fe<qe.length;Fe+=1){var Re=qe[Fe],Ze=d.depthModeForSublayer(Re.overscaledZ-xe,v.paint.get("raster-opacity")===1?be.ReadWrite:be.ReadOnly,R.LESS),at=g.getTile(Re),ht=d.transform.calculatePosMatrix(Re.toUnwrapped(),Ne);at.registerFadeDuration(v.paint.get("raster-fade-duration"));var Ot=g.findLoadedParent(Re,0),It=su(at,Ot,g,v,d.transform),Ut=void 0,cr=void 0,Sr=v.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;T.activeTexture.set(R.TEXTURE0),at.texture.bind(Sr,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(R.TEXTURE1),Ot?(Ot.texture.bind(Sr,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Ut=Math.pow(2,Ot.tileID.overscaledZ-at.tileID.overscaledZ),cr=[at.tileID.canonical.x*Ut%1,at.tileID.canonical.y*Ut%1]):at.texture.bind(Sr,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);var zr=rp(ht,cr||[0,0],Ut||1,It,v);F instanceof rn?U.draw(T,R.TRIANGLES,Ze,Be.disabled,X,ot.disabled,zr,v.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments):U.draw(T,R.TRIANGLES,Ze,he[Re.overscaledZ],X,ot.disabled,zr,v.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,g,v){var x=v.paint.get("background-color"),T=v.paint.get("background-opacity");if(T!==0){var R=d.context,F=R.gl,U=d.transform,X=U.tileSize,re=v.paint.get("background-pattern");if(!d.isPatternMissing(re)){var he=!re&&x.a===1&&T===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass===he){var me=Be.disabled,xe=d.depthModeForSublayer(0,he==="opaque"?be.ReadWrite:be.ReadOnly),Ne=d.colorModeForRenderPass(),Fe=d.useProgram(re?"backgroundPattern":"background"),qe=U.coveringTiles({tileSize:X});re&&(R.activeTexture.set(F.TEXTURE0),d.imageManager.bind(d.context));for(var Re=v.getCrossfadeParameters(),Ze=0,at=qe;Ze<at.length;Ze+=1){var ht=at[Ze],Ot=d.transform.calculatePosMatrix(ht.toUnwrapped()),It=re?hc(Ot,T,d,re,{tileID:ht,tileSize:X},Re):_l(Ot,T,x);Fe.draw(R,F.TRIANGLES,xe,me,Ne,ot.disabled,It,v.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}}}},debug:function(d,g,v){for(var x=0;x<v.length;x++)ur(d,g,v[x])},custom:function(d,g,v){var x=d.context,T=v.implementation;if(d.renderPass==="offscreen"){var R=T.prerender;R&&(d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),R.call(T,x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),x.setColorMode(d.colorModeForRenderPass()),x.setStencilMode(Be.disabled);var F=T.renderingMode==="3d"?new be(d.context.gl.LEQUAL,be.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,be.ReadOnly);x.setDepthMode(F),T.render(x.gl,d.transform.customLayerMatrix()),x.setDirty(),d.setBaseState(),x.bindFramebuffer.set(null)}}},on=function(d,g){this.context=new ge(d),this.transform=g,this._tileTextures={},this.setup(),this.numSublayers=Ve.maxUnderzooming+Ve.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new vf,this.gpuTimers={}};on.prototype.resize=function(d,g){if(this.width=d*o.browser.devicePixelRatio,this.height=g*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var v=0,x=this.style._order;v<x.length;v+=1)this.style._layers[x[v]].resize()},on.prototype.setup=function(){var d=this.context,g=new o.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(o.EXTENT,0),g.emplaceBack(0,o.EXTENT),g.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=d.createVertexBuffer(g,Ro.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var v=new o.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(o.EXTENT,0),v.emplaceBack(0,o.EXTENT),v.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=d.createVertexBuffer(v,Ro.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var x=new o.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(o.EXTENT,0,o.EXTENT,0),x.emplaceBack(0,o.EXTENT,0,o.EXTENT),x.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=d.createVertexBuffer(x,Er.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var T=new o.StructArrayLayout2i4;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=d.createVertexBuffer(T,Ro.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var R=new o.StructArrayLayout1ui2;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=d.createIndexBuffer(R);var F=new o.StructArrayLayout3ui6;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=d.createIndexBuffer(F),this.emptyTexture=new o.Texture(d,{width:1,height:1,data:new Uint8Array([0,0,0,0])},d.gl.RGBA);var U=this.context.gl;this.stencilClearMode=new Be({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO)},on.prototype.clearStencil=function(){var d=this.context,g=d.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var v=o.create();o.ortho(v,0,this.width,this.height,0,0,1),o.scale(v,v,[g.drawingBufferWidth,g.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(d,g.TRIANGLES,be.disabled,this.stencilClearMode,et.disabled,ot.disabled,Bu(v),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},on.prototype._renderTileClippingMasks=function(d,g){if(this.currentStencilSource!==d.source&&d.isTileClipped()&&g&&g.length){this.currentStencilSource=d.source;var v=this.context,x=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(et.disabled),v.setDepthMode(be.disabled);var T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var R=0,F=g;R<F.length;R+=1){var U=F[R],X=this._tileClippingMaskIDs[U.key]=this.nextStencilID++;T.draw(v,x.TRIANGLES,be.disabled,new Be({func:x.ALWAYS,mask:0},X,255,x.KEEP,x.KEEP,x.REPLACE),et.disabled,ot.disabled,Bu(U.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},on.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var d=this.nextStencilID++,g=this.context.gl;return new Be({func:g.NOTEQUAL,mask:255},d,255,g.KEEP,g.KEEP,g.REPLACE)},on.prototype.stencilModeForClipping=function(d){var g=this.context.gl;return new Be({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[d.key],0,g.KEEP,g.KEEP,g.REPLACE)},on.prototype.stencilConfigForOverlap=function(d){var g,v=this.context.gl,x=d.sort(function(X,re){return re.overscaledZ-X.overscaledZ}),T=x[x.length-1].overscaledZ,R=x[0].overscaledZ-T+1;if(R>1){this.currentStencilSource=void 0,this.nextStencilID+R>256&&this.clearStencil();for(var F={},U=0;U<R;U++)F[U+T]=new Be({func:v.GEQUAL,mask:255},U+this.nextStencilID,255,v.KEEP,v.KEEP,v.REPLACE);return this.nextStencilID+=R,[F,x]}return[(g={},g[T]=Be.disabled,g),x]},on.prototype.colorModeForRenderPass=function(){var d=this.context.gl;return this._showOverdrawInspector?new et([d.CONSTANT_COLOR,d.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?et.unblended:et.alphaBlended},on.prototype.depthModeForSublayer=function(d,g,v){if(!this.opaquePassEnabledForLayer())return be.disabled;var x=1-((1+this.currentLayer)*this.numSublayers+d)*this.depthEpsilon;return new be(v||this.context.gl.LEQUAL,g,[x,x])},on.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},on.prototype.render=function(d,g){var v=this;this.style=d,this.options=g,this.lineAtlas=d.lineAtlas,this.imageManager=d.imageManager,this.glyphManager=d.glyphManager,this.symbolFadeChange=d.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var x=this.style._order,T=this.style.sourceCaches;for(var R in T){var F=T[R];F.used&&F.prepare(this.context)}var U,X,re={},he={},me={};for(var xe in T){var Ne=T[xe];re[xe]=Ne.getVisibleCoordinates(),he[xe]=re[xe].slice().reverse(),me[xe]=Ne.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Fe=0;Fe<x.length;Fe++)if(this.style._layers[x[Fe]].is3D()){this.opaquePassCutoff=Fe;break}this.renderPass="offscreen";for(var qe=0,Re=x;qe<Re.length;qe+=1){var Ze=this.style._layers[Re[qe]];if(Ze.hasOffscreenPass()&&!Ze.isHidden(this.transform.zoom)){var at=he[Ze.source];(Ze.type==="custom"||at.length)&&this.renderLayer(this,T[Ze.source],Ze,at)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:g.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.depthRangeFor3D=[0,1-(d._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){var ht=this.style._layers[x[this.currentLayer]],Ot=T[ht.source],It=re[ht.source];this._renderTileClippingMasks(ht,It),this.renderLayer(this,Ot,ht,It)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){var Ut=this.style._layers[x[this.currentLayer]],cr=T[Ut.source],Sr=(Ut.type==="symbol"?me:he)[Ut.source];this._renderTileClippingMasks(Ut,re[Ut.source]),this.renderLayer(this,cr,Ut,Sr)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(zr){zr.source&&!zr.isHidden(v.transform.zoom)&&(zr.source!==(X&&X.id)&&(X=v.style.sourceCaches[zr.source]),(!U||U.getSource().maxzoom<X.getSource().maxzoom)&&(U=X))}),U&&Vt.debug(this,U,U.getVisibleCoordinates())),this.options.showPadding&&function(zr){var sn=zr.transform.padding;Ef(zr,zr.transform.height-(sn.top||0),3,Ih),Ef(zr,sn.bottom||0,3,bf),Gc(zr,sn.left||0,3,md),Gc(zr,zr.transform.width-(sn.right||0),3,ap);var Cn=zr.transform.centerPoint;(function(Dn,Nn,ta,un){pt(Dn,Nn-1,ta-10,2,20,un),pt(Dn,Nn-10,ta-1,20,2,un)})(zr,Cn.x,zr.transform.height-Cn.y,Np)}(this),this.context.setDefault()},on.prototype.renderLayer=function(d,g,v,x){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="custom"||x.length)&&(this.id=v.id,this.gpuTimingStart(v),Vt[v.type](d,g,v,x,this.style.placement.variableOffsets),this.gpuTimingEnd())},on.prototype.gpuTimingStart=function(d){if(this.options.gpuTiming){var g=this.context.extTimerQuery,v=this.gpuTimers[d.id];v||(v=this.gpuTimers[d.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),v.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,v.query)}},on.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var d=this.context.extTimerQuery;d.endQueryEXT(d.TIME_ELAPSED_EXT)}},on.prototype.collectGpuTimers=function(){var d=this.gpuTimers;return this.gpuTimers={},d},on.prototype.queryGpuTimers=function(d){var g={};for(var v in d){var x=d[v],T=this.context.extTimerQuery,R=T.getQueryObjectEXT(x.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(x.query),g[v]=R}return g},on.prototype.translatePosMatrix=function(d,g,v,x,T){if(!v[0]&&!v[1])return d;var R=T?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(R){var F=Math.sin(R),U=Math.cos(R);v=[v[0]*U-v[1]*F,v[0]*F+v[1]*U]}var X=[T?v[0]:Da(g,v[0],this.transform.zoom),T?v[1]:Da(g,v[1],this.transform.zoom),0],re=new Float32Array(16);return o.translate(re,d,X),re},on.prototype.saveTileTexture=function(d){var g=this._tileTextures[d.size[0]];g?g.push(d):this._tileTextures[d.size[0]]=[d]},on.prototype.getTileTexture=function(d){var g=this._tileTextures[d];return g&&g.length>0?g.pop():null},on.prototype.isPatternMissing=function(d){if(!d)return!1;if(!d.from||!d.to)return!0;var g=this.imageManager.getPattern(d.from.toString()),v=this.imageManager.getPattern(d.to.toString());return!g||!v},on.prototype.useProgram=function(d,g){this.cache=this.cache||{};var v=""+d+(g?g.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[v]||(this.cache[v]=new tp(this.context,d,ro[d],g,np[d],this._showOverdrawInspector)),this.cache[v]},on.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},on.prototype.setBaseState=function(){var d=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(d.FUNC_ADD)},on.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},on.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ei=function(d,g){this.points=d,this.planes=g};Ei.fromInvProjectionMatrix=function(d,g,v){var x=Math.pow(2,v),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(F){return o.transformMat4([],F,d)}).map(function(F){return o.scale$1([],F,1/F[3]/g*x)}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(F){var U=o.sub([],T[F[0]],T[F[1]]),X=o.sub([],T[F[2]],T[F[1]]),re=o.normalize([],o.cross([],U,X)),he=-o.dot(re,T[F[1]]);return re.concat(he)});return new Ei(T,R)};var ua=function(d,g){this.min=d,this.max=g,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};ua.prototype.quadrant=function(d){for(var g=[d%2==0,d<2],v=o.clone$2(this.min),x=o.clone$2(this.max),T=0;T<g.length;T++)v[T]=g[T]?this.min[T]:this.center[T],x[T]=g[T]?this.center[T]:this.max[T];return x[2]=this.max[2],new ua(v,x)},ua.prototype.distanceX=function(d){return Math.max(Math.min(this.max[0],d[0]),this.min[0])-d[0]},ua.prototype.distanceY=function(d){return Math.max(Math.min(this.max[1],d[1]),this.min[1])-d[1]},ua.prototype.intersects=function(d){for(var g=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],v=!0,x=0;x<d.planes.length;x++){for(var T=d.planes[x],R=0,F=0;F<g.length;F++)R+=o.dot$1(T,g[F])>=0;if(R===0)return 0;R!==g.length&&(v=!1)}if(v)return 2;for(var U=0;U<3;U++){for(var X=Number.MAX_VALUE,re=-Number.MAX_VALUE,he=0;he<d.points.length;he++){var me=d.points[he][U]-this.min[U];X=Math.min(X,me),re=Math.max(re,me)}if(re<0||X>this.max[U]-this.min[U])return 0}return 1};var no=function(d,g,v,x){if(d===void 0&&(d=0),g===void 0&&(g=0),v===void 0&&(v=0),x===void 0&&(x=0),isNaN(d)||d<0||isNaN(g)||g<0||isNaN(v)||v<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=g,this.left=v,this.right=x};no.prototype.interpolate=function(d,g,v){return g.top!=null&&d.top!=null&&(this.top=o.number(d.top,g.top,v)),g.bottom!=null&&d.bottom!=null&&(this.bottom=o.number(d.bottom,g.bottom,v)),g.left!=null&&d.left!=null&&(this.left=o.number(d.left,g.left,v)),g.right!=null&&d.right!=null&&(this.right=o.number(d.right,g.right,v)),this},no.prototype.getCenter=function(d,g){var v=o.clamp((this.left+d-this.right)/2,0,d),x=o.clamp((this.top+g-this.bottom)/2,0,g);return new o.Point(v,x)},no.prototype.equals=function(d){return this.top===d.top&&this.bottom===d.bottom&&this.left===d.left&&this.right===d.right},no.prototype.clone=function(){return new no(this.top,this.bottom,this.left,this.right)},no.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gn=function(d,g,v,x,T){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=T===void 0||T,this._minZoom=d||0,this._maxZoom=g||22,this._minPitch=v==null?0:v,this._maxPitch=x==null?60:x,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new no,this._posMatrixCache={},this._alignedPosMatrixCache={}},qi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gn.prototype.clone=function(){var d=new Gn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return d.tileSize=this.tileSize,d.latRange=this.latRange,d.width=this.width,d.height=this.height,d._center=this._center,d.zoom=this.zoom,d.angle=this.angle,d._fov=this._fov,d._pitch=this._pitch,d._unmodified=this._unmodified,d._edgeInsets=this._edgeInsets.clone(),d._calcMatrices(),d},qi.minZoom.get=function(){return this._minZoom},qi.minZoom.set=function(d){this._minZoom!==d&&(this._minZoom=d,this.zoom=Math.max(this.zoom,d))},qi.maxZoom.get=function(){return this._maxZoom},qi.maxZoom.set=function(d){this._maxZoom!==d&&(this._maxZoom=d,this.zoom=Math.min(this.zoom,d))},qi.minPitch.get=function(){return this._minPitch},qi.minPitch.set=function(d){this._minPitch!==d&&(this._minPitch=d,this.pitch=Math.max(this.pitch,d))},qi.maxPitch.get=function(){return this._maxPitch},qi.maxPitch.set=function(d){this._maxPitch!==d&&(this._maxPitch=d,this.pitch=Math.min(this.pitch,d))},qi.renderWorldCopies.get=function(){return this._renderWorldCopies},qi.renderWorldCopies.set=function(d){d===void 0?d=!0:d===null&&(d=!1),this._renderWorldCopies=d},qi.worldSize.get=function(){return this.tileSize*this.scale},qi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},qi.size.get=function(){return new o.Point(this.width,this.height)},qi.bearing.get=function(){return-this.angle/Math.PI*180},qi.bearing.set=function(d){var g=-o.wrap(d,-180,180)*Math.PI/180;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},qi.pitch.get=function(){return this._pitch/Math.PI*180},qi.pitch.set=function(d){var g=o.clamp(d,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())},qi.fov.get=function(){return this._fov/Math.PI*180},qi.fov.set=function(d){d=Math.max(.01,Math.min(60,d)),this._fov!==d&&(this._unmodified=!1,this._fov=d/180*Math.PI,this._calcMatrices())},qi.zoom.get=function(){return this._zoom},qi.zoom.set=function(d){var g=Math.min(Math.max(d,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._zoom=g,this.scale=this.zoomScale(g),this.tileZoom=Math.floor(g),this.zoomFraction=g-this.tileZoom,this._constrain(),this._calcMatrices())},qi.center.get=function(){return this._center},qi.center.set=function(d){d.lat===this._center.lat&&d.lng===this._center.lng||(this._unmodified=!1,this._center=d,this._constrain(),this._calcMatrices())},qi.padding.get=function(){return this._edgeInsets.toJSON()},qi.padding.set=function(d){this._edgeInsets.equals(d)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,d,1),this._calcMatrices())},qi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gn.prototype.isPaddingEqual=function(d){return this._edgeInsets.equals(d)},Gn.prototype.interpolatePadding=function(d,g,v){this._unmodified=!1,this._edgeInsets.interpolate(d,g,v),this._constrain(),this._calcMatrices()},Gn.prototype.coveringZoomLevel=function(d){var g=(d.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/d.tileSize));return Math.max(0,g)},Gn.prototype.getVisibleUnwrappedCoordinates=function(d){var g=[new o.UnwrappedTileID(0,d)];if(this._renderWorldCopies)for(var v=this.pointCoordinate(new o.Point(0,0)),x=this.pointCoordinate(new o.Point(this.width,0)),T=this.pointCoordinate(new o.Point(this.width,this.height)),R=this.pointCoordinate(new o.Point(0,this.height)),F=Math.floor(Math.min(v.x,x.x,T.x,R.x)),U=Math.floor(Math.max(v.x,x.x,T.x,R.x)),X=F-1;X<=U+1;X++)X!==0&&g.push(new o.UnwrappedTileID(X,d));return g},Gn.prototype.coveringTiles=function(d){var g=this.coveringZoomLevel(d),v=g;if(d.minzoom!==void 0&&g<d.minzoom)return[];d.maxzoom!==void 0&&g>d.maxzoom&&(g=d.maxzoom);var x=o.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,g),R=[T*x.x,T*x.y,0],F=Ei.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g),U=d.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(U=g);var X=function(zr){return{aabb:new ua([zr*T,0,0],[(zr+1)*T,T,0]),zoom:0,x:0,y:0,wrap:zr,fullyVisible:!1}},re=[],he=[],me=g,xe=d.reparseOverscaled?v:g;if(this._renderWorldCopies)for(var Ne=1;Ne<=3;Ne++)re.push(X(-Ne)),re.push(X(Ne));for(re.push(X(0));re.length>0;){var Fe=re.pop(),qe=Fe.x,Re=Fe.y,Ze=Fe.fullyVisible;if(!Ze){var at=Fe.aabb.intersects(F);if(at===0)continue;Ze=at===2}var ht=Fe.aabb.distanceX(R),Ot=Fe.aabb.distanceY(R),It=Math.max(Math.abs(ht),Math.abs(Ot));if(Fe.zoom===me||It>3+(1<<me-Fe.zoom)-2&&Fe.zoom>=U)he.push({tileID:new o.OverscaledTileID(Fe.zoom===me?xe:Fe.zoom,Fe.wrap,Fe.zoom,qe,Re),distanceSq:o.sqrLen([R[0]-.5-qe,R[1]-.5-Re])});else for(var Ut=0;Ut<4;Ut++){var cr=(qe<<1)+Ut%2,Sr=(Re<<1)+(Ut>>1);re.push({aabb:Fe.aabb.quadrant(Ut),zoom:Fe.zoom+1,x:cr,y:Sr,wrap:Fe.wrap,fullyVisible:Ze})}}return he.sort(function(zr,sn){return zr.distanceSq-sn.distanceSq}).map(function(zr){return zr.tileID})},Gn.prototype.resize=function(d,g){this.width=d,this.height=g,this.pixelsToGLUnits=[2/d,-2/g],this._constrain(),this._calcMatrices()},qi.unmodified.get=function(){return this._unmodified},Gn.prototype.zoomScale=function(d){return Math.pow(2,d)},Gn.prototype.scaleZoom=function(d){return Math.log(d)/Math.LN2},Gn.prototype.project=function(d){var g=o.clamp(d.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(d.lng)*this.worldSize,o.mercatorYfromLat(g)*this.worldSize)},Gn.prototype.unproject=function(d){return new o.MercatorCoordinate(d.x/this.worldSize,d.y/this.worldSize).toLngLat()},qi.point.get=function(){return this.project(this.center)},Gn.prototype.setLocationAtPoint=function(d,g){var v=this.pointCoordinate(g),x=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(d),R=new o.MercatorCoordinate(T.x-(v.x-x.x),T.y-(v.y-x.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())},Gn.prototype.locationPoint=function(d){return this.coordinatePoint(this.locationCoordinate(d))},Gn.prototype.pointLocation=function(d){return this.coordinateLocation(this.pointCoordinate(d))},Gn.prototype.locationCoordinate=function(d){return o.MercatorCoordinate.fromLngLat(d)},Gn.prototype.coordinateLocation=function(d){return d.toLngLat()},Gn.prototype.pointCoordinate=function(d){var g=[d.x,d.y,0,1],v=[d.x,d.y,1,1];o.transformMat4(g,g,this.pixelMatrixInverse),o.transformMat4(v,v,this.pixelMatrixInverse);var x=g[3],T=v[3],R=g[1]/x,F=v[1]/T,U=g[2]/x,X=v[2]/T,re=U===X?0:(0-U)/(X-U);return new o.MercatorCoordinate(o.number(g[0]/x,v[0]/T,re)/this.worldSize,o.number(R,F,re)/this.worldSize)},Gn.prototype.coordinatePoint=function(d){var g=[d.x*this.worldSize,d.y*this.worldSize,0,1];return o.transformMat4(g,g,this.pixelMatrix),new o.Point(g[0]/g[3],g[1]/g[3])},Gn.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},Gn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gn.prototype.setMaxBounds=function(d){d?(this.lngRange=[d.getWest(),d.getEast()],this.latRange=[d.getSouth(),d.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gn.prototype.calculatePosMatrix=function(d,g){g===void 0&&(g=!1);var v=d.key,x=g?this._alignedPosMatrixCache:this._posMatrixCache;if(x[v])return x[v];var T=d.canonical,R=this.worldSize/this.zoomScale(T.z),F=T.x+Math.pow(2,T.z)*d.wrap,U=o.identity(new Float64Array(16));return o.translate(U,U,[F*R,T.y*R,0]),o.scale(U,U,[R/o.EXTENT,R/o.EXTENT,1]),o.multiply(U,g?this.alignedProjMatrix:this.projMatrix,U),x[v]=new Float32Array(U),x[v]},Gn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var d,g,v,x,T=-90,R=90,F=-180,U=180,X=this.size,re=this._unmodified;if(this.latRange){var he=this.latRange;T=o.mercatorYfromLat(he[1])*this.worldSize,d=(R=o.mercatorYfromLat(he[0])*this.worldSize)-T<X.y?X.y/(R-T):0}if(this.lngRange){var me=this.lngRange;F=o.mercatorXfromLng(me[0])*this.worldSize,g=(U=o.mercatorXfromLng(me[1])*this.worldSize)-F<X.x?X.x/(U-F):0}var xe=this.point,Ne=Math.max(g||0,d||0);if(Ne)return this.center=this.unproject(new o.Point(g?(U+F)/2:xe.x,d?(R+T)/2:xe.y)),this.zoom+=this.scaleZoom(Ne),this._unmodified=re,void(this._constraining=!1);if(this.latRange){var Fe=xe.y,qe=X.y/2;Fe-qe<T&&(x=T+qe),Fe+qe>R&&(x=R-qe)}if(this.lngRange){var Re=xe.x,Ze=X.x/2;Re-Ze<F&&(v=F+Ze),Re+Ze>U&&(v=U-Ze)}v===void 0&&x===void 0||(this.center=this.unproject(new o.Point(v!==void 0?v:xe.x,x!==void 0?x:xe.y))),this._unmodified=re,this._constraining=!1}},Gn.prototype._calcMatrices=function(){if(this.height){var d=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var g=Math.PI/2+this._pitch,v=this._fov*(.5+d.y/this.height),x=Math.sin(v)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-g-v,.01,Math.PI-.01)),T=this.point,R=T.x,F=T.y,U=1.01*(Math.cos(Math.PI/2-this._pitch)*x+this.cameraToCenterDistance),X=this.height/50,re=new Float64Array(16);o.perspective(re,this._fov,this.width/this.height,X,U),re[8]=2*-d.x/this.width,re[9]=2*d.y/this.height,o.scale(re,re,[1,-1,1]),o.translate(re,re,[0,0,-this.cameraToCenterDistance]),o.rotateX(re,re,this._pitch),o.rotateZ(re,re,this.angle),o.translate(re,re,[-R,-F,0]),this.mercatorMatrix=o.scale([],re,[this.worldSize,this.worldSize,this.worldSize]),o.scale(re,re,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=re,this.invProjMatrix=o.invert([],this.projMatrix);var he=this.width%2/2,me=this.height%2/2,xe=Math.cos(this.angle),Ne=Math.sin(this.angle),Fe=R-Math.round(R)+xe*he+Ne*me,qe=F-Math.round(F)+xe*me+Ne*he,Re=new Float64Array(re);if(o.translate(Re,Re,[Fe>.5?Fe-1:Fe,qe>.5?qe-1:qe,0]),this.alignedProjMatrix=Re,re=o.create(),o.scale(re,re,[this.width/2,-this.height/2,1]),o.translate(re,re,[1,-1,0]),this.labelPlaneMatrix=re,re=o.create(),o.scale(re,re,[1,-1,1]),o.translate(re,re,[-1,-1,0]),o.scale(re,re,[2/this.width,2/this.height,1]),this.glCoordMatrix=re,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(re=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=re,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var d=this.pointCoordinate(new o.Point(0,0)),g=[d.x*this.worldSize,d.y*this.worldSize,0,1];return o.transformMat4(g,g,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gn.prototype.getCameraPoint=function(){var d=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,d))},Gn.prototype.getCameraQueryGeometry=function(d){var g=this.getCameraPoint();if(d.length===1)return[d[0],g];for(var v=g.x,x=g.y,T=g.x,R=g.y,F=0,U=d;F<U.length;F+=1){var X=U[F];v=Math.min(v,X.x),x=Math.min(x,X.y),T=Math.max(T,X.x),R=Math.max(R,X.y)}return[new o.Point(v,x),new o.Point(T,x),new o.Point(T,R),new o.Point(v,R),new o.Point(v,x)]},Object.defineProperties(Gn.prototype,qi);var Qs=function(d){var g,v,x,T;this._hashName=d&&encodeURIComponent(d),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(g=this._updateHashUnthrottled.bind(this),v=!1,x=null,T=function(){x=null,v&&(g(),x=setTimeout(T,300),v=!1)},function(){return v=!0,x||T(),x})};Qs.prototype.addTo=function(d){return this._map=d,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Qs.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Qs.prototype.getHashString=function(d){var g=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,x=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,x),R=Math.round(g.lng*T)/T,F=Math.round(g.lat*T)/T,U=this._map.getBearing(),X=this._map.getPitch(),re="";if(re+=d?"/"+R+"/"+F+"/"+v:v+"/"+F+"/"+R,(U||X)&&(re+="/"+Math.round(10*U)/10),X&&(re+="/"+Math.round(X)),this._hashName){var he=this._hashName,me=!1,xe=o.window.location.hash.slice(1).split("&").map(function(Ne){var Fe=Ne.split("=")[0];return Fe===he?(me=!0,Fe+"="+re):Ne}).filter(function(Ne){return Ne});return me||xe.push(he+"="+re),"#"+xe.join("&")}return"#"+re},Qs.prototype._getCurrentHash=function(){var d,g=this,v=o.window.location.hash.replace("#","");return this._hashName?(v.split("&").map(function(x){return x.split("=")}).forEach(function(x){x[0]===g._hashName&&(d=x)}),(d&&d[1]||"").split("/")):v.split("/")},Qs.prototype._onHashChange=function(){var d=this._getCurrentHash();if(d.length>=3&&!d.some(function(v){return isNaN(v)})){var g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:g,pitch:+(d[4]||0)}),!0}return!1},Qs.prototype._updateHashUnthrottled=function(){var d=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,d)}catch{}};var uu={linearity:.3,easing:o.bezier(0,0,.3,1)},jc=o.extend({deceleration:2500,maxSpeed:1400},uu),Lh=o.extend({deceleration:20,maxSpeed:1400},uu),qf=o.extend({deceleration:1e3,maxSpeed:360},uu),pc=o.extend({deceleration:1e3,maxSpeed:90},uu),Cf=function(d){this._map=d,this.clear()};function fa(d,g){(!d.duration||d.duration<g.duration)&&(d.duration=g.duration,d.easing=g.easing)}function ql(d,g,v){var x=v.maxSpeed,T=v.linearity,R=v.deceleration,F=o.clamp(d*T/(g/1e3),-x,x),U=Math.abs(F)/(R*T);return{easing:v.easing,duration:1e3*U,amount:F*(U/2)}}Cf.prototype.clear=function(){this._inertiaBuffer=[]},Cf.prototype.record=function(d){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:d})},Cf.prototype._drainInertiaBuffer=function(){for(var d=this._inertiaBuffer,g=o.browser.now();d.length>0&&g-d[0].time>160;)d.shift()},Cf.prototype._onMoveEnd=function(d){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var g={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},v=0,x=this._inertiaBuffer;v<x.length;v+=1){var T=x[v].settings;g.zoom+=T.zoomDelta||0,g.bearing+=T.bearingDelta||0,g.pitch+=T.pitchDelta||0,T.panDelta&&g.pan._add(T.panDelta),T.around&&(g.around=T.around),T.pinchAround&&(g.pinchAround=T.pinchAround)}var R=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,F={};if(g.pan.mag()){var U=ql(g.pan.mag(),R,o.extend({},jc,d||{}));F.offset=g.pan.mult(U.amount/g.pan.mag()),F.center=this._map.transform.center,fa(F,U)}if(g.zoom){var X=ql(g.zoom,R,Lh);F.zoom=this._map.transform.zoom+X.amount,fa(F,X)}if(g.bearing){var re=ql(g.bearing,R,qf);F.bearing=this._map.transform.bearing+o.clamp(re.amount,-179,179),fa(F,re)}if(g.pitch){var he=ql(g.pitch,R,pc);F.pitch=this._map.transform.pitch+he.amount,fa(F,he)}if(F.zoom||F.bearing){var me=g.pinchAround===void 0?g.around:g.pinchAround;F.around=me?this._map.unproject(me):this._map.getCenter()}return this.clear(),o.extend(F,{noMoveStart:!0})}};var lo=function(d){function g(x,T,R,F){F===void 0&&(F={});var U=c.mousePos(T.getCanvasContainer(),R),X=T.unproject(U);d.call(this,x,o.extend({point:U,lngLat:X,originalEvent:R},F)),this._defaultPrevented=!1,this.target=T}d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g;var v={defaultPrevented:{configurable:!0}};return g.prototype.preventDefault=function(){this._defaultPrevented=!0},v.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(g.prototype,v),g}(o.Event),Sf=function(d){function g(x,T,R){var F=x==="touchend"?R.changedTouches:R.touches,U=c.touchPos(T.getCanvasContainer(),F),X=U.map(function(me){return T.unproject(me)}),re=U.reduce(function(me,xe,Ne,Fe){return me.add(xe.div(Fe.length))},new o.Point(0,0)),he=T.unproject(re);d.call(this,x,{points:U,point:re,lngLats:X,lngLat:he,originalEvent:R}),this._defaultPrevented=!1}d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g;var v={defaultPrevented:{configurable:!0}};return g.prototype.preventDefault=function(){this._defaultPrevented=!0},v.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(g.prototype,v),g}(o.Event),op=function(d){function g(x,T,R){d.call(this,x,{originalEvent:R}),this._defaultPrevented=!1}d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g;var v={defaultPrevented:{configurable:!0}};return g.prototype.preventDefault=function(){this._defaultPrevented=!0},v.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(g.prototype,v),g}(o.Event),ba=function(d,g){this._map=d,this._clickTolerance=g.clickTolerance};ba.prototype.reset=function(){delete this._mousedownPos},ba.prototype.wheel=function(d){return this._firePreventable(new op(d.type,this._map,d))},ba.prototype.mousedown=function(d,g){return this._mousedownPos=g,this._firePreventable(new lo(d.type,this._map,d))},ba.prototype.mouseup=function(d){this._map.fire(new lo(d.type,this._map,d))},ba.prototype.click=function(d,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||this._map.fire(new lo(d.type,this._map,d))},ba.prototype.dblclick=function(d){return this._firePreventable(new lo(d.type,this._map,d))},ba.prototype.mouseover=function(d){this._map.fire(new lo(d.type,this._map,d))},ba.prototype.mouseout=function(d){this._map.fire(new lo(d.type,this._map,d))},ba.prototype.touchstart=function(d){return this._firePreventable(new Sf(d.type,this._map,d))},ba.prototype.touchmove=function(d){this._map.fire(new Sf(d.type,this._map,d))},ba.prototype.touchend=function(d){this._map.fire(new Sf(d.type,this._map,d))},ba.prototype.touchcancel=function(d){this._map.fire(new Sf(d.type,this._map,d))},ba.prototype._firePreventable=function(d){if(this._map.fire(d),d.defaultPrevented)return{}},ba.prototype.isEnabled=function(){return!0},ba.prototype.isActive=function(){return!1},ba.prototype.enable=function(){},ba.prototype.disable=function(){};var mn=function(d){this._map=d};mn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},mn.prototype.mousemove=function(d){this._map.fire(new lo(d.type,this._map,d))},mn.prototype.mousedown=function(){this._delayContextMenu=!0},mn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},mn.prototype.contextmenu=function(d){this._delayContextMenu?this._contextMenuEvent=d:this._map.fire(new lo(d.type,this._map,d)),this._map.listens("contextmenu")&&d.preventDefault()},mn.prototype.isEnabled=function(){return!0},mn.prototype.isActive=function(){return!1},mn.prototype.enable=function(){},mn.prototype.disable=function(){};var Xo=function(d,g){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=g.clickTolerance||1};function Js(d,g){for(var v={},x=0;x<d.length;x++)v[d[x].identifier]=g[x];return v}Xo.prototype.isEnabled=function(){return!!this._enabled},Xo.prototype.isActive=function(){return!!this._active},Xo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Xo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xo.prototype.mousedown=function(d,g){this.isEnabled()&&d.shiftKey&&d.button===0&&(c.disableDrag(),this._startPos=this._lastPos=g,this._active=!0)},Xo.prototype.mousemoveWindow=function(d,g){if(this._active){var v=g;if(!(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)){var x=this._startPos;this._lastPos=v,this._box||(this._box=c.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",d));var T=Math.min(x.x,v.x),R=Math.max(x.x,v.x),F=Math.min(x.y,v.y),U=Math.max(x.y,v.y);c.setTransform(this._box,"translate("+T+"px,"+F+"px)"),this._box.style.width=R-T+"px",this._box.style.height=U-F+"px"}}},Xo.prototype.mouseupWindow=function(d,g){var v=this;if(this._active&&d.button===0){var x=this._startPos,T=g;if(this.reset(),c.suppressClick(),x.x!==T.x||x.y!==T.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:d})),{cameraAnimation:function(R){return R.fitScreenCoordinates(x,T,v._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",d)}},Xo.prototype.keydown=function(d){this._active&&d.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",d))},Xo.prototype.blur=function(){this.reset()},Xo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(c.remove(this._box),this._box=null),c.enableDrag(),delete this._startPos,delete this._lastPos},Xo.prototype._fireEvent=function(d,g){return this._map.fire(new o.Event(d,{originalEvent:g}))};var Ju=function(d){this.reset(),this.numTouches=d.numTouches};Ju.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Ju.prototype.touchstart=function(d,g,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=d.timeStamp),v.length===this.numTouches&&(this.centroid=function(x){for(var T=new o.Point(0,0),R=0,F=x;R<F.length;R+=1)T._add(F[R]);return T.div(x.length)}(g),this.touches=Js(v,g)))},Ju.prototype.touchmove=function(d,g,v){if(!this.aborted&&this.centroid){var x=Js(v,g);for(var T in this.touches){var R=x[T];(!R||R.dist(this.touches[T])>30)&&(this.aborted=!0)}}},Ju.prototype.touchend=function(d,g,v){if((!this.centroid||d.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){var x=!this.aborted&&this.centroid;if(this.reset(),x)return x}};var Uu=function(d){this.singleTap=new Ju(d),this.numTaps=d.numTaps,this.reset()};Uu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Uu.prototype.touchstart=function(d,g,v){this.singleTap.touchstart(d,g,v)},Uu.prototype.touchmove=function(d,g,v){this.singleTap.touchmove(d,g,v)},Uu.prototype.touchend=function(d,g,v){var x=this.singleTap.touchend(d,g,v);if(x){var T=d.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(x)<30;if(T&&R||this.reset(),this.count++,this.lastTime=d.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}};var fs=function(){this._zoomIn=new Uu({numTouches:1,numTaps:2}),this._zoomOut=new Uu({numTouches:2,numTaps:1}),this.reset()};fs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},fs.prototype.touchstart=function(d,g,v){this._zoomIn.touchstart(d,g,v),this._zoomOut.touchstart(d,g,v)},fs.prototype.touchmove=function(d,g,v){this._zoomIn.touchmove(d,g,v),this._zoomOut.touchmove(d,g,v)},fs.prototype.touchend=function(d,g,v){var x=this,T=this._zoomIn.touchend(d,g,v),R=this._zoomOut.touchend(d,g,v);return T?(this._active=!0,d.preventDefault(),setTimeout(function(){return x.reset()},0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(T)},{originalEvent:d})}}):R?(this._active=!0,d.preventDefault(),setTimeout(function(){return x.reset()},0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(R)},{originalEvent:d})}}):void 0},fs.prototype.touchcancel=function(){this.reset()},fs.prototype.enable=function(){this._enabled=!0},fs.prototype.disable=function(){this._enabled=!1,this.reset()},fs.prototype.isEnabled=function(){return this._enabled},fs.prototype.isActive=function(){return this._active};var Kf={0:1,2:2},qr=function(d){this.reset(),this._clickTolerance=d.clickTolerance||1};qr.prototype.blur=function(){this.reset()},qr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qr.prototype._correctButton=function(d,g){return!1},qr.prototype._move=function(d,g){return{}},qr.prototype.mousedown=function(d,g){if(!this._lastPoint){var v=c.mouseButton(d);this._correctButton(d,v)&&(this._lastPoint=g,this._eventButton=v)}},qr.prototype.mousemoveWindow=function(d,g){var v=this._lastPoint;if(v){if(d.preventDefault(),function(x,T){var R=Kf[T];return x.buttons===void 0||(x.buttons&R)!==R}(d,this._eventButton))this.reset();else if(this._moved||!(g.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(v,g)}},qr.prototype.mouseupWindow=function(d){this._lastPoint&&c.mouseButton(d)===this._eventButton&&(this._moved&&c.suppressClick(),this.reset())},qr.prototype.enable=function(){this._enabled=!0},qr.prototype.disable=function(){this._enabled=!1,this.reset()},qr.prototype.isEnabled=function(){return this._enabled},qr.prototype.isActive=function(){return this._active};var Kl=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.mousedown=function(v,x){d.prototype.mousedown.call(this,v,x),this._lastPoint&&(this._active=!0)},g.prototype._correctButton=function(v,x){return x===0&&!v.ctrlKey},g.prototype._move=function(v,x){return{around:x,panDelta:x.sub(v)}},g}(qr),Jo=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype._correctButton=function(v,x){return x===0&&v.ctrlKey||x===2},g.prototype._move=function(v,x){var T=.8*(x.x-v.x);if(T)return this._active=!0,{bearingDelta:T}},g.prototype.contextmenu=function(v){v.preventDefault()},g}(qr),Hc=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype._correctButton=function(v,x){return x===0&&v.ctrlKey||x===2},g.prototype._move=function(v,x){var T=-.5*(x.y-v.y);if(T)return this._active=!0,{pitchDelta:T}},g.prototype.contextmenu=function(v){v.preventDefault()},g}(qr),hs=function(d){this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset()};hs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},hs.prototype.touchstart=function(d,g,v){return this._calculateTransform(d,g,v)},hs.prototype.touchmove=function(d,g,v){if(this._active&&!(v.length<this._minTouches))return d.preventDefault(),this._calculateTransform(d,g,v)},hs.prototype.touchend=function(d,g,v){this._calculateTransform(d,g,v),this._active&&v.length<this._minTouches&&this.reset()},hs.prototype.touchcancel=function(){this.reset()},hs.prototype._calculateTransform=function(d,g,v){v.length>0&&(this._active=!0);var x=Js(v,g),T=new o.Point(0,0),R=new o.Point(0,0),F=0;for(var U in x){var X=x[U],re=this._touches[U];re&&(T._add(X),R._add(X.sub(re)),F++,x[U]=X)}if(this._touches=x,!(F<this._minTouches)&&R.mag()){var he=R.div(F);if(this._sum._add(he),!(this._sum.mag()<this._clickTolerance))return{around:T.div(F),panDelta:he}}},hs.prototype.enable=function(){this._enabled=!0},hs.prototype.disable=function(){this._enabled=!1,this.reset()},hs.prototype.isEnabled=function(){return this._enabled},hs.prototype.isActive=function(){return this._active};var Bo=function(){this.reset()};function kh(d,g,v){for(var x=0;x<d.length;x++)if(d[x].identifier===v)return g[x]}function sp(d,g){return Math.log(d/g)/Math.LN2}Bo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Bo.prototype._start=function(d){},Bo.prototype._move=function(d,g,v){return{}},Bo.prototype.touchstart=function(d,g,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([g[0],g[1]]))},Bo.prototype.touchmove=function(d,g,v){if(this._firstTwoTouches){d.preventDefault();var x=this._firstTwoTouches,T=x[1],R=kh(v,g,x[0]),F=kh(v,g,T);if(R&&F){var U=this._aroundCenter?null:R.add(F).div(2);return this._move([R,F],U,d)}}},Bo.prototype.touchend=function(d,g,v){if(this._firstTwoTouches){var x=this._firstTwoTouches,T=x[1],R=kh(v,g,x[0]),F=kh(v,g,T);R&&F||(this._active&&c.suppressClick(),this.reset())}},Bo.prototype.touchcancel=function(){this.reset()},Bo.prototype.enable=function(d){this._enabled=!0,this._aroundCenter=!!d&&d.around==="center"},Bo.prototype.disable=function(){this._enabled=!1,this.reset()},Bo.prototype.isEnabled=function(){return this._enabled},Bo.prototype.isActive=function(){return this._active};var Eu=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.reset=function(){d.prototype.reset.call(this),delete this._distance,delete this._startDistance},g.prototype._start=function(v){this._startDistance=this._distance=v[0].dist(v[1])},g.prototype._move=function(v,x){var T=this._distance;if(this._distance=v[0].dist(v[1]),this._active||!(Math.abs(sp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sp(this._distance,T),pinchAround:x}},g}(Bo);function xl(d,g){return 180*d.angleWith(g)/Math.PI}var dc=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.reset=function(){d.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},g.prototype._start=function(v){this._startVector=this._vector=v[0].sub(v[1]),this._minDiameter=v[0].dist(v[1])},g.prototype._move=function(v,x){var T=this._vector;if(this._vector=v[0].sub(v[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xl(this._vector,T),pinchAround:x}},g.prototype._isBelowThreshold=function(v){this._minDiameter=Math.min(this._minDiameter,v.mag());var x=25/(Math.PI*this._minDiameter)*360,T=xl(v,this._startVector);return Math.abs(T)<x},g}(Bo);function bl(d){return Math.abs(d.y)>Math.abs(d.x)}var Qf=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.reset=function(){d.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},g.prototype._start=function(v){this._lastPoints=v,bl(v[0].sub(v[1]))&&(this._valid=!1)},g.prototype._move=function(v,x,T){var R=v[0].sub(this._lastPoints[0]),F=v[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(R,F,T.timeStamp),this._valid)return this._lastPoints=v,this._active=!0,{pitchDelta:(R.y+F.y)/2*-.5}},g.prototype.gestureBeginsVertically=function(v,x,T){if(this._valid!==void 0)return this._valid;var R=v.mag()>=2,F=x.mag()>=2;if(R||F){if(!R||!F)return this._firstMove===void 0&&(this._firstMove=T),T-this._firstMove<100&&void 0;var U=v.y>0==x.y>0;return bl(v)&&bl(x)&&U}},g}(Bo),vc={panStep:100,bearingStep:15,pitchStep:10},el=function(){var d=vc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1};function Vu(d){return d*(2-d)}el.prototype.blur=function(){this.reset()},el.prototype.reset=function(){this._active=!1},el.prototype.keydown=function(d){var g=this;if(!(d.altKey||d.ctrlKey||d.metaKey)){var v=0,x=0,T=0,R=0,F=0;switch(d.keyCode){case 61:case 107:case 171:case 187:v=1;break;case 189:case 109:case 173:v=-1;break;case 37:d.shiftKey?x=-1:(d.preventDefault(),R=-1);break;case 39:d.shiftKey?x=1:(d.preventDefault(),R=1);break;case 38:d.shiftKey?T=1:(d.preventDefault(),F=-1);break;case 40:d.shiftKey?T=-1:(d.preventDefault(),F=1);break;default:return}return this._rotationDisabled&&(x=0,T=0),{cameraAnimation:function(U){var X=U.getZoom();U.easeTo({duration:300,easeId:"keyboardHandler",easing:Vu,zoom:v?Math.round(X)+v*(d.shiftKey?2:1):X,bearing:U.getBearing()+x*g._bearingStep,pitch:U.getPitch()+T*g._pitchStep,offset:[-R*g._panStep,-F*g._panStep],center:U.getCenter()},{originalEvent:d})}}}},el.prototype.enable=function(){this._enabled=!0},el.prototype.disable=function(){this._enabled=!1,this.reset()},el.prototype.isEnabled=function(){return this._enabled},el.prototype.isActive=function(){return this._active},el.prototype.disableRotation=function(){this._rotationDisabled=!0},el.prototype.enableRotation=function(){this._rotationDisabled=!1};var ti=function(d,g){this._map=d,this._el=d.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};ti.prototype.setZoomRate=function(d){this._defaultZoomRate=d},ti.prototype.setWheelZoomRate=function(d){this._wheelZoomRate=d},ti.prototype.isEnabled=function(){return!!this._enabled},ti.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ti.prototype.isZooming=function(){return!!this._zooming},ti.prototype.enable=function(d){this.isEnabled()||(this._enabled=!0,this._aroundCenter=d&&d.around==="center")},ti.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ti.prototype.wheel=function(d){if(this.isEnabled()){var g=d.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*d.deltaY:d.deltaY,v=o.browser.now(),x=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,g!==0&&g%4.000244140625==0?this._type="wheel":g!==0&&Math.abs(g)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,d)):this._type||(this._type=Math.abs(x*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),d.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=d,this._delta-=g,this._active||this._start(d)),d.preventDefault()}},ti.prototype._onTimeout=function(d){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},ti.prototype._start=function(d){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var g=c.mousePos(this._el,d);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(g)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ti.prototype.renderFrame=function(){var d=this;if(this._frameId&&(this._frameId=null,this.isActive())){var g=this._map.transform;if(this._delta!==0){var v=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,x=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&x!==0&&(x=1/x);var T=typeof this._targetZoom=="number"?g.zoomScale(this._targetZoom):g.scale;this._targetZoom=Math.min(g.maxZoom,Math.max(g.minZoom,g.scaleZoom(T*x))),this._type==="wheel"&&(this._startZoom=g.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var R,F=typeof this._targetZoom=="number"?this._targetZoom:g.zoom,U=this._startZoom,X=this._easing,re=!1;if(this._type==="wheel"&&U&&X){var he=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),me=X(he);R=o.number(U,F,me),he<1?this._frameId||(this._frameId=!0):re=!0}else R=F,re=!0;return this._active=!0,re&&(this._active=!1,this._finishTimeout=setTimeout(function(){d._zooming=!1,d._handler._triggerRenderFrame(),delete d._targetZoom,delete d._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!re,zoomDelta:R-g.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ti.prototype._smoothOutEasing=function(d){var g=o.ease;if(this._prevEase){var v=this._prevEase,x=(o.browser.now()-v.start)/v.duration,T=v.easing(x+.01)-v.easing(x),R=.27/Math.sqrt(T*T+1e-4)*.01,F=Math.sqrt(.0729-R*R);g=o.bezier(R,F,.25,1)}return this._prevEase={start:o.browser.now(),duration:d,easing:g},g},ti.prototype.blur=function(){this.reset()},ti.prototype.reset=function(){this._active=!1};var _o=function(d,g){this._clickZoom=d,this._tapZoom=g};_o.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},_o.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},_o.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},_o.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Cu=function(){this.reset()};Cu.prototype.reset=function(){this._active=!1},Cu.prototype.blur=function(){this.reset()},Cu.prototype.dblclick=function(d,g){return d.preventDefault(),{cameraAnimation:function(v){v.easeTo({duration:300,zoom:v.getZoom()+(d.shiftKey?-1:1),around:v.unproject(g)},{originalEvent:d})}}},Cu.prototype.enable=function(){this._enabled=!0},Cu.prototype.disable=function(){this._enabled=!1,this.reset()},Cu.prototype.isEnabled=function(){return this._enabled},Cu.prototype.isActive=function(){return this._active};var Ds=function(){this._tap=new Uu({numTouches:1,numTaps:1}),this.reset()};Ds.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ds.prototype.touchstart=function(d,g,v){this._swipePoint||(this._tapTime&&d.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=g[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(d,g,v))},Ds.prototype.touchmove=function(d,g,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;var x=g[0],T=x.y-this._swipePoint.y;return this._swipePoint=x,d.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(d,g,v)},Ds.prototype.touchend=function(d,g,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(d,g,v)&&(this._tapTime=d.timeStamp)},Ds.prototype.touchcancel=function(){this.reset()},Ds.prototype.enable=function(){this._enabled=!0},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active};var El=function(d,g,v){this._el=d,this._mousePan=g,this._touchPan=v};El.prototype.enable=function(d){this._inertiaOptions=d||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},El.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},El.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},El.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Wc=function(d,g,v){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=g,this._mousePitch=v};Wc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Wc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Wc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Wc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ps=function(d,g,v,x){this._el=d,this._touchZoom=g,this._touchRotate=v,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0};ps.prototype.enable=function(d){this._touchZoom.enable(d),this._rotationDisabled||this._touchRotate.enable(d),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ps.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ps.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ps.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ps.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ps.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var xo=function(d){return d.zoom||d.drag||d.pitch||d.rotate},$c=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g}(o.Event);function kn(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}var bn=function(d,g){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cf(d),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(g),o.bindAll(["handleEvent","handleWindowEvent"],this);var v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[o.window,"blur",void 0]];for(var x=0,T=this._listeners;x<T.length;x+=1){var R=T[x],F=R[0];c.addEventListener(F,R[1],F===o.window.document?this.handleWindowEvent:this.handleEvent,R[2])}};bn.prototype.destroy=function(){for(var d=0,g=this._listeners;d<g.length;d+=1){var v=g[d],x=v[0];c.removeEventListener(x,v[1],x===o.window.document?this.handleWindowEvent:this.handleEvent,v[2])}},bn.prototype._addDefaultHandlers=function(d){var g=this._map,v=g.getCanvasContainer();this._add("mapEvent",new ba(g,d));var x=g.boxZoom=new Xo(g,d);this._add("boxZoom",x);var T=new fs,R=new Cu;g.doubleClickZoom=new _o(R,T),this._add("tapZoom",T),this._add("clickZoom",R);var F=new Ds;this._add("tapDragZoom",F);var U=g.touchPitch=new Qf;this._add("touchPitch",U);var X=new Jo(d),re=new Hc(d);g.dragRotate=new Wc(d,X,re),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",re,["mouseRotate"]);var he=new Kl(d),me=new hs(d);g.dragPan=new El(v,he,me),this._add("mousePan",he),this._add("touchPan",me,["touchZoom","touchRotate"]);var xe=new dc,Ne=new Eu;g.touchZoomRotate=new ps(v,Ne,xe,F),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Ne,["touchPan","touchRotate"]);var Fe=g.scrollZoom=new ti(g,this);this._add("scrollZoom",Fe,["mousePan"]);var qe=g.keyboard=new el;this._add("keyboard",qe),this._add("blockableMapEvent",new mn(g));for(var Re=0,Ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Re<Ze.length;Re+=1){var at=Ze[Re];d.interactive&&d[at]&&g[at].enable(d[at])}},bn.prototype._add=function(d,g,v){this._handlers.push({handlerName:d,handler:g,allowed:v}),this._handlersById[d]=g},bn.prototype.stop=function(d){if(!this._updatingCamera){for(var g=0,v=this._handlers;g<v.length;g+=1)v[g].handler.reset();this._inertia.clear(),this._fireEvents({},{},d),this._changes=[]}},bn.prototype.isActive=function(){for(var d=0,g=this._handlers;d<g.length;d+=1)if(g[d].handler.isActive())return!0;return!1},bn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},bn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},bn.prototype.isMoving=function(){return Boolean(xo(this._eventsInProgress))||this.isZooming()},bn.prototype._blockedByActive=function(d,g,v){for(var x in d)if(x!==v&&(!g||g.indexOf(x)<0))return!0;return!1},bn.prototype.handleWindowEvent=function(d){this.handleEvent(d,d.type+"Window")},bn.prototype._getMapTouches=function(d){for(var g=[],v=0,x=d;v<x.length;v+=1){var T=x[v];this._el.contains(T.target)&&g.push(T)}return g},bn.prototype.handleEvent=function(d,g){this._updatingCamera=!0;for(var v=d.type==="renderFrame"?void 0:d,x={needsRenderFrame:!1},T={},R={},F=d.touches?this._getMapTouches(d.touches):void 0,U=F?c.touchPos(this._el,F):c.mousePos(this._el,d),X=0,re=this._handlers;X<re.length;X+=1){var he=re[X],me=he.handlerName,xe=he.handler,Ne=he.allowed;if(xe.isEnabled()){var Fe=void 0;this._blockedByActive(R,Ne,me)?xe.reset():xe[g||d.type]&&(Fe=xe[g||d.type](d,U,F),this.mergeHandlerResult(x,T,Fe,me,v),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||xe.isActive())&&(R[me]=xe)}}var qe={};for(var Re in this._previousActiveHandlers)R[Re]||(qe[Re]=v);this._previousActiveHandlers=R,(Object.keys(qe).length||kn(x))&&(this._changes.push([x,T,qe]),this._triggerRenderFrame()),(Object.keys(R).length||kn(x))&&this._map._stop(!0),this._updatingCamera=!1;var Ze=x.cameraAnimation;Ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ze(this._map))},bn.prototype.mergeHandlerResult=function(d,g,v,x,T){if(v){o.extend(d,v);var R={handlerName:x,originalEvent:v.originalEvent||T};v.zoomDelta!==void 0&&(g.zoom=R),v.panDelta!==void 0&&(g.drag=R),v.pitchDelta!==void 0&&(g.pitch=R),v.bearingDelta!==void 0&&(g.rotate=R)}},bn.prototype._applyChanges=function(){for(var d={},g={},v={},x=0,T=this._changes;x<T.length;x+=1){var R=T[x],F=R[0],U=R[1],X=R[2];F.panDelta&&(d.panDelta=(d.panDelta||new o.Point(0,0))._add(F.panDelta)),F.zoomDelta&&(d.zoomDelta=(d.zoomDelta||0)+F.zoomDelta),F.bearingDelta&&(d.bearingDelta=(d.bearingDelta||0)+F.bearingDelta),F.pitchDelta&&(d.pitchDelta=(d.pitchDelta||0)+F.pitchDelta),F.around!==void 0&&(d.around=F.around),F.pinchAround!==void 0&&(d.pinchAround=F.pinchAround),F.noInertia&&(d.noInertia=F.noInertia),o.extend(g,U),o.extend(v,X)}this._updateMapTransform(d,g,v),this._changes=[]},bn.prototype._updateMapTransform=function(d,g,v){var x=this._map,T=x.transform;if(!kn(d))return this._fireEvents(g,v,!0);var R=d.panDelta,F=d.zoomDelta,U=d.bearingDelta,X=d.pitchDelta,re=d.around,he=d.pinchAround;he!==void 0&&(re=he),x._stop(!0),re=re||x.transform.centerPoint;var me=T.pointLocation(R?re.sub(R):re);U&&(T.bearing+=U),X&&(T.pitch+=X),F&&(T.zoom+=F),T.setLocationAtPoint(me,re),this._map._update(),d.noInertia||this._inertia.record(d),this._fireEvents(g,v,!0)},bn.prototype._fireEvents=function(d,g,v){var x=this,T=xo(this._eventsInProgress),R=xo(d),F={};for(var U in d)this._eventsInProgress[U]||(F[U+"start"]=d[U].originalEvent),this._eventsInProgress[U]=d[U];for(var X in!T&&R&&this._fireEvent("movestart",R.originalEvent),F)this._fireEvent(X,F[X]);for(var re in R&&this._fireEvent("move",R.originalEvent),d)this._fireEvent(re,d[re].originalEvent);var he,me={};for(var xe in this._eventsInProgress){var Ne=this._eventsInProgress[xe],Fe=Ne.handlerName,qe=Ne.originalEvent;this._handlersById[Fe].isActive()||(delete this._eventsInProgress[xe],me[xe+"end"]=he=g[Fe]||qe)}for(var Re in me)this._fireEvent(Re,me[Re]);var Ze=xo(this._eventsInProgress);if(v&&(T||R)&&!Ze){this._updatingCamera=!0;var at=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ht=function(Ot){return Ot!==0&&-x._bearingSnap<Ot&&Ot<x._bearingSnap};at?(ht(at.bearing||this._map.getBearing())&&(at.bearing=0),this._map.easeTo(at,{originalEvent:he})):(this._map.fire(new o.Event("moveend",{originalEvent:he})),ht(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},bn.prototype._fireEvent=function(d,g){this._map.fire(new o.Event(d,g?{originalEvent:g}:{}))},bn.prototype._requestFrame=function(){var d=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(g){delete d._frameId,d.handleEvent(new $c("renderFrame",{timeStamp:g})),d._applyChanges()})},bn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var mc=function(d){function g(v,x){d.call(this),this._moving=!1,this._zooming=!1,this.transform=v,this._bearingSnap=x.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},g.prototype.setCenter=function(v,x){return this.jumpTo({center:v},x)},g.prototype.panBy=function(v,x,T){return v=o.Point.convert(v).mult(-1),this.panTo(this.transform.center,o.extend({offset:v},x),T)},g.prototype.panTo=function(v,x,T){return this.easeTo(o.extend({center:v},x),T)},g.prototype.getZoom=function(){return this.transform.zoom},g.prototype.setZoom=function(v,x){return this.jumpTo({zoom:v},x),this},g.prototype.zoomTo=function(v,x,T){return this.easeTo(o.extend({zoom:v},x),T)},g.prototype.zoomIn=function(v,x){return this.zoomTo(this.getZoom()+1,v,x),this},g.prototype.zoomOut=function(v,x){return this.zoomTo(this.getZoom()-1,v,x),this},g.prototype.getBearing=function(){return this.transform.bearing},g.prototype.setBearing=function(v,x){return this.jumpTo({bearing:v},x),this},g.prototype.getPadding=function(){return this.transform.padding},g.prototype.setPadding=function(v,x){return this.jumpTo({padding:v},x),this},g.prototype.rotateTo=function(v,x,T){return this.easeTo(o.extend({bearing:v},x),T)},g.prototype.resetNorth=function(v,x){return this.rotateTo(0,o.extend({duration:1e3},v),x),this},g.prototype.resetNorthPitch=function(v,x){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},v),x),this},g.prototype.snapToNorth=function(v,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(v,x):this},g.prototype.getPitch=function(){return this.transform.pitch},g.prototype.setPitch=function(v,x){return this.jumpTo({pitch:v},x),this},g.prototype.cameraForBounds=function(v,x){v=o.LngLatBounds.convert(v);var T=x&&x.bearing||0;return this._cameraForBoxAndBearing(v.getNorthWest(),v.getSouthEast(),T,x)},g.prototype._cameraForBoxAndBearing=function(v,x,T,R){var F={top:0,bottom:0,right:0,left:0};if(typeof(R=o.extend({padding:F,offset:[0,0],maxZoom:this.transform.maxZoom},R)).padding=="number"){var U=R.padding;R.padding={top:U,bottom:U,right:U,left:U}}R.padding=o.extend(F,R.padding);var X=this.transform,re=X.padding,he=X.project(o.LngLat.convert(v)),me=X.project(o.LngLat.convert(x)),xe=he.rotate(-T*Math.PI/180),Ne=me.rotate(-T*Math.PI/180),Fe=new o.Point(Math.max(xe.x,Ne.x),Math.max(xe.y,Ne.y)),qe=new o.Point(Math.min(xe.x,Ne.x),Math.min(xe.y,Ne.y)),Re=Fe.sub(qe),Ze=(X.width-(re.left+re.right+R.padding.left+R.padding.right))/Re.x,at=(X.height-(re.top+re.bottom+R.padding.top+R.padding.bottom))/Re.y;if(!(at<0||Ze<0)){var ht=Math.min(X.scaleZoom(X.scale*Math.min(Ze,at)),R.maxZoom),Ot=typeof R.offset.x=="number"?new o.Point(R.offset.x,R.offset.y):o.Point.convert(R.offset),It=new o.Point((R.padding.left-R.padding.right)/2,(R.padding.top-R.padding.bottom)/2).rotate(T*Math.PI/180),Ut=Ot.add(It).mult(X.scale/X.zoomScale(ht));return{center:X.unproject(he.add(me).div(2).sub(Ut)),zoom:ht,bearing:T}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},g.prototype.fitBounds=function(v,x,T){return this._fitInternal(this.cameraForBounds(v,x),x,T)},g.prototype.fitScreenCoordinates=function(v,x,T,R,F){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(v)),this.transform.pointLocation(o.Point.convert(x)),T,R),R,F)},g.prototype._fitInternal=function(v,x,T){return v?(delete(x=o.extend(v,x)).padding,x.linear?this.easeTo(x,T):this.flyTo(x,T)):this},g.prototype.jumpTo=function(v,x){this.stop();var T=this.transform,R=!1,F=!1,U=!1;return"zoom"in v&&T.zoom!==+v.zoom&&(R=!0,T.zoom=+v.zoom),v.center!==void 0&&(T.center=o.LngLat.convert(v.center)),"bearing"in v&&T.bearing!==+v.bearing&&(F=!0,T.bearing=+v.bearing),"pitch"in v&&T.pitch!==+v.pitch&&(U=!0,T.pitch=+v.pitch),v.padding==null||T.isPaddingEqual(v.padding)||(T.padding=v.padding),this.fire(new o.Event("movestart",x)).fire(new o.Event("move",x)),R&&this.fire(new o.Event("zoomstart",x)).fire(new o.Event("zoom",x)).fire(new o.Event("zoomend",x)),F&&this.fire(new o.Event("rotatestart",x)).fire(new o.Event("rotate",x)).fire(new o.Event("rotateend",x)),U&&this.fire(new o.Event("pitchstart",x)).fire(new o.Event("pitch",x)).fire(new o.Event("pitchend",x)),this.fire(new o.Event("moveend",x))},g.prototype.easeTo=function(v,x){var T=this;this._stop(!1,v.easeId),((v=o.extend({offset:[0,0],duration:500,easing:o.ease},v)).animate===!1||!v.essential&&o.browser.prefersReducedMotion)&&(v.duration=0);var R=this.transform,F=this.getZoom(),U=this.getBearing(),X=this.getPitch(),re=this.getPadding(),he="zoom"in v?+v.zoom:F,me="bearing"in v?this._normalizeBearing(v.bearing,U):U,xe="pitch"in v?+v.pitch:X,Ne="padding"in v?v.padding:R.padding,Fe=o.Point.convert(v.offset),qe=R.centerPoint.add(Fe),Re=R.pointLocation(qe),Ze=o.LngLat.convert(v.center||Re);this._normalizeCenter(Ze);var at,ht,Ot=R.project(Re),It=R.project(Ze).sub(Ot),Ut=R.zoomScale(he-F);v.around&&(at=o.LngLat.convert(v.around),ht=R.locationPoint(at));var cr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||he!==F,this._rotating=this._rotating||U!==me,this._pitching=this._pitching||xe!==X,this._padding=!R.isPaddingEqual(Ne),this._easeId=v.easeId,this._prepareEase(x,v.noMoveStart,cr),this._ease(function(Sr){if(T._zooming&&(R.zoom=o.number(F,he,Sr)),T._rotating&&(R.bearing=o.number(U,me,Sr)),T._pitching&&(R.pitch=o.number(X,xe,Sr)),T._padding&&(R.interpolatePadding(re,Ne,Sr),qe=R.centerPoint.add(Fe)),at)R.setLocationAtPoint(at,ht);else{var zr=R.zoomScale(R.zoom-F),sn=he>F?Math.min(2,Ut):Math.max(.5,Ut),Cn=Math.pow(sn,1-Sr),Dn=R.unproject(Ot.add(It.mult(Sr*Cn)).mult(zr));R.setLocationAtPoint(R.renderWorldCopies?Dn.wrap():Dn,qe)}T._fireMoveEvents(x)},function(Sr){T._afterEase(x,Sr)},v),this},g.prototype._prepareEase=function(v,x,T){T===void 0&&(T={}),this._moving=!0,x||T.moving||this.fire(new o.Event("movestart",v)),this._zooming&&!T.zooming&&this.fire(new o.Event("zoomstart",v)),this._rotating&&!T.rotating&&this.fire(new o.Event("rotatestart",v)),this._pitching&&!T.pitching&&this.fire(new o.Event("pitchstart",v))},g.prototype._fireMoveEvents=function(v){this.fire(new o.Event("move",v)),this._zooming&&this.fire(new o.Event("zoom",v)),this._rotating&&this.fire(new o.Event("rotate",v)),this._pitching&&this.fire(new o.Event("pitch",v))},g.prototype._afterEase=function(v,x){if(!this._easeId||!x||this._easeId!==x){delete this._easeId;var T=this._zooming,R=this._rotating,F=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,T&&this.fire(new o.Event("zoomend",v)),R&&this.fire(new o.Event("rotateend",v)),F&&this.fire(new o.Event("pitchend",v)),this.fire(new o.Event("moveend",v))}},g.prototype.flyTo=function(v,x){var T=this;if(!v.essential&&o.browser.prefersReducedMotion){var R=o.pick(v,["center","zoom","bearing","pitch","around"]);return this.jumpTo(R,x)}this.stop(),v=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},v);var F=this.transform,U=this.getZoom(),X=this.getBearing(),re=this.getPitch(),he=this.getPadding(),me="zoom"in v?o.clamp(+v.zoom,F.minZoom,F.maxZoom):U,xe="bearing"in v?this._normalizeBearing(v.bearing,X):X,Ne="pitch"in v?+v.pitch:re,Fe="padding"in v?v.padding:F.padding,qe=F.zoomScale(me-U),Re=o.Point.convert(v.offset),Ze=F.centerPoint.add(Re),at=F.pointLocation(Ze),ht=o.LngLat.convert(v.center||at);this._normalizeCenter(ht);var Ot=F.project(at),It=F.project(ht).sub(Ot),Ut=v.curve,cr=Math.max(F.width,F.height),Sr=cr/qe,zr=It.mag();if("minZoom"in v){var sn=o.clamp(Math.min(v.minZoom,U,me),F.minZoom,F.maxZoom),Cn=cr/F.zoomScale(sn-U);Ut=Math.sqrt(Cn/zr*2)}var Dn=Ut*Ut;function Nn(Qn){var wn=(Sr*Sr-cr*cr+(Qn?-1:1)*Dn*Dn*zr*zr)/(2*(Qn?Sr:cr)*Dn*zr);return Math.log(Math.sqrt(wn*wn+1)-wn)}function ta(Qn){return(Math.exp(Qn)-Math.exp(-Qn))/2}function un(Qn){return(Math.exp(Qn)+Math.exp(-Qn))/2}var Zn=Nn(0),ui=function(Qn){return un(Zn)/un(Zn+Ut*Qn)},ni=function(Qn){return cr*((un(Zn)*(ta(wn=Zn+Ut*Qn)/un(wn))-ta(Zn))/Dn)/zr;var wn},jn=(Nn(1)-Zn)/Ut;if(Math.abs(zr)<1e-6||!isFinite(jn)){if(Math.abs(cr-Sr)<1e-6)return this.easeTo(v,x);var yi=Sr<cr?-1:1;jn=Math.abs(Math.log(Sr/cr))/Ut,ni=function(){return 0},ui=function(Qn){return Math.exp(yi*Ut*Qn)}}return v.duration="duration"in v?+v.duration:1e3*jn/("screenSpeed"in v?+v.screenSpeed/Ut:+v.speed),v.maxDuration&&v.duration>v.maxDuration&&(v.duration=0),this._zooming=!0,this._rotating=X!==xe,this._pitching=Ne!==re,this._padding=!F.isPaddingEqual(Fe),this._prepareEase(x,!1),this._ease(function(Qn){var wn=Qn*jn,Ba=1/ui(wn);F.zoom=Qn===1?me:U+F.scaleZoom(Ba),T._rotating&&(F.bearing=o.number(X,xe,Qn)),T._pitching&&(F.pitch=o.number(re,Ne,Qn)),T._padding&&(F.interpolatePadding(he,Fe,Qn),Ze=F.centerPoint.add(Re));var co=Qn===1?ht:F.unproject(Ot.add(It.mult(ni(wn))).mult(Ba));F.setLocationAtPoint(F.renderWorldCopies?co.wrap():co,Ze),T._fireMoveEvents(x)},function(){return T._afterEase(x)},v),this},g.prototype.isEasing=function(){return!!this._easeFrameId},g.prototype.stop=function(){return this._stop()},g.prototype._stop=function(v,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,x)}if(!v){var R=this.handlers;R&&R.stop(!1)}return this},g.prototype._ease=function(v,x,T){T.animate===!1||T.duration===0?(v(1),x()):(this._easeStart=o.browser.now(),this._easeOptions=T,this._onEaseFrame=v,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},g.prototype._renderFrameCallback=function(){var v=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},g.prototype._normalizeBearing=function(v,x){v=o.wrap(v,-180,180);var T=Math.abs(v-x);return Math.abs(v-360-x)<T&&(v-=360),Math.abs(v+360-x)<T&&(v+=360),v},g.prototype._normalizeCenter=function(v){var x=this.transform;if(x.renderWorldCopies&&!x.lngRange){var T=v.lng-x.center.lng;v.lng+=T>180?-360:T<-180?360:0}},g}(o.Evented),ds=function(d){d===void 0&&(d={}),this.options=d,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ds.prototype.getDefaultPosition=function(){return"bottom-right"},ds.prototype.onAdd=function(d){var g=this.options&&this.options.compact;return this._map=d,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=c.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=c.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),g===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ds.prototype.onRemove=function(){c.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ds.prototype._setElementTitle=function(d,g){var v=this._map._getUIString("AttributionControl."+g);d.title=v,d.setAttribute("aria-label",v)},ds.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ds.prototype._updateEditLink=function(){var d=this._editLink;d||(d=this._editLink=this._container.querySelector(".mapbox-improve-map"));var g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(d){var v=g.reduce(function(x,T,R){return T.value&&(x+=T.key+"="+T.value+(R<g.length-1?"&":"")),x},"?");d.href=o.config.FEEDBACK_URL+"/"+v+(this._map._hash?this._map._hash.getHashString(!0):""),d.rel="noopener nofollow",this._setElementTitle(d,"MapFeedback")}},ds.prototype._updateData=function(d){!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ds.prototype._updateAttributions=function(){if(this._map.style){var d=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?d=d.concat(this.options.customAttribution.map(function(U){return typeof U!="string"?"":U})):typeof this.options.customAttribution=="string"&&d.push(this.options.customAttribution)),this._map.style.stylesheet){var g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}var v=this._map.style.sourceCaches;for(var x in v){var T=v[x];if(T.used){var R=T.getSource();R.attribution&&d.indexOf(R.attribution)<0&&d.push(R.attribution)}}d.sort(function(U,X){return U.length-X.length});var F=(d=d.filter(function(U,X){for(var re=X+1;re<d.length;re++)if(d[re].indexOf(U)>=0)return!1;return!0})).join(" | ");F!==this._attribHTML&&(this._attribHTML=F,d.length?(this._innerContainer.innerHTML=F,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ds.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Bs=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};Bs.prototype.onAdd=function(d){this._map=d,this._container=c.create("div","mapboxgl-ctrl");var g=c.create("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Bs.prototype.onRemove=function(){c.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Bs.prototype.getDefaultPosition=function(){return"bottom-left"},Bs.prototype._updateLogo=function(d){d&&d.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Bs.prototype._logoRequired=function(){if(this._map.style){var d=this._map.style.sourceCaches;for(var g in d)if(d[g].getSource().mapbox_logo)return!0;return!1}},Bs.prototype._updateCompact=function(){var d=this._container.children;if(d.length){var g=d[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}};var is=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};is.prototype.add=function(d){var g=++this._id;return this._queue.push({callback:d,id:g,cancelled:!1}),g},is.prototype.remove=function(d){for(var g=this._currentlyRunning,v=0,x=g?this._queue.concat(g):this._queue;v<x.length;v+=1){var T=x[v];if(T.id===d)return void(T.cancelled=!0)}},is.prototype.run=function(d){d===void 0&&(d=0);var g=this._currentlyRunning=this._queue;this._queue=[];for(var v=0,x=g;v<x.length;v+=1){var T=x[v];if(!T.cancelled&&(T.callback(d),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},is.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Cl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},zp=o.window.HTMLImageElement,Su=o.window.HTMLElement,ma=o.window.ImageBitmap,es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},lu=function(d){function g(x){var T=this;if((x=o.extend({},es,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var R=new Gn(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies);if(d.call(this,R,x),this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new is,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Cl,x.locale),this._clickTolerance=x.clickTolerance,this._requestManager=new o.RequestManager(x.transformRequest,x.accessToken),typeof x.container=="string"){if(this._container=o.window.document.getElementById(x.container),!this._container)throw new Error("Container '"+x.container+"' not found.")}else{if(!(x.container instanceof Su))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return T._update(!1)}),this.on("moveend",function(){return T._update(!1)}),this.on("zoom",function(){return T._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new bn(this,x),this._hash=x.hash&&new Qs(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,o.extend({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new ds({customAttribution:x.customAttribution})),this.addControl(new Bs,x.logoPosition),this.on("style.load",function(){T.transform.unmodified&&T.jumpTo(T.style.stylesheet)}),this.on("data",function(F){T._update(F.dataType==="style"),T.fire(new o.Event(F.dataType+"data",F))}),this.on("dataloading",function(F){T.fire(new o.Event(F.dataType+"dataloading",F))})}d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g;var v={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return g.prototype._getMapId=function(){return this._mapId},g.prototype.addControl=function(x,T){if(T===void 0&&(T=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var R=x.onAdd(this);this._controls.push(x);var F=this._controlPositions[T];return T.indexOf("bottom")!==-1?F.insertBefore(R,F.firstChild):F.appendChild(R),this},g.prototype.removeControl=function(x){if(!x||!x.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var T=this._controls.indexOf(x);return T>-1&&this._controls.splice(T,1),x.onRemove(this),this},g.prototype.hasControl=function(x){return this._controls.indexOf(x)>-1},g.prototype.resize=function(x){var T=this._containerDimensions(),R=T[0],F=T[1];if(R===this.transform.width&&F===this.transform.height)return this;this._resizeCanvas(R,F),this.transform.resize(R,F),this.painter.resize(R,F);var U=!this._moving;return U&&this.fire(new o.Event("movestart",x)).fire(new o.Event("move",x)),this.fire(new o.Event("resize",x)),U&&this.fire(new o.Event("moveend",x)),this},g.prototype.getBounds=function(){return this.transform.getBounds()},g.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},g.prototype.setMaxBounds=function(x){return this.transform.setMaxBounds(o.LngLatBounds.convert(x)),this._update()},g.prototype.setMinZoom=function(x){if((x=x==null?-2:x)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},g.prototype.getMinZoom=function(){return this.transform.minZoom},g.prototype.setMaxZoom=function(x){if((x=x==null?22:x)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")},g.prototype.getMaxZoom=function(){return this.transform.maxZoom},g.prototype.setMinPitch=function(x){if((x=x==null?0:x)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},g.prototype.getMinPitch=function(){return this.transform.minPitch},g.prototype.setMaxPitch=function(x){if((x=x==null?60:x)>60)throw new Error("maxPitch must be less than or equal to 60");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")},g.prototype.getMaxPitch=function(){return this.transform.maxPitch},g.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},g.prototype.setRenderWorldCopies=function(x){return this.transform.renderWorldCopies=x,this._update()},g.prototype.project=function(x){return this.transform.locationPoint(o.LngLat.convert(x))},g.prototype.unproject=function(x){return this.transform.pointLocation(o.Point.convert(x))},g.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},g.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},g.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},g.prototype._createDelegatedListener=function(x,T,R){var F,U=this;if(x==="mouseenter"||x==="mouseover"){var X=!1;return{layer:T,listener:R,delegates:{mousemove:function(he){var me=U.getLayer(T)?U.queryRenderedFeatures(he.point,{layers:[T]}):[];me.length?X||(X=!0,R.call(U,new lo(x,U,he.originalEvent,{features:me}))):X=!1},mouseout:function(){X=!1}}}}if(x==="mouseleave"||x==="mouseout"){var re=!1;return{layer:T,listener:R,delegates:{mousemove:function(he){(U.getLayer(T)?U.queryRenderedFeatures(he.point,{layers:[T]}):[]).length?re=!0:re&&(re=!1,R.call(U,new lo(x,U,he.originalEvent)))},mouseout:function(he){re&&(re=!1,R.call(U,new lo(x,U,he.originalEvent)))}}}}return{layer:T,listener:R,delegates:(F={},F[x]=function(he){var me=U.getLayer(T)?U.queryRenderedFeatures(he.point,{layers:[T]}):[];me.length&&(he.features=me,R.call(U,he),delete he.features)},F)}},g.prototype.on=function(x,T,R){if(R===void 0)return d.prototype.on.call(this,x,T);var F=this._createDelegatedListener(x,T,R);for(var U in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(F),F.delegates)this.on(U,F.delegates[U]);return this},g.prototype.once=function(x,T,R){if(R===void 0)return d.prototype.once.call(this,x,T);var F=this._createDelegatedListener(x,T,R);for(var U in F.delegates)this.once(U,F.delegates[U]);return this},g.prototype.off=function(x,T,R){var F=this;return R===void 0?d.prototype.off.call(this,x,T):(this._delegatedListeners&&this._delegatedListeners[x]&&function(U){for(var X=U[x],re=0;re<X.length;re++){var he=X[re];if(he.layer===T&&he.listener===R){for(var me in he.delegates)F.off(me,he.delegates[me]);return X.splice(re,1),F}}}(this._delegatedListeners),this)},g.prototype.queryRenderedFeatures=function(x,T){if(!this.style)return[];var R;if(T!==void 0||x===void 0||x instanceof o.Point||Array.isArray(x)||(T=x,x=void 0),T=T||{},(x=x||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof x[0]=="number")R=[o.Point.convert(x)];else{var F=o.Point.convert(x[0]),U=o.Point.convert(x[1]);R=[F,new o.Point(U.x,F.y),U,new o.Point(F.x,U.y),F]}return this.style.queryRenderedFeatures(R,T,this.transform)},g.prototype.querySourceFeatures=function(x,T){return this.style.querySourceFeatures(x,T)},g.prototype.setStyle=function(x,T){return(T=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},T)).diff!==!1&&T.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,T),this):(this._localIdeographFontFamily=T.localIdeographFontFamily,this._updateStyle(x,T))},g.prototype._getUIString=function(x){var T=this._locale[x];if(T==null)throw new Error("Missing UI string '"+x+"'");return T},g.prototype._updateStyle=function(x,T){return this.style&&(this.style.setEventedParent(null),this.style._remove()),x?(this.style=new Ji(this,T||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x):this.style.loadJSON(x),this):(delete this.style,this)},g.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},g.prototype._diffStyle=function(x,T){var R=this;if(typeof x=="string"){var F=this._requestManager.normalizeStyleURL(x),U=this._requestManager.transformRequest(F,o.ResourceType.Style);o.getJSON(U,function(X,re){X?R.fire(new o.ErrorEvent(X)):re&&R._updateDiff(re,T)})}else typeof x=="object"&&this._updateDiff(x,T)},g.prototype._updateDiff=function(x,T){try{this.style.setState(x)&&this._update(!0)}catch(R){o.warnOnce("Unable to perform style diff: "+(R.message||R.error||R)+".  Rebuilding the style from scratch."),this._updateStyle(x,T)}},g.prototype.getStyle=function(){if(this.style)return this.style.serialize()},g.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},g.prototype.addSource=function(x,T){return this._lazyInitEmptyStyle(),this.style.addSource(x,T),this._update(!0)},g.prototype.isSourceLoaded=function(x){var T=this.style&&this.style.sourceCaches[x];if(T!==void 0)return T.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+x+"'")))},g.prototype.areTilesLoaded=function(){var x=this.style&&this.style.sourceCaches;for(var T in x){var R=x[T]._tiles;for(var F in R){var U=R[F];if(U.state!=="loaded"&&U.state!=="errored")return!1}}return!0},g.prototype.addSourceType=function(x,T,R){return this._lazyInitEmptyStyle(),this.style.addSourceType(x,T,R)},g.prototype.removeSource=function(x){return this.style.removeSource(x),this._update(!0)},g.prototype.getSource=function(x){return this.style.getSource(x)},g.prototype.addImage=function(x,T,R){R===void 0&&(R={});var F=R.pixelRatio;F===void 0&&(F=1);var U=R.sdf;U===void 0&&(U=!1);var X=R.stretchX,re=R.stretchY,he=R.content;if(this._lazyInitEmptyStyle(),T instanceof zp||ma&&T instanceof ma){var me=o.browser.getImageData(T);this.style.addImage(x,{data:new o.RGBAImage({width:me.width,height:me.height},me.data),pixelRatio:F,stretchX:X,stretchY:re,content:he,sdf:U,version:0})}else{if(T.width===void 0||T.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=T;this.style.addImage(x,{data:new o.RGBAImage({width:T.width,height:T.height},new Uint8Array(T.data)),pixelRatio:F,stretchX:X,stretchY:re,content:he,sdf:U,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,x)}},g.prototype.updateImage=function(x,T){var R=this.style.getImage(x);if(!R)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var F=T instanceof zp||ma&&T instanceof ma?o.browser.getImageData(T):T,U=F.width,X=F.height,re=F.data;return U===void 0||X===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):U!==R.data.width||X!==R.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(R.data.replace(re,!(T instanceof zp||ma&&T instanceof ma)),void this.style.updateImage(x,R))},g.prototype.hasImage=function(x){return x?!!this.style.getImage(x):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},g.prototype.removeImage=function(x){this.style.removeImage(x)},g.prototype.loadImage=function(x,T){o.getImage(this._requestManager.transformRequest(x,o.ResourceType.Image),T)},g.prototype.listImages=function(){return this.style.listImages()},g.prototype.addLayer=function(x,T){return this._lazyInitEmptyStyle(),this.style.addLayer(x,T),this._update(!0)},g.prototype.moveLayer=function(x,T){return this.style.moveLayer(x,T),this._update(!0)},g.prototype.removeLayer=function(x){return this.style.removeLayer(x),this._update(!0)},g.prototype.getLayer=function(x){return this.style.getLayer(x)},g.prototype.setLayerZoomRange=function(x,T,R){return this.style.setLayerZoomRange(x,T,R),this._update(!0)},g.prototype.setFilter=function(x,T,R){return R===void 0&&(R={}),this.style.setFilter(x,T,R),this._update(!0)},g.prototype.getFilter=function(x){return this.style.getFilter(x)},g.prototype.setPaintProperty=function(x,T,R,F){return F===void 0&&(F={}),this.style.setPaintProperty(x,T,R,F),this._update(!0)},g.prototype.getPaintProperty=function(x,T){return this.style.getPaintProperty(x,T)},g.prototype.setLayoutProperty=function(x,T,R,F){return F===void 0&&(F={}),this.style.setLayoutProperty(x,T,R,F),this._update(!0)},g.prototype.getLayoutProperty=function(x,T){return this.style.getLayoutProperty(x,T)},g.prototype.setLight=function(x,T){return T===void 0&&(T={}),this._lazyInitEmptyStyle(),this.style.setLight(x,T),this._update(!0)},g.prototype.getLight=function(){return this.style.getLight()},g.prototype.setFeatureState=function(x,T){return this.style.setFeatureState(x,T),this._update()},g.prototype.removeFeatureState=function(x,T){return this.style.removeFeatureState(x,T),this._update()},g.prototype.getFeatureState=function(x){return this.style.getFeatureState(x)},g.prototype.getContainer=function(){return this._container},g.prototype.getCanvasContainer=function(){return this._canvasContainer},g.prototype.getCanvas=function(){return this._canvas},g.prototype._containerDimensions=function(){var x=0,T=0;return this._container&&(x=this._container.clientWidth||400,T=this._container.clientHeight||300),[x,T]},g.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},g.prototype._setupContainer=function(){var x=this._container;x.classList.add("mapboxgl-map"),(this._missingCSSCanary=c.create("div","mapboxgl-canary",x)).style.visibility="hidden",this._detectMissingCSS();var T=this._canvasContainer=c.create("div","mapboxgl-canvas-container",x);this._interactive&&T.classList.add("mapboxgl-interactive"),this._canvas=c.create("canvas","mapboxgl-canvas",T),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var R=this._containerDimensions();this._resizeCanvas(R[0],R[1]);var F=this._controlContainer=c.create("div","mapboxgl-control-container",x),U=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(X){U[X]=c.create("div","mapboxgl-ctrl-"+X,F)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},g.prototype._resizeCanvas=function(x,T){var R=o.browser.devicePixelRatio||1;this._canvas.width=R*x,this._canvas.height=R*T,this._canvas.style.width=x+"px",this._canvas.style.height=T+"px"},g.prototype._setupPainter=function(){var x=o.extend({},l.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),T=this._canvas.getContext("webgl",x)||this._canvas.getContext("experimental-webgl",x);T?(this.painter=new on(T,this.transform),o.webpSupported.testSupport(T)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},g.prototype._contextLost=function(x){x.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:x}))},g.prototype._contextRestored=function(x){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:x}))},g.prototype._onMapScroll=function(x){if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},g.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},g.prototype._update=function(x){return this.style?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this},g.prototype._requestRenderFrame=function(x){return this._update(),this._renderTaskQueue.add(x)},g.prototype._cancelRenderFrame=function(x){this._renderTaskQueue.remove(x)},g.prototype._render=function(x){var T,R=this,F=0,U=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(T=U.createQueryEXT(),U.beginQueryEXT(U.TIME_ELAPSED_EXT,T),F=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),!this._removed){var X=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var re=this.transform.zoom,he=o.browser.now();this.style.zoomHistory.update(re,he);var me=new o.EvaluationParameters(re,{now:he,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=me.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(X=!0,this._crossFadingFactor=xe),this.style.update(me)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||X)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ne=o.browser.now()-F;U.endQueryEXT(U.TIME_ELAPSED_EXT,T),setTimeout(function(){var Re=U.getQueryObjectEXT(T,U.QUERY_RESULT_EXT)/1e6;U.deleteQueryEXT(T),R.fire(new o.Event("gpu-timing-frame",{cpuTime:Ne,gpuTime:Re}))},50)}if(this.listens("gpu-timing-layer")){var Fe=this.painter.collectGpuTimers();setTimeout(function(){var Re=R.painter.queryGpuTimers(Fe);R.fire(new o.Event("gpu-timing-layer",{layerTimes:Re}))},50)}var qe=this._sourcesDirty||this._styleDirty||this._placementDirty;return qe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||qe||(this._fullyLoaded=!0),this}},g.prototype.remove=function(){this._hash&&this._hash.remove();for(var x=0,T=this._controls;x<T.length;x+=1)T[x].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var R=this.painter.context.gl.getExtension("WEBGL_lose_context");R&&R.loseContext(),Sl(this._canvasContainer),Sl(this._controlContainer),Sl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},g.prototype.triggerRepaint=function(){var x=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(T){x._frame=null,x._render(T)}))},g.prototype._onWindowOnline=function(){this._update()},g.prototype._onWindowResize=function(x){this._trackResize&&this.resize({originalEvent:x})._update()},v.showTileBoundaries.get=function(){return!!this._showTileBoundaries},v.showTileBoundaries.set=function(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())},v.showPadding.get=function(){return!!this._showPadding},v.showPadding.set=function(x){this._showPadding!==x&&(this._showPadding=x,this._update())},v.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},v.showCollisionBoxes.set=function(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())},v.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},v.showOverdrawInspector.set=function(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())},v.repaint.get=function(){return!!this._repaint},v.repaint.set=function(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())},v.vertices.get=function(){return!!this._vertices},v.vertices.set=function(x){this._vertices=x,this._update()},g.prototype._setCacheLimits=function(x,T){o.setCacheLimits(x,T)},v.version.get=function(){return o.version},Object.defineProperties(g.prototype,v),g}(mc);function Sl(d){d.parentNode&&d.parentNode.removeChild(d)}var ye={showCompass:!0,showZoom:!0,visualizePitch:!1},Ns=function(d){var g=this;this.options=o.extend({},ye,d),this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(v){return v.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(v){return g._map.zoomIn({},{originalEvent:v})}),c.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(v){return g._map.zoomOut({},{originalEvent:v})}),c.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(v){g.options.visualizePitch?g._map.resetNorthPitch({},{originalEvent:v}):g._map.resetNorth({},{originalEvent:v})}),this._compassIcon=c.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ns.prototype._updateZoomButtons=function(){var d=this._map.getZoom(),g=d===this._map.getMaxZoom(),v=d===this._map.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())},Ns.prototype._rotateCompassArrow=function(){var d=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=d},Ns.prototype.onAdd=function(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vs(this._map,this._compass,this.options.visualizePitch)),this._container},Ns.prototype.onRemove=function(){c.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ns.prototype._createButton=function(d,g){var v=c.create("button",d,this._container);return v.type="button",v.addEventListener("click",g),v},Ns.prototype._setButtonTitle=function(d,g){var v=this._map._getUIString("NavigationControl."+g);d.title=v,d.setAttribute("aria-label",v)};var vs=function(d,g,v){v===void 0&&(v=!1),this._clickTolerance=10,this.element=g,this.mouseRotate=new Jo({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,v&&(this.mousePitch=new Hc({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener(g,"mousedown",this.mousedown),c.addEventListener(g,"touchstart",this.touchstart,{passive:!1}),c.addEventListener(g,"touchmove",this.touchmove),c.addEventListener(g,"touchend",this.touchend),c.addEventListener(g,"touchcancel",this.reset)};function Es(d,g,v){if(d=new o.LngLat(d.lng,d.lat),g){var x=new o.LngLat(d.lng-360,d.lat),T=new o.LngLat(d.lng+360,d.lat),R=v.locationPoint(d).distSqr(g);v.locationPoint(x).distSqr(g)<R?d=x:v.locationPoint(T).distSqr(g)<R&&(d=T)}for(;Math.abs(d.lng-v.center.lng)>180;){var F=v.locationPoint(d);if(F.x>=0&&F.y>=0&&F.x<=v.width&&F.y<=v.height)break;d.lng>v.center.lng?d.lng-=360:d.lng+=360}return d}vs.prototype.down=function(d,g){this.mouseRotate.mousedown(d,g),this.mousePitch&&this.mousePitch.mousedown(d,g),c.disableDrag()},vs.prototype.move=function(d,g){var v=this.map,x=this.mouseRotate.mousemoveWindow(d,g);if(x&&x.bearingDelta&&v.setBearing(v.getBearing()+x.bearingDelta),this.mousePitch){var T=this.mousePitch.mousemoveWindow(d,g);T&&T.pitchDelta&&v.setPitch(v.getPitch()+T.pitchDelta)}},vs.prototype.off=function(){var d=this.element;c.removeEventListener(d,"mousedown",this.mousedown),c.removeEventListener(d,"touchstart",this.touchstart,{passive:!1}),c.removeEventListener(d,"touchmove",this.touchmove),c.removeEventListener(d,"touchend",this.touchend),c.removeEventListener(d,"touchcancel",this.reset),this.offTemp()},vs.prototype.offTemp=function(){c.enableDrag(),c.removeEventListener(o.window,"mousemove",this.mousemove),c.removeEventListener(o.window,"mouseup",this.mouseup)},vs.prototype.mousedown=function(d){this.down(o.extend({},d,{ctrlKey:!0,preventDefault:function(){return d.preventDefault()}}),c.mousePos(this.element,d)),c.addEventListener(o.window,"mousemove",this.mousemove),c.addEventListener(o.window,"mouseup",this.mouseup)},vs.prototype.mousemove=function(d){this.move(d,c.mousePos(this.element,d))},vs.prototype.mouseup=function(d){this.mouseRotate.mouseupWindow(d),this.mousePitch&&this.mousePitch.mouseupWindow(d),this.offTemp()},vs.prototype.touchstart=function(d){d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=c.touchPos(this.element,d.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return d.preventDefault()}},this._startPos))},vs.prototype.touchmove=function(d){d.targetTouches.length!==1?this.reset():(this._lastPos=c.touchPos(this.element,d.targetTouches)[0],this.move({preventDefault:function(){return d.preventDefault()}},this._lastPos))},vs.prototype.touchend=function(d){d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},vs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Ii={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jf(d,g,v){var x=d.classList;for(var T in Ii)x.remove("mapboxgl-"+v+"-anchor-"+T);x.add("mapboxgl-"+v+"-anchor-"+g)}var wu,Rh=function(d){function g(v,x){if(d.call(this),(v instanceof o.window.HTMLElement||x)&&(v=o.extend({element:v},x)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=v&&v.anchor||"center",this._color=v&&v.color||"#3FB1CE",this._scale=v&&v.scale||1,this._draggable=v&&v.draggable||!1,this._clickTolerance=v&&v.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=v&&v.rotation||0,this._rotationAlignment=v&&v.rotationAlignment||"auto",this._pitchAlignment=v&&v.pitchAlignment&&v.pitchAlignment!=="auto"?v.pitchAlignment:this._rotationAlignment,v&&v.element)this._element=v.element,this._offset=o.Point.convert(v&&v.offset||[0,0]);else{this._defaultMarker=!0,this._element=c.create("div"),this._element.setAttribute("aria-label","Map marker");var T=c.createNS("http://www.w3.org/2000/svg","svg");T.setAttributeNS(null,"display","block"),T.setAttributeNS(null,"height","41px"),T.setAttributeNS(null,"width","27px"),T.setAttributeNS(null,"viewBox","0 0 27 41");var R=c.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"stroke","none"),R.setAttributeNS(null,"stroke-width","1"),R.setAttributeNS(null,"fill","none"),R.setAttributeNS(null,"fill-rule","evenodd");var F=c.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill-rule","nonzero");var U=c.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(3.0, 29.0)"),U.setAttributeNS(null,"fill","#000000");for(var X=0,re=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];X<re.length;X+=1){var he=re[X],me=c.createNS("http://www.w3.org/2000/svg","ellipse");me.setAttributeNS(null,"opacity","0.04"),me.setAttributeNS(null,"cx","10.5"),me.setAttributeNS(null,"cy","5.80029008"),me.setAttributeNS(null,"rx",he.rx),me.setAttributeNS(null,"ry",he.ry),U.appendChild(me)}var xe=c.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var Ne=c.createNS("http://www.w3.org/2000/svg","path");Ne.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(Ne);var Fe=c.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"fill","#000000");var qe=c.createNS("http://www.w3.org/2000/svg","path");qe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Fe.appendChild(qe);var Re=c.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Re.setAttributeNS(null,"fill","#FFFFFF");var Ze=c.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var at=c.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");var ht=c.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#FFFFFF"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962"),Ze.appendChild(at),Ze.appendChild(ht),F.appendChild(U),F.appendChild(xe),F.appendChild(Fe),F.appendChild(Re),F.appendChild(Ze),T.appendChild(F),T.setAttributeNS(null,"height",41*this._scale+"px"),T.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(T),this._offset=o.Point.convert(v&&v.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ot){Ot.preventDefault()}),this._element.addEventListener("mousedown",function(Ot){Ot.preventDefault()}),Jf(this._element,this._anchor,"marker"),this._popup=null}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.addTo=function(v){return this.remove(),this._map=v,v.getCanvasContainer().appendChild(this._element),v.on("move",this._update),v.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},g.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),c.remove(this._element),this._popup&&this._popup.remove(),this},g.prototype.getLngLat=function(){return this._lngLat},g.prototype.setLngLat=function(v){return this._lngLat=o.LngLat.convert(v),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},g.prototype.getElement=function(){return this._element},g.prototype.setPopup=function(v){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),v){if(!("offset"in v.options)){var x=Math.sqrt(Math.pow(13.5,2)/2);v.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=v,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},g.prototype._onKeyPress=function(v){var x=v.code,T=v.charCode||v.keyCode;x!=="Space"&&x!=="Enter"&&T!==32&&T!==13||this.togglePopup()},g.prototype._onMapClick=function(v){var x=v.originalEvent.target,T=this._element;this._popup&&(x===T||T.contains(x))&&this.togglePopup()},g.prototype.getPopup=function(){return this._popup},g.prototype.togglePopup=function(){var v=this._popup;return v?(v.isOpen()?v.remove():v.addTo(this._map),this):this},g.prototype._update=function(v){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Es(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(x="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T="rotateX("+this._map.getPitch()+"deg)"),v&&v.type!=="moveend"||(this._pos=this._pos.round()),c.setTransform(this._element,Ii[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+T+" "+x)}},g.prototype.getOffset=function(){return this._offset},g.prototype.setOffset=function(v){return this._offset=o.Point.convert(v),this._update(),this},g.prototype._onMove=function(v){if(!this._isDragging){var x=this._clickTolerance||this._map._clickTolerance;this._isDragging=v.point.dist(this._pointerdownPos)>=x}this._isDragging&&(this._pos=v.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},g.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},g.prototype._addDragHandler=function(v){this._element.contains(v.originalEvent.target)&&(v.preventDefault(),this._positionDelta=v.point.sub(this._pos).add(this._offset),this._pointerdownPos=v.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},g.prototype.setDraggable=function(v){return this._draggable=!!v,this._map&&(v?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},g.prototype.isDraggable=function(){return this._draggable},g.prototype.setRotation=function(v){return this._rotation=v||0,this._update(),this},g.prototype.getRotation=function(){return this._rotation},g.prototype.setRotationAlignment=function(v){return this._rotationAlignment=v||"auto",this._update(),this},g.prototype.getRotationAlignment=function(){return this._rotationAlignment},g.prototype.setPitchAlignment=function(v){return this._pitchAlignment=v&&v!=="auto"?v:this._rotationAlignment,this._update(),this},g.prototype.getPitchAlignment=function(){return this._pitchAlignment},g}(o.Evented),wl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},eh=0,th=!1,gd=function(d){function g(v){d.call(this),this.options=o.extend({},wl,v),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.onAdd=function(v){var x;return this._map=v,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),x=this._setupUI,wu!==void 0?x(wu):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(T){x(wu=T.state!=="denied")}):x(wu=!!o.window.navigator.geolocation),this._container},g.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),c.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,eh=0,th=!1},g.prototype._isOutOfMapMaxBounds=function(v){var x=this._map.getMaxBounds(),T=v.coords;return x&&(T.longitude<x.getWest()||T.longitude>x.getEast()||T.latitude<x.getSouth()||T.latitude>x.getNorth())},g.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},g.prototype._onSuccess=function(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",v)),this._finish()}},g.prototype._updateCamera=function(v){var x=new o.LngLat(v.coords.longitude,v.coords.latitude),T=v.coords.accuracy,R=this._map.getBearing(),F=o.extend({bearing:R},this.options.fitBoundsOptions);this._map.fitBounds(x.toBounds(T),F,{geolocateSource:!0})},g.prototype._updateMarker=function(v){if(v){var x=new o.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},g.prototype._updateCircleRadius=function(){var v=this._map._container.clientHeight/2,x=this._map.unproject([0,v]),T=this._map.unproject([1,v]),R=x.distanceTo(T),F=Math.ceil(2*this._accuracy/R);this._circleElement.style.width=F+"px",this._circleElement.style.height=F+"px"},g.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},g.prototype._onError=function(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&th)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",v)),this._finish()}},g.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},g.prototype._setupUI=function(v){var x=this;if(this._container.addEventListener("contextmenu",function(F){return F.preventDefault()}),this._geolocateButton=c.create("button","mapboxgl-ctrl-geolocate",this._container),c.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",v===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var T=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}else{var R=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=R,this._geolocateButton.setAttribute("aria-label",R)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=c.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Rh(this._dotElement),this._circleElement=c.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Rh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(F){F.geolocateSource||x._watchState!=="ACTIVE_LOCK"||F.originalEvent&&F.originalEvent.type==="resize"||(x._watchState="BACKGROUND",x._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),x._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),x.fire(new o.Event("trackuserlocationend")))})},g.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":eh--,th=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++eh>1?(v={maximumAge:6e5,timeout:0},th=!0):(v=this.options.positionOptions,th=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},g.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},g}(o.Evented),wf={maxWidth:100,unit:"metric"},Af=function(d){this.options=o.extend({},wf,d),o.bindAll(["_onMove","setUnit"],this)};function tl(d,g,v){var x=v&&v.maxWidth||100,T=d._container.clientHeight/2,R=d.unproject([0,T]),F=d.unproject([x,T]),U=R.distanceTo(F);if(v&&v.unit==="imperial"){var X=3.2808*U;X>5280?gc(g,x,X/5280,d._getUIString("ScaleControl.Miles")):gc(g,x,X,d._getUIString("ScaleControl.Feet"))}else v&&v.unit==="nautical"?gc(g,x,U/1852,d._getUIString("ScaleControl.NauticalMiles")):U>=1e3?gc(g,x,U/1e3,d._getUIString("ScaleControl.Kilometers")):gc(g,x,U,d._getUIString("ScaleControl.Meters"))}function gc(d,g,v,x){var T,R,F,U=(T=v,(R=Math.pow(10,(""+Math.floor(T)).length-1))*(F=(F=T/R)>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(X){var re=Math.pow(10,Math.ceil(-Math.log(X)/Math.LN10));return Math.round(X*re)/re}(F)));d.style.width=g*(U/v)+"px",d.innerHTML=U+"&nbsp;"+x}Af.prototype.getDefaultPosition=function(){return"bottom-left"},Af.prototype._onMove=function(){tl(this._map,this._container,this.options)},Af.prototype.onAdd=function(d){return this._map=d,this._container=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Af.prototype.onRemove=function(){c.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Af.prototype.setUnit=function(d){this.options.unit=d,tl(this._map,this._container,this.options)};var Al=function(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof o.window.HTMLElement?this._container=d.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};Al.prototype.onAdd=function(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=c.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Al.prototype.onRemove=function(){c.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Al.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},Al.prototype._setupUI=function(){var d=this._fullscreenButton=c.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);c.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Al.prototype._updateTitle=function(){var d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d},Al.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Al.prototype._isFullscreen=function(){return this._fullscreen},Al.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Al.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Oh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),rh=function(d){function g(v){d.call(this),this.options=o.extend(Object.create(Oh),v),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return d&&(g.__proto__=d),(g.prototype=Object.create(d&&d.prototype)).constructor=g,g.prototype.addTo=function(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},g.prototype.isOpen=function(){return!!this._map},g.prototype.remove=function(){return this._content&&c.remove(this._content),this._container&&(c.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},g.prototype.getLngLat=function(){return this._lngLat},g.prototype.setLngLat=function(v){return this._lngLat=o.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},g.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},g.prototype.getElement=function(){return this._container},g.prototype.setText=function(v){return this.setDOMContent(o.window.document.createTextNode(v))},g.prototype.setHTML=function(v){var x,T=o.window.document.createDocumentFragment(),R=o.window.document.createElement("body");for(R.innerHTML=v;x=R.firstChild;)T.appendChild(x);return this.setDOMContent(T)},g.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},g.prototype.setMaxWidth=function(v){return this.options.maxWidth=v,this._update(),this},g.prototype.setDOMContent=function(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=c.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this},g.prototype.addClassName=function(v){this._container&&this._container.classList.add(v)},g.prototype.removeClassName=function(v){this._container&&this._container.classList.remove(v)},g.prototype.setOffset=function(v){return this.options.offset=v,this._update(),this},g.prototype.toggleClassName=function(v){if(this._container)return this._container.classList.toggle(v)},g.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=c.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},g.prototype._onMouseUp=function(v){this._update(v.point)},g.prototype._onMouseMove=function(v){this._update(v.point)},g.prototype._onDrag=function(v){this._update(v.point)},g.prototype._update=function(v){var x=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=c.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=c.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(me){return x._container.classList.add(me)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Es(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||v)){var T=this._pos=this._trackPointer&&v?v:this._map.project(this._lngLat),R=this.options.anchor,F=function me(xe){if(xe){if(typeof xe=="number"){var Ne=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new o.Point(0,0),top:new o.Point(0,xe),"top-left":new o.Point(Ne,Ne),"top-right":new o.Point(-Ne,Ne),bottom:new o.Point(0,-xe),"bottom-left":new o.Point(Ne,-Ne),"bottom-right":new o.Point(-Ne,-Ne),left:new o.Point(xe,0),right:new o.Point(-xe,0)}}if(xe instanceof o.Point||Array.isArray(xe)){var Fe=o.Point.convert(xe);return{center:Fe,top:Fe,"top-left":Fe,"top-right":Fe,bottom:Fe,"bottom-left":Fe,"bottom-right":Fe,left:Fe,right:Fe}}return{center:o.Point.convert(xe.center||[0,0]),top:o.Point.convert(xe.top||[0,0]),"top-left":o.Point.convert(xe["top-left"]||[0,0]),"top-right":o.Point.convert(xe["top-right"]||[0,0]),bottom:o.Point.convert(xe.bottom||[0,0]),"bottom-left":o.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(xe["bottom-right"]||[0,0]),left:o.Point.convert(xe.left||[0,0]),right:o.Point.convert(xe.right||[0,0])}}return me(new o.Point(0,0))}(this.options.offset);if(!R){var U,X=this._container.offsetWidth,re=this._container.offsetHeight;U=T.y+F.bottom.y<re?["top"]:T.y>this._map.transform.height-re?["bottom"]:[],T.x<X/2?U.push("left"):T.x>this._map.transform.width-X/2&&U.push("right"),R=U.length===0?"bottom":U.join("-")}var he=T.add(F[R]).round();c.setTransform(this._container,Ii[R]+" translate("+he.x+"px,"+he.y+"px)"),Jf(this._container,R,"popup")}},g.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var v=this._container.querySelector(Xc);v&&v.focus()}},g.prototype._onClose=function(){this.remove()},g}(o.Evented),rl={version:o.version,supported:l,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:lu,NavigationControl:Ns,GeolocateControl:gd,AttributionControl:ds,ScaleControl:Af,FullscreenControl:Al,Popup:rh,Marker:Rh,Style:Ji,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){Bt().acquire(Dt)},clearPrewarmedResources:function(){var d=Nr;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Dt),Nr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(d){o.config.ACCESS_TOKEN=d},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(d){o.config.API_URL=d},get workerCount(){return pr.workerCount},set workerCount(d){pr.workerCount=d},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage:function(d){o.clearTileCache(d)},workerUrl:""};return rl}),i})})(uP);const K_=uP.exports;var v$=function(){function e(){Kt(this,e)}return Qt(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,o=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new sP({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),lI={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},m$=["id","attributionControl","style","token","rotation","mapInstance"],cI,fI,hI,pI,dI,vI,_y,mI,gI,yI,_I;function g$(e,r){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}g$(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=K_;var xI={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},y$=0,_$=12,bI="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",x$=(cI=oa(),fI=na(Gt.MapConfig),hI=na(Gt.IGlobalConfigService),pI=na(Gt.ICoordinateSystemService),dI=na(Gt.IEventEmitter),cI(vI=(_y=function(){function e(){var r=this;Kt(this,e),ne(this,"version",vu.MAPBOX),ne(this,"simpleMapCoord",new nP),ne(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),$i(this,"config",mI,this),$i(this,"configService",gI,this),$i(this,"coordinateSystemService",yI,this),$i(this,"eventEmitter",_I,this),ne(this,"handleCameraChanged",function(){var t=r.map.getCenter().wrap(),n=t.lat,i=t.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0});var a=r.config.offsetZoom,o=a===void 0?_$:a;r.viewport.getZoom()>o?r.coordinateSystemService.setCoordinateSystem(Uv.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(Uv.LNGLAT),r.cameraChangedCallback(r.viewport)})}return Qt(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Ul("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){eS.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(xI[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(xI[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},i=this.lngLatToMercator(t,0),a=i.x,o=i.y;return[a-n.x,o-n.y]}},{key:"lngLatToMercator",value:function(t,n){var i=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),a=i.x,o=a===void 0?0:a,l=i.y,c=l===void 0?0:l,p=i.z,y=p===void 0?0:p;return{x:o,y:c,z:y}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),c=l.meterInMercatorCoordinateUnits(),p=kp();return Pg(p,p,Lc(l.x-o.x,l.y-o.y,l.z||0-o.z)),$y(p,p,Lc(c*a[0],-c*a[1],c*a[2])),Y1(p,p,i[0]),t2(p,p,i[1]),r2(p,p,i[2]),p}},{key:"init",value:function(){var r=eo(Xn.mark(function n(){var i,a,o,l,c,p,y,b,w,M,O,N,z;return Xn.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:i=this.config,a=i.id,o=a===void 0?"map":a,l=i.attributionControl,c=l===void 0?!1:l,p=i.style,y=p===void 0?"light":p,b=i.token,w=b===void 0?bI:b,M=i.rotation,O=M===void 0?0:M,N=i.mapInstance,z=b0(i,m$),this.viewport=new v$,!N&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),w===bI&&y!=="blank"&&!window.mapboxgl.accessToken&&!N&&console.warn(this.configService.getSceneWarninfo("MapToken")),!N&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=w),N?(this.map=N,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(o),this.map=new window.mapboxgl.Map(tr({container:this.$mapContainer,style:this.getMapStyle(y),attributionControl:c,bearing:O},z))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Y.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var i=new K_.LngLat(t[0],t[1]),a=new K_.LngLat(n[0],n[1]),o=i.distanceTo(a),l=K_.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),c=K_.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),p=l.x,y=l.y,b=c.x,w=c.y,M=Math.sqrt(Math.pow(p-b,2)+Math.pow(y-w,2))*4194304*2;return M/o}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+y$++,n.appendChild(i),i}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:lI[t]?lI[t]:t}}]),e}(),mI=ji(_y.prototype,"config",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gI=ji(_y.prototype,"configService",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yI=ji(_y.prototype,"coordinateSystemService",[pI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=ji(_y.prototype,"eventEmitter",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y))||vI);function b$(e){var r=E$();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function E$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C$(e,r){var t=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}C$(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var lP=function(e){On(t,e);var r=b$(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getServiceConstructor",value:function(){return x$}}]),t}(tP);function S$(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=GR(t),i=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return i}function w$(e,r){var t=this;e.length>0&&r.version===vu["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=vu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=vu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoords(n.coordinates)}))}function A$(e,r){e.length>0&&r.version===vu.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=T$(t.coordinates,r),t.simpleCoordinate=!0)})}function T$(e,r){if(typeof e[0]=="number")return r.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(i){var a=[];i.map(function(o){a.push(r.simpleMapCoord.unproject(o))}),t.push(a)}),t}else{var n=[];return e.map(function(i){n.push(r.simpleMapCoord.unproject(i))}),n}}function M$(e,r,t){var n;if(!e.scale)return[];var i=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],a=[];i.forEach(function(l){var c,p=l.field;(r.hasOwnProperty(p)||((c=e.scale)===null||c===void 0?void 0:c.type)==="variable")&&a.push(r[p])});var o=e.mapping?e.mapping(a):[];return e.name==="color"&&!WR(o[0])?[t]:o}function I$(e,r,t,n,i,a){var o=a==null?void 0:a.getLayerConfig(),l=o.arrow,c=l===void 0?{enable:!1}:l,p=r.map(function(y){var b={id:y._id,coordinates:y.coordinates};if(e.filter(function(O){return O.scale!==void 0}).forEach(function(O){var N=M$(O,y,i);O.needRemapping=!1,O.name==="color"&&(N=N.map(function(z){return Lo(z)})),b[O.name]=Array.isArray(N)&&N.length===1?N[0]:N,O.name==="shape"&&(b.shape=t.getIconFontKey(b[O.name]))}),b.shape==="line"&&c.enable){var w=b.coordinates,M=S$(w[0],w[1]);b.coordinates.splice(1,0,M,M)}return b});return w$(p,n),A$(p,n),p}function L$(e,r,t,n,i,a){var o=new Mm(i,a),l=e.getBottomColor(),c=n.getLayerStyleAttributes()||[],p=o.data.dataArray,y=p,b=I$(c,y,r,t,l,e);return o.destroy(),b}function cP(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function fP(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig();a.enablePicking;var o=a.enableTAA;return o?i.add(n("taa")):i.add(n("render")),cP(r).forEach(function(l){var c=Pi(l,2),p=c[0],y=c[1];i.add(t(p),y)}),i.add(t("copy")),i}var k$=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function R$(e,r,t){if(typeof r=="string"&&typeof t=="string"&&r!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}k$.map(function(n){if(n.includes(r)&&n.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var O$=["passes"],P$=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],EI,kE,CI;function F$(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=D$(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function D$(e,r){if(!!e){if(typeof e=="string")return SI(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return SI(e,r)}}function SI(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function B$(e){var r=N$();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function N$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wI=0,Gg=(EI=Pw(Gt.IGlobalConfigService),kE=function(e){On(t,e);var r=B$(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Kt(this,t),n=r.call(this),ne(vt(n),"id","".concat(wI++)),ne(vt(n),"name","".concat(wI)),ne(vt(n),"visible",!0),ne(vt(n),"zIndex",0),ne(vt(n),"inited",!1),ne(vt(n),"layerModelNeedUpdate",!1),ne(vt(n),"pickedFeatureID",null),ne(vt(n),"selectedFeatureID",null),ne(vt(n),"styleNeedUpdate",!1),ne(vt(n),"clusterZoom",0),ne(vt(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),ne(vt(n),"hooks",{init:new gE,afterInit:new gE,beforeRender:new gE,beforeRenderData:new lV,afterRender:new Lv,beforePickingEncode:new Lv,afterPickingEncode:new Lv,beforeHighlight:new Lv(["pickedColor"]),afterHighlight:new Lv,beforeSelect:new Lv(["pickedColor"]),afterSelect:new Lv,beforeDestroy:new Lv,afterDestroy:new Lv}),ne(vt(n),"models",[]),ne(vt(n),"layerChildren",[]),ne(vt(n),"masks",[]),ne(vt(n),"isVector",!1),$i(vt(n),"configService",CI,vt(n)),ne(vt(n),"animateOptions",{enable:!1}),ne(vt(n),"currentPickId",null),ne(vt(n),"pendingStyleAttributes",[]),ne(vt(n),"scaleOptions",{}),ne(vt(n),"aniamateStatus",!1),ne(vt(n),"bottomColor","rgba(0, 0, 0, 0)"),ne(vt(n),"isDestroied",!1),ne(vt(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions),n.reRender()}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return Qt(t,[{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.inited)this.needUpdateConfig=tr(tr({},this.needUpdateConfig),i);else{var o=this.container.get(Gt.SceneID);XW(i,this),this.configService.setLayerConfig(o,this.id,tr(tr(tr({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(i){this.bottomColor=i}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var i=this,a=this.container.get(Gt.SceneID);this.configService.setLayerConfig(a,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Gt.IIconService),this.fontService=this.container.get(Gt.IFontService),this.rendererService=this.container.get(Gt.IRendererService),this.layerService=this.container.get(Gt.ILayerService),this.interactionService=this.container.get(Gt.IInteractionService),this.pickingService=this.container.get(Gt.IPickingService),this.mapService=this.container.get(Gt.IMapService);var o=this.getLayerConfig(),l=o.enableMultiPassRenderer,c=o.passes;l&&c!==null&&c!==void 0&&c.length&&c.length>0&&this.mapService.on("mapAfterFrameChange",function(){i.renderLayers()}),this.cameraService=this.container.get(Gt.ICameraService),this.coordinateService=this.container.get(Gt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Gt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Gt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Gt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Gt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Gt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(w){var M=w.attributeName,O=w.attributeField,N=w.attributeValues,z=w.updateOptions;i.styleAttributeService.updateStyleAttribute(M,{scale:tr({field:O},i.splitValuesAndCallbackInAttribute(N,i.getLayerConfig()[M]))},z)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Gt.ILayerPlugin);var p=F$(this.plugins),y;try{for(p.s();!(y=p.n()).done;){var b=y.value;b.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(w){p.e(w)}finally{p.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"createModelData",value:function(i,a){var o;if((o=this.layerModel)!==null&&o!==void 0&&o.createModelData)return this.layerModel.createModelData(a);var l=this.calculateEncodeData(i,a),c=this.triangulation;return l&&c?this.styleAttributeService.createAttributesAndIndices(l,c):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(i,a){return this.inited?L$(this,this.fontService,this.mapService,this.styleAttributeService,i,a):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(tr(tr({},this.getDefaultConfig()),this.rawConfig));var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(i,a,o){return this.updateStyleAttribute("color",i,a,o),this}},{key:"texture",value:function(i,a,o){return this.updateStyleAttribute("texture",i,a,o),this}},{key:"rotate",value:function(i,a,o){return this.updateStyleAttribute("rotate",i,a,o),this}},{key:"size",value:function(i,a,o){return this.updateStyleAttribute("size",i,a,o),this}},{key:"filter",value:function(i,a,o){return this.updateStyleAttribute("filter",i,a,o),this}},{key:"shape",value:function(i,a,o){var l,c,p,y=(l=this.styleAttributeService)===null||l===void 0||(c=l.getLayerStyleAttribute("shape"))===null||c===void 0||(p=c.scale)===null||p===void 0?void 0:p.field,b=i;return this.shapeOption={field:i,values:a},this.updateStyleAttribute("shape",i,a,o),this.tileLayer||R$(this,y,b),this}},{key:"label",value:function(i,a,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:o}),this}},{key:"animate",value:function(i){var a={};return Vr.exports.isObject(i)?(a.enable=!0,a=tr(tr({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return i!=null&&i.data?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var o=this;return this.inited?this.layerSource.setData(i,a):this.on("inited",function(){var l=o.getSource();l?o.layerSource.setData(i,a):(o.source(new Mm(i,a)),o.sourceEvent())}),this}},{key:"style",value:function(i){var a=this,o=this.getLayerConfig(),l=i.passes,c=b0(i,O$);return l&&cP(l).forEach(function(p){var y=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);y&&y.updateOptions(p[1])}),this.rawConfig=tr(tr({},this.rawConfig),c),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),o&&o.mask===!0&&i.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(p){a.models=p})),this}},{key:"scale",value:function(i,a){return Vr.exports.isObject(i)?this.scaleOptions=tr(tr({},this.scaleOptions),i):this.scaleOptions[i]=a,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var n=eo(Xn.mark(function a(){return Xn.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){l.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=6;break}return l.next=4,this.multiPassRenderer.render();case 4:l.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Vr.exports.isObject(i)?!0:i,Vr.exports.isObject(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var o=this;if(Vr.exports.isObject(i)){var l=i.x,c=l===void 0?0:l,p=i.y,y=p===void 0?0:p;this.updateLayerConfig({highlightColor:Vr.exports.isObject(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Vr.exports.isObject(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Vr.exports.isObject(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Vr.exports.isObject(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(bm(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Vr.exports.isObject(i)?!0:i,Vr.exports.isObject(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var o=this;if(Vr.exports.isObject(i)){var l=i.x,c=l===void 0?0:l,p=i.y,y=p===void 0?0:p;this.updateLayerConfig({selectColor:Vr.exports.isObject(a)?a.color:this.getLayerConfig().selectColor,selectMix:Vr.exports.isObject(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Vr.exports.isObject(a)?a.color:this.getLayerConfig().selectColor,selectMix:Vr.exports.isObject(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(bm(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),o=a.visible,l=a.minZoom,c=l===void 0?-1/0:l,p=a.maxZoom,y=p===void 0?1/0:p;return!!o&&i>=c&&i<=y}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var o=this.getLayerConfig(),l=o.passes,c=l===void 0?[]:l;this.multiPassRenderer=fP(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var p=this.rendererService.getViewportSize(),y=p.width,b=p.height;this.multiPassRenderer.resize(y,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),o=a.extent,l=o.some(function(c){return Math.abs(c)===1/0});return l?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],i),this)}},{key:"destroy",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(o){return o.destroy()}),this.layerChildren=[],this.masks.map(function(o){return o.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[],this.layerService.cleanRemove(this,a),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){a.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var o=a.range().map(function(p){return ne({value:a.invertExtent(p)},i,p)});return o}else if(a.ticks){var l=a.ticks().map(function(p){return ne({value:p},i,a(p))});return l}else if(a!=null&&a.domain){var c=a.domain().filter(function(p){return!Vr.exports.isUndefined(p)}).map(function(p){return ne({value:p},i,a(p))});return c}return[]}},{key:"pick",value:function(i){var a=i.x,o=i.y;this.interactionService.triggerHover({x:a,y:o})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(i){var a=this,o=i.moduleName,l=i.vertexShader,c=i.fragmentShader,p=i.triangulation,y=i.segmentNumber,b=i.workerEnabled,w=b===void 0?!1:b,M=i.workerOptions,O=b0(i,P$);this.shaderModuleService.registerModule(o,{vs:l,fs:c});var N=this.shaderModuleService.getModule(o),z=N.vs,j=N.fs,Y=N.uniforms,K=this.rendererService.createModel;return new Promise(function(ie,le){if(M&&M.modelType in xO&&w)a.styleAttributeService.createAttributesAndIndicesAscy(a.encodedData,y,M).then(function(je){var ve=je.attributes,Ie=je.elements,dt=K(tr({attributes:ve,uniforms:Y,fs:j,vs:z,elements:Ie,blend:tS[Ip.normal]},O));ie(dt)}).catch(function(je){return le(je)});else{var Se=a.styleAttributeService.createAttributesAndIndices(a.encodedData,p,y),ze=Se.attributes,ue=Se.elements,Ke=Se.count,ke=tr({attributes:ze,uniforms:Y,fs:j,vs:z,elements:ue,blend:tS[Ip.normal]},O);Ke&&(ke.count=Ke);var Ce=K(ke);ie(Ce)}})}},{key:"createAttrubutes",value:function(i){var a=i.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,a),l=o.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),o=a.enableHighlight,l=o===void 0?!0:o,c=a.enableSelect,p=c===void 0?!0:c,y=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&p&&(y=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(y=!0),this.isVisible()&&y}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=eo(Xn.mark(function a(o){return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.render();case 2:case"end":return c.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(i){var a=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var o;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(l){a.models=l,a.hooks.beforeRender.call(),a.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(o=this.layerModel)!==null&&o!==void 0&&o.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(l){l.draw({uniforms:a.layerModel.getUninforms()},i)})}return this}},{key:"updateStyleAttribute",value:function(i,a,o,l){this.inited?this.styleAttributeService.updateStyleAttribute(i,{scale:tr({field:a},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:o,updateOptions:l})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(i,a){return{values:Vr.exports.isFunction(i)?void 0:i||a,callback:Vr.exports.isFunction(i)?i:void 0}}}]),t}(Zd.exports.EventEmitter),CI=ji(kE.prototype,"configService",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE),AI,RE,TI;function z$(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=U$(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function U$(e,r){if(!!e){if(typeof e=="string")return MI(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return MI(e,r)}}function MI(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var $o=(AI=Pw(Gt.IGlobalConfigService),RE=function(){function e(r){Kt(this,e),$i(this,"configService",TI,this),this.layer=r,this.rendererService=r.getContainer().get(Gt.IRendererService),this.pickingService=r.getContainer().get(Gt.IPickingService),this.shaderModuleService=r.getContainer().get(Gt.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Gt.IStyleAttributeService),this.mapService=r.getContainer().get(Gt.IMapService),this.iconService=r.getContainer().get(Gt.IIconService),this.fontService=r.getContainer().get(Gt.IFontService),this.cameraService=r.getContainer().get(Gt.ICameraService),this.layerService=r.getContainer().get(Gt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:Q.NEAREST,min:Q.NEAREST,width:1,height:1}))}return Qt(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return Vr.exports.isEqual(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),Vr.exports.isEqual(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),Vr.exports.isEqual(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),Vr.exports.isEqual(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),Vr.exports.isEqual(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),Vr.exports.isEqual(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!Vr.exports.isNumber(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!Vr.exports.isNumber(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!Vr.exports.isNumber(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!Vr.exports.isNumber(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return Vr.exports.isString(t)?!!xm(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=Lo(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&Vr.exports.isNumber(t[0])&&Vr.exports.isNumber(t[1]))}},{key:"patchMod",value:function(t,n){for(var i=0;i<n;i++)t.push(-1)}},{key:"patchData",value:function(t,n,i){var a=z$(i),o;try{for(a.s();!(o=a.n()).done;){var l=o.value,c=l.attr,p=l.count,y=n[c];y!==void 0?c==="stroke"?t.push.apply(t,zn(Lo(y))):c==="offsets"?this.isOffsetStatic(y)?t.push(-y[0],y[1]):t.push(0,0):t.push(Vr.exports.isNumber(y)?y:1):this.patchMod(t,p)}}catch(b){a.e(b)}finally{a.f()}}},{key:"calDataFrame",value:function(t,n,i){for(var a=n.length,o=Math.ceil(a*t/this.DATA_TEXTURE_WIDTH),l=o*this.DATA_TEXTURE_WIDTH,c=[],p=0;p<a;p++){var y=n[p];this.patchData(c,y,i)}for(var b=c.length;b<l;b++)c.push(-1);return{data:c,width:this.DATA_TEXTURE_WIDTH,height:o}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return tS[Ip[i]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),TI=ji(RE.prototype,"configService",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE),II;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(II||(II={}));var qy;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(qy||(qy={}));var rS;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(rS||(rS={}));var LI;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(LI||(LI={}));var Dw=100;function kI(e){return e/180*Math.acos(-1)}function hP(e){var r=kI(e[0])+Math.PI/2,t=kI(e[1]),n=Dw+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),o=n*Math.sin(t);return[a,o,i]}var Lx=Va();Va();var zl=Va(),tm=Va(),xy=Va();function OE(e,r,t,n,i){qu(e,t,n),Gv(e,e),r=Xy(-e[1],e[0]);var a=Xy(-t[1],t[0]);return[i/mm(r,a),r]}function rm(e,r){return yO(e,-r[1],r[0])}function by(e,r,t){return Zy(e,r,t),Gv(e,e),e}function PE(e,r){return e[0]===r[0]&&e[1]===r[1]}var V$=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Kt(this,e),ne(this,"lastFlip",-1),ne(this,"miter",Xy(0,0)),ne(this,"started",!1),ne(this,"dash",!1),ne(this,"totalDistance",0),ne(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Qt(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,y=this.simpleSegment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,y,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var w=n[l-1],M=t[l];M.push((p=n[l][2])!==null&&p!==void 0?p:0);var O=n[l],N=l<t.length-1?[].concat(zn(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,z=l<n.length-1?n[l+1]:null,j=this.simpleSegment(i,o,b,M,N,w,O,z);o+=j}if(this.dash)for(var Y=0;Y<i.positions.length/6;Y++)i.positions[Y*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,y,b=t[l-1];b.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var w=n[l-1],M=t[l];M.push((p=n[l][2])!==null&&p!==void 0?p:0);var O=n[l],N=l<t.length-1?[].concat(zn(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,z=l<n.length-1?n[l+1]:null,j=this.segment_gaode2(i,o,b,M,N,w,O,z);o+=j}if(this.dash)for(var Y=0;Y<i.positions.length/6;Y++)i.positions[Y*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,y=this.segment(n,a,l,c,p);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,y=t.normals,b=Ic([a[0],a[1]]),w=Ic([i[0],i[1]]);by(zl,b,w);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,w),this.totalDistance+=M),this.normal||(this.normal=Va(),rm(this.normal,zl)),this.started||(this.started=!0,this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-M)),c.push(n+0,n+1,n+2),!o)rm(this.normal,zl),this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var O=Ic([o[0],o[1]]);PE(b,O)&&qu(O,b,Gv(O,Mg(O,b,w))),by(tm,O,b);var N=OE(xy,Va(),zl,tm,this.thickness),z=Pi(N,2),j=z[0],Y=z[1],K=mm(xy,this.normal)<0?-1:1;this.extrusions(p,y,a,Y,j,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),K=-1,Fv(this.normal,Y),l+=2,this.lastFlip=K}return l}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,p){var y=0,b=t.indices,w=t.positions,M=t.normals,O=this.cap==="square",N=this.join==="bevel",z=Ic([c[0],c[1]]),j=Ic([l[0],l[1]]);by(zl,a,i);var Y=0;if(this.dash&&(Y=this.lineSegmentDistance(z,j),this.totalDistance+=Y),this.normal||(this.normal=Va(),rm(this.normal,zl)),!this.started)if(this.started=!0,O){var K=Va(),ie=Va();qu(K,this.normal,zl),qu(ie,this.normal,zl),M.push(ie[0],ie[1],0),M.push(K[0],K[1],0),w.push(i[0],i[1],i[2]|0,this.totalDistance-Y,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),w.push(i[0],i[1],i[2]|0,this.totalDistance-Y,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,M,i,this.normal,this.thickness,this.totalDistance-Y);if(b.push(n+0,n+1,n+2),o){PE(a,o)&&qu(o,a,Gv(o,Mg(o,a,i))),by(tm,o,a);var ze=OE(xy,Va(),zl,tm,this.thickness),ue=Pi(ze,2),Ke=ue[0],ke=ue[1],Ce=mm(xy,this.normal)<0?-1:1,je=N;if(!je&&this.join==="miter"){var ve=Ke;ve>this.miterLimit&&(je=!0)}je?(M.push(this.normal[0],this.normal[1],0),M.push(ke[0],ke[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,zn(this.lastFlip!==-Ce?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),rm(Lx,tm),Fv(this.normal,Lx),M.push(this.normal[0],this.normal[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ce,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(w,M,a,ke,Ke,this.totalDistance),b.push.apply(b,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ce=-1,Fv(this.normal,ke),y+=2),this.lastFlip=Ce}else{if(rm(this.normal,zl),O){var le=Va(),Se=Va();Zy(Se,zl,this.normal),qu(le,zl,this.normal),M.push(Se[0],Se[1],0),M.push(le[0],le[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,M,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,y=t.normals,b=this.cap==="square",w=this.join==="bevel",M=Ic([a[0],a[1]]),O=Ic([i[0],i[1]]);by(zl,M,O);var N=0;if(this.dash&&(N=this.lineSegmentDistance(M,O),this.totalDistance+=N),this.normal||(this.normal=Va(),rm(this.normal,zl)),!this.started)if(this.started=!0,b){var z=Va(),j=Va();qu(z,this.normal,zl),qu(j,this.normal,zl),y.push(j[0],j[1],0),y.push(z[0],z[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-N,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-N,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,i,this.normal,this.thickness,this.totalDistance-N);if(c.push(n+0,n+1,n+2),o){var ie=Ic([o[0],o[1]]);PE(M,ie)&&qu(ie,M,Gv(ie,Mg(ie,M,O))),by(tm,ie,M);var le=OE(xy,Va(),zl,tm,this.thickness),Se=Pi(le,2),ze=Se[0],ue=Se[1],Ke=mm(xy,this.normal)<0?-1:1,ke=w;if(!ke&&this.join==="miter"){var Ce=ze;Ce>this.miterLimit&&(ke=!0)}ke?(y.push(this.normal[0],this.normal[1],0),y.push(ue[0],ue[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,zn(this.lastFlip!==-Ke?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),rm(Lx,tm),Fv(this.normal,Lx),y.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ke,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,y,a,ue,ze,this.totalDistance),c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ke=-1,Fv(this.normal,ue),l+=2),this.lastFlip=Ke}else{if(rm(this.normal,zl),b){var Y=Va(),K=Va();Zy(K,zl,this.normal),qu(Y,zl,this.normal),y.push(K[0],K[1],0),y.push(Y[0],Y[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,y,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,zn(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function pP(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=jv.exports.flatten(e),o=a.vertices,l=a.dimensions,c=[],p=[],y=[],b=0;b<o.length/l;b++)l===2?c.push(o[b*2],o[b*2+1],1,-1,-1):c.push(o[b*3],o[b*3+1],1,-1,-1),y.push(0,0,1);var w=jv.exports(a.vertices,a.holes,a.dimensions);p.push.apply(p,zn(w));for(var M=function(z){var j=a.vertices.slice(z*l,(z+1)*l),Y=a.vertices.slice((z+1)*l,(z+2)*l);Y.length===0&&(Y=a.vertices.slice(0,l));var K=c.length/5;c.push(j[0],j[1],1,0,0,Y[0],Y[1],1,.1,0,j[0],j[1],0,0,.8,Y[0],Y[1],0,.1,.8);var ie=G$([Y[0],Y[1],1],[j[0],j[1],0],[j[0],j[1],1],r);y.push.apply(y,zn(ie).concat(zn(ie),zn(ie),zn(ie))),p.push.apply(p,zn([1,2,0,3,2,1].map(function(le){return le+K})))},O=0;O<i;O++)M(O);return{positions:c,index:p,normals:y}}function G$(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=ky(),a=ky(),o=ky();n&&(e=rE(e),r=rE(r),t=rE(t));var l=Lc.apply(uE,zn(e)),c=Lc.apply(uE,zn(r)),p=Lc.apply(uE,zn(t));LC(i,p,c),LC(a,l,c),mO(o,i,a);var y=ky();return Ry(y,o),y}var rd,bg;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(bg||(bg={}));var Eg;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Eg||(Eg={}));function J1(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(o){var l=Math.sin(o+Math.PI/4),c=Math.cos(o+Math.PI/4);return[l,c,0]});return a}function RI(){return J1(30)}function OI(){return J1(4)}function PI(){return J1(3)}function FI(){return J1(6,1)}function DI(){return J1(5)}var FE=(rd={},ne(rd,Eg.CIRCLE,RI),ne(rd,Eg.HEXAGON,FI),ne(rd,Eg.TRIANGLE,PI),ne(rd,Eg.SQUARE,OI),ne(rd,Eg.PENTAGON,DI),ne(rd,bg.CYLINDER,RI),ne(rd,bg.HEXAGONCOLUMN,FI),ne(rd,bg.TRIANGLECOLUMN,PI),ne(rd,bg.SQUARECOLUMN,OI),ne(rd,bg.PENTAGONCOLUMN,DI),rd),kx={};function Lg(e){var r=cd(e.coordinates);return{vertices:[].concat(zn(r),zn(r),zn(r),zn(r)),indices:[0,1,2,2,3,0],size:r.length}}function BI(e){var r=cd(e.coordinates),t=hP(r);return{vertices:[].concat(zn(t),zn(t),zn(t),zn(t)),indices:[0,1,2,2,3,0],size:t.length}}function dP(e){var r=e.shape,t=Y$(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function j$(e){var r=cd(e.coordinates);return{vertices:zn(r),indices:[0],size:r.length}}function Bg(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new V$({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=o[l];i.extrude_gaode2(c,p)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(w){i.extrude(w)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function H$(e){var r=e.coordinates,t=[],n=W$(r),i=n.results,a=n.totalDistance;return i.map(function(o){t.push(o[0],o[1],o[2],o[3],0,a)}),{vertices:t,indices:[],normals:[],size:6,count:i.length}}function NI(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function DE(e,r){return e.length<3&&e.push(0),e.push(r),e}function W$(e){var r=0;if(e.length<2)return{results:e,totalDistance:0};var t=[],n=DE(e[0],r);t.push(n);for(var i=1;i<e.length-1;i++){var a=NI(e[i-1],e[i]);r+=a;var o=DE(e[i],r);t.push(o),t.push(o)}var l=NI(e[e.length-2],e[e.length-1]);return r+=l,t.push(DE(e[e.length-1],r)),{results:t,totalDistance:r}}function N1(e){var r=e.coordinates,t=jv.exports.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:jv.exports(n,a,i),vertices:n,size:i}}function $$(e){var r=e.coordinates,t=jv.exports.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:jv.exports(n,a,i),vertices:X$(n),size:i+4}}function X$(e){for(var r=[],t=YB(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var o=e[a],l=e[a+1];r.push.apply(r,[o,l,0].concat(zn(n),[i]))}return r}function Z$(e){var r=e.coordinates,t=pP(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function Bw(e){var r=e.coordinates,t=[].concat(zn(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],zn(r[1]),[0,1,0],zn(r[0]),[0,0,1],zn(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function f2(e,r){for(var t=r||30,n=e.coordinates,i=[],a=[],o=function(p){i.push(p,1,p,n[0][0],n[0][1],n[1][0],n[1][1],p,-1,p,n[0][0],n[0][1],n[1][0],n[1][1]),p!==t-1&&a.push.apply(a,zn([0,1,2,1,3,2].map(function(y){return p*2+y})))},l=0;l<t;l++)o(l);return{vertices:i,indices:a,size:7}}function Y$(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(kx&&kx[e])return kx[e];var t=FE[e]?FE[e]():FE.cylinder(),n=pP([t],r);return kx[e]=n,n}function q$(e){var r=K$();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function K$(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Q$=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,J$=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,eX=function(e){On(t,e);var r=q$(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.clampLow,l=o===void 0?!0:o,c=i.clampHigh,p=c===void 0?!0:c,y=i.noDataValue,b=y===void 0?-9999999:y,w=i.domain,M=w===void 0?[0,1]:w,O=i.rampColors,N=i.pixelConstant,z=N===void 0?0:N,j=i.pixelConstantR,Y=j===void 0?256*256:j,K=i.pixelConstantG,ie=K===void 0?256:K,le=i.pixelConstantB,Se=le===void 0?1:le,ze=i.pixelConstantRGB,ue=ze===void 0?.1:ze;return Vr.exports.isEqual(this.rampColors,O)||(this.updateColorTexure(),this.rampColors=O),{u_opacity:a||1,u_texture:this.texture,u_pixelConstant:z,u_pixelConstantR:Y,u_pixelConstantG:ie,u_pixelConstantB:Se,u_pixelConstantRGB:ue,u_domain:M,u_clampLow:l,u_clampHigh:typeof p<"u"?p:l,u_noDataValue:b,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(i){var a=this,o=this.layer.getLayerConfig(),l=o.mask,c=l===void 0?!1:l,p=o.maskInside,y=p===void 0?!0:p,b=o.rampColorsData,w=o.rampColors,M=this.layer.getSource(),O=this.rendererService.createTexture2D;if(this.texture=O({height:0,width:0}),Zh){var N=this.layerService.sceneService.getSceneConfig().canvas,z=N.createImage();z.crossOrigin="anonymous",z.src=M.data.originData,z.onload=function(){a.texture=O({data:z,width:z.width,height:z.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else M.data.images.then(function(Y){a.texture=O({data:Y[0],width:Y[0].width,height:Y[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});var j=b||Rg(w);this.colorTexture=O({data:j.data,width:j.width,height:j.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:J$,fragmentShader:Q$,triangulation:Bw,primitive:Q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:bs(c,y)}).then(function(Y){i([Y])}).catch(function(Y){console.warn(Y),i([])})}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[3],l[4]]}}})}},{key:"updateColorTexure",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.rampColors,l=Rg(o);this.colorTexture=i({data:l.data,width:l.width,height:l.height,flipY:!1})}}]),t}($o);function tX(e){var r=rX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function rX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nX=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,iX=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,aX=function(e){On(t,e);var r=tX(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(i){var a=this,o=this.layer.getLayerConfig(),l=o.mask,c=l===void 0?!1:l,p=o.maskInside,y=p===void 0?!0:p,b=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),Zh){var M=this.layerService.sceneService.getSceneConfig().canvas,O=M.createImage();O.crossOrigin="anonymous",O.src=b.data.originData,O.onload=function(){a.texture=w({data:O,width:O.width,height:O.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else b.data.images.then(function(N){a.texture=w({data:N[0],width:N[0].width,height:N[0].height,mag:Q.LINEAR,min:Q.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:iX,fragmentShader:nX,triangulation:Bw,primitive:Q.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:bs(c,y)}).then(function(N){i([N])}).catch(function(N){console.warn(N),i([])})}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[3],l[4]]}}})}}]),t}($o),oX={image:aX,dataImage:eX};const sX=oX;function uX(e){var r=lX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function lX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cX=function(e){On(t,e);var r=uX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","ImageLayer"),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new sX[a](this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{},dataImage:{}};return a[i]}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o==="dataImage"?"dataImage":(o==="image","image")}}]),t}(Gg);function fX(e){var r=hX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function hX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pX=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,dX=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,vX=function(e){On(t,e);var r=fX(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?0:a;return{u_opacity:Vr.exports.isNumber(o)?o:0}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(){var n=eo(Xn.mark(function a(o){return Xn.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:dX,fragmentShader:pX,triangulation:N1,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:Q.ALWAYS,ref:1,mask:255},opFront:{fail:Q.REPLACE,zfail:Q.REPLACE,zpass:Q.REPLACE}}}).then(function(p){o([p])}).catch(function(p){console.warn(p),o([])});case 1:case"end":return c.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}($o),mX={fill:vX};const gX=mX;function yX(e){var r=_X();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function _X(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vP=function(e){On(t,e);var r=yX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","MaskLayer"),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new gX[a](this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(Gg),xX=["mvt","geojsonvt","testTile"];function Nw(e){return xX.indexOf(e)>=0}function zw(e,r){r.map(function(t){var n=JC(e.sceneContainer);t.setContainer(n,e.sceneContainer),t.init()})}function mP(e,r){var t,n=r.getAttribute("shape");if(n&&(t=n.scale)!==null&&t!==void 0&&t.field){var i;return((i=n.scale)===null||i===void 0?void 0:i.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function bX(e,r){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return r;default:return r}}function EX(e,r,t,n){var i,a,o,l,c=(e==null||(i=e.bboxPolygon)===null||i===void 0?void 0:i.bbox)||[0,0,10,-10],p=Pi(c,4),y=p[0],b=y===void 0?0:y,w=p[1],M=w===void 0?0:w,O=p[2],N=O===void 0?10:O,z=p[3],j=z===void 0?-10:z,Y=r.lngLatToContainer([b,M]),K=r.lngLatToContainer([N,j]),ie=K.x-Y.x,le=Y.y-K.y,Se=[(t-Y.x)/ie,(n-K.y)/le],ze=(e==null||(a=e.data)===null||a===void 0?void 0:a.width)||1,ue=(e==null||(o=e.data)===null||o===void 0?void 0:o.height)||1,Ke=Math.floor(Se[0]*ze),ke=Math.floor(Se[1]*ue),Ce=Math.max(0,ke-1)*ze+Ke,je=e==null||(l=e.data)===null||l===void 0?void 0:l.data[Ce];return je}function CX(e){var r=SX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function SX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wX=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,AX=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,nS=function(e){On(t,e);var r=CX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineTexture,y=p===void 0?!1:p,b=i.iconStep,w=b===void 0?100:b,M=i.vertexHeightScale,O=M===void 0?20:M,N=i.borderWidth,z=N===void 0?0:N,j=i.borderColor,Y=j===void 0?"#ccc":j,K=i.heightfixed,ie=K===void 0?!1:K,le=i.arrow,Se=le===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:le,ze=i.coord,ue=ze===void 0?"lnglat":ze,Ke=i.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var ke=this.layer.getEncodedData(),Ce=this.calDataFrame(this.cellLength,ke,this.cellProperties),je=Ce.data,ve=Ce.width,Ie=Ce.height;this.rowCount=Ie,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:Q.LUMINANCE,type:Q.FLOAT,width:ve,height:Ie}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_tileOrigin:Ke||[0,0],u_coord:ue==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(o),u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:y?1:0,u_icon_step:w,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:z,u_borderColor:Lo(Y),u_heightfixed:Number(ie),u_vertexScale:O,u_arrow:Number(Se.enable),u_arrowHeight:Se.arrowHeight||3,u_arrowWidth:Se.arrowWidth||2,u_tailWidth:Se.tailWidth===void 0?1:Se.tailWidth}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=eo(Xn.mark(function a(o){var l,c,p,y,b,w,M;return Xn.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:l=this.layer.getLayerConfig(),c=l.mask,p=c===void 0?!1:c,y=l.maskInside,b=y===void 0?!0:y,w=l.depth,M=w===void 0?!1:w,this.layer.triangulation=Bg,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:AX,fragmentShader:wX,triangulation:Bg,blend:this.getBlend(),depth:{enable:M},stencil:bs(p,b)}).then(function(z){o([z])}).catch(function(z){console.warn(z),o([])});case 3:case"end":return N.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p,y,b){return b===void 0?[c[3],10]:[c[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function TX(e){var r=MX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function MX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IX=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,LX=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,zI=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,gP=function(e){On(t,e);var r=TX(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.vertexHeightScale,y=p===void 0?20:p,b=0,w=[0,0,0,0],M=[0,0,0,0];if(l&&c&&(w=Lo(l),M=Lo(c),b=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var O=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,O,this.cellProperties),z=N.data,j=N.width,Y=N.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:Q.LUMINANCE,type:Q.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_linearColor:b,u_sourceColor:w,u_targetColor:M,u_vertexScale:y}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:LX,vert:zI,type:"lineSimpleLinear"}:{frag:IX,vert:zI,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=this.getShaders(),b=y.frag,w=y.vert,M=y.type;this.layer.buildLayerModel({moduleName:M,vertexShader:w,fragmentShader:b,triangulation:H$,primitive:Q.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(O){i([O])}).catch(function(O){console.warn(O),i([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:_n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){var p=a.size,y=p===void 0?1:p;return Array.isArray(y)?[y[0],y[1]]:[y,0]}}})}}]),t}($o);function kX(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=RX(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function RX(e,r){if(!!e){if(typeof e=="string")return UI(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return UI(e,r)}}function UI(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var OX=function(){function e(r,t,n){Kt(this,e),ne(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return Qt(e,[{key:"insert",value:function(t,n,i,a,o){this.forEachCell(n,i,a,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o)}},{key:"query",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!1,o)}},{key:"hitTest",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!0,o)}},{key:"insertBoxCell",value:function(t,n,i,a,o,l){this.boxCells[o].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,o,l){if(i<0||t>this.width||a<0||n>this.height)return o?!1:[];var c=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[p*4],y1:this.bboxes[p*4+1],x2:this.bboxes[p*4+2],y2:this.bboxes[p*4+3]});return l?c.filter(l):c}var y={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,c,y,l),o?c.length>0:c}},{key:"queryCell",value:function(t,n,i,a,o,l,c,p){var y=c.seenUids,b=this.boxCells[o];if(b!==null){var w=this.bboxes,M=kX(b),O;try{for(M.s();!(O=M.n()).done;){var N=O.value;if(!y.box[N]){y.box[N]=!0;var z=N*4;if(t<=w[z+2]&&n<=w[z+3]&&i>=w[z+0]&&a>=w[z+1]&&(!p||p(this.boxKeys[N]))){if(c.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[N],x1:w[z],y1:w[z+1],x2:w[z+2],y2:w[z+3]})}}}}catch(j){M.e(j)}finally{M.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,o,l,c,p){for(var y=this.convertToXCellCoord(t),b=this.convertToYCellCoord(n),w=this.convertToXCellCoord(i),M=this.convertToYCellCoord(a),O=y;O<=w;O++)for(var N=b;N<=M;N++){var z=this.xCellCount*N+O;if(o.call(this,t,n,i,a,z,l,c,p))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}();const PX=OX;var yP=function(){function e(r,t){Kt(this,e),ne(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new PX(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return Qt(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,o)||this.grid.hitTest(n,i,a,o)?{box:[]}:{box:[n,i,a,o]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=Y9(n,i,0,1),o=gO(),l=QR.apply(m9,zn(t));return bw(o,a,l),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function _P(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=FX(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function FX(e,r){if(!!e){if(typeof e=="string")return VI(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return VI(e,r)}}function VI(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function xP(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function bP(e,r,t,n,i){if(!!i){var a=e[n],o=a.glyph;if(o)for(var l=r[o].advance*a.scale,c=(e[n].x+l)*i,p=t;p<=n;p++)e[p].x-=c}}function EP(e,r,t,n,i,a,o){var l=(r-t)*i,c=(-n*o+.5)*a,p=_P(e),y;try{for(p.s();!(y=p.n()).done;){var b=y.value;b.x+=l,b.y+=c}}catch(w){p.e(w)}finally{p.f()}}function DX(e,r,t,n,i,a,o){var l=-8,c=0,p=l,y=0,b=e.positionedGlyphs,w=a==="right"?1:a==="left"?0:.5,M=b.length;t.forEach(function(Y){if(Y.split("").forEach(function(ie){var le=r[ie],Se=0;le&&(b.push({glyph:ie,x:c,y:p+Se,vertical:!1,scale:1,metrics:le}),c+=le.advance+o)}),b.length!==M){var K=c-o;y=Math.max(K,y),bP(b,r,M,b.length-1,w)}c=0,p-=n+5});var O=xP(i),N=O.horizontalAlign,z=O.verticalAlign;EP(b,w,N,z,y,n,t.length);var j=p-l;e.top+=-z*j,e.bottom=e.top-j,e.left+=-N*y,e.right=e.left+y}function BX(e,r,t,n,i,a,o){var l=-8,c=0,p=l,y=0,b=e.positionedGlyphs,w=a==="right"?1:a==="left"?0:.5,M=b.length;t.forEach(function(Y){var K=r[Y],ie=0;if(K&&(b.push({glyph:Y,x:K.advance/2,y:p+ie,vertical:!1,scale:1,metrics:K}),c+=K.advance+o),b.length!==M){var le=c-o;y=Math.max(le,y),bP(b,r,M,b.length-1,w)}c=0,p-=n+5});var O=xP(i),N=O.horizontalAlign,z=O.verticalAlign;EP(b,w,N,z,y,n,t.length);var j=p-l;e.top+=-z*j,e.bottom=e.top-j,e.left+=-N*y,e.right=e.left+y}function CP(e,r,t,n,i,a){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),p=[],y={positionedGlyphs:p,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:c.length,text:e};return l?BX(y,r,c,t,n,i,a):DX(y,r,c,t,n,i,a),p.length?y:!1}function SP(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],o=_P(i),l;try{for(o.s();!(l=o.n()).done;){var c=l.value,p=c.metrics,y=4,b=p.advance*c.scale/2,w=t?[c.x+b,c.y]:[0,0],M=t?[0,0]:[c.x+b+r[0],c.y+r[1]],O=(0-y)*c.scale-b+M[0],N=(0-y)*c.scale+M[1],z=O+p.width*c.scale,j=N+p.height*c.scale,Y={x:O,y:N},K={x:z,y:N},ie={x:O,y:j},le={x:z,y:j};a.push({tl:Y,tr:K,bl:ie,br:le,tex:p,glyphOffset:w})}}catch(Se){o.e(Se)}finally{o.f()}return a}function NX(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zX(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function zX(e,r){if(!!e){if(typeof e=="string")return GI(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return GI(e,r)}}function GI(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function UX(e){var r=VX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function VX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jI=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,HI=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function WI(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,c){n.push.apply(n,zn(o).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],zn(o),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],zn(o),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],zn(o),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var wP=function(e){On(t,e);var r=UX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"glyphInfoMap",{}),ne(vt(n),"currentZoom",-1),ne(vt(n),"textureHeight",0),ne(vt(n),"textCount",0),ne(vt(n),"preTextStyle",{}),ne(vt(n),"buildModels",function(){var l=eo(Xn.mark(function c(p){var y,b,w,M,O;return Xn.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:y=n.layer.getLayerConfig(),b=y.mask,w=b===void 0?!1:b,M=y.maskInside,O=M===void 0?!0:M,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:HI,fragmentShader:jI,triangulation:WI.bind(vt(n)),depth:{enable:!1},blend:n.getBlend(),stencil:bs(w,O)}).then(function(j){p([j])}).catch(function(j){console.warn(j),p([])});case 3:case"end":return z.stop()}},c)}));return function(c){return l.apply(this,arguments)}}()),ne(vt(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.stroke,c=l===void 0?"#fff":l,p=i.strokeWidth,y=p===void 0?0:p,b=i.textAnchor,w=b===void 0?"center":b,M=i.textAllowOverlap,O=M===void 0?!1:M,N=i.halo,z=N===void 0?.5:N,j=i.gamma,Y=j===void 0?2:j,K=i.raisingHeight,ie=K===void 0?0:K,le=this.fontService,Se=le.canvas,ze=le.mapping;if(Object.keys(ze).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(ze).length),this.preTextStyle={textAnchor:w,textAllowOverlap:O},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:y,stroke:c})){this.judgeStyleAttributes({opacity:o,strokeWidth:y,stroke:c});var ue=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,ue,this.cellProperties),ke=Ke.data,Ce=Ke.width,je=Ke.height;this.rowCount=je,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:Q.LUMINANCE,type:Q.FLOAT,width:Ce,height:je}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(ie),u_opacity:Vr.exports.isNumber(o)?o:1,u_stroke_width:Vr.exports.isNumber(y)?y:1,u_stroke_color:this.getStrokeColor(c),u_sdf_map:this.texture,u_halo_blur:z,u_gamma_scale:Y,u_sdf_map_size:[Se.width,Se.height]}}},{key:"initModels",value:function(i){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),o=a.textAnchor,l=o===void 0?"center":o,c=a.textAllowOverlap,p=c===void 0?!0:c;this.preTextStyle={textAnchor:l,textAllowOverlap:p},this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:_n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.rotate,y=p===void 0?0:p;return Array.isArray(y)?[y[0]]:[y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:_n.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.size,y=p===void 0?12:p;return Array.isArray(y)?[y[0]]:[y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:_n.Attribute,descriptor:{name:"a_tex",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[3],l[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Kb(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=this.layer.getEncodedData(),y=[];p.forEach(function(b){var w=b.shape,M=w===void 0?"":w;M=M.toString();var O=NX(M),N;try{for(O.s();!(N=O.n()).done;){var z=N.value;y.indexOf(z)===-1&&y.push(z)}}catch(j){O.e(j)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:y,fontWeight:o,fontFamily:c,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=this.layer.getEncodedData(),y=[];p.forEach(function(b){var w=b.shape,M=w===void 0?"":w;M="".concat(M),y.indexOf(M)===-1&&y.push(M)}),this.fontService.setFontOptions({characterSet:y,fontWeight:o,fontFamily:c,iconfont:!0})}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.fontService.mapping,l=this.layer.getLayerConfig(),c=l.spacing,p=c===void 0?2:c,y=l.textAnchor,b=y===void 0?"center":y,w=this.layer.getEncodedData();this.glyphInfo=w.map(function(M){var O=M.shape,N=O===void 0?"":O,z=M.id,j=M.size,Y=j===void 0?1:j,K=M.textOffset,ie=K===void 0?[0,0]:K,le=CP(N.toString(),o,Y,b,"left",p,ie,i),Se=SP(le,ie,!1);return M.shaping=le,M.glyphQuads=Se,M.centroid=cd(M.coordinates),M.originCentroid=M.version==="GAODE2.x"?cd(M.originCoordinates):M.originCentroid=M.centroid,a.glyphInfoMap[z]={shaping:le,glyphQuads:Se,centroid:cd(M.coordinates)},M})}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,l=o===void 0?[4,4]:o,c=a.textAllowOverlap,p=c===void 0?!1:c;if(!p){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),b=y.width,w=y.height,M=new yP(b,w),O=this.glyphInfo.filter(function(N){var z=N.shaping,j=N.id,Y=j===void 0?0:j,K=N.version==="GAODE2.x"?N.originCentroid:N.centroid,ie=N.size,le=ie/24,Se=i.mapService.lngLatToContainer(K),ze=M.placeCollisionBox({x1:z.left*le-l[0],x2:z.right*le+l[0],y1:z.top*le-l[1],y2:z.bottom*le+l[1],anchorPointX:Se.x,anchorPointY:Se.y}),ue=ze.box;return ue&&ue.length?(M.insertCollisionBox(ue,Y),!0):!1});O.forEach(function(N){i.glyphInfoMap[N.id]=N})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Q.LINEAR,min:Q.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText",vertexShader:HI,fragmentShader:jI,triangulation:WI.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i.layer.models=[y],i.layer.renderLayers()}).catch(function(y){console.warn(y),i.layer.models=[]})}}]),t}($o);function GX(e){var r=jX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function jX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HX=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,WX=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,Jx=function(e){On(t,e);var r=GX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"meter2coord",1),ne(vt(n),"isMeter",!1),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.strokeOpacity,c=l===void 0?1:l,p=i.strokeWidth,y=p===void 0?0:p,b=i.stroke,w=b===void 0?"rgba(0,0,0,0)":b,M=i.offsets,O=M===void 0?[0,0]:M,N=i.blend,z=i.blur,j=z===void 0?0:z,Y=i.coord,K=Y===void 0?"lnglat":Y,ie=i.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O})){this.judgeStyleAttributes({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O});var le=this.layer.getEncodedData(),Se=this.calDataFrame(this.cellLength,le,this.cellProperties),ze=Se.data,ue=Se.width,Ke=Se.height;this.rowCount=Ke,this.dataTexture=this.cellLength>0&&ze.length>0?this.createTexture2D({flipY:!0,data:ze,format:Q.LUMINANCE,type:Q.FLOAT,width:ue,height:Ke}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_tileOrigin:ie||[0,0],u_coord:K==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:j,u_additive:N==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(o),u_stroke_opacity:Number(c),u_stroke_width:Number(y),u_stroke_color:this.getStrokeColor(w),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.unit,l=o===void 0?"l7size":o,c=this.mapService.version;l==="meter"&&c!==vu.L7MAP&&c!==vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=Pi(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3],p=[(a+l)/2,(o+c)/2],y=this.mapService.version;if(y===vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var b=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:p[0],lat:p[1]},0),w=1,M=w*b.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(b.x-M,b.y,b.z),N=O.toLngLat();this.meter2coord=p[0]-N.lng;return}var z=this.mapService.meterToCoord(p,[a,o]),j=this.mapService.meterToCoord(p,[l===a?l+.1:l,c===o?o+.1:c]);this.meter2coord=(z+j)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=a.workerEnabled,b=y===void 0?!1:y;this.layer.triangulation=Lg,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:WX,fragmentShader:HX,triangulation:Lg,depth:{enable:!1},cull:{enable:!0,face:n2(this.mapService.version)},blend:this.getBlend(),stencil:bs(l,p),workerEnabled:b,workerOptions:{modelType:"pointTile"}}).then(function(w){i([w])}).catch(function(w){console.warn(w),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]*i.meter2coord]:[b*i.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.shape,b=y===void 0?2:y,w=i.layer.getLayerConfig().shape2d,M=w.indexOf(b);return[M]}}})}}]),t}($o);function $X(e){var r=XX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function XX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ZX=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,YX=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,AP=function(e){On(t,e);var r=$X(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.tileOrigin,c=i.coord,p=c===void 0?"lnglat":c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var y=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,y,this.cellProperties),w=b.data,M=b.width,O=b.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:Q.LUMINANCE,type:Q.FLOAT,width:M,height:O}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_tileOrigin:l||[0,0],u_coord:p==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:o}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.triangulation=N1,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:YX,fragmentShader:ZX,triangulation:N1,primitive:Q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}($o);function qX(e){var r=KX();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function KX(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var iS=function(e){On(t,e);var r=qX(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"isVector",!0),ne(vt(n),"type",n.layerType),ne(vt(n),"pickedID",null),n}return Qt(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new a(this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return AP;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return Jx}}},{key:"getLineModel",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;switch(o){case"tileline":case"line":return nS;case"simple":return gP;default:return nS}}},{key:"getPointModel",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=i.find(function(p){return p.hasOwnProperty("shape")});if(l){var c=l.shape;return(o==null?void 0:o.indexOf(c))!==-1?Jx:wP}else return Jx}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Gg);/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function QX(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var wm=function(){function e(r,t){this.next=null,this.key=r,this.data=t,this.left=null,this.right=null}return e}();function JX(e,r){return e>r?1:e<r?-1:0}function fm(e,r,t){for(var n=new wm(null,null),i=n,a=n;;){var o=t(e,r.key);if(o<0){if(r.left===null)break;if(t(e,r.left.key)<0){var l=r.left;if(r.left=l.right,l.right=r,r=l,r.left===null)break}a.left=r,a=r,r=r.left}else if(o>0){if(r.right===null)break;if(t(e,r.right.key)>0){var l=r.right;if(r.right=l.left,l.left=r,r=l,r.right===null)break}i.right=r,i=r,r=r.right}else break}return i.right=r.left,a.left=r.right,r.left=n.right,r.right=n.left,r}function BE(e,r,t,n){var i=new wm(e,r);if(t===null)return i.left=i.right=null,i;t=fm(e,t,n);var a=n(e,t.key);return a<0?(i.left=t.left,i.right=t,t.left=null):a>=0&&(i.right=t.right,i.left=t,t.right=null),i}function $I(e,r,t){var n=null,i=null;if(r){r=fm(e,r,t);var a=t(r.key,e);a===0?(n=r.left,i=r.right):a<0?(i=r.right,r.right=null,n=r):(n=r.left,r.left=null,i=r)}return{left:n,right:i}}function eZ(e,r,t){return r===null?e:(e===null||(r=fm(e.key,r,t),r.left=e),r)}function aS(e,r,t,n,i){if(e){n(""+r+(t?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+i(e)+`
`);var a=r+(t?"    ":"\u2502   ");e.left&&aS(e.left,a,!1,n,i),e.right&&aS(e.right,a,!0,n,i)}}var Uw=function(){function e(r){r===void 0&&(r=JX),this._root=null,this._size=0,this._comparator=r}return e.prototype.insert=function(r,t){return this._size++,this._root=BE(r,t,this._root,this._comparator)},e.prototype.add=function(r,t){var n=new wm(r,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=fm(r,this._root,i),o=i(r,a.key);return o===0?this._root=a:(o<0?(n.left=a.left,n.right=a,a.left=null):o>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(r){this._root=this._remove(r,this._root,this._comparator)},e.prototype._remove=function(r,t,n){var i;if(t===null)return null;t=fm(r,t,n);var a=n(r,t.key);return a===0?(t.left===null?i=t.right:(i=fm(r,t.left,n),i.right=t.right),this._size--,i):t},e.prototype.pop=function(){var r=this._root;if(r){for(;r.left;)r=r.left;return this._root=fm(r.key,this._root,this._comparator),this._root=this._remove(r.key,this._root,this._comparator),{key:r.key,data:r.data}}return null},e.prototype.findStatic=function(r){for(var t=this._root,n=this._comparator;t;){var i=n(r,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},e.prototype.find=function(r){return this._root&&(this._root=fm(r,this._root,this._comparator),this._comparator(r,this._root.key)!==0)?null:this._root},e.prototype.contains=function(r){for(var t=this._root,n=this._comparator;t;){var i=n(r,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},e.prototype.forEach=function(r,t){for(var n=this._root,i=[],a=!1;!a;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),r.call(t,n),n=n.right):a=!0;return this},e.prototype.range=function(r,t,n,i){for(var a=[],o=this._comparator,l=this._root,c;a.length!==0||l;)if(l)a.push(l),l=l.left;else{if(l=a.pop(),c=o(l.key,t),c>0)break;if(o(l.key,r)>=0&&n.call(i,l))return this;l=l.right}return this},e.prototype.keys=function(){var r=[];return this.forEach(function(t){var n=t.key;return r.push(n)}),r},e.prototype.values=function(){var r=[];return this.forEach(function(t){var n=t.data;return r.push(n)}),r},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(r){if(r===void 0&&(r=this._root),r)for(;r.left;)r=r.left;return r},e.prototype.maxNode=function(r){if(r===void 0&&(r=this._root),r)for(;r.right;)r=r.right;return r},e.prototype.at=function(r){for(var t=this._root,n=!1,i=0,a=[];!n;)if(t)a.push(t),t=t.left;else if(a.length>0){if(t=a.pop(),i===r)return t;i++,t=t.right}else n=!0;return null},e.prototype.next=function(r){var t=this._root,n=null;if(r.right){for(n=r.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var a=i(r.key,t.key);if(a===0)break;a<0?(n=t,t=t.left):t=t.right}return n},e.prototype.prev=function(r){var t=this._root,n=null;if(r.left!==null){for(n=r.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var a=i(r.key,t.key);if(a===0)break;a<0?t=t.left:(n=t,t=t.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return rZ(this._root)},e.prototype.load=function(r,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=r.length,a=this._comparator;if(n&&uS(r,t,0,i-1,a),this._root===null)this._root=oS(r,t,0,i),this._size=i;else{var o=nZ(this.toList(),tZ(r,t),a);i=this._size+i,this._root=sS({head:o},0,i)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(r){r===void 0&&(r=function(n){return String(n.key)});var t=[];return aS(this._root,"",!0,function(n){return t.push(n)},r),t.join("")},e.prototype.update=function(r,t,n){var i=this._comparator,a=$I(r,this._root,i),o=a.left,l=a.right;i(r,t)<0?l=BE(t,n,l,i):o=BE(t,n,o,i),this._root=eZ(o,l,i)},e.prototype.split=function(r){return $I(r,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var r;return QX(this,function(t){switch(t.label){case 0:r=this.minNode(),t.label=1;case 1:return r?[4,r]:[3,3];case 2:return t.sent(),r=this.next(r),[3,1];case 3:return[2]}})},e}();function oS(e,r,t,n){var i=n-t;if(i>0){var a=t+Math.floor(i/2),o=e[a],l=r[a],c=new wm(o,l);return c.left=oS(e,r,t,a),c.right=oS(e,r,a+1,n),c}return null}function tZ(e,r){for(var t=new wm(null,null),n=t,i=0;i<e.length;i++)n=n.next=new wm(e[i],r[i]);return n.next=null,t.next}function rZ(e){for(var r=e,t=[],n=!1,i=new wm(null,null),a=i;!n;)r?(t.push(r),r=r.left):t.length>0?(r=a=a.next=t.pop(),r=r.right):n=!0;return a.next=null,i.next}function sS(e,r,t){var n=t-r;if(n>0){var i=r+Math.floor(n/2),a=sS(e,r,i),o=e.head;return o.left=a,e.head=e.head.next,o.right=sS(e,i+1,t),o}return null}function nZ(e,r,t){for(var n=new wm(null,null),i=n,a=e,o=r;a!==null&&o!==null;)t(a.key,o.key)<0?(i.next=a,a=a.next):(i.next=o,o=o.next),i=i.next;return a!==null?i.next=a:o!==null&&(i.next=o),n.next}function uS(e,r,t,n,i){if(!(t>=n)){for(var a=e[t+n>>1],o=t-1,l=n+1;;){do o++;while(i(e[o],a)<0);do l--;while(i(e[l],a)>0);if(o>=l)break;var c=e[o];e[o]=e[l],e[l]=c,c=r[o],r[o]=r[l],r[l]=c}uS(e,r,t,l,i),uS(e,r,l+1,n,i)}}function hd(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function XI(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function xh(e,r,t){return r&&XI(e.prototype,r),t&&XI(e,t),e}var B_=function(r,t){return r.ll.x<=t.x&&t.x<=r.ur.x&&r.ll.y<=t.y&&t.y<=r.ur.y},lS=function(r,t){if(t.ur.x<r.ll.x||r.ur.x<t.ll.x||t.ur.y<r.ll.y||r.ur.y<t.ll.y)return null;var n=r.ll.x<t.ll.x?t.ll.x:r.ll.x,i=r.ur.x<t.ur.x?r.ur.x:t.ur.x,a=r.ll.y<t.ll.y?t.ll.y:r.ll.y,o=r.ur.y<t.ur.y?r.ur.y:t.ur.y;return{ll:{x:n,y:a},ur:{x:i,y:o}}},pm=Number.EPSILON;pm===void 0&&(pm=Math.pow(2,-52));var iZ=pm*pm,cS=function(r,t){if(-pm<r&&r<pm&&-pm<t&&t<pm)return 0;var n=r-t;return n*n<iZ*r*t?0:r<t?-1:1},aZ=function(){function e(){hd(this,e),this.reset()}return xh(e,[{key:"reset",value:function(){this.xRounder=new ZI,this.yRounder=new ZI}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),ZI=function(){function e(){hd(this,e),this.tree=new Uw,this.round(0)}return xh(e,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&cS(n.key,i.key)===0)return this.tree.remove(t),i.key;var a=this.tree.next(n);return a!==null&&cS(n.key,a.key)===0?(this.tree.remove(t),a.key):t}}]),e}(),z1=new aZ,l1=function(r,t){return r.x*t.y-r.y*t.x},TP=function(r,t){return r.x*t.x+r.y*t.y},YI=function(r,t,n){var i={x:t.x-r.x,y:t.y-r.y},a={x:n.x-r.x,y:n.y-r.y},o=l1(i,a);return cS(o,0)},bb=function(r){return Math.sqrt(TP(r,r))},oZ=function(r,t,n){var i={x:t.x-r.x,y:t.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return l1(a,i)/bb(a)/bb(i)},sZ=function(r,t,n){var i={x:t.x-r.x,y:t.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return TP(a,i)/bb(a)/bb(i)},qI=function(r,t,n){return t.y===0?null:{x:r.x+t.x/t.y*(n-r.y),y:n}},KI=function(r,t,n){return t.x===0?null:{x:n,y:r.y+t.y/t.x*(n-r.x)}},uZ=function(r,t,n,i){if(t.x===0)return KI(n,i,r.x);if(i.x===0)return KI(r,t,n.x);if(t.y===0)return qI(n,i,r.y);if(i.y===0)return qI(r,t,n.y);var a=l1(t,i);if(a==0)return null;var o={x:n.x-r.x,y:n.y-r.y},l=l1(o,t)/a,c=l1(o,i)/a,p=r.x+c*t.x,y=n.x+l*i.x,b=r.y+c*t.y,w=n.y+l*i.y,M=(p+y)/2,O=(b+w)/2;return{x:M,y:O}},kv=function(){xh(e,null,[{key:"compare",value:function(t,n){var i=e.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Eb.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(r,t){hd(this,e),r.events===void 0?r.events=[this]:r.events.push(this),this.point=r,this.isLeft=t}return xh(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,a=n.length;i<a;i++){var o=n[i];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var a=n+1;a<t;a++){var o=this.point.events[a];o.consumedBy===void 0&&i.otherSE.point.events===o.otherSE.point.events&&i.segment.consume(o.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,a=function(l){var c=l.otherSE;i.set(l,{sine:oZ(n.point,t.point,c.point),cosine:sZ(n.point,t.point,c.point)})};return function(o,l){i.has(o)||a(o),i.has(l)||a(l);var c=i.get(o),p=c.sine,y=c.cosine,b=i.get(l),w=b.sine,M=b.cosine;return p>=0&&w>=0?y<M?1:y>M?-1:0:p<0&&w<0?y<M?-1:y>M?1:0:w<p?-1:w>p?1:0}}}]),e}(),lZ=0,Eb=function(){xh(e,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,a=n.leftSE.point.x,o=t.rightSE.point.x,l=n.rightSE.point.x;if(l<i)return 1;if(o<a)return-1;var c=t.leftSE.point.y,p=n.leftSE.point.y,y=t.rightSE.point.y,b=n.rightSE.point.y;if(i<a){if(p<c&&p<y)return 1;if(p>c&&p>y)return-1;var w=t.comparePoint(n.leftSE.point);if(w<0)return 1;if(w>0)return-1;var M=n.comparePoint(t.rightSE.point);return M!==0?M:-1}if(i>a){if(c<p&&c<b)return-1;if(c>p&&c>b)return 1;var O=n.comparePoint(t.leftSE.point);if(O!==0)return O;var N=t.comparePoint(n.rightSE.point);return N<0?1:N>0?-1:1}if(c<p)return-1;if(c>p)return 1;if(o<l){var z=n.comparePoint(t.rightSE.point);if(z!==0)return z}if(o>l){var j=t.comparePoint(n.rightSE.point);if(j<0)return 1;if(j>0)return-1}if(o!==l){var Y=y-c,K=o-i,ie=b-p,le=l-a;if(Y>K&&ie<le)return 1;if(Y<K&&ie>le)return-1}return o>l?1:o<l||y<b?-1:y>b?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(r,t,n,i){hd(this,e),this.id=++lZ,this.leftSE=r,r.segment=this,r.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=r,this.rings=n,this.windings=i}return xh(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,a=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var o=(t.y-n.y)/a.y,l=n.x+o*a.x;if(t.x===l)return 0;var c=(t.x-n.x)/a.x,p=n.y+c*a.y;return t.y===p?0:t.y<p?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),a=lS(n,i);if(a===null)return null;var o=this.leftSE.point,l=this.rightSE.point,c=t.leftSE.point,p=t.rightSE.point,y=B_(n,c)&&this.comparePoint(c)===0,b=B_(i,o)&&t.comparePoint(o)===0,w=B_(n,p)&&this.comparePoint(p)===0,M=B_(i,l)&&t.comparePoint(l)===0;if(b&&y)return M&&!w?l:!M&&w?p:null;if(b)return w&&o.x===p.x&&o.y===p.y?null:o;if(y)return M&&l.x===c.x&&l.y===c.y?null:c;if(M&&w)return null;if(M)return l;if(w)return p;var O=uZ(o,this.vector(),c,t.vector());return O===null||!B_(a,O)?null:z1.round(O.x,O.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,a=new kv(t,!0),o=new kv(t,!1),l=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(a);var c=new e(a,l,this.rings.slice(),this.windings.slice());return kv.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),kv.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(a.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var a=e.compare(n,i);if(a!==0){if(a>0){var o=n;n=i,i=o}if(n.prev===i){var l=n;n=i,i=l}for(var c=0,p=i.rings.length;c<p;c++){var y=i.rings[c],b=i.windings[c],w=n.rings.indexOf(y);w===-1?(n.rings.push(y),n.windings.push(b)):n.windings[w]+=b}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,a=this._afterState.multiPolys,o=0,l=this.rings.length;o<l;o++){var c=this.rings[o],p=this.windings[o],y=n.indexOf(c);y===-1?(n.push(c),i.push(p)):i[y]+=p}for(var b=[],w=[],M=0,O=n.length;M<O;M++)if(i[M]!==0){var N=n[M],z=N.poly;if(w.indexOf(z)===-1)if(N.isExterior)b.push(z);else{w.indexOf(z)===-1&&w.push(z);var j=b.indexOf(N.poly);j!==-1&&b.splice(j,1)}}for(var Y=0,K=b.length;Y<K;Y++){var ie=b[Y].multiPoly;a.indexOf(ie)===-1&&a.push(ie)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch($d.type){case"union":{var i=t.length===0,a=n.length===0;this._isInResult=i!==a;break}case"intersection":{var o,l;t.length<n.length?(o=t.length,l=n.length):(o=n.length,l=t.length),this._isInResult=l===$d.numMultiPolys&&o<l;break}case"xor":{var c=Math.abs(t.length-n.length);this._isInResult=c%2===1;break}case"difference":{var p=function(b){return b.length===1&&b[0].isSubject};this._isInResult=p(t)!==p(n);break}default:throw new Error("Unrecognized operation type found ".concat($d.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var a,o,l,c=kv.comparePoints(t,n);if(c<0)a=t,o=n,l=1;else if(c>0)a=n,o=t,l=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var p=new kv(a,!0),y=new kv(o,!1);return new e(p,y,[i],[l])}}]),e}(),QI=function(){function e(r,t,n){if(hd(this,e),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=z1.round(r[0][0],r[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var a=i,o=1,l=r.length;o<l;o++){if(typeof r[o][0]!="number"||typeof r[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var c=z1.round(r[o][0],r[o][1]);c.x===a.x&&c.y===a.y||(this.segments.push(Eb.fromRing(a,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),a=c)}(i.x!==a.x||i.y!==a.y)&&this.segments.push(Eb.fromRing(a,i,this))}return xh(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var a=this.segments[n];t.push(a.leftSE),t.push(a.rightSE)}return t}}]),e}(),cZ=function(){function e(r,t){if(hd(this,e),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new QI(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=r.length;n<i;n++){var a=new QI(r[n],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=t}return xh(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var a=this.interiorRings[n].getSweepEvents(),o=0,l=a.length;o<l;o++)t.push(a[o]);return t}}]),e}(),JI=function(){function e(r,t){if(hd(this,e),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=r.length;n<i;n++){var a=new cZ(r[n],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=t}return xh(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var a=this.polys[n].getSweepEvents(),o=0,l=a.length;o<l;o++)t.push(a[o]);return t}}]),e}(),fZ=function(){xh(e,null,[{key:"factory",value:function(t){for(var n=[],i=0,a=t.length;i<a;i++){var o=t[i];if(!(!o.isInResult()||o.ringOut)){for(var l=null,c=o.leftSE,p=o.rightSE,y=[c],b=c.point,w=[];l=c,c=p,y.push(c),c.point!==b;)for(;;){var M=c.getAvailableLinkedEvents();if(M.length===0){var O=y[0].point,N=y[y.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(O.x,",")+" ".concat(O.y,"]. Last matching segment found ends at")+" [".concat(N.x,", ").concat(N.y,"]."))}if(M.length===1){p=M[0].otherSE;break}for(var z=null,j=0,Y=w.length;j<Y;j++)if(w[j].point===c.point){z=j;break}if(z!==null){var K=w.splice(z)[0],ie=y.splice(K.index);ie.unshift(ie[0].otherSE),n.push(new e(ie.reverse()));continue}w.push({index:y.length,point:c.point});var le=c.getLeftmostComparator(l);p=M.sort(le)[0].otherSE;break}n.push(new e(y))}}return n}}]);function e(r){hd(this,e),this.events=r;for(var t=0,n=r.length;t<n;t++)r[t].segment.ringOut=this;this.poly=null}return xh(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,a=this.events.length-1;i<a;i++){var o=this.events[i].point,l=this.events[i+1].point;YI(o,t,l)!==0&&(n.push(o),t=o)}if(n.length===1)return null;var c=n[0],p=n[1];YI(c,t,p)===0&&n.shift(),n.push(n[0]);for(var y=this.isExteriorRing()?1:-1,b=this.isExteriorRing()?0:n.length-1,w=this.isExteriorRing()?n.length:-1,M=[],O=b;O!=w;O+=y)M.push([n[O].x,n[O].y]);return M}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var a=this.events[n];kv.compare(t,a)>0&&(t=a)}for(var o=t.segment.prevInResult(),l=o?o.prevInResult():null;;){if(!o)return null;if(!l)return o.ringOut;if(l.ringOut!==o.ringOut)return l.ringOut.enclosingRing()!==o.ringOut?o.ringOut:o.ringOut.enclosingRing();o=l.prevInResult(),l=o?o.prevInResult():null}}}]),e}(),e3=function(){function e(r){hd(this,e),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}return xh(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var a=this.interiorRings[n].getGeom();a!==null&&t.push(a)}return t}}]),e}(),hZ=function(){function e(r){hd(this,e),this.rings=r,this.polys=this._composePolys(r)}return xh(e,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var a=this.polys[n].getGeom();a!==null&&t.push(a)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,a=t.length;i<a;i++){var o=t[i];if(!o.poly)if(o.isExteriorRing())n.push(new e3(o));else{var l=o.enclosingRing();l.poly||n.push(new e3(l)),l.poly.addInterior(o)}}return n}}]),e}(),pZ=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Eb.compare;hd(this,e),this.queue=r,this.tree=new Uw(t),this.segments=[]}return xh(e,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var a=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!a)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var o=a,l=a,c=void 0,p=void 0;c===void 0;)o=this.tree.prev(o),o===null?c=null:o.key.consumedBy===void 0&&(c=o.key);for(;p===void 0;)l=this.tree.next(l),l===null?p=null:l.key.consumedBy===void 0&&(p=l.key);if(t.isLeft){var y=null;if(c){var b=c.getIntersection(n);if(b!==null&&(n.isAnEndpoint(b)||(y=b),!c.isAnEndpoint(b)))for(var w=this._splitSafely(c,b),M=0,O=w.length;M<O;M++)i.push(w[M])}var N=null;if(p){var z=p.getIntersection(n);if(z!==null&&(n.isAnEndpoint(z)||(N=z),!p.isAnEndpoint(z)))for(var j=this._splitSafely(p,z),Y=0,K=j.length;Y<K;Y++)i.push(j[Y])}if(y!==null||N!==null){var ie=null;if(y===null)ie=N;else if(N===null)ie=y;else{var le=kv.comparePoints(y,N);ie=le<=0?y:N}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var Se=n.split(ie),ze=0,ue=Se.length;ze<ue;ze++)i.push(Se[ze])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=c)}else{if(c&&p){var Ke=c.getIntersection(p);if(Ke!==null){if(!c.isAnEndpoint(Ke))for(var ke=this._splitSafely(c,Ke),Ce=0,je=ke.length;Ce<je;Ce++)i.push(ke[Ce]);if(!p.isAnEndpoint(Ke))for(var ve=this._splitSafely(p,Ke),Ie=0,dt=ve.length;Ie<dt;Ie++)i.push(ve[Ie])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var a=t.split(n);return a.push(i),t.consumedBy===void 0&&this.tree.insert(t),a}}]),e}(),t3=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,dZ=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,vZ=function(){function e(){hd(this,e)}return xh(e,[{key:"run",value:function(t,n,i){$d.type=t,z1.reset();for(var a=[new JI(n,!0)],o=0,l=i.length;o<l;o++)a.push(new JI(i[o],!1));if($d.numMultiPolys=a.length,$d.type==="difference")for(var c=a[0],p=1;p<a.length;)lS(a[p].bbox,c.bbox)!==null?p++:a.splice(p,1);if($d.type==="intersection"){for(var y=0,b=a.length;y<b;y++)for(var w=a[y],M=y+1,O=a.length;M<O;M++)if(lS(w.bbox,a[M].bbox)===null)return[]}for(var N=new Uw(kv.compare),z=0,j=a.length;z<j;z++)for(var Y=a[z].getSweepEvents(),K=0,ie=Y.length;K<ie;K++)if(N.insert(Y[K]),N.size>t3)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var le=new pZ(N),Se=N.size,ze=N.pop();ze;){var ue=ze.key;if(N.size===Se){var Ke=ue.segment;throw new Error("Unable to pop() ".concat(ue.isLeft?"left":"right"," SweepEvent ")+"[".concat(ue.point.x,", ").concat(ue.point.y,"] from segment #").concat(Ke.id," ")+"[".concat(Ke.leftSE.point.x,", ").concat(Ke.leftSE.point.y,"] -> ")+"[".concat(Ke.rightSE.point.x,", ").concat(Ke.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(N.size>t3)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(le.segments.length>dZ)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ke=le.process(ue),Ce=0,je=ke.length;Ce<je;Ce++){var ve=ke[Ce];ve.consumedBy===void 0&&N.insert(ve)}Se=N.size,ze=N.pop()}z1.reset();var Ie=fZ.factory(le.segments),dt=new hZ(Ie);return dt.getGeom()}}]),e}(),$d=new vZ,mZ=function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return $d.run("union",r,n)},gZ=function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return $d.run("intersection",r,n)},yZ=function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return $d.run("xor",r,n)},_Z=function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return $d.run("difference",r,n)},xZ={union:mZ,intersection:gZ,xor:yZ,difference:_Z};function bZ(e,r,t){t===void 0&&(t={});var n=y1(e),i=y1(r),a=xZ.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?sw(a[0],t.properties):g8(a,t.properties)}function EZ(e,r){r===void 0&&(r={});var t=y1(e);switch(!r.properties&&e.type==="Feature"&&(r.properties=e.properties),t.type){case"Polygon":return CZ(t,r);case"MultiPolygon":return SZ(t,r);default:throw new Error("invalid poly")}}function CZ(e,r){r===void 0&&(r={});var t=y1(e),n=t.coordinates,i=r.properties?r.properties:e.type==="Feature"?e.properties:{};return MP(n,i)}function SZ(e,r){r===void 0&&(r={});var t=y1(e),n=t.coordinates,i=r.properties?r.properties:e.type==="Feature"?e.properties:{},a=[];return n.forEach(function(o){a.push(MP(o,i))}),v8(a)}function MP(e,r){return e.length>1?m8(e,r):d8(e[0],r)}var l_=function(){function e(r){Kt(this,e),ne(this,"outSideEventTimer",null),ne(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=r.parent,this.mapService=r.mapService,this.rendererService=r.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return Qt(e,[{key:"createTile",value:function(t,n){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,n){var i={features:[],featureId:null,vectorTileLayer:null,source:null},a=n.sourceLayer,o=n.featureId,l=n.transforms,c=n.layerType,p=n.shape;if(!a)return i;var y=t.data.layers[a],b=y==null?void 0:y.features;if(Array.isArray(b)&&b.length>0){var w=[];c==="LineLayer"&&p==="simple"?b.map(function(O){if(O.geometry.type==="MultiPolygon"){var N,z=EZ(O).features;(N=w).push.apply(N,zn(z))}else O.geometry.type==="Polygon"&&(O.geometry.type="MultiLineString"),w.push(O)}):w=b;var M=new Mm({type:"FeatureCollection",features:w},{parser:{type:"geojson",featureId:o},transforms:l});return{features:w,featureId:o,vectorTileLayer:y,source:M}}else return i}},{key:"createLayer",value:function(t){var n=t.L7Layer,i=t.tile,a=t.initOptions,o=t.vectorTileLayer,l=t.source,c=a.mask,p=a.color,y=a.layerType,b=a.size,w=a.shape,M=n||iS,O=new M(tr({visible:i.isVisible,tileOrigin:o==null?void 0:o.l7TileOrigin,coord:o==null?void 0:o.l7TileCoord},this.getLayerInitOption(a)));O.isVector&&(this.emitEvent([O]),O.type=y,O.select(!0)),O.source(l),this.setScale(O),this.setStyleAttributeField(O,"shape",w),this.setStyleAttributeField(O,"color",p),this.setStyleAttributeField(O,"size",b);var N=[O];if(c&&O.isVector){var z=new vP().source({type:"FeatureCollection",features:[i.bboxPolygon]}).shape("fill");N.push(z),O.addMaskLayer(z)}return zw(this.parentLayer,N),this.layers=[O],O}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,n){switch(n){case"size":return 2;case"color":return"#fff";case"shape":return mP(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,n,i){if(Array.isArray(i)){t[n].apply(t,zn(i));return}if(typeof i=="string"){t[n](i);return}var a=this.getDefautStyleAttributeField(t,n);if(!i)return t[n](a),t;var o=this.parseScaleValue(i,n);o.length===0?t[n](a):t[n].apply(t,zn(o))}},{key:"parseScaleValue",value:function(t,n){if(n==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var i=t,a=i.field,o=i.values,l=i.callback;return a&&o&&Array.isArray(o)?[a,o]:a&&l?[a,l]:a?[a]:[]}},{key:"getTile",value:function(t,n){var i=this.mapService.getZoom(),a=Math.ceil(i)+this.zoomOffset,o=PC(t,n,a),l=this.tilesetManager.tiles.filter(function(p){return p.key==="".concat(o[0],",").concat(o[1],",").concat(a)}),c=l[0];return c}},{key:"emitEvent",value:function(t,n){var i=this;t.map(function(a){a.once("inited",function(){a.on("click",function(o){if(i.eventCache.click=1,i.parentLayer.type==="RasterLayer"){var l=o.lngLat,c=l.lng,p=l.lat,y=i.getTile(c,p);i.getFeatureAndEmitEvent(a,"subLayerClick",o,n,y)}else i.getFeatureAndEmitEvent(a,"subLayerClick",o)}),a.on("mousemove",function(o){if(i.eventCache.mousemove=1,i.parentLayer.type==="RasterLayer"){var l=o.lngLat,c=l.lng,p=l.lat,y=i.getTile(c,p);i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o,n,y)}else i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o)}),a.on("mouseup",function(o){i.eventCache.mouseup=1,i.getFeatureAndEmitEvent(a,"subLayerMouseUp",o)}),a.on("mouseenter",function(o){if(i.parentLayer.type==="RasterLayer"){var l=o.lngLat,c=l.lng,p=l.lat,y=i.getTile(c,p);i.getFeatureAndEmitEvent(a,"subLayerMouseMove",o,n,y)}else i.getFeatureAndEmitEvent(a,"subLayerMouseEnter",o)}),a.on("mouseout",function(o){i.getFeatureAndEmitEvent(a,"subLayerMouseOut",o)}),a.on("mousedown",function(o){i.eventCache.mousedown=1,i.getFeatureAndEmitEvent(a,"subLayerMouseDown",o)}),a.on("contextmenu",function(o){i.eventCache.contextmenu=1,i.getFeatureAndEmitEvent(a,"subLayerContextmenu",o)}),a.on("unclick",function(o){return i.handleOutsideEvent("click","subLayerUnClick",a,o)}),a.on("unmouseup",function(o){return i.handleOutsideEvent("mouseup","subLayerUnMouseUp",a,o)}),a.on("unmousedown",function(o){return i.handleOutsideEvent("mousedown","subLayerUnMouseDown",a,o)}),a.on("uncontextmenu",function(o){return i.handleOutsideEvent("contextmenu","subLayerUnContextmenu",a,o)})})})}},{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var o=sw(a.coordinates);n===null&&(n=o),n=bZ(n,o)}),i&&(n.properties=tr({},i)),n}},{key:"getFeatureAndEmitEvent",value:function(t,n,i,a,o){if(a===!1)i.value=EX(o,this.mapService,i.x,i.y);else{var l=i.featureId,c=this.getAllFeatures(l);try{i.feature=this.getCombineFeature(c)}catch{console.warn("Combine Featuer Err! Return First Feature!"),i.feature=c[0]}}this.parentLayer.emit(n,i)}},{key:"setScale",value:function(t){var n=this.parentLayer.tileLayer.scaleField,i=Object.keys(n);i.map(function(a){t.scale(a,n[a])})}},{key:"getAllFeatures",value:function(t){var n=this.parentLayer.tileLayer.children,i=[];return n.map(function(a){var o=a.getSource();o.data.dataArray.map(function(l){l._id===t&&i.push(l)})}),i}},{key:"getLayerInitOption",value:function(t){var n=tr({},t);return delete n.color,delete n.shape,delete n.size,delete n.coords,delete n.sourceLayer,delete n.coords,n}},{key:"handleOutsideEvent",value:function(t,n,i,a){var o=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){o.eventCache[t]>0?o.eventCache[t]=0:o.getFeatureAndEmitEvent(i,n,a)},64)}}]),e}();function wZ(e){var r=AZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function AZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var TZ=function(e){On(t,e);var r=wZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),l=o.features,c=o.vectorTileLayer,p=o.source;if(l.length===0)return{layers:[],layerIDList:[]};var y=this.createLayer({tile:i,initOptions:a,vectorTileLayer:c,source:p});return{layers:[y],layerIDList:[y.id]}}}]),t}(l_);function MZ(e){var r=IZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function IZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LZ=function(e){On(t,e);var r=MZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),l=o.features,c=o.vectorTileLayer,p=o.source;if(l.length===0)return{layers:[],layerIDList:[]};var y=this.createLayer({tile:i,initOptions:a,vectorTileLayer:c,source:p});return{layers:[y],layerIDList:[y.id]}}}]),t}(l_);function kZ(e){var r=RZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function RZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OZ=function(e){On(t,e);var r=kZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=this.getFeatureData(i,a),l=o.features,c=o.vectorTileLayer,p=o.source;if(l.length===0)return{layers:[],layerIDList:[]};var y=this.createLayer({tile:i,initOptions:a,vectorTileLayer:c,source:p});return{layers:[y],layerIDList:[y.id]}}}]),t}(l_);function PZ(e){var r=FZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function FZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var r3=function(e){On(t,e);var r=PZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=new Mm(i.data,{parser:{type:"image",extent:i.bounds}}),l=this.createLayer({L7Layer:cX,tile:i,initOptions:a,source:o});return{layers:[l],layerIDList:[l.id]}}}]),t}(l_);function DZ(e){var r=BZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function BZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NZ=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,zZ=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,UZ=function(e){On(t,e);var r=DZ(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.clampLow,c=l===void 0?!0:l,p=i.clampHigh,y=p===void 0?!0:p,b=i.noDataValue,w=b===void 0?-9999999:b,M=i.domain,O=M===void 0?[0,1]:M,N=i.rampColors;return Vr.exports.isEqual(this.rampColors,N)||(this.updateColorTexure(),this.rampColors=N),{u_opacity:o||1,u_texture:this.texture,u_domain:O,u_clampLow:c,u_clampHigh:typeof y<"u"?y:c,u_noDataValue:w,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=a.rampColorsData,b=a.rampColors,w=this.layer.getSource(),M=this.rendererService.createTexture2D,O=w.data.dataArray[0];this.texture=M({data:O.data,width:O.width,height:O.height,format:Q.LUMINANCE,type:Q.FLOAT});var N=y||Rg(b);this.colorTexture=M({data:N.data,width:N.width,height:N.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:zZ,fragmentShader:NZ,triangulation:Bw,primitive:Q.TRIANGLES,depth:{enable:!1},stencil:bs(l,p)}).then(function(z){i([z])}).catch(function(z){console.warn(z),i([])})}},{key:"buildModels",value:function(i){this.initModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[3],l[4]]}}})}},{key:"updateColorTexure",value:function(){var i=this.rendererService.createTexture2D,a=this.layer.getLayerConfig(),o=a.rampColors,l=Rg(o);this.colorTexture=i({data:l.data,width:l.width,height:l.height,flipY:!1})}}]),t}($o);function VZ(e){var r=GZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function GZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jZ=function(e){On(t,e);var r=VZ(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type",n.layerType),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new a(this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getModelType",value:function(){return UZ}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Gg);function HZ(e){var r=WZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function WZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $Z=function(e){On(t,e);var r=HZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=a.opacity,l=a.domain,c=a.clampHigh,p=a.clampLow,y=a.rampColors,b=a.rampColorsData,w=a.mask,M=i.data;if(!M.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var O=new jZ({visible:i.isVisible,mask:w}).source(M.data,{parser:{type:"raster",width:M.width,height:M.height,extent:i.bboxPolygon.bbox}}).style({opacity:o,domain:l,clampHigh:c,clampLow:p,rampColors:y,rampColorsData:b});return this.emitEvent([O],!1),zw(this.parentLayer,[O]),{layers:[O],layerIDList:[O.id]}}}]),t}(l_);function XZ(e){var r=ZZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function ZZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YZ=function(e){On(t,e);var r=XZ(t);function t(n){var i;return Kt(this,t),i=r.call(this,n),i.parentLayer=n.parent,i}return Qt(t,[{key:"createTile",value:function(i,a){var o=a.sourceLayer;if(!o)return{layers:[],layerIDList:[]};var l=i.data.layers[o],c=l==null?void 0:l.features;if(c.length===0)return{layers:[],layerIDList:[]};var p=c[0].properties,y=new iS({layerType:"PointLayer"}).source([p],{parser:{type:"json",x:"textLng",y:"textLat"}}).shape("key","text").size(20).color("#000").style({stroke:"#fff",strokeWidth:2}),b=new iS({layerType:"LineLayer"}).source({type:"FeatureCollection",features:c}).shape("simple").color("#000");return zw(this.parentLayer,[b,y]),{layers:[b,y],layerIDList:[b.id,y.id]}}}]),t}(l_);function qZ(e,r){switch(e){case"PolygonLayer":return OZ;case"LineLayer":return TZ;case"PointLayer":return LZ;case"TileDebugLayer":return YZ;case"RasterLayer":return r.dataType==="arraybuffer"?$Z:r3;default:return console.warn("Current Tile Not Exist!"),r3}}function KZ(e){var r=QZ();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function QZ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var JZ=function(e){On(t,e);var r=KZ(t);function t(){var n;return Kt(this,t),n=r.call(this),ne(vt(n),"checkConfigList",[]),n.cacheConfig=new Map,n}return Qt(t,[{key:"setConfig",value:function(i,a){this.checkConfigList.includes(i)||this.checkConfigList.push(i),this.cacheConfig.set(i,a)}},{key:"removeConfig",value:function(i){var a=this.checkConfigList.indexOf(i);a>-1&&(this.cacheConfig.delete(i),this.checkConfigList.splice(a,1))}},{key:"checkConfig",value:function(i){var a=this;if(!!i.inited){var o=i.getLayerConfig(),l=[];this.checkConfigList.map(function(c){var p=a.cacheConfig.get(c),y;if(["color","size","shape"].includes(c)){var b;y=(b=i.getAttribute(c))===null||b===void 0?void 0:b.scale}else{if(!(c in o))return;y=o[c]}Vr.exports.isEqual(p,y)||(l.push(c),a.setConfig(c,y))}),l.length>0&&(console.warn("tile config cache update!",l),this.emit("updateConfig",l))}}},{key:"getAttributeScale",value:function(i,a){var o=i.getAttribute(a),l={field:void 0,values:void 0,callback:void 0};if(o&&o.scale){var c=o.scale,p=c.field,y=c.values,b=c.callback;l.field=p,l.values=y,l.callback=b}return l}}]),t}(Sw);function eY(e){var r=tY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function tY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rY=function(e){On(t,e);var r=eY(t);function t(n,i,a,o,l){var c;return Kt(this,t),c=r.call(this),ne(vt(c),"isLastPicked",!1),c.parent=n,c.rendererService=i,c.pickingService=a,c.layerService=l,c.children=o,c}return Qt(t,[{key:"normalRender",value:function(i){var a=this;i.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).map(function(o){o.hooks.beforeRenderData.call(),o.hooks.beforeRender.call(),o.masks.length>0&&(a.rendererService.clear({stencil:0,depth:1,framebuffer:null}),o.masks.map(function(l){l.hooks.beforeRenderData.call(),l.hooks.beforeRender.call(),l.render(),l.hooks.afterRender.call()})),o.render(),o.hooks.afterRender.call()})}},{key:"pickRender",value:function(i,a){var o=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var l=i.filter(function(c){return o.parent.needPick(a.type)&&c.inited&&c.isVisible()}).some(function(c){c.hooks.beforePickingEncode.call(),c.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),c.masks.map(function(y){y.hooks.beforeRender.call(),y.render(),y.hooks.afterRender.call()})),c.renderModels(!0),c.hooks.afterPickingEncode.call();var p=o.pickingService.pickFromPickingFBO(c,a);return p&&o.parent.type!=="RasterLayer"&&(o.emit("pick",{type:a.type,pickedColors:o.pickingService.pickedColors,layer:c}),o.pickingService.pickedTileLayers=[o.parent]),p});return this.parent.type!=="RasterLayer"&&!l&&this.isLastPicked&&a.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=l,l}},{key:"clearPick",value:function(){this.children.filter(function(i){return i.inited&&i.isVisible()}).map(function(i){i.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(i){this.children.filter(function(a){return a.inited&&a.isVisible()}).map(function(a){a.hooks.beforeHighlight.call(i)})}},{key:"beforeSelect",value:function(i){this.children.filter(function(a){return a.inited&&a.isVisible()}).map(function(a){a.hooks.beforeSelect.call(i)})}},{key:"renderMask",value:function(i){i.inited&&i.isVisible()&&(i.hooks.beforeRender.call(),i.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),i.masks.map(function(a){a.hooks.beforeRender.call(),a.render(),a.hooks.afterRender.call()})),i.hooks.afterRender.call())}}]),t}(Zd.exports.EventEmitter),nY=function(){function e(r,t,n,i,a,o){Kt(this,e),this.parent=r,this.children=r.layerChildren,this.mapService=t,this.rendererService=n,this.transforms=o,this.tilePickManager=new rY(r,n,i,this.children,a),this.tileConfigManager=new JZ,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return Qt(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,n,i){t.map(function(a){n==="mask"?a.style({mask:i}):a.updateLayerConfig(ne({},n,i))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var n;(n=this.children).push.apply(n,zn(t))}},{key:"removeChilds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=[],a=[];this.children.filter(function(o){t.includes(o.id)?i.push(o):a.push(o)}),i.map(function(o){return o.destroy(n)}),this.children=a}},{key:"removeChild",value:function(t){var n=this.children.indexOf(t);n>-1&&this.children.splice(n,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(n){return t.includes(n.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(n){return n.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,n;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(n=this.tilePickManager)===null||n===void 0||n.normalRender(this.children)}},{key:"pickLayers",value:function(t){var n;return(n=this.tilePickManager)===null||n===void 0?void 0:n.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,n=this.parent.getLayerConfig(),i=n.zIndex,a=i===void 0?0:i,o=n.opacity,l=o===void 0?1:o,c=n.mask,p=c===void 0?!1:c,y=n.stroke,b=y===void 0?"#fff":y,w=n.strokeWidth,M=w===void 0?0:w,O=n.strokeOpacity,N=O===void 0?1:O,z=n.clampLow,j=z===void 0?!0:z,Y=n.clampHigh,K=Y===void 0?!0:Y,ie=n.domain,le=ie===void 0?[0,1]:ie,Se=n.rampColors,ze=Se===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:Se,ue=n.featureId,Ke=ue===void 0?"id":ue,ke=n.workerEnabled,Ce=ke===void 0?!1:ke,je=n.sourceLayer,ve=n.pixelConstant,Ie=ve===void 0?0:ve,dt=n.pixelConstantR,St=dt===void 0?256*256:dt,Rt=n.pixelConstantG,$t=Rt===void 0?256:Rt,gt=n.pixelConstantB,jr=gt===void 0?1:gt,Er=n.pixelConstantRGB,rn=Er===void 0?.1:Er,dn=this.tileConfigManager.getAttributeScale(this.parent,"color"),Rn=this.tileConfigManager.getAttributeScale(this.parent,"size"),Ar=this.parent.getSource(),xa=(Ar==null||(t=Ar.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Ti=xa.coords,Sa=Ar.getParserType(),hr=mP(this.parent.type,this.parent);ze&&(this.rampColorsData=Rg(ze)),this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:hr,zIndex:a,opacity:l,sourceLayer:this.getSourceLayer(Sa,je),coords:Ti,featureId:Ke,color:dn,size:Rn,mask:bX(this.parent.type,p),stroke:b,strokeWidth:M,strokeOpacity:N,clampLow:j,clampHigh:K,domain:le,rampColors:ze,rampColorsData:this.rampColorsData,workerEnabled:Ce,pixelConstant:Ie,pixelConstantR:St,pixelConstantG:$t,pixelConstantB:jr,pixelConstantRGB:rn}}},{key:"getSourceLayer",value:function(t,n){return t==="geojsonvt"?"geojsonvt":t==="testTile"?"testTile":n}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var n,i,a;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(n=this.parent.getAttribute("color"))===null||n===void 0?void 0:n.scale),this.tileConfigManager.setConfig("shape",(i=this.parent.getAttribute("shape"))===null||i===void 0?void 0:i.scale),this.tileConfigManager.setConfig("size",(a=this.parent.getAttribute("size"))===null||a===void 0?void 0:a.scale)}this.tileConfigManager.on("updateConfig",function(o){o.map(function(l){return t.updateStyle(l),""})})}},{key:"updateStyle",value:function(t){var n=this,i=null;if(["size","color","shape"].includes(t)){var a,o=(a=this.parent.getAttribute(t))===null||a===void 0?void 0:a.scale;if(!o)return;i=o,this.children.map(function(p){return n.tileFactory.setStyleAttributeField(p,t,o),""})}else{var l=this.parent.getLayerConfig();if(!(t in l))return;var c=l[t];i=c,this.updateLayersConfig(this.children,t,c),t==="rampColors"&&c&&(this.rampColorsData=Rg(c))}this.initOptions[t]=i}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),n=qZ(this.parent.type,t.parser);this.tileFactory=new n({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),iY=function(){function e(r){var t,n=r.parent,i=r.rendererService,a=r.mapService,o=r.layerService,l=r.pickingService,c=r.transforms;Kt(this,e),ne(this,"type","baseTile"),ne(this,"initedTileset",!1),ne(this,"pickColors",{select:null,active:null});var p=n.getSource(),y=(p==null||(t=p.data)===null||t===void 0?void 0:t.tilesetOptions)||{},b=y.sourceLayer;y.coords,y.featureId,this.sourceLayer=b,this.parent=n,this.mapService=a,this.layerService=o,this.tileLayerManager=new nY(n,a,i,l,o,c),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return Qt(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(n){return n.inited&&n.isVisible()}).filter(function(n){return n.getCurrentSelectedId()!==null}).map(function(n){t.selectFeature(n,new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(n){return n.isLoaded}).map(function(n){if(n.layerIDList.length===0){var i=t.tileLayerManager.createTile(n),a=i.layers,o=i.layerIDList;n.layerIDList=o,t.tileLayerManager.addChilds(a)}else{if(!n.isVisibleChange)return;var l=t.tileLayerManager.getChilds(n.layerIDList);t.tileLayerManager.updateLayersConfig(l,"visible",n.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var n=this;if(this.pickColors.select){var i=Nv(this.pickColors.select);t.map(function(o){n.selectFeature(o,n.pickColors.select),o.setCurrentSelectedId(i)})}if(this.pickColors.active){var a=Nv(this.pickColors.active);t.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(n.pickColors.active),o.setCurrentPickId(a)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(n){var i=Pi(n.pickedColors,3),a=i[0],o=i[1],l=i[2];if(n.type==="click"){var c=t.children.filter(function(p){return p.inited&&p.isVisible()&&p.isVector}).filter(function(p){return p!==n.layer});t.setSelect(c,[a,o,l])}else t.setHighlight([a,o,l])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var n=Nv(t);this.pickColors.active=t,this.children.filter(function(i){return i.inited&&i.isVisible()&&i.isVector}).filter(function(i){return i.getPickID()!==n}).map(function(i){i.setPickID(n),i.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,n){var i=this,a=Nv(n);t.map(function(l){l.getCurrentSelectedId()===null||a!==l.getCurrentSelectedId()?(i.selectFeature(l,n),l.setCurrentSelectedId(a),i.pickColors.select=n):(i.selectFeature(l,new Uint8Array([0,0,0,0])),l.setCurrentSelectedId(null),i.pickColors.select=null)});var o=this.layerService.getRenderList();o.filter(function(l){return l.inited&&!l.isVector&&l.isVisible()&&l.needPick("click")}).filter(function(l){return l.getCurrentSelectedId()!==null}).map(function(l){i.selectFeature(l,new Uint8Array([0,0,0,0])),l.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,n){var i=Pi(n,3),a=i[0],o=i[1],l=i[2];t.hooks.beforeSelect.call([a,o,l])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(n){t.parent.emit("click",tr({},n))}),this.parent.on("subLayerMouseMove",function(n){return t.parent.emit("mousemove",tr({},n))}),this.parent.on("subLayerMouseUp",function(n){return t.parent.emit("mouseup",tr({},n))}),this.parent.on("subLayerMouseEnter",function(n){return t.parent.emit("mouseenter",tr({},n))}),this.parent.on("subLayerMouseOut",function(n){return t.parent.emit("mouseout",tr({},n))}),this.parent.on("subLayerMouseDown",function(n){return t.parent.emit("mousedown",tr({},n))}),this.parent.on("subLayerContextmenu",function(n){return t.parent.emit("contextmenu",tr({},n))}),this.parent.on("subLayerUnClick",function(n){return t.parent.emit("unclick",tr({},n))}),this.parent.on("subLayerUnMouseMove",function(n){return t.parent.emit("unmousemove",tr({},n))}),this.parent.on("subLayerUnMouseUp",function(n){return t.parent.emit("unmouseup",tr({},n))}),this.parent.on("subLayerUnMouseDown",function(n){return t.parent.emit("unmousedown",tr({},n))}),this.parent.on("subLayerUnContextmenu",function(n){return t.parent.emit("uncontextmenu",tr({},n))})}},{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var i=this.getCurrentView(),a=i.latLonBounds,o=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,a)}},{key:"mapchange",value:function(){var t,n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;if(this.mapService.version==="GAODE1.x"){var o=this.parent.getLayerConfig(),l=o.visible;a<3&&l?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):a>=3&&!l&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===i.toString()||(this.lastViewStates={zoom:a,latLonBounds:i},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(a,i))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}}]),e}();function aY(e){var r=oY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function oY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sY=function(e){On(t,e);var r=aY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","TMS"),n}return Qt(t,[{key:"tileUnLoad",value:function(i){this.tileLayerManager.removeChilds(i.layerIDList,!1)}},{key:"tileUpdate",value:function(){var i=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(a){return a.isLoaded}).map(function(a){var o;if((o=a.data)!==null&&o!==void 0&&o.layers&&i.sourceLayer){var l=a.data.layers[i.sourceLayer],c=l==null?void 0:l.features;if(!(Array.isArray(c)&&c.length>0))return}if(a.parentLayerIDList.includes(i.parent.id)){if(!a.isVisibleChange)return;var M=i.tileLayerManager.getChilds(a.layerIDList);i.tileLayerManager.updateLayersConfig(M,"visible",a.isVisible),i.setPickState(M)}else{var p,y=i.tileLayerManager.createTile(a),b=y.layers,w=y.layerIDList;a.parentLayerIDList.push(i.parent.id),(p=a.layerIDList).push.apply(p,zn(w)),i.tileLayerManager.addChilds(b),i.setPickState(b)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(iY);function uY(e){var r=lY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function lY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Vw=function(e){On(t,e);var r=uY(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var i=this.layer.getSource();return i!=null&&i.data.isTile&&(this.layer.tileLayer=new sY({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:i.transforms})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}($o);function cY(e){var r=fY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function fY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hY=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,pY=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,dY=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,vY=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
     return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,mY=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,gY=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,yY={solid:0,dash:1},_Y=function(e){On(t,e);var r=cY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.lineType,w=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,N=i.forward,z=N===void 0?!0:N,j=i.lineTexture,Y=j===void 0?!1:j,K=i.iconStep,ie=K===void 0?100:K,le=i.segmentNumber,Se=le===void 0?30:le,ze=i.thetaOffset,ue=ze===void 0?.314:ze;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,thetaOffset:ue})){this.judgeStyleAttributes({opacity:o,thetaOffset:ue});var Ke=this.layer.getEncodedData(),ke=this.calDataFrame(this.cellLength,Ke,this.cellProperties),Ce=ke.data,je=ke.width,ve=ke.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&Ce.length>0?this.createTexture2D({flipY:!0,data:Ce,format:Q.LUMINANCE,type:Q.FLOAT,width:je,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}O.length===2&&O.push(0,0);var Ie=0,dt=[0,0,0,0],St=[0,0,0,0];return l&&c&&(dt=Lo(l),St=Lo(c),Ie=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Vr.exports.isNumber(ue)?ue:0,u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y==="normal"?0:1,segmentNumber:Se,u_line_type:yY[w||"solid"],u_dash_array:O,u_blur:.9,u_lineDir:z?1:-1,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ie,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ie,u_sourceColor:dt,u_targetColor:St}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:hY,vert:pY,type:"Dash"}:a&&o?{frag:mY,vert:gY,type:"Linear"}:{frag:dY,vert:vY,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,l=o===void 0?30:o,c=a.mask,p=c===void 0?!1:c,y=a.maskInside,b=y===void 0?!0:y,w=this.getShaders(),M=w.frag,O=w.vert,N=w.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+N,vertexShader:O,fragmentShader:M,triangulation:f2,depth:{enable:!1},blend:this.getBlend(),segmentNumber:l,stencil:bs(p,b)}).then(function(z){i([z])}).catch(function(z){console.warn(z),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(o,l,c,p){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function xY(e){var r=bY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function bY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,CY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,SY=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,wY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,AY={solid:0,dash:1},TY=function(e){On(t,e);var r=xY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.lineType,w=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,N=i.lineTexture,z=N===void 0?!1:N,j=i.iconStep,Y=j===void 0?100:j,K=i.segmentNumber,ie=K===void 0?30:K,le=i.globalArcHeight,Se=le===void 0?10:le;O.length===2&&O.push(0,0);var ze=0,ue=[0,0,0,0],Ke=[0,0,0,0];if(l&&c&&(ue=Lo(l),Ke=Lo(c),ze=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var ke=this.layer.getEncodedData(),Ce=this.calDataFrame(this.cellLength,ke,this.cellProperties),je=Ce.data,ve=Ce.width,Ie=Ce.height;this.rowCount=Ie,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:Q.LUMINANCE,type:Q.FLOAT,width:ve,height:Ie}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Dw,u_global_height:Se,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y==="normal"?0:1,segmentNumber:ie,u_line_type:AY[w]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ze,u_sourceColor:ue,u_targetColor:Ke}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:SY,vert:wY,type:"Linear"}:{frag:EY,vert:CY,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,l=o===void 0?30:o,c=a.mask,p=c===void 0?!1:c,y=a.maskInside,b=y===void 0?!0:y,w=this.getShaders(),M=w.frag,O=w.vert,N=w.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+N,vertexShader:O,fragmentShader:M,triangulation:f2,blend:this.getBlend(),segmentNumber:l,stencil:bs(p,b)}).then(function(z){i([z])}).catch(function(z){console.warn(z),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(o,l,c,p){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function MY(e){var r=IY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function IY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var LY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,kY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,RY=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,OY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,PY={solid:0,dash:1},FY=function(e){On(t,e);var r=MY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.lineType,w=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,N=i.lineTexture,z=N===void 0?!1:N,j=i.iconStep,Y=j===void 0?100:j,K=i.segmentNumber,ie=K===void 0?30:K,le=i.globalArcHeight,Se=le===void 0?10:le;O.length===2&&O.push(0,0);var ze=0,ue=[0,0,0,0],Ke=[0,0,0,0];if(l&&c&&(ue=Lo(l),Ke=Lo(c),ze=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var ke=this.layer.getEncodedData(),Ce=this.calDataFrame(this.cellLength,ke,this.cellProperties),je=Ce.data,ve=Ce.width,Ie=Ce.height;this.rowCount=Ie,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:Q.LUMINANCE,type:Q.FLOAT,width:ve,height:Ie}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:Dw,u_global_height:Se,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y==="normal"?0:1,segmentNumber:ie,u_line_type:PY[w]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ze,u_sourceColor:ue,u_targetColor:Ke}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:RY,vert:OY,type:"Linear"}:{frag:LY,vert:kY,type:""}}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.segmentNumber,l=o===void 0?30:o,c=a.mask,p=c===void 0?!1:c,y=a.maskInside,b=y===void 0?!0:y,w=this.getShaders(),M=w.frag,O=w.vert,N=w.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+N,vertexShader:O,fragmentShader:M,triangulation:f2,depth:{enable:!0},blend:this.getBlend(),segmentNumber:l,stencil:bs(p,b)}).then(function(z){i([z])}).catch(function(z){console.warn(z),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(o,l,c,p){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function DY(e){var r=BY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function BY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var NY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,zY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,UY={solid:0,dash:1},VY=function(e){On(t,e);var r=DY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.lineType,w=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5]:M,N=i.lineTexture,z=N===void 0?!1:N,j=i.iconStep,Y=j===void 0?100:j,K=i.segmentNumber,ie=K===void 0?30:K;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var le=0,Se=[0,0,0,0],ze=[0,0,0,0];if(l&&c&&(Se=Lo(l),ze=Lo(c),le=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var ue=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,ue,this.cellProperties),ke=Ke.data,Ce=Ke.width,je=Ke.height;this.rowCount=je,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:Q.LUMINANCE,type:Q.FLOAT,width:Ce,height:je}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y==="normal"?0:1,segmentNumber:ie,u_line_type:UY[w]||0,u_dash_array:O,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:le,u_sourceColor:Se,u_targetColor:ze}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:zY,fragmentShader:NY,triangulation:f2,depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:_n.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(o,l,c,p){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function GY(e){var r=jY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function jY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HY=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,WY=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,$Y=function(e){On(t,e);var r=GY(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.arrow,y=p===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:p,b=0,w=[0,0,0,0],M=[0,0,0,0];if(l&&c&&(w=Lo(l),M=Lo(c),b=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var O=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,O,this.cellProperties),z=N.data,j=N.width,Y=N.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&z.length>0?this.createTexture2D({flipY:!0,data:z,format:Q.LUMINANCE,type:Q.FLOAT,width:j,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_linearColor:b,u_sourceColor:w,u_targetColor:M,u_arrow:Number(y.enable),u_arrowHeight:y.arrowHeight||3,u_arrowWidth:y.arrowWidth||2,u_tailWidth:y.tailWidth===void 0?1:y.tailWidth}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=eo(Xn.mark(function a(o){var l,c,p,y,b,w,M,O,N,z;return Xn.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:l=this.layer.getLayerConfig(),c=l.mask,p=c===void 0?!1:c,y=l.maskInside,b=y===void 0?!0:y,w=l.depth,M=w===void 0?!1:w,O=this.getShaders(),N=O.frag,z=O.vert,this.layer.triangulation=Bg,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:z,fragmentShader:N,triangulation:Bg,depth:{enable:M},blend:this.getBlend(),stencil:bs(p,b)}).then(function(K){o([K])}).catch(function(K){console.warn(K),o([])});case 4:case"end":return Y.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:HY,vert:WY,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c,p,y){return y===void 0?[l[3],10,l[5]]:[l[3],y,l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:_n.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(a,o,l,c){var p=a.coordinates[0]||[0,0],y=a.coordinates[3]||[0,0];return[p[0],p[1],y[0],y[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){var p=a.size,y=p===void 0?1:p;return Array.isArray(y)?[y[0],y[1]]:[y,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){return[l[4]]}}})}}]),t}($o);function XY(e){var r=ZY();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function ZY(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var YY=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,qY=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,KY=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,n3=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,QY=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,JY={solid:0,dash:1},IP=function(e){On(t,e);var r=XY(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.lineType,w=b===void 0?"solid":b,M=i.dashArray,O=M===void 0?[10,5,0,0]:M,N=i.lineTexture,z=N===void 0?!1:N,j=i.iconStep,Y=j===void 0?100:j,K=i.vertexHeightScale,ie=K===void 0?20:K,le=i.borderWidth,Se=le===void 0?0:le,ze=i.borderColor,ue=ze===void 0?"#ccc":ze,Ke=i.raisingHeight,ke=Ke===void 0?0:Ke,Ce=i.heightfixed,je=Ce===void 0?!1:Ce,ve=i.linearDir,Ie=ve===void 0?qy.VERTICAL:ve,dt=i.blur,St=dt===void 0?[1,1,1]:dt,Rt=i.arrow,$t=Rt===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Rt;O.length===2&&O.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gt=0,jr=[0,0,0,0],Er=[0,0,0,0];if(l&&c&&(jr=Lo(l),Er=Lo(c),gt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var rn=this.layer.getEncodedData(),dn=this.calDataFrame(this.cellLength,rn,this.cellProperties),Rn=dn.data,Ar=dn.width,xa=dn.height;this.rowCount=xa,this.dataTexture=this.cellLength>0&&Rn.length>0?this.createTexture2D({flipY:!0,data:Rn,format:Q.LUMINANCE,type:Q.FLOAT,width:Ar,height:xa}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y===rS.NORMAL?0:1,u_line_type:JY[w],u_dash_array:O,u_blur:St,u_texture:this.texture,u_line_texture:z?1:0,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Se,u_borderColor:Lo(ue),u_linearDir:Ie===qy.VERTICAL?1:0,u_linearColor:gt,u_sourceColor:jr,u_targetColor:Er,u_heightfixed:Number(je),u_vertexScale:ie,u_raisingHeight:Number(ke),u_arrow:Number($t.enable),u_arrowHeight:$t.arrowHeight||3,u_arrowWidth:$t.arrowWidth||2,u_tailWidth:$t.tailWidth===void 0?1:$t.tailWidth}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=a.depth,b=y===void 0?!1:y,w=a.workerEnabled,M=w===void 0?!1:w,O=a.enablePicking,N=this.getShaders(),z=N.frag,j=N.vert,Y=N.type;this.layer.triangulation=kC,this.layer.buildLayerModel({moduleName:"line"+Y,vertexShader:j,fragmentShader:z,triangulation:kC,depth:{enable:b},blend:this.getBlend(),stencil:bs(l,p),workerEnabled:M,workerOptions:{modelType:"line"+Y,enablePicking:O,iconMap:this.iconService.getIconMap()}}).then(function(K){i([K])}).catch(function(K){console.warn(K),i([])})}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:YY,vert:qY,type:"Dash"}:a&&o?{frag:QY,vert:n3,type:"Linear"}:{frag:KY,vert:n3,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p,y,b){return b===void 0?[c[3],10]:[c[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function eq(e){var r=tq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function tq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rq=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,nq=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,iq=function(e){On(t,e);var r=eq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var c=n.layer.getLayerConfig(),p=c.rampColors,y=Rg(p);n.colorTexture=l({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE,min:Q.NEAREST,mag:Q.NEAREST,flipY:!1})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.vertexHeightScale,c=l===void 0?20:l,p=i.raisingHeight,y=p===void 0?0:p,b=i.heightfixed,w=b===void 0?!1:b,M=i.linearDir,O=M===void 0?qy.VERTICAL:M;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var N=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,N,this.cellProperties),j=z.data,Y=z.width,K=z.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:Q.LUMINANCE,type:Q.FLOAT,width:Y,height:K}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:O===qy.VERTICAL?1:0,u_opacity:Vr.exports.isNumber(o)?o:1,u_texture:this.colorTexture,u_heightfixed:Number(w),u_vertexScale:c,u_raisingHeight:Number(y)}}},{key:"initModels",value:function(i){this.updateTexture(),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.colorTexture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=a.depth,b=y===void 0?!1:y;this.layer.triangulation=Bg,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:nq,fragmentShader:rq,triangulation:Bg,depth:{enable:b},blend:this.getBlend(),stencil:bs(l,p)}).then(function(w){i([w])}).catch(function(w){console.warn(w),i([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:_n.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c,p,y){return y===void 0?[l[3],10]:[l[3],y]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){var p=a.size,y=p===void 0?1:p;return Array.isArray(y)?[y[0],y[1]]:[y,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){return[l[4]]}}})}}]),t}($o);function aq(e){var r=oq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function oq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sq=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,uq=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,lq=function(e){On(t,e);var r=aq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.NEAREST,min:Q.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,y=p===void 0?"normal":p,b=i.heightfixed,w=b===void 0?!1:b,M=i.lineTexture,O=M===void 0?!1:M,N=i.iconStep,z=N===void 0?100:N,j=i.iconStepCount,Y=j===void 0?1:j;this.rendererService.getDirty()&&this.texture.bind();var K=0,ie=[0,0,0,0],le=[0,0,0,0];if(l&&c&&(ie=Lo(l),le=Lo(c),K=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var Se=this.layer.getEncodedData(),ze=this.calDataFrame(this.cellLength,Se,this.cellProperties),ue=ze.data,Ke=ze.width,ke=ze.height;this.rowCount=ke,this.dataTexture=this.cellLength>0&&ue.length>0?this.createTexture2D({flipY:!0,data:ue,format:Q.LUMINANCE,type:Q.FLOAT,width:Ke,height:ke}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_textureBlend:y==="normal"?0:1,u_texture:this.texture,u_line_texture:O?1:0,u_iconStepCount:Y,u_icon_step:z,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:K,u_sourceColor:ie,u_targetColor:le}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_aimate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:uq,fragmentShader:sq,triangulation:Bg,depth:{enable:!1},blend:this.getBlend()}).then(function(a){i([a])}).catch(function(a){console.warn(a),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:_n.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:_n.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=o.size,b=y===void 0?1:y;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:_n.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.texture,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o),cq={arc:_Y,arc3d:TY,greatcircle:VY,wall:lq,line:IP,halfLine:$Y,simple:gP,linearline:iq,vectorline:Vw,tileLine:nS,earthArc3d:FY};const fq=cq;function hq(e){var r=pq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function pq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var eb=function(e){On(t,e);var r=hq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","LineLayer"),ne(vt(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new fq[a](this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.layerSource.getParserType();if(Nw(a))return"vectorline";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),l=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return l||"line"}}]),t}(Gg);function dq(e){var r=vq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function vq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mq=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,gq=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,yq=function(e){On(t,e);var r=dq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"raiseCount",0),ne(vt(n),"raiserepeat",0),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,p=i.sourceColor,y=i.targetColor,b=i.pickLight,w=b===void 0?!1:b,M=i.heightfixed,O=M===void 0?!1:M,N=i.opacityLinear,z=N===void 0?{enable:!1,dir:"up"}:N,j=i.lightEnable,Y=j===void 0?!0:j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var K=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,K,this.cellProperties),le=ie.data,Se=ie.width,ze=ie.height;this.rowCount=ze,this.dataTexture=this.cellLength>0&&le.length>0?this.createTexture2D({flipY:!0,data:le,format:Q.LUMINANCE,type:Q.FLOAT,width:Se,height:ze}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}var ue=0,Ke=[0,0,0,0],ke=[0,0,0,0];if(p&&y&&(Ke=Lo(p),ke=Lo(y),ue=1),this.raiseCount<1&&this.raiserepeat>0&&o.enable){var Ce=o.speed,je=Ce===void 0?.01:Ce;o.repeat,this.raiseCount+=je,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(w),u_heightfixed:Number(O),u_r:o.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(c)?c:1,u_linearColor:ue,u_sourceColor:Ke,u_targetColor:ke,u_opacitylinear:Number(z.enable),u_opacitylinear_dir:z.dir==="up"?1:0,u_lightEnable:Number(Y)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.animateOption.repeat,l=o===void 0?1:o;this.raiserepeat=l,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:gq,fragmentShader:mq,triangulation:dP,depth:{enable:!0},cull:{enable:!0,face:n2(this.mapService.version)},blend:this.getBlend()}).then(function(c){i([c])}).catch(function(c){console.warn(c),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c){var p=a.size;if(p){var y=[];return Array.isArray(p)&&(y=p.length===2?[p[0],p[0],p[1]]:p),Array.isArray(p)||(y=[p,p,p]),y}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o){var l=cd(a.coordinates);return hP([l[0],l[1]])}}})}}]),t}($o);function _q(e){var r=xq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function xq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var bq=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Eq=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,Cq=function(e){On(t,e);var r=_q(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.strokeOpacity,c=l===void 0?1:l,p=i.strokeWidth,y=p===void 0?0:p,b=i.stroke,w=b===void 0?"rgba(0,0,0,0)":b,M=i.offsets,O=M===void 0?[0,0]:M,N=i.blend,z=i.blur,j=z===void 0?0:z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O})){this.judgeStyleAttributes({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O});var Y=this.layer.getEncodedData(),K=this.calDataFrame(this.cellLength,Y,this.cellProperties),ie=K.data,le=K.width,Se=K.height;this.rowCount=Se,this.dataTexture=this.cellLength>0&&ie.length>0?this.createTexture2D({flipY:!0,data:ie,format:Q.LUMINANCE,type:Q.FLOAT,width:le,height:Se}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_blur:j,u_additive:N==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_stroke_opacity:Vr.exports.isNumber(c)?c:1,u_stroke_width:Vr.exports.isNumber(y)?y:1,u_stroke_color:this.getStrokeColor(w),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){this.layer.triangulation=BI,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:Eq,fragmentShader:bq,triangulation:BI,depth:{enable:!0},blend:this.getBlend()}).then(function(a){i([a])}).catch(function(a){console.warn(a),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p){var y=Pi(c,3),b=y[0],w=y[1],M=y[2],O=Lc(0,0,1),N=Lc(b,0,M),z=b>=0?IC(O,N):Math.PI*2-IC(O,N),j=Math.PI*2-Math.asin(w/100),Y=kp();t2(Y,Y,z),Y1(Y,Y,j);var K=Lc(1,1,0);Z_(K,K,Y),Ry(K,K);var ie=Lc(-1,1,0);Z_(ie,ie,Y),Ry(ie,ie);var le=Lc(-1,-1,0);Z_(le,le,Y),Ry(le,le);var Se=Lc(1,-1,0);Z_(Se,Se,Y),Ry(Se,Se);var ze=[].concat(zn(K),zn(ie),zn(le),zn(Se)),ue=p%4*3;return[ze[ue],ze[ue+1],ze[ue+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.shape,b=y===void 0?2:y,w=i.layer.getLayerConfig().shape2d,M=w.indexOf(b);return[M]}}})}}]),t}($o);function Sq(e){var r=wq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function wq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Aq=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Tq=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,LP=function(e){On(t,e);var r=Sq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"raiseCount",0),ne(vt(n),"raiserepeat",0),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,p=i.sourceColor,y=i.targetColor,b=i.pickLight,w=b===void 0?!1:b,M=i.heightfixed,O=M===void 0?!1:M,N=i.opacityLinear,z=N===void 0?{enable:!1,dir:"up"}:N,j=i.lightEnable,Y=j===void 0?!0:j;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var K=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,K,this.cellProperties),le=ie.data,Se=ie.width,ze=ie.height;this.rowCount=ze,this.dataTexture=this.cellLength>0&&le.length>0?this.createTexture2D({flipY:!0,data:le,format:Q.LUMINANCE,type:Q.FLOAT,width:Se,height:ze}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}var ue=0,Ke=[0,0,0,0],ke=[0,0,0,0];if(p&&y&&(Ke=Lo(p),ke=Lo(y),ue=1),this.raiseCount<1&&this.raiserepeat>0&&o.enable){var Ce=o.speed,je=Ce===void 0?.01:Ce;o.repeat,this.raiseCount+=je,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(w),u_heightfixed:Number(O),u_r:o.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(c)?c:1,u_linearColor:ue,u_sourceColor:Ke,u_targetColor:ke,u_opacitylinear:Number(z.enable),u_opacitylinear_dir:z.dir==="up"?1:0,u_lightEnable:Number(Y)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(){var n=eo(Xn.mark(function a(o){var l,c,p,y,b;return Xn.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:l=this.layer.getLayerConfig(),c=l.depth,p=c===void 0?!0:c,y=l.animateOption.repeat,b=y===void 0?1:y,this.raiserepeat=b,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:Tq,fragmentShader:Aq,triangulation:dP,blend:this.getBlend(),cull:{enable:!0,face:n2(this.mapService.version)},depth:{enable:p}}).then(function(O){o([O])}).catch(function(O){console.warn(O),o([])});case 3:case"end":return M.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c){var p=a.size;if(p){var y=[];return Array.isArray(p)&&(y=p.length===2?[p[0],p[0],p[1]]:p),Array.isArray(p)||(y=[p,p,p]),y}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:_n.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(a,o){var l=cd(a.coordinates);return[l[0],l[1],0]}}})}}]),t}($o);function Mq(e){var r=Iq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Iq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var i3=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Lq=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,NE=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,kP=function(e){On(t,e);var r=Mq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"meter2coord",1),ne(vt(n),"meteryScale",1),ne(vt(n),"isMeter",!1),ne(vt(n),"unit","l7size"),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.strokeOpacity,c=l===void 0?1:l,p=i.strokeWidth,y=p===void 0?0:p,b=i.stroke,w=b===void 0?"rgba(0,0,0,0)":b,M=i.offsets,O=M===void 0?[0,0]:M,N=i.blend,z=i.blur,j=z===void 0?0:z,Y=i.raisingHeight,K=Y===void 0?0:Y,ie=i.heightfixed,le=ie===void 0?!1:ie,Se=i.unit,ze=Se===void 0?"l7size":Se;if(this.updateUnit(ze),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O})){this.judgeStyleAttributes({opacity:o,strokeOpacity:c,strokeWidth:y,stroke:w,offsets:O});var ue=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,ue,this.cellProperties),ke=Ke.data,Ce=Ke.width,je=Ke.height;this.rowCount=je,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:Q.LUMINANCE,type:Q.FLOAT,width:Ce,height:je}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(K),u_heightfixed:Number(le),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:j,u_additive:N==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_stroke_opacity:Vr.exports.isNumber(c)?c:1,u_stroke_width:Vr.exports.isNumber(y)?y:1,u_stroke_color:this.getStrokeColor(w),u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Yx)}},{key:"initModels",value:function(i){this.updateUnit("l7size"),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=Pi(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3],p=[(a+l)/2,(o+c)/2],y=this.mapService.version,b=Ho==null?void 0:Ho.mapboxgl;if(y===vu.MAPBOX&&b!==null&&b!==void 0&&b.MercatorCoordinate){var w=b.MercatorCoordinate.fromLngLat({lng:p[0],lat:p[1]},0),M=w.meterInMercatorCoordinateUnits(),O=new b.MercatorCoordinate(w.x-M,w.y,w.z),N=O.toLngLat(),z=new b.MercatorCoordinate(w.x,w.y-M,w.z),j=z.toLngLat();this.meter2coord=p[0]-N.lng,this.meteryScale=(j.lat-p[1])/this.meter2coord;return}var Y=this.mapService.meterToCoord(p,[a,o]),K=this.mapService.meterToCoord(p,[l===a?l+.1:l,c===o?o+.1:c]);this.meter2coord=(Y+K)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=eo(Xn.mark(function a(o){var l,c,p,y,b,w,M,O,N,z,j,Y,K,ie,le;return Xn.wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:l=this.layer.getLayerConfig(),c=l.mask,p=c===void 0?!1:c,y=l.maskInside,b=y===void 0?!0:y,w=l.animateOption,M=w===void 0?{enable:!1}:w,O=l.workerEnabled,N=O===void 0?!1:O,z=l.enablePicking,j=l.shape2d,Y=this.getShaders(M),K=Y.frag,ie=Y.vert,le=Y.type,this.layer.triangulation=Yx,this.layer.buildLayerModel({moduleName:le,vertexShader:ie,fragmentShader:K,triangulation:Yx,depth:{enable:!1},blend:this.getBlend(),stencil:bs(p,b),workerEnabled:N,workerOptions:{modelType:le,enablePicking:z,shape2d:j}}).then(function(ue){o([ue])}).catch(function(ue){console.warn(ue),o([])});case 4:case"end":return ze.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:i3,vert:NE,type:"pointWave"};default:return{frag:i3,vert:NE,type:"pointWave"}}else return{frag:Lq,vert:NE,type:"pointFill"}}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.shape,b=y===void 0?2:y,w=i.indexOf(b);return[w]}}})}},{key:"updateUnit",value:function(i){var a=this.mapService.version;this.unit!==i&&(this.unit!=="meter"&&i==="meter"&&a!==vu.L7MAP&&a!==vu.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&i!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=i)}}]),t}($o);function kq(e){var r=Rq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Rq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Oq=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Pq=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Fq=function(e){On(t,e);var r=kq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"meter2coord",1),ne(vt(n),"isMeter",!1),ne(vt(n),"radian",0),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.LINEAR,min:Q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,p=i.rotation,y=i.raisingHeight,b=y===void 0?0:y,w=i.heightfixed,M=w===void 0?!1:w;this.rendererService.getDirty()&&this.texture.bind();var O=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(O=-1),this.radian=p!==void 0?O*Math.PI*p/180:O*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:c})){this.judgeStyleAttributes({opacity:o,offsets:c});var N=this.layer.getEncodedData(),z=this.calDataFrame(this.cellLength,N,this.cellProperties),j=z.data,Y=z.width,K=z.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&j.length>0?this.createTexture2D({flipY:!0,data:j,format:Q.LUMINANCE,type:Q.FLOAT,width:Y,height:K}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(b),u_heightfixed:Number(M),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Vr.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(c)?c:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(i){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),o=a.unit,l=o===void 0?"l7size":o,c=this.mapService.version;l==="meter"&&c!==vu.L7MAP&&c!==vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=Pi(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3],p=[(a+l)/2,(o+c)/2],y=this.mapService.version;if(y===vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var b=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:p[0],lat:p[1]},0),w=1,M=w*b.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(b.x-M,b.y,b.z),N=O.toLngLat();this.meter2coord=p[0]-N.lng;return}var z=this.mapService.meterToCoord(p,[a,o]),j=this.mapService.meterToCoord(p,[l===a?l+.1:l,c===o?o+.1:c]);this.meter2coord=(z+j)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:Pq,fragmentShader:Oq,triangulation:Lg,depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p),cull:{enable:!0,face:n2(this.mapService.version)}}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i,a;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:_n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.rotate,b=y===void 0?0:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.shape,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]*i.meter2coord]:[b*i.meter2coord]}}})}}]),t}($o);function Dq(e){var r=Bq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Bq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Nq=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,zq=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,RP=function(e){On(t,e);var r=Dq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Q.LINEAR,min:Q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,p=i.raisingHeight,y=p===void 0?0:p,b=i.heightfixed,w=b===void 0?!1:b;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:c})){this.judgeStyleAttributes({opacity:o,offsets:c});var M=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,M,this.cellProperties),N=O.data,z=O.width,j=O.height;this.rowCount=j,this.dataTexture=this.cellLength>0&&N.length>0?this.createTexture2D({flipY:!0,data:N,format:Q.LUMINANCE,type:Q.FLOAT,width:z,height:j}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(y),u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Vr.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(c)?c:[0,0]}}},{key:"initModels",value:function(i){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(i)}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:zq,fragmentShader:Nq,triangulation:j$,depth:{enable:!1},primitive:Q.POINTS,blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:_n.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(o,l,c,p){var y=i.iconService.getIconMap(),b=o.shape,w=y[b]||{x:0,y:0},M=w.x,O=w.y;return[M,O]}}})}}]),t}($o);function Uq(e){var r=Vq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Vq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Gq=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,jq=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function a3(e){var r=e.coordinates;return{vertices:zn(r),indices:[0],size:r.length}}var OP=function(e){On(t,e);var r=Uq(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:c})){this.judgeStyleAttributes({opacity:o,offsets:c});var p=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,p,this.cellProperties),b=y.data,w=y.width,M=y.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:Q.LUMINANCE,type:Q.FLOAT,width:w,height:M}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(c)?c:[0,0]}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.triangulation=a3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:jq,fragmentShader:Gq,triangulation:a3,depth:{enable:!1},primitive:Q.POINTS,blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.size,y=p===void 0?1:p;return Array.isArray(y)?[y[0]]:[y]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ip.additive}}}]),t}($o);function Hq(e){var r=Wq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function Wq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $q=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,Xq=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Zq=function(e){On(t,e);var r=Hq(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"meter2coord",1),ne(vt(n),"isMeter",!1),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,p=i.blend,y=i.speed,b=y===void 0?1:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:c})){this.judgeStyleAttributes({opacity:o,offsets:c});var w=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,w,this.cellProperties),O=M.data,N=M.width,z=M.height;this.rowCount=z,this.dataTexture=this.cellLength>0&&O.length>0?this.createTexture2D({flipY:!0,data:O,format:Q.LUMINANCE,type:Q.FLOAT,width:N,height:z}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:b,u_additive:p==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(c)?c:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Lg)}},{key:"initModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.unit,l=o===void 0?"l7size":o,c=this.mapService.version;l==="meter"&&c!==vu.L7MAP&&c!==vu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(i)}},{key:"calMeter2Coord",value:function(){var i=Pi(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3],p=[(a+l)/2,(o+c)/2],y=this.mapService.version;if(y===vu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var b=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:p[0],lat:p[1]},0),w=1,M=w*b.meterInMercatorCoordinateUnits(),O=new window.mapboxgl.MercatorCoordinate(b.x-M,b.y,b.z),N=O.toLngLat();this.meter2coord=p[0]-N.lng;return}var z=this.mapService.meterToCoord(p,[a,o]),j=this.mapService.meterToCoord(p,[l===a?l+.1:l,c===o?o+.1:c]);this.meter2coord=(z+j)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:Xq,fragmentShader:$q,triangulation:Lg,depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_n.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(o,l,c,p){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=p%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.size,b=y===void 0?5:y;return Array.isArray(b)?[b[0]*i.meter2coord]:[b*i.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_n.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(o,l,c,p){var y=o.shape,b=y===void 0?2:y,w=i.layer.getLayerConfig().shape2d,M=w.indexOf(b);return[M]}}})}}]),t}($o);function Yq(e){var r=qq();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function qq(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kq=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,Qq=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function o3(e){var r=e.coordinates;return{vertices:zn(r),indices:[0],size:r.length}}var Jq=function(e){On(t,e);var r=Yq(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,p=i.blend,y=i.strokeOpacity,b=y===void 0?1:y,w=i.strokeWidth,M=w===void 0?0:w,O=i.stroke,N=O===void 0?"#fff":O;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,offsets:c})){this.judgeStyleAttributes({opacity:o,offsets:c});var z=this.layer.getEncodedData(),j=this.calDataFrame(this.cellLength,z,this.cellProperties),Y=j.data,K=j.width,ie=j.height;this.rowCount=ie,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:Q.LUMINANCE,type:Q.FLOAT,width:K,height:ie}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_additive:p==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1,u_offsets:this.isOffsetStatic(c)?c:[0,0],u_stroke_opacity:Vr.exports.isNumber(b)?b:1,u_stroke_width:Vr.exports.isNumber(M)?M:1,u_stroke_color:this.getStrokeColor(N)}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.triangulation=o3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:Qq,fragmentShader:Kq,triangulation:o3,depth:{enable:!1},primitive:Q.POINTS,blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.size,y=p===void 0?1:p;return Array.isArray(y)?[y[0]]:[y]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ip.additive}}}]),t}($o);function eK(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tK(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function tK(e,r){if(!!e){if(typeof e=="string")return s3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return s3(e,r)}}function s3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function rK(e){var r=nK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function nK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var u3=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,l3=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function c3(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,c){n.push.apply(n,zn(o).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],zn(o),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],zn(o),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],zn(o),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var PP=function(e){On(t,e);var r=rK(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"glyphInfoMap",{}),ne(vt(n),"currentZoom",-1),ne(vt(n),"textureHeight",0),ne(vt(n),"textCount",0),ne(vt(n),"preTextStyle",{}),ne(vt(n),"buildModels",function(){var l=eo(Xn.mark(function c(p){var y,b,w,M,O;return Xn.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:y=n.layer.getLayerConfig(),b=y.mask,w=b===void 0?!1:b,M=y.maskInside,O=M===void 0?!0:M,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:l3,fragmentShader:u3,triangulation:c3.bind(vt(n)),depth:{enable:!1},blend:n.getBlend(),stencil:bs(w,O)}).then(function(j){p([j])}).catch(function(j){console.warn(j),p([])});case 3:case"end":return z.stop()}},c)}));return function(c){return l.apply(this,arguments)}}()),ne(vt(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.stroke,c=l===void 0?"#fff":l,p=i.strokeWidth,y=p===void 0?0:p,b=i.textAnchor,w=b===void 0?"center":b,M=i.textAllowOverlap,O=M===void 0?!1:M,N=i.halo,z=N===void 0?.5:N,j=i.gamma,Y=j===void 0?2:j,K=i.raisingHeight,ie=K===void 0?0:K,le=this.fontService,Se=le.canvas,ze=le.mapping;if(Object.keys(ze).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(ze).length),this.preTextStyle={textAnchor:w,textAllowOverlap:O},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o,strokeWidth:y,stroke:c})){this.judgeStyleAttributes({opacity:o,strokeWidth:y,stroke:c});var ue=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,ue,this.cellProperties),ke=Ke.data,Ce=Ke.width,je=Ke.height;this.rowCount=je,this.dataTexture=this.cellLength>0&&ke.length>0?this.createTexture2D({flipY:!0,data:ke,format:Q.LUMINANCE,type:Q.FLOAT,width:Ce,height:je}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(ie),u_opacity:Vr.exports.isNumber(o)?o:1,u_stroke_width:Vr.exports.isNumber(y)?y:1,u_stroke_color:this.getStrokeColor(c),u_sdf_map:this.texture,u_halo_blur:z,u_gamma_scale:Y,u_sdf_map_size:[Se.width,Se.height]}}},{key:"initModels",value:function(i){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),o=a.textAnchor,l=o===void 0?"center":o,c=a.textAllowOverlap,p=c===void 0?!0:c;this.preTextStyle={textAnchor:l,textAllowOverlap:p},this.buildModels(i)}},{key:"needUpdate",value:function(){var i=this.layer.getLayerConfig(),a=i.textAllowOverlap,o=a===void 0?!1:a,l=this.mapService.getZoom(),c=this.mapService.getBounds(),p=VR(this.extent,c);return!o&&(Math.abs(this.currentZoom-l)>1||!p)||o!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:_n.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.rotate,y=p===void 0?0:p;return Array.isArray(y)?[y[0]]:[y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:_n.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(a,o,l,c){var p=a.size,y=p===void 0?12:p;return Array.isArray(y)?[y[0]]:[y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:_n.Attribute,descriptor:{name:"a_tex",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(a,o,l,c){return[l[3],l[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Kb(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=this.layer.getEncodedData(),y=[];p.forEach(function(b){var w=b.shape,M=w===void 0?"":w;M=M.toString();var O=eK(M),N;try{for(O.s();!(N=O.n()).done;){var z=N.value;y.indexOf(z)===-1&&y.push(z)}}catch(j){O.e(j)}finally{O.f()}}),this.fontService.setFontOptions({characterSet:y,fontWeight:o,fontFamily:c,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=this.layer.getEncodedData(),y=[];p.forEach(function(b){var w=b.shape,M=w===void 0?"":w;M="".concat(M),y.indexOf(M)===-1&&y.push(M)}),this.fontService.setFontOptions({characterSet:y,fontWeight:o,fontFamily:c,iconfont:!0})}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.fontService.mapping,l=this.layer.getLayerConfig(),c=l.spacing,p=c===void 0?2:c,y=l.textAnchor,b=y===void 0?"center":y,w=this.layer.getEncodedData();this.glyphInfo=w.map(function(M){var O=M.shape,N=O===void 0?"":O,z=M.id,j=M.size,Y=j===void 0?1:j,K=M.textOffset,ie=K===void 0?[0,0]:K,le=CP(N.toString(),o,Y,b,"left",p,ie,i),Se=SP(le,ie,!1);return M.shaping=le,M.glyphQuads=Se,M.centroid=cd(M.coordinates),M.originCentroid=M.version==="GAODE2.x"?cd(M.originCoordinates):M.originCentroid=M.centroid,a.glyphInfoMap[z]={shaping:le,glyphQuads:Se,centroid:cd(M.coordinates)},M})}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,l=o===void 0?[4,4]:o,c=a.textAllowOverlap,p=c===void 0?!1:c;if(!p){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),b=y.width,w=y.height,M=new yP(b,w),O=this.glyphInfo.filter(function(N){var z=N.shaping,j=N.id,Y=j===void 0?0:j,K=N.version==="GAODE2.x"?N.originCentroid:N.centroid,ie=N.size,le=ie/24,Se=i.mapService.lngLatToContainer(K),ze=M.placeCollisionBox({x1:z.left*le-l[0],x2:z.right*le+l[0],y1:z.top*le-l[1],y2:z.bottom*le+l[1],anchorPointX:Se.x,anchorPointY:Se.y}),ue=ze.box;return ue&&ue.length?(M.insertCollisionBox(ue,Y),!0):!1});O.forEach(function(N){i.glyphInfoMap[N.id]=N})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.fontService.canvas;this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Q.LINEAR,min:Q.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:l3,fragmentShader:u3,triangulation:c3.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:bs(l,p)}).then(function(y){i.layer.models=[y],i.layer.renderLayers()}).catch(function(y){console.warn(y),i.layer.models=[]})}}]),t}($o),iK={fillImage:Fq,fill:kP,radar:Zq,image:RP,normal:OP,simplePoint:Jq,extrude:LP,text:PP,vectorpoint:Vw,tile:Jx,tileText:wP,earthFill:Cq,earthExtrude:yq};const aK=iK;function oK(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sK(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function sK(e,r){if(!!e){if(typeof e=="string")return f3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f3(e,r)}}function f3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function uK(e){var r=lK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function lK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cK=function(e){On(t,e);var r=uK(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","PointLayer"),ne(vt(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new aK[a](this),this.layerModel.initModels(function(o){i.models=o,i.layerService.updateLayerRenderList(),i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,o=i.values,l=this.getLayerConfig(),c=l.shape2d,p=this.iconService.getIconMap();if(a&&(c==null?void 0:c.indexOf(a))!==-1)return"fill";if(o&&o instanceof Array){var y=oK(o),b;try{for(y.s();!(b=y.n()).done;){var w=b.value;if(typeof w=="string"&&p.hasOwnProperty(w))return"image"}}catch(M){y.e(M)}finally{y.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();if(Nw(i))return"vectorpoint";var a=this.getEncodedData(),o=this.getLayerConfig(),l=o.shape2d,c=o.shape3d,p=this.iconService.getIconMap(),y=a.find(function(w){return w.hasOwnProperty("shape")});if(y){var b=y.shape;return b==="dot"?"normal":b==="simple"?"simplePoint":b==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(l==null?void 0:l.indexOf(b))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(c==null?void 0:c.indexOf(b))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":p.hasOwnProperty(b)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Gg);function fK(e){var r=hK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function hK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pK=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dK=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,vK=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,mK=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,gK=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,yK=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,_K=function(e){On(t,e);var r=fK(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.heightfixed,c=l===void 0?!1:l,p=i.raisingHeight,y=p===void 0?0:p,b=i.topsurface,w=b===void 0?!0:b,M=i.sidesurface,O=M===void 0?!0:M,N=i.sourceColor,z=i.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var j=this.layer.getEncodedData(),Y=this.calDataFrame(this.cellLength,j,this.cellProperties),K=Y.data,ie=Y.width,le=Y.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:Q.LUMINANCE,type:Q.FLOAT,width:ie,height:le}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}var Se=0,ze=[1,1,1,1],ue=[1,1,1,1];return N&&z&&(ze=Lo(N),ue=Lo(z),Se=1),{u_topsurface:Number(w),u_sidesurface:Number(O),u_heightfixed:Number(c),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(y),u_opacity:Vr.exports.isNumber(o)?o:1,u_linearColor:Se,u_sourceColor:ze,u_targetColor:ue,u_texture:this.texture}}},{key:"initModels",value:function(i){this.loadTexture(),this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c,y=this.getShaders(),b=y.frag,w=y.vert,M=y.type;this.layer.buildLayerModel({moduleName:M,vertexShader:w,fragmentShader:b,triangulation:Z$,stencil:bs(l,p)}).then(function(O){i([O])}).catch(function(O){console.warn(O),i([])})}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,o=i.mapTexture;return o?{frag:vK,vert:mK,type:"polygonExtrudeTexture"}:a?{frag:gK,vert:yK,type:"polygonExtrudePickLight"}:{frag:pK,vert:dK,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i,a;(i=this.dataTexture)===null||i===void 0||i.destroy(),(a=this.texture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Pi(i,4),o=a[0],l=a[1],c=a[2],p=a[3],y=c-o,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:_n.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(M,O,N,z,j){var Y=N[0],K=N[1];return[(Y-o)/y,(K-l)/b,N[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:_n.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(M,O,N,z,j){return j}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_n.Attribute,descriptor:{name:"a_Size",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(M,O,N,z){var j=M.size,Y=j===void 0?10:j;return Array.isArray(Y)?[Y[0]]:[Y]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.mapTexture,l=this.rendererService.createTexture2D;if(this.texture=l({height:0,width:0}),o){var c=new Image;c.crossOrigin="",c.src=o,c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Q.CLAMP_TO_EDGE,wrapT:Q.CLAMP_TO_EDGE,min:Q.LINEAR,mag:Q.LINEAR}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}}}]),t}($o);function xK(e){var r=bK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function bK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EK=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CK=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,SK=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,wK=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,AK=function(e){On(t,e);var r=xK(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.opacity,c=l===void 0?1:l,p=i.opacityLinear,y=p===void 0?{enable:!1,dir:"in"}:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),M=w.data,O=w.width,N=w.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&M.length>0?this.createTexture2D({flipY:!0,data:M,format:Q.LUMINANCE,type:Q.FLOAT,width:O,height:N}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(o),u_opacity:Vr.exports.isNumber(c)?c:1,u_opacitylinear:Number(y.enable),u_dir:y.dir==="in"?1:0}}},{key:"initModels",value:function(i){this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.getModelParams(),o=a.frag,l=a.vert,c=a.triangulation,p=a.type,y=this.layer.getLayerConfig(),b=y.mask,w=b===void 0?!1:b,M=y.maskInside,O=M===void 0?!0:M,N=y.workerEnabled,z=N===void 0?!1:N,j=y.enablePicking;this.layer.triangulation=c,this.layer.buildLayerModel({moduleName:p,vertexShader:l,fragmentShader:o,triangulation:c,primitive:Q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:bs(w,O),workerEnabled:z,workerOptions:{modelType:p,enablePicking:j}}).then(function(Y){i([Y])}).catch(function(Y){console.warn(Y),i([])})}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1,dir:"in"}:a;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:_n.Attribute,descriptor:{name:"a_linear",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:3,update:function(c,p,y,b,w){return[y[3],y[4],y[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1}:a;return o.enable?{frag:CK,vert:SK,type:"polygonLinear",triangulation:$$}:{frag:EK,vert:wK,type:"polygonFill",triangulation:_O}}}]),t}($o);function TK(e){var r=MK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function MK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var IK=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,LK=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,kK=function(e){On(t,e);var r=TK(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.watercolor,c=l===void 0?"#6D99A8":l,p=i.watercolor2,y=p===void 0?"#0F121C":p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var b=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,b,this.cellProperties),M=w.data,O=w.width,N=w.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&M.length>0?this.createTexture2D({flipY:!0,data:M,format:Q.LUMINANCE,type:Q.FLOAT,width:O,height:N}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Lo(c),u_watercolor2:Lo(y),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Vr.exports.isNumber(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.loadTexture(),this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:LK,fragmentShader:IK,triangulation:N1,primitive:Q.TRIANGLES,depth:{enable:!1},stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i,a,o,l;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(o=this.texture3)===null||o===void 0||o.destroy(),(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Pi(i,4),o=a[0],l=a[1],c=a[2],p=a[3],y=c-o,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:_n.Attribute,descriptor:{name:"a_uv",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(M,O,N,z,j){var Y=Pi(N,2),K=Y[0],ie=Y[1];return[(K-o)/y,(ie-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=a(o),this.texture2=a(o),this.texture3=a(o),l(function(p){i.texture1=c(p[0]),i.texture2=c(p[1]),i.texture3=c(p[2]),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()});function l(p){var y=0,b=[],w=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];w.map(function(M){var O=new Image;O.crossOrigin="",O.src=M,b.push(O),O.onload=function(){y++,y===3&&p(b)}})}function c(p){return a({data:p,width:p.width,height:p.height,wrapS:Q.MIRRORED_REPEAT,wrapT:Q.MIRRORED_REPEAT,min:Q.LINEAR,mag:Q.LINEAR})}}}]),t}($o);function RK(e){var r=OK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function OK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var PK=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,FK=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,DK=function(e){On(t,e);var r=RK(t);function t(){return Kt(this,t),r.apply(this,arguments)}return Qt(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.speed,c=l===void 0?.5:l;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:o})){this.judgeStyleAttributes({opacity:o});var p=this.layer.getEncodedData(),y=this.calDataFrame(this.cellLength,p,this.cellProperties),b=y.data,w=y.width,M=y.height;this.rowCount=M,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:Q.LUMINANCE,type:Q.FLOAT,width:w,height:M}):this.createTexture2D({flipY:!0,data:[1],format:Q.LUMINANCE,type:Q.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:c,u_opacity:Vr.exports.isNumber(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(i){this.loadTexture(),this.buildModels(i)}},{key:"buildModels",value:function(i){var a=this.layer.getLayerConfig(),o=a.mask,l=o===void 0?!1:o,c=a.maskInside,p=c===void 0?!0:c;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:FK,fragmentShader:PK,triangulation:N1,primitive:Q.TRIANGLES,depth:{enable:!1},stencil:bs(l,p)}).then(function(y){i([y])}).catch(function(y){console.warn(y),i([])})}},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Pi(i,4),o=a[0],l=a[1],c=a[2],p=a[3],y=c-o,b=p-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:_n.Attribute,descriptor:{name:"a_uv",buffer:{usage:Q.STATIC_DRAW,data:[],type:Q.FLOAT},size:2,update:function(M,O,N,z,j){var Y=Pi(N,2),K=Y[0],ie=Y[1];return[(K-o)/y,(ie-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var c=new Image;c.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),c.src=o):c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Q.MIRRORED_REPEAT,wrapT:Q.MIRRORED_REPEAT,min:Q.LINEAR,mag:Q.LINEAR}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}}]),t}($o),BK={fill:AK,line:IP,extrude:_K,text:PP,point_fill:kP,point_image:RP,point_normal:OP,point_extrude:LP,water:DK,ocean:kK,vectorpolygon:Vw,tile:AP};const NK=BK;function zK(e){var r=UK();return function(){var n=At(e),i;if(r){var a=At(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Fn(this,i)}}function UK(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var h3=function(e){On(t,e);var r=zK(t);function t(){var n;Kt(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ne(vt(n),"type","PolygonLayer"),n}return Qt(t,[{key:"buildModels",value:function(){var i=this,a=this.getModelType();this.layerModel=new NK[a](this),this.layerModel.initModels(function(o){i.models=o,i.renderLayers()})}},{key:"rebuildModels",value:function(){var i=this;this.layerModel.buildModels(function(a){return i.models=a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var i,a=this.layerSource.getParserType();if(Nw(a))return"vectorpolygon";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),l=o==null||(i=o.scale)===null||i===void 0?void 0:i.field;return l==="fill"?"fill":l==="extrude"?"extrude":l==="water"?"water":l==="ocean"?"ocean":l==="line"?"line":l==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=a.shape3d,c=this.iconService.getIconMap(),p=i.find(function(b){return b.hasOwnProperty("shape")});if(p){var y=p.shape;return y==="dot"?"point_normal":(o==null?void 0:o.indexOf(y))!==-1?"point_fill":(l==null?void 0:l.indexOf(y))!==-1?"point_extrude":c.hasOwnProperty(y)?"point_image":"text"}else return"fill"}}]),t}(Gg),p3,d3,v3,m3,g3,N_,y3,_3,x3,VK=(p3=oa(),d3=na(Gt.IGlobalConfigService),v3=na(Gt.IMapService),m3=na(Gt.IFontService),p3(g3=(N_=function(){function e(){Kt(this,e),$i(this,"configService",y3,this),$i(this,"mapService",_3,this),$i(this,"fontService",x3,this)}return Qt(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var o=t.getSource();o.inited?i.generateMaping(t,{styleAttributeService:a}):o.once("sourceUpdate",function(){i.generateMaping(t,{styleAttributeService:a})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var o=t.getSource();return o.inited?i.generateMaping(t,{styleAttributeService:a}):o.once("sourceUpdate",function(){i.generateMaping(t,{styleAttributeService:a})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=t.getSource();if(!(t.layerModelNeedUpdate||!o||!o.inited)){var l=t.getBottomColor(),c=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),y=o.data.dataArray,b=c.filter(function(M){return M.needRemapping}),w=y;p!=null&&p.needRemapping&&p!==null&&p!==void 0&&p.scale&&(w=y.filter(function(M){return i.applyAttributeMapping(p,M,l)[0]})),b.length&&(p!=null&&p.needRemapping?(t.setEncodedData(i.mapping(t,c,w,void 0,l)),p.needRemapping=!1):t.setEncodedData(i.mapping(t,b,w,t.getEncodedData(),l)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,o=t.getBottomColor(),l=a.getLayerStyleAttributes()||[],c=a.getLayerStyleAttribute("filter"),p=t.getSource().data.dataArray,y=p;c!=null&&c.scale&&(y=p.filter(function(b){return i.applyAttributeMapping(c,b,o)[0]})),t.setEncodedData(this.mapping(t,l,y,void 0,o)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=GR(i),o=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return o}},{key:"mapping",value:function(t,n,i,a,o){var l=this,c=t.getLayerConfig(),p=c.arrow,y=p===void 0?{enable:!1}:p,b=i.map(function(w,M){var O=a?a[M]:{},N=tr({id:w._id,coordinates:w.coordinates},O);if(n.filter(function(Y){return Y.scale!==void 0}).forEach(function(Y){var K=l.applyAttributeMapping(Y,w,o);Y.needRemapping=!1,Y.name==="color"&&(K=K.map(function(ie){return Lo(ie)})),N[Y.name]=Array.isArray(K)&&K.length===1?K[0]:K,Y.name==="shape"&&(N.shape=l.fontService.getIconFontKey(N[Y.name]))}),y.enable&&(N.shape==="line"||N.shape==="halfLine")){var z=N.coordinates,j=l.getArrowPoints(z[0],z[1]);N.coordinates.splice(1,0,j,j)}return N});return this.adjustData2Amap2Coordinates(b,t),this.adjustData2SimpleCoordinates(b),b}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version===vu["GAODE2.x"]){var a=this.getLayerCenter(n);typeof t[0].coordinates[0]=="number"?t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=vu["GAODE2.x"],o.originCoordinates=Vr.exports.cloneDeep(o.coordinates),o.coordinates=i.mapService.lngLatToCoordByLayer(o.coordinates,a)}):t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version=vu["GAODE2.x"],o.originCoordinates=Vr.exports.cloneDeep(o.coordinates),o.coordinates=i.mapService.lngLatToCoordsByLayer(o.coordinates,a)})}}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===vu.SIMPLE&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(o){var l=[];o.map(function(c){l.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(l)}),i}else{var a=[];return t.map(function(o){a.push(n.mapService.simpleMapCoord.unproject(o))}),a}}},{key:"applyAttributeMapping",value:function(t,n,i){var a;if(!t.scale)return[];var o=(t==null||(a=t.scale)===null||a===void 0?void 0:a.scalers)||[],l=[];o.forEach(function(p){var y,b=p.field;(n.hasOwnProperty(b)||((y=t.scale)===null||y===void 0?void 0:y.type)==="variable")&&l.push(n[b])});var c=t.mapping?t.mapping(l):[];return t.name==="color"&&!WR(c[0])?[i]:c}}]),e}(),y3=ji(N_.prototype,"configService",[d3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_3=ji(N_.prototype,"mapService",[v3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x3=ji(N_.prototype,"fontService",[m3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_))||g3),b3,E3,GK=(b3=oa(),b3(E3=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Gt.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var i=t.getSource();if(!i){var a=t.sourceOption||t.defaultSourceConfig,o=a.data,l=a.options;i=new Mm(o,l),t.setSource(i)}i.inited?n.updateClusterData(t):i.once("sourceUpdate",function(){n.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=n.updateClusterData(t),a=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||a})}},{key:"updateClusterData",value:function(t){var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,o=a===void 0?0:a,l=this.mapService.getZoom()-1,c=t.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(o!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||E3);function Gw(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function FP(e){return e.length===1&&(e=jK(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function jK(e){return function(r,t){return Gw(e(r),t)}}var HK=FP(Gw),h2=HK.right;function WK(e){return e===null?NaN:+e}function C3(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]}var fS=Math.sqrt(50),hS=Math.sqrt(10),pS=Math.sqrt(2);function DP(e,r,t){var n,i=-1,a,o,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=tb(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/l;return n&&o.reverse(),o}function tb(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=fS?10:a>=hS?5:a>=pS?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=fS?10:a>=hS?5:a>=pS?2:1)}function dS(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=fS?i*=10:a>=hS?i*=5:a>=pS&&(i*=2),r<e?-i:i}function $K(e,r,t){if(t==null&&(t=WK),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return o+(l-o)*(i-a)}}function XK(e,r,t,n,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*r+(4-6*a+3*o)*t+(1+3*e+3*a-3*o)*n+o*i)/6}function ZK(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],o=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return XK((t-n/r)*r,o,i,a,l)}}function jw(e){return function(){return e}}function YK(e,r){return function(t){return e+t*r}}function qK(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function KK(e){return(e=+e)==1?BP:function(r,t){return t-r?qK(r,t,e):jw(isNaN(r)?t:r)}}function BP(e,r){var t=r-e;return t?YK(e,t):jw(isNaN(e)?r:e)}const S3=function e(r){var t=KK(r);function n(i,a){var o=t((i=pb(i)).r,(a=pb(a)).r),l=t(i.g,a.g),c=t(i.b,a.b),p=BP(i.opacity,a.opacity);return function(y){return i.r=o(y),i.g=l(y),i.b=c(y),i.opacity=p(y),i+""}}return n.gamma=e,n}(1);function QK(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),o,l;for(o=0;o<t;++o)l=pb(r[o]),n[o]=l.r||0,i[o]=l.g||0,a[o]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(c){return l.r=n(c),l.g=i(c),l.b=a(c),l+""}}}var JK=QK(ZK);function eQ(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}}function tQ(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function rQ(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),o;for(o=0;o<n;++o)i[o]=Hw(e[o],r[o]);for(;o<t;++o)a[o]=r[o];return function(l){for(o=0;o<n;++o)a[o]=i[o](l);return a}}function nQ(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function Cb(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function iQ(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=Hw(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}}var vS=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zE=new RegExp(vS.source,"g");function aQ(e){return function(){return e}}function oQ(e){return function(r){return e(r)+""}}function sQ(e,r){var t=vS.lastIndex=zE.lastIndex=0,n,i,a,o=-1,l=[],c=[];for(e=e+"",r=r+"";(n=vS.exec(e))&&(i=zE.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,c.push({i:o,x:Cb(n,i)})),t=zE.lastIndex;return t<r.length&&(a=r.slice(t),l[o]?l[o]+=a:l[++o]=a),l.length<2?c[0]?oQ(c[0].x):aQ(r):(r=c.length,function(p){for(var y=0,b;y<r;++y)l[(b=c[y]).i]=b.x(p);return l.join("")})}function Hw(e,r){var t=typeof r,n;return r==null||t==="boolean"?jw(r):(t==="number"?Cb:t==="string"?(n=xm(r))?(r=n,S3):sQ:r instanceof xm?S3:r instanceof Date?nQ:tQ(r)?eQ:Array.isArray(r)?rQ:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?iQ:Cb)(e,r)}function uQ(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function Im(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function NP(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var od="$";function Sb(){}Sb.prototype=wb.prototype={constructor:Sb,has:function(e){return od+e in this},get:function(e){return this[od+e]},set:function(e,r){return this[od+e]=r,this},remove:function(e){var r=od+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===od&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===od&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===od&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===od&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===od&&++e;return e},empty:function(){for(var e in this)if(e[0]===od)return!1;return!0},each:function(e){for(var r in this)r[0]===od&&e(this[r],r.slice(1),this)}};function wb(e,r){var t=new Sb;if(e instanceof Sb)e.each(function(l,c){t.set(c,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var o in e)t.set(o,e[o]);return t}function w3(){}var og=wb.prototype;w3.prototype={constructor:w3,has:og.has,add:function(e){return e+="",this[od+e]=e,this},remove:og.remove,clear:og.clear,values:og.keys,size:og.size,empty:og.empty,each:og.each};var zP=Array.prototype,Ab=zP.map,Ng=zP.slice,A3={name:"implicit"};function Tb(){var e=wb(),r=[],t=[],n=A3;function i(a){var o=a+"",l=e.get(o);if(!l){if(n!==A3)return n;e.set(o,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=wb();for(var o=-1,l=a.length,c,p;++o<l;)e.has(p=(c=a[o])+"")||e.set(p,r.push(c));return i},i.range=function(a){return arguments.length?(t=Ng.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return Tb(r,t).unknown(n)},Im.apply(i,arguments),i}function lQ(e){return function(){return e}}function mS(e){return+e}var T3=[0,1];function jf(e){return e}function gS(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:lQ(isNaN(r)?NaN:.5)}function M3(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function cQ(e,r,t){var n=e[0],i=e[1],a=r[0],o=r[1];return i<n?(n=gS(i,n),a=t(o,a)):(n=gS(n,i),a=t(a,o)),function(l){return a(n(l))}}function fQ(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++o<n;)i[o]=gS(e[o],e[o+1]),a[o]=t(r[o],r[o+1]);return function(l){var c=h2(e,l,1,n)-1;return a[c](i[c](l))}}function p2(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ww(){var e=T3,r=T3,t=Hw,n,i,a,o=jf,l,c,p;function y(){return l=Math.min(e.length,r.length)>2?fQ:cQ,c=p=null,b}function b(w){return isNaN(w=+w)?a:(c||(c=l(e.map(n),r,t)))(n(o(w)))}return b.invert=function(w){return o(i((p||(p=l(r,e.map(n),Cb)))(w)))},b.domain=function(w){return arguments.length?(e=Ab.call(w,mS),o===jf||(o=M3(e)),y()):e.slice()},b.range=function(w){return arguments.length?(r=Ng.call(w),y()):r.slice()},b.rangeRound=function(w){return r=Ng.call(w),t=uQ,y()},b.clamp=function(w){return arguments.length?(o=w?M3(e):jf,b):o!==jf},b.interpolate=function(w){return arguments.length?(t=w,y()):t},b.unknown=function(w){return arguments.length?(a=w,b):a},function(w,M){return n=w,i=M,y()}}function UP(e,r){return Ww()(e,r)}function hQ(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Mb(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function Ky(e){return e=Mb(Math.abs(e)),e?e[1]:NaN}function pQ(e,r){return function(t,n){for(var i=t.length,a=[],o=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),a.push(t.substring(i-=l,i+l)),!((c+=l+1)>n));)l=e[o=(o+1)%e.length];return a.reverse().join(r)}}function dQ(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}var vQ=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ib(e){if(!(r=vQ.exec(e)))throw new Error("invalid format: "+e);var r;return new $w({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Ib.prototype=$w.prototype;function $w(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$w.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function mQ(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var VP;function gQ(e,r){var t=Mb(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(VP=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Mb(e,Math.max(0,r+a-1))[0]}function I3(e,r){var t=Mb(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const L3={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:hQ,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return I3(e*100,r)},r:I3,s:gQ,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function k3(e){return e}var R3=Array.prototype.map,O3=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function yQ(e){var r=e.grouping===void 0||e.thousands===void 0?k3:pQ(R3.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?k3:dQ(R3.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function p(b){b=Ib(b);var w=b.fill,M=b.align,O=b.sign,N=b.symbol,z=b.zero,j=b.width,Y=b.comma,K=b.precision,ie=b.trim,le=b.type;le==="n"?(Y=!0,le="g"):L3[le]||(K===void 0&&(K=12),ie=!0,le="g"),(z||w==="0"&&M==="=")&&(z=!0,w="0",M="=");var Se=N==="$"?t:N==="#"&&/[boxX]/.test(le)?"0"+le.toLowerCase():"",ze=N==="$"?n:/[%p]/.test(le)?o:"",ue=L3[le],Ke=/[defgprs%]/.test(le);K=K===void 0?6:/[gprs]/.test(le)?Math.max(1,Math.min(21,K)):Math.max(0,Math.min(20,K));function ke(Ce){var je=Se,ve=ze,Ie,dt,St;if(le==="c")ve=ue(Ce)+ve,Ce="";else{Ce=+Ce;var Rt=Ce<0||1/Ce<0;if(Ce=isNaN(Ce)?c:ue(Math.abs(Ce),K),ie&&(Ce=mQ(Ce)),Rt&&+Ce==0&&O!=="+"&&(Rt=!1),je=(Rt?O==="("?O:l:O==="-"||O==="("?"":O)+je,ve=(le==="s"?O3[8+VP/3]:"")+ve+(Rt&&O==="("?")":""),Ke){for(Ie=-1,dt=Ce.length;++Ie<dt;)if(St=Ce.charCodeAt(Ie),48>St||St>57){ve=(St===46?i+Ce.slice(Ie+1):Ce.slice(Ie))+ve,Ce=Ce.slice(0,Ie);break}}}Y&&!z&&(Ce=r(Ce,1/0));var $t=je.length+Ce.length+ve.length,gt=$t<j?new Array(j-$t+1).join(w):"";switch(Y&&z&&(Ce=r(gt+Ce,gt.length?j-ve.length:1/0),gt=""),M){case"<":Ce=je+Ce+ve+gt;break;case"=":Ce=je+gt+Ce+ve;break;case"^":Ce=gt.slice(0,$t=gt.length>>1)+je+Ce+ve+gt.slice($t);break;default:Ce=gt+je+Ce+ve;break}return a(Ce)}return ke.toString=function(){return b+""},ke}function y(b,w){var M=p((b=Ib(b),b.type="f",b)),O=Math.max(-8,Math.min(8,Math.floor(Ky(w)/3)))*3,N=Math.pow(10,-O),z=O3[8+O/3];return function(j){return M(N*j)+z}}return{format:p,formatPrefix:y}}var Rx,Xw,GP;_Q({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function _Q(e){return Rx=yQ(e),Xw=Rx.format,GP=Rx.formatPrefix,Rx}function xQ(e){return Math.max(0,-Ky(Math.abs(e)))}function bQ(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ky(r)/3)))*3-Ky(Math.abs(e)))}function EQ(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,Ky(r)-Ky(e))+1}function CQ(e,r,t,n){var i=dS(e,r,t),a;switch(n=Ib(n==null?",f":n),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=bQ(i,o))&&(n.precision=a),GP(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=EQ(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=xQ(i))&&(n.precision=a-(n.type==="%")*2);break}}return Xw(n)}function c_(e){var r=e.domain;return e.ticks=function(t){var n=r();return DP(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return CQ(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,o=n[i],l=n[a],c;return l<o&&(c=o,o=l,l=c,c=i,i=a,a=c),c=tb(o,l,t),c>0?(o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c,c=tb(o,l,t)):c<0&&(o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c,c=tb(o,l,t)),c>0?(n[i]=Math.floor(o/c)*c,n[a]=Math.ceil(l/c)*c,r(n)):c<0&&(n[i]=Math.ceil(o*c)/c,n[a]=Math.floor(l*c)/c,r(n)),e},e}function jP(){var e=UP(jf,jf);return e.copy=function(){return p2(e,jP())},Im.apply(e,arguments),c_(e)}function HP(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=Ab.call(n,mS),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return HP(e).unknown(r)},e=arguments.length?Ab.call(e,mS):[0,1],c_(t)}function WP(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],o;return a<i&&(o=t,t=n,n=o,o=i,i=a,a=o),e[t]=r.floor(i),e[n]=r.ceil(a),e}function P3(e){return Math.log(e)}function F3(e){return Math.exp(e)}function SQ(e){return-Math.log(-e)}function wQ(e){return-Math.exp(-e)}function AQ(e){return isFinite(e)?+("1e"+e):e<0?0:e}function TQ(e){return e===10?AQ:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function MQ(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function D3(e){return function(r){return-e(-r)}}function IQ(e){var r=e(P3,F3),t=r.domain,n=10,i,a;function o(){return i=MQ(n),a=TQ(n),t()[0]<0?(i=D3(i),a=D3(a),e(SQ,wQ)):e(P3,F3),r}return r.base=function(l){return arguments.length?(n=+l,o()):n},r.domain=function(l){return arguments.length?(t(l),o()):t()},r.ticks=function(l){var c=t(),p=c[0],y=c[c.length-1],b;(b=y<p)&&(w=p,p=y,y=w);var w=i(p),M=i(y),O,N,z,j=l==null?10:+l,Y=[];if(!(n%1)&&M-w<j){if(w=Math.round(w)-1,M=Math.round(M)+1,p>0){for(;w<M;++w)for(N=1,O=a(w);N<n;++N)if(z=O*N,!(z<p)){if(z>y)break;Y.push(z)}}else for(;w<M;++w)for(N=n-1,O=a(w);N>=1;--N)if(z=O*N,!(z<p)){if(z>y)break;Y.push(z)}}else Y=DP(w,M,Math.min(M-w,j)).map(a);return b?Y.reverse():Y},r.tickFormat=function(l,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=Xw(c)),l===1/0)return c;l==null&&(l=10);var p=Math.max(1,n*l/r.ticks().length);return function(y){var b=y/a(Math.round(i(y)));return b*n<n-.5&&(b*=n),b<=p?c(y):""}},r.nice=function(){return t(WP(t(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},r}function $P(){var e=IQ(Ww()).domain([1,10]);return e.copy=function(){return p2(e,$P()).base(e.base())},Im.apply(e,arguments),e}function B3(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function LQ(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function kQ(e){return e<0?-e*e:e*e}function RQ(e){var r=e(jf,jf),t=1;function n(){return t===1?e(jf,jf):t===.5?e(LQ,kQ):e(B3(t),B3(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},c_(r)}function XP(){var e=RQ(Ww());return e.copy=function(){return p2(e,XP()).exponent(e.exponent())},Im.apply(e,arguments),e}function ZP(){var e=[],r=[],t=[],n;function i(){var o=0,l=Math.max(1,r.length);for(t=new Array(l-1);++o<l;)t[o-1]=$K(e,o/l);return a}function a(o){return isNaN(o=+o)?n:r[h2(t,o)]}return a.invertExtent=function(o){var l=r.indexOf(o);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(var l=0,c=o.length,p;l<c;++l)p=o[l],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(Gw),i()},a.range=function(o){return arguments.length?(r=Ng.call(o),i()):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return ZP().domain(e).range(r).unknown(n)},Im.apply(a,arguments)}function YP(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function o(c){return c<=c?i[h2(n,c,0,t)]:a}function l(){var c=-1;for(n=new Array(t);++c<t;)n[c]=((c+1)*r-(c-t)*e)/(t+1);return o}return o.domain=function(c){return arguments.length?(e=+c[0],r=+c[1],l()):[e,r]},o.range=function(c){return arguments.length?(t=(i=Ng.call(c)).length-1,l()):i.slice()},o.invertExtent=function(c){var p=i.indexOf(c);return p<0?[NaN,NaN]:p<1?[e,n[0]]:p>=t?[n[t-1],r]:[n[p-1],n[p]]},o.unknown=function(c){return arguments.length&&(a=c),o},o.thresholds=function(){return n.slice()},o.copy=function(){return YP().domain([e,r]).range(i).unknown(a)},Im.apply(c_(o),arguments)}function qP(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[h2(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=Ng.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=Ng.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var o=r.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return qP().domain(e).range(r).unknown(t)},Im.apply(i,arguments)}var UE=new Date,VE=new Date;function bh(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var o=i(a),l=i.ceil(a);return a-o<l-a?o:l},i.offset=function(a,o){return r(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,l){var c=[],p;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<o)||!(l>0))return c;do c.push(p=new Date(+a)),r(a,l),e(a);while(p<a&&a<o);return c},i.filter=function(a){return bh(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,l){if(o>=o)if(l<0)for(;++l<=0;)for(;r(o,-1),!a(o););else for(;--l>=0;)for(;r(o,1),!a(o););})},t&&(i.count=function(a,o){return UE.setTime(+a),VE.setTime(+o),e(UE),e(VE),Math.floor(t(UE,VE))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(o){return n(o)%a===0}:function(o){return i.count(0,o)%a===0}):i}),i}var Lb=bh(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});Lb.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?bh(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):Lb};const OQ=Lb;Lb.range;var kb=1e3,U1=6e4,N3=36e5,KP=864e5,QP=6048e5,JP=bh(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*kb)},function(e,r){return(r-e)/kb},function(e){return e.getUTCSeconds()});const PQ=JP;JP.range;var eF=bh(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*kb)},function(e,r){e.setTime(+e+r*U1)},function(e,r){return(r-e)/U1},function(e){return e.getMinutes()});const FQ=eF;eF.range;var tF=bh(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*kb-e.getMinutes()*U1)},function(e,r){e.setTime(+e+r*N3)},function(e,r){return(r-e)/N3},function(e){return e.getHours()});const DQ=tF;tF.range;var rF=bh(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*U1)/KP},function(e){return e.getDate()-1});const Zw=rF;rF.range;function jg(e){return bh(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*U1)/QP})}var Yw=jg(0),Rb=jg(1),BQ=jg(2),NQ=jg(3),Qy=jg(4),zQ=jg(5),UQ=jg(6);Yw.range;Rb.range;BQ.range;NQ.range;Qy.range;zQ.range;UQ.range;var nF=bh(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const VQ=nF;nF.range;var qw=bh(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});qw.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:bh(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};const Jy=qw;qw.range;var iF=bh(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/KP},function(e){return e.getUTCDate()-1});const aF=iF;iF.range;function Hg(e){return bh(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/QP})}var oF=Hg(0),Ob=Hg(1),GQ=Hg(2),jQ=Hg(3),e_=Hg(4),HQ=Hg(5),WQ=Hg(6);oF.range;Ob.range;GQ.range;jQ.range;e_.range;HQ.range;WQ.range;var Kw=bh(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Kw.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:bh(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};const V1=Kw;Kw.range;function GE(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function jE(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function z_(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function $Q(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,o=e.shortDays,l=e.months,c=e.shortMonths,p=U_(i),y=V_(i),b=U_(a),w=V_(a),M=U_(o),O=V_(o),N=U_(l),z=V_(l),j=U_(c),Y=V_(c),K={a:Rt,A:$t,b:gt,B:jr,c:null,d:H3,e:H3,f:vJ,g:wJ,G:TJ,H:hJ,I:pJ,j:dJ,L:sF,m:mJ,M:gJ,p:Er,q:rn,Q:X3,s:Z3,S:yJ,u:_J,U:xJ,V:bJ,w:EJ,W:CJ,x:null,X:null,y:SJ,Y:AJ,Z:MJ,"%":$3},ie={a:dn,A:Rn,b:Ar,B:xa,c:null,d:W3,e:W3,f:RJ,g:GJ,G:HJ,H:IJ,I:LJ,j:kJ,L:lF,m:OJ,M:PJ,p:Ti,q:Sa,Q:X3,s:Z3,S:FJ,u:DJ,U:BJ,V:NJ,w:zJ,W:UJ,x:null,X:null,y:VJ,Y:jJ,Z:WJ,"%":$3},le={a:ke,A:Ce,b:je,B:ve,c:Ie,d:G3,e:G3,f:uJ,g:V3,G:U3,H:j3,I:j3,j:iJ,L:sJ,m:nJ,M:aJ,p:Ke,q:rJ,Q:cJ,s:fJ,S:oJ,u:KQ,U:QQ,V:JQ,w:qQ,W:eJ,x:dt,X:St,y:V3,Y:U3,Z:tJ,"%":lJ};K.x=Se(t,K),K.X=Se(n,K),K.c=Se(r,K),ie.x=Se(t,ie),ie.X=Se(n,ie),ie.c=Se(r,ie);function Se(hr,Dr){return function(Kn){var Wt=[],Me=-1,Qe=0,Ct=hr.length,Yt,qt,_r;for(Kn instanceof Date||(Kn=new Date(+Kn));++Me<Ct;)hr.charCodeAt(Me)===37&&(Wt.push(hr.slice(Qe,Me)),(qt=z3[Yt=hr.charAt(++Me)])!=null?Yt=hr.charAt(++Me):qt=Yt==="e"?" ":"0",(_r=Dr[Yt])&&(Yt=_r(Kn,qt)),Wt.push(Yt),Qe=Me+1);return Wt.push(hr.slice(Qe,Me)),Wt.join("")}}function ze(hr,Dr){return function(Kn){var Wt=z_(1900,void 0,1),Me=ue(Wt,hr,Kn+="",0),Qe,Ct;if(Me!=Kn.length)return null;if("Q"in Wt)return new Date(Wt.Q);if("s"in Wt)return new Date(Wt.s*1e3+("L"in Wt?Wt.L:0));if(Dr&&!("Z"in Wt)&&(Wt.Z=0),"p"in Wt&&(Wt.H=Wt.H%12+Wt.p*12),Wt.m===void 0&&(Wt.m="q"in Wt?Wt.q:0),"V"in Wt){if(Wt.V<1||Wt.V>53)return null;"w"in Wt||(Wt.w=1),"Z"in Wt?(Qe=jE(z_(Wt.y,0,1)),Ct=Qe.getUTCDay(),Qe=Ct>4||Ct===0?Ob.ceil(Qe):Ob(Qe),Qe=aF.offset(Qe,(Wt.V-1)*7),Wt.y=Qe.getUTCFullYear(),Wt.m=Qe.getUTCMonth(),Wt.d=Qe.getUTCDate()+(Wt.w+6)%7):(Qe=GE(z_(Wt.y,0,1)),Ct=Qe.getDay(),Qe=Ct>4||Ct===0?Rb.ceil(Qe):Rb(Qe),Qe=Zw.offset(Qe,(Wt.V-1)*7),Wt.y=Qe.getFullYear(),Wt.m=Qe.getMonth(),Wt.d=Qe.getDate()+(Wt.w+6)%7)}else("W"in Wt||"U"in Wt)&&("w"in Wt||(Wt.w="u"in Wt?Wt.u%7:"W"in Wt?1:0),Ct="Z"in Wt?jE(z_(Wt.y,0,1)).getUTCDay():GE(z_(Wt.y,0,1)).getDay(),Wt.m=0,Wt.d="W"in Wt?(Wt.w+6)%7+Wt.W*7-(Ct+5)%7:Wt.w+Wt.U*7-(Ct+6)%7);return"Z"in Wt?(Wt.H+=Wt.Z/100|0,Wt.M+=Wt.Z%100,jE(Wt)):GE(Wt)}}function ue(hr,Dr,Kn,Wt){for(var Me=0,Qe=Dr.length,Ct=Kn.length,Yt,qt;Me<Qe;){if(Wt>=Ct)return-1;if(Yt=Dr.charCodeAt(Me++),Yt===37){if(Yt=Dr.charAt(Me++),qt=le[Yt in z3?Dr.charAt(Me++):Yt],!qt||(Wt=qt(hr,Kn,Wt))<0)return-1}else if(Yt!=Kn.charCodeAt(Wt++))return-1}return Wt}function Ke(hr,Dr,Kn){var Wt=p.exec(Dr.slice(Kn));return Wt?(hr.p=y[Wt[0].toLowerCase()],Kn+Wt[0].length):-1}function ke(hr,Dr,Kn){var Wt=M.exec(Dr.slice(Kn));return Wt?(hr.w=O[Wt[0].toLowerCase()],Kn+Wt[0].length):-1}function Ce(hr,Dr,Kn){var Wt=b.exec(Dr.slice(Kn));return Wt?(hr.w=w[Wt[0].toLowerCase()],Kn+Wt[0].length):-1}function je(hr,Dr,Kn){var Wt=j.exec(Dr.slice(Kn));return Wt?(hr.m=Y[Wt[0].toLowerCase()],Kn+Wt[0].length):-1}function ve(hr,Dr,Kn){var Wt=N.exec(Dr.slice(Kn));return Wt?(hr.m=z[Wt[0].toLowerCase()],Kn+Wt[0].length):-1}function Ie(hr,Dr,Kn){return ue(hr,r,Dr,Kn)}function dt(hr,Dr,Kn){return ue(hr,t,Dr,Kn)}function St(hr,Dr,Kn){return ue(hr,n,Dr,Kn)}function Rt(hr){return o[hr.getDay()]}function $t(hr){return a[hr.getDay()]}function gt(hr){return c[hr.getMonth()]}function jr(hr){return l[hr.getMonth()]}function Er(hr){return i[+(hr.getHours()>=12)]}function rn(hr){return 1+~~(hr.getMonth()/3)}function dn(hr){return o[hr.getUTCDay()]}function Rn(hr){return a[hr.getUTCDay()]}function Ar(hr){return c[hr.getUTCMonth()]}function xa(hr){return l[hr.getUTCMonth()]}function Ti(hr){return i[+(hr.getUTCHours()>=12)]}function Sa(hr){return 1+~~(hr.getUTCMonth()/3)}return{format:function(hr){var Dr=Se(hr+="",K);return Dr.toString=function(){return hr},Dr},parse:function(hr){var Dr=ze(hr+="",!1);return Dr.toString=function(){return hr},Dr},utcFormat:function(hr){var Dr=Se(hr+="",ie);return Dr.toString=function(){return hr},Dr},utcParse:function(hr){var Dr=ze(hr+="",!0);return Dr.toString=function(){return hr},Dr}}}var z3={"-":"",_:" ",0:"0"},kc=/^\s*\d+/,XQ=/^%/,ZQ=/[\\^$*+?|[\]().{}]/g;function Wo(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function YQ(e){return e.replace(ZQ,"\\$&")}function U_(e){return new RegExp("^(?:"+e.map(YQ).join("|")+")","i")}function V_(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function qQ(e,r,t){var n=kc.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function KQ(e,r,t){var n=kc.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function QQ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function JQ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function eJ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function U3(e,r,t){var n=kc.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function V3(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function tJ(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function rJ(e,r,t){var n=kc.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function nJ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function G3(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function iJ(e,r,t){var n=kc.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function j3(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function aJ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function oJ(e,r,t){var n=kc.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function sJ(e,r,t){var n=kc.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function uJ(e,r,t){var n=kc.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function lJ(e,r,t){var n=XQ.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function cJ(e,r,t){var n=kc.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function fJ(e,r,t){var n=kc.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function H3(e,r){return Wo(e.getDate(),r,2)}function hJ(e,r){return Wo(e.getHours(),r,2)}function pJ(e,r){return Wo(e.getHours()%12||12,r,2)}function dJ(e,r){return Wo(1+Zw.count(Jy(e),e),r,3)}function sF(e,r){return Wo(e.getMilliseconds(),r,3)}function vJ(e,r){return sF(e,r)+"000"}function mJ(e,r){return Wo(e.getMonth()+1,r,2)}function gJ(e,r){return Wo(e.getMinutes(),r,2)}function yJ(e,r){return Wo(e.getSeconds(),r,2)}function _J(e){var r=e.getDay();return r===0?7:r}function xJ(e,r){return Wo(Yw.count(Jy(e)-1,e),r,2)}function uF(e){var r=e.getDay();return r>=4||r===0?Qy(e):Qy.ceil(e)}function bJ(e,r){return e=uF(e),Wo(Qy.count(Jy(e),e)+(Jy(e).getDay()===4),r,2)}function EJ(e){return e.getDay()}function CJ(e,r){return Wo(Rb.count(Jy(e)-1,e),r,2)}function SJ(e,r){return Wo(e.getFullYear()%100,r,2)}function wJ(e,r){return e=uF(e),Wo(e.getFullYear()%100,r,2)}function AJ(e,r){return Wo(e.getFullYear()%1e4,r,4)}function TJ(e,r){var t=e.getDay();return e=t>=4||t===0?Qy(e):Qy.ceil(e),Wo(e.getFullYear()%1e4,r,4)}function MJ(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Wo(r/60|0,"0",2)+Wo(r%60,"0",2)}function W3(e,r){return Wo(e.getUTCDate(),r,2)}function IJ(e,r){return Wo(e.getUTCHours(),r,2)}function LJ(e,r){return Wo(e.getUTCHours()%12||12,r,2)}function kJ(e,r){return Wo(1+aF.count(V1(e),e),r,3)}function lF(e,r){return Wo(e.getUTCMilliseconds(),r,3)}function RJ(e,r){return lF(e,r)+"000"}function OJ(e,r){return Wo(e.getUTCMonth()+1,r,2)}function PJ(e,r){return Wo(e.getUTCMinutes(),r,2)}function FJ(e,r){return Wo(e.getUTCSeconds(),r,2)}function DJ(e){var r=e.getUTCDay();return r===0?7:r}function BJ(e,r){return Wo(oF.count(V1(e)-1,e),r,2)}function cF(e){var r=e.getUTCDay();return r>=4||r===0?e_(e):e_.ceil(e)}function NJ(e,r){return e=cF(e),Wo(e_.count(V1(e),e)+(V1(e).getUTCDay()===4),r,2)}function zJ(e){return e.getUTCDay()}function UJ(e,r){return Wo(Ob.count(V1(e)-1,e),r,2)}function VJ(e,r){return Wo(e.getUTCFullYear()%100,r,2)}function GJ(e,r){return e=cF(e),Wo(e.getUTCFullYear()%100,r,2)}function jJ(e,r){return Wo(e.getUTCFullYear()%1e4,r,4)}function HJ(e,r){var t=e.getUTCDay();return e=t>=4||t===0?e_(e):e_.ceil(e),Wo(e.getUTCFullYear()%1e4,r,4)}function WJ(){return"+0000"}function $3(){return"%"}function X3(e){return+e}function Z3(e){return Math.floor(+e/1e3)}var Ey,fF;$J({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function $J(e){return Ey=$Q(e),fF=Ey.format,Ey.parse,Ey.utcFormat,Ey.utcParse,Ey}var Q_=1e3,J_=Q_*60,e1=J_*60,G1=e1*24,XJ=G1*7,Y3=G1*30,HE=G1*365;function ZJ(e){return new Date(e)}function YJ(e){return e instanceof Date?+e:+new Date(+e)}function hF(e,r,t,n,i,a,o,l,c){var p=UP(jf,jf),y=p.invert,b=p.domain,w=c(".%L"),M=c(":%S"),O=c("%I:%M"),N=c("%I %p"),z=c("%a %d"),j=c("%b %d"),Y=c("%B"),K=c("%Y"),ie=[[o,1,Q_],[o,5,5*Q_],[o,15,15*Q_],[o,30,30*Q_],[a,1,J_],[a,5,5*J_],[a,15,15*J_],[a,30,30*J_],[i,1,e1],[i,3,3*e1],[i,6,6*e1],[i,12,12*e1],[n,1,G1],[n,2,2*G1],[t,1,XJ],[r,1,Y3],[r,3,3*Y3],[e,1,HE]];function le(ze){return(o(ze)<ze?w:a(ze)<ze?M:i(ze)<ze?O:n(ze)<ze?N:r(ze)<ze?t(ze)<ze?z:j:e(ze)<ze?Y:K)(ze)}function Se(ze,ue,Ke,ke){if(ze==null&&(ze=10),typeof ze=="number"){var Ce=Math.abs(Ke-ue)/ze,je=FP(function(ve){return ve[2]}).right(ie,Ce);je===ie.length?(ke=dS(ue/HE,Ke/HE,ze),ze=e):je?(je=ie[Ce/ie[je-1][2]<ie[je][2]/Ce?je-1:je],ke=je[1],ze=je[0]):(ke=Math.max(dS(ue,Ke,ze),1),ze=l)}return ke==null?ze:ze.every(ke)}return p.invert=function(ze){return new Date(y(ze))},p.domain=function(ze){return arguments.length?b(Ab.call(ze,YJ)):b().map(ZJ)},p.ticks=function(ze,ue){var Ke=b(),ke=Ke[0],Ce=Ke[Ke.length-1],je=Ce<ke,ve;return je&&(ve=ke,ke=Ce,Ce=ve),ve=Se(ze,ke,Ce,ue),ve=ve?ve.range(ke,Ce+1):[],je?ve.reverse():ve},p.tickFormat=function(ze,ue){return ue==null?le:c(ue)},p.nice=function(ze,ue){var Ke=b();return(ze=Se(ze,Ke[0],Ke[Ke.length-1],ue))?b(WP(Ke,ze)):p},p.copy=function(){return p2(p,hF(e,r,t,n,i,a,o,l,c))},p}function qJ(){return Im.apply(hF(Jy,VQ,Yw,Zw,DQ,FQ,PQ,OQ,fF).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function KJ(){var e=0,r=1,t,n,i,a,o=jf,l=!1,c;function p(y){return isNaN(y=+y)?c:o(i===0?.5:(y=(a(y)-t)*i,l?Math.max(0,Math.min(1,y)):y))}return p.domain=function(y){return arguments.length?(t=a(e=+y[0]),n=a(r=+y[1]),i=t===n?0:1/(n-t),p):[e,r]},p.clamp=function(y){return arguments.length?(l=!!y,p):l},p.interpolator=function(y){return arguments.length?(o=y,p):o},p.unknown=function(y){return arguments.length?(c=y,p):c},function(y){return a=y,t=y(e),n=y(r),i=t===n?0:1/(n-t),p}}function pF(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function dF(){var e=c_(KJ()(jf));return e.copy=function(){return pF(e,dF())},NP.apply(e,arguments)}function QJ(){var e=0,r=.5,t=1,n,i,a,o,l,c=jf,p,y=!1,b;function w(M){return isNaN(M=+M)?b:(M=.5+((M=+p(M))-i)*(M<i?o:l),c(y?Math.max(0,Math.min(1,M)):M))}return w.domain=function(M){return arguments.length?(n=p(e=+M[0]),i=p(r=+M[1]),a=p(t=+M[2]),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),w):[e,r,t]},w.clamp=function(M){return arguments.length?(y=!!M,w):y},w.interpolator=function(M){return arguments.length?(c=M,w):c},w.unknown=function(M){return arguments.length?(b=M,w):b},function(M){return p=M,n=M(e),i=M(r),a=M(t),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),w}}function vF(){var e=c_(QJ()(jf));return e.copy=function(){return pF(e,vF())},NP.apply(e,arguments)}var Ap,q3,K3,Q3,WE,J3,JJ=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,eee=(Ap={},ne(Ap,jo.LINEAR,jP),ne(Ap,jo.POWER,XP),ne(Ap,jo.LOG,$P),ne(Ap,jo.IDENTITY,HP),ne(Ap,jo.SEQUENTIAL,dF),ne(Ap,jo.TIME,qJ),ne(Ap,jo.QUANTILE,ZP),ne(Ap,jo.QUANTIZE,YP),ne(Ap,jo.THRESHOLD,qP),ne(Ap,jo.CAT,Tb),ne(Ap,jo.DIVERGING,vF),Ap),tee=(q3=oa(),K3=na(Gt.IGlobalConfigService),q3(Q3=(WE=function(){function e(){Kt(this,e),$i(this,"configService",J3,this),ne(this,"scaleCache",{}),ne(this,"scaleOptions",{})}return Qt(e,[{key:"getSourceData",value:function(t,n){var i=t.getSource();i.inited?n(i.data):i.once("sourceUpdate",function(){n(i.data)})}},{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();i.getSourceData(t,function(l){var c=l.dataArray;Array.isArray(c)&&c.length===0||i.caculateScalesForAttributes(o||[],c)})}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();return i.getSourceData(t,function(l){var c=l.dataArray;Array.isArray(c)&&c.length===0||(i.caculateScalesForAttributes(o||[],c),t.layerModelNeedUpdate=!0)}),!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes();o&&i.getSourceData(t,function(l){var c=l.dataArray;if(c.length!==0){var p=o.filter(function(y){return y.needRescale});p.length&&i.caculateScalesForAttributes(p,c)}})}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;this.scaleCache={},t.forEach(function(a){if(a.scale){var o=a.scale;o.names=i.parseFields(a.scale.field||[]);var l=[];o.names.forEach(function(c){var p;l.push(i.createScale(c,a.name,(p=a.scale)===null||p===void 0?void 0:p.values,n))}),l.some(function(c){return c.type===um.VARIABLE})?(o.type=um.VARIABLE,l.forEach(function(c){var p;if(!o.callback&&o.values!=="text")switch((p=c.option)===null||p===void 0?void 0:p.type){case jo.LOG:case jo.LINEAR:case jo.POWER:if(o.values&&o.values.length>2){var y=c.scale.ticks(o.values.length);c.scale.domain(y)}o.values?c.scale.range(o.values):c.scale.range(c.option.domain);break;case jo.QUANTILE:case jo.QUANTIZE:case jo.THRESHOLD:c.scale.range(o.values);break;case jo.CAT:o.values?c.scale.range(o.values):c.scale.range(c.option.domain);break;case jo.DIVERGING:case jo.SEQUENTIAL:c.scale.interpolator(JK(o.values));break}if(o.values==="text"){var b;c.scale.range((b=c.option)===null||b===void 0?void 0:b.domain)}})):(o.type=um.CONSTANT,o.defaultValues=l.map(function(c,p){return c.scale(o.names[p])})),o.scalers=l.map(function(c){return{field:c.field,func:c.scale,option:c.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:Vr.exports.isString(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var o,l,c=this.scaleOptions[n]&&((o=this.scaleOptions[n])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],p={field:t,scale:void 0,type:um.VARIABLE,option:c};if(!a||!a.length)return c&&c.type?p.scale=this.createDefaultScale(c):(p.scale=Tb([t]),p.type=um.CONSTANT),p;var y=(l=a.find(function(M){return!Vr.exports.isNil(M[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||Vr.exports.isNil(y)&&!c)p.scale=Tb([t]),p.type=um.CONSTANT;else{var b=c&&c.type||this.getDefaultType(y);i==="text"&&(b=jo.CAT);var w=this.createScaleConfig(b,t,c,a);p.scale=this.createDefaultScale(w),p.option=w}return p}},{key:"getDefaultType",value:function(t){var n=jo.LINEAR;return typeof t=="string"&&(n=JJ.test(t)?jo.TIME:jo.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var o={type:t},l=(a==null?void 0:a.map(function(y){return y[n]}))||[];if(i!=null&&i.domain)o.domain=i==null?void 0:i.domain;else if(t!==jo.CAT&&t!==jo.QUANTILE&&t!==jo.DIVERGING)o.domain=C3(l);else if(t===jo.CAT)o.domain=Vr.exports.uniq(l);else if(t===jo.QUANTILE)o.domain=l;else if(t===jo.DIVERGING){var c=C3(l),p=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(c[0]+c[1])/2;o.domain=[c[0],p,c[1]]}return tr(tr({},o),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,o=t.clamp,l=t.nice,c=eee[n]();return i&&c.domain&&c.domain(i),a&&c.unknown(a),o!==void 0&&c.clamp&&c.clamp(o),l!==void 0&&c.nice&&c.nice(l),c}}]),e}(),J3=ji(WE.prototype,"configService",[K3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WE))||Q3),eL,tL,rL,nL,Ox,iL,aL,ree=(eL=oa(),tL=na(Gt.ICameraService),rL=na(Gt.IRendererService),eL(nL=(Ox=function(){function e(){Kt(this,e),$i(this,"cameraService",iL,this),$i(this,"rendererService",aL,this)}return Qt(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(n){n.addUniforms(tr({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),iL=ji(Ox.prototype,"cameraService",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aL=ji(Ox.prototype,"rendererService",[rL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox))||nL),oL,sL,nee=(oL=oa(),oL(sL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var n=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var i=t.getSource();i.inited&&n.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=t.getSource();return i.inited?n.prepareLayerModel(t):i.once("sourceUpdate",function(){n.prepareLayerModel(t)}),!1})}}]),e}())||sL),uL,lL,iee=(uL=oa(),uL(lL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&setTimeout(function(){t.fitBounds(a)},100)})}}]),e}())||lL),cL,fL,aee=["type"],hL={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},oee={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},see={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},uee={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function lee(e){var r={u_DirectionalLights:new Array(3).fill(tr({},see)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(tr({},uee)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[oee]),e.forEach(function(t,n){var i=t.type,a=i===void 0?"directional":i,o=b0(t,aee),l=hL[a].lights,c=hL[a].num,p=r[c];r[l][p]=tr(tr({},r[l][p]),o),r[c]++}),r}var cee=(cL=oa(),cL(fL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms(tr({},lee()))})})}}]),e}())||fL),pL,dL,vL,$E,mL,fee=(pL=oa(),dL=na(Gt.IGlobalConfigService),pL(vL=($E=function(){function e(){Kt(this,e),$i(this,"configService",mL,this)}return Qt(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var c=t.getLayerConfig(),p=c.enableMultiPassRenderer,y=c.passes,b=y===void 0?[]:y;i.enabled=!!p&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=fP(t,b,o,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=a.getViewportSize(),p=c.width,y=c.height;t.multiPassRenderer.resize(p,y)}})}}]),e}(),mL=ji($E.prototype,"configService",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$E))||vL),gL,yL,Px={NONE:0,ENCODE:1,HIGHLIGHT:2},hee=(gL=oa(),gL(yL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t,n){n.rendererService;var i=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;a.enableMultiPassRenderer,i.registerStyleAttribute({name:"pickingColor",type:_n.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:Q.FLOAT},size:3,update:function(c,p){var y=c.id;return o?bm(y):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;o&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:Px.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var a=t.getLayerConfig(),o=a.enablePicking;o&&t.isVisible()&&t.models.forEach(function(l){return l.addUniforms({u_PickingStage:Px.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(a){var o=t.getLayerConfig(),l=o.highlightColor,c=o.activeMix,p=c===void 0?0:c,y=typeof l=="string"?Lo(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Nv(new Uint8Array(a))}),t.models.forEach(function(b){return b.addUniforms({u_PickingStage:Px.HIGHLIGHT,u_PickingColor:a,u_HighlightColor:y.map(function(w){return w*255}),u_activeMix:p})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(a){var o=t.getLayerConfig(),l=o.selectColor,c=o.selectMix,p=c===void 0?0:c,y=typeof l=="string"?Lo(l):l||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Nv(new Uint8Array(a))}),t.models.forEach(function(b){return b.addUniforms({u_PickingStage:Px.HIGHLIGHT,u_PickingColor:a,u_HighlightColor:y.map(function(w){return w*255}),u_activeMix:p,u_CurrentSelectedId:a,u_SelectColor:y.map(function(w){return w*255}),u_EnableSelect:1})})})}}]),e}())||yL),_L,xL,pee=(_L=oa(),_L(xL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){i.registerBuiltinAttributes(a)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:_n.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:Q.FLOAT},size:3,update:function(i,a,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}}),t.registerStyleAttribute({name:"filter",type:_n.Attribute,descriptor:{name:"filter",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(i,a){var o=i.filter;return o?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:_n.Attribute,descriptor:{name:"a_Color",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:4,update:function(i,a){var o=i.color;return!o||!o.length?[1,1,1,1]:o}}}),t.registerStyleAttribute({name:"vertexId",type:_n.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:Q.DYNAMIC_DRAW,data:[],type:Q.FLOAT},size:1,update:function(i,a,o,l){return[a]}}})}}]),e}())||xL),bL,EL,CL,SL,wL,AL,Cy,TL,ML,IL,LL,dee=(bL=oa(),EL=na(Gt.ICameraService),CL=na(Gt.ICoordinateSystemService),SL=na(Gt.IRendererService),wL=na(Gt.IMapService),bL(AL=(Cy=function(){function e(){Kt(this,e),$i(this,"cameraService",TL,this),$i(this,"coordinateSystemService",ML,this),$i(this,"rendererService",IL,this),$i(this,"mapService",LL,this)}return Qt(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var l=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(l),i==="GAODE2.x"){var c=n.getLayerCenter(t);n.mapService.map.customCoords.setCenter(c),n.mapService.setCustomCoordCenter(c),a=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter()}var p=n.rendererService.getViewportSize(),y=p.width,b=p.height;t.models.forEach(function(w){var M;w.addUniforms((M={},ne(M,ag.ProjectionMatrix,n.cameraService.getProjectionMatrix()),ne(M,ag.ViewMatrix,n.cameraService.getViewMatrix()),ne(M,ag.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),ne(M,ag.Zoom,n.cameraService.getZoom()),ne(M,ag.ZoomScale,n.cameraService.getZoomScale()),ne(M,ag.FocalDistance,n.cameraService.getFocalDistance()),ne(M,ag.CameraPosition,n.cameraService.getCameraPosition()),ne(M,ng.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),ne(M,ng.ViewportCenter,n.coordinateSystemService.getViewportCenter()),ne(M,ng.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),ne(M,ng.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),ne(M,ng.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),ne(M,ng.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),ne(M,ng.Mvp,a),ne(M,"u_SceneCenterMKT",o),ne(M,"u_ViewportSize",[y,b]),ne(M,"u_ModelMatrix",n.cameraService.getModelMatrix()),ne(M,"u_DevicePixelRatio",Ho.devicePixelRatio),ne(M,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),ne(M,"u_shaderPick",Number(t.getShaderPickStat())),M))})})}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}}]),e}(),TL=ji(Cy.prototype,"cameraService",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ML=ji(Cy.prototype,"coordinateSystemService",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=ji(Cy.prototype,"rendererService",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LL=ji(Cy.prototype,"mapService",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy))||AL),kL,RL,vee=(kL=oa(),kL(RL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||RL),OL,PL,mee=(OL=oa(),OL(PL=function(){function e(){Kt(this,e)}return Qt(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||i.updateStyleAtrribute(t,{styleAttributeService:a})})}},{key:"updateStyleAtrribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter");if(i.getLayerStyleAttribute("shape"),o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){i.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),e}())||PL);hf.bind(Gt.ILayerPlugin).to(GK).inRequestScope();hf.bind(Gt.ILayerPlugin).to(pee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(tee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(VK).inRequestScope();hf.bind(Gt.ILayerPlugin).to(iee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(mee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(vee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(fee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(dee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(ree).inRequestScope();hf.bind(Gt.ILayerPlugin).to(cee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(hee).inRequestScope();hf.bind(Gt.ILayerPlugin).to(nee).inRequestScope();var mF={exports:{}},XE={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},ZE="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",gee={5:ZE,"5module":ZE+" export import",6:ZE+" const class extends export import super"},yee=/^in(stanceof)?$/,Qw="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",gF="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",_ee=new RegExp("["+Qw+"]"),xee=new RegExp("["+Qw+gF+"]");Qw=gF=null;var yF=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],bee=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function yS(e,r){for(var t=65536,n=0;n<r.length;n+=2){if(t+=r[n],t>e)return!1;if(t+=r[n+1],t>=e)return!0}}function Am(e,r){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&_ee.test(String.fromCharCode(e)):r===!1?!1:yS(e,yF)}function t_(e,r){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&xee.test(String.fromCharCode(e)):r===!1?!1:yS(e,yF)||yS(e,bee)}var Vo=function(r,t){t===void 0&&(t={}),this.label=r,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function nd(e,r){return new Vo(e,{beforeExpr:!0,binop:r})}var id={beforeExpr:!0},Tp={startsExpr:!0},Jw={};function vo(e,r){return r===void 0&&(r={}),r.keyword=e,Jw[e]=new Vo(e,r)}var Ae={num:new Vo("num",Tp),regexp:new Vo("regexp",Tp),string:new Vo("string",Tp),name:new Vo("name",Tp),eof:new Vo("eof"),bracketL:new Vo("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Vo("]"),braceL:new Vo("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Vo("}"),parenL:new Vo("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Vo(")"),comma:new Vo(",",id),semi:new Vo(";",id),colon:new Vo(":",id),dot:new Vo("."),question:new Vo("?",id),questionDot:new Vo("?."),arrow:new Vo("=>",id),template:new Vo("template"),invalidTemplate:new Vo("invalidTemplate"),ellipsis:new Vo("...",id),backQuote:new Vo("`",Tp),dollarBraceL:new Vo("${",{beforeExpr:!0,startsExpr:!0}),eq:new Vo("=",{beforeExpr:!0,isAssign:!0}),assign:new Vo("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Vo("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Vo("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:nd("||",1),logicalAND:nd("&&",2),bitwiseOR:nd("|",3),bitwiseXOR:nd("^",4),bitwiseAND:nd("&",5),equality:nd("==/!=/===/!==",6),relational:nd("</>/<=/>=",7),bitShift:nd("<</>>/>>>",8),plusMin:new Vo("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:nd("%",10),star:nd("*",10),slash:nd("/",10),starstar:new Vo("**",{beforeExpr:!0}),coalesce:nd("??",1),_break:vo("break"),_case:vo("case",id),_catch:vo("catch"),_continue:vo("continue"),_debugger:vo("debugger"),_default:vo("default",id),_do:vo("do",{isLoop:!0,beforeExpr:!0}),_else:vo("else",id),_finally:vo("finally"),_for:vo("for",{isLoop:!0}),_function:vo("function",Tp),_if:vo("if"),_return:vo("return",id),_switch:vo("switch"),_throw:vo("throw",id),_try:vo("try"),_var:vo("var"),_const:vo("const"),_while:vo("while",{isLoop:!0}),_with:vo("with"),_new:vo("new",{beforeExpr:!0,startsExpr:!0}),_this:vo("this",Tp),_super:vo("super",Tp),_class:vo("class",Tp),_extends:vo("extends",id),_export:vo("export"),_import:vo("import",Tp),_null:vo("null",Tp),_true:vo("true",Tp),_false:vo("false",Tp),_in:vo("in",{beforeExpr:!0,binop:7}),_instanceof:vo("instanceof",{beforeExpr:!0,binop:7}),_typeof:vo("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:vo("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:vo("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},pd=/\r\n?|\n|\u2028|\u2029/,j1=new RegExp(pd.source,"g");function ex(e,r){return e===10||e===13||!r&&(e===8232||e===8233)}var _F=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,sd=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,xF=Object.prototype,Eee=xF.hasOwnProperty,Cee=xF.toString;function d2(e,r){return Eee.call(e,r)}var FL=Array.isArray||function(e){return Cee.call(e)==="[object Array]"};function Sg(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var H1=function(r,t){this.line=r,this.column=t};H1.prototype.offset=function(r){return new H1(this.line,this.column+r)};var v2=function(r,t,n){this.start=t,this.end=n,r.sourceFile!==null&&(this.source=r.sourceFile)};function bF(e,r){for(var t=1,n=0;;){j1.lastIndex=n;var i=j1.exec(e);if(i&&i.index<r)++t,n=i.index+i[0].length;else return new H1(t,r-n)}}var _S={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function See(e){var r={};for(var t in _S)r[t]=e&&d2(e,t)?e[t]:_S[t];if(r.ecmaVersion>=2015&&(r.ecmaVersion-=2009),r.allowReserved==null&&(r.allowReserved=r.ecmaVersion<5),FL(r.onToken)){var n=r.onToken;r.onToken=function(i){return n.push(i)}}return FL(r.onComment)&&(r.onComment=wee(r,r.onComment)),r}function wee(e,r){return function(t,n,i,a,o,l){var c={type:t?"Block":"Line",value:n,start:i,end:a};e.locations&&(c.loc=new v2(this,o,l)),e.ranges&&(c.range=[i,a]),r.push(c)}}var W1=1,tx=2,eA=W1|tx,EF=4,CF=8,SF=16,wF=32,AF=64,TF=128;function tA(e,r){return tx|(e?EF:0)|(r?CF:0)}var DL=0,rA=1,C0=2,MF=3,IF=4,LF=5,jl=function(r,t,n){this.options=r=See(r),this.sourceFile=r.sourceFile,this.keywords=Sg(gee[r.ecmaVersion>=6?6:r.sourceType==="module"?"5module":5]);var i="";if(r.allowReserved!==!0){for(var a=r.ecmaVersion;!(i=XE[a]);a--);r.sourceType==="module"&&(i+=" await")}this.reservedWords=Sg(i);var o=(i?i+" ":"")+XE.strict;this.reservedWordsStrict=Sg(o),this.reservedWordsStrictBind=Sg(o+" "+XE.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf(`
`,n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(pd).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Ae.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=r.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&r.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(W1),this.regexpState=null},Wg={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};jl.prototype.parse=function(){var r=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(r)};Wg.inFunction.get=function(){return(this.currentVarScope().flags&tx)>0};Wg.inGenerator.get=function(){return(this.currentVarScope().flags&CF)>0};Wg.inAsync.get=function(){return(this.currentVarScope().flags&EF)>0};Wg.allowSuper.get=function(){return(this.currentThisScope().flags&AF)>0};Wg.allowDirectSuper.get=function(){return(this.currentThisScope().flags&TF)>0};Wg.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};jl.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&tx)>0};jl.extend=function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];for(var n=this,i=0;i<r.length;i++)n=r[i](n);return n};jl.parse=function(r,t){return new this(t,r).parse()};jl.parseExpressionAt=function(r,t,n){var i=new this(n,r,t);return i.nextToken(),i.parseExpression()};jl.tokenizer=function(r,t){return new this(t,r)};Object.defineProperties(jl.prototype,Wg);var Eh=jl.prototype,Aee=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Eh.strictDirective=function(e){for(;;){sd.lastIndex=e,e+=sd.exec(this.input)[0].length;var r=Aee.exec(this.input.slice(e));if(!r)return!1;if((r[1]||r[2])==="use strict"){sd.lastIndex=e+r[0].length;var t=sd.exec(this.input),n=t.index+t[0].length,i=this.input.charAt(n);return i===";"||i==="}"||pd.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||i==="!"&&this.input.charAt(n+1)==="=")}e+=r[0].length,sd.lastIndex=e,e+=sd.exec(this.input)[0].length,this.input[e]===";"&&e++}};Eh.eat=function(e){return this.type===e?(this.next(),!0):!1};Eh.isContextual=function(e){return this.type===Ae.name&&this.value===e&&!this.containsEsc};Eh.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1};Eh.expectContextual=function(e){this.eatContextual(e)||this.unexpected()};Eh.canInsertSemicolon=function(){return this.type===Ae.eof||this.type===Ae.braceR||pd.test(this.input.slice(this.lastTokEnd,this.start))};Eh.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Eh.semicolon=function(){!this.eat(Ae.semi)&&!this.insertSemicolon()&&this.unexpected()};Eh.afterTrailingComma=function(e,r){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),r||this.next(),!0};Eh.expect=function(e){this.eat(e)||this.unexpected()};Eh.unexpected=function(e){this.raise(e!=null?e:this.start,"Unexpected token")};function m2(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Eh.checkPatternErrors=function(e,r){if(!!e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var t=r?e.parenthesizedAssign:e.parenthesizedBind;t>-1&&this.raiseRecoverable(t,"Parenthesized pattern")}};Eh.checkExpressionErrors=function(e,r){if(!e)return!1;var t=e.shorthandAssign,n=e.doubleProto;if(!r)return t>=0||n>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")};Eh.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Eh.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var Ta=jl.prototype;Ta.parseTopLevel=function(e){var r={};for(e.body||(e.body=[]);this.type!==Ae.eof;){var t=this.parseStatement(null,!0,r);e.body.push(t)}if(this.inModule)for(var n=0,i=Object.keys(this.undefinedExports);n<i.length;n+=1){var a=i[n];this.raiseRecoverable(this.undefinedExports[a].start,"Export '"+a+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var nA={kind:"loop"},Tee={kind:"switch"};Ta.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;sd.lastIndex=this.pos;var r=sd.exec(this.input),t=this.pos+r[0].length,n=this.input.charCodeAt(t);if(n===91)return!0;if(e)return!1;if(n===123)return!0;if(Am(n,!0)){for(var i=t+1;t_(this.input.charCodeAt(i),!0);)++i;var a=this.input.slice(t,i);if(!yee.test(a))return!0}return!1};Ta.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;sd.lastIndex=this.pos;var e=sd.exec(this.input),r=this.pos+e[0].length;return!pd.test(this.input.slice(this.pos,r))&&this.input.slice(r,r+8)==="function"&&(r+8===this.input.length||!t_(this.input.charAt(r+8)))};Ta.parseStatement=function(e,r,t){var n=this.type,i=this.startNode(),a;switch(this.isLet(e)&&(n=Ae._var,a="let"),n){case Ae._break:case Ae._continue:return this.parseBreakContinueStatement(i,n.keyword);case Ae._debugger:return this.parseDebuggerStatement(i);case Ae._do:return this.parseDoStatement(i);case Ae._for:return this.parseForStatement(i);case Ae._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(i,!1,!e);case Ae._class:return e&&this.unexpected(),this.parseClass(i,!0);case Ae._if:return this.parseIfStatement(i);case Ae._return:return this.parseReturnStatement(i);case Ae._switch:return this.parseSwitchStatement(i);case Ae._throw:return this.parseThrowStatement(i);case Ae._try:return this.parseTryStatement(i);case Ae._const:case Ae._var:return a=a||this.value,e&&a!=="var"&&this.unexpected(),this.parseVarStatement(i,a);case Ae._while:return this.parseWhileStatement(i);case Ae._with:return this.parseWithStatement(i);case Ae.braceL:return this.parseBlock(!0,i);case Ae.semi:return this.parseEmptyStatement(i);case Ae._export:case Ae._import:if(this.options.ecmaVersion>10&&n===Ae._import){sd.lastIndex=this.pos;var o=sd.exec(this.input),l=this.pos+o[0].length,c=this.input.charCodeAt(l);if(c===40||c===46)return this.parseExpressionStatement(i,this.parseExpression())}return this.options.allowImportExportEverywhere||(r||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),n===Ae._import?this.parseImport(i):this.parseExport(i,t);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(i,!0,!e);var p=this.value,y=this.parseExpression();return n===Ae.name&&y.type==="Identifier"&&this.eat(Ae.colon)?this.parseLabeledStatement(i,p,y,e):this.parseExpressionStatement(i,y)}};Ta.parseBreakContinueStatement=function(e,r){var t=r==="break";this.next(),this.eat(Ae.semi)||this.insertSemicolon()?e.label=null:this.type!==Ae.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var i=this.labels[n];if((e.label==null||i.name===e.label.name)&&(i.kind!=null&&(t||i.kind==="loop")||e.label&&t))break}return n===this.labels.length&&this.raise(e.start,"Unsyntactic "+r),this.finishNode(e,t?"BreakStatement":"ContinueStatement")};Ta.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")};Ta.parseDoStatement=function(e){return this.next(),this.labels.push(nA),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(Ae._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Ae.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")};Ta.parseForStatement=function(e){this.next();var r=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(nA),this.enterScope(0),this.expect(Ae.parenL),this.type===Ae.semi)return r>-1&&this.unexpected(r),this.parseFor(e,null);var t=this.isLet();if(this.type===Ae._var||this.type===Ae._const||t){var n=this.startNode(),i=t?"let":this.value;return this.next(),this.parseVar(n,!0,i),this.finishNode(n,"VariableDeclaration"),(this.type===Ae._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&n.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Ae._in?r>-1&&this.unexpected(r):e.await=r>-1),this.parseForIn(e,n)):(r>-1&&this.unexpected(r),this.parseFor(e,n))}var a=new m2,o=this.parseExpression(!0,a);return this.type===Ae._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Ae._in?r>-1&&this.unexpected(r):e.await=r>-1),this.toAssignable(o,!1,a),this.checkLVal(o),this.parseForIn(e,o)):(this.checkExpressionErrors(a,!0),r>-1&&this.unexpected(r),this.parseFor(e,o))};Ta.parseFunctionStatement=function(e,r,t){return this.next(),this.parseFunction(e,c1|(t?0:xS),!1,r)};Ta.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(Ae._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")};Ta.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Ae.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")};Ta.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(Ae.braceL),this.labels.push(Tee),this.enterScope(0);for(var r,t=!1;this.type!==Ae.braceR;)if(this.type===Ae._case||this.type===Ae._default){var n=this.type===Ae._case;r&&this.finishNode(r,"SwitchCase"),e.cases.push(r=this.startNode()),r.consequent=[],this.next(),n?r.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,r.test=null),this.expect(Ae.colon)}else r||this.unexpected(),r.consequent.push(this.parseStatement(null));return this.exitScope(),r&&this.finishNode(r,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")};Ta.parseThrowStatement=function(e){return this.next(),pd.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var Mee=[];Ta.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===Ae._catch){var r=this.startNode();if(this.next(),this.eat(Ae.parenL)){r.param=this.parseBindingAtom();var t=r.param.type==="Identifier";this.enterScope(t?wF:0),this.checkLVal(r.param,t?IF:C0),this.expect(Ae.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),r.param=null,this.enterScope(0);r.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(r,"CatchClause")}return e.finalizer=this.eat(Ae._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")};Ta.parseVarStatement=function(e,r){return this.next(),this.parseVar(e,!1,r),this.semicolon(),this.finishNode(e,"VariableDeclaration")};Ta.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(nA),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")};Ta.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")};Ta.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")};Ta.parseLabeledStatement=function(e,r,t,n){for(var i=0,a=this.labels;i<a.length;i+=1){var o=a[i];o.name===r&&this.raise(t.start,"Label '"+r+"' is already declared")}for(var l=this.type.isLoop?"loop":this.type===Ae._switch?"switch":null,c=this.labels.length-1;c>=0;c--){var p=this.labels[c];if(p.statementStart===e.start)p.statementStart=this.start,p.kind=l;else break}return this.labels.push({name:r,kind:l,statementStart:this.start}),e.body=this.parseStatement(n?n.indexOf("label")===-1?n+"label":n:"label"),this.labels.pop(),e.label=t,this.finishNode(e,"LabeledStatement")};Ta.parseExpressionStatement=function(e,r){return e.expression=r,this.semicolon(),this.finishNode(e,"ExpressionStatement")};Ta.parseBlock=function(e,r,t){for(e===void 0&&(e=!0),r===void 0&&(r=this.startNode()),r.body=[],this.expect(Ae.braceL),e&&this.enterScope(0);this.type!==Ae.braceR;){var n=this.parseStatement(null);r.body.push(n)}return t&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(r,"BlockStatement")};Ta.parseFor=function(e,r){return e.init=r,this.expect(Ae.semi),e.test=this.type===Ae.semi?null:this.parseExpression(),this.expect(Ae.semi),e.update=this.type===Ae.parenR?null:this.parseExpression(),this.expect(Ae.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")};Ta.parseForIn=function(e,r){var t=this.type===Ae._in;return this.next(),r.type==="VariableDeclaration"&&r.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||r.kind!=="var"||r.declarations[0].id.type!=="Identifier")?this.raise(r.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"):r.type==="AssignmentPattern"&&this.raise(r.start,"Invalid left-hand side in for-loop"),e.left=r,e.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(Ae.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,t?"ForInStatement":"ForOfStatement")};Ta.parseVar=function(e,r,t){for(e.declarations=[],e.kind=t;;){var n=this.startNode();if(this.parseVarId(n,t),this.eat(Ae.eq)?n.init=this.parseMaybeAssign(r):t==="const"&&!(this.type===Ae._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():n.id.type!=="Identifier"&&!(r&&(this.type===Ae._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):n.init=null,e.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(Ae.comma))break}return e};Ta.parseVarId=function(e,r){e.id=this.parseBindingAtom(),this.checkLVal(e.id,r==="var"?rA:C0,!1)};var c1=1,xS=2,kF=4;Ta.parseFunction=function(e,r,t,n){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===Ae.star&&r&xS&&this.unexpected(),e.generator=this.eat(Ae.star)),this.options.ecmaVersion>=8&&(e.async=!!n),r&c1&&(e.id=r&kF&&this.type!==Ae.name?null:this.parseIdent(),e.id&&!(r&xS)&&this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?rA:C0:MF));var i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tA(e.async,e.generator)),r&c1||(e.id=this.type===Ae.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,t,!1),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(e,r&c1?"FunctionDeclaration":"FunctionExpression")};Ta.parseFunctionParams=function(e){this.expect(Ae.parenL),e.params=this.parseBindingList(Ae.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Ta.parseClass=function(e,r){this.next();var t=this.strict;this.strict=!0,this.parseClassId(e,r),this.parseClassSuper(e);var n=this.startNode(),i=!1;for(n.body=[],this.expect(Ae.braceL);this.type!==Ae.braceR;){var a=this.parseClassElement(e.superClass!==null);a&&(n.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"&&(i&&this.raise(a.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=t,this.next(),e.body=this.finishNode(n,"ClassBody"),this.finishNode(e,r?"ClassDeclaration":"ClassExpression")};Ta.parseClassElement=function(e){var r=this;if(this.eat(Ae.semi))return null;var t=this.startNode(),n=function(c,p){p===void 0&&(p=!1);var y=r.start,b=r.startLoc;return r.eatContextual(c)?r.type!==Ae.parenL&&(!p||!r.canInsertSemicolon())?!0:(t.key&&r.unexpected(),t.computed=!1,t.key=r.startNodeAt(y,b),t.key.name=c,r.finishNode(t.key,"Identifier"),!1):!1};t.kind="method",t.static=n("static");var i=this.eat(Ae.star),a=!1;i||(this.options.ecmaVersion>=8&&n("async",!0)?(a=!0,i=this.options.ecmaVersion>=9&&this.eat(Ae.star)):n("get")?t.kind="get":n("set")&&(t.kind="set")),t.key||this.parsePropertyName(t);var o=t.key,l=!1;return!t.computed&&!t.static&&(o.type==="Identifier"&&o.name==="constructor"||o.type==="Literal"&&o.value==="constructor")?(t.kind!=="method"&&this.raise(o.start,"Constructor can't have get/set modifier"),i&&this.raise(o.start,"Constructor can't be a generator"),a&&this.raise(o.start,"Constructor can't be an async method"),t.kind="constructor",l=e):t.static&&o.type==="Identifier"&&o.name==="prototype"&&this.raise(o.start,"Classes may not have a static property named prototype"),this.parseClassMethod(t,i,a,l),t.kind==="get"&&t.value.params.length!==0&&this.raiseRecoverable(t.value.start,"getter should have no params"),t.kind==="set"&&t.value.params.length!==1&&this.raiseRecoverable(t.value.start,"setter should have exactly one param"),t.kind==="set"&&t.value.params[0].type==="RestElement"&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params"),t};Ta.parseClassMethod=function(e,r,t,n){return e.value=this.parseMethod(r,t,n),this.finishNode(e,"MethodDefinition")};Ta.parseClassId=function(e,r){this.type===Ae.name?(e.id=this.parseIdent(),r&&this.checkLVal(e.id,C0,!1)):(r===!0&&this.unexpected(),e.id=null)};Ta.parseClassSuper=function(e){e.superClass=this.eat(Ae._extends)?this.parseExprSubscripts():null};Ta.parseExport=function(e,r){if(this.next(),this.eat(Ae.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(r,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==Ae.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(Ae._default)){this.checkExport(r,"default",this.lastTokStart);var t;if(this.type===Ae._function||(t=this.isAsyncFunction())){var n=this.startNode();this.next(),t&&this.next(),e.declaration=this.parseFunction(n,c1|kF,!1,t)}else if(this.type===Ae._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(r,e.declaration.declarations):this.checkExport(r,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(r),this.eatContextual("from"))this.type!==Ae.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var a=0,o=e.specifiers;a<o.length;a+=1){var l=o[a];this.checkUnreserved(l.local),this.checkLocalExport(l.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")};Ta.checkExport=function(e,r,t){!e||(d2(e,r)&&this.raiseRecoverable(t,"Duplicate export '"+r+"'"),e[r]=!0)};Ta.checkPatternExport=function(e,r){var t=r.type;if(t==="Identifier")this.checkExport(e,r.name,r.start);else if(t==="ObjectPattern")for(var n=0,i=r.properties;n<i.length;n+=1){var a=i[n];this.checkPatternExport(e,a)}else if(t==="ArrayPattern")for(var o=0,l=r.elements;o<l.length;o+=1){var c=l[o];c&&this.checkPatternExport(e,c)}else t==="Property"?this.checkPatternExport(e,r.value):t==="AssignmentPattern"?this.checkPatternExport(e,r.left):t==="RestElement"?this.checkPatternExport(e,r.argument):t==="ParenthesizedExpression"&&this.checkPatternExport(e,r.expression)};Ta.checkVariableExport=function(e,r){if(!!e)for(var t=0,n=r;t<n.length;t+=1){var i=n[t];this.checkPatternExport(e,i.id)}};Ta.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};Ta.parseExportSpecifiers=function(e){var r=[],t=!0;for(this.expect(Ae.braceL);!this.eat(Ae.braceR);){if(t)t=!1;else if(this.expect(Ae.comma),this.afterTrailingComma(Ae.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(e,n.exported.name,n.exported.start),r.push(this.finishNode(n,"ExportSpecifier"))}return r};Ta.parseImport=function(e){return this.next(),this.type===Ae.string?(e.specifiers=Mee,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===Ae.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")};Ta.parseImportSpecifiers=function(){var e=[],r=!0;if(this.type===Ae.name){var t=this.startNode();if(t.local=this.parseIdent(),this.checkLVal(t.local,C0),e.push(this.finishNode(t,"ImportDefaultSpecifier")),!this.eat(Ae.comma))return e}if(this.type===Ae.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,C0),e.push(this.finishNode(n,"ImportNamespaceSpecifier")),e}for(this.expect(Ae.braceL);!this.eat(Ae.braceR);){if(r)r=!1;else if(this.expect(Ae.comma),this.afterTrailingComma(Ae.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,C0),e.push(this.finishNode(i,"ImportSpecifier"))}return e};Ta.adaptDirectivePrologue=function(e){for(var r=0;r<e.length&&this.isDirectiveCandidate(e[r]);++r)e[r].directive=e[r].expression.raw.slice(1,-1)};Ta.isDirectiveCandidate=function(e){return e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]==='"'||this.input[e.start]==="'")};var I0=jl.prototype;I0.toAssignable=function(e,r,t){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var n=0,i=e.properties;n<i.length;n+=1){var a=i[n];this.toAssignable(a,r),a.type==="RestElement"&&(a.argument.type==="ArrayPattern"||a.argument.type==="ObjectPattern")&&this.raise(a.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,r);break;case"ArrayExpression":e.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(e.elements,r);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,r),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,r);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,r,t);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!r)break;default:this.raise(e.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return e};I0.toAssignableList=function(e,r){for(var t=e.length,n=0;n<t;n++){var i=e[n];i&&this.toAssignable(i,r)}if(t){var a=e[t-1];this.options.ecmaVersion===6&&r&&a&&a.type==="RestElement"&&a.argument.type!=="Identifier"&&this.unexpected(a.argument.start)}return e};I0.parseSpread=function(e){var r=this.startNode();return this.next(),r.argument=this.parseMaybeAssign(!1,e),this.finishNode(r,"SpreadElement")};I0.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Ae.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")};I0.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Ae.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(Ae.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case Ae.braceL:return this.parseObj(!0)}return this.parseIdent()};I0.parseBindingList=function(e,r,t){for(var n=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(Ae.comma),r&&this.type===Ae.comma)n.push(null);else{if(t&&this.afterTrailingComma(e))break;if(this.type===Ae.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),n.push(a),this.type===Ae.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else{var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),n.push(o)}}return n};I0.parseBindingListItem=function(e){return e};I0.parseMaybeDefault=function(e,r,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Ae.eq))return t;var n=this.startNodeAt(e,r);return n.left=t,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")};I0.checkLVal=function(e,r,t){switch(r===void 0&&(r=DL),e.type){case"Identifier":r===C0&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(r?"Binding ":"Assigning to ")+e.name+" in strict mode"),t&&(d2(t,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),t[e.name]=!0),r!==DL&&r!==LF&&this.declareName(e.name,r,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":r&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var n=0,i=e.properties;n<i.length;n+=1){var a=i[n];this.checkLVal(a,r,t)}break;case"Property":this.checkLVal(e.value,r,t);break;case"ArrayPattern":for(var o=0,l=e.elements;o<l.length;o+=1){var c=l[o];c&&this.checkLVal(c,r,t)}break;case"AssignmentPattern":this.checkLVal(e.left,r,t);break;case"RestElement":this.checkLVal(e.argument,r,t);break;case"ParenthesizedExpression":this.checkLVal(e.expression,r,t);break;default:this.raise(e.start,(r?"Binding":"Assigning to")+" rvalue")}};var ja=jl.prototype;ja.checkPropClash=function(e,r,t){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var n=e.key,i;switch(n.type){case"Identifier":i=n.name;break;case"Literal":i=String(n.value);break;default:return}var a=e.kind;if(this.options.ecmaVersion>=6){i==="__proto__"&&a==="init"&&(r.proto&&(t?t.doubleProto<0&&(t.doubleProto=n.start):this.raiseRecoverable(n.start,"Redefinition of __proto__ property")),r.proto=!0);return}i="$"+i;var o=r[i];if(o){var l;a==="init"?l=this.strict&&o.init||o.get||o.set:l=o.init||o[a],l&&this.raiseRecoverable(n.start,"Redefinition of property")}else o=r[i]={init:!1,get:!1,set:!1};o[a]=!0}};ja.parseExpression=function(e,r){var t=this.start,n=this.startLoc,i=this.parseMaybeAssign(e,r);if(this.type===Ae.comma){var a=this.startNodeAt(t,n);for(a.expressions=[i];this.eat(Ae.comma);)a.expressions.push(this.parseMaybeAssign(e,r));return this.finishNode(a,"SequenceExpression")}return i};ja.parseMaybeAssign=function(e,r,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var n=!1,i=-1,a=-1;r?(i=r.parenthesizedAssign,a=r.trailingComma,r.parenthesizedAssign=r.trailingComma=-1):(r=new m2,n=!0);var o=this.start,l=this.startLoc;(this.type===Ae.parenL||this.type===Ae.name)&&(this.potentialArrowAt=this.start);var c=this.parseMaybeConditional(e,r);if(t&&(c=t.call(this,c,o,l)),this.type.isAssign){var p=this.startNodeAt(o,l);return p.operator=this.value,p.left=this.type===Ae.eq?this.toAssignable(c,!1,r):c,n||(r.parenthesizedAssign=r.trailingComma=r.doubleProto=-1),r.shorthandAssign>=p.left.start&&(r.shorthandAssign=-1),this.checkLVal(c),this.next(),p.right=this.parseMaybeAssign(e),this.finishNode(p,"AssignmentExpression")}else n&&this.checkExpressionErrors(r,!0);return i>-1&&(r.parenthesizedAssign=i),a>-1&&(r.trailingComma=a),c};ja.parseMaybeConditional=function(e,r){var t=this.start,n=this.startLoc,i=this.parseExprOps(e,r);if(this.checkExpressionErrors(r))return i;if(this.eat(Ae.question)){var a=this.startNodeAt(t,n);return a.test=i,a.consequent=this.parseMaybeAssign(),this.expect(Ae.colon),a.alternate=this.parseMaybeAssign(e),this.finishNode(a,"ConditionalExpression")}return i};ja.parseExprOps=function(e,r){var t=this.start,n=this.startLoc,i=this.parseMaybeUnary(r,!1);return this.checkExpressionErrors(r)||i.start===t&&i.type==="ArrowFunctionExpression"?i:this.parseExprOp(i,t,n,-1,e)};ja.parseExprOp=function(e,r,t,n,i){var a=this.type.binop;if(a!=null&&(!i||this.type!==Ae._in)&&a>n){var o=this.type===Ae.logicalOR||this.type===Ae.logicalAND,l=this.type===Ae.coalesce;l&&(a=Ae.logicalAND.binop);var c=this.value;this.next();var p=this.start,y=this.startLoc,b=this.parseExprOp(this.parseMaybeUnary(null,!1),p,y,a,i),w=this.buildBinary(r,t,e,b,c,o||l);return(o&&this.type===Ae.coalesce||l&&(this.type===Ae.logicalOR||this.type===Ae.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(w,r,t,n,i)}return e};ja.buildBinary=function(e,r,t,n,i,a){var o=this.startNodeAt(e,r);return o.left=t,o.operator=i,o.right=n,this.finishNode(o,a?"LogicalExpression":"BinaryExpression")};ja.parseMaybeUnary=function(e,r){var t=this.start,n=this.startLoc,i;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),r=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===Ae.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),o?this.checkLVal(a.argument):this.strict&&a.operator==="delete"&&a.argument.type==="Identifier"?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):r=!0,i=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var l=this.startNodeAt(t,n);l.operator=this.value,l.prefix=!1,l.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(l,"UpdateExpression")}}return!r&&this.eat(Ae.starstar)?this.buildBinary(t,n,i,this.parseMaybeUnary(null,!1),"**",!1):i};ja.parseExprSubscripts=function(e){var r=this.start,t=this.startLoc,n=this.parseExprAtom(e);if(n.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return n;var i=this.parseSubscripts(n,r,t);return e&&i.type==="MemberExpression"&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i};ja.parseSubscripts=function(e,r,t,n){for(var i=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,a=!1;;){var o=this.parseSubscript(e,r,t,n,i,a);if(o.optional&&(a=!0),o===e||o.type==="ArrowFunctionExpression"){if(a){var l=this.startNodeAt(r,t);l.expression=o,o=this.finishNode(l,"ChainExpression")}return o}e=o}};ja.parseSubscript=function(e,r,t,n,i,a){var o=this.options.ecmaVersion>=11,l=o&&this.eat(Ae.questionDot);n&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(Ae.bracketL);if(c||l&&this.type!==Ae.parenL&&this.type!==Ae.backQuote||this.eat(Ae.dot)){var p=this.startNodeAt(r,t);p.object=e,p.property=c?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),p.computed=!!c,c&&this.expect(Ae.bracketR),o&&(p.optional=l),e=this.finishNode(p,"MemberExpression")}else if(!n&&this.eat(Ae.parenL)){var y=new m2,b=this.yieldPos,w=this.awaitPos,M=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var O=this.parseExprList(Ae.parenR,this.options.ecmaVersion>=8,!1,y);if(i&&!l&&!this.canInsertSemicolon()&&this.eat(Ae.arrow))return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=b,this.awaitPos=w,this.awaitIdentPos=M,this.parseArrowExpression(this.startNodeAt(r,t),O,!0);this.checkExpressionErrors(y,!0),this.yieldPos=b||this.yieldPos,this.awaitPos=w||this.awaitPos,this.awaitIdentPos=M||this.awaitIdentPos;var N=this.startNodeAt(r,t);N.callee=e,N.arguments=O,o&&(N.optional=l),e=this.finishNode(N,"CallExpression")}else if(this.type===Ae.backQuote){(l||a)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var z=this.startNodeAt(r,t);z.tag=e,z.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(z,"TaggedTemplateExpression")}return e};ja.parseExprAtom=function(e){this.type===Ae.slash&&this.readRegexp();var r,t=this.potentialArrowAt===this.start;switch(this.type){case Ae._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),r=this.startNode(),this.next(),this.type===Ae.parenL&&!this.allowDirectSuper&&this.raise(r.start,"super() call outside constructor of a subclass"),this.type!==Ae.dot&&this.type!==Ae.bracketL&&this.type!==Ae.parenL&&this.unexpected(),this.finishNode(r,"Super");case Ae._this:return r=this.startNode(),this.next(),this.finishNode(r,"ThisExpression");case Ae.name:var n=this.start,i=this.startLoc,a=this.containsEsc,o=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!a&&o.name==="async"&&!this.canInsertSemicolon()&&this.eat(Ae._function))return this.parseFunction(this.startNodeAt(n,i),0,!1,!0);if(t&&!this.canInsertSemicolon()){if(this.eat(Ae.arrow))return this.parseArrowExpression(this.startNodeAt(n,i),[o],!1);if(this.options.ecmaVersion>=8&&o.name==="async"&&this.type===Ae.name&&!a)return o=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Ae.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,i),[o],!0)}return o;case Ae.regexp:var l=this.value;return r=this.parseLiteral(l.value),r.regex={pattern:l.pattern,flags:l.flags},r;case Ae.num:case Ae.string:return this.parseLiteral(this.value);case Ae._null:case Ae._true:case Ae._false:return r=this.startNode(),r.value=this.type===Ae._null?null:this.type===Ae._true,r.raw=this.type.keyword,this.next(),this.finishNode(r,"Literal");case Ae.parenL:var c=this.start,p=this.parseParenAndDistinguishExpression(t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(p)&&(e.parenthesizedAssign=c),e.parenthesizedBind<0&&(e.parenthesizedBind=c)),p;case Ae.bracketL:return r=this.startNode(),this.next(),r.elements=this.parseExprList(Ae.bracketR,!0,!0,e),this.finishNode(r,"ArrayExpression");case Ae.braceL:return this.parseObj(!1,e);case Ae._function:return r=this.startNode(),this.next(),this.parseFunction(r,0);case Ae._class:return this.parseClass(this.startNode(),!1);case Ae._new:return this.parseNew();case Ae.backQuote:return this.parseTemplate();case Ae._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}};ja.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var r=this.parseIdent(!0);switch(this.type){case Ae.parenL:return this.parseDynamicImport(e);case Ae.dot:return e.meta=r,this.parseImportMeta(e);default:this.unexpected()}};ja.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(Ae.parenR)){var r=this.start;this.eat(Ae.comma)&&this.eat(Ae.parenR)?this.raiseRecoverable(r,"Trailing comma is not allowed in import()"):this.unexpected(r)}return this.finishNode(e,"ImportExpression")};ja.parseImportMeta=function(e){this.next();var r=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="meta"&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),r&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")};ja.parseLiteral=function(e){var r=this.startNode();return r.value=e,r.raw=this.input.slice(this.start,this.end),r.raw.charCodeAt(r.raw.length-1)===110&&(r.bigint=r.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(r,"Literal")};ja.parseParenExpression=function(){this.expect(Ae.parenL);var e=this.parseExpression();return this.expect(Ae.parenR),e};ja.parseParenAndDistinguishExpression=function(e){var r=this.start,t=this.startLoc,n,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,o=this.startLoc,l=[],c=!0,p=!1,y=new m2,b=this.yieldPos,w=this.awaitPos,M;for(this.yieldPos=0,this.awaitPos=0;this.type!==Ae.parenR;)if(c?c=!1:this.expect(Ae.comma),i&&this.afterTrailingComma(Ae.parenR,!0)){p=!0;break}else if(this.type===Ae.ellipsis){M=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===Ae.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,y,this.parseParenItem));var O=this.start,N=this.startLoc;if(this.expect(Ae.parenR),e&&!this.canInsertSemicolon()&&this.eat(Ae.arrow))return this.checkPatternErrors(y,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=b,this.awaitPos=w,this.parseParenArrowList(r,t,l);(!l.length||p)&&this.unexpected(this.lastTokStart),M&&this.unexpected(M),this.checkExpressionErrors(y,!0),this.yieldPos=b||this.yieldPos,this.awaitPos=w||this.awaitPos,l.length>1?(n=this.startNodeAt(a,o),n.expressions=l,this.finishNodeAt(n,"SequenceExpression",O,N)):n=l[0]}else n=this.parseParenExpression();if(this.options.preserveParens){var z=this.startNodeAt(r,t);return z.expression=n,this.finishNode(z,"ParenthesizedExpression")}else return n};ja.parseParenItem=function(e){return e};ja.parseParenArrowList=function(e,r,t){return this.parseArrowExpression(this.startNodeAt(e,r),t)};var Iee=[];ja.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),r=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Ae.dot)){e.meta=r;var t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="target"&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var n=this.start,i=this.startLoc,a=this.type===Ae._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),n,i,!0),a&&e.callee.type==="ImportExpression"&&this.raise(n,"Cannot use new with import()"),this.eat(Ae.parenL)?e.arguments=this.parseExprList(Ae.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Iee,this.finishNode(e,"NewExpression")};ja.parseTemplateElement=function(e){var r=e.isTagged,t=this.startNode();return this.type===Ae.invalidTemplate?(r||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value,cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===Ae.backQuote,this.finishNode(t,"TemplateElement")};ja.parseTemplate=function(e){e===void 0&&(e={});var r=e.isTagged;r===void 0&&(r=!1);var t=this.startNode();this.next(),t.expressions=[];var n=this.parseTemplateElement({isTagged:r});for(t.quasis=[n];!n.tail;)this.type===Ae.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Ae.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(Ae.braceR),t.quasis.push(n=this.parseTemplateElement({isTagged:r}));return this.next(),this.finishNode(t,"TemplateLiteral")};ja.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===Ae.name||this.type===Ae.num||this.type===Ae.string||this.type===Ae.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Ae.star)&&!pd.test(this.input.slice(this.lastTokEnd,this.start))};ja.parseObj=function(e,r){var t=this.startNode(),n=!0,i={};for(t.properties=[],this.next();!this.eat(Ae.braceR);){if(n)n=!1;else if(this.expect(Ae.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Ae.braceR))break;var a=this.parseProperty(e,r);e||this.checkPropClash(a,i,r),t.properties.push(a)}return this.finishNode(t,e?"ObjectPattern":"ObjectExpression")};ja.parseProperty=function(e,r){var t=this.startNode(),n,i,a,o;if(this.options.ecmaVersion>=9&&this.eat(Ae.ellipsis))return e?(t.argument=this.parseIdent(!1),this.type===Ae.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(this.type===Ae.parenL&&r&&(r.parenthesizedAssign<0&&(r.parenthesizedAssign=this.start),r.parenthesizedBind<0&&(r.parenthesizedBind=this.start)),t.argument=this.parseMaybeAssign(!1,r),this.type===Ae.comma&&r&&r.trailingComma<0&&(r.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(e||r)&&(a=this.start,o=this.startLoc),e||(n=this.eat(Ae.star)));var l=this.containsEsc;return this.parsePropertyName(t),!e&&!l&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(t)?(i=!0,n=this.options.ecmaVersion>=9&&this.eat(Ae.star),this.parsePropertyName(t,r)):i=!1,this.parsePropertyValue(t,e,n,i,a,o,r,l),this.finishNode(t,"Property")};ja.parsePropertyValue=function(e,r,t,n,i,a,o,l){if((t||n)&&this.type===Ae.colon&&this.unexpected(),this.eat(Ae.colon))e.value=r?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Ae.parenL)r&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(t,n);else if(!r&&!l&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==Ae.comma&&this.type!==Ae.braceR&&this.type!==Ae.eq){(t||n)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var c=e.kind==="get"?0:1;if(e.value.params.length!==c){var p=e.value.start;e.kind==="get"?this.raiseRecoverable(p,"getter should have no params"):this.raiseRecoverable(p,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((t||n)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=i),e.kind="init",r?e.value=this.parseMaybeDefault(i,a,e.key):this.type===Ae.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,a,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected()};ja.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(Ae.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(Ae.bracketR),e.key;e.computed=!1}return e.key=this.type===Ae.num||this.type===Ae.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};ja.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)};ja.parseMethod=function(e,r,t){var n=this.startNode(),i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!r),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(tA(r,n.generator)|AF|(t?TF:0)),this.expect(Ae.parenL),n.params=this.parseBindingList(Ae.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(n,"FunctionExpression")};ja.parseArrowExpression=function(e,r,t){var n=this.yieldPos,i=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(tA(t,!1)|SF),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(r,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=n,this.awaitPos=i,this.awaitIdentPos=a,this.finishNode(e,"ArrowFunctionExpression")};ja.parseFunctionBody=function(e,r,t){var n=r&&this.type!==Ae.braceL,i=this.strict,a=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!i||o)&&(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!i&&!a&&!r&&!t&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,LF),e.body=this.parseBlock(!1,void 0,a&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=l}this.exitScope()};ja.isSimpleParamList=function(e){for(var r=0,t=e;r<t.length;r+=1){var n=t[r];if(n.type!=="Identifier")return!1}return!0};ja.checkParams=function(e,r){for(var t={},n=0,i=e.params;n<i.length;n+=1){var a=i[n];this.checkLVal(a,rA,r?null:t)}};ja.parseExprList=function(e,r,t,n){for(var i=[],a=!0;!this.eat(e);){if(a)a=!1;else if(this.expect(Ae.comma),r&&this.afterTrailingComma(e))break;var o=void 0;t&&this.type===Ae.comma?o=null:this.type===Ae.ellipsis?(o=this.parseSpread(n),n&&this.type===Ae.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):o=this.parseMaybeAssign(!1,n),i.push(o)}return i};ja.checkUnreserved=function(e){var r=e.start,t=e.end,n=e.name;if(this.inGenerator&&n==="yield"&&this.raiseRecoverable(r,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&n==="await"&&this.raiseRecoverable(r,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(n)&&this.raise(r,"Unexpected keyword '"+n+"'"),!(this.options.ecmaVersion<6&&this.input.slice(r,t).indexOf("\\")!==-1)){var i=this.strict?this.reservedWordsStrict:this.reservedWords;i.test(n)&&(!this.inAsync&&n==="await"&&this.raiseRecoverable(r,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(r,"The keyword '"+n+"' is reserved"))}};ja.parseIdent=function(e,r){var t=this.startNode();return this.type===Ae.name?t.name=this.value:this.type.keyword?(t.name=this.type.keyword,(t.name==="class"||t.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(t,"Identifier"),e||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t};ja.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var r=this.startNode();return this.next(),this.type===Ae.semi||this.canInsertSemicolon()||this.type!==Ae.star&&!this.type.startsExpr?(r.delegate=!1,r.argument=null):(r.delegate=this.eat(Ae.star),r.argument=this.parseMaybeAssign(e)),this.finishNode(r,"YieldExpression")};ja.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var Pb=jl.prototype;Pb.raise=function(e,r){var t=bF(this.input,e);r+=" ("+t.line+":"+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=this.pos,n};Pb.raiseRecoverable=Pb.raise;Pb.curPosition=function(){if(this.options.locations)return new H1(this.curLine,this.pos-this.lineStart)};var Lm=jl.prototype,Lee=function(r){this.flags=r,this.var=[],this.lexical=[],this.functions=[]};Lm.enterScope=function(e){this.scopeStack.push(new Lee(e))};Lm.exitScope=function(){this.scopeStack.pop()};Lm.treatFunctionsAsVarInScope=function(e){return e.flags&tx||!this.inModule&&e.flags&W1};Lm.declareName=function(e,r,t){var n=!1;if(r===C0){var i=this.currentScope();n=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&i.flags&W1&&delete this.undefinedExports[e]}else if(r===IF){var a=this.currentScope();a.lexical.push(e)}else if(r===MF){var o=this.currentScope();this.treatFunctionsAsVar?n=o.lexical.indexOf(e)>-1:n=o.lexical.indexOf(e)>-1||o.var.indexOf(e)>-1,o.functions.push(e)}else for(var l=this.scopeStack.length-1;l>=0;--l){var c=this.scopeStack[l];if(c.lexical.indexOf(e)>-1&&!(c.flags&wF&&c.lexical[0]===e)||!this.treatFunctionsAsVarInScope(c)&&c.functions.indexOf(e)>-1){n=!0;break}if(c.var.push(e),this.inModule&&c.flags&W1&&delete this.undefinedExports[e],c.flags&eA)break}n&&this.raiseRecoverable(t,"Identifier '"+e+"' has already been declared")};Lm.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)};Lm.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Lm.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var r=this.scopeStack[e];if(r.flags&eA)return r}};Lm.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var r=this.scopeStack[e];if(r.flags&eA&&!(r.flags&SF))return r}};var iA=function(r,t,n){this.type="",this.start=t,this.end=0,r.options.locations&&(this.loc=new v2(r,n)),r.options.directSourceFile&&(this.sourceFile=r.options.directSourceFile),r.options.ranges&&(this.range=[t,0])},g2=jl.prototype;g2.startNode=function(){return new iA(this,this.start,this.startLoc)};g2.startNodeAt=function(e,r){return new iA(this,e,r)};function RF(e,r,t,n){return e.type=r,e.end=t,this.options.locations&&(e.loc.end=n),this.options.ranges&&(e.range[1]=t),e}g2.finishNode=function(e,r){return RF.call(this,e,r,this.lastTokEnd,this.lastTokEndLoc)};g2.finishNodeAt=function(e,r,t,n){return RF.call(this,e,r,t,n)};var Ud=function(r,t,n,i,a){this.token=r,this.isExpr=!!t,this.preserveSpace=!!n,this.override=i,this.generator=!!a},ml={b_stat:new Ud("{",!1),b_expr:new Ud("{",!0),b_tmpl:new Ud("${",!1),p_stat:new Ud("(",!1),p_expr:new Ud("(",!0),q_tmpl:new Ud("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new Ud("function",!1),f_expr:new Ud("function",!0),f_expr_gen:new Ud("function",!0,!1,null,!0),f_gen:new Ud("function",!1,!1,null,!0)},y2=jl.prototype;y2.initialContext=function(){return[ml.b_stat]};y2.braceIsBlock=function(e){var r=this.curContext();return r===ml.f_expr||r===ml.f_stat?!0:e===Ae.colon&&(r===ml.b_stat||r===ml.b_expr)?!r.isExpr:e===Ae._return||e===Ae.name&&this.exprAllowed?pd.test(this.input.slice(this.lastTokEnd,this.start)):e===Ae._else||e===Ae.semi||e===Ae.eof||e===Ae.parenR||e===Ae.arrow?!0:e===Ae.braceL?r===ml.b_stat:e===Ae._var||e===Ae._const||e===Ae.name?!1:!this.exprAllowed};y2.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var r=this.context[e];if(r.token==="function")return r.generator}return!1};y2.updateContext=function(e){var r,t=this.type;t.keyword&&e===Ae.dot?this.exprAllowed=!1:(r=t.updateContext)?r.call(this,e):this.exprAllowed=t.beforeExpr};Ae.parenR.updateContext=Ae.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===ml.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr};Ae.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?ml.b_stat:ml.b_expr),this.exprAllowed=!0};Ae.dollarBraceL.updateContext=function(){this.context.push(ml.b_tmpl),this.exprAllowed=!0};Ae.parenL.updateContext=function(e){var r=e===Ae._if||e===Ae._for||e===Ae._with||e===Ae._while;this.context.push(r?ml.p_stat:ml.p_expr),this.exprAllowed=!0};Ae.incDec.updateContext=function(){};Ae._function.updateContext=Ae._class.updateContext=function(e){e.beforeExpr&&e!==Ae.semi&&e!==Ae._else&&!(e===Ae._return&&pd.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===Ae.colon||e===Ae.braceL)&&this.curContext()===ml.b_stat)?this.context.push(ml.f_expr):this.context.push(ml.f_stat),this.exprAllowed=!1};Ae.backQuote.updateContext=function(){this.curContext()===ml.q_tmpl?this.context.pop():this.context.push(ml.q_tmpl),this.exprAllowed=!1};Ae.star.updateContext=function(e){if(e===Ae._function){var r=this.context.length-1;this.context[r]===ml.f_expr?this.context[r]=ml.f_expr_gen:this.context[r]=ml.f_gen}this.exprAllowed=!0};Ae.name.updateContext=function(e){var r=!1;this.options.ecmaVersion>=6&&e!==Ae.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(r=!0),this.exprAllowed=r};var OF="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",PF=OF+" Extended_Pictographic",kee=PF,Ree={9:OF,10:PF,11:kee},BL="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",FF="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",DF=FF+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Oee=DF+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Pee={9:FF,10:DF,11:Oee},BF={};function aA(e){var r=BF[e]={binary:Sg(Ree[e]+" "+BL),nonBinary:{General_Category:Sg(BL),Script:Sg(Pee[e])}};r.nonBinary.Script_Extensions=r.nonBinary.Script,r.nonBinary.gc=r.nonBinary.General_Category,r.nonBinary.sc=r.nonBinary.Script,r.nonBinary.scx=r.nonBinary.Script_Extensions}aA(9);aA(10);aA(11);var Hi=jl.prototype,L0=function(r){this.parser=r,this.validFlags="gim"+(r.options.ecmaVersion>=6?"uy":"")+(r.options.ecmaVersion>=9?"s":""),this.unicodeProperties=BF[r.options.ecmaVersion>=11?11:r.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};L0.prototype.reset=function(r,t,n){var i=n.indexOf("u")!==-1;this.start=r|0,this.source=t+"",this.flags=n,this.switchU=i&&this.parser.options.ecmaVersion>=6,this.switchN=i&&this.parser.options.ecmaVersion>=9};L0.prototype.raise=function(r){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+r)};L0.prototype.at=function(r,t){t===void 0&&(t=!1);var n=this.source,i=n.length;if(r>=i)return-1;var a=n.charCodeAt(r);if(!(t||this.switchU)||a<=55295||a>=57344||r+1>=i)return a;var o=n.charCodeAt(r+1);return o>=56320&&o<=57343?(a<<10)+o-56613888:a};L0.prototype.nextIndex=function(r,t){t===void 0&&(t=!1);var n=this.source,i=n.length;if(r>=i)return i;var a=n.charCodeAt(r),o;return!(t||this.switchU)||a<=55295||a>=57344||r+1>=i||(o=n.charCodeAt(r+1))<56320||o>57343?r+1:r+2};L0.prototype.current=function(r){return r===void 0&&(r=!1),this.at(this.pos,r)};L0.prototype.lookahead=function(r){return r===void 0&&(r=!1),this.at(this.nextIndex(this.pos,r),r)};L0.prototype.advance=function(r){r===void 0&&(r=!1),this.pos=this.nextIndex(this.pos,r)};L0.prototype.eat=function(r,t){return t===void 0&&(t=!1),this.current(t)===r?(this.advance(t),!0):!1};function Fb(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}Hi.validateRegExpFlags=function(e){for(var r=e.validFlags,t=e.flags,n=0;n<t.length;n++){var i=t.charAt(n);r.indexOf(i)===-1&&this.raise(e.start,"Invalid regular expression flag"),t.indexOf(i,n+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}};Hi.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))};Hi.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var r=0,t=e.backReferenceNames;r<t.length;r+=1){var n=t[r];e.groupNames.indexOf(n)===-1&&e.raise("Invalid named capture referenced")}};Hi.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")};Hi.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););};Hi.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1};Hi.regexp_eatAssertion=function(e){var r=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=r}if(e.eat(40)&&e.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!t,!0}return e.pos=r,!1};Hi.regexp_eatQuantifier=function(e,r){return r===void 0&&(r=!1),this.regexp_eatQuantifierPrefix(e,r)?(e.eat(63),!0):!1};Hi.regexp_eatQuantifierPrefix=function(e,r){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,r)};Hi.regexp_eatBracedQuantifier=function(e,r){var t=e.pos;if(e.eat(123)){var n=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(n=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return i!==-1&&i<n&&!r&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!r&&e.raise("Incomplete quantifier"),e.pos=t}return!1};Hi.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)};Hi.regexp_eatReverseSolidusAtomEscape=function(e){var r=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=r}return!1};Hi.regexp_eatUncapturingGroup=function(e){var r=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=r}return!1};Hi.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1};Hi.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)};Hi.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1};Hi.regexp_eatSyntaxCharacter=function(e){var r=e.current();return NF(r)?(e.lastIntValue=r,e.advance(),!0):!1};function NF(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}Hi.regexp_eatPatternCharacters=function(e){for(var r=e.pos,t=0;(t=e.current())!==-1&&!NF(t);)e.advance();return e.pos!==r};Hi.regexp_eatExtendedPatternCharacter=function(e){var r=e.current();return r!==-1&&r!==36&&!(r>=40&&r<=43)&&r!==46&&r!==63&&r!==91&&r!==94&&r!==124?(e.advance(),!0):!1};Hi.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e)){e.groupNames.indexOf(e.lastStringValue)!==-1&&e.raise("Duplicate capture group name"),e.groupNames.push(e.lastStringValue);return}e.raise("Invalid group")}};Hi.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1};Hi.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=Fb(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=Fb(e.lastIntValue);return!0}return!1};Hi.regexp_eatRegExpIdentifierStart=function(e){var r=e.pos,t=this.options.ecmaVersion>=11,n=e.current(t);return e.advance(t),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,t)&&(n=e.lastIntValue),Fee(n)?(e.lastIntValue=n,!0):(e.pos=r,!1)};function Fee(e){return Am(e,!0)||e===36||e===95}Hi.regexp_eatRegExpIdentifierPart=function(e){var r=e.pos,t=this.options.ecmaVersion>=11,n=e.current(t);return e.advance(t),n===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,t)&&(n=e.lastIntValue),Dee(n)?(e.lastIntValue=n,!0):(e.pos=r,!1)};function Dee(e){return t_(e,!0)||e===36||e===95||e===8204||e===8205}Hi.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)};Hi.regexp_eatBackReference=function(e){var r=e.pos;if(this.regexp_eatDecimalEscape(e)){var t=e.lastIntValue;if(e.switchU)return t>e.maxBackReference&&(e.maxBackReference=t),!0;if(t<=e.numCapturingParens)return!0;e.pos=r}return!1};Hi.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1};Hi.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)};Hi.regexp_eatCControlLetter=function(e){var r=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=r}return!1};Hi.regexp_eatZero=function(e){return e.current()===48&&!_2(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1};Hi.regexp_eatControlEscape=function(e){var r=e.current();return r===116?(e.lastIntValue=9,e.advance(),!0):r===110?(e.lastIntValue=10,e.advance(),!0):r===118?(e.lastIntValue=11,e.advance(),!0):r===102?(e.lastIntValue=12,e.advance(),!0):r===114?(e.lastIntValue=13,e.advance(),!0):!1};Hi.regexp_eatControlLetter=function(e){var r=e.current();return zF(r)?(e.lastIntValue=r%32,e.advance(),!0):!1};function zF(e){return e>=65&&e<=90||e>=97&&e<=122}Hi.regexp_eatRegExpUnicodeEscapeSequence=function(e,r){r===void 0&&(r=!1);var t=e.pos,n=r||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var i=e.lastIntValue;if(n&&i>=55296&&i<=56319){var a=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var o=e.lastIntValue;if(o>=56320&&o<=57343)return e.lastIntValue=(i-55296)*1024+(o-56320)+65536,!0}e.pos=a,e.lastIntValue=i}return!0}if(n&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&Bee(e.lastIntValue))return!0;n&&e.raise("Invalid unicode escape"),e.pos=t}return!1};function Bee(e){return e>=0&&e<=1114111}Hi.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var r=e.current();return r!==99&&(!e.switchN||r!==107)?(e.lastIntValue=r,e.advance(),!0):!1};Hi.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var r=e.current();if(r>=49&&r<=57){do e.lastIntValue=10*e.lastIntValue+(r-48),e.advance();while((r=e.current())>=48&&r<=57);return!0}return!1};Hi.regexp_eatCharacterClassEscape=function(e){var r=e.current();if(Nee(r))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(r===80||r===112)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1};function Nee(e){return e===100||e===68||e===115||e===83||e===119||e===87}Hi.regexp_eatUnicodePropertyValueExpression=function(e){var r=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var t=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var n=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,t,n),!0}}if(e.pos=r,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1};Hi.regexp_validateUnicodePropertyNameAndValue=function(e,r,t){d2(e.unicodeProperties.nonBinary,r)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[r].test(t)||e.raise("Invalid property value")};Hi.regexp_validateUnicodePropertyNameOrValue=function(e,r){e.unicodeProperties.binary.test(r)||e.raise("Invalid property name")};Hi.regexp_eatUnicodePropertyName=function(e){var r=0;for(e.lastStringValue="";UF(r=e.current());)e.lastStringValue+=Fb(r),e.advance();return e.lastStringValue!==""};function UF(e){return zF(e)||e===95}Hi.regexp_eatUnicodePropertyValue=function(e){var r=0;for(e.lastStringValue="";zee(r=e.current());)e.lastStringValue+=Fb(r),e.advance();return e.lastStringValue!==""};function zee(e){return UF(e)||_2(e)}Hi.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)};Hi.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1};Hi.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var r=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var t=e.lastIntValue;e.switchU&&(r===-1||t===-1)&&e.raise("Invalid character class"),r!==-1&&t!==-1&&r>t&&e.raise("Range out of order in character class")}}};Hi.regexp_eatClassAtom=function(e){var r=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var t=e.current();(t===99||jF(t))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=r}var n=e.current();return n!==93?(e.lastIntValue=n,e.advance(),!0):!1};Hi.regexp_eatClassEscape=function(e){var r=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=r}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)};Hi.regexp_eatClassControlLetter=function(e){var r=e.current();return _2(r)||r===95?(e.lastIntValue=r%32,e.advance(),!0):!1};Hi.regexp_eatHexEscapeSequence=function(e){var r=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=r}return!1};Hi.regexp_eatDecimalDigits=function(e){var r=e.pos,t=0;for(e.lastIntValue=0;_2(t=e.current());)e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();return e.pos!==r};function _2(e){return e>=48&&e<=57}Hi.regexp_eatHexDigits=function(e){var r=e.pos,t=0;for(e.lastIntValue=0;VF(t=e.current());)e.lastIntValue=16*e.lastIntValue+GF(t),e.advance();return e.pos!==r};function VF(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function GF(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}Hi.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var r=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;r<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=r*64+t*8+e.lastIntValue:e.lastIntValue=r*8+t}else e.lastIntValue=r;return!0}return!1};Hi.regexp_eatOctalDigit=function(e){var r=e.current();return jF(r)?(e.lastIntValue=r-48,e.advance(),!0):(e.lastIntValue=0,!1)};function jF(e){return e>=48&&e<=55}Hi.regexp_eatFixedHexDigits=function(e,r){var t=e.pos;e.lastIntValue=0;for(var n=0;n<r;++n){var i=e.current();if(!VF(i))return e.pos=t,!1;e.lastIntValue=16*e.lastIntValue+GF(i),e.advance()}return!0};var oA=function(r){this.type=r.type,this.value=r.value,this.start=r.start,this.end=r.end,r.options.locations&&(this.loc=new v2(r,r.startLoc,r.endLoc)),r.options.ranges&&(this.range=[r.start,r.end])},so=jl.prototype;so.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new oA(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};so.getToken=function(){return this.next(),new oA(this)};typeof Symbol<"u"&&(so[Symbol.iterator]=function(){var e=this;return{next:function(){var r=e.getToken();return{done:r.type===Ae.eof,value:r}}}});so.curContext=function(){return this.context[this.context.length-1]};so.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Ae.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())};so.readToken=function(e){return Am(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)};so.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;var r=this.input.charCodeAt(this.pos+1);return(e<<10)+r-56613888};so.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),r=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations){j1.lastIndex=r;for(var n;(n=j1.exec(this.input))&&n.index<this.pos;)++this.curLine,this.lineStart=n.index+n[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(r+2,t),r,this.pos,e,this.curPosition())};so.skipLineComment=function(e){for(var r=this.pos,t=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!ex(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(r+e,this.pos),r,this.pos,t,this.curPosition())};so.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&_F.test(String.fromCharCode(e)))++this.pos;else break e}}};so.finishToken=function(e,r){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=e,this.value=r,this.updateContext(t)};so.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var r=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&r===46?(this.pos+=3,this.finishToken(Ae.ellipsis)):(++this.pos,this.finishToken(Ae.dot))};so.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(Ae.assign,2):this.finishOp(Ae.slash,1)};so.readToken_mult_modulo_exp=function(e){var r=this.input.charCodeAt(this.pos+1),t=1,n=e===42?Ae.star:Ae.modulo;return this.options.ecmaVersion>=7&&e===42&&r===42&&(++t,n=Ae.starstar,r=this.input.charCodeAt(this.pos+2)),r===61?this.finishOp(Ae.assign,t+1):this.finishOp(n,t)};so.readToken_pipe_amp=function(e){var r=this.input.charCodeAt(this.pos+1);if(r===e){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(Ae.assign,3)}return this.finishOp(e===124?Ae.logicalOR:Ae.logicalAND,2)}return r===61?this.finishOp(Ae.assign,2):this.finishOp(e===124?Ae.bitwiseOR:Ae.bitwiseAND,1)};so.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(Ae.assign,2):this.finishOp(Ae.bitwiseXOR,1)};so.readToken_plus_min=function(e){var r=this.input.charCodeAt(this.pos+1);return r===e?r===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||pd.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Ae.incDec,2):r===61?this.finishOp(Ae.assign,2):this.finishOp(Ae.plusMin,1)};so.readToken_lt_gt=function(e){var r=this.input.charCodeAt(this.pos+1),t=1;return r===e?(t=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(Ae.assign,t+1):this.finishOp(Ae.bitShift,t)):r===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(r===61&&(t=2),this.finishOp(Ae.relational,t))};so.readToken_eq_excl=function(e){var r=this.input.charCodeAt(this.pos+1);return r===61?this.finishOp(Ae.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&r===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Ae.arrow)):this.finishOp(e===61?Ae.eq:Ae.prefix,1)};so.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var r=this.input.charCodeAt(this.pos+1);if(r===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(Ae.questionDot,2)}if(r===63){if(e>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(Ae.assign,3)}return this.finishOp(Ae.coalesce,2)}}return this.finishOp(Ae.question,1)};so.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Ae.parenL);case 41:return++this.pos,this.finishToken(Ae.parenR);case 59:return++this.pos,this.finishToken(Ae.semi);case 44:return++this.pos,this.finishToken(Ae.comma);case 91:return++this.pos,this.finishToken(Ae.bracketL);case 93:return++this.pos,this.finishToken(Ae.bracketR);case 123:return++this.pos,this.finishToken(Ae.braceL);case 125:return++this.pos,this.finishToken(Ae.braceR);case 58:return++this.pos,this.finishToken(Ae.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Ae.backQuote);case 48:var r=this.input.charCodeAt(this.pos+1);if(r===120||r===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(r===111||r===79)return this.readRadixNumber(8);if(r===98||r===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(Ae.prefix,1)}this.raise(this.pos,"Unexpected character '"+sA(e)+"'")};so.finishOp=function(e,r){var t=this.input.slice(this.pos,this.pos+r);return this.pos+=r,this.finishToken(e,t)};so.readRegexp=function(){for(var e,r,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(pd.test(n)&&this.raise(t,"Unterminated regular expression"),e)e=!1;else{if(n==="[")r=!0;else if(n==="]"&&r)r=!1;else if(n==="/"&&!r)break;e=n==="\\"}++this.pos}var i=this.input.slice(t,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var l=this.regexpState||(this.regexpState=new L0(this));l.reset(t,i,o),this.validateRegExpFlags(l),this.validateRegExpPattern(l);var c=null;try{c=new RegExp(i,o)}catch{}return this.finishToken(Ae.regexp,{pattern:i,flags:o,value:c})};so.readInt=function(e,r,t){for(var n=this.options.ecmaVersion>=12&&r===void 0,i=t&&this.input.charCodeAt(this.pos)===48,a=this.pos,o=0,l=0,c=0,p=r==null?1/0:r;c<p;++c,++this.pos){var y=this.input.charCodeAt(this.pos),b=void 0;if(n&&y===95){i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),l===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),c===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),l=y;continue}if(y>=97?b=y-97+10:y>=65?b=y-65+10:y>=48&&y<=57?b=y-48:b=1/0,b>=e)break;l=y,o=o*e+b}return n&&l===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===a||r!=null&&this.pos-a!==r?null:o};function Uee(e,r){return r?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function HF(e){return typeof BigInt!="function"?null:BigInt(e.replace(/_/g,""))}so.readRadixNumber=function(e){var r=this.pos;this.pos+=2;var t=this.readInt(e);return t==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=HF(this.input.slice(r,this.pos)),++this.pos):Am(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Ae.num,t)};so.readNumber=function(e){var r=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(r,"Invalid number");var t=this.pos-r>=2&&this.input.charCodeAt(r)===48;t&&this.strict&&this.raise(r,"Invalid number");var n=this.input.charCodeAt(this.pos);if(!t&&!e&&this.options.ecmaVersion>=11&&n===110){var i=HF(this.input.slice(r,this.pos));return++this.pos,Am(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Ae.num,i)}t&&/[89]/.test(this.input.slice(r,this.pos))&&(t=!1),n===46&&!t&&(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),(n===69||n===101)&&!t&&(n=this.input.charCodeAt(++this.pos),(n===43||n===45)&&++this.pos,this.readInt(10)===null&&this.raise(r,"Invalid number")),Am(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a=Uee(this.input.slice(r,this.pos),t);return this.finishToken(Ae.num,a)};so.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),r;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;r=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,r>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else r=this.readHexChar(4);return r};function sA(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}so.readString=function(e){for(var r="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===e)break;n===92?(r+=this.input.slice(t,this.pos),r+=this.readEscapedChar(!1),t=this.pos):(ex(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return r+=this.input.slice(t,this.pos++),this.finishToken(Ae.string,r)};var WF={};so.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===WF)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1};so.invalidStringToken=function(e,r){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw WF;this.raise(e,r)};so.readTmplToken=function(){for(var e="",r=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Ae.template||this.type===Ae.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(Ae.dollarBraceL)):(++this.pos,this.finishToken(Ae.backQuote)):(e+=this.input.slice(r,this.pos),this.finishToken(Ae.template,e));if(t===92)e+=this.input.slice(r,this.pos),e+=this.readEscapedChar(!0),r=this.pos;else if(ex(t)){switch(e+=this.input.slice(r,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),r=this.pos}else++this.pos}};so.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Ae.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")};so.readEscapedChar=function(e){var r=this.input.charCodeAt(++this.pos);switch(++this.pos,r){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return sA(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var t=this.pos-1;return this.invalidStringToken(t,"Invalid escape sequence in template string"),null}default:if(r>=48&&r<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(n,8);return i>255&&(n=n.slice(0,-1),i=parseInt(n,8)),this.pos+=n.length-1,r=this.input.charCodeAt(this.pos),(n!=="0"||r===56||r===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-n.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return ex(r)?"":String.fromCharCode(r)}};so.readHexChar=function(e){var r=this.pos,t=this.readInt(16,e);return t===null&&this.invalidStringToken(r,"Bad character escape sequence"),t};so.readWord1=function(){this.containsEsc=!1;for(var e="",r=!0,t=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(t_(i,n))this.pos+=i<=65535?1:2;else if(i===92){this.containsEsc=!0,e+=this.input.slice(t,this.pos);var a=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(r?Am:t_)(o,n)||this.invalidStringToken(a,"Invalid Unicode escape"),e+=sA(o),t=this.pos}else break;r=!1}return e+this.input.slice(t,this.pos)};so.readWord=function(){var e=this.readWord1(),r=Ae.name;return this.keywords.test(e)&&(r=Jw[e]),this.finishToken(r,e)};var Vee="7.4.1";jl.acorn={Parser:jl,version:Vee,defaultOptions:_S,Position:H1,SourceLocation:v2,getLineInfo:bF,Node:iA,TokenType:Vo,tokTypes:Ae,keywordTypes:Jw,TokContext:Ud,tokContexts:ml,isIdentifierChar:t_,isIdentifierStart:Am,Token:oA,isNewLine:ex,lineBreak:pd,lineBreakG:j1,nonASCIIwhitespace:_F};function Gee(e,r){return jl.parse(e,r)}function $g(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.__proto__=r}function r_(e){var r=typeof Map=="function"?new Map:void 0;return r_=function(n){if(n===null||!Hee(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return rb(n,arguments,bS(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Db(i,n)},r_(e)}function jee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function rb(e,r,t){return jee()?rb=Reflect.construct:rb=function(i,a,o){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return o&&Db(p,o.prototype),p},rb.apply(null,arguments)}function Hee(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Db(e,r){return Db=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Db(e,r)}function bS(e){return bS=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bS(e)}var Wee=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(r_(Error)),$ee=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(r_(SyntaxError)),ES=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(r_(ReferenceError)),Xee=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(r_(TypeError)),CS=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(Wee),Zee=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}($ee),Vd=function(e){$g(r,e);function r(){return e.apply(this,arguments)||this}return r}(ES),Uf={UnknownError:[3001,"%0",CS],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",CS],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Vd],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Vd],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Vd],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Vd],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Vd],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Vd],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Vd],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Vd],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Vd],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Vd],FunctionUndefinedReferenceError:[2001,"%0 is not a function",ES],VariableUndefinedReferenceError:[2002,"%0 is not defined",ES],IsNotConstructor:[2003,"%0 is not a constructor",Xee]};function Yee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function nb(e,r,t){return Yee()?nb=Reflect.construct:nb=function(i,a,o){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return o&&SS(p,o.prototype),p},nb.apply(null,arguments)}function SS(e,r){return SS=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},SS(e,r)}var qee="0.0.3";function NL(e,r){Object.defineProperty(e,"name",{value:r,writable:!1,enumerable:!1,configurable:!0})}var Kee=Object.prototype.hasOwnProperty,sg=Symbol("Break"),ug=Symbol("Continue"),zL=Symbol("DefaultCase"),Tc=Symbol("EmptyStatementReturn"),UL=Symbol("WithScopeName"),VL=Symbol("SuperScopeName"),GL=Symbol("RootScopeName"),jL=Symbol("GlobalScopeName");function YE(e){return typeof e=="function"}var lm=function(){function e(t){this.interpreter=t}var r=e.prototype;return r.generator=function(){var n=this.interpreter;function i(){return this.getCurrentScope()}function a(){return this.getGlobalScope()}function o(){return this.getCurrentContext()}return{getOptions:n.getOptions.bind(n),getCurrentScope:i.bind(n),getGlobalScope:a.bind(n),getCurrentContext:o.bind(n),getExecStartTime:n.getExecStartTime.bind(n)}},e}();function uA(e,r,t){if(t===void 0&&(t=!0),!(e instanceof lm))throw new Error("Illegal call");if(typeof r!="string")return r;if(!!r){var n=e.generator(),i=n.getOptions(),a={timeout:i.timeout,_initEnv:function(){t||this.setCurrentContext(n.getCurrentContext()),this.execStartTime=n.getExecStartTime(),this.execEndTime=this.execStartTime}},o=t?n.getGlobalScope():n.getCurrentScope(),l=new Yd(o,a);return l.evaluate(r)}}Object.defineProperty(uA,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function lA(e){if(!(e instanceof lm))throw new Error("Illegal call");for(var r=e.generator(),t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=n.pop(),o=new Yd(r.getGlobalScope(),r.getOptions()),l=`
		    (function anonymous(`+n.join(",")+`){
		        `+a+`
		    });
		    `;return o.evaluate(l)}Object.defineProperty(lA,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var wv=function(r){this.value=r},lg=function(r){this.value=r},nm=function(r){this.value=r},Ty=function(r,t,n){t===void 0&&(t=null),this.name=n,this.parent=t,this.data=r,this.labelStack=[]};function Fx(){}function Qee(e,r){return e===void 0&&(e=null),new Ty(Object.create(null),e,r)}function Jee(e){return Object.create(e)}var Hv={NaN:NaN,Infinity:1/0,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:uA,Function:lA};typeof JSON<"u"&&(Hv.JSON=JSON);typeof Promise<"u"&&(Hv.Promise=Promise);typeof Set<"u"&&(Hv.Set=Set);typeof Map<"u"&&(Hv.Map=Map);typeof Symbol<"u"&&(Hv.Symbol=Symbol);typeof Proxy<"u"&&(Hv.Proxy=Proxy);typeof WeakMap<"u"&&(Hv.WeakMap=WeakMap);typeof WeakSet<"u"&&(Hv.WeakSet=WeakSet);typeof Reflect<"u"&&(Hv.Reflect=Reflect);var Yd=function(){function e(t,n){t===void 0&&(t=e.global),n===void 0&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction===void 0?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var r=e.prototype;return r.initEnvironment=function(n){var i;if(n instanceof Ty)i=n;else{var a=null,o=this.createSuperScope(n);this.options.rootContext&&(a=new Ty(Jee(this.options.rootContext),o,GL)),i=new Ty(n,a||o,jL)}this.globalScope=i,this.currentScope=this.globalScope,this.globalContext=i.data,this.currentContext=i.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var l=this.options._initEnv;l&&l.call(this)},r.getExecStartTime=function(){return this.execStartTime},r.getExecutionTime=function(){return this.execEndTime-this.execStartTime},r.setExecTimeout=function(n){n===void 0&&(n=0),this.options.timeout=n},r.getOptions=function(){return this.options},r.getGlobalScope=function(){return this.globalScope},r.getCurrentScope=function(){return this.currentScope},r.getCurrentContext=function(){return this.currentContext},r.isInterruptThrow=function(n){return n instanceof CS||n instanceof Vd||n instanceof Zee},r.createSuperScope=function(n){var i=Object.assign({},Hv),a=Object.keys(i);return a.forEach(function(o){o in n&&delete i[o]}),new Ty(i,null,VL)},r.setCurrentContext=function(n){this.currentContext=n},r.setCurrentScope=function(n){this.currentScope=n},r.evaluate=function(n){n===void 0&&(n="");var i;if(!!n)return i=Gee(n,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(i,n)},r.appendCode=function(n){return this.evaluate(n)},r.evaluateNode=function(n,i){var a=this;i===void 0&&(i=""),this.value=void 0,this.source=i,this.sourceList.push(i),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var o=this.getCurrentScope(),l=this.getCurrentContext(),c=o.labelStack.concat([]),p=this.callStack.concat([]),y=function(){a.setCurrentScope(o),a.setCurrentContext(l),o.labelStack=c,a.callStack=p};try{var b=this.createClosure(n);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),b()}catch(w){throw w}finally{y(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},r.createErrorMessage=function(n,i,a){var o=n[1].replace("%0",String(i));return a!==null&&(o+=this.getNodePosition(a||this.lastExecNode)),o},r.createError=function(n,i){return new i(n)},r.createThrowError=function(n,i){return this.createError(n,i)},r.createInternalThrowError=function(n,i,a){return this.createError(this.createErrorMessage(n,i,a),n[2])},r.checkTimeout=function(){if(!this.isRunning)return!1;var n=this.options.timeout||0,i=Date.now();return i-this.execStartTime>n},r.getNodePosition=function(n){if(n){var i="";return n.loc?" ["+n.loc.start.line+":"+n.loc.start.column+"]"+i:""}return""},r.createClosure=function(n){var i=this,a;switch(n.type){case"BinaryExpression":a=this.binaryExpressionHandler(n);break;case"LogicalExpression":a=this.logicalExpressionHandler(n);break;case"UnaryExpression":a=this.unaryExpressionHandler(n);break;case"UpdateExpression":a=this.updateExpressionHandler(n);break;case"ObjectExpression":a=this.objectExpressionHandler(n);break;case"ArrayExpression":a=this.arrayExpressionHandler(n);break;case"CallExpression":a=this.callExpressionHandler(n);break;case"NewExpression":a=this.newExpressionHandler(n);break;case"MemberExpression":a=this.memberExpressionHandler(n);break;case"ThisExpression":a=this.thisExpressionHandler(n);break;case"SequenceExpression":a=this.sequenceExpressionHandler(n);break;case"Literal":a=this.literalHandler(n);break;case"Identifier":a=this.identifierHandler(n);break;case"AssignmentExpression":a=this.assignmentExpressionHandler(n);break;case"FunctionDeclaration":a=this.functionDeclarationHandler(n);break;case"VariableDeclaration":a=this.variableDeclarationHandler(n);break;case"BlockStatement":case"Program":a=this.programHandler(n);break;case"ExpressionStatement":a=this.expressionStatementHandler(n);break;case"EmptyStatement":a=this.emptyStatementHandler(n);break;case"ReturnStatement":a=this.returnStatementHandler(n);break;case"FunctionExpression":a=this.functionExpressionHandler(n);break;case"IfStatement":a=this.ifStatementHandler(n);break;case"ConditionalExpression":a=this.conditionalExpressionHandler(n);break;case"ForStatement":a=this.forStatementHandler(n);break;case"WhileStatement":a=this.whileStatementHandler(n);break;case"DoWhileStatement":a=this.doWhileStatementHandler(n);break;case"ForInStatement":a=this.forInStatementHandler(n);break;case"WithStatement":a=this.withStatementHandler(n);break;case"ThrowStatement":a=this.throwStatementHandler(n);break;case"TryStatement":a=this.tryStatementHandler(n);break;case"ContinueStatement":a=this.continueStatementHandler(n);break;case"BreakStatement":a=this.breakStatementHandler(n);break;case"SwitchStatement":a=this.switchStatementHandler(n);break;case"LabeledStatement":a=this.labeledStatementHandler(n);break;case"DebuggerStatement":a=this.debuggerStatementHandler(n);break;default:throw this.createInternalThrowError(Uf.NodeTypeSyntaxError,n.type,n)}return function(){var o=i.options.timeout;if(o&&o>0&&i.checkTimeout())throw i.createInternalThrowError(Uf.ExecutionTimeOutError,o,null);return i.lastExecNode=n,a.apply(void 0,arguments)}},r.binaryExpressionHandler=function(n){var i=this,a=this.createClosure(n.left),o=this.createClosure(n.right);return function(){var l=a(),c=o();switch(n.operator){case"==":return l==c;case"!=":return l!=c;case"===":return l===c;case"!==":return l!==c;case"<":return l<c;case"<=":return l<=c;case">":return l>c;case">=":return l>=c;case"<<":return l<<c;case">>":return l>>c;case">>>":return l>>>c;case"+":return l+c;case"-":return l-c;case"*":return l*c;case"**":return Math.pow(l,c);case"/":return l/c;case"%":return l%c;case"|":return l|c;case"^":return l^c;case"&":return l&c;case"in":return l in c;case"instanceof":return l instanceof c;default:throw i.createInternalThrowError(Uf.BinaryOperatorSyntaxError,n.operator,n)}}},r.logicalExpressionHandler=function(n){var i=this,a=this.createClosure(n.left),o=this.createClosure(n.right);return function(){switch(n.operator){case"||":return a()||o();case"&&":return a()&&o();default:throw i.createInternalThrowError(Uf.LogicalOperatorSyntaxError,n.operator,n)}}},r.unaryExpressionHandler=function(n){var i=this;switch(n.operator){case"delete":var a=this.createObjectGetter(n.argument),o=this.createNameGetter(n.argument);return function(){var y=a(),b=o();return delete y[b]};default:var l;if(n.operator==="typeof"&&n.argument.type==="Identifier"){var c=this.createObjectGetter(n.argument),p=this.createNameGetter(n.argument);l=function(){return c()[p()]}}else l=this.createClosure(n.argument);return function(){var y=l();switch(n.operator){case"-":return-y;case"+":return+y;case"!":return!y;case"~":return~y;case"void":return;case"typeof":return typeof y;default:throw i.createInternalThrowError(Uf.UnaryOperatorSyntaxError,n.operator,n)}}}},r.updateExpressionHandler=function(n){var i=this,a=this.createObjectGetter(n.argument),o=this.createNameGetter(n.argument);return function(){var l=a(),c=o();switch(i.assertVariable(l,c,n),n.operator){case"++":return n.prefix?++l[c]:l[c]++;case"--":return n.prefix?--l[c]:l[c]--;default:throw i.createInternalThrowError(Uf.UpdateOperatorSyntaxError,n.operator,n)}}},r.objectExpressionHandler=function(n){var i=this,a=[];function o(c){return c.type==="Identifier"?c.name:c.type==="Literal"?c.value:this.throwError(Uf.ObjectStructureSyntaxError,c.type,c)}var l=Object.create(null);return n.properties.forEach(function(c){var p=c.kind,y=o(c.key);(!l[y]||p==="init")&&(l[y]={}),l[y][p]=i.createClosure(c.value),a.push({key:y,property:c})}),function(){for(var c={},p=a.length,y=0;y<p;y++){var b=a[y],w=b.key,M=l[w],O=M.init?M.init():void 0,N=M.get?M.get():function(){},z=M.set?M.set():function(ie){};if("set"in M||"get"in M){var j={configurable:!0,enumerable:!0,get:N,set:z};Object.defineProperty(c,w,j)}else{var Y=b.property,K=Y.kind;Y.key.type==="Identifier"&&Y.value.type==="FunctionExpression"&&K==="init"&&!Y.value.id&&NL(O,Y.key.name),c[w]=O}}return c}},r.arrayExpressionHandler=function(n){var i=this,a=n.elements.map(function(o){return o&&i.createClosure(o)});return function(){for(var o=a.length,l=Array(o),c=0;c<o;c++){var p=a[c];p&&(l[c]=p())}return l}},r.safeObjectGet=function(n,i,a){return n[i]},r.createCallFunctionGetter=function(n){var i=this;switch(n.type){case"MemberExpression":var a=this.createClosure(n.object),o=this.createMemberKeyGetter(n),l=this.source;return function(){var p=a(),y=o(),b=i.safeObjectGet(p,y,n);if(!b||!YE(b)){var w=l.slice(n.start,n.end);throw i.createInternalThrowError(Uf.FunctionUndefinedReferenceError,w,n)}return b.__IS_EVAL_FUNC?function(M){return b(new lm(i),M,!0)}:b.__IS_FUNCTION_FUNC?function(){for(var M=arguments.length,O=new Array(M),N=0;N<M;N++)O[N]=arguments[N];return b.apply(void 0,[new lm(i)].concat(O))}:b.bind(p)};default:var c=this.createClosure(n);return function(){var p="";n.type==="Identifier"&&(p=n.name);var y=c();if(!y||!YE(y))throw i.createInternalThrowError(Uf.FunctionUndefinedReferenceError,p,n);if(n.type==="Identifier"&&y.__IS_EVAL_FUNC&&p==="eval")return function(M){var O=i.getScopeFromName(p,i.getCurrentScope()),N=O.name===VL||O.name===jL||O.name===GL;return y(new lm(i),M,!N)};if(y.__IS_EVAL_FUNC)return function(M){return y(new lm(i),M,!0)};if(y.__IS_FUNCTION_FUNC)return function(){for(var M=arguments.length,O=new Array(M),N=0;N<M;N++)O[N]=arguments[N];return y.apply(void 0,[new lm(i)].concat(O))};var b=i.options.globalContextInFunction;if(n.type==="Identifier"){var w=i.getIdentifierScope(n);w.name===UL&&(b=w.data)}return y.bind(b)}}},r.callExpressionHandler=function(n){var i=this,a=this.createCallFunctionGetter(n.callee),o=n.arguments.map(function(l){return i.createClosure(l)});return function(){return a().apply(void 0,o.map(function(l){return l()}))}},r.functionExpressionHandler=function(n){var i=this,a=this,o=this.source,l=this.collectDeclVars,c=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var p=n.id?n.id.name:"",y=n.params.length,b=n.params.map(function(N){return i.createParamNameGetter(N)}),w=this.createClosure(n.body),M=this.collectDeclVars,O=this.collectDeclFuncs;return this.collectDeclVars=l,this.collectDeclFuncs=c,function(){var N=a.getCurrentScope(),z=function j(){for(var Y=arguments.length,K=new Array(Y),ie=0;ie<Y;ie++)K[ie]=arguments[ie];a.callStack.push(""+p);var le=a.getCurrentScope(),Se=Qee(N,"FunctionScope("+p+")");a.setCurrentScope(Se),a.addDeclarationsToScope(M,O,Se),p&&(Se.data[p]=j),Se.data.arguments=arguments,b.forEach(function(Ke,ke){Se.data[Ke()]=K[ke]});var ze=a.getCurrentContext();a.setCurrentContext(this);var ue=w();if(a.setCurrentContext(ze),a.setCurrentScope(le),a.callStack.pop(),ue instanceof wv)return ue.value};return NL(z,p),Object.defineProperty(z,"length",{value:y,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(z,"toString",{value:function(){return o.slice(n.start,n.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(z,"valueOf",{value:function(){return o.slice(n.start,n.end)},writable:!0,configurable:!0,enumerable:!1}),z}},r.newExpressionHandler=function(n){var i=this,a=this.source,o=this.createClosure(n.callee),l=n.arguments.map(function(c){return i.createClosure(c)});return function(){var c=o();if(!YE(c)||c.__IS_EVAL_FUNC){var p=n.callee,y=a.slice(p.start,p.end);throw i.createInternalThrowError(Uf.IsNotConstructor,y,n)}return c.__IS_FUNCTION_FUNC?c.apply(void 0,[new lm(i)].concat(l.map(function(b){return b()}))):nb(c,l.map(function(b){return b()}))}},r.memberExpressionHandler=function(n){var i=this.createClosure(n.object),a=this.createMemberKeyGetter(n);return function(){var o=i(),l=a();return o[l]}},r.thisExpressionHandler=function(n){var i=this;return function(){return i.getCurrentContext()}},r.sequenceExpressionHandler=function(n){var i=this,a=n.expressions.map(function(o){return i.createClosure(o)});return function(){for(var o,l=a.length,c=0;c<l;c++){var p=a[c];o=p()}return o}},r.literalHandler=function(n){return function(){return n.regex?new RegExp(n.regex.pattern,n.regex.flags):n.value}},r.identifierHandler=function(n){var i=this;return function(){var a=i.getCurrentScope(),o=i.getScopeDataFromName(n.name,a);return i.assertVariable(o,n.name,n),o[n.name]}},r.getIdentifierScope=function(n){var i=this.getCurrentScope(),a=this.getScopeFromName(n.name,i);return a},r.assignmentExpressionHandler=function(n){var i=this;n.left.type==="Identifier"&&n.right.type==="FunctionExpression"&&!n.right.id&&(n.right.id={type:"Identifier",name:n.left.name});var a=this.createObjectGetter(n.left),o=this.createNameGetter(n.left),l=this.createClosure(n.right);return function(){var c=a(),p=o(),y=l();switch(n.operator!=="="&&i.assertVariable(c,p,n),n.operator){case"=":return c[p]=y;case"+=":return c[p]+=y;case"-=":return c[p]-=y;case"*=":return c[p]*=y;case"**=":return c[p]=Math.pow(c[p],y);case"/=":return c[p]/=y;case"%=":return c[p]%=y;case"<<=":return c[p]<<=y;case">>=":return c[p]>>=y;case">>>=":return c[p]>>>=y;case"&=":return c[p]&=y;case"^=":return c[p]^=y;case"|=":return c[p]|=y;default:throw i.createInternalThrowError(Uf.AssignmentExpressionSyntaxError,n.type,n)}}},r.functionDeclarationHandler=function(n){if(n.id){var i=this.functionExpressionHandler(n);Object.defineProperty(i,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(n.id.name,i)}return function(){return Tc}},r.getVariableName=function(n){if(n.type==="Identifier")return n.name;throw this.createInternalThrowError(Uf.VariableTypeSyntaxError,n.type,n)},r.variableDeclarationHandler=function(n){for(var i=this,a,o=[],l=0;l<n.declarations.length;l++){var c=n.declarations[l];this.varDeclaration(this.getVariableName(c.id)),c.init&&o.push({type:"AssignmentExpression",operator:"=",left:c.id,right:c.init})}return o.length&&(a=this.createClosure({type:"BlockStatement",body:o})),function(){if(a){var p=i.isVarDeclMode;i.isVarDeclMode=!0,a(),i.isVarDeclMode=p}return Tc}},r.assertVariable=function(n,i,a){if(n===this.globalScope.data&&!(i in n))throw this.createInternalThrowError(Uf.VariableUndefinedReferenceError,i,a)},r.programHandler=function(n){var i=this,a=n.body.map(function(o){return i.createClosure(o)});return function(){for(var o=Tc,l=0;l<a.length;l++){var c=a[l],p=i.setValue(c());if(p!==Tc&&(o=p,o instanceof wv||o instanceof lg||o instanceof nm||o===sg||o===ug))break}return o}},r.expressionStatementHandler=function(n){return this.createClosure(n.expression)},r.emptyStatementHandler=function(n){return function(){return Tc}},r.returnStatementHandler=function(n){var i=n.argument?this.createClosure(n.argument):Fx;return function(){return new wv(i())}},r.ifStatementHandler=function(n){var i=this.createClosure(n.test),a=this.createClosure(n.consequent),o=n.alternate?this.createClosure(n.alternate):function(){return Tc};return function(){return i()?a():o()}},r.conditionalExpressionHandler=function(n){return this.ifStatementHandler(n)},r.forStatementHandler=function(n){var i=this,a=Fx,o=n.test?this.createClosure(n.test):function(){return!0},l=Fx,c=this.createClosure(n.body);return n.type==="ForStatement"&&(a=n.init?this.createClosure(n.init):a,l=n.update?this.createClosure(n.update):Fx),function(p){var y,b=Tc,w=n.type==="DoWhileStatement";for(p&&p.type==="LabeledStatement"&&(y=p.label.name),a();w||o();l()){w=!1;var M=i.setValue(c());if(!(M===Tc||M===ug)){if(M===sg)break;if(b=M,b instanceof nm&&b.value===y){b=Tc;continue}if(b instanceof wv||b instanceof lg||b instanceof nm)break}}return b}},r.whileStatementHandler=function(n){return this.forStatementHandler(n)},r.doWhileStatementHandler=function(n){return this.forStatementHandler(n)},r.forInStatementHandler=function(n){var i=this,a=n.left,o=this.createClosure(n.right),l=this.createClosure(n.body);return n.left.type==="VariableDeclaration"&&(this.createClosure(n.left)(),a=n.left.declarations[0].id),function(c){var p,y=Tc,b;c&&c.type==="LabeledStatement"&&(p=c.label.name);var w=o();for(b in w){i.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:a,right:{type:"Literal",value:b}})();var M=i.setValue(l());if(!(M===Tc||M===ug)){if(M===sg)break;if(y=M,y instanceof nm&&y.value===p){y=Tc;continue}if(y instanceof wv||y instanceof lg||y instanceof nm)break}}return y}},r.withStatementHandler=function(n){var i=this,a=this.createClosure(n.object),o=this.createClosure(n.body);return function(){var l=a(),c=i.getCurrentScope(),p=new Ty(l,c,UL);i.setCurrentScope(p);var y=i.setValue(o());return i.setCurrentScope(c),y}},r.throwStatementHandler=function(n){var i=this,a=this.createClosure(n.argument);return function(){throw i.setValue(void 0),a()}},r.tryStatementHandler=function(n){var i=this,a=this.createClosure(n.block),o=n.handler?this.catchClauseHandler(n.handler):null,l=n.finalizer?this.createClosure(n.finalizer):null;return function(){var c=i.getCurrentScope(),p=i.getCurrentContext(),y=c.labelStack.concat([]),b=i.callStack.concat([]),w=Tc,M,O,N=function(){i.setCurrentScope(c),i.setCurrentContext(p),c.labelStack=y,i.callStack=b};try{w=i.setValue(a()),w instanceof wv&&(M=w)}catch(z){if(N(),i.isInterruptThrow(z))throw z;if(o)try{w=i.setValue(o(z)),w instanceof wv&&(M=w)}catch(j){if(N(),i.isInterruptThrow(j))throw j;O=j}}if(l)try{w=l(),w instanceof wv&&(M=w)}catch(z){if(N(),i.isInterruptThrow(z))throw z;O=z}if(O)throw O;return M||w}},r.catchClauseHandler=function(n){var i=this,a=this.createParamNameGetter(n.param),o=this.createClosure(n.body);return function(l){var c,p=i.getCurrentScope(),y=p.data,b=a(),w=Kee.call(y,b),M=y[b];return y[b]=l,c=o(),w?y[b]=M:delete y[b],c}},r.continueStatementHandler=function(n){return function(){return n.label?new nm(n.label.name):ug}},r.breakStatementHandler=function(n){return function(){return n.label?new lg(n.label.name):sg}},r.switchStatementHandler=function(n){var i=this,a=this.createClosure(n.discriminant),o=n.cases.map(function(l){return i.switchCaseHandler(l)});return function(){for(var l=a(),c=!1,p,y,b,w=0;w<o.length;w++){var M=o[w](),O=M.testClosure();if(O===zL){b=M;continue}if(c||O===l){if(c=!0,y=i.setValue(M.bodyClosure()),y===Tc)continue;if(y===sg||(p=y,p instanceof wv||p instanceof lg||p instanceof nm||p===ug))break}}if(!c&&b){y=i.setValue(b.bodyClosure());var N=y===Tc||y===sg||y===ug;N||(p=y)}return p}},r.switchCaseHandler=function(n){var i=n.test?this.createClosure(n.test):function(){return zL},a=this.createClosure({type:"BlockStatement",body:n.consequent});return function(){return{testClosure:i,bodyClosure:a}}},r.labeledStatementHandler=function(n){var i=this,a=n.label.name,o=this.createClosure(n.body);return function(){var l,c=i.getCurrentScope();return c.labelStack.push(a),l=o(n),l instanceof lg&&l.value===a&&(l=Tc),c.labelStack.pop(),l}},r.debuggerStatementHandler=function(n){return function(){debugger;return Tc}},r.createParamNameGetter=function(n){if(n.type==="Identifier")return function(){return n.name};throw this.createInternalThrowError(Uf.ParamTypeSyntaxError,n.type,n)},r.createObjectKeyGetter=function(n){var i;return n.type==="Identifier"?i=function(){return n.name}:i=this.createClosure(n),function(){return i()}},r.createMemberKeyGetter=function(n){return n.computed?this.createClosure(n.property):this.createObjectKeyGetter(n.property)},r.createObjectGetter=function(n){var i=this;switch(n.type){case"Identifier":return function(){return i.getScopeDataFromName(n.name,i.getCurrentScope())};case"MemberExpression":return this.createClosure(n.object);default:throw this.createInternalThrowError(Uf.AssignmentTypeSyntaxError,n.type,n)}},r.createNameGetter=function(n){switch(n.type){case"Identifier":return function(){return n.name};case"MemberExpression":return this.createMemberKeyGetter(n);default:throw this.createInternalThrowError(Uf.AssignmentTypeSyntaxError,n.type,n)}},r.varDeclaration=function(n){var i=this.collectDeclVars;i[n]=void 0},r.funcDeclaration=function(n,i){var a=this.collectDeclFuncs;a[n]=i},r.addDeclarationsToScope=function(n,i,a){var o=a.data;for(var l in i){var c=i[l];o[l]=c&&c()}for(var p in n)p in o||(o[p]=void 0)},r.getScopeValue=function(n,i){var a=this.getScopeFromName(n,i);return a.data[n]},r.getScopeDataFromName=function(n,i){return this.getScopeFromName(n,i).data},r.getScopeFromName=function(n,i){var a=i;do if(n in a.data)return a;while(a=a.parent);return this.globalScope},r.setValue=function(n){var i=this.callStack.length;return this.isVarDeclMode||i||n===Tc||n===sg||n===ug||n instanceof lg||n instanceof nm||(this.value=n instanceof wv?n.value:n),n},r.getValue=function(){return this.value},e}();Yd.version=qee;Yd.eval=uA;Yd.Function=lA;Yd.ecmaVersion=5;Yd.globalContextInFunction=void 0;Yd.global=Object.create(null);function ete(e){return e===void 0&&(e=Object.create(null)),e}function $F(e,r,t){r===void 0&&(r=[]),t===void 0&&(t={});var n=t.parsingContext,i=t.timeout===void 0?0:t.timeout,a=`
    (function anonymous(`+r.join(",")+`){
         `+e+`
    });
    `,o=new Yd(n,{ecmaVersion:t.ecmaVersion,timeout:i,rootContext:t.rootContext,globalContextInFunction:t.globalContextInFunction});return o.evaluate(a)}function $1(e,r,t){var n=new Yd(r,t);return n.evaluate(e)}var tte=$1,rte=function(){function e(t){this._code=t}var r=e.prototype;return r.runInContext=function(n){return $1(this._code,n)},r.runInNewContext=function(n){return $1(this._code,n)},e}();const nte=Object.freeze(Object.defineProperty({__proto__:null,createContext:ete,compileFunction:$F,runInContext:$1,runInNewContext:tte,Script:rte},Symbol.toStringTag,{value:"Module"})),HL=function(e,r,t){return $1(e,r,t)};function ite(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=r.pop();return $F(n||"",r)}const ate=Object.freeze(Object.defineProperty({__proto__:null,Interpreter:Yd,vm:nte,evaluate:HL,Function:ite,default:HL},Symbol.toStringTag,{value:"Module"})),ote=h8(ate);(function(e,r){(function(t,n){e.exports=n(ote)})(Lp,function(t){var n=function(H){return H instanceof Uint8Array||H instanceof Uint16Array||H instanceof Uint32Array||H instanceof Int8Array||H instanceof Int16Array||H instanceof Int32Array||H instanceof Float32Array||H instanceof Float64Array||H instanceof Uint8ClampedArray},i=function(H,Ee){for(var Ue=Object.keys(Ee),wt=0;wt<Ue.length;++wt)H[Ue[wt]]=Ee[Ue[wt]];return H},a=`
`;function o(H){return typeof atob<"u"?atob(H):"base64:"+H}function l(H){var Ee=new Error("(regl) "+H);throw console.error(Ee),Ee}function c(H,Ee){H||l(Ee)}function p(H){return H?": "+H:""}function y(H,Ee,Ue){H in Ee||l("unknown parameter ("+H+")"+p(Ue)+". possible values: "+Object.keys(Ee).join())}function b(H,Ee){n(H)||l("invalid parameter type"+p(Ee)+". must be a typed array")}function w(H,Ee){switch(Ee){case"number":return typeof H=="number";case"object":return typeof H=="object";case"string":return typeof H=="string";case"boolean":return typeof H=="boolean";case"function":return typeof H=="function";case"undefined":return typeof H>"u";case"symbol":return typeof H=="symbol"}}function M(H,Ee,Ue){w(H,Ee)||l("invalid parameter type"+p(Ue)+". expected "+Ee+", got "+typeof H)}function O(H,Ee){H>=0&&(H|0)===H||l("invalid parameter type, ("+H+")"+p(Ee)+". must be a nonnegative integer")}function N(H,Ee,Ue){Ee.indexOf(H)<0&&l("invalid value"+p(Ue)+". must be one of: "+Ee)}var z=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function j(H){Object.keys(H).forEach(function(Ee){z.indexOf(Ee)<0&&l('invalid regl constructor argument "'+Ee+'". must be one of '+z)})}function Y(H,Ee){for(H=H+"";H.length<Ee;)H=" "+H;return H}function K(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ie(H,Ee){this.number=H,this.line=Ee,this.errors=[]}function le(H,Ee,Ue){this.file=H,this.line=Ee,this.message=Ue}function Se(){var H=new Error,Ee=(H.stack||H).toString(),Ue=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ee);if(Ue)return Ue[1];var wt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ee);return wt?wt[1]:"unknown"}function ze(){var H=new Error,Ee=(H.stack||H).toString(),Ue=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ee);if(Ue)return Ue[1];var wt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ee);return wt?wt[1]:"unknown"}function ue(H,Ee){var Ue=H.split(`
`),wt=1,rr=0,Et={unknown:new K,0:new K};Et.unknown.name=Et[0].name=Ee||Se(),Et.unknown.lines.push(new ie(0,""));for(var jt=0;jt<Ue.length;++jt){var sr=Ue[jt],br=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(sr);if(br)switch(br[1]){case"line":var Rr=/(\d+)(\s+\d+)?/.exec(br[2]);Rr&&(wt=Rr[1]|0,Rr[2]&&(rr=Rr[2]|0,rr in Et||(Et[rr]=new K)));break;case"define":var Lr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(br[2]);Lr&&(Et[rr].name=Lr[1]?o(Lr[2]):Lr[2]);break}Et[rr].lines.push(new ie(wt++,sr))}return Object.keys(Et).forEach(function(dr){var Mr=Et[dr];Mr.lines.forEach(function(gr){Mr.index[gr.number]=gr})}),Et}function Ke(H){var Ee=[];return H.split(`
`).forEach(function(Ue){if(!(Ue.length<5)){var wt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ue);wt?Ee.push(new le(wt[1]|0,wt[2]|0,wt[3].trim())):Ue.length>0&&Ee.push(new le("unknown",0,Ue))}}),Ee}function ke(H,Ee){Ee.forEach(function(Ue){var wt=H[Ue.file];if(wt){var rr=wt.index[Ue.line];if(rr){rr.errors.push(Ue),wt.hasErrors=!0;return}}H.unknown.hasErrors=!0,H.unknown.lines[0].errors.push(Ue)})}function Ce(H,Ee,Ue,wt,rr){if(!H.getShaderParameter(Ee,H.COMPILE_STATUS)){var Et=H.getShaderInfoLog(Ee),jt=wt===H.FRAGMENT_SHADER?"fragment":"vertex";$t(Ue,"string",jt+" shader source must be a string",rr);var sr=ue(Ue,rr),br=Ke(Et);ke(sr,br),Object.keys(sr).forEach(function(Rr){var Lr=sr[Rr];if(!Lr.hasErrors)return;var dr=[""],Mr=[""];function gr(Or,ft){dr.push(Or),Mr.push(ft||"")}gr("file number "+Rr+": "+Lr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Lr.lines.forEach(function(Or){if(Or.errors.length>0){gr(Y(Or.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Or.line+a,"color:red; background-color:yellow; font-weight:bold");var ft=0;Or.errors.forEach(function(Ft){var wr=Ft.message,Kr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(wr);if(Kr){var ar=Kr[1];switch(wr=Kr[2],ar){case"assign":ar="=";break}ft=Math.max(Or.line.indexOf(ar,ft),0)}else ft=0;gr(Y("| ",6)),gr(Y("^^^",ft+3)+a,"font-weight:bold"),gr(Y("| ",6)),gr(wr+a,"font-weight:bold")}),gr(Y("| ",6)+a)}else gr(Y(Or.number,4)+"|  "),gr(Or.line+a,"color:red")}),typeof document<"u"&&!window.chrome?(Mr[0]=dr.join("%c"),console.log.apply(console,Mr)):console.log(dr.join(""))}),c.raise("Error compiling "+jt+" shader, "+sr[0].name)}}function je(H,Ee,Ue,wt,rr){if(!H.getProgramParameter(Ee,H.LINK_STATUS)){var Et=H.getProgramInfoLog(Ee),jt=ue(Ue,rr),sr=ue(wt,rr),br='Error linking program with vertex shader, "'+sr[0].name+'", and fragment shader "'+jt[0].name+'"';typeof document<"u"?console.log("%c"+br+a+"%c"+Et,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(br+a+Et),c.raise(br)}}function ve(H){H._commandRef=Se()}function Ie(H,Ee,Ue,wt){ve(H);function rr(br){return br?wt.id(br):0}H._fragId=rr(H.static.frag),H._vertId=rr(H.static.vert);function Et(br,Rr){Object.keys(Rr).forEach(function(Lr){br[wt.id(Lr)]=!0})}var jt=H._uniformSet={};Et(jt,Ee.static),Et(jt,Ee.dynamic);var sr=H._attributeSet={};Et(sr,Ue.static),Et(sr,Ue.dynamic),H._hasCount="count"in H.static||"count"in H.dynamic||"elements"in H.static||"elements"in H.dynamic}function dt(H,Ee){var Ue=ze();l(H+" in command "+(Ee||Se())+(Ue==="unknown"?"":" called from "+Ue))}function St(H,Ee,Ue){H||dt(Ee,Ue||Se())}function Rt(H,Ee,Ue,wt){H in Ee||dt("unknown parameter ("+H+")"+p(Ue)+". possible values: "+Object.keys(Ee).join(),wt||Se())}function $t(H,Ee,Ue,wt){w(H,Ee)||dt("invalid parameter type"+p(Ue)+". expected "+Ee+", got "+typeof H,wt||Se())}function gt(H){H()}function jr(H,Ee,Ue){H.texture?N(H.texture._texture.internalformat,Ee,"unsupported texture format for attachment"):N(H.renderbuffer._renderbuffer.format,Ue,"unsupported renderbuffer format for attachment")}var Er=33071,rn=9728,dn=9984,Rn=9985,Ar=9986,xa=9987,Ti=5120,Sa=5121,hr=5122,Dr=5123,Kn=5124,Wt=5125,Me=5126,Qe=32819,Ct=32820,Yt=33635,qt=34042,_r=36193,Pr={};Pr[Ti]=Pr[Sa]=1,Pr[hr]=Pr[Dr]=Pr[_r]=Pr[Yt]=Pr[Qe]=Pr[Ct]=2,Pr[Kn]=Pr[Wt]=Pr[Me]=Pr[qt]=4;function xr(H,Ee){return H===Ct||H===Qe||H===Yt?2:H===qt?4:Pr[H]*Ee}function kr(H){return!(H&H-1)&&!!H}function vr(H,Ee,Ue){var wt,rr=Ee.width,Et=Ee.height,jt=Ee.channels;c(rr>0&&rr<=Ue.maxTextureSize&&Et>0&&Et<=Ue.maxTextureSize,"invalid texture shape"),(H.wrapS!==Er||H.wrapT!==Er)&&c(kr(rr)&&kr(Et),"incompatible wrap mode for texture, both width and height must be power of 2"),Ee.mipmask===1?rr!==1&&Et!==1&&c(H.minFilter!==dn&&H.minFilter!==Ar&&H.minFilter!==Rn&&H.minFilter!==xa,"min filter requires mipmap"):(c(kr(rr)&&kr(Et),"texture must be a square power of 2 to support mipmapping"),c(Ee.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),Ee.type===Me&&(Ue.extensions.indexOf("oes_texture_float_linear")<0&&c(H.minFilter===rn&&H.magFilter===rn,"filter not supported, must enable oes_texture_float_linear"),c(!H.genMipmaps,"mipmap generation not supported with float textures"));var sr=Ee.images;for(wt=0;wt<16;++wt)if(sr[wt]){var br=rr>>wt,Rr=Et>>wt;c(Ee.mipmask&1<<wt,"missing mipmap data");var Lr=sr[wt];if(c(Lr.width===br&&Lr.height===Rr,"invalid shape for mip images"),c(Lr.format===Ee.format&&Lr.internalformat===Ee.internalformat&&Lr.type===Ee.type,"incompatible type for mip image"),!Lr.compressed)if(Lr.data){var dr=Math.ceil(xr(Lr.type,jt)*br/Lr.unpackAlignment)*Lr.unpackAlignment;c(Lr.data.byteLength===dr*Rr,"invalid data for image, buffer size is inconsistent with image format")}else Lr.element||Lr.copy}else H.genMipmaps||c((Ee.mipmask&1<<wt)===0,"extra mipmap data");Ee.compressed&&c(!H.genMipmaps,"mipmap generation for compressed images not supported")}function In(H,Ee,Ue,wt){var rr=H.width,Et=H.height,jt=H.channels;c(rr>0&&rr<=wt.maxTextureSize&&Et>0&&Et<=wt.maxTextureSize,"invalid texture shape"),c(rr===Et,"cube map must be square"),c(Ee.wrapS===Er&&Ee.wrapT===Er,"wrap mode not supported by cube map");for(var sr=0;sr<Ue.length;++sr){var br=Ue[sr];c(br.width===rr&&br.height===Et,"inconsistent cube map face shape"),Ee.genMipmaps&&(c(!br.compressed,"can not generate mipmap for compressed textures"),c(br.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Rr=br.images,Lr=0;Lr<16;++Lr){var dr=Rr[Lr];if(dr){var Mr=rr>>Lr,gr=Et>>Lr;c(br.mipmask&1<<Lr,"missing mipmap data"),c(dr.width===Mr&&dr.height===gr,"invalid shape for mip images"),c(dr.format===H.format&&dr.internalformat===H.internalformat&&dr.type===H.type,"incompatible type for mip image"),dr.compressed||(dr.data?c(dr.data.byteLength===Mr*gr*Math.max(xr(dr.type,jt),dr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):dr.element||dr.copy)}}}}var W=i(c,{optional:gt,raise:l,commandRaise:dt,command:St,parameter:y,commandParameter:Rt,constructor:j,type:M,commandType:$t,isTypedArray:b,nni:O,oneOf:N,shaderError:Ce,linkError:je,callSite:ze,saveCommandRef:ve,saveDrawInfo:Ie,framebufferFormat:jr,guessCommand:Se,texture2D:vr,textureCube:In}),st=0,zt=0,mr=5,fr=6;function nn(H,Ee){this.id=st++,this.type=H,this.data=Ee}function Mn(H){return H.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Wn(H){if(H.length===0)return[];var Ee=H.charAt(0),Ue=H.charAt(H.length-1);if(H.length>1&&Ee===Ue&&(Ee==='"'||Ee==="'"))return['"'+Mn(H.substr(1,H.length-2))+'"'];var wt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(H);if(wt)return Wn(H.substr(0,wt.index)).concat(Wn(wt[1])).concat(Wn(H.substr(wt.index+wt[0].length)));var rr=H.split(".");if(rr.length===1)return['"'+Mn(H)+'"'];for(var Et=[],jt=0;jt<rr.length;++jt)Et=Et.concat(Wn(rr[jt]));return Et}function Bn(H){return"["+Wn(H).join("][")+"]"}function Mi(H,Ee){return new nn(H,Bn(Ee+""))}function mi(H){return typeof H=="function"&&!H._reglType||H instanceof nn}function mo(H,Ee){if(typeof H=="function")return new nn(zt,H);if(typeof H=="number"||typeof H=="boolean")return new nn(mr,H);if(Array.isArray(H))return new nn(fr,H.map(function(Ue,wt){return mo(Ue,Ee+"["+wt+"]")}));if(H instanceof nn)return H;W(!1,"invalid option type in uniform "+Ee)}var ca={DynamicVariable:nn,define:Mi,isDynamic:mi,unbox:mo,accessor:Bn},Ki={next:typeof requestAnimationFrame=="function"?function(H){return requestAnimationFrame(H)}:function(H){return setTimeout(H,16)},cancel:typeof cancelAnimationFrame=="function"?function(H){return cancelAnimationFrame(H)}:clearTimeout},yl=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Xi=yl?function(){return+new Date}:typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function nu(){var H={"":0},Ee=[""];return{id:function(Ue){var wt=H[Ue];return wt||(wt=H[Ue]=Ee.length,Ee.push(Ue),wt)},str:function(Ue){return Ee[Ue]}}}function mu(H,Ee,Ue){var wt=document.createElement("canvas");i(wt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),H.appendChild(wt),H===document.body&&(wt.style.position="absolute",i(H.style,{margin:0,padding:0}));function rr(){var sr=window.innerWidth,br=window.innerHeight;if(H!==document.body){var Rr=wt.getBoundingClientRect();sr=Rr.right-Rr.left,br=Rr.bottom-Rr.top}wt.width=Ue*sr,wt.height=Ue*br}var Et;H!==document.body&&typeof ResizeObserver=="function"?(Et=new ResizeObserver(function(){setTimeout(rr)}),Et.observe(H)):window.addEventListener("resize",rr,!1);function jt(){Et?Et.disconnect():window.removeEventListener("resize",rr),H.removeChild(wt)}return rr(),{canvas:wt,onDestroy:jt}}function iu(H,Ee){function Ue(wt){try{return H.getContext(wt,Ee)}catch{return null}}return Ue("webgl")||Ue("experimental-webgl")||Ue("webgl-experimental")}function pf(H){return typeof H.nodeName=="string"&&typeof H.appendChild=="function"&&typeof H.getBoundingClientRect=="function"}function Fu(H){return typeof H.drawArrays=="function"||typeof H.drawElements=="function"}function uo(H){return typeof H=="string"?H.split():(W(Array.isArray(H),"invalid extension array"),H)}function J(H){return typeof H=="string"?(W(typeof document<"u","not supported outside of DOM"),document.querySelector(H)):H}function ae(H){var Ee=H||{},Ue,wt,rr,Et,jt={},sr=[],br=[],Rr=typeof window>"u"?1:window.devicePixelRatio,Lr=!1,dr=function(Or){Or&&W.raise(Or)},Mr=function(){};if(typeof Ee=="string"?(W(typeof document<"u","selector queries only supported in DOM environments"),Ue=document.querySelector(Ee),W(Ue,"invalid query string for element")):typeof Ee=="object"?pf(Ee)?Ue=Ee:Fu(Ee)?(Et=Ee,rr=Et.canvas):(W.constructor(Ee),"gl"in Ee?Et=Ee.gl:"canvas"in Ee?rr=J(Ee.canvas):"container"in Ee&&(wt=J(Ee.container)),"attributes"in Ee&&(jt=Ee.attributes,W.type(jt,"object","invalid context attributes")),"extensions"in Ee&&(sr=uo(Ee.extensions)),"optionalExtensions"in Ee&&(br=uo(Ee.optionalExtensions)),"onDone"in Ee&&(W.type(Ee.onDone,"function","invalid or missing onDone callback"),dr=Ee.onDone),"profile"in Ee&&(Lr=!!Ee.profile),"pixelRatio"in Ee&&(Rr=+Ee.pixelRatio,W(Rr>0,"invalid pixel ratio"))):W.raise("invalid arguments to regl"),Ue&&(Ue.nodeName.toLowerCase()==="canvas"?rr=Ue:wt=Ue),!Et){if(!rr){W(typeof document<"u","must manually specify webgl context outside of DOM environments");var gr=mu(wt||document.body,dr,Rr);if(!gr)return null;rr=gr.canvas,Mr=gr.onDestroy}jt.premultipliedAlpha===void 0&&(jt.premultipliedAlpha=!0),Et=iu(rr,jt)}return Et?{gl:Et,canvas:rr,container:wt,extensions:sr,optionalExtensions:br,pixelRatio:Rr,profile:Lr,onDone:dr,onDestroy:Mr}:(Mr(),dr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ce(H,Ee){var Ue={};function wt(sr){W.type(sr,"string","extension name must be string");var br=sr.toLowerCase(),Rr;try{Rr=Ue[br]=rr(sr)}catch{}return!!Rr}function rr(sr){return H.getExtension(sr)?H.getExtension(sr):H.getExtension(sr.toLowerCase())?H.getExtension(sr.toLowerCase()):null}for(var Et=0;Et<Ee.extensions.length;++Et){var jt=Ee.extensions[Et];if(!wt(jt))return Ee.onDestroy(),Ee.onDone('"'+jt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ee.optionalExtensions.forEach(wt),{extensions:Ue,restore:function(){Object.keys(Ue).forEach(function(sr){if(Ue[sr]&&!wt(sr))throw new Error("(regl): error restoring extension "+sr)})}}}function be(H,Ee){for(var Ue=Array(H),wt=0;wt<H;++wt)Ue[wt]=Ee(wt);return Ue}var Be=5120,et=5121,ot=5122,ge=5123,Ve=5124,mt=5125,Jt=5126;function Cr(H){for(var Ee=16;Ee<=1<<28;Ee*=16)if(H<=Ee)return Ee;return 0}function Dt(H){var Ee,Ue;return Ee=(H>65535)<<4,H>>>=Ee,Ue=(H>255)<<3,H>>>=Ue,Ee|=Ue,Ue=(H>15)<<2,H>>>=Ue,Ee|=Ue,Ue=(H>3)<<1,H>>>=Ue,Ee|=Ue,Ee|H>>1}function pr(){var H=be(8,function(){return[]});function Ee(Et){var jt=Cr(Et),sr=H[Dt(jt)>>2];return sr.length>0?sr.pop():new ArrayBuffer(jt)}function Ue(Et){H[Dt(Et.byteLength)>>2].push(Et)}function wt(Et,jt){var sr=null;switch(Et){case Be:sr=new Int8Array(Ee(jt),0,jt);break;case et:sr=new Uint8Array(Ee(jt),0,jt);break;case ot:sr=new Int16Array(Ee(2*jt),0,jt);break;case ge:sr=new Uint16Array(Ee(2*jt),0,jt);break;case Ve:sr=new Int32Array(Ee(4*jt),0,jt);break;case mt:sr=new Uint32Array(Ee(4*jt),0,jt);break;case Jt:sr=new Float32Array(Ee(4*jt),0,jt);break;default:return null}return sr.length!==jt?sr.subarray(0,jt):sr}function rr(Et){Ue(Et.buffer)}return{alloc:Ee,free:Ue,allocType:wt,freeType:rr}}var Nr=pr();Nr.zero=pr();var xn=3408,Bt=3410,ln=3411,Wr=3412,Zr=3413,gi=3414,Jr=3415,bi=33901,ci=33902,Ci=3379,Fi=3386,Di=34921,ls=36347,sa=36348,Zi=35661,ia=35660,pi=34930,Li=36349,go=34076,pa=34024,Za=7936,da=7937,Xf=7938,Hl=35724,ki=34047,oc=36063,ns=34852,Ya=3553,yo=34067,Da=34069,ks=33984,qa=6408,Rc=5126,Rs=5121,df=36160,Os=36053,Ha=36064,Ps=16384,se=function(H,Ee){var Ue=1;Ee.ext_texture_filter_anisotropic&&(Ue=H.getParameter(ki));var wt=1,rr=1;Ee.webgl_draw_buffers&&(wt=H.getParameter(ns),rr=H.getParameter(oc));var Et=!!Ee.oes_texture_float;if(Et){var jt=H.createTexture();H.bindTexture(Ya,jt),H.texImage2D(Ya,0,qa,1,1,0,qa,Rc,null);var sr=H.createFramebuffer();if(H.bindFramebuffer(df,sr),H.framebufferTexture2D(df,Ha,Ya,jt,0),H.bindTexture(Ya,null),H.checkFramebufferStatus(df)!==Os)Et=!1;else{H.viewport(0,0,1,1),H.clearColor(1,0,0,1),H.clear(Ps);var br=Nr.allocType(Rc,4);H.readPixels(0,0,1,1,qa,Rc,br),H.getError()?Et=!1:(H.deleteFramebuffer(sr),H.deleteTexture(jt),Et=br[0]===1),Nr.freeType(br)}}var Rr=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Lr=!0;if(!Rr){var dr=H.createTexture(),Mr=Nr.allocType(Rs,36);H.activeTexture(ks),H.bindTexture(yo,dr),H.texImage2D(Da,0,qa,3,3,0,qa,Rs,Mr),Nr.freeType(Mr),H.bindTexture(yo,null),H.deleteTexture(dr),Lr=!H.getError()}return{colorBits:[H.getParameter(Bt),H.getParameter(ln),H.getParameter(Wr),H.getParameter(Zr)],depthBits:H.getParameter(gi),stencilBits:H.getParameter(Jr),subpixelBits:H.getParameter(xn),extensions:Object.keys(Ee).filter(function(gr){return!!Ee[gr]}),maxAnisotropic:Ue,maxDrawbuffers:wt,maxColorAttachments:rr,pointSizeDims:H.getParameter(bi),lineWidthDims:H.getParameter(ci),maxViewportDims:H.getParameter(Fi),maxCombinedTextureUnits:H.getParameter(Zi),maxCubeMapSize:H.getParameter(go),maxRenderbufferSize:H.getParameter(pa),maxTextureUnits:H.getParameter(pi),maxTextureSize:H.getParameter(Ci),maxAttributes:H.getParameter(Di),maxVertexUniforms:H.getParameter(ls),maxVertexTextureUnits:H.getParameter(ia),maxVaryingVectors:H.getParameter(sa),maxFragmentUniforms:H.getParameter(Li),glsl:H.getParameter(Hl),renderer:H.getParameter(da),vendor:H.getParameter(Za),version:H.getParameter(Xf),readFloat:Et,npotTextureCube:Lr}};function we(H){return!!H&&typeof H=="object"&&Array.isArray(H.shape)&&Array.isArray(H.stride)&&typeof H.offset=="number"&&H.shape.length===H.stride.length&&(Array.isArray(H.data)||n(H.data))}var Je=function(H){return Object.keys(H).map(function(Ee){return H[Ee]})},Nt={shape:ko,flatten:cs};function Tr(H,Ee,Ue){for(var wt=0;wt<Ee;++wt)Ue[wt]=H[wt]}function Un(H,Ee,Ue,wt){for(var rr=0,Et=0;Et<Ee;++Et)for(var jt=H[Et],sr=0;sr<Ue;++sr)wt[rr++]=jt[sr]}function Qi(H,Ee,Ue,wt,rr,Et){for(var jt=Et,sr=0;sr<Ee;++sr)for(var br=H[sr],Rr=0;Rr<Ue;++Rr)for(var Lr=br[Rr],dr=0;dr<wt;++dr)rr[jt++]=Lr[dr]}function Ma(H,Ee,Ue,wt,rr){for(var Et=1,jt=Ue+1;jt<Ee.length;++jt)Et*=Ee[jt];var sr=Ee[Ue];if(Ee.length-Ue===4){var br=Ee[Ue+1],Rr=Ee[Ue+2],Lr=Ee[Ue+3];for(jt=0;jt<sr;++jt)Qi(H[jt],br,Rr,Lr,wt,rr),rr+=Et}else for(jt=0;jt<sr;++jt)Ma(H[jt],Ee,Ue+1,wt,rr),rr+=Et}function cs(H,Ee,Ue,wt){var rr=1;if(Ee.length)for(var Et=0;Et<Ee.length;++Et)rr*=Ee[Et];else rr=0;var jt=wt||Nr.allocType(Ue,rr);switch(Ee.length){case 0:break;case 1:Tr(H,Ee[0],jt);break;case 2:Un(H,Ee[0],Ee[1],jt);break;case 3:Qi(H,Ee[0],Ee[1],Ee[2],jt,0);break;default:Ma(H,Ee,0,jt,0)}return jt}function ko(H){for(var Ee=[],Ue=H;Ue.length;Ue=Ue[0])Ee.push(Ue.length);return Ee}var Ia={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Fp=5120,Zf=5122,qd=5124,Kh=5121,gu=5123,Wl=5125,vf=5126,Ku=5126,yu={int8:Fp,int16:Zf,int32:qd,uint8:Kh,uint16:gu,uint32:Wl,float:vf,float32:Ku},mf=35048,to=35040,Ji={dynamic:mf,stream:to,static:35044},Ro=Nt.flatten,$l=Nt.shape,dd=35044,Wv=35040,vd=5121,Qh=5126,_u=[];_u[5120]=1,_u[5122]=2,_u[5124]=4,_u[5121]=1,_u[5123]=2,_u[5125]=4,_u[5126]=4;function Ch(H){return Ia[Object.prototype.toString.call(H)]|0}function Yi(H,Ee){for(var Ue=0;Ue<Ee.length;++Ue)H[Ue]=Ee[Ue]}function Qu(H,Ee,Ue,wt,rr,Et,jt){for(var sr=0,br=0;br<Ue;++br)for(var Rr=0;Rr<wt;++Rr)H[sr++]=Ee[rr*br+Et*Rr+jt]}function gf(H,Ee,Ue,wt){var rr=0,Et={};function jt(ft){this.id=rr++,this.buffer=H.createBuffer(),this.type=ft,this.usage=dd,this.byteLength=0,this.dimension=1,this.dtype=vd,this.persistentData=null,Ue.profile&&(this.stats={size:0})}jt.prototype.bind=function(){H.bindBuffer(this.type,this.buffer)},jt.prototype.destroy=function(){Mr(this)};var sr=[];function br(ft,Ft){var wr=sr.pop();return wr||(wr=new jt(ft)),wr.bind(),dr(wr,Ft,Wv,0,1,!1),wr}function Rr(ft){sr.push(ft)}function Lr(ft,Ft,wr){ft.byteLength=Ft.byteLength,H.bufferData(ft.type,Ft,wr)}function dr(ft,Ft,wr,Kr,ar,Br){var Xr;if(ft.usage=wr,Array.isArray(Ft)){if(ft.dtype=Kr||Qh,Ft.length>0){var En;if(Array.isArray(Ft[0])){Xr=$l(Ft);for(var er=1,Zt=1;Zt<Xr.length;++Zt)er*=Xr[Zt];ft.dimension=er,En=Ro(Ft,Xr,ft.dtype),Lr(ft,En,wr),Br?ft.persistentData=En:Nr.freeType(En)}else if(typeof Ft[0]=="number"){ft.dimension=ar;var en=Nr.allocType(ft.dtype,Ft.length);Yi(en,Ft),Lr(ft,en,wr),Br?ft.persistentData=en:Nr.freeType(en)}else n(Ft[0])?(ft.dimension=Ft[0].length,ft.dtype=Kr||Ch(Ft[0])||Qh,En=Ro(Ft,[Ft.length,Ft[0].length],ft.dtype),Lr(ft,En,wr),Br?ft.persistentData=En:Nr.freeType(En)):W.raise("invalid buffer data")}}else if(n(Ft))ft.dtype=Kr||Ch(Ft),ft.dimension=ar,Lr(ft,Ft,wr),Br&&(ft.persistentData=new Uint8Array(new Uint8Array(Ft.buffer)));else if(we(Ft)){Xr=Ft.shape;var Yr=Ft.stride,Ir=Ft.offset,Qr=0,an=0,si=0,ai=0;Xr.length===1?(Qr=Xr[0],an=1,si=Yr[0],ai=0):Xr.length===2?(Qr=Xr[0],an=Xr[1],si=Yr[0],ai=Yr[1]):W.raise("invalid shape"),ft.dtype=Kr||Ch(Ft.data)||Qh,ft.dimension=an;var cn=Nr.allocType(ft.dtype,Qr*an);Qu(cn,Ft.data,Qr,an,si,ai,Ir),Lr(ft,cn,wr),Br?ft.persistentData=cn:Nr.freeType(cn)}else Ft instanceof ArrayBuffer?(ft.dtype=vd,ft.dimension=ar,Lr(ft,Ft,wr),Br&&(ft.persistentData=new Uint8Array(new Uint8Array(Ft)))):W.raise("invalid buffer data")}function Mr(ft){Ee.bufferCount--,wt(ft);var Ft=ft.buffer;W(Ft,"buffer must not be deleted already"),H.deleteBuffer(Ft),ft.buffer=null,delete Et[ft.id]}function gr(ft,Ft,wr,Kr){Ee.bufferCount++;var ar=new jt(Ft);Et[ar.id]=ar;function Br(er){var Zt=dd,en=null,Yr=0,Ir=0,Qr=1;return Array.isArray(er)||n(er)||we(er)||er instanceof ArrayBuffer?en=er:typeof er=="number"?Yr=er|0:er&&(W.type(er,"object","buffer arguments must be an object, a number or an array"),"data"in er&&(W(en===null||Array.isArray(en)||n(en)||we(en),"invalid data for buffer"),en=er.data),"usage"in er&&(W.parameter(er.usage,Ji,"invalid buffer usage"),Zt=Ji[er.usage]),"type"in er&&(W.parameter(er.type,yu,"invalid buffer type"),Ir=yu[er.type]),"dimension"in er&&(W.type(er.dimension,"number","invalid dimension"),Qr=er.dimension|0),"length"in er&&(W.nni(Yr,"buffer length must be a nonnegative integer"),Yr=er.length|0)),ar.bind(),en?dr(ar,en,Zt,Ir,Qr,Kr):(Yr&&H.bufferData(ar.type,Yr,Zt),ar.dtype=Ir||vd,ar.usage=Zt,ar.dimension=Qr,ar.byteLength=Yr),Ue.profile&&(ar.stats.size=ar.byteLength*_u[ar.dtype]),Br}function Xr(er,Zt){W(Zt+er.byteLength<=ar.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+er.byteLength+" starting from offset "+Zt+" to a buffer of size "+ar.byteLength),H.bufferSubData(ar.type,Zt,er)}function En(er,Zt){var en=(Zt||0)|0,Yr;if(ar.bind(),n(er)||er instanceof ArrayBuffer)Xr(er,en);else if(Array.isArray(er)){if(er.length>0)if(typeof er[0]=="number"){var Ir=Nr.allocType(ar.dtype,er.length);Yi(Ir,er),Xr(Ir,en),Nr.freeType(Ir)}else if(Array.isArray(er[0])||n(er[0])){Yr=$l(er);var Qr=Ro(er,Yr,ar.dtype);Xr(Qr,en),Nr.freeType(Qr)}else W.raise("invalid buffer data")}else if(we(er)){Yr=er.shape;var an=er.stride,si=0,ai=0,cn=0,pn=0;Yr.length===1?(si=Yr[0],ai=1,cn=an[0],pn=0):Yr.length===2?(si=Yr[0],ai=Yr[1],cn=an[0],pn=an[1]):W.raise("invalid shape");var Hn=Array.isArray(er.data)?ar.dtype:Ch(er.data),li=Nr.allocType(Hn,si*ai);Qu(li,er.data,si,ai,cn,pn,er.offset),Xr(li,en),Nr.freeType(li)}else W.raise("invalid data for buffer subdata");return Br}return wr||Br(ft),Br._reglType="buffer",Br._buffer=ar,Br.subdata=En,Ue.profile&&(Br.stats=ar.stats),Br.destroy=function(){Mr(ar)},Br}function Or(){Je(Et).forEach(function(ft){ft.buffer=H.createBuffer(),H.bindBuffer(ft.type,ft.buffer),H.bufferData(ft.type,ft.persistentData||ft.byteLength,ft.usage)})}return Ue.profile&&(Ee.getTotalBufferSize=function(){var ft=0;return Object.keys(Et).forEach(function(Ft){ft+=Et[Ft].stats.size}),ft}),{create:gr,createStream:br,destroyStream:Rr,clear:function(){Je(Et).forEach(Mr),sr.forEach(Mr)},getBuffer:function(ft){return ft&&ft._buffer instanceof jt?ft._buffer:null},restore:Or,_initBuffer:dr}}var Kd=0,Oo=0,au=1,Dp=1,Po=4,Jh=4,Fs={points:Kd,point:Oo,lines:au,line:Dp,triangles:Po,triangle:Jh,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Oc=0,Xs=1,Fo=4,yf=5120,Do=5121,sc=5122,Du=5123,uc=5124,xu=5125,va=34963,ro=35040,ou=35044;function ep(H,Ee,Ue,wt){var rr={},Et=0,jt={uint8:Do,uint16:Du};Ee.oes_element_index_uint&&(jt.uint32=xu);function sr(Or){this.id=Et++,rr[this.id]=this,this.buffer=Or,this.primType=Fo,this.vertCount=0,this.type=0}sr.prototype.bind=function(){this.buffer.bind()};var br=[];function Rr(Or){var ft=br.pop();return ft||(ft=new sr(Ue.create(null,va,!0,!1)._buffer)),dr(ft,Or,ro,-1,-1,0,0),ft}function Lr(Or){br.push(Or)}function dr(Or,ft,Ft,wr,Kr,ar,Br){Or.buffer.bind();var Xr;if(ft){var En=Br;!Br&&(!n(ft)||we(ft)&&!n(ft.data))&&(En=Ee.oes_element_index_uint?xu:Du),Ue._initBuffer(Or.buffer,ft,Ft,En,3)}else H.bufferData(va,ar,Ft),Or.buffer.dtype=Xr||Do,Or.buffer.usage=Ft,Or.buffer.dimension=3,Or.buffer.byteLength=ar;if(Xr=Br,!Br){switch(Or.buffer.dtype){case Do:case yf:Xr=Do;break;case Du:case sc:Xr=Du;break;case xu:case uc:Xr=xu;break;default:W.raise("unsupported type for element array")}Or.buffer.dtype=Xr}Or.type=Xr,W(Xr!==xu||!!Ee.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var er=Kr;er<0&&(er=Or.buffer.byteLength,Xr===Du?er>>=1:Xr===xu&&(er>>=2)),Or.vertCount=er;var Zt=wr;if(wr<0){Zt=Fo;var en=Or.buffer.dimension;en===1&&(Zt=Oc),en===2&&(Zt=Xs),en===3&&(Zt=Fo)}Or.primType=Zt}function Mr(Or){wt.elementsCount--,W(Or.buffer!==null,"must not double destroy elements"),delete rr[Or.id],Or.buffer.destroy(),Or.buffer=null}function gr(Or,ft){var Ft=Ue.create(null,va,!0),wr=new sr(Ft._buffer);wt.elementsCount++;function Kr(ar){if(!ar)Ft(),wr.primType=Fo,wr.vertCount=0,wr.type=Do;else if(typeof ar=="number")Ft(ar),wr.primType=Fo,wr.vertCount=ar|0,wr.type=Do;else{var Br=null,Xr=ou,En=-1,er=-1,Zt=0,en=0;Array.isArray(ar)||n(ar)||we(ar)?Br=ar:(W.type(ar,"object","invalid arguments for elements"),"data"in ar&&(Br=ar.data,W(Array.isArray(Br)||n(Br)||we(Br),"invalid data for element buffer")),"usage"in ar&&(W.parameter(ar.usage,Ji,"invalid element buffer usage"),Xr=Ji[ar.usage]),"primitive"in ar&&(W.parameter(ar.primitive,Fs,"invalid element buffer primitive"),En=Fs[ar.primitive]),"count"in ar&&(W(typeof ar.count=="number"&&ar.count>=0,"invalid vertex count for elements"),er=ar.count|0),"type"in ar&&(W.parameter(ar.type,jt,"invalid buffer type"),en=jt[ar.type]),"length"in ar?Zt=ar.length|0:(Zt=er,en===Du||en===sc?Zt*=2:(en===xu||en===uc)&&(Zt*=4))),dr(wr,Br,Xr,En,er,Zt,en)}return Kr}return Kr(Or),Kr._reglType="elements",Kr._elements=wr,Kr.subdata=function(ar,Br){return Ft.subdata(ar,Br),Kr},Kr.destroy=function(){Mr(wr)},Kr}return{create:gr,createStream:Rr,destroyStream:Lr,getElements:function(Or){return typeof Or=="function"&&Or._elements instanceof sr?Or._elements:null},clear:function(){Je(rr).forEach(Mr)}}}var tp=new Float32Array(1),Sh=new Uint32Array(tp.buffer),Qd=5123;function Pc(H){for(var Ee=Nr.allocType(Qd,H.length),Ue=0;Ue<H.length;++Ue)if(isNaN(H[Ue]))Ee[Ue]=65535;else if(H[Ue]===1/0)Ee[Ue]=31744;else if(H[Ue]===-1/0)Ee[Ue]=64512;else{tp[0]=H[Ue];var wt=Sh[0],rr=wt>>>31<<15,Et=(wt<<1>>>24)-127,jt=wt>>13&(1<<10)-1;if(Et<-24)Ee[Ue]=rr;else if(Et<-14){var sr=-14-Et;Ee[Ue]=rr+(jt+(1<<10)>>sr)}else Et>15?Ee[Ue]=rr+31744:Ee[Ue]=rr+(Et+15<<10)+jt}return Ee}function Wa(H){return Array.isArray(H)||n(H)}var lc=function(H){return!(H&H-1)&&!!H},wh=34467,Zs=3553,Ah=34067,bu=34069,Fc=6408,Ys=6406,Bu=6407,Xl=6409,_f=6410,ka=32854,Dc=32855,Bp=36194,Bc=32819,Nu=32820,rp=33635,Th=34042,xf=6402,cc=34041,Nc=35904,fc=35906,_l=36193,hc=33776,np=33777,zu=33778,qs=33779,zc=35986,Uc=35987,Vc=34798,Ks=35840,Zl=35841,Yf=35842,ip=35843,Mh=36196,Yl=5121,su=5123,Ih=5125,bf=5126,md=10242,ap=10243,Np=10497,Ef=33071,Gc=33648,pt=10240,ur=10241,Vt=9728,on=9729,Ei=9984,ua=9985,no=9986,Gn=9987,qi=33170,Qs=4352,uu=4353,jc=4354,Lh=34046,qf=3317,pc=37440,Cf=37441,fa=37443,ql=37444,lo=33984,Sf=[Ei,no,ua,Gn],op=[0,Xl,_f,Bu,Fc],ba={};ba[Xl]=ba[Ys]=ba[xf]=1,ba[cc]=ba[_f]=2,ba[Bu]=ba[Nc]=3,ba[Fc]=ba[fc]=4;function mn(H){return"[object "+H+"]"}var Xo=mn("HTMLCanvasElement"),Js=mn("OffscreenCanvas"),Ju=mn("CanvasRenderingContext2D"),Uu=mn("ImageBitmap"),fs=mn("HTMLImageElement"),Kf=mn("HTMLVideoElement"),qr=Object.keys(Ia).concat([Xo,Js,Ju,Uu,fs,Kf]),Kl=[];Kl[Yl]=1,Kl[bf]=4,Kl[_l]=2,Kl[su]=2,Kl[Ih]=4;var Jo=[];Jo[ka]=2,Jo[Dc]=2,Jo[Bp]=2,Jo[cc]=4,Jo[hc]=.5,Jo[np]=.5,Jo[zu]=1,Jo[qs]=1,Jo[zc]=.5,Jo[Uc]=1,Jo[Vc]=1,Jo[Ks]=.5,Jo[Zl]=.25,Jo[Yf]=.5,Jo[ip]=.25,Jo[Mh]=.5;function Hc(H){return Array.isArray(H)&&(H.length===0||typeof H[0]=="number")}function hs(H){if(!Array.isArray(H))return!1;var Ee=H.length;return!(Ee===0||!Wa(H[0]))}function Bo(H){return Object.prototype.toString.call(H)}function kh(H){return Bo(H)===Xo}function sp(H){return Bo(H)===Js}function Eu(H){return Bo(H)===Ju}function xl(H){return Bo(H)===Uu}function dc(H){return Bo(H)===fs}function bl(H){return Bo(H)===Kf}function Qf(H){var Ee=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Ee&&H&&H.getContext)}function vc(H){var Ee=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Ee&&H&&"src"in H&&"crossOrigin"in H)}function el(H){if(!H)return!1;if(Qf(H)||vc(H))return!0;var Ee=Bo(H);return qr.indexOf(Ee)>=0?!0:Hc(H)||hs(H)||we(H)}function Vu(H){return Ia[Object.prototype.toString.call(H)]|0}function ti(H,Ee){var Ue=Ee.length;switch(H.type){case Yl:case su:case Ih:case bf:var wt=Nr.allocType(H.type,Ue);wt.set(Ee),H.data=wt;break;case _l:H.data=Pc(Ee);break;default:W.raise("unsupported texture type, must specify a typed array")}}function _o(H,Ee){return Nr.allocType(H.type===_l?bf:H.type,Ee)}function Cu(H,Ee){H.type===_l?(H.data=Pc(Ee),Nr.freeType(Ee)):H.data=Ee}function Ds(H,Ee,Ue,wt,rr,Et){for(var jt=H.width,sr=H.height,br=H.channels,Rr=jt*sr*br,Lr=_o(H,Rr),dr=0,Mr=0;Mr<sr;++Mr)for(var gr=0;gr<jt;++gr)for(var Or=0;Or<br;++Or)Lr[dr++]=Ee[Ue*gr+wt*Mr+rr*Or+Et];Cu(H,Lr)}function El(H,Ee,Ue,wt,rr,Et){var jt;if(typeof Jo[H]<"u"?jt=Jo[H]:jt=ba[H]*Kl[Ee],Et&&(jt*=6),rr){for(var sr=0,br=Ue;br>=1;)sr+=jt*br*br,br/=2;return sr}else return jt*Ue*wt}function Wc(H,Ee,Ue,wt,rr,Et,jt){var sr={"don't care":Qs,"dont care":Qs,nice:jc,fast:uu},br={repeat:Np,clamp:Ef,mirror:Gc},Rr={nearest:Vt,linear:on},Lr=i({mipmap:Gn,"nearest mipmap nearest":Ei,"linear mipmap nearest":ua,"nearest mipmap linear":no,"linear mipmap linear":Gn},Rr),dr={none:0,browser:ql},Mr={uint8:Yl,rgba4:Bc,rgb565:rp,"rgb5 a1":Nu},gr={alpha:Ys,luminance:Xl,"luminance alpha":_f,rgb:Bu,rgba:Fc,rgba4:ka,"rgb5 a1":Dc,rgb565:Bp},Or={};Ee.ext_srgb&&(gr.srgb=Nc,gr.srgba=fc),Ee.oes_texture_float&&(Mr.float32=Mr.float=bf),Ee.oes_texture_half_float&&(Mr.float16=Mr["half float"]=_l),Ee.webgl_depth_texture&&(i(gr,{depth:xf,"depth stencil":cc}),i(Mr,{uint16:su,uint32:Ih,"depth stencil":Th})),Ee.webgl_compressed_texture_s3tc&&i(Or,{"rgb s3tc dxt1":hc,"rgba s3tc dxt1":np,"rgba s3tc dxt3":zu,"rgba s3tc dxt5":qs}),Ee.webgl_compressed_texture_atc&&i(Or,{"rgb atc":zc,"rgba atc explicit alpha":Uc,"rgba atc interpolated alpha":Vc}),Ee.webgl_compressed_texture_pvrtc&&i(Or,{"rgb pvrtc 4bppv1":Ks,"rgb pvrtc 2bppv1":Zl,"rgba pvrtc 4bppv1":Yf,"rgba pvrtc 2bppv1":ip}),Ee.webgl_compressed_texture_etc1&&(Or["rgb etc1"]=Mh);var ft=Array.prototype.slice.call(H.getParameter(wh)||new Uint32Array(0));Object.keys(Or).forEach(function(Oe){var Mt=Or[Oe];ft.indexOf(Mt)>=0&&(gr[Oe]=Mt)});var Ft=Object.keys(gr);Ue.textureFormats=Ft;var wr=[];Object.keys(gr).forEach(function(Oe){var Mt=gr[Oe];wr[Mt]=Oe});var Kr=[];Object.keys(Mr).forEach(function(Oe){var Mt=Mr[Oe];Kr[Mt]=Oe});var ar=[];Object.keys(Rr).forEach(function(Oe){var Mt=Rr[Oe];ar[Mt]=Oe});var Br=[];Object.keys(Lr).forEach(function(Oe){var Mt=Lr[Oe];Br[Mt]=Oe});var Xr=[];Object.keys(br).forEach(function(Oe){var Mt=br[Oe];Xr[Mt]=Oe});var En=Ft.reduce(function(Oe,Mt){var yt=gr[Mt];return yt===Xl||yt===Ys||yt===Xl||yt===_f||yt===xf||yt===cc||Ee.ext_srgb&&(yt===Nc||yt===fc)?Oe[yt]=yt:yt===Dc||Mt.indexOf("rgba")>=0?Oe[yt]=Fc:Oe[yt]=Bu,Oe},{});function er(){this.internalformat=Fc,this.format=Fc,this.type=Yl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ql,this.width=0,this.height=0,this.channels=0}function Zt(Oe,Mt){Oe.internalformat=Mt.internalformat,Oe.format=Mt.format,Oe.type=Mt.type,Oe.compressed=Mt.compressed,Oe.premultiplyAlpha=Mt.premultiplyAlpha,Oe.flipY=Mt.flipY,Oe.unpackAlignment=Mt.unpackAlignment,Oe.colorSpace=Mt.colorSpace,Oe.width=Mt.width,Oe.height=Mt.height,Oe.channels=Mt.channels}function en(Oe,Mt){if(!(typeof Mt!="object"||!Mt)){if("premultiplyAlpha"in Mt&&(W.type(Mt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Oe.premultiplyAlpha=Mt.premultiplyAlpha),"flipY"in Mt&&(W.type(Mt.flipY,"boolean","invalid texture flip"),Oe.flipY=Mt.flipY),"alignment"in Mt&&(W.oneOf(Mt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Oe.unpackAlignment=Mt.alignment),"colorSpace"in Mt&&(W.parameter(Mt.colorSpace,dr,"invalid colorSpace"),Oe.colorSpace=dr[Mt.colorSpace]),"type"in Mt){var yt=Mt.type;W(Ee.oes_texture_float||!(yt==="float"||yt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),W(Ee.oes_texture_half_float||!(yt==="half float"||yt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),W(Ee.webgl_depth_texture||!(yt==="uint16"||yt==="uint32"||yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),W.parameter(yt,Mr,"invalid texture type"),Oe.type=Mr[yt]}var gn=Oe.width,Vi=Oe.height,Te=Oe.channels,pe=!1;"shape"in Mt?(W(Array.isArray(Mt.shape)&&Mt.shape.length>=2,"shape must be an array"),gn=Mt.shape[0],Vi=Mt.shape[1],Mt.shape.length===3&&(Te=Mt.shape[2],W(Te>0&&Te<=4,"invalid number of channels"),pe=!0),W(gn>=0&&gn<=Ue.maxTextureSize,"invalid width"),W(Vi>=0&&Vi<=Ue.maxTextureSize,"invalid height")):("radius"in Mt&&(gn=Vi=Mt.radius,W(gn>=0&&gn<=Ue.maxTextureSize,"invalid radius")),"width"in Mt&&(gn=Mt.width,W(gn>=0&&gn<=Ue.maxTextureSize,"invalid width")),"height"in Mt&&(Vi=Mt.height,W(Vi>=0&&Vi<=Ue.maxTextureSize,"invalid height")),"channels"in Mt&&(Te=Mt.channels,W(Te>0&&Te<=4,"invalid number of channels"),pe=!0)),Oe.width=gn|0,Oe.height=Vi|0,Oe.channels=Te|0;var He=!1;if("format"in Mt){var ct=Mt.format;W(Ee.webgl_depth_texture||!(ct==="depth"||ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),W.parameter(ct,gr,"invalid texture format");var Tt=Oe.internalformat=gr[ct];Oe.format=En[Tt],ct in Mr&&("type"in Mt||(Oe.type=Mr[ct])),ct in Or&&(Oe.compressed=!0),He=!0}!pe&&He?Oe.channels=ba[Oe.format]:pe&&!He?Oe.channels!==op[Oe.format]&&(Oe.format=Oe.internalformat=op[Oe.channels]):He&&pe&&W(Oe.channels===ba[Oe.format],"number of channels inconsistent with specified format")}}function Yr(Oe){H.pixelStorei(pc,Oe.flipY),H.pixelStorei(Cf,Oe.premultiplyAlpha),H.pixelStorei(fa,Oe.colorSpace),H.pixelStorei(qf,Oe.unpackAlignment)}function Ir(){er.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Qr(Oe,Mt){var yt=null;if(el(Mt)?yt=Mt:Mt&&(W.type(Mt,"object","invalid pixel data type"),en(Oe,Mt),"x"in Mt&&(Oe.xOffset=Mt.x|0),"y"in Mt&&(Oe.yOffset=Mt.y|0),el(Mt.data)&&(yt=Mt.data)),W(!Oe.compressed||yt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Mt.copy){W(!yt,"can not specify copy and data field for the same texture");var gn=rr.viewportWidth,Vi=rr.viewportHeight;Oe.width=Oe.width||gn-Oe.xOffset,Oe.height=Oe.height||Vi-Oe.yOffset,Oe.needsCopy=!0,W(Oe.xOffset>=0&&Oe.xOffset<gn&&Oe.yOffset>=0&&Oe.yOffset<Vi&&Oe.width>0&&Oe.width<=gn&&Oe.height>0&&Oe.height<=Vi,"copy texture read out of bounds")}else if(!yt)Oe.width=Oe.width||1,Oe.height=Oe.height||1,Oe.channels=Oe.channels||4;else if(n(yt))Oe.channels=Oe.channels||4,Oe.data=yt,!("type"in Mt)&&Oe.type===Yl&&(Oe.type=Vu(yt));else if(Hc(yt))Oe.channels=Oe.channels||4,ti(Oe,yt),Oe.alignment=1,Oe.needsFree=!0;else if(we(yt)){var Te=yt.data;!Array.isArray(Te)&&Oe.type===Yl&&(Oe.type=Vu(Te));var pe=yt.shape,He=yt.stride,ct,Tt,rt,Ye,nt,de;pe.length===3?(rt=pe[2],de=He[2]):(W(pe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),rt=1,de=1),ct=pe[0],Tt=pe[1],Ye=He[0],nt=He[1],Oe.alignment=1,Oe.width=ct,Oe.height=Tt,Oe.channels=rt,Oe.format=Oe.internalformat=op[rt],Oe.needsFree=!0,Ds(Oe,Te,Ye,nt,de,yt.offset)}else if(Qf(yt)||kh(yt)||sp(yt)||Eu(yt))Qf(yt)||kh(yt)||sp(yt)?Oe.element=yt:Oe.element=yt.canvas,Oe.width=Oe.element.width,Oe.height=Oe.element.height,Oe.channels=4;else if(xl(yt))Oe.element=yt,Oe.width=yt.width,Oe.height=yt.height,Oe.channels=4;else if(dc(yt))Oe.element=yt,Oe.width=yt.naturalWidth,Oe.height=yt.naturalHeight,Oe.channels=4;else if(vc(yt))Oe.element=yt,Oe.width=yt.width,Oe.height=yt.height,Oe.channels=4;else if(bl(yt))Oe.element=yt,Oe.width=yt.videoWidth,Oe.height=yt.videoHeight,Oe.channels=4;else if(hs(yt)){var $e=Oe.width||yt[0].length,Le=Oe.height||yt.length,ut=Oe.channels;Wa(yt[0][0])?ut=ut||yt[0][0].length:ut=ut||1;for(var _t=Nt.shape(yt),lr=1,Hr=0;Hr<_t.length;++Hr)lr*=_t[Hr];var $r=_o(Oe,lr);Nt.flatten(yt,_t,"",$r),Cu(Oe,$r),Oe.alignment=1,Oe.width=$e,Oe.height=Le,Oe.channels=ut,Oe.format=Oe.internalformat=op[ut],Oe.needsFree=!0}Oe.type===bf?W(Ue.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Oe.type===_l&&W(Ue.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function an(Oe,Mt,yt){var gn=Oe.element,Vi=Oe.data,Te=Oe.internalformat,pe=Oe.format,He=Oe.type,ct=Oe.width,Tt=Oe.height;Yr(Oe),gn?H.texImage2D(Mt,yt,pe,pe,He,gn):Oe.compressed?H.compressedTexImage2D(Mt,yt,Te,ct,Tt,0,Vi):Oe.needsCopy?(wt(),H.copyTexImage2D(Mt,yt,pe,Oe.xOffset,Oe.yOffset,ct,Tt,0)):H.texImage2D(Mt,yt,pe,ct,Tt,0,pe,He,Vi||null)}function si(Oe,Mt,yt,gn,Vi){var Te=Oe.element,pe=Oe.data,He=Oe.internalformat,ct=Oe.format,Tt=Oe.type,rt=Oe.width,Ye=Oe.height;Yr(Oe),Te?H.texSubImage2D(Mt,Vi,yt,gn,ct,Tt,Te):Oe.compressed?H.compressedTexSubImage2D(Mt,Vi,yt,gn,He,rt,Ye,pe):Oe.needsCopy?(wt(),H.copyTexSubImage2D(Mt,Vi,yt,gn,Oe.xOffset,Oe.yOffset,rt,Ye)):H.texSubImage2D(Mt,Vi,yt,gn,rt,Ye,ct,Tt,pe)}var ai=[];function cn(){return ai.pop()||new Ir}function pn(Oe){Oe.needsFree&&Nr.freeType(Oe.data),Ir.call(Oe),ai.push(Oe)}function Hn(){er.call(this),this.genMipmaps=!1,this.mipmapHint=Qs,this.mipmask=0,this.images=Array(16)}function li(Oe,Mt,yt){var gn=Oe.images[0]=cn();Oe.mipmask=1,gn.width=Oe.width=Mt,gn.height=Oe.height=yt,gn.channels=Oe.channels=4}function fi(Oe,Mt){var yt=null;if(el(Mt))yt=Oe.images[0]=cn(),Zt(yt,Oe),Qr(yt,Mt),Oe.mipmask=1;else if(en(Oe,Mt),Array.isArray(Mt.mipmap))for(var gn=Mt.mipmap,Vi=0;Vi<gn.length;++Vi)yt=Oe.images[Vi]=cn(),Zt(yt,Oe),yt.width>>=Vi,yt.height>>=Vi,Qr(yt,gn[Vi]),Oe.mipmask|=1<<Vi;else yt=Oe.images[0]=cn(),Zt(yt,Oe),Qr(yt,Mt),Oe.mipmask=1;Zt(Oe,Oe.images[0]),Oe.compressed&&(Oe.internalformat===hc||Oe.internalformat===np||Oe.internalformat===zu||Oe.internalformat===qs)&&W(Oe.width%4===0&&Oe.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Pa(Oe,Mt){for(var yt=Oe.images,gn=0;gn<yt.length;++gn){if(!yt[gn])return;an(yt[gn],Mt,gn)}}var Yo=[];function zi(){var Oe=Yo.pop()||new Hn;er.call(Oe),Oe.mipmask=0;for(var Mt=0;Mt<16;++Mt)Oe.images[Mt]=null;return Oe}function Us(Oe){for(var Mt=Oe.images,yt=0;yt<Mt.length;++yt)Mt[yt]&&pn(Mt[yt]),Mt[yt]=null;Yo.push(Oe)}function ao(){this.minFilter=Vt,this.magFilter=Vt,this.wrapS=Ef,this.wrapT=Ef,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Qs}function ms(Oe,Mt){if("min"in Mt){var yt=Mt.min;W.parameter(yt,Lr),Oe.minFilter=Lr[yt],Sf.indexOf(Oe.minFilter)>=0&&!("faces"in Mt)&&(Oe.genMipmaps=!0)}if("mag"in Mt){var gn=Mt.mag;W.parameter(gn,Rr),Oe.magFilter=Rr[gn]}var Vi=Oe.wrapS,Te=Oe.wrapT;if("wrap"in Mt){var pe=Mt.wrap;typeof pe=="string"?(W.parameter(pe,br),Vi=Te=br[pe]):Array.isArray(pe)&&(W.parameter(pe[0],br),W.parameter(pe[1],br),Vi=br[pe[0]],Te=br[pe[1]])}else{if("wrapS"in Mt){var He=Mt.wrapS;W.parameter(He,br),Vi=br[He]}if("wrapT"in Mt){var ct=Mt.wrapT;W.parameter(ct,br),Te=br[ct]}}if(Oe.wrapS=Vi,Oe.wrapT=Te,"anisotropic"in Mt){var Tt=Mt.anisotropic;W(typeof Tt=="number"&&Tt>=1&&Tt<=Ue.maxAnisotropic,"aniso samples must be between 1 and "),Oe.anisotropic=Mt.anisotropic}if("mipmap"in Mt){var rt=!1;switch(typeof Mt.mipmap){case"string":W.parameter(Mt.mipmap,sr,"invalid mipmap hint"),Oe.mipmapHint=sr[Mt.mipmap],Oe.genMipmaps=!0,rt=!0;break;case"boolean":rt=Oe.genMipmaps=Mt.mipmap;break;case"object":W(Array.isArray(Mt.mipmap),"invalid mipmap type"),Oe.genMipmaps=!1,rt=!0;break;default:W.raise("invalid mipmap type")}rt&&!("min"in Mt)&&(Oe.minFilter=Ei)}}function as(Oe,Mt){H.texParameteri(Mt,ur,Oe.minFilter),H.texParameteri(Mt,pt,Oe.magFilter),H.texParameteri(Mt,md,Oe.wrapS),H.texParameteri(Mt,ap,Oe.wrapT),Ee.ext_texture_filter_anisotropic&&H.texParameteri(Mt,Lh,Oe.anisotropic),Oe.genMipmaps&&(H.hint(qi,Oe.mipmapHint),H.generateMipmap(Mt))}var Vs=0,Gs={},Ms=Ue.maxTextureUnits,wo=Array(Ms).map(function(){return null});function Si(Oe){er.call(this),this.mipmask=0,this.internalformat=Fc,this.id=Vs++,this.refCount=1,this.target=Oe,this.texture=H.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ao,jt.profile&&(this.stats={size:0})}function gs(Oe){H.activeTexture(lo),H.bindTexture(Oe.target,Oe.texture)}function ga(){var Oe=wo[0];Oe?H.bindTexture(Oe.target,Oe.texture):H.bindTexture(Zs,null)}function No(Oe){var Mt=Oe.texture;W(Mt,"must not double destroy texture");var yt=Oe.unit,gn=Oe.target;yt>=0&&(H.activeTexture(lo+yt),H.bindTexture(gn,null),wo[yt]=null),H.deleteTexture(Mt),Oe.texture=null,Oe.params=null,Oe.pixels=null,Oe.refCount=0,delete Gs[Oe.id],Et.textureCount--}i(Si.prototype,{bind:function(){var Oe=this;Oe.bindCount+=1;var Mt=Oe.unit;if(Mt<0){for(var yt=0;yt<Ms;++yt){var gn=wo[yt];if(gn){if(gn.bindCount>0)continue;gn.unit=-1}wo[yt]=Oe,Mt=yt;break}Mt>=Ms&&W.raise("insufficient number of texture units"),jt.profile&&Et.maxTextureUnits<Mt+1&&(Et.maxTextureUnits=Mt+1),Oe.unit=Mt,H.activeTexture(lo+Mt),H.bindTexture(Oe.target,Oe.texture)}return Mt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&No(this)}});function Jn(Oe,Mt){var yt=new Si(Zs);Gs[yt.id]=yt,Et.textureCount++;function gn(pe,He){var ct=yt.texInfo;ao.call(ct);var Tt=zi();return typeof pe=="number"?typeof He=="number"?li(Tt,pe|0,He|0):li(Tt,pe|0,pe|0):pe?(W.type(pe,"object","invalid arguments to regl.texture"),ms(ct,pe),fi(Tt,pe)):li(Tt,1,1),ct.genMipmaps&&(Tt.mipmask=(Tt.width<<1)-1),yt.mipmask=Tt.mipmask,Zt(yt,Tt),W.texture2D(ct,Tt,Ue),yt.internalformat=Tt.internalformat,gn.width=Tt.width,gn.height=Tt.height,gs(yt),Pa(Tt,Zs),as(ct,Zs),ga(),Us(Tt),jt.profile&&(yt.stats.size=El(yt.internalformat,yt.type,Tt.width,Tt.height,ct.genMipmaps,!1)),gn.format=wr[yt.internalformat],gn.type=Kr[yt.type],gn.mag=ar[ct.magFilter],gn.min=Br[ct.minFilter],gn.wrapS=Xr[ct.wrapS],gn.wrapT=Xr[ct.wrapT],gn}function Vi(pe,He,ct,Tt){W(!!pe,"must specify image data");var rt=He|0,Ye=ct|0,nt=Tt|0,de=cn();return Zt(de,yt),de.width=0,de.height=0,Qr(de,pe),de.width=de.width||(yt.width>>nt)-rt,de.height=de.height||(yt.height>>nt)-Ye,W(yt.type===de.type&&yt.format===de.format&&yt.internalformat===de.internalformat,"incompatible format for texture.subimage"),W(rt>=0&&Ye>=0&&rt+de.width<=yt.width&&Ye+de.height<=yt.height,"texture.subimage write out of bounds"),W(yt.mipmask&1<<nt,"missing mipmap data"),W(de.data||de.element||de.needsCopy,"missing image data"),gs(yt),si(de,Zs,rt,Ye,nt),ga(),pn(de),gn}function Te(pe,He){var ct=pe|0,Tt=He|0||ct;if(ct===yt.width&&Tt===yt.height)return gn;gn.width=yt.width=ct,gn.height=yt.height=Tt,gs(yt);for(var rt=0;yt.mipmask>>rt;++rt){var Ye=ct>>rt,nt=Tt>>rt;if(!Ye||!nt)break;H.texImage2D(Zs,rt,yt.format,Ye,nt,0,yt.format,yt.type,null)}return ga(),jt.profile&&(yt.stats.size=El(yt.internalformat,yt.type,ct,Tt,!1,!1)),gn}return gn(Oe,Mt),gn.subimage=Vi,gn.resize=Te,gn._reglType="texture2d",gn._texture=yt,jt.profile&&(gn.stats=yt.stats),gn.destroy=function(){yt.decRef()},gn}function Ui(Oe,Mt,yt,gn,Vi,Te){var pe=new Si(Ah);Gs[pe.id]=pe,Et.cubeCount++;var He=new Array(6);function ct(Ye,nt,de,$e,Le,ut){var _t,lr=pe.texInfo;for(ao.call(lr),_t=0;_t<6;++_t)He[_t]=zi();if(typeof Ye=="number"||!Ye){var Hr=Ye|0||1;for(_t=0;_t<6;++_t)li(He[_t],Hr,Hr)}else if(typeof Ye=="object")if(nt)fi(He[0],Ye),fi(He[1],nt),fi(He[2],de),fi(He[3],$e),fi(He[4],Le),fi(He[5],ut);else if(ms(lr,Ye),en(pe,Ye),"faces"in Ye){var $r=Ye.faces;for(W(Array.isArray($r)&&$r.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)W(typeof $r[_t]=="object"&&!!$r[_t],"invalid input for cube map face"),Zt(He[_t],pe),fi(He[_t],$r[_t])}else for(_t=0;_t<6;++_t)fi(He[_t],Ye);else W.raise("invalid arguments to cube map");for(Zt(pe,He[0]),W.optional(function(){Ue.npotTextureCube||W(lc(pe.width)&&lc(pe.height),"your browser does not support non power or two texture dimensions")}),lr.genMipmaps?pe.mipmask=(He[0].width<<1)-1:pe.mipmask=He[0].mipmask,W.textureCube(pe,lr,He,Ue),pe.internalformat=He[0].internalformat,ct.width=He[0].width,ct.height=He[0].height,gs(pe),_t=0;_t<6;++_t)Pa(He[_t],bu+_t);for(as(lr,Ah),ga(),jt.profile&&(pe.stats.size=El(pe.internalformat,pe.type,ct.width,ct.height,lr.genMipmaps,!0)),ct.format=wr[pe.internalformat],ct.type=Kr[pe.type],ct.mag=ar[lr.magFilter],ct.min=Br[lr.minFilter],ct.wrapS=Xr[lr.wrapS],ct.wrapT=Xr[lr.wrapT],_t=0;_t<6;++_t)Us(He[_t]);return ct}function Tt(Ye,nt,de,$e,Le){W(!!nt,"must specify image data"),W(typeof Ye=="number"&&Ye===(Ye|0)&&Ye>=0&&Ye<6,"invalid face");var ut=de|0,_t=$e|0,lr=Le|0,Hr=cn();return Zt(Hr,pe),Hr.width=0,Hr.height=0,Qr(Hr,nt),Hr.width=Hr.width||(pe.width>>lr)-ut,Hr.height=Hr.height||(pe.height>>lr)-_t,W(pe.type===Hr.type&&pe.format===Hr.format&&pe.internalformat===Hr.internalformat,"incompatible format for texture.subimage"),W(ut>=0&&_t>=0&&ut+Hr.width<=pe.width&&_t+Hr.height<=pe.height,"texture.subimage write out of bounds"),W(pe.mipmask&1<<lr,"missing mipmap data"),W(Hr.data||Hr.element||Hr.needsCopy,"missing image data"),gs(pe),si(Hr,bu+Ye,ut,_t,lr),ga(),pn(Hr),ct}function rt(Ye){var nt=Ye|0;if(nt!==pe.width){ct.width=pe.width=nt,ct.height=pe.height=nt,gs(pe);for(var de=0;de<6;++de)for(var $e=0;pe.mipmask>>$e;++$e)H.texImage2D(bu+de,$e,pe.format,nt>>$e,nt>>$e,0,pe.format,pe.type,null);return ga(),jt.profile&&(pe.stats.size=El(pe.internalformat,pe.type,ct.width,ct.height,!1,!0)),ct}}return ct(Oe,Mt,yt,gn,Vi,Te),ct.subimage=Tt,ct.resize=rt,ct._reglType="textureCube",ct._texture=pe,jt.profile&&(ct.stats=pe.stats),ct.destroy=function(){pe.decRef()},ct}function $a(){for(var Oe=0;Oe<Ms;++Oe)H.activeTexture(lo+Oe),H.bindTexture(Zs,null),wo[Oe]=null;Je(Gs).forEach(No),Et.cubeCount=0,Et.textureCount=0}jt.profile&&(Et.getTotalTextureSize=function(){var Oe=0;return Object.keys(Gs).forEach(function(Mt){Oe+=Gs[Mt].stats.size}),Oe});function ys(){for(var Oe=0;Oe<Ms;++Oe){var Mt=wo[Oe];Mt&&(Mt.bindCount=0,Mt.unit=-1,wo[Oe]=null)}Je(Gs).forEach(function(yt){yt.texture=H.createTexture(),H.bindTexture(yt.target,yt.texture);for(var gn=0;gn<32;++gn)if((yt.mipmask&1<<gn)!==0)if(yt.target===Zs)H.texImage2D(Zs,gn,yt.internalformat,yt.width>>gn,yt.height>>gn,0,yt.internalformat,yt.type,null);else for(var Vi=0;Vi<6;++Vi)H.texImage2D(bu+Vi,gn,yt.internalformat,yt.width>>gn,yt.height>>gn,0,yt.internalformat,yt.type,null);as(yt.texInfo,yt.target)})}function Pl(){for(var Oe=0;Oe<Ms;++Oe){var Mt=wo[Oe];Mt&&(Mt.bindCount=0,Mt.unit=-1,wo[Oe]=null),H.activeTexture(lo+Oe),H.bindTexture(Zs,null),H.bindTexture(Ah,null)}}return{create2D:Jn,createCube:Ui,clear:$a,getTexture:function(Oe){return null},restore:ys,refresh:Pl}}var ps=36161,xo=32854,$c=32855,kn=36194,bn=33189,mc=36168,ds=34041,Bs=35907,is=34836,Cl=34842,zp=34843,Su=[];Su[xo]=2,Su[$c]=2,Su[kn]=2,Su[bn]=2,Su[mc]=1,Su[ds]=4,Su[Bs]=4,Su[is]=16,Su[Cl]=8,Su[zp]=6;function ma(H,Ee,Ue){return Su[H]*Ee*Ue}var es=function(H,Ee,Ue,wt,rr){var Et={rgba4:xo,rgb565:kn,"rgb5 a1":$c,depth:bn,stencil:mc,"depth stencil":ds};Ee.ext_srgb&&(Et.srgba=Bs),Ee.ext_color_buffer_half_float&&(Et.rgba16f=Cl,Et.rgb16f=zp),Ee.webgl_color_buffer_float&&(Et.rgba32f=is);var jt=[];Object.keys(Et).forEach(function(gr){var Or=Et[gr];jt[Or]=gr});var sr=0,br={};function Rr(gr){this.id=sr++,this.refCount=1,this.renderbuffer=gr,this.format=xo,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}Rr.prototype.decRef=function(){--this.refCount<=0&&Lr(this)};function Lr(gr){var Or=gr.renderbuffer;W(Or,"must not double destroy renderbuffer"),H.bindRenderbuffer(ps,null),H.deleteRenderbuffer(Or),gr.renderbuffer=null,gr.refCount=0,delete br[gr.id],wt.renderbufferCount--}function dr(gr,Or){var ft=new Rr(H.createRenderbuffer());br[ft.id]=ft,wt.renderbufferCount++;function Ft(Kr,ar){var Br=0,Xr=0,En=xo;if(typeof Kr=="object"&&Kr){var er=Kr;if("shape"in er){var Zt=er.shape;W(Array.isArray(Zt)&&Zt.length>=2,"invalid renderbuffer shape"),Br=Zt[0]|0,Xr=Zt[1]|0}else"radius"in er&&(Br=Xr=er.radius|0),"width"in er&&(Br=er.width|0),"height"in er&&(Xr=er.height|0);"format"in er&&(W.parameter(er.format,Et,"invalid renderbuffer format"),En=Et[er.format])}else typeof Kr=="number"?(Br=Kr|0,typeof ar=="number"?Xr=ar|0:Xr=Br):Kr?W.raise("invalid arguments to renderbuffer constructor"):Br=Xr=1;if(W(Br>0&&Xr>0&&Br<=Ue.maxRenderbufferSize&&Xr<=Ue.maxRenderbufferSize,"invalid renderbuffer size"),!(Br===ft.width&&Xr===ft.height&&En===ft.format))return Ft.width=ft.width=Br,Ft.height=ft.height=Xr,ft.format=En,H.bindRenderbuffer(ps,ft.renderbuffer),H.renderbufferStorage(ps,En,Br,Xr),W(H.getError()===0,"invalid render buffer format"),rr.profile&&(ft.stats.size=ma(ft.format,ft.width,ft.height)),Ft.format=jt[ft.format],Ft}function wr(Kr,ar){var Br=Kr|0,Xr=ar|0||Br;return Br===ft.width&&Xr===ft.height||(W(Br>0&&Xr>0&&Br<=Ue.maxRenderbufferSize&&Xr<=Ue.maxRenderbufferSize,"invalid renderbuffer size"),Ft.width=ft.width=Br,Ft.height=ft.height=Xr,H.bindRenderbuffer(ps,ft.renderbuffer),H.renderbufferStorage(ps,ft.format,Br,Xr),W(H.getError()===0,"invalid render buffer format"),rr.profile&&(ft.stats.size=ma(ft.format,ft.width,ft.height))),Ft}return Ft(gr,Or),Ft.resize=wr,Ft._reglType="renderbuffer",Ft._renderbuffer=ft,rr.profile&&(Ft.stats=ft.stats),Ft.destroy=function(){ft.decRef()},Ft}rr.profile&&(wt.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(br).forEach(function(Or){gr+=br[Or].stats.size}),gr});function Mr(){Je(br).forEach(function(gr){gr.renderbuffer=H.createRenderbuffer(),H.bindRenderbuffer(ps,gr.renderbuffer),H.renderbufferStorage(ps,gr.format,gr.width,gr.height)}),H.bindRenderbuffer(ps,null)}return{create:dr,clear:function(){Je(br).forEach(Lr)},restore:Mr}},lu=36160,Sl=36161,ye=3553,Ns=34069,vs=36064,Es=36096,Ii=36128,Jf=33306,wu=36053,Rh=36054,wl=36055,eh=36057,th=36061,gd=36193,wf=5121,Af=5126,tl=6407,gc=6408,Al=6402,Oh=[tl,gc],Xc=[];Xc[gc]=4,Xc[tl]=3;var rh=[];rh[wf]=1,rh[Af]=4,rh[gd]=2;var rl=32854,d=32855,g=36194,v=33189,x=36168,T=34041,R=35907,F=34836,U=34842,X=34843,re=[rl,d,g,R,U,X,F],he={};he[wu]="complete",he[Rh]="incomplete attachment",he[eh]="incomplete dimensions",he[wl]="incomplete, missing attachment",he[th]="unsupported";function me(H,Ee,Ue,wt,rr,Et){var jt={cur:null,next:null,dirty:!1,setFBO:null},sr=["rgba"],br=["rgba4","rgb565","rgb5 a1"];Ee.ext_srgb&&br.push("srgba"),Ee.ext_color_buffer_half_float&&br.push("rgba16f","rgb16f"),Ee.webgl_color_buffer_float&&br.push("rgba32f");var Rr=["uint8"];Ee.oes_texture_half_float&&Rr.push("half float","float16"),Ee.oes_texture_float&&Rr.push("float","float32");function Lr(Ir,Qr,an){this.target=Ir,this.texture=Qr,this.renderbuffer=an;var si=0,ai=0;Qr?(si=Qr.width,ai=Qr.height):an&&(si=an.width,ai=an.height),this.width=si,this.height=ai}function dr(Ir){Ir&&(Ir.texture&&Ir.texture._texture.decRef(),Ir.renderbuffer&&Ir.renderbuffer._renderbuffer.decRef())}function Mr(Ir,Qr,an){if(!!Ir)if(Ir.texture){var si=Ir.texture._texture,ai=Math.max(1,si.width),cn=Math.max(1,si.height);W(ai===Qr&&cn===an,"inconsistent width/height for supplied texture"),si.refCount+=1}else{var pn=Ir.renderbuffer._renderbuffer;W(pn.width===Qr&&pn.height===an,"inconsistent width/height for renderbuffer"),pn.refCount+=1}}function gr(Ir,Qr){Qr&&(Qr.texture?H.framebufferTexture2D(lu,Ir,Qr.target,Qr.texture._texture.texture,0):H.framebufferRenderbuffer(lu,Ir,Sl,Qr.renderbuffer._renderbuffer.renderbuffer))}function Or(Ir){var Qr=ye,an=null,si=null,ai=Ir;typeof Ir=="object"&&(ai=Ir.data,"target"in Ir&&(Qr=Ir.target|0)),W.type(ai,"function","invalid attachment data");var cn=ai._reglType;return cn==="texture2d"?(an=ai,W(Qr===ye)):cn==="textureCube"?(an=ai,W(Qr>=Ns&&Qr<Ns+6,"invalid cube map target")):cn==="renderbuffer"?(si=ai,Qr=Sl):W.raise("invalid regl object for attachment"),new Lr(Qr,an,si)}function ft(Ir,Qr,an,si,ai){if(an){var cn=wt.create2D({width:Ir,height:Qr,format:si,type:ai});return cn._texture.refCount=0,new Lr(ye,cn,null)}else{var pn=rr.create({width:Ir,height:Qr,format:si});return pn._renderbuffer.refCount=0,new Lr(Sl,null,pn)}}function Ft(Ir){return Ir&&(Ir.texture||Ir.renderbuffer)}function wr(Ir,Qr,an){Ir&&(Ir.texture?Ir.texture.resize(Qr,an):Ir.renderbuffer&&Ir.renderbuffer.resize(Qr,an),Ir.width=Qr,Ir.height=an)}var Kr=0,ar={};function Br(){this.id=Kr++,ar[this.id]=this,this.framebuffer=H.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Xr(Ir){Ir.colorAttachments.forEach(dr),dr(Ir.depthAttachment),dr(Ir.stencilAttachment),dr(Ir.depthStencilAttachment)}function En(Ir){var Qr=Ir.framebuffer;W(Qr,"must not double destroy framebuffer"),H.deleteFramebuffer(Qr),Ir.framebuffer=null,Et.framebufferCount--,delete ar[Ir.id]}function er(Ir){var Qr;H.bindFramebuffer(lu,Ir.framebuffer);var an=Ir.colorAttachments;for(Qr=0;Qr<an.length;++Qr)gr(vs+Qr,an[Qr]);for(Qr=an.length;Qr<Ue.maxColorAttachments;++Qr)H.framebufferTexture2D(lu,vs+Qr,ye,null,0);H.framebufferTexture2D(lu,Jf,ye,null,0),H.framebufferTexture2D(lu,Es,ye,null,0),H.framebufferTexture2D(lu,Ii,ye,null,0),gr(Es,Ir.depthAttachment),gr(Ii,Ir.stencilAttachment),gr(Jf,Ir.depthStencilAttachment);var si=H.checkFramebufferStatus(lu);!H.isContextLost()&&si!==wu&&W.raise("framebuffer configuration not supported, status = "+he[si]),H.bindFramebuffer(lu,jt.next?jt.next.framebuffer:null),jt.cur=jt.next,H.getError()}function Zt(Ir,Qr){var an=new Br;Et.framebufferCount++;function si(cn,pn){var Hn;W(jt.next!==an,"can not update framebuffer which is currently in use");var li=0,fi=0,Pa=!0,Yo=!0,zi=null,Us=!0,ao="rgba",ms="uint8",as=1,Vs=null,Gs=null,Ms=null,wo=!1;if(typeof cn=="number")li=cn|0,fi=pn|0||li;else if(!cn)li=fi=1;else{W.type(cn,"object","invalid arguments for framebuffer");var Si=cn;if("shape"in Si){var gs=Si.shape;W(Array.isArray(gs)&&gs.length>=2,"invalid shape for framebuffer"),li=gs[0],fi=gs[1]}else"radius"in Si&&(li=fi=Si.radius),"width"in Si&&(li=Si.width),"height"in Si&&(fi=Si.height);("color"in Si||"colors"in Si)&&(zi=Si.color||Si.colors,Array.isArray(zi)&&W(zi.length===1||Ee.webgl_draw_buffers,"multiple render targets not supported")),zi||("colorCount"in Si&&(as=Si.colorCount|0,W(as>0,"invalid color buffer count")),"colorTexture"in Si&&(Us=!!Si.colorTexture,ao="rgba4"),"colorType"in Si&&(ms=Si.colorType,Us?(W(Ee.oes_texture_float||!(ms==="float"||ms==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),W(Ee.oes_texture_half_float||!(ms==="half float"||ms==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ms==="half float"||ms==="float16"?(W(Ee.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ao="rgba16f"):(ms==="float"||ms==="float32")&&(W(Ee.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ao="rgba32f"),W.oneOf(ms,Rr,"invalid color type")),"colorFormat"in Si&&(ao=Si.colorFormat,sr.indexOf(ao)>=0?Us=!0:br.indexOf(ao)>=0?Us=!1:W.optional(function(){Us?W.oneOf(Si.colorFormat,sr,"invalid color format for texture"):W.oneOf(Si.colorFormat,br,"invalid color format for renderbuffer")}))),("depthTexture"in Si||"depthStencilTexture"in Si)&&(wo=!!(Si.depthTexture||Si.depthStencilTexture),W(!wo||Ee.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Si&&(typeof Si.depth=="boolean"?Pa=Si.depth:(Vs=Si.depth,Yo=!1)),"stencil"in Si&&(typeof Si.stencil=="boolean"?Yo=Si.stencil:(Gs=Si.stencil,Pa=!1)),"depthStencil"in Si&&(typeof Si.depthStencil=="boolean"?Pa=Yo=Si.depthStencil:(Ms=Si.depthStencil,Pa=!1,Yo=!1))}var ga=null,No=null,Jn=null,Ui=null;if(Array.isArray(zi))ga=zi.map(Or);else if(zi)ga=[Or(zi)];else for(ga=new Array(as),Hn=0;Hn<as;++Hn)ga[Hn]=ft(li,fi,Us,ao,ms);W(Ee.webgl_draw_buffers||ga.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),W(ga.length<=Ue.maxColorAttachments,"too many color attachments, not supported"),li=li||ga[0].width,fi=fi||ga[0].height,Vs?No=Or(Vs):Pa&&!Yo&&(No=ft(li,fi,wo,"depth","uint32")),Gs?Jn=Or(Gs):Yo&&!Pa&&(Jn=ft(li,fi,!1,"stencil","uint8")),Ms?Ui=Or(Ms):!Vs&&!Gs&&Yo&&Pa&&(Ui=ft(li,fi,wo,"depth stencil","depth stencil")),W(!!Vs+!!Gs+!!Ms<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var $a=null;for(Hn=0;Hn<ga.length;++Hn)if(Mr(ga[Hn],li,fi),W(!ga[Hn]||ga[Hn].texture&&Oh.indexOf(ga[Hn].texture._texture.format)>=0||ga[Hn].renderbuffer&&re.indexOf(ga[Hn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Hn+" is invalid"),ga[Hn]&&ga[Hn].texture){var ys=Xc[ga[Hn].texture._texture.format]*rh[ga[Hn].texture._texture.type];$a===null?$a=ys:W($a===ys,"all color attachments much have the same number of bits per pixel.")}return Mr(No,li,fi),W(!No||No.texture&&No.texture._texture.format===Al||No.renderbuffer&&No.renderbuffer._renderbuffer.format===v,"invalid depth attachment for framebuffer object"),Mr(Jn,li,fi),W(!Jn||Jn.renderbuffer&&Jn.renderbuffer._renderbuffer.format===x,"invalid stencil attachment for framebuffer object"),Mr(Ui,li,fi),W(!Ui||Ui.texture&&Ui.texture._texture.format===T||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===T,"invalid depth-stencil attachment for framebuffer object"),Xr(an),an.width=li,an.height=fi,an.colorAttachments=ga,an.depthAttachment=No,an.stencilAttachment=Jn,an.depthStencilAttachment=Ui,si.color=ga.map(Ft),si.depth=Ft(No),si.stencil=Ft(Jn),si.depthStencil=Ft(Ui),si.width=an.width,si.height=an.height,er(an),si}function ai(cn,pn){W(jt.next!==an,"can not resize a framebuffer which is currently in use");var Hn=Math.max(cn|0,1),li=Math.max(pn|0||Hn,1);if(Hn===an.width&&li===an.height)return si;for(var fi=an.colorAttachments,Pa=0;Pa<fi.length;++Pa)wr(fi[Pa],Hn,li);return wr(an.depthAttachment,Hn,li),wr(an.stencilAttachment,Hn,li),wr(an.depthStencilAttachment,Hn,li),an.width=si.width=Hn,an.height=si.height=li,er(an),si}return si(Ir,Qr),i(si,{resize:ai,_reglType:"framebuffer",_framebuffer:an,destroy:function(){En(an),Xr(an)},use:function(cn){jt.setFBO({framebuffer:si},cn)}})}function en(Ir){var Qr=Array(6);function an(ai){var cn;W(Qr.indexOf(jt.next)<0,"can not update framebuffer which is currently in use");var pn={color:null},Hn=0,li=null,fi="rgba",Pa="uint8",Yo=1;if(typeof ai=="number")Hn=ai|0;else if(!ai)Hn=1;else{W.type(ai,"object","invalid arguments for framebuffer");var zi=ai;if("shape"in zi){var Us=zi.shape;W(Array.isArray(Us)&&Us.length>=2,"invalid shape for framebuffer"),W(Us[0]===Us[1],"cube framebuffer must be square"),Hn=Us[0]}else"radius"in zi&&(Hn=zi.radius|0),"width"in zi?(Hn=zi.width|0,"height"in zi&&W(zi.height===Hn,"must be square")):"height"in zi&&(Hn=zi.height|0);("color"in zi||"colors"in zi)&&(li=zi.color||zi.colors,Array.isArray(li)&&W(li.length===1||Ee.webgl_draw_buffers,"multiple render targets not supported")),li||("colorCount"in zi&&(Yo=zi.colorCount|0,W(Yo>0,"invalid color buffer count")),"colorType"in zi&&(W.oneOf(zi.colorType,Rr,"invalid color type"),Pa=zi.colorType),"colorFormat"in zi&&(fi=zi.colorFormat,W.oneOf(zi.colorFormat,sr,"invalid color format for texture"))),"depth"in zi&&(pn.depth=zi.depth),"stencil"in zi&&(pn.stencil=zi.stencil),"depthStencil"in zi&&(pn.depthStencil=zi.depthStencil)}var ao;if(li)if(Array.isArray(li))for(ao=[],cn=0;cn<li.length;++cn)ao[cn]=li[cn];else ao=[li];else{ao=Array(Yo);var ms={radius:Hn,format:fi,type:Pa};for(cn=0;cn<Yo;++cn)ao[cn]=wt.createCube(ms)}for(pn.color=Array(ao.length),cn=0;cn<ao.length;++cn){var as=ao[cn];W(typeof as=="function"&&as._reglType==="textureCube","invalid cube map"),Hn=Hn||as.width,W(as.width===Hn&&as.height===Hn,"invalid cube map shape"),pn.color[cn]={target:Ns,data:ao[cn]}}for(cn=0;cn<6;++cn){for(var Vs=0;Vs<ao.length;++Vs)pn.color[Vs].target=Ns+cn;cn>0&&(pn.depth=Qr[0].depth,pn.stencil=Qr[0].stencil,pn.depthStencil=Qr[0].depthStencil),Qr[cn]?Qr[cn](pn):Qr[cn]=Zt(pn)}return i(an,{width:Hn,height:Hn,color:ao})}function si(ai){var cn,pn=ai|0;if(W(pn>0&&pn<=Ue.maxCubeMapSize,"invalid radius for cube fbo"),pn===an.width)return an;var Hn=an.color;for(cn=0;cn<Hn.length;++cn)Hn[cn].resize(pn);for(cn=0;cn<6;++cn)Qr[cn].resize(pn);return an.width=an.height=pn,an}return an(Ir),i(an,{faces:Qr,resize:si,_reglType:"framebufferCube",destroy:function(){Qr.forEach(function(ai){ai.destroy()})}})}function Yr(){jt.cur=null,jt.next=null,jt.dirty=!0,Je(ar).forEach(function(Ir){Ir.framebuffer=H.createFramebuffer(),er(Ir)})}return i(jt,{getFramebuffer:function(Ir){if(typeof Ir=="function"&&Ir._reglType==="framebuffer"){var Qr=Ir._framebuffer;if(Qr instanceof Br)return Qr}return null},create:Zt,createCube:en,clear:function(){Je(ar).forEach(En)},restore:Yr})}var xe=5126,Ne=34962,Fe=34963,qe=["attributes","elements","offset","count","primitive","instances"];function Re(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=xe,this.offset=0,this.stride=0,this.divisor=0}function Ze(H,Ee,Ue,wt,rr,Et,jt){for(var sr=Ue.maxAttributes,br=new Array(sr),Rr=0;Rr<sr;++Rr)br[Rr]=new Re;var Lr=0,dr={},Mr={Record:Re,scope:{},state:br,currentVAO:null,targetVAO:null,restore:Or()?Xr:function(){},createVAO:En,getVAO:Ft,destroyBuffer:gr,setVAO:Or()?wr:Kr,clear:Or()?ar:function(){}};function gr(er){for(var Zt=0;Zt<br.length;++Zt){var en=br[Zt];en.buffer===er&&(H.disableVertexAttribArray(Zt),en.buffer=null)}}function Or(){return Ee.oes_vertex_array_object}function ft(){return Ee.angle_instanced_arrays}function Ft(er){return typeof er=="function"&&er._vao?er._vao:null}function wr(er){if(er!==Mr.currentVAO){var Zt=Or();er?Zt.bindVertexArrayOES(er.vao):Zt.bindVertexArrayOES(null),Mr.currentVAO=er}}function Kr(er){if(er!==Mr.currentVAO){if(er)er.bindAttrs();else{for(var Zt=ft(),en=0;en<br.length;++en){var Yr=br[en];Yr.buffer?(H.enableVertexAttribArray(en),Yr.buffer.bind(),H.vertexAttribPointer(en,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offfset),Zt&&Yr.divisor&&Zt.vertexAttribDivisorANGLE(en,Yr.divisor)):(H.disableVertexAttribArray(en),H.vertexAttrib4f(en,Yr.x,Yr.y,Yr.z,Yr.w))}jt.elements?H.bindBuffer(Fe,jt.elements.buffer.buffer):H.bindBuffer(Fe,null)}Mr.currentVAO=er}}function ar(){Je(dr).forEach(function(er){er.destroy()})}function Br(){this.id=++Lr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var er=Or();er?this.vao=er.createVertexArrayOES():this.vao=null,dr[this.id]=this,this.buffers=[]}Br.prototype.bindAttrs=function(){for(var er=ft(),Zt=this.attributes,en=0;en<Zt.length;++en){var Yr=Zt[en];Yr.buffer?(H.enableVertexAttribArray(en),H.bindBuffer(Ne,Yr.buffer.buffer),H.vertexAttribPointer(en,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offset),er&&Yr.divisor&&er.vertexAttribDivisorANGLE(en,Yr.divisor)):(H.disableVertexAttribArray(en),H.vertexAttrib4f(en,Yr.x,Yr.y,Yr.z,Yr.w))}for(var Ir=Zt.length;Ir<sr;++Ir)H.disableVertexAttribArray(Ir);var Qr=Et.getElements(this.elements);Qr?H.bindBuffer(Fe,Qr.buffer.buffer):H.bindBuffer(Fe,null)},Br.prototype.refresh=function(){var er=Or();er&&(er.bindVertexArrayOES(this.vao),this.bindAttrs(),Mr.currentVAO=null,er.bindVertexArrayOES(null))},Br.prototype.destroy=function(){if(this.vao){var er=Or();this===Mr.currentVAO&&(Mr.currentVAO=null,er.bindVertexArrayOES(null)),er.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),dr[this.id]&&(delete dr[this.id],wt.vaoCount-=1)};function Xr(){var er=Or();er&&Je(dr).forEach(function(Zt){Zt.refresh()})}function En(er){var Zt=new Br;wt.vaoCount+=1;function en(Yr){var Ir;if(Array.isArray(Yr))Ir=Yr,Zt.elements&&Zt.ownsElements&&Zt.elements.destroy(),Zt.elements=null,Zt.ownsElements=!1,Zt.offset=0,Zt.count=0,Zt.instances=-1,Zt.primitive=4;else{if(W(typeof Yr=="object","invalid arguments for create vao"),W("attributes"in Yr,"must specify attributes for vao"),Yr.elements){var Qr=Yr.elements;Zt.ownsElements?typeof Qr=="function"&&Qr._reglType==="elements"?(Zt.elements.destroy(),Zt.ownsElements=!1):(Zt.elements(Qr),Zt.ownsElements=!1):Et.getElements(Yr.elements)?(Zt.elements=Yr.elements,Zt.ownsElements=!1):(Zt.elements=Et.create(Yr.elements),Zt.ownsElements=!0)}else Zt.elements=null,Zt.ownsElements=!1;Ir=Yr.attributes,Zt.offset=0,Zt.count=-1,Zt.instances=-1,Zt.primitive=4,Zt.elements&&(Zt.count=Zt.elements._elements.vertCount,Zt.primitive=Zt.elements._elements.primType),"offset"in Yr&&(Zt.offset=Yr.offset|0),"count"in Yr&&(Zt.count=Yr.count|0),"instances"in Yr&&(Zt.instances=Yr.instances|0),"primitive"in Yr&&(W(Yr.primitive in Fs,"bad primitive type: "+Yr.primitive),Zt.primitive=Fs[Yr.primitive]),W.optional(function(){for(var Pa=Object.keys(Yr),Yo=0;Yo<Pa.length;++Yo)W(qe.indexOf(Pa[Yo])>=0,'invalid option for vao: "'+Pa[Yo]+'" valid options are '+qe)}),W(Array.isArray(Ir),"attributes must be an array")}W(Ir.length<sr,"too many attributes"),W(Ir.length>0,"must specify at least one attribute");var an={},si=Zt.attributes;si.length=Ir.length;for(var ai=0;ai<Ir.length;++ai){var cn=Ir[ai],pn=si[ai]=new Re,Hn=cn.data||cn;if(Array.isArray(Hn)||n(Hn)||we(Hn)){var li;Zt.buffers[ai]&&(li=Zt.buffers[ai],n(Hn)&&li._buffer.byteLength>=Hn.byteLength?li.subdata(Hn):(li.destroy(),Zt.buffers[ai]=null)),Zt.buffers[ai]||(li=Zt.buffers[ai]=rr.create(cn,Ne,!1,!0)),pn.buffer=rr.getBuffer(li),pn.size=pn.buffer.dimension|0,pn.normalized=!1,pn.type=pn.buffer.dtype,pn.offset=0,pn.stride=0,pn.divisor=0,pn.state=1,an[ai]=1}else rr.getBuffer(cn)?(pn.buffer=rr.getBuffer(cn),pn.size=pn.buffer.dimension|0,pn.normalized=!1,pn.type=pn.buffer.dtype,pn.offset=0,pn.stride=0,pn.divisor=0,pn.state=1):rr.getBuffer(cn.buffer)?(pn.buffer=rr.getBuffer(cn.buffer),pn.size=(+cn.size||pn.buffer.dimension)|0,pn.normalized=!!cn.normalized||!1,"type"in cn?(W.parameter(cn.type,yu,"invalid buffer type"),pn.type=yu[cn.type]):pn.type=pn.buffer.dtype,pn.offset=(cn.offset||0)|0,pn.stride=(cn.stride||0)|0,pn.divisor=(cn.divisor||0)|0,pn.state=1,W(pn.size>=1&&pn.size<=4,"size must be between 1 and 4"),W(pn.offset>=0,"invalid offset"),W(pn.stride>=0&&pn.stride<=255,"stride must be between 0 and 255"),W(pn.divisor>=0,"divisor must be positive"),W(!pn.divisor||!!Ee.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in cn?(W(ai>0,"first attribute must not be a constant"),pn.x=+cn.x||0,pn.y=+cn.y||0,pn.z=+cn.z||0,pn.w=+cn.w||0,pn.state=2):W(!1,"invalid attribute spec for location "+ai)}for(var fi=0;fi<Zt.buffers.length;++fi)!an[fi]&&Zt.buffers[fi]&&(Zt.buffers[fi].destroy(),Zt.buffers[fi]=null);return Zt.refresh(),en}return en.destroy=function(){for(var Yr=0;Yr<Zt.buffers.length;++Yr)Zt.buffers[Yr]&&Zt.buffers[Yr].destroy();Zt.buffers.length=0,Zt.ownsElements&&(Zt.elements.destroy(),Zt.elements=null,Zt.ownsElements=!1),Zt.destroy()},en._vao=Zt,en._reglType="vao",en(er)}return Mr}var at=35632,ht=35633,Ot=35718,It=35721;function Ut(H,Ee,Ue,wt){var rr={},Et={};function jt(ft,Ft,wr,Kr){this.name=ft,this.id=Ft,this.location=wr,this.info=Kr}function sr(ft,Ft){for(var wr=0;wr<ft.length;++wr)if(ft[wr].id===Ft.id){ft[wr].location=Ft.location;return}ft.push(Ft)}function br(ft,Ft,wr){var Kr=ft===at?rr:Et,ar=Kr[Ft];if(!ar){var Br=Ee.str(Ft);ar=H.createShader(ft),H.shaderSource(ar,Br),H.compileShader(ar),W.shaderError(H,ar,Br,ft,wr),Kr[Ft]=ar}return ar}var Rr={},Lr=[],dr=0;function Mr(ft,Ft){this.id=dr++,this.fragId=ft,this.vertId=Ft,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,wt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(ft,Ft,wr){var Kr,ar,Br=br(at,ft.fragId),Xr=br(ht,ft.vertId),En=ft.program=H.createProgram();if(H.attachShader(En,Br),H.attachShader(En,Xr),wr)for(Kr=0;Kr<wr.length;++Kr){var er=wr[Kr];H.bindAttribLocation(En,er[0],er[1])}H.linkProgram(En),W.linkError(H,En,Ee.str(ft.fragId),Ee.str(ft.vertId),Ft);var Zt=H.getProgramParameter(En,Ot);wt.profile&&(ft.stats.uniformsCount=Zt);var en=ft.uniforms;for(Kr=0;Kr<Zt;++Kr)if(ar=H.getActiveUniform(En,Kr),ar)if(ar.size>1)for(var Yr=0;Yr<ar.size;++Yr){var Ir=ar.name.replace("[0]","["+Yr+"]");sr(en,new jt(Ir,Ee.id(Ir),H.getUniformLocation(En,Ir),ar))}else sr(en,new jt(ar.name,Ee.id(ar.name),H.getUniformLocation(En,ar.name),ar));var Qr=H.getProgramParameter(En,It);wt.profile&&(ft.stats.attributesCount=Qr);var an=ft.attributes;for(Kr=0;Kr<Qr;++Kr)ar=H.getActiveAttrib(En,Kr),ar&&sr(an,new jt(ar.name,Ee.id(ar.name),H.getAttribLocation(En,ar.name),ar))}wt.profile&&(Ue.getMaxUniformsCount=function(){var ft=0;return Lr.forEach(function(Ft){Ft.stats.uniformsCount>ft&&(ft=Ft.stats.uniformsCount)}),ft},Ue.getMaxAttributesCount=function(){var ft=0;return Lr.forEach(function(Ft){Ft.stats.attributesCount>ft&&(ft=Ft.stats.attributesCount)}),ft});function Or(){rr={},Et={};for(var ft=0;ft<Lr.length;++ft)gr(Lr[ft],null,Lr[ft].attributes.map(function(Ft){return[Ft.location,Ft.name]}))}return{clear:function(){var ft=H.deleteShader.bind(H);Je(rr).forEach(ft),rr={},Je(Et).forEach(ft),Et={},Lr.forEach(function(Ft){H.deleteProgram(Ft.program)}),Lr.length=0,Rr={},Ue.shaderCount=0},program:function(ft,Ft,wr,Kr){W.command(ft>=0,"missing vertex shader",wr),W.command(Ft>=0,"missing fragment shader",wr);var ar=Rr[Ft];ar||(ar=Rr[Ft]={});var Br=ar[ft];if(Br&&(Br.refCount++,!Kr))return Br;var Xr=new Mr(Ft,ft);return Ue.shaderCount++,gr(Xr,wr,Kr),Br||(ar[ft]=Xr),Lr.push(Xr),i(Xr,{destroy:function(){if(Xr.refCount--,Xr.refCount<=0){H.deleteProgram(Xr.program);var En=Lr.indexOf(Xr);Lr.splice(En,1),Ue.shaderCount--}ar[Xr.vertId].refCount<=0&&(H.deleteShader(Et[Xr.vertId]),delete Et[Xr.vertId],delete Rr[Xr.fragId][Xr.vertId]),Object.keys(Rr[Xr.fragId]).length||(H.deleteShader(rr[Xr.fragId]),delete rr[Xr.fragId],delete Rr[Xr.fragId])}})},restore:Or,shader:br,frag:-1,vert:-1}}var cr=6408,Sr=5121,zr=3333,sn=5126;function Cn(H,Ee,Ue,wt,rr,Et,jt){function sr(Lr){var dr;Ee.next===null?(W(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),dr=Sr):(W(Ee.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),dr=Ee.next.colorAttachments[0].texture._texture.type,W.optional(function(){Et.oes_texture_float?(W(dr===Sr||dr===sn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),dr===sn&&W(jt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):W(dr===Sr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Mr=0,gr=0,Or=wt.framebufferWidth,ft=wt.framebufferHeight,Ft=null;n(Lr)?Ft=Lr:Lr&&(W.type(Lr,"object","invalid arguments to regl.read()"),Mr=Lr.x|0,gr=Lr.y|0,W(Mr>=0&&Mr<wt.framebufferWidth,"invalid x offset for regl.read"),W(gr>=0&&gr<wt.framebufferHeight,"invalid y offset for regl.read"),Or=(Lr.width||wt.framebufferWidth-Mr)|0,ft=(Lr.height||wt.framebufferHeight-gr)|0,Ft=Lr.data||null),Ft&&(dr===Sr?W(Ft instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):dr===sn&&W(Ft instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),W(Or>0&&Or+Mr<=wt.framebufferWidth,"invalid width for read pixels"),W(ft>0&&ft+gr<=wt.framebufferHeight,"invalid height for read pixels"),Ue();var wr=Or*ft*4;return Ft||(dr===Sr?Ft=new Uint8Array(wr):dr===sn&&(Ft=Ft||new Float32Array(wr))),W.isTypedArray(Ft,"data buffer for regl.read() must be a typedarray"),W(Ft.byteLength>=wr,"data buffer for regl.read() too small"),H.pixelStorei(zr,4),H.readPixels(Mr,gr,Or,ft,cr,dr,Ft),Ft}function br(Lr){var dr;return Ee.setFBO({framebuffer:Lr.framebuffer},function(){dr=sr(Lr)}),dr}function Rr(Lr){return!Lr||!("framebuffer"in Lr)?sr(Lr):br(Lr)}return Rr}function Dn(H){return Array.prototype.slice.call(H)}function Nn(H){return Dn(H).join("")}function ta(){var H=0,Ee=[],Ue=[];function wt(dr){for(var Mr=0;Mr<Ue.length;++Mr)if(Ue[Mr]===dr)return Ee[Mr];var gr="g"+H++;return Ee.push(gr),Ue.push(dr),gr}function rr(){var dr=[];function Mr(){dr.push.apply(dr,Dn(arguments))}var gr=[];function Or(){var ft="v"+H++;return gr.push(ft),arguments.length>0&&(dr.push(ft,"="),dr.push.apply(dr,Dn(arguments)),dr.push(";")),ft}return i(Mr,{def:Or,toString:function(){return Nn([gr.length>0?"var "+gr.join(",")+";":"",Nn(dr)])}})}function Et(){var dr=rr(),Mr=rr(),gr=dr.toString,Or=Mr.toString;function ft(Ft,wr){Mr(Ft,wr,"=",dr.def(Ft,wr),";")}return i(function(){dr.apply(dr,Dn(arguments))},{def:dr.def,entry:dr,exit:Mr,save:ft,set:function(Ft,wr,Kr){ft(Ft,wr),dr(Ft,wr,"=",Kr,";")},toString:function(){return gr()+Or()}})}function jt(){var dr=Nn(arguments),Mr=Et(),gr=Et(),Or=Mr.toString,ft=gr.toString;return i(Mr,{then:function(){return Mr.apply(Mr,Dn(arguments)),this},else:function(){return gr.apply(gr,Dn(arguments)),this},toString:function(){var Ft=ft();return Ft&&(Ft="else{"+Ft+"}"),Nn(["if(",dr,"){",Or(),"}",Ft])}})}var sr=rr(),br={};function Rr(dr,Mr){var gr=[];function Or(){var ar="a"+gr.length;return gr.push(ar),ar}Mr=Mr||0;for(var ft=0;ft<Mr;++ft)Or();var Ft=Et(),wr=Ft.toString,Kr=br[dr]=i(Ft,{arg:Or,toString:function(){return Nn(["function(",gr.join(),"){",wr(),"}"])}});return Kr}function Lr(){var dr=['"use strict";',sr,"return {"];Object.keys(br).forEach(function(ft){dr.push('"',ft,'":',br[ft].toString(),",")}),dr.push("}");var Mr=Nn(dr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Or=gr?t.Function.apply(null,Ee.concat(Mr)):Function.apply(null,Ee.concat(Mr));return Or.apply(null,Ue)}return{global:sr,link:wt,block:rr,proc:Rr,scope:Et,cond:jt,compile:Lr}}var un="xyzw".split(""),Zn=5121,ui=1,ni=2,jn=0,yi=1,Qn=2,wn=3,Ba=4,co=5,io=6,So="dither",Ka="blend.enable",Na="blend.color",Cs="blend.equation",Ra="blend.func",Ss="depth.enable",zs="depth.func",nl="depth.range",Au="depth.mask",Zc="colorMask",nh="cull.enable",il="cull.face",Yc="frontFace",Tf="lineWidth",Gu="polygonOffset.enable",Tu="polygonOffset.offset",Ql="sample.alpha",Zo="sample.enable",al="sample.coverage",yc="stencil.enable",Mf="stencil.mask",Bi="stencil.func",cu="stencil.opFront",La="stencil.opBack",Mu="scissor.enable",ih="scissor.box",Iu="viewport",Ph="profile",ol="framebuffer",ah="vert",fu="frag",Tl="elements",qc="primitive",sl="count",bo="offset",ul="instances",Up="vao",up="Width",yd="Height",If=ol+up,Ml=ol+yd,Vp=Iu+up,Ni=Iu+yd,lp="drawingBuffer",Jd=lp+up,Il=lp+yd,oi=[Ra,Cs,Bi,cu,La,al,Iu,ih,Tu],Gp=34962,$v=34963,hu=35632,km=35633,Kc=3553,Xv=34067,cp=2884,ev=3042,Jl=3024,ws=2960,Zv=2929,ts=3089,fp=32823,Yv=32926,jp=32928,Fh=5126,Lf=35664,hp=35665,ll=35666,pp=5124,ec=35667,dp=35668,Hp=35669,Ll=35670,_d=35671,ju=35672,kl=35673,tc=35674,Hu=35675,As=35676,vp=35678,Wp=35680,eu=4,Rl=1028,Dh=1029,Bh=2304,mp=2305,gp=32775,tv=32776,rv=519,oh=7680,qv=0,_c=1,sh=32774,kf=513,Ol=36160,rc=36064,cl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},nv=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Rf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Lu={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},yp={frag:hu,vert:km},iv={cw:Bh,ccw:mp};function xd(H){return Array.isArray(H)||n(H)||we(H)}function bd(H){return H.sort(function(Ee,Ue){return Ee===Iu?-1:Ue===Iu?1:Ee<Ue?-1:1})}function Ts(H,Ee,Ue,wt){this.thisDep=H,this.contextDep=Ee,this.propDep=Ue,this.append=wt}function Qc(H){return H&&!(H.thisDep||H.contextDep||H.propDep)}function la(H){return new Ts(!1,!1,!1,H)}function fl(H,Ee){var Ue=H.type;if(Ue===jn){var wt=H.data.length;return new Ts(!0,wt>=1,wt>=2,Ee)}else if(Ue===Ba){var rr=H.data;return new Ts(rr.thisDep,rr.contextDep,rr.propDep,Ee)}else{if(Ue===co)return new Ts(!1,!1,!1,Ee);if(Ue===io){for(var Et=!1,jt=!1,sr=!1,br=0;br<H.data.length;++br){var Rr=H.data[br];if(Rr.type===yi)sr=!0;else if(Rr.type===Qn)jt=!0;else if(Rr.type===wn)Et=!0;else if(Rr.type===jn){Et=!0;var Lr=Rr.data;Lr>=1&&(jt=!0),Lr>=2&&(sr=!0)}else Rr.type===Ba&&(Et=Et||Rr.data.thisDep,jt=jt||Rr.data.contextDep,sr=sr||Rr.data.propDep)}return new Ts(Et,jt,sr,Ee)}else return new Ts(Ue===wn,Ue===Qn,Ue===yi,Ee)}}var xc=new Ts(!1,!1,!1,function(){});function Ed(H,Ee,Ue,wt,rr,Et,jt,sr,br,Rr,Lr,dr,Mr,gr,Or){var ft=Rr.Record,Ft={add:32774,subtract:32778,"reverse subtract":32779};Ue.ext_blend_minmax&&(Ft.min=gp,Ft.max=tv);var wr=Ue.angle_instanced_arrays,Kr=Ue.webgl_draw_buffers,ar=Ue.oes_vertex_array_object,Br={dirty:!0,profile:Or.profile},Xr={},En=[],er={},Zt={};function en(Te){return Te.replace(".","_")}function Yr(Te,pe,He){var ct=en(Te);En.push(Te),Xr[ct]=Br[ct]=!!He,er[ct]=pe}function Ir(Te,pe,He){var ct=en(Te);En.push(Te),Array.isArray(He)?(Br[ct]=He.slice(),Xr[ct]=He.slice()):Br[ct]=Xr[ct]=He,Zt[ct]=pe}Yr(So,Jl),Yr(Ka,ev),Ir(Na,"blendColor",[0,0,0,0]),Ir(Cs,"blendEquationSeparate",[sh,sh]),Ir(Ra,"blendFuncSeparate",[_c,qv,_c,qv]),Yr(Ss,Zv,!0),Ir(zs,"depthFunc",kf),Ir(nl,"depthRange",[0,1]),Ir(Au,"depthMask",!0),Ir(Zc,Zc,[!0,!0,!0,!0]),Yr(nh,cp),Ir(il,"cullFace",Dh),Ir(Yc,Yc,mp),Ir(Tf,Tf,1),Yr(Gu,fp),Ir(Tu,"polygonOffset",[0,0]),Yr(Ql,Yv),Yr(Zo,jp),Ir(al,"sampleCoverage",[1,!1]),Yr(yc,ws),Ir(Mf,"stencilMask",-1),Ir(Bi,"stencilFunc",[rv,0,-1]),Ir(cu,"stencilOpSeparate",[Rl,oh,oh,oh]),Ir(La,"stencilOpSeparate",[Dh,oh,oh,oh]),Yr(Mu,ts),Ir(ih,"scissor",[0,0,H.drawingBufferWidth,H.drawingBufferHeight]),Ir(Iu,Iu,[0,0,H.drawingBufferWidth,H.drawingBufferHeight]);var Qr={gl:H,context:Mr,strings:Ee,next:Xr,current:Br,draw:dr,elements:Et,buffer:rr,shader:Lr,attributes:Rr.state,vao:Rr,uniforms:br,framebuffer:sr,extensions:Ue,timer:gr,isBufferArgs:xd},an={primTypes:Fs,compareFuncs:Rf,blendFuncs:cl,blendEquations:Ft,stencilOps:Lu,glTypes:yu,orientationType:iv};W.optional(function(){Qr.isArrayLike=Wa}),Kr&&(an.backBuffer=[Dh],an.drawBuffer=be(wt.maxDrawbuffers,function(Te){return Te===0?[0]:be(Te,function(pe){return rc+pe})}));var si=0;function ai(){var Te=ta(),pe=Te.link,He=Te.global;Te.id=si++,Te.batchId="0";var ct=pe(Qr),Tt=Te.shared={props:"a0"};Object.keys(Qr).forEach(function($e){Tt[$e]=He.def(ct,".",$e)}),W.optional(function(){Te.CHECK=pe(W),Te.commandStr=W.guessCommand(),Te.command=pe(Te.commandStr),Te.assert=function($e,Le,ut){$e("if(!(",Le,"))",this.CHECK,".commandRaise(",pe(ut),",",this.command,");")},an.invalidBlendCombinations=nv});var rt=Te.next={},Ye=Te.current={};Object.keys(Zt).forEach(function($e){Array.isArray(Br[$e])&&(rt[$e]=He.def(Tt.next,".",$e),Ye[$e]=He.def(Tt.current,".",$e))});var nt=Te.constants={};Object.keys(an).forEach(function($e){nt[$e]=He.def(JSON.stringify(an[$e]))}),Te.invoke=function($e,Le){switch(Le.type){case jn:var ut=["this",Tt.context,Tt.props,Te.batchId];return $e.def(pe(Le.data),".call(",ut.slice(0,Math.max(Le.data.length+1,4)),")");case yi:return $e.def(Tt.props,Le.data);case Qn:return $e.def(Tt.context,Le.data);case wn:return $e.def("this",Le.data);case Ba:return Le.data.append(Te,$e),Le.data.ref;case co:return Le.data.toString();case io:return Le.data.map(function(_t){return Te.invoke($e,_t)})}},Te.attribCache={};var de={};return Te.scopeAttrib=function($e){var Le=Ee.id($e);if(Le in de)return de[Le];var ut=Rr.scope[Le];ut||(ut=Rr.scope[Le]=new ft);var _t=de[Le]=pe(ut);return _t},Te}function cn(Te){var pe=Te.static,He=Te.dynamic,ct;if(Ph in pe){var Tt=!!pe[Ph];ct=la(function(Ye,nt){return Tt}),ct.enable=Tt}else if(Ph in He){var rt=He[Ph];ct=fl(rt,function(Ye,nt){return Ye.invoke(nt,rt)})}return ct}function pn(Te,pe){var He=Te.static,ct=Te.dynamic;if(ol in He){var Tt=He[ol];return Tt?(Tt=sr.getFramebuffer(Tt),W.command(Tt,"invalid framebuffer object"),la(function(Ye,nt){var de=Ye.link(Tt),$e=Ye.shared;nt.set($e.framebuffer,".next",de);var Le=$e.context;return nt.set(Le,"."+If,de+".width"),nt.set(Le,"."+Ml,de+".height"),de})):la(function(Ye,nt){var de=Ye.shared;nt.set(de.framebuffer,".next","null");var $e=de.context;return nt.set($e,"."+If,$e+"."+Jd),nt.set($e,"."+Ml,$e+"."+Il),"null"})}else if(ol in ct){var rt=ct[ol];return fl(rt,function(Ye,nt){var de=Ye.invoke(nt,rt),$e=Ye.shared,Le=$e.framebuffer,ut=nt.def(Le,".getFramebuffer(",de,")");W.optional(function(){Ye.assert(nt,"!"+de+"||"+ut,"invalid framebuffer object")}),nt.set(Le,".next",ut);var _t=$e.context;return nt.set(_t,"."+If,ut+"?"+ut+".width:"+_t+"."+Jd),nt.set(_t,"."+Ml,ut+"?"+ut+".height:"+_t+"."+Il),ut})}else return null}function Hn(Te,pe,He){var ct=Te.static,Tt=Te.dynamic;function rt(de){if(de in ct){var $e=ct[de];W.commandType($e,"object","invalid "+de,He.commandStr);var Le=!0,ut=$e.x|0,_t=$e.y|0,lr,Hr;return"width"in $e?(lr=$e.width|0,W.command(lr>=0,"invalid "+de,He.commandStr)):Le=!1,"height"in $e?(Hr=$e.height|0,W.command(Hr>=0,"invalid "+de,He.commandStr)):Le=!1,new Ts(!Le&&pe&&pe.thisDep,!Le&&pe&&pe.contextDep,!Le&&pe&&pe.propDep,function(Gr,Ln){var hn=Gr.shared.context,Sn=lr;"width"in $e||(Sn=Ln.def(hn,".",If,"-",ut));var An=Hr;return"height"in $e||(An=Ln.def(hn,".",Ml,"-",_t)),[ut,_t,Sn,An]})}else if(de in Tt){var $r=Tt[de],fn=fl($r,function(Gr,Ln){var hn=Gr.invoke(Ln,$r);W.optional(function(){Gr.assert(Ln,hn+"&&typeof "+hn+'==="object"',"invalid "+de)});var Sn=Gr.shared.context,An=Ln.def(hn,".x|0"),Tn=Ln.def(hn,".y|0"),ei=Ln.def('"width" in ',hn,"?",hn,".width|0:","(",Sn,".",If,"-",An,")"),wa=Ln.def('"height" in ',hn,"?",hn,".height|0:","(",Sn,".",Ml,"-",Tn,")");return W.optional(function(){Gr.assert(Ln,ei+">=0&&"+wa+">=0","invalid "+de)}),[An,Tn,ei,wa]});return pe&&(fn.thisDep=fn.thisDep||pe.thisDep,fn.contextDep=fn.contextDep||pe.contextDep,fn.propDep=fn.propDep||pe.propDep),fn}else return pe?new Ts(pe.thisDep,pe.contextDep,pe.propDep,function(Gr,Ln){var hn=Gr.shared.context;return[0,0,Ln.def(hn,".",If),Ln.def(hn,".",Ml)]}):null}var Ye=rt(Iu);if(Ye){var nt=Ye;Ye=new Ts(Ye.thisDep,Ye.contextDep,Ye.propDep,function(de,$e){var Le=nt.append(de,$e),ut=de.shared.context;return $e.set(ut,"."+Vp,Le[2]),$e.set(ut,"."+Ni,Le[3]),Le})}return{viewport:Ye,scissor_box:rt(ih)}}function li(Te,pe){var He=Te.static,ct=typeof He[fu]=="string"&&typeof He[ah]=="string";if(ct){if(Object.keys(pe.dynamic).length>0)return null;var Tt=pe.static,rt=Object.keys(Tt);if(rt.length>0&&typeof Tt[rt[0]]=="number"){for(var Ye=[],nt=0;nt<rt.length;++nt)W(typeof Tt[rt[nt]]=="number","must specify all vertex attribute locations when using vaos"),Ye.push([Tt[rt[nt]]|0,rt[nt]]);return Ye}}return null}function fi(Te,pe,He){var ct=Te.static,Tt=Te.dynamic;function rt(Le){if(Le in ct){var ut=Ee.id(ct[Le]);W.optional(function(){Lr.shader(yp[Le],ut,W.guessCommand())});var _t=la(function(){return ut});return _t.id=ut,_t}else if(Le in Tt){var lr=Tt[Le];return fl(lr,function(Hr,$r){var fn=Hr.invoke($r,lr),Gr=$r.def(Hr.shared.strings,".id(",fn,")");return W.optional(function(){$r(Hr.shared.shader,".shader(",yp[Le],",",Gr,",",Hr.command,");")}),Gr})}return null}var Ye=rt(fu),nt=rt(ah),de=null,$e;return Qc(Ye)&&Qc(nt)?(de=Lr.program(nt.id,Ye.id,null,He),$e=la(function(Le,ut){return Le.link(de)})):$e=new Ts(Ye&&Ye.thisDep||nt&&nt.thisDep,Ye&&Ye.contextDep||nt&&nt.contextDep,Ye&&Ye.propDep||nt&&nt.propDep,function(Le,ut){var _t=Le.shared.shader,lr;Ye?lr=Ye.append(Le,ut):lr=ut.def(_t,".",fu);var Hr;nt?Hr=nt.append(Le,ut):Hr=ut.def(_t,".",ah);var $r=_t+".program("+Hr+","+lr;return W.optional(function(){$r+=","+Le.command}),ut.def($r+")")}),{frag:Ye,vert:nt,progVar:$e,program:de}}function Pa(Te,pe){var He=Te.static,ct=Te.dynamic,Tt={},rt=!1;function Ye(){if(Up in He){var Ln=He[Up];return Ln!==null&&Rr.getVAO(Ln)===null&&(Ln=Rr.createVAO(Ln)),rt=!0,Tt.vao=Ln,la(function(Sn){var An=Rr.getVAO(Ln);return An?Sn.link(An):"null"})}else if(Up in ct){rt=!0;var hn=ct[Up];return fl(hn,function(Sn,An){var Tn=Sn.invoke(An,hn);return An.def(Sn.shared.vao+".getVAO("+Tn+")")})}return null}var nt=Ye(),de=!1;function $e(){if(Tl in He){var Ln=He[Tl];if(Tt.elements=Ln,xd(Ln)){var hn=Tt.elements=Et.create(Ln,!0);Ln=Et.getElements(hn),de=!0}else Ln&&(Ln=Et.getElements(Ln),de=!0,W.command(Ln,"invalid elements",pe.commandStr));var Sn=la(function(Tn,ei){if(Ln){var wa=Tn.link(Ln);return Tn.ELEMENTS=wa,wa}return Tn.ELEMENTS=null,null});return Sn.value=Ln,Sn}else if(Tl in ct){de=!0;var An=ct[Tl];return fl(An,function(Tn,ei){var wa=Tn.shared,ya=wa.isBufferArgs,hl=wa.elements,bc=Tn.invoke(ei,An),za=ei.def("null"),ea=ei.def(ya,"(",bc,")"),Jc=Tn.cond(ea).then(za,"=",hl,".createStream(",bc,");").else(za,"=",hl,".getElements(",bc,");");return W.optional(function(){Tn.assert(Jc.else,"!"+bc+"||"+za,"invalid elements")}),ei.entry(Jc),ei.exit(Tn.cond(ea).then(hl,".destroyStream(",za,");")),Tn.ELEMENTS=za,za})}else if(rt)return new Ts(nt.thisDep,nt.contextDep,nt.propDep,function(Tn,ei){return ei.def(Tn.shared.vao+".currentVAO?"+Tn.shared.elements+".getElements("+Tn.shared.vao+".currentVAO.elements):null")});return null}var Le=$e();function ut(){if(qc in He){var Ln=He[qc];return Tt.primitive=Ln,W.commandParameter(Ln,Fs,"invalid primitve",pe.commandStr),la(function(Sn,An){return Fs[Ln]})}else if(qc in ct){var hn=ct[qc];return fl(hn,function(Sn,An){var Tn=Sn.constants.primTypes,ei=Sn.invoke(An,hn);return W.optional(function(){Sn.assert(An,ei+" in "+Tn,"invalid primitive, must be one of "+Object.keys(Fs))}),An.def(Tn,"[",ei,"]")})}else{if(de)return Qc(Le)?Le.value?la(function(Sn,An){return An.def(Sn.ELEMENTS,".primType")}):la(function(){return eu}):new Ts(Le.thisDep,Le.contextDep,Le.propDep,function(Sn,An){var Tn=Sn.ELEMENTS;return An.def(Tn,"?",Tn,".primType:",eu)});if(rt)return new Ts(nt.thisDep,nt.contextDep,nt.propDep,function(Sn,An){return An.def(Sn.shared.vao+".currentVAO?"+Sn.shared.vao+".currentVAO.primitive:"+eu)})}return null}function _t(Ln,hn){if(Ln in He){var Sn=He[Ln]|0;return hn?Tt.offset=Sn:Tt.instances=Sn,W.command(!hn||Sn>=0,"invalid "+Ln,pe.commandStr),la(function(Tn,ei){return hn&&(Tn.OFFSET=Sn),Sn})}else if(Ln in ct){var An=ct[Ln];return fl(An,function(Tn,ei){var wa=Tn.invoke(ei,An);return hn&&(Tn.OFFSET=wa,W.optional(function(){Tn.assert(ei,wa+">=0","invalid "+Ln)})),wa})}else if(hn){if(de)return la(function(Tn,ei){return Tn.OFFSET=0,0});if(rt)return new Ts(nt.thisDep,nt.contextDep,nt.propDep,function(Tn,ei){return ei.def(Tn.shared.vao+".currentVAO?"+Tn.shared.vao+".currentVAO.offset:0")})}else if(rt)return new Ts(nt.thisDep,nt.contextDep,nt.propDep,function(Tn,ei){return ei.def(Tn.shared.vao+".currentVAO?"+Tn.shared.vao+".currentVAO.instances:-1")});return null}var lr=_t(bo,!0);function Hr(){if(sl in He){var Ln=He[sl]|0;return Tt.count=Ln,W.command(typeof Ln=="number"&&Ln>=0,"invalid vertex count",pe.commandStr),la(function(){return Ln})}else if(sl in ct){var hn=ct[sl];return fl(hn,function(ei,wa){var ya=ei.invoke(wa,hn);return W.optional(function(){ei.assert(wa,"typeof "+ya+'==="number"&&'+ya+">=0&&"+ya+"===("+ya+"|0)","invalid vertex count")}),ya})}else if(de)if(Qc(Le)){if(Le)return lr?new Ts(lr.thisDep,lr.contextDep,lr.propDep,function(ei,wa){var ya=wa.def(ei.ELEMENTS,".vertCount-",ei.OFFSET);return W.optional(function(){ei.assert(wa,ya+">=0","invalid vertex offset/element buffer too small")}),ya}):la(function(ei,wa){return wa.def(ei.ELEMENTS,".vertCount")});var Sn=la(function(){return-1});return W.optional(function(){Sn.MISSING=!0}),Sn}else{var An=new Ts(Le.thisDep||lr.thisDep,Le.contextDep||lr.contextDep,Le.propDep||lr.propDep,function(ei,wa){var ya=ei.ELEMENTS;return ei.OFFSET?wa.def(ya,"?",ya,".vertCount-",ei.OFFSET,":-1"):wa.def(ya,"?",ya,".vertCount:-1")});return W.optional(function(){An.DYNAMIC=!0}),An}else if(rt){var Tn=new Ts(nt.thisDep,nt.contextDep,nt.propDep,function(ei,wa){return wa.def(ei.shared.vao,".currentVAO?",ei.shared.vao,".currentVAO.count:-1")});return Tn}return null}var $r=ut(),fn=Hr(),Gr=_t(ul,!1);return{elements:Le,primitive:$r,count:fn,instances:Gr,offset:lr,vao:nt,vaoActive:rt,elementsActive:de,static:Tt}}function Yo(Te,pe){var He=Te.static,ct=Te.dynamic,Tt={};return En.forEach(function(rt){var Ye=en(rt);function nt(de,$e){if(rt in He){var Le=de(He[rt]);Tt[Ye]=la(function(){return Le})}else if(rt in ct){var ut=ct[rt];Tt[Ye]=fl(ut,function(_t,lr){return $e(_t,lr,_t.invoke(lr,ut))})}}switch(rt){case nh:case Ka:case So:case yc:case Ss:case Mu:case Gu:case Ql:case Zo:case Au:return nt(function(de){return W.commandType(de,"boolean",rt,pe.commandStr),de},function(de,$e,Le){return W.optional(function(){de.assert($e,"typeof "+Le+'==="boolean"',"invalid flag "+rt,de.commandStr)}),Le});case zs:return nt(function(de){return W.commandParameter(de,Rf,"invalid "+rt,pe.commandStr),Rf[de]},function(de,$e,Le){var ut=de.constants.compareFuncs;return W.optional(function(){de.assert($e,Le+" in "+ut,"invalid "+rt+", must be one of "+Object.keys(Rf))}),$e.def(ut,"[",Le,"]")});case nl:return nt(function(de){return W.command(Wa(de)&&de.length===2&&typeof de[0]=="number"&&typeof de[1]=="number"&&de[0]<=de[1],"depth range is 2d array",pe.commandStr),de},function(de,$e,Le){W.optional(function(){de.assert($e,de.shared.isArrayLike+"("+Le+")&&"+Le+".length===2&&typeof "+Le+'[0]==="number"&&typeof '+Le+'[1]==="number"&&'+Le+"[0]<="+Le+"[1]","depth range must be a 2d array")});var ut=$e.def("+",Le,"[0]"),_t=$e.def("+",Le,"[1]");return[ut,_t]});case Ra:return nt(function(de){W.commandType(de,"object","blend.func",pe.commandStr);var $e="srcRGB"in de?de.srcRGB:de.src,Le="srcAlpha"in de?de.srcAlpha:de.src,ut="dstRGB"in de?de.dstRGB:de.dst,_t="dstAlpha"in de?de.dstAlpha:de.dst;return W.commandParameter($e,cl,Ye+".srcRGB",pe.commandStr),W.commandParameter(Le,cl,Ye+".srcAlpha",pe.commandStr),W.commandParameter(ut,cl,Ye+".dstRGB",pe.commandStr),W.commandParameter(_t,cl,Ye+".dstAlpha",pe.commandStr),W.command(nv.indexOf($e+", "+ut)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+$e+", "+ut+")",pe.commandStr),[cl[$e],cl[ut],cl[Le],cl[_t]]},function(de,$e,Le){var ut=de.constants.blendFuncs;W.optional(function(){de.assert($e,Le+"&&typeof "+Le+'==="object"',"invalid blend func, must be an object")});function _t(hn,Sn){var An=$e.def('"',hn,Sn,'" in ',Le,"?",Le,".",hn,Sn,":",Le,".",hn);return W.optional(function(){de.assert($e,An+" in "+ut,"invalid "+rt+"."+hn+Sn+", must be one of "+Object.keys(cl))}),An}var lr=_t("src","RGB"),Hr=_t("dst","RGB");W.optional(function(){var hn=de.constants.invalidBlendCombinations;de.assert($e,hn+".indexOf("+lr+'+", "+'+Hr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var $r=$e.def(ut,"[",lr,"]"),fn=$e.def(ut,"[",_t("src","Alpha"),"]"),Gr=$e.def(ut,"[",Hr,"]"),Ln=$e.def(ut,"[",_t("dst","Alpha"),"]");return[$r,Gr,fn,Ln]});case Cs:return nt(function(de){if(typeof de=="string")return W.commandParameter(de,Ft,"invalid "+rt,pe.commandStr),[Ft[de],Ft[de]];if(typeof de=="object")return W.commandParameter(de.rgb,Ft,rt+".rgb",pe.commandStr),W.commandParameter(de.alpha,Ft,rt+".alpha",pe.commandStr),[Ft[de.rgb],Ft[de.alpha]];W.commandRaise("invalid blend.equation",pe.commandStr)},function(de,$e,Le){var ut=de.constants.blendEquations,_t=$e.def(),lr=$e.def(),Hr=de.cond("typeof ",Le,'==="string"');return W.optional(function(){function $r(fn,Gr,Ln){de.assert(fn,Ln+" in "+ut,"invalid "+Gr+", must be one of "+Object.keys(Ft))}$r(Hr.then,rt,Le),de.assert(Hr.else,Le+"&&typeof "+Le+'==="object"',"invalid "+rt),$r(Hr.else,rt+".rgb",Le+".rgb"),$r(Hr.else,rt+".alpha",Le+".alpha")}),Hr.then(_t,"=",lr,"=",ut,"[",Le,"];"),Hr.else(_t,"=",ut,"[",Le,".rgb];",lr,"=",ut,"[",Le,".alpha];"),$e(Hr),[_t,lr]});case Na:return nt(function(de){return W.command(Wa(de)&&de.length===4,"blend.color must be a 4d array",pe.commandStr),be(4,function($e){return+de[$e]})},function(de,$e,Le){return W.optional(function(){de.assert($e,de.shared.isArrayLike+"("+Le+")&&"+Le+".length===4","blend.color must be a 4d array")}),be(4,function(ut){return $e.def("+",Le,"[",ut,"]")})});case Mf:return nt(function(de){return W.commandType(de,"number",Ye,pe.commandStr),de|0},function(de,$e,Le){return W.optional(function(){de.assert($e,"typeof "+Le+'==="number"',"invalid stencil.mask")}),$e.def(Le,"|0")});case Bi:return nt(function(de){W.commandType(de,"object",Ye,pe.commandStr);var $e=de.cmp||"keep",Le=de.ref||0,ut="mask"in de?de.mask:-1;return W.commandParameter($e,Rf,rt+".cmp",pe.commandStr),W.commandType(Le,"number",rt+".ref",pe.commandStr),W.commandType(ut,"number",rt+".mask",pe.commandStr),[Rf[$e],Le,ut]},function(de,$e,Le){var ut=de.constants.compareFuncs;W.optional(function(){function $r(){de.assert($e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}$r(Le+"&&typeof ",Le,'==="object"'),$r('!("cmp" in ',Le,")||(",Le,".cmp in ",ut,")")});var _t=$e.def('"cmp" in ',Le,"?",ut,"[",Le,".cmp]",":",oh),lr=$e.def(Le,".ref|0"),Hr=$e.def('"mask" in ',Le,"?",Le,".mask|0:-1");return[_t,lr,Hr]});case cu:case La:return nt(function(de){W.commandType(de,"object",Ye,pe.commandStr);var $e=de.fail||"keep",Le=de.zfail||"keep",ut=de.zpass||"keep";return W.commandParameter($e,Lu,rt+".fail",pe.commandStr),W.commandParameter(Le,Lu,rt+".zfail",pe.commandStr),W.commandParameter(ut,Lu,rt+".zpass",pe.commandStr),[rt===La?Dh:Rl,Lu[$e],Lu[Le],Lu[ut]]},function(de,$e,Le){var ut=de.constants.stencilOps;W.optional(function(){de.assert($e,Le+"&&typeof "+Le+'==="object"',"invalid "+rt)});function _t(lr){return W.optional(function(){de.assert($e,'!("'+lr+'" in '+Le+")||("+Le+"."+lr+" in "+ut+")","invalid "+rt+"."+lr+", must be one of "+Object.keys(Lu))}),$e.def('"',lr,'" in ',Le,"?",ut,"[",Le,".",lr,"]:",oh)}return[rt===La?Dh:Rl,_t("fail"),_t("zfail"),_t("zpass")]});case Tu:return nt(function(de){W.commandType(de,"object",Ye,pe.commandStr);var $e=de.factor|0,Le=de.units|0;return W.commandType($e,"number",Ye+".factor",pe.commandStr),W.commandType(Le,"number",Ye+".units",pe.commandStr),[$e,Le]},function(de,$e,Le){W.optional(function(){de.assert($e,Le+"&&typeof "+Le+'==="object"',"invalid "+rt)});var ut=$e.def(Le,".factor|0"),_t=$e.def(Le,".units|0");return[ut,_t]});case il:return nt(function(de){var $e=0;return de==="front"?$e=Rl:de==="back"&&($e=Dh),W.command(!!$e,Ye,pe.commandStr),$e},function(de,$e,Le){return W.optional(function(){de.assert($e,Le+'==="front"||'+Le+'==="back"',"invalid cull.face")}),$e.def(Le,'==="front"?',Rl,":",Dh)});case Tf:return nt(function(de){return W.command(typeof de=="number"&&de>=wt.lineWidthDims[0]&&de<=wt.lineWidthDims[1],"invalid line width, must be a positive number between "+wt.lineWidthDims[0]+" and "+wt.lineWidthDims[1],pe.commandStr),de},function(de,$e,Le){return W.optional(function(){de.assert($e,"typeof "+Le+'==="number"&&'+Le+">="+wt.lineWidthDims[0]+"&&"+Le+"<="+wt.lineWidthDims[1],"invalid line width")}),Le});case Yc:return nt(function(de){return W.commandParameter(de,iv,Ye,pe.commandStr),iv[de]},function(de,$e,Le){return W.optional(function(){de.assert($e,Le+'==="cw"||'+Le+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),$e.def(Le+'==="cw"?'+Bh+":"+mp)});case Zc:return nt(function(de){return W.command(Wa(de)&&de.length===4,"color.mask must be length 4 array",pe.commandStr),de.map(function($e){return!!$e})},function(de,$e,Le){return W.optional(function(){de.assert($e,de.shared.isArrayLike+"("+Le+")&&"+Le+".length===4","invalid color.mask")}),be(4,function(ut){return"!!"+Le+"["+ut+"]"})});case al:return nt(function(de){W.command(typeof de=="object"&&de,Ye,pe.commandStr);var $e="value"in de?de.value:1,Le=!!de.invert;return W.command(typeof $e=="number"&&$e>=0&&$e<=1,"sample.coverage.value must be a number between 0 and 1",pe.commandStr),[$e,Le]},function(de,$e,Le){W.optional(function(){de.assert($e,Le+"&&typeof "+Le+'==="object"',"invalid sample.coverage")});var ut=$e.def('"value" in ',Le,"?+",Le,".value:1"),_t=$e.def("!!",Le,".invert");return[ut,_t]})}}),Tt}function zi(Te,pe){var He=Te.static,ct=Te.dynamic,Tt={};return Object.keys(He).forEach(function(rt){var Ye=He[rt],nt;if(typeof Ye=="number"||typeof Ye=="boolean")nt=la(function(){return Ye});else if(typeof Ye=="function"){var de=Ye._reglType;de==="texture2d"||de==="textureCube"?nt=la(function($e){return $e.link(Ye)}):de==="framebuffer"||de==="framebufferCube"?(W.command(Ye.color.length>0,'missing color attachment for framebuffer sent to uniform "'+rt+'"',pe.commandStr),nt=la(function($e){return $e.link(Ye.color[0])})):W.commandRaise('invalid data for uniform "'+rt+'"',pe.commandStr)}else Wa(Ye)?nt=la(function($e){var Le=$e.global.def("[",be(Ye.length,function(ut){return W.command(typeof Ye[ut]=="number"||typeof Ye[ut]=="boolean","invalid uniform "+rt,$e.commandStr),Ye[ut]}),"]");return Le}):W.commandRaise('invalid or missing data for uniform "'+rt+'"',pe.commandStr);nt.value=Ye,Tt[rt]=nt}),Object.keys(ct).forEach(function(rt){var Ye=ct[rt];Tt[rt]=fl(Ye,function(nt,de){return nt.invoke(de,Ye)})}),Tt}function Us(Te,pe){var He=Te.static,ct=Te.dynamic,Tt={};return Object.keys(He).forEach(function(rt){var Ye=He[rt],nt=Ee.id(rt),de=new ft;if(xd(Ye))de.state=ui,de.buffer=rr.getBuffer(rr.create(Ye,Gp,!1,!0)),de.type=0;else{var $e=rr.getBuffer(Ye);if($e)de.state=ui,de.buffer=$e,de.type=0;else if(W.command(typeof Ye=="object"&&Ye,"invalid data for attribute "+rt,pe.commandStr),"constant"in Ye){var Le=Ye.constant;de.buffer="null",de.state=ni,typeof Le=="number"?de.x=Le:(W.command(Wa(Le)&&Le.length>0&&Le.length<=4,"invalid constant for attribute "+rt,pe.commandStr),un.forEach(function(Gr,Ln){Ln<Le.length&&(de[Gr]=Le[Ln])}))}else{xd(Ye.buffer)?$e=rr.getBuffer(rr.create(Ye.buffer,Gp,!1,!0)):$e=rr.getBuffer(Ye.buffer),W.command(!!$e,'missing buffer for attribute "'+rt+'"',pe.commandStr);var ut=Ye.offset|0;W.command(ut>=0,'invalid offset for attribute "'+rt+'"',pe.commandStr);var _t=Ye.stride|0;W.command(_t>=0&&_t<256,'invalid stride for attribute "'+rt+'", must be integer betweeen [0, 255]',pe.commandStr);var lr=Ye.size|0;W.command(!("size"in Ye)||lr>0&&lr<=4,'invalid size for attribute "'+rt+'", must be 1,2,3,4',pe.commandStr);var Hr=!!Ye.normalized,$r=0;"type"in Ye&&(W.commandParameter(Ye.type,yu,"invalid type for attribute "+rt,pe.commandStr),$r=yu[Ye.type]);var fn=Ye.divisor|0;W.optional(function(){"divisor"in Ye&&(W.command(fn===0||wr,'cannot specify divisor for attribute "'+rt+'", instancing not supported',pe.commandStr),W.command(fn>=0,'invalid divisor for attribute "'+rt+'"',pe.commandStr));var Gr=pe.commandStr,Ln=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ye).forEach(function(hn){W.command(Ln.indexOf(hn)>=0,'unknown parameter "'+hn+'" for attribute pointer "'+rt+'" (valid parameters are '+Ln+")",Gr)})}),de.buffer=$e,de.state=ui,de.size=lr,de.normalized=Hr,de.type=$r||$e.dtype,de.offset=ut,de.stride=_t,de.divisor=fn}}Tt[rt]=la(function(Gr,Ln){var hn=Gr.attribCache;if(nt in hn)return hn[nt];var Sn={isStream:!1};return Object.keys(de).forEach(function(An){Sn[An]=de[An]}),de.buffer&&(Sn.buffer=Gr.link(de.buffer),Sn.type=Sn.type||Sn.buffer+".dtype"),hn[nt]=Sn,Sn})}),Object.keys(ct).forEach(function(rt){var Ye=ct[rt];function nt(de,$e){var Le=de.invoke($e,Ye),ut=de.shared,_t=de.constants,lr=ut.isBufferArgs,Hr=ut.buffer;W.optional(function(){de.assert($e,Le+"&&(typeof "+Le+'==="object"||typeof '+Le+'==="function")&&('+lr+"("+Le+")||"+Hr+".getBuffer("+Le+")||"+Hr+".getBuffer("+Le+".buffer)||"+lr+"("+Le+'.buffer)||("constant" in '+Le+"&&(typeof "+Le+'.constant==="number"||'+ut.isArrayLike+"("+Le+".constant))))",'invalid dynamic attribute "'+rt+'"')});var $r={isStream:$e.def(!1)},fn=new ft;fn.state=ui,Object.keys(fn).forEach(function(Sn){$r[Sn]=$e.def(""+fn[Sn])});var Gr=$r.buffer,Ln=$r.type;$e("if(",lr,"(",Le,")){",$r.isStream,"=true;",Gr,"=",Hr,".createStream(",Gp,",",Le,");",Ln,"=",Gr,".dtype;","}else{",Gr,"=",Hr,".getBuffer(",Le,");","if(",Gr,"){",Ln,"=",Gr,".dtype;",'}else if("constant" in ',Le,"){",$r.state,"=",ni,";","if(typeof "+Le+'.constant === "number"){',$r[un[0]],"=",Le,".constant;",un.slice(1).map(function(Sn){return $r[Sn]}).join("="),"=0;","}else{",un.map(function(Sn,An){return $r[Sn]+"="+Le+".constant.length>"+An+"?"+Le+".constant["+An+"]:0;"}).join(""),"}}else{","if(",lr,"(",Le,".buffer)){",Gr,"=",Hr,".createStream(",Gp,",",Le,".buffer);","}else{",Gr,"=",Hr,".getBuffer(",Le,".buffer);","}",Ln,'="type" in ',Le,"?",_t.glTypes,"[",Le,".type]:",Gr,".dtype;",$r.normalized,"=!!",Le,".normalized;");function hn(Sn){$e($r[Sn],"=",Le,".",Sn,"|0;")}return hn("size"),hn("offset"),hn("stride"),hn("divisor"),$e("}}"),$e.exit("if(",$r.isStream,"){",Hr,".destroyStream(",Gr,");","}"),$r}Tt[rt]=fl(Ye,nt)}),Tt}function ao(Te){var pe=Te.static,He=Te.dynamic,ct={};return Object.keys(pe).forEach(function(Tt){var rt=pe[Tt];ct[Tt]=la(function(Ye,nt){return typeof rt=="number"||typeof rt=="boolean"?""+rt:Ye.link(rt)})}),Object.keys(He).forEach(function(Tt){var rt=He[Tt];ct[Tt]=fl(rt,function(Ye,nt){return Ye.invoke(nt,rt)})}),ct}function ms(Te,pe,He,ct,Tt){var rt=Te.static,Ye=Te.dynamic;W.optional(function(){var hn=[ol,ah,fu,Tl,qc,bo,sl,ul,Ph,Up].concat(En);function Sn(An){Object.keys(An).forEach(function(Tn){W.command(hn.indexOf(Tn)>=0,'unknown parameter "'+Tn+'"',Tt.commandStr)})}Sn(rt),Sn(Ye)});var nt=li(Te,pe),de=pn(Te),$e=Hn(Te,de,Tt),Le=Pa(Te,Tt),ut=Yo(Te,Tt),_t=fi(Te,Tt,nt);function lr(hn){var Sn=$e[hn];Sn&&(ut[hn]=Sn)}lr(Iu),lr(en(ih));var Hr=Object.keys(ut).length>0,$r={framebuffer:de,draw:Le,shader:_t,state:ut,dirty:Hr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if($r.profile=cn(Te),$r.uniforms=zi(He,Tt),$r.drawVAO=$r.scopeVAO=Le.vao,!$r.drawVAO&&_t.program&&!nt&&Ue.angle_instanced_arrays&&Le.static.elements){var fn=!0,Gr=_t.program.attributes.map(function(hn){var Sn=pe.static[hn];return fn=fn&&!!Sn,Sn});if(fn&&Gr.length>0){var Ln=Rr.getVAO(Rr.createVAO({attributes:Gr,elements:Le.static.elements}));$r.drawVAO=new Ts(null,null,null,function(hn,Sn){return hn.link(Ln)}),$r.useVAO=!0}}return nt?$r.useVAO=!0:$r.attributes=Us(pe,Tt),$r.context=ao(ct),$r}function as(Te,pe,He){var ct=Te.shared,Tt=ct.context,rt=Te.scope();Object.keys(He).forEach(function(Ye){pe.save(Tt,"."+Ye);var nt=He[Ye],de=nt.append(Te,pe);Array.isArray(de)?rt(Tt,".",Ye,"=[",de.join(),"];"):rt(Tt,".",Ye,"=",de,";")}),pe(rt)}function Vs(Te,pe,He,ct){var Tt=Te.shared,rt=Tt.gl,Ye=Tt.framebuffer,nt;Kr&&(nt=pe.def(Tt.extensions,".webgl_draw_buffers"));var de=Te.constants,$e=de.drawBuffer,Le=de.backBuffer,ut;He?ut=He.append(Te,pe):ut=pe.def(Ye,".next"),ct||pe("if(",ut,"!==",Ye,".cur){"),pe("if(",ut,"){",rt,".bindFramebuffer(",Ol,",",ut,".framebuffer);"),Kr&&pe(nt,".drawBuffersWEBGL(",$e,"[",ut,".colorAttachments.length]);"),pe("}else{",rt,".bindFramebuffer(",Ol,",null);"),Kr&&pe(nt,".drawBuffersWEBGL(",Le,");"),pe("}",Ye,".cur=",ut,";"),ct||pe("}")}function Gs(Te,pe,He){var ct=Te.shared,Tt=ct.gl,rt=Te.current,Ye=Te.next,nt=ct.current,de=ct.next,$e=Te.cond(nt,".dirty");En.forEach(function(Le){var ut=en(Le);if(!(ut in He.state)){var _t,lr;if(ut in Ye){_t=Ye[ut],lr=rt[ut];var Hr=be(Br[ut].length,function(fn){return $e.def(_t,"[",fn,"]")});$e(Te.cond(Hr.map(function(fn,Gr){return fn+"!=="+lr+"["+Gr+"]"}).join("||")).then(Tt,".",Zt[ut],"(",Hr,");",Hr.map(function(fn,Gr){return lr+"["+Gr+"]="+fn}).join(";"),";"))}else{_t=$e.def(de,".",ut);var $r=Te.cond(_t,"!==",nt,".",ut);$e($r),ut in er?$r(Te.cond(_t).then(Tt,".enable(",er[ut],");").else(Tt,".disable(",er[ut],");"),nt,".",ut,"=",_t,";"):$r(Tt,".",Zt[ut],"(",_t,");",nt,".",ut,"=",_t,";")}}}),Object.keys(He.state).length===0&&$e(nt,".dirty=false;"),pe($e)}function Ms(Te,pe,He,ct){var Tt=Te.shared,rt=Te.current,Ye=Tt.current,nt=Tt.gl;bd(Object.keys(He)).forEach(function(de){var $e=He[de];if(!(ct&&!ct($e))){var Le=$e.append(Te,pe);if(er[de]){var ut=er[de];Qc($e)?Le?pe(nt,".enable(",ut,");"):pe(nt,".disable(",ut,");"):pe(Te.cond(Le).then(nt,".enable(",ut,");").else(nt,".disable(",ut,");")),pe(Ye,".",de,"=",Le,";")}else if(Wa(Le)){var _t=rt[de];pe(nt,".",Zt[de],"(",Le,");",Le.map(function(lr,Hr){return _t+"["+Hr+"]="+lr}).join(";"),";")}else pe(nt,".",Zt[de],"(",Le,");",Ye,".",de,"=",Le,";")}})}function wo(Te,pe){wr&&(Te.instancing=pe.def(Te.shared.extensions,".angle_instanced_arrays"))}function Si(Te,pe,He,ct,Tt){var rt=Te.shared,Ye=Te.stats,nt=rt.current,de=rt.timer,$e=He.profile;function Le(){var hn=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return hn||typeof performance>"u"?"Date.now()":"performance.now()"}var ut,_t;function lr(hn){ut=pe.def(),hn(ut,"=",Le(),";"),typeof Tt=="string"?hn(Ye,".count+=",Tt,";"):hn(Ye,".count++;"),gr&&(ct?(_t=pe.def(),hn(_t,"=",de,".getNumPendingQueries();")):hn(de,".beginQuery(",Ye,");"))}function Hr(hn){hn(Ye,".cpuTime+=",Le(),"-",ut,";"),gr&&(ct?hn(de,".pushScopeStats(",_t,",",de,".getNumPendingQueries(),",Ye,");"):hn(de,".endQuery();"))}function $r(hn){var Sn=pe.def(nt,".profile");pe(nt,".profile=",hn,";"),pe.exit(nt,".profile=",Sn,";")}var fn;if($e){if(Qc($e)){$e.enable?(lr(pe),Hr(pe.exit),$r("true")):$r("false");return}fn=$e.append(Te,pe),$r(fn)}else fn=pe.def(nt,".profile");var Gr=Te.block();lr(Gr),pe("if(",fn,"){",Gr,"}");var Ln=Te.block();Hr(Ln),pe.exit("if(",fn,"){",Ln,"}")}function gs(Te,pe,He,ct,Tt){var rt=Te.shared;function Ye(de){switch(de){case Lf:case ec:case _d:return 2;case hp:case dp:case ju:return 3;case ll:case Hp:case kl:return 4;default:return 1}}function nt(de,$e,Le){var ut=rt.gl,_t=pe.def(de,".location"),lr=pe.def(rt.attributes,"[",_t,"]"),Hr=Le.state,$r=Le.buffer,fn=[Le.x,Le.y,Le.z,Le.w],Gr=["buffer","normalized","offset","stride"];function Ln(){pe("if(!",lr,".buffer){",ut,".enableVertexAttribArray(",_t,");}");var Sn=Le.type,An;if(Le.size?An=pe.def(Le.size,"||",$e):An=$e,pe("if(",lr,".type!==",Sn,"||",lr,".size!==",An,"||",Gr.map(function(ei){return lr+"."+ei+"!=="+Le[ei]}).join("||"),"){",ut,".bindBuffer(",Gp,",",$r,".buffer);",ut,".vertexAttribPointer(",[_t,An,Sn,Le.normalized,Le.stride,Le.offset],");",lr,".type=",Sn,";",lr,".size=",An,";",Gr.map(function(ei){return lr+"."+ei+"="+Le[ei]+";"}).join(""),"}"),wr){var Tn=Le.divisor;pe("if(",lr,".divisor!==",Tn,"){",Te.instancing,".vertexAttribDivisorANGLE(",[_t,Tn],");",lr,".divisor=",Tn,";}")}}function hn(){pe("if(",lr,".buffer){",ut,".disableVertexAttribArray(",_t,");",lr,".buffer=null;","}if(",un.map(function(Sn,An){return lr+"."+Sn+"!=="+fn[An]}).join("||"),"){",ut,".vertexAttrib4f(",_t,",",fn,");",un.map(function(Sn,An){return lr+"."+Sn+"="+fn[An]+";"}).join(""),"}")}Hr===ui?Ln():Hr===ni?hn():(pe("if(",Hr,"===",ui,"){"),Ln(),pe("}else{"),hn(),pe("}"))}ct.forEach(function(de){var $e=de.name,Le=He.attributes[$e],ut;if(Le){if(!Tt(Le))return;ut=Le.append(Te,pe)}else{if(!Tt(xc))return;var _t=Te.scopeAttrib($e);W.optional(function(){Te.assert(pe,_t+".state","missing attribute "+$e)}),ut={},Object.keys(new ft).forEach(function(lr){ut[lr]=pe.def(_t,".",lr)})}nt(Te.link(de),Ye(de.info.type),ut)})}function ga(Te,pe,He,ct,Tt,rt){for(var Ye=Te.shared,nt=Ye.gl,de,$e=0;$e<ct.length;++$e){var Le=ct[$e],ut=Le.name,_t=Le.info.type,lr=He.uniforms[ut],Hr=Te.link(Le),$r=Hr+".location",fn;if(lr){if(!Tt(lr))continue;if(Qc(lr)){var Gr=lr.value;if(W.command(Gr!==null&&typeof Gr<"u",'missing uniform "'+ut+'"',Te.commandStr),_t===vp||_t===Wp){W.command(typeof Gr=="function"&&(_t===vp&&(Gr._reglType==="texture2d"||Gr._reglType==="framebuffer")||_t===Wp&&(Gr._reglType==="textureCube"||Gr._reglType==="framebufferCube")),"invalid texture for uniform "+ut,Te.commandStr);var Ln=Te.link(Gr._texture||Gr.color[0]._texture);pe(nt,".uniform1i(",$r,",",Ln+".bind());"),pe.exit(Ln,".unbind();")}else if(_t===tc||_t===Hu||_t===As){W.optional(function(){W.command(Wa(Gr),"invalid matrix for uniform "+ut,Te.commandStr),W.command(_t===tc&&Gr.length===4||_t===Hu&&Gr.length===9||_t===As&&Gr.length===16,"invalid length for matrix uniform "+ut,Te.commandStr)});var hn=Te.global.def("new Float32Array(["+Array.prototype.slice.call(Gr)+"])"),Sn=2;_t===Hu?Sn=3:_t===As&&(Sn=4),pe(nt,".uniformMatrix",Sn,"fv(",$r,",false,",hn,");")}else{switch(_t){case Fh:W.commandType(Gr,"number","uniform "+ut,Te.commandStr),de="1f";break;case Lf:W.command(Wa(Gr)&&Gr.length===2,"uniform "+ut,Te.commandStr),de="2f";break;case hp:W.command(Wa(Gr)&&Gr.length===3,"uniform "+ut,Te.commandStr),de="3f";break;case ll:W.command(Wa(Gr)&&Gr.length===4,"uniform "+ut,Te.commandStr),de="4f";break;case Ll:W.commandType(Gr,"boolean","uniform "+ut,Te.commandStr),de="1i";break;case pp:W.commandType(Gr,"number","uniform "+ut,Te.commandStr),de="1i";break;case _d:W.command(Wa(Gr)&&Gr.length===2,"uniform "+ut,Te.commandStr),de="2i";break;case ec:W.command(Wa(Gr)&&Gr.length===2,"uniform "+ut,Te.commandStr),de="2i";break;case ju:W.command(Wa(Gr)&&Gr.length===3,"uniform "+ut,Te.commandStr),de="3i";break;case dp:W.command(Wa(Gr)&&Gr.length===3,"uniform "+ut,Te.commandStr),de="3i";break;case kl:W.command(Wa(Gr)&&Gr.length===4,"uniform "+ut,Te.commandStr),de="4i";break;case Hp:W.command(Wa(Gr)&&Gr.length===4,"uniform "+ut,Te.commandStr),de="4i";break}pe(nt,".uniform",de,"(",$r,",",Wa(Gr)?Array.prototype.slice.call(Gr):Gr,");")}continue}else fn=lr.append(Te,pe)}else{if(!Tt(xc))continue;fn=pe.def(Ye.uniforms,"[",Ee.id(ut),"]")}_t===vp?(W(!Array.isArray(fn),"must specify a scalar prop for textures"),pe("if(",fn,"&&",fn,'._reglType==="framebuffer"){',fn,"=",fn,".color[0];","}")):_t===Wp&&(W(!Array.isArray(fn),"must specify a scalar prop for cube maps"),pe("if(",fn,"&&",fn,'._reglType==="framebufferCube"){',fn,"=",fn,".color[0];","}")),W.optional(function(){function ea(ic,e0){Te.assert(pe,ic,'bad data or missing for uniform "'+ut+'".  '+e0)}function Jc(ic){W(!Array.isArray(fn),"must not specify an array type for uniform"),ea("typeof "+fn+'==="'+ic+'"',"invalid type, expected "+ic)}function nc(ic,e0){Array.isArray(fn)?W(fn.length===ic,"must have length "+ic):ea(Ye.isArrayLike+"("+fn+")&&"+fn+".length==="+ic,"invalid vector, should have length "+ic,Te.commandStr)}function Sd(ic){W(!Array.isArray(fn),"must not specify a value type"),ea("typeof "+fn+'==="function"&&'+fn+'._reglType==="texture'+(ic===Kc?"2d":"Cube")+'"',"invalid texture type",Te.commandStr)}switch(_t){case pp:Jc("number");break;case ec:nc(2);break;case dp:nc(3);break;case Hp:nc(4);break;case Fh:Jc("number");break;case Lf:nc(2);break;case hp:nc(3);break;case ll:nc(4);break;case Ll:Jc("boolean");break;case _d:nc(2);break;case ju:nc(3);break;case kl:nc(4);break;case tc:nc(4);break;case Hu:nc(9);break;case As:nc(16);break;case vp:Sd(Kc);break;case Wp:Sd(Xv);break}});var An=1;switch(_t){case vp:case Wp:var Tn=pe.def(fn,"._texture");pe(nt,".uniform1i(",$r,",",Tn,".bind());"),pe.exit(Tn,".unbind();");continue;case pp:case Ll:de="1i";break;case ec:case _d:de="2i",An=2;break;case dp:case ju:de="3i",An=3;break;case Hp:case kl:de="4i",An=4;break;case Fh:de="1f";break;case Lf:de="2f",An=2;break;case hp:de="3f",An=3;break;case ll:de="4f",An=4;break;case tc:de="Matrix2fv";break;case Hu:de="Matrix3fv";break;case As:de="Matrix4fv";break}if(de.charAt(0)==="M"){pe(nt,".uniform",de,"(",$r,",");var ei=Math.pow(_t-tc+2,2),wa=Te.global.def("new Float32Array(",ei,")");Array.isArray(fn)?pe("false,(",be(ei,function(ea){return wa+"["+ea+"]="+fn[ea]}),",",wa,")"):pe("false,(Array.isArray(",fn,")||",fn," instanceof Float32Array)?",fn,":(",be(ei,function(ea){return wa+"["+ea+"]="+fn+"["+ea+"]"}),",",wa,")"),pe(");")}else if(An>1){for(var ya=[],hl=[],bc=0;bc<An;++bc)Array.isArray(fn)?hl.push(fn[bc]):hl.push(pe.def(fn+"["+bc+"]")),rt&&ya.push(pe.def());rt&&pe("if(!",Te.batchId,"||",ya.map(function(ea,Jc){return ea+"!=="+hl[Jc]}).join("||"),"){",ya.map(function(ea,Jc){return ea+"="+hl[Jc]+";"}).join("")),pe(nt,".uniform",de,"(",$r,",",hl.join(","),");"),rt&&pe("}")}else{if(W(!Array.isArray(fn),"uniform value must not be an array"),rt){var za=pe.def();pe("if(!",Te.batchId,"||",za,"!==",fn,"){",za,"=",fn,";")}pe(nt,".uniform",de,"(",$r,",",fn,");"),rt&&pe("}")}}}function No(Te,pe,He,ct){var Tt=Te.shared,rt=Tt.gl,Ye=Tt.draw,nt=ct.draw;function de(){var An=nt.elements,Tn,ei=pe;return An?((An.contextDep&&ct.contextDynamic||An.propDep)&&(ei=He),Tn=An.append(Te,ei),nt.elementsActive&&ei("if("+Tn+")"+rt+".bindBuffer("+$v+","+Tn+".buffer.buffer);")):(Tn=ei.def(),ei(Tn,"=",Ye,".",Tl,";","if(",Tn,"){",rt,".bindBuffer(",$v,",",Tn,".buffer.buffer);}","else if(",Tt.vao,".currentVAO){",Tn,"=",Te.shared.elements+".getElements("+Tt.vao,".currentVAO.elements);",ar?"":"if("+Tn+")"+rt+".bindBuffer("+$v+","+Tn+".buffer.buffer);","}")),Tn}function $e(){var An=nt.count,Tn,ei=pe;return An?((An.contextDep&&ct.contextDynamic||An.propDep)&&(ei=He),Tn=An.append(Te,ei),W.optional(function(){An.MISSING&&Te.assert(pe,"false","missing vertex count"),An.DYNAMIC&&Te.assert(ei,Tn+">=0","missing vertex count")})):(Tn=ei.def(Ye,".",sl),W.optional(function(){Te.assert(ei,Tn+">=0","missing vertex count")})),Tn}var Le=de();function ut(An){var Tn=nt[An];return Tn?Tn.contextDep&&ct.contextDynamic||Tn.propDep?Tn.append(Te,He):Tn.append(Te,pe):pe.def(Ye,".",An)}var _t=ut(qc),lr=ut(bo),Hr=$e();if(typeof Hr=="number"){if(Hr===0)return}else He("if(",Hr,"){"),He.exit("}");var $r,fn;wr&&($r=ut(ul),fn=Te.instancing);var Gr=Le+".type",Ln=nt.elements&&Qc(nt.elements)&&!nt.vaoActive;function hn(){function An(){He(fn,".drawElementsInstancedANGLE(",[_t,Hr,Gr,lr+"<<(("+Gr+"-"+Zn+")>>1)",$r],");")}function Tn(){He(fn,".drawArraysInstancedANGLE(",[_t,lr,Hr,$r],");")}Le&&Le!=="null"?Ln?An():(He("if(",Le,"){"),An(),He("}else{"),Tn(),He("}")):Tn()}function Sn(){function An(){He(rt+".drawElements("+[_t,Hr,Gr,lr+"<<(("+Gr+"-"+Zn+")>>1)"]+");")}function Tn(){He(rt+".drawArrays("+[_t,lr,Hr]+");")}Le&&Le!=="null"?Ln?An():(He("if(",Le,"){"),An(),He("}else{"),Tn(),He("}")):Tn()}wr&&(typeof $r!="number"||$r>=0)?typeof $r=="string"?(He("if(",$r,">0){"),hn(),He("}else if(",$r,"<0){"),Sn(),He("}")):hn():Sn()}function Jn(Te,pe,He,ct,Tt){var rt=ai(),Ye=rt.proc("body",Tt);return W.optional(function(){rt.commandStr=pe.commandStr,rt.command=rt.link(pe.commandStr)}),wr&&(rt.instancing=Ye.def(rt.shared.extensions,".angle_instanced_arrays")),Te(rt,Ye,He,ct),rt.compile().body}function Ui(Te,pe,He,ct){wo(Te,pe),He.useVAO?He.drawVAO?pe(Te.shared.vao,".setVAO(",He.drawVAO.append(Te,pe),");"):pe(Te.shared.vao,".setVAO(",Te.shared.vao,".targetVAO);"):(pe(Te.shared.vao,".setVAO(null);"),gs(Te,pe,He,ct.attributes,function(){return!0})),ga(Te,pe,He,ct.uniforms,function(){return!0},!1),No(Te,pe,pe,He)}function $a(Te,pe){var He=Te.proc("draw",1);wo(Te,He),as(Te,He,pe.context),Vs(Te,He,pe.framebuffer),Gs(Te,He,pe),Ms(Te,He,pe.state),Si(Te,He,pe,!1,!0);var ct=pe.shader.progVar.append(Te,He);if(He(Te.shared.gl,".useProgram(",ct,".program);"),pe.shader.program)Ui(Te,He,pe,pe.shader.program);else{He(Te.shared.vao,".setVAO(null);");var Tt=Te.global.def("{}"),rt=He.def(ct,".id"),Ye=He.def(Tt,"[",rt,"]");He(Te.cond(Ye).then(Ye,".call(this,a0);").else(Ye,"=",Tt,"[",rt,"]=",Te.link(function(nt){return Jn(Ui,Te,pe,nt,1)}),"(",ct,");",Ye,".call(this,a0);"))}Object.keys(pe.state).length>0&&He(Te.shared.current,".dirty=true;"),Te.shared.vao&&He(Te.shared.vao,".setVAO(null);")}function ys(Te,pe,He,ct){Te.batchId="a1",wo(Te,pe);function Tt(){return!0}gs(Te,pe,He,ct.attributes,Tt),ga(Te,pe,He,ct.uniforms,Tt,!1),No(Te,pe,pe,He)}function Pl(Te,pe,He,ct){wo(Te,pe);var Tt=He.contextDep,rt=pe.def(),Ye="a0",nt="a1",de=pe.def();Te.shared.props=de,Te.batchId=rt;var $e=Te.scope(),Le=Te.scope();pe($e.entry,"for(",rt,"=0;",rt,"<",nt,";++",rt,"){",de,"=",Ye,"[",rt,"];",Le,"}",$e.exit);function ut(Gr){return Gr.contextDep&&Tt||Gr.propDep}function _t(Gr){return!ut(Gr)}if(He.needsContext&&as(Te,Le,He.context),He.needsFramebuffer&&Vs(Te,Le,He.framebuffer),Ms(Te,Le,He.state,ut),He.profile&&ut(He.profile)&&Si(Te,Le,He,!1,!0),ct)He.useVAO?He.drawVAO?ut(He.drawVAO)?Le(Te.shared.vao,".setVAO(",He.drawVAO.append(Te,Le),");"):$e(Te.shared.vao,".setVAO(",He.drawVAO.append(Te,$e),");"):$e(Te.shared.vao,".setVAO(",Te.shared.vao,".targetVAO);"):($e(Te.shared.vao,".setVAO(null);"),gs(Te,$e,He,ct.attributes,_t),gs(Te,Le,He,ct.attributes,ut)),ga(Te,$e,He,ct.uniforms,_t,!1),ga(Te,Le,He,ct.uniforms,ut,!0),No(Te,$e,Le,He);else{var lr=Te.global.def("{}"),Hr=He.shader.progVar.append(Te,Le),$r=Le.def(Hr,".id"),fn=Le.def(lr,"[",$r,"]");Le(Te.shared.gl,".useProgram(",Hr,".program);","if(!",fn,"){",fn,"=",lr,"[",$r,"]=",Te.link(function(Gr){return Jn(ys,Te,He,Gr,2)}),"(",Hr,");}",fn,".call(this,a0[",rt,"],",rt,");")}}function Oe(Te,pe){var He=Te.proc("batch",2);Te.batchId="0",wo(Te,He);var ct=!1,Tt=!0;Object.keys(pe.context).forEach(function(lr){ct=ct||pe.context[lr].propDep}),ct||(as(Te,He,pe.context),Tt=!1);var rt=pe.framebuffer,Ye=!1;rt?(rt.propDep?ct=Ye=!0:rt.contextDep&&ct&&(Ye=!0),Ye||Vs(Te,He,rt)):Vs(Te,He,null),pe.state.viewport&&pe.state.viewport.propDep&&(ct=!0);function nt(lr){return lr.contextDep&&ct||lr.propDep}Gs(Te,He,pe),Ms(Te,He,pe.state,function(lr){return!nt(lr)}),(!pe.profile||!nt(pe.profile))&&Si(Te,He,pe,!1,"a1"),pe.contextDep=ct,pe.needsContext=Tt,pe.needsFramebuffer=Ye;var de=pe.shader.progVar;if(de.contextDep&&ct||de.propDep)Pl(Te,He,pe,null);else{var $e=de.append(Te,He);if(He(Te.shared.gl,".useProgram(",$e,".program);"),pe.shader.program)Pl(Te,He,pe,pe.shader.program);else{He(Te.shared.vao,".setVAO(null);");var Le=Te.global.def("{}"),ut=He.def($e,".id"),_t=He.def(Le,"[",ut,"]");He(Te.cond(_t).then(_t,".call(this,a0,a1);").else(_t,"=",Le,"[",ut,"]=",Te.link(function(lr){return Jn(Pl,Te,pe,lr,2)}),"(",$e,");",_t,".call(this,a0,a1);"))}}Object.keys(pe.state).length>0&&He(Te.shared.current,".dirty=true;"),Te.shared.vao&&He(Te.shared.vao,".setVAO(null);")}function Mt(Te,pe){var He=Te.proc("scope",3);Te.batchId="a2";var ct=Te.shared,Tt=ct.current;as(Te,He,pe.context),pe.framebuffer&&pe.framebuffer.append(Te,He),bd(Object.keys(pe.state)).forEach(function(Ye){var nt=pe.state[Ye],de=nt.append(Te,He);Wa(de)?de.forEach(function($e,Le){He.set(Te.next[Ye],"["+Le+"]",$e)}):He.set(ct.next,"."+Ye,de)}),Si(Te,He,pe,!0,!0),[Tl,bo,sl,ul,qc].forEach(function(Ye){var nt=pe.draw[Ye];!nt||He.set(ct.draw,"."+Ye,""+nt.append(Te,He))}),Object.keys(pe.uniforms).forEach(function(Ye){var nt=pe.uniforms[Ye].append(Te,He);Array.isArray(nt)&&(nt="["+nt.join()+"]"),He.set(ct.uniforms,"["+Ee.id(Ye)+"]",nt)}),Object.keys(pe.attributes).forEach(function(Ye){var nt=pe.attributes[Ye].append(Te,He),de=Te.scopeAttrib(Ye);Object.keys(new ft).forEach(function($e){He.set(de,"."+$e,nt[$e])})}),pe.scopeVAO&&He.set(ct.vao,".targetVAO",pe.scopeVAO.append(Te,He));function rt(Ye){var nt=pe.shader[Ye];nt&&He.set(ct.shader,"."+Ye,nt.append(Te,He))}rt(ah),rt(fu),Object.keys(pe.state).length>0&&(He(Tt,".dirty=true;"),He.exit(Tt,".dirty=true;")),He("a1(",Te.shared.context,",a0,",Te.batchId,");")}function yt(Te){if(!(typeof Te!="object"||Wa(Te))){for(var pe=Object.keys(Te),He=0;He<pe.length;++He)if(ca.isDynamic(Te[pe[He]]))return!0;return!1}}function gn(Te,pe,He){var ct=pe.static[He];if(!ct||!yt(ct))return;var Tt=Te.global,rt=Object.keys(ct),Ye=!1,nt=!1,de=!1,$e=Te.global.def("{}");rt.forEach(function(ut){var _t=ct[ut];if(ca.isDynamic(_t)){typeof _t=="function"&&(_t=ct[ut]=ca.unbox(_t));var lr=fl(_t,null);Ye=Ye||lr.thisDep,de=de||lr.propDep,nt=nt||lr.contextDep}else{switch(Tt($e,".",ut,"="),typeof _t){case"number":Tt(_t);break;case"string":Tt('"',_t,'"');break;case"object":Array.isArray(_t)&&Tt("[",_t.join(),"]");break;default:Tt(Te.link(_t));break}Tt(";")}});function Le(ut,_t){rt.forEach(function(lr){var Hr=ct[lr];if(!!ca.isDynamic(Hr)){var $r=ut.invoke(_t,Hr);_t($e,".",lr,"=",$r,";")}})}pe.dynamic[He]=new ca.DynamicVariable(Ba,{thisDep:Ye,contextDep:nt,propDep:de,ref:$e,append:Le}),delete pe.static[He]}function Vi(Te,pe,He,ct,Tt){var rt=ai();rt.stats=rt.link(Tt),Object.keys(pe.static).forEach(function(nt){gn(rt,pe,nt)}),oi.forEach(function(nt){gn(rt,Te,nt)});var Ye=ms(Te,pe,He,ct,rt);return $a(rt,Ye),Mt(rt,Ye),Oe(rt,Ye),i(rt.compile(),{destroy:function(){Ye.shader.program.destroy()}})}return{next:Xr,current:Br,procs:function(){var Te=ai(),pe=Te.proc("poll"),He=Te.proc("refresh"),ct=Te.block();pe(ct),He(ct);var Tt=Te.shared,rt=Tt.gl,Ye=Tt.next,nt=Tt.current;ct(nt,".dirty=false;"),Vs(Te,pe),Vs(Te,He,null,!0);var de;wr&&(de=Te.link(wr)),Ue.oes_vertex_array_object&&He(Te.link(Ue.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var $e=0;$e<wt.maxAttributes;++$e){var Le=He.def(Tt.attributes,"[",$e,"]"),ut=Te.cond(Le,".buffer");ut.then(rt,".enableVertexAttribArray(",$e,");",rt,".bindBuffer(",Gp,",",Le,".buffer.buffer);",rt,".vertexAttribPointer(",$e,",",Le,".size,",Le,".type,",Le,".normalized,",Le,".stride,",Le,".offset);").else(rt,".disableVertexAttribArray(",$e,");",rt,".vertexAttrib4f(",$e,",",Le,".x,",Le,".y,",Le,".z,",Le,".w);",Le,".buffer=null;"),He(ut),wr&&He(de,".vertexAttribDivisorANGLE(",$e,",",Le,".divisor);")}return He(Te.shared.vao,".currentVAO=null;",Te.shared.vao,".setVAO(",Te.shared.vao,".targetVAO);"),Object.keys(er).forEach(function(_t){var lr=er[_t],Hr=ct.def(Ye,".",_t),$r=Te.block();$r("if(",Hr,"){",rt,".enable(",lr,")}else{",rt,".disable(",lr,")}",nt,".",_t,"=",Hr,";"),He($r),pe("if(",Hr,"!==",nt,".",_t,"){",$r,"}")}),Object.keys(Zt).forEach(function(_t){var lr=Zt[_t],Hr=Br[_t],$r,fn,Gr=Te.block();if(Gr(rt,".",lr,"("),Wa(Hr)){var Ln=Hr.length;$r=Te.global.def(Ye,".",_t),fn=Te.global.def(nt,".",_t),Gr(be(Ln,function(hn){return $r+"["+hn+"]"}),");",be(Ln,function(hn){return fn+"["+hn+"]="+$r+"["+hn+"];"}).join("")),pe("if(",be(Ln,function(hn){return $r+"["+hn+"]!=="+fn+"["+hn+"]"}).join("||"),"){",Gr,"}")}else $r=ct.def(Ye,".",_t),fn=ct.def(nt,".",_t),Gr($r,");",nt,".",_t,"=",$r,";"),pe("if(",$r,"!==",fn,"){",Gr,"}");He(Gr)}),Te.compile()}(),compile:Vi}}function Kv(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var k0=34918,Cd=34919,R0=35007,Rm=function(H,Ee){if(!Ee.ext_disjoint_timer_query)return null;var Ue=[];function wt(){return Ue.pop()||Ee.ext_disjoint_timer_query.createQueryEXT()}function rr(wr){Ue.push(wr)}var Et=[];function jt(wr){var Kr=wt();Ee.ext_disjoint_timer_query.beginQueryEXT(R0,Kr),Et.push(Kr),gr(Et.length-1,Et.length,wr)}function sr(){Ee.ext_disjoint_timer_query.endQueryEXT(R0)}function br(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Rr=[];function Lr(){return Rr.pop()||new br}function dr(wr){Rr.push(wr)}var Mr=[];function gr(wr,Kr,ar){var Br=Lr();Br.startQueryIndex=wr,Br.endQueryIndex=Kr,Br.sum=0,Br.stats=ar,Mr.push(Br)}var Or=[],ft=[];function Ft(){var wr,Kr,ar=Et.length;if(ar!==0){ft.length=Math.max(ft.length,ar+1),Or.length=Math.max(Or.length,ar+1),Or[0]=0,ft[0]=0;var Br=0;for(wr=0,Kr=0;Kr<Et.length;++Kr){var Xr=Et[Kr];Ee.ext_disjoint_timer_query.getQueryObjectEXT(Xr,Cd)?(Br+=Ee.ext_disjoint_timer_query.getQueryObjectEXT(Xr,k0),rr(Xr)):Et[wr++]=Xr,Or[Kr+1]=Br,ft[Kr+1]=wr}for(Et.length=wr,wr=0,Kr=0;Kr<Mr.length;++Kr){var En=Mr[Kr],er=En.startQueryIndex,Zt=En.endQueryIndex;En.sum+=Or[Zt]-Or[er];var en=ft[er],Yr=ft[Zt];Yr===en?(En.stats.gpuTime+=En.sum/1e6,dr(En)):(En.startQueryIndex=en,En.endQueryIndex=Yr,Mr[wr++]=En)}Mr.length=wr}}return{beginQuery:jt,endQuery:sr,pushScopeStats:gr,update:Ft,getNumPendingQueries:function(){return Et.length},clear:function(){Ue.push.apply(Ue,Et);for(var wr=0;wr<Ue.length;wr++)Ee.ext_disjoint_timer_query.deleteQueryEXT(Ue[wr]);Et.length=0,Ue.length=0},restore:function(){Et.length=0,Ue.length=0}}},Of=16384,Qv=256,Jv=1024,_p=34962,$p="webglcontextlost",Nh="webglcontextrestored",di=1,Oa=2,av=3;function Wu(H,Ee){for(var Ue=0;Ue<H.length;++Ue)if(H[Ue]===Ee)return Ue;return-1}function uh(H){var Ee=ae(H);if(!Ee)return null;var Ue=Ee.gl,wt=Ue.getContextAttributes(),rr=Ue.isContextLost(),Et=ce(Ue,Ee);if(!Et)return null;var jt=nu(),sr=Kv(),br=Et.extensions,Rr=Rm(Ue,br),Lr=Xi(),dr=Ue.drawingBufferWidth,Mr=Ue.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:dr,viewportHeight:Mr,framebufferWidth:dr,framebufferHeight:Mr,drawingBufferWidth:dr,drawingBufferHeight:Mr,pixelRatio:Ee.pixelRatio},Or={},ft={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ft=se(Ue,br),wr=gf(Ue,sr,Ee,Br),Kr=ep(Ue,br,wr,sr),ar=Ze(Ue,br,Ft,sr,wr,Kr,ft);function Br(Jn){return ar.destroyBuffer(Jn)}var Xr=Ut(Ue,jt,sr,Ee),En=Wc(Ue,br,Ft,function(){en.procs.poll()},gr,sr,Ee),er=es(Ue,br,Ft,sr,Ee),Zt=me(Ue,br,Ft,En,er,sr),en=Ed(Ue,jt,br,Ft,wr,Kr,En,Zt,Or,ar,Xr,ft,gr,Rr,Ee),Yr=Cn(Ue,Zt,en.procs.poll,gr,wt,br,Ft),Ir=en.next,Qr=Ue.canvas,an=[],si=[],ai=[],cn=[Ee.onDestroy],pn=null;function Hn(){if(an.length===0){Rr&&Rr.update(),pn=null;return}pn=Ki.next(Hn),wo();for(var Jn=an.length-1;Jn>=0;--Jn){var Ui=an[Jn];Ui&&Ui(gr,null,0)}Ue.flush(),Rr&&Rr.update()}function li(){!pn&&an.length>0&&(pn=Ki.next(Hn))}function fi(){pn&&(Ki.cancel(Hn),pn=null)}function Pa(Jn){Jn.preventDefault(),rr=!0,fi(),si.forEach(function(Ui){Ui()})}function Yo(Jn){Ue.getError(),rr=!1,Et.restore(),Xr.restore(),wr.restore(),En.restore(),er.restore(),Zt.restore(),ar.restore(),Rr&&Rr.restore(),en.procs.refresh(),li(),ai.forEach(function(Ui){Ui()})}var zi=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!zi&&Qr&&(Qr.addEventListener($p,Pa,!1),Qr.addEventListener(Nh,Yo,!1));function Us(){an.length=0,fi(),!zi&&Qr&&(Qr.removeEventListener($p,Pa),Qr.removeEventListener(Nh,Yo)),Xr.clear(),Zt.clear(),er.clear(),ar.clear(),En.clear(),Kr.clear(),wr.clear(),Rr&&Rr.clear(),cn.forEach(function(Jn){Jn()})}function ao(Jn){W(!!Jn,"invalid args to regl({...})"),W.type(Jn,"object","invalid args to regl({...})");function Ui(rt){var Ye=i({},rt);delete Ye.uniforms,delete Ye.attributes,delete Ye.context,delete Ye.vao,"stencil"in Ye&&Ye.stencil.op&&(Ye.stencil.opBack=Ye.stencil.opFront=Ye.stencil.op,delete Ye.stencil.op);function nt(de){if(de in Ye){var $e=Ye[de];delete Ye[de],Object.keys($e).forEach(function(Le){Ye[de+"."+Le]=$e[Le]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in rt&&(Ye.vao=rt.vao),Ye}function $a(rt,Ye){var nt={},de={};return Object.keys(rt).forEach(function($e){var Le=rt[$e];if(ca.isDynamic(Le)){de[$e]=ca.unbox(Le,$e);return}else if(Ye&&Array.isArray(Le)){for(var ut=0;ut<Le.length;++ut)if(ca.isDynamic(Le[ut])){de[$e]=ca.unbox(Le,$e);return}}nt[$e]=Le}),{dynamic:de,static:nt}}var ys=$a(Jn.context||{},!0),Pl=$a(Jn.uniforms||{},!0),Oe=$a(Jn.attributes||{},!1),Mt=$a(Ui(Jn),!1),yt={gpuTime:0,cpuTime:0,count:0},gn=en.compile(Mt,Oe,Pl,ys,yt),Vi=gn.draw,Te=gn.batch,pe=gn.scope,He=[];function ct(rt){for(;He.length<rt;)He.push(null);return He}function Tt(rt,Ye){var nt;if(rr&&W.raise("context lost"),typeof rt=="function")return pe.call(this,null,rt,0);if(typeof Ye=="function")if(typeof rt=="number")for(nt=0;nt<rt;++nt)pe.call(this,null,Ye,nt);else if(Array.isArray(rt))for(nt=0;nt<rt.length;++nt)pe.call(this,rt[nt],Ye,nt);else return pe.call(this,rt,Ye,0);else if(typeof rt=="number"){if(rt>0)return Te.call(this,ct(rt|0),rt|0)}else if(Array.isArray(rt)){if(rt.length)return Te.call(this,rt,rt.length)}else return Vi.call(this,rt)}return i(Tt,{stats:yt,destroy:function(){gn.destroy()}})}var ms=Zt.setFBO=ao({framebuffer:ca.define.call(null,di,"framebuffer")});function as(Jn,Ui){var $a=0;en.procs.poll();var ys=Ui.color;ys&&(Ue.clearColor(+ys[0]||0,+ys[1]||0,+ys[2]||0,+ys[3]||0),$a|=Of),"depth"in Ui&&(Ue.clearDepth(+Ui.depth),$a|=Qv),"stencil"in Ui&&(Ue.clearStencil(Ui.stencil|0),$a|=Jv),W(!!$a,"called regl.clear with no buffer specified"),Ue.clear($a)}function Vs(Jn){if(W(typeof Jn=="object"&&Jn,"regl.clear() takes an object as input"),"framebuffer"in Jn)if(Jn.framebuffer&&Jn.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)ms(i({framebuffer:Jn.framebuffer.faces[Ui]},Jn),as);else ms(Jn,as);else as(null,Jn)}function Gs(Jn){W.type(Jn,"function","regl.frame() callback must be a function"),an.push(Jn);function Ui(){var $a=Wu(an,Jn);W($a>=0,"cannot cancel a frame twice");function ys(){var Pl=Wu(an,ys);an[Pl]=an[an.length-1],an.length-=1,an.length<=0&&fi()}an[$a]=ys}return li(),{cancel:Ui}}function Ms(){var Jn=Ir.viewport,Ui=Ir.scissor_box;Jn[0]=Jn[1]=Ui[0]=Ui[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=Jn[2]=Ui[2]=Ue.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=Jn[3]=Ui[3]=Ue.drawingBufferHeight}function wo(){gr.tick+=1,gr.time=gs(),Ms(),en.procs.poll()}function Si(){En.refresh(),Ms(),en.procs.refresh(),Rr&&Rr.update()}function gs(){return(Xi()-Lr)/1e3}Si();function ga(Jn,Ui){W.type(Ui,"function","listener callback must be a function");var $a;switch(Jn){case"frame":return Gs(Ui);case"lost":$a=si;break;case"restore":$a=ai;break;case"destroy":$a=cn;break;default:W.raise("invalid event, must be one of frame,lost,restore,destroy")}return $a.push(Ui),{cancel:function(){for(var ys=0;ys<$a.length;++ys)if($a[ys]===Ui){$a[ys]=$a[$a.length-1],$a.pop();return}}}}var No=i(ao,{clear:Vs,prop:ca.define.bind(null,di),context:ca.define.bind(null,Oa),this:ca.define.bind(null,av),draw:ao({}),buffer:function(Jn){return wr.create(Jn,_p,!1,!1)},elements:function(Jn){return Kr.create(Jn,!1)},texture:En.create2D,cube:En.createCube,renderbuffer:er.create,framebuffer:Zt.create,framebufferCube:Zt.createCube,vao:ar.createVAO,attributes:wt,frame:Gs,on:ga,limits:Ft,hasExtension:function(Jn){return Ft.extensions.indexOf(Jn.toLowerCase())>=0},read:Yr,destroy:Us,_gl:Ue,_refresh:Si,poll:function(){wo(),Rr&&Rr.update()},now:gs,stats:sr});return Ee.onDone(null,No),No}return uh})})(mF);const ste=mF.exports;var ute=function(){function e(r,t){Kt(this,e);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,l=t.size,c=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:c||0},l&&(this.attribute.size=l)}return Qt(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),p0,G_,d0,ad,j_,im,H_,Dx,Av,cg,of,Tv,Mv,Bx,lte=(p0={},ne(p0,Q.POINTS,"points"),ne(p0,Q.LINES,"lines"),ne(p0,Q.LINE_LOOP,"line loop"),ne(p0,Q.LINE_STRIP,"line strip"),ne(p0,Q.TRIANGLES,"triangles"),ne(p0,Q.TRIANGLE_FAN,"triangle fan"),ne(p0,Q.TRIANGLE_STRIP,"triangle strip"),p0),XF=(G_={},ne(G_,Q.STATIC_DRAW,"static"),ne(G_,Q.DYNAMIC_DRAW,"dynamic"),ne(G_,Q.STREAM_DRAW,"stream"),G_),cA=(d0={},ne(d0,Q.BYTE,"int8"),ne(d0,Q.UNSIGNED_INT,"int16"),ne(d0,Q.INT,"int32"),ne(d0,Q.UNSIGNED_BYTE,"uint8"),ne(d0,Q.UNSIGNED_SHORT,"uint16"),ne(d0,Q.UNSIGNED_INT,"uint32"),ne(d0,Q.FLOAT,"float"),d0),cte=(ad={},ne(ad,Q.ALPHA,"alpha"),ne(ad,Q.LUMINANCE,"luminance"),ne(ad,Q.LUMINANCE_ALPHA,"luminance alpha"),ne(ad,Q.RGB,"rgb"),ne(ad,Q.RGBA,"rgba"),ne(ad,Q.RGBA4,"rgba4"),ne(ad,Q.RGB5_A1,"rgb5 a1"),ne(ad,Q.RGB565,"rgb565"),ne(ad,Q.DEPTH_COMPONENT,"depth"),ne(ad,Q.DEPTH_STENCIL,"depth stencil"),ad),fte=(j_={},ne(j_,Q.DONT_CARE,"dont care"),ne(j_,Q.NICEST,"nice"),ne(j_,Q.FASTEST,"fast"),j_),WL=(im={},ne(im,Q.NEAREST,"nearest"),ne(im,Q.LINEAR,"linear"),ne(im,Q.LINEAR_MIPMAP_LINEAR,"mipmap"),ne(im,Q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),ne(im,Q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),ne(im,Q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),im),$L=(H_={},ne(H_,Q.REPEAT,"repeat"),ne(H_,Q.CLAMP_TO_EDGE,"clamp"),ne(H_,Q.MIRRORED_REPEAT,"mirror"),H_),hte=(Dx={},ne(Dx,Q.NONE,"none"),ne(Dx,Q.BROWSER_DEFAULT_WEBGL,"browser"),Dx),pte=(Av={},ne(Av,Q.NEVER,"never"),ne(Av,Q.ALWAYS,"always"),ne(Av,Q.LESS,"less"),ne(Av,Q.LEQUAL,"lequal"),ne(Av,Q.GREATER,"greater"),ne(Av,Q.GEQUAL,"gequal"),ne(Av,Q.EQUAL,"equal"),ne(Av,Q.NOTEQUAL,"notequal"),Av),XL=(cg={},ne(cg,Q.FUNC_ADD,"add"),ne(cg,Q.MIN_EXT,"min"),ne(cg,Q.MAX_EXT,"max"),ne(cg,Q.FUNC_SUBTRACT,"subtract"),ne(cg,Q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),cg),Nx=(of={},ne(of,Q.ZERO,"zero"),ne(of,Q.ONE,"one"),ne(of,Q.SRC_COLOR,"src color"),ne(of,Q.ONE_MINUS_SRC_COLOR,"one minus src color"),ne(of,Q.SRC_ALPHA,"src alpha"),ne(of,Q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),ne(of,Q.DST_COLOR,"dst color"),ne(of,Q.ONE_MINUS_DST_COLOR,"one minus dst color"),ne(of,Q.DST_ALPHA,"dst alpha"),ne(of,Q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),ne(of,Q.CONSTANT_COLOR,"constant color"),ne(of,Q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),ne(of,Q.CONSTANT_ALPHA,"constant alpha"),ne(of,Q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),ne(of,Q.SRC_ALPHA_SATURATE,"src alpha saturate"),of),dte=(Tv={},ne(Tv,Q.NEVER,"never"),ne(Tv,Q.ALWAYS,"always"),ne(Tv,Q.LESS,"less"),ne(Tv,Q.LEQUAL,"lequal"),ne(Tv,Q.GREATER,"greater"),ne(Tv,Q.GEQUAL,"gequal"),ne(Tv,Q.EQUAL,"equal"),ne(Tv,Q.NOTEQUAL,"notequal"),Tv),Sy=(Mv={},ne(Mv,Q.ZERO,"zero"),ne(Mv,Q.KEEP,"keep"),ne(Mv,Q.REPLACE,"replace"),ne(Mv,Q.INVERT,"invert"),ne(Mv,Q.INCR,"increment"),ne(Mv,Q.DECR,"decrement"),ne(Mv,Q.INCR_WRAP,"increment wrap"),ne(Mv,Q.DECR_WRAP,"decrement wrap"),Mv),vte=(Bx={},ne(Bx,Q.FRONT,"front"),ne(Bx,Q.BACK,"back"),Bx),mte=function(){function e(r,t){Kt(this,e);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:XF[i||Q.STATIC_DRAW],type:cA[a||Q.UNSIGNED_BYTE]})}return Qt(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),gte=function(){function e(r,t){Kt(this,e);var n=t.data,i=t.usage,a=t.type,o=t.count;this.elements=r.elements({data:n,usage:XF[i||Q.STATIC_DRAW],type:cA[a||Q.UNSIGNED_BYTE],count:o})}return Qt(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),yte=function(){function e(r,t){Kt(this,e);var n=t.width,i=t.height,a=t.color,o=t.colors;t.depth,t.stencil;var l={width:n,height:i};Array.isArray(o)&&(l.colors=o.map(function(c){return c.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return Qt(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),_te=function(){function e(r,t){Kt(this,e),ne(this,"destroyed",!1),ne(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,o=t.uniforms,l=t.primitive,c=t.count,p=t.elements,y=t.depth,b=t.blend,w=t.stencil,M=t.cull,O=t.instances,N={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(function(K){N[K]=r.prop(K)}));var z={};Object.keys(a).forEach(function(K){z[K]=a[K].get()});var j={attributes:z,frag:i,uniforms:N,vert:n,blend:{},primitive:lte[l===void 0?Q.TRIANGLES:l]};O&&(j.instances=O),c?j.count=c:p&&(j.elements=p.get()),this.initDepthDrawParams({depth:y},j),this.initBlendDrawParams({blend:b},j),this.initStencilDrawParams({stencil:w},j),this.initCullDrawParams({cull:M},j),this.drawCommand=r(j);var Y=Vr.exports.cloneDeep(j);Y.blend=tr(tr({},Y.blend),{},{enable:!1}),this.drawPickCommand=r(Y),this.drawParams=j}return Qt(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var a=Vr.exports.cloneDeep(this.drawParams);a.blend=tr(tr({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(a){n[a]=t[a].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var i=Vr.exports.cloneDeep(this.drawParams);i.blend=tr(tr({},i.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(i)}},{key:"addUniforms",value:function(t){this.uniforms=tr(tr({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=tr(tr({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(o){var l=x1(i[o]);l==="boolean"||l==="number"||Array.isArray(i[o])||i[o].BYTES_PER_ELEMENT?a[o]=i[o]:a[o]=i[o].get()}),n?this.drawPickCommand(a):this.drawCommand(a)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:pte[i.func||Q.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var i=t.blend;if(i){var a=i.enable,o=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;n.blend={enable:!!a,func:{srcRGB:Nx[o&&o.srcRGB||Q.SRC_ALPHA],srcAlpha:Nx[o&&o.srcAlpha||Q.SRC_ALPHA],dstRGB:Nx[o&&o.dstRGB||Q.ONE_MINUS_SRC_ALPHA],dstAlpha:Nx[o&&o.dstAlpha||Q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:XL[l&&l.rgb||Q.FUNC_ADD],alpha:XL[l&&l.alpha||Q.FUNC_ADD]},color:p}}}},{key:"initStencilDrawParams",value:function(t,n){var i=t.stencil;if(i){var a=i.enable,o=i.mask,l=o===void 0?-1:o,c=i.func,p=c===void 0?{cmp:Q.ALWAYS,ref:0,mask:-1}:c,y=i.opFront,b=y===void 0?{fail:Q.KEEP,zfail:Q.KEEP,zpass:Q.KEEP}:y,w=i.opBack,M=w===void 0?{fail:Q.KEEP,zfail:Q.KEEP,zpass:Q.KEEP}:w;n.stencil={enable:!!a,mask:l,func:tr(tr({},p),{},{cmp:dte[p.cmp]}),opFront:{fail:Sy[b.fail],zfail:Sy[b.zfail],zpass:Sy[b.zpass]},opBack:{fail:Sy[M.fail],zfail:Sy[M.zfail],zpass:Sy[M.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,o=i.face,l=o===void 0?Q.BACK:o;n.cull={enable:!!a,face:vte[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Vr.exports.isTypedArray(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}Vr.exports.isPlainObject(n)&&Object.keys(n).forEach(function(l){o.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){o.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}(),xte=function(){function e(r,t){Kt(this,e),ne(this,"isDistroy",!1);var n=t.data,i=t.type,a=i===void 0?Q.UNSIGNED_BYTE:i,o=t.width,l=t.height,c=t.flipY,p=c===void 0?!1:c,y=t.format,b=y===void 0?Q.RGBA:y,w=t.mipmap,M=w===void 0?!1:w,O=t.wrapS,N=O===void 0?Q.CLAMP_TO_EDGE:O,z=t.wrapT,j=z===void 0?Q.CLAMP_TO_EDGE:z,Y=t.aniso,K=Y===void 0?0:Y,ie=t.alignment,le=ie===void 0?1:ie,Se=t.premultiplyAlpha,ze=Se===void 0?!1:Se,ue=t.mag,Ke=ue===void 0?Q.NEAREST:ue,ke=t.min,Ce=ke===void 0?Q.NEAREST:ke,je=t.colorSpace,ve=je===void 0?Q.BROWSER_DEFAULT_WEBGL:je,Ie=t.x,dt=Ie===void 0?0:Ie,St=t.y,Rt=St===void 0?0:St,$t=t.copy,gt=$t===void 0?!1:$t;this.width=o,this.height=l;var jr={width:o,height:l,type:cA[a],format:cte[b],wrapS:$L[N],wrapT:$L[j],mag:WL[Ke],min:WL[Ce],alignment:le,flipY:p,colorSpace:hte[ve],premultiplyAlpha:ze,aniso:K,x:dt,y:Rt,copy:gt};n&&(jr.data=n),typeof M=="number"?jr.mipmap=fte[M]:typeof M=="boolean"&&(jr.mipmap=M),this.texture=r.texture(jr)}return Qt(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),ZL,YL,bte=(ZL=oa(),ZL(YL=function(){function e(){var r=this;Kt(this,e),ne(this,"createModel",function(t){return new _te(r.gl,t)}),ne(this,"createAttribute",function(t){return new ute(r.gl,t)}),ne(this,"createBuffer",function(t){return new mte(r.gl,t)}),ne(this,"createElements",function(t){return new gte(r.gl,t)}),ne(this,"createTexture2D",function(t){return new xte(r.gl,t)}),ne(this,"createFramebuffer",function(t){return new yte(r.gl,t)}),ne(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),ne(this,"clear",function(t){var n,i=t.color,a=t.depth,o=t.stencil,l=t.framebuffer,c=l===void 0?null:l,p={color:i,depth:a,stencil:o};p.framebuffer=c===null?c:c.get(),(n=r.gl)===null||n===void 0||n.clear(p)}),ne(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,o=t.height;r.gl._gl.viewport(n,i,a,o),r.width=a,r.height=o,r.gl._refresh()}),ne(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,o=t.width,l=t.height,c={x:i,y:a,width:o,height:l};return n&&(c.framebuffer=n.get()),r.gl.read(c)}),ne(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),ne(this,"getContainer",function(){if(Zh)return r.canvas;var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),ne(this,"getCanvas",function(){return r.canvas}),ne(this,"getGLContext",function(){return r.gl._gl}),ne(this,"destroy",function(){var t,n,i;r.canvas=null,(t=r.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(i=n.getExtension("WEBGL_lose_context"))===null||i===void 0||i.loseContext(),r.gl.destroy(),r.gl=null})}return Qt(e,[{key:"init",value:function(){var r=eo(Xn.mark(function n(i,a,o){var l=this;return Xn.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.canvas=i,!o){p.next=5;break}this.gl=o,p.next=8;break;case 5:return p.next=7,new Promise(function(y,b){ste({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(M,O){(M||!O)&&b(M),y(O)}})});case 7:this.gl=p.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return p.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||YL),ZF=function(){function e(r){Kt(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.hasBaseMap,o=MW();this.container=o,n.setContainer(o,t,i,a),o.bind(Gt.IRendererService).to(bte).inSingletonScope(),this.sceneService=o.get(Gt.ISceneService),this.mapService=o.get(Gt.IMapService),this.iconService=o.get(Gt.IIconService),this.fontService=o.get(Gt.IFontService),this.controlService=o.get(Gt.IControlService),this.layerService=o.get(Gt.ILayerService),this.markerService=o.get(Gt.IMarkerService),this.interactionService=o.get(Gt.IInteractionService),this.popupService=o.get(Gt.IPopupService),Zh?this.sceneService.initMiniScene(r):(this.initComponent(t),this.sceneService.init(r),this.initControl())}return Qt(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=JC(this.container);t.setContainer(n,this.container),this.sceneService.addLayer(t);var i=t.getLayerConfig();if(i){var a=i.mask,o=i.maskfence,l=i.maskColor,c=l===void 0?"#000":l,p=i.maskOpacity,y=p===void 0?0:p;if(a&&o){var b=new vP().source(o).shape("fill").color(c).style({opacity:y});this.addMask(b,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,n){var i=this.getLayer(n);if(i){var a=JC(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,n){this.layerService.remove(t,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=Pi(i,2),o=a[0],l=a[1];n.fontService.addIconFont(o,l)})}},{key:"addFontFace",value:function(t,n){this.sceneService.addFontFace(t,n)}},{key:"addImage",value:function(t,n){Zh?this.iconService.addImageMini(t,n,this.sceneService):this.iconService.addImage(t,n)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,n){TE.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.on(t,n)}},{key:"once",value:function(t,n){TE.indexOf(t)===-1?this.mapService.once(t,n):this.sceneService.once(t,n)}},{key:"off",value:function(t,n){TE.indexOf(t)===-1?this.mapService.off(t,n):this.sceneService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,o=i.animate;this.mapService.fitBounds(t,n||tr(tr({},a),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Gt.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:_B(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new BW({position:i}))}}]),e}(),qL=new Map,KL=new Map,QL=new Map,JL=function(e){return e!==null&&typeof e!="function"&&isFinite(e.length)},Ete={}.toString,f_=function(e,r){return Ete.call(e)==="[object "+r+"]"};const g0=function(e){return f_(e,"Function")};var Cte=function(e){return e==null};const hm=function(e){return Array.isArray?Array.isArray(e):f_(e,"Array")},Oy=function(e){var r=typeof e;return e!==null&&r==="object"||r==="function"};function Bb(e,r){if(!!e){var t;if(hm(e))for(var n=0,i=e.length;n<i&&(t=r(e[n],n),t!==!1);n++);else if(Oy(e)){for(var a in e)if(e.hasOwnProperty(a)&&(t=r(e[a],a),t===!1))break}}}var wS=function(e){return typeof e=="object"&&e!==null},AS=function(e){if(!wS(e)||!f_(e,"Object"))return!1;if(Object.getPrototypeOf(e)===null)return!0;for(var r=e;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r};const Vf=function(e){return f_(e,"String")};var Ste=function(e){return f_(e,"Number")},wte=Object.values?function(e){return Object.values(e)}:function(e){var r=[];return Bb(e,function(t,n){g0(e)&&n==="prototype"||r.push(t)}),r};const Ate=function(e){return Cte(e)?"":e.toString()};var Tte=function(e){return Ate(e).toLowerCase()};function fA(e,r){return!e||!r?e:e.replace(/\\?\{([^{}]+)\}/g,function(t,n){return t.charAt(0)==="\\"?t.slice(1):r[n]===void 0?"":r[n]})}var YF=function(e){return f_(e,"Boolean")},Dv=function(e){return e===void 0},f1=function(e){if(typeof e!="object"||e===null)return e;var r;if(hm(e)){r=[];for(var t=0,n=e.length;t<n;t++)typeof e[t]=="object"&&e[t]!=null?r[t]=f1(e[t]):r[t]=e[t]}else{r={};for(var i in e)typeof e[i]=="object"&&e[i]!=null?r[i]=f1(e[i]):r[i]=e[i]}return r};const Mte=function(e,r){if(!g0(e))throw new TypeError("Expected a function");var t=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=r?r.apply(this,n):n[0],o=t.cache;if(o.has(a))return o.get(a);var l=e.apply(this,n);return o.set(a,l),l};return t.cache=new Map,t};var Ite=5;function qF(e,r,t,n){t=t||0,n=n||Ite;for(var i in r)if(r.hasOwnProperty(i)){var a=r[i];a!==null&&AS(a)?(AS(e[i])||(e[i]={}),t<n?qF(e[i],a,t+1,n):e[i]=r[i]):hm(a)?(e[i]=[],e[i]=e[i].concat(a)):a!==void 0&&(e[i]=a)}}var zg=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];for(var n=0;n<r.length;n+=1)qF(e,r[n]);return e},gl=function(e,r){if(e===r)return!0;if(!e||!r||Vf(e)||Vf(r))return!1;if(JL(e)||JL(r)){if(e.length!==r.length)return!1;for(var t=!0,n=0;n<e.length&&(t=gl(e[n],r[n]),!!t);n++);return t}if(wS(e)||wS(r)){var i=Object.keys(e),a=Object.keys(r);if(i.length!==a.length)return!1;for(var t=!0,n=0;n<i.length&&(t=gl(e[i[n]],r[i[n]]),!!t);n++);return t}return!1};const Lte=function(e,r,t){for(var n=0,i=Vf(r)?r.split("."):r;e&&n<i.length;)e=e[i[n++]];return e===void 0||n<i.length?t:e};var kte=Object.prototype.hasOwnProperty;const h1=function(e,r){if(e===null||!AS(e))return{};var t={};return Bb(r,function(n){kte.call(e,n)&&(t[n]=e[n])}),t};var zx={};const x2=function(e){return e=e||"g",zx[e]?zx[e]+=1:zx[e]=1,e+zx[e]};var TS=function(e,r){return TS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},TS(e,r)};function qh(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");TS(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}var Vl=function(){return Vl=Object.assign||function(r){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},Vl.apply(this,arguments)};function Rp(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)r.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(t[n[i]]=e[n[i]]);return t}function Ux(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(y){try{p(n.next(y))}catch(b){o(b)}}function c(y){try{p(n.throw(y))}catch(b){o(b)}}function p(y){y.done?a(y.value):i(y.value).then(l,c)}p((n=n.apply(e,r||[])).next())})}function Vx(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(y){return c([p,y])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(y){p=[6,y],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}function KF(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],o;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){o={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return a}function Rte(){for(var e=0,r=0,t=arguments.length;r<t;r++)e+=arguments[r].length;for(var n=Array(e),i=0,r=0;r<t;r++)for(var a=arguments[r],o=0,l=a.length;o<l;o++,i++)n[i]=a[o];return n}var Gx;Mte(function(e,r){r===void 0&&(r={});var t=r.fontSize,n=r.fontFamily,i=r.fontWeight,a=r.fontStyle,o=r.fontVariant;return Gx||(Gx=document.createElement("canvas").getContext("2d")),Gx.font=[a,o,i,t+"px",n].join(" "),Gx.measureText(Vf(e)?e:"").width},function(e,r){return r===void 0&&(r={}),Rte([e],wte(r)).join("")});var mg={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.NAME_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-tooltip",e.TITLE_CLASS="l7plot-tooltip__title",e.LIST_CLASS="l7plot-tooltip__list",e.LIST_ITEM_CLASS="l7plot-tooltip__list-item",e.NAME_CLASS="l7plot-tooltip__name",e.VALUE_CLASS="l7plot-tooltip__value",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,`">
  <div class="`).concat(e.TITLE_CLASS,`"></div>
  <ul class="`).concat(e.LIST_CLASS,`"></ul>
</div>`),e.ITEM_TPL='<li class="'.concat(e.LIST_ITEM_CLASS,`" data-index={index}>
  <span class="`).concat(e.NAME_CLASS,`">{name}</span>
  <span class="`).concat(e.VALUE_CLASS,`">{value}</span>
</li>`)})(mg);var gg={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.MARKER_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",e.TITLE_CLASS="l7plot-legend__title",e.LIST_CLASS="l7plot-legend__category-list",e.LIST_ITEM_CLASS="l7plot-legend__list-item",e.MARKER_CLASS="l7plot-legend__category-marker",e.VALUE_CLASS="l7plot-legend__category-value",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,`">
  <div class="`).concat(e.TITLE_CLASS,`"></div>
  <ul class="`).concat(e.LIST_CLASS,`"></ul>
</div>`),e.ITEM_TPL='<li class="'.concat(e.LIST_ITEM_CLASS,`" data-index={index}>
  <span class="`).concat(e.MARKER_CLASS,`" style="background:{color}"></span>
  <span class="`).concat(e.VALUE_CLASS,`">{value}</span>
</li>`)})(gg);var My={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RIBBON_TPL=e.CONTAINER_TPL=e.VALUE_RANGE_CLASS=e.GRADIENT_BAR_CLASS=e.RIBBON_CLASS=e.RIBBON_CONTAINER_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",e.TITLE_CLASS="l7plot-legend__title",e.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",e.RIBBON_CLASS="l7plot-legend__ribbon",e.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",e.VALUE_RANGE_CLASS="l7plot-legend__value-range",e.CONTAINER_TPL='<div class="'.concat(e.CONTAINER_CLASS,`">
  <div class="`).concat(e.TITLE_CLASS,`"></div>
  <div class="`).concat(e.RIBBON_CONTAINER_CLASS,`"></div>
</div>`),e.RIBBON_TPL='<div class="'.concat(e.RIBBON_CLASS,`">
  <span class="`).concat(e.VALUE_RANGE_CLASS,`">{min}</span>
  <div class="`).concat(e.GRADIENT_BAR_CLASS,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat(e.VALUE_RANGE_CLASS,`">{max}</span>
</div>`)})(My);function QF(e){var r,t,n,i={point:{default:{fill:e.pointFillColor,size:e.pointSize,stroke:e.pointBorderColor,lineWidth:e.pointBorder,fillOpacity:e.pointFillOpacity},active:{fill:e.pointActiveFillColor},selected:{fill:e.pointSelectedFillColor}}};return{mapStyle:e.mapStyle,defaultColor:e.brandColor,subColor:e.subColor,semanticRed:e.paletteSemanticRed,semanticGreen:e.paletteSemanticGreen,fontFamily:e.fontFamily,colors10:e.paletteQualitative10,colors20:e.paletteQualitative20,sequenceColors:e.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:i.point.default},active:{style:i.point.active},selected:{style:i.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:(r={},r[gg.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:"".concat(e.legendContainerBorderRadius,"px"),color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:"1",fontSize:"".concat(e.legendTextFontSize,"px")},r[gg.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},r[gg.LIST_CLASS]={margin:"0px",padding:"0px"},r[gg.LIST_ITEM_CLASS]={marginBottom:"2px"},r[gg.MARKER_CLASS]={width:"10px",height:"10px"},r[gg.VALUE_CLASS]={paddingLeft:"8px"},r)},continue:{domStyles:(t={},t[My.CONTAINER_CLASS]={visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:"".concat(e.legendContainerBorderRadius,"px"),color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:1,fontSize:"".concat(e.legendTextFontSize,"px")},t[My.TITLE_CLASS]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},t[My.RIBBON_CLASS]={display:"flex",alignItems:"center"},t[My.GRADIENT_BAR_CLASS]={width:"140px",height:"14px",margin:"0px 5px"},t[My.VALUE_RANGE_CLASS]={padding:"0px"},t)}},tooltip:{domStyles:(n={},n[mg.CONTAINER_CLASS]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:e.tooltipContainerFillColor,boxShadow:e.tooltipContainerShadow,borderRadius:"".concat(e.tooltipContainerBorderRadius,"px"),color:e.tooltipTextFillColor,fontSize:"".concat(e.tooltipTextFontSize,"px"),fontFamily:e.fontFamily,lineHeight:e.tooltipTextLineHeight},n[mg.TITLE_CLASS]={marginBottom:"4px"},n[mg.LIST_CLASS]={margin:"0px",padding:"0px"},n[mg.LIST_ITEM_CLASS]={marginBottom:"4px"},n[mg.NAME_CLASS]={color:e.tooltipItemNameFillColor},n[mg.VALUE_CLASS]={color:e.tooltipItemValueFillColor,marginLeft:"30px"},n)},label:{style:{textAnchor:"center",textOffset:[0,0],fill:e.labelFillColor,fontSize:e.labelFontSize,fontFamily:e.fontFamily,fillColorDark:e.labelFillColorDark,fillColorLight:e.labelFillColorLight}}}}}var fg={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Ote={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Pte=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],Fte=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Dte=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],JF=function(e){e===void 0&&(e={});var r=e.mapStyle,t=r===void 0?"light":r,n=e.subColor,i=n===void 0?"rgba(0,0,0,0.05)":n,a=e.paletteQualitative10,o=a===void 0?Pte:a,l=e.paletteQualitative20,c=l===void 0?Fte:l,p=e.paletteSemanticRed,y=p===void 0?"#F4664A":p,b=e.paletteSemanticGreen,w=b===void 0?"#30BF78":b,M=e.paletteSemanticYellow,O=M===void 0?"#FAAD14":M,N=e.paletteSequence,z=N===void 0?Dte:N,j=e.fontFamily,Y=j===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:j,K=e.brandColor,ie=K===void 0?o[0]:K;return{mapStyle:t,brandColor:ie,subColor:i,paletteQualitative10:o,paletteQualitative20:c,paletteSemanticRed:y,paletteSemanticGreen:w,paletteSemanticYellow:O,paletteSequence:z,fontFamily:Y,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:fg[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:fg[65],tooltipItemNameFillColor:fg[65],tooltipItemValueFillColor:fg[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:fg[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:ie,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Ote[100],pointActiveBorderColor:fg[100],pointSelectedBorderColor:fg[100]}};JF();var Bte={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},hg={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},ek=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],Nte=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],zte=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],e6=function(e){e===void 0&&(e={});var r=e.mapStyle,t=r===void 0?"dark":r,n=e.subColor,i=n===void 0?"rgba(255,255,255,0.05)":n,a=e.paletteQualitative10,o=a===void 0?ek:a,l=e.paletteQualitative20,c=l===void 0?Nte:l,p=e.paletteSemanticRed,y=p===void 0?"#F4664A":p,b=e.paletteSemanticGreen,w=b===void 0?"#30BF78":b,M=e.paletteSemanticYellow,O=M===void 0?"#FAAD14":M,N=e.paletteSequence,z=N===void 0?zte:N,j=e.fontFamily,Y=j===void 0?`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`:j,K=e.brandColor,ie=K===void 0?o[0]:K;return{mapStyle:t,brandColor:ie,subColor:i,paletteQualitative10:o,paletteQualitative20:c,paletteSemanticRed:y,paletteSemanticGreen:w,paletteSemanticYellow:O,paletteSequence:z,fontFamily:Y,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:hg[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:hg[65],tooltipItemNameFillColor:hg[65],tooltipItemValueFillColor:hg[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:hg[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:ek[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Bte[100],pointActiveBorderColor:hg[100],pointSelectedBorderColor:hg[100]}};e6();function t6(e){var r=e.styleSheet,t=r===void 0?{}:r,n=Rp(e,["styleSheet"]),i=JF(t);return zg({},QF(i),n)}function Ute(e){var r=e.styleSheet,t=r===void 0?{}:r,n=Rp(e,["styleSheet"]),i=e6(t);return zg({},QF(i),n)}var tk=t6({}),Vte=Ute({}),rk={default:tk,light:tk,dark:Vte};function MS(e){return e===void 0&&(e="default"),Lte(rk,Tte(e),rk.default)}var nk;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(nk||(nk={}));var IS;(function(e){e.TextLayer="textLayer",e.DotLayer="dotLayer",e.IconLayer="iconLayer",e.DotDensity="dotDensityLayer",e.ColumnLayer="columnLayer",e.HeatmapLayer="heatmapLayer",e.GridLayer="gridLayer",e.HexbinLayer="hexbinLayer",e.LinesLayer="linesLayer",e.PathLayer="pathLayer",e.ArcLayer="arcLayer",e.AreaLayer="areaLayer",e.PrismLayer="prismLayer"})(IS||(IS={}));var Gy;(function(e){e.Amap="amap",e.Mapbox="mapbox"})(Gy||(Gy={}));var LS;(function(e){e.Dot="dot",e.DotDensity="dotDensity",e.Heatmap="heatmap",e.Grid="grid",e.Hexbin="hexbin",e.Path="path",e.Flow="flow",e.Area="area",e.Choropleth="choropleth"})(LS||(LS={}));var Gte="*",b2=function(){function e(){this._events={}}return e.prototype.on=function(r,t,n){return this._events[r]||(this._events[r]=[]),this._events[r].push({callback:t,once:!!n}),this},e.prototype.once=function(r,t){return this.on(r,t,!0)},e.prototype.emit=function(r){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=this._events[r]||[],o=this._events[Gte]||[],l=function(c){for(var p=c.length,y=0;y<p;y++)if(!!c[y]){var b=c[y],w=b.callback,M=b.once;M&&(c.splice(y,1),c.length===0&&delete t._events[r],p--,y--),w.apply(t,n)}};l(a),l(o)},e.prototype.off=function(r,t){if(!r)this._events={};else if(!t)delete this._events[r];else{for(var n=this._events[r]||[],i=n.length,a=0;a<i;a++)n[a].callback===t&&(n.splice(a,1),i--,a--);n.length===0&&delete this._events[r]}return this},e.prototype.getEvents=function(){return this._events},e}(),t1,qE,r6,kS;function jte(){t1=document.createElement("table"),qE=document.createElement("tr"),r6=/^\s*<(\w+|!)[^>]*>/,kS={tr:document.createElement("tbody"),tbody:t1,thead:t1,tfoot:t1,td:qE,th:qE,"*":document.createElement("div")}}function Hte(e){t1||jte();var r=r6.test(e)&&RegExp.$1;(!r||!(r in kS))&&(r="*");var t=kS[r];e=typeof e=="string"?e.replace(/(^\s*)|(\s*$)/g,""):e,t.innerHTML=""+e;var n=t.childNodes[0];return n&&t.contains(n)&&t.removeChild(n),n}function _h(e,r){if(e)for(var t in r)r.hasOwnProperty(t)&&(e.style[t]=r[t]);return e}const hA={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`};var pA="l7plot-tooltip",dA="l7plot-tooltip__title",vA="l7plot-tooltip__list",n6="l7plot-tooltip__list-item",i6="l7plot-tooltip__name",a6="l7plot-tooltip__value",Wte='<div class="'.concat(pA,`">
  <div class="`).concat(dA,`"></div>
  <ul class="`).concat(vA,`"></ul>
</div>`),ik='<li class="'.concat(n6,`" data-index={index}>
  <span class="`).concat(i6,`">{name}</span>
  <span class="`).concat(a6,`">{value}</span>
</li>`),am;const $te=(am={},am[pA]={visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:hA.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},am[dA]={marginBottom:"4px"},am[vA]={margin:"0px",listStyleType:"none",padding:"0px"},am[n6]={listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},am[i6]={},am[a6]={marginLeft:"30px"},am);function Xte(e,r){return!!e.className.match(new RegExp("(\\s|^)".concat(r,"(\\s|$)")))}function mA(e){for(var r=e.childNodes,t=r.length,n=t-1;n>=0;n--)e.removeChild(r[n])}var gA=function(){function e(r){this.destroyed=!1,this.options=zg({},this.getDefaultOptions(),r),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}return e.prototype.getDefaultOptions=function(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}},e.prototype.getContainer=function(){return this.container},e.prototype.getParentContainer=function(){var r=this.options.parent,t;if(!r)return t;if(Vf(r)){var n=document.getElementById(r);if(n)t=n;else throw new Error("No parent id ".concat(r))}else t=r;return t},e.prototype.initContainer=function(){var r=this.createDom(this.options.containerTpl),t=this.getParentContainer();return t&&t.appendChild(r),r},e.prototype.initVisible=function(){this.options.visible?this.show():this.hide()},e.prototype.initCapture=function(){this.setCapture(this.options.capture)},e.prototype.update=function(r){this.options=zg({},this.options,r),this.updateInner(r),this.afterUpdate(r)},e.prototype.updateInner=function(r){r.domStyles&&this.applyStyles()},e.prototype.afterUpdate=function(r){r.capture&&this.setCapture(r.capture)},e.prototype.setCapture=function(r){var t=this.container,n=r?"auto":"none";t.style.pointerEvents=n},e.prototype.applyStyles=function(){var r=this.options.domStyles;if(!!r){var t=this.container;this.applyChildrenStyles(t,r);var n=this.options.className;if(n&&Xte(t,n)){var i=r[n];_h(t,i)}}},e.prototype.applyChildrenStyles=function(r,t){Bb(t,function(n,i){var a=r.getElementsByClassName(i);Bb(a,function(o){_h(o,n)})})},e.prototype.applyStyle=function(r,t){var n=this.options.domStyles;n&&_h(t,n[r])},e.prototype.createDom=function(r){return r===void 0&&(r="<div></div>"),Hte(r)},e.prototype.removeDom=function(){var r=this.container;r&&r.parentNode&&r.parentNode.removeChild(r)},e.prototype.destroy=function(){this.removeEvent(),this.removeDom(),this.destroyed=!0},e}(),Zte=function(e){qh(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}return r.prototype.getDefaultOptions=function(){return zg({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:Wte,itemTpl:ik,domStyles:$te,className:pA})},r.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(n),n}else return e.prototype.initContainer.call(this)},r.prototype.initDom=function(){this.cacheDoms()},r.prototype.initEvent=function(){},r.prototype.removeEvent=function(){},r.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(dA)[0],i=t.getElementsByClassName(vA)[0];this.titleDom=n,this.listDom=i},r.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},r.prototype.show=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"visible"})},r.prototype.hide=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"hidden"})},r.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),e.prototype.updateInner.call(this,t)},r.prototype.renderCustomContent=function(t){var n=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;n&&n.replaceChild(i,a),this.container=i,this.applyStyles()},r.prototype.getHtmlContentNode=function(t){var n,i=t(this.options.title||"",this.options.items);return Vf(i)?n=this.createDom(i):n=i,n},r.prototype.resetTitle=function(){var t=this.options.title,n=this.options.showTitle;n&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},r.prototype.showTitle=function(){var t=this.titleDom;t&&_h(t,{display:"block"})},r.prototype.hideTitle=function(){var t=this.titleDom;t&&_h(t,{display:"none"})},r.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},r.prototype.renderItems=function(){var t=this;this.clearItemDoms();var n=this.options.items,i=this.options.itemTpl||ik,a=this.listDom;a&&(n.forEach(function(o){var l=Vl({},o),c=fA(i,l),p=t.createDom(c);a.appendChild(p)}),this.applyChildrenStyles(a,this.options.domStyles))},r.prototype.clearItemDoms=function(){this.listDom&&mA(this.listDom)},r.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},r}(gA),yA="l7plot-legend l7plot-legend__category",_A="l7plot-legend__title",xA="l7plot-legend__category-list",o6="l7plot-legend__list-item",s6="l7plot-legend__category-marker",u6="l7plot-legend__category-value",Yte='<div class="'.concat(yA,`">
  <div class="`).concat(_A,`"></div>
  <ul class="`).concat(xA,`"></ul>
</div>`),ak='<li class="'.concat(o6,`" data-index={index}>
  <span class="`).concat(s6,`" style="background:{color}"></span>
  <span class="`).concat(u6,`">{value}</span>
</li>`),om;const qte=(om={},om[yA]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:hA.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},om[_A]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},om[xA]={margin:"0px",listStyleType:"none",padding:"0px"},om[o6]={listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},om[s6]={width:"10px",height:"10px"},om[u6]={paddingLeft:"8px"},om);var Kte=function(e){qh(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}return r.prototype.getDefaultOptions=function(){return zg({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:Yte,itemTpl:ak,domStyles:qte,className:yA})},r.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(n),n}else return e.prototype.initContainer.call(this)},r.prototype.initDom=function(){this.cacheDoms()},r.prototype.initEvent=function(){},r.prototype.removeEvent=function(){},r.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(_A)[0],i=t.getElementsByClassName(xA)[0];this.titleDom=n,this.listDom=i},r.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())},r.prototype.show=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"visible"})},r.prototype.hide=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"hidden"})},r.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),e.prototype.updateInner.call(this,t)},r.prototype.renderCustomContent=function(t){var n=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;n&&n.replaceChild(i,a),this.container=i,this.applyStyles()},r.prototype.getHtmlContentNode=function(t){var n,i=t(this.options.title||"",this.options.items);return Vf(i)?n=this.createDom(i):n=i,n},r.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},r.prototype.showTitle=function(){var t=this.titleDom;t&&_h(t,{display:"block"})},r.prototype.hideTitle=function(){var t=this.titleDom;t&&_h(t,{display:"none"})},r.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},r.prototype.renderItems=function(){var t=this;this.clearItemDoms();var n=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,i=this.options.itemTpl||ak,a=this.listDom;a&&(n.forEach(function(o){var l=o.value==="",c=l?"\u2014":Array.isArray(o.value)?o.value.join(" - "):o.value,p=Vl(Vl({},o),{value:c}),y=fA(i,p),b=t.createDom(y);a.appendChild(b)}),this.applyChildrenStyles(a,this.options.domStyles))},r.prototype.clearItemDoms=function(){this.listDom&&mA(this.listDom)},r.prototype.clear=function(){this.setTitle(""),this.clearItemDoms()},r}(gA),bA="l7plot-legend l7plot-legend__continue",EA="l7plot-legend__title",l6="l7plot-legend__ribbon-container",c6="l7plot-legend__ribbon",f6="l7plot-legend__gradient-bar",RS="l7plot-legend__value-range",Qte='<div class="'.concat(bA,`">
  <div class="`).concat(EA,`"></div>
  <div class="`).concat(l6,`"></div>
</div>`),ok='<div class="'.concat(c6,`">
  <span class="`).concat(RS,`">{min}</span>
  <div class="`).concat(f6,`" style="background-image: {backgroundImage}"></div>
  <span class="`).concat(RS,`">{max}</span>
</div>`),pg;const Jte=(pg={},pg[bA]={visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:hA.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},pg[EA]={fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},pg[c6]={display:"flex",alignItems:"center"},pg[f6]={width:"140px",height:"14px",margin:"0px 5px"},pg[RS]={padding:"0px"},pg);var ere=function(e){qh(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}return r.prototype.getDefaultOptions=function(){return zg({},e.prototype.getDefaultOptions.call(this),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:Qte,ribbonTpl:ok,domStyles:Jte,className:bA})},r.prototype.initContainer=function(){var t=this.options.customContent;if(t){var n=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(n),n}else return e.prototype.initContainer.call(this)},r.prototype.initDom=function(){this.cacheDoms()},r.prototype.initEvent=function(){},r.prototype.removeEvent=function(){},r.prototype.cacheDoms=function(){var t=this.container,n=t.getElementsByClassName(EA)[0],i=t.getElementsByClassName(l6)[0];this.titleDom=n,this.ribbonContainerDom=i},r.prototype.render=function(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())},r.prototype.show=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"visible"})},r.prototype.hide=function(){var t=this.container;!t||this.destroyed||_h(t,{visibility:"hidden"})},r.prototype.updateInner=function(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),e.prototype.updateInner.call(this,t)},r.prototype.renderCustomContent=function(t){var n=this.container.parentNode,i=this.getHtmlContentNode(t),a=this.container;n&&n.replaceChild(i,a),this.container=i,this.applyStyles()},r.prototype.getHtmlContentNode=function(t){var n,i=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return Vf(i)?n=this.createDom(i):n=i,n},r.prototype.resetTitle=function(){var t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()},r.prototype.showTitle=function(){var t=this.titleDom;t&&_h(t,{display:"block"})},r.prototype.hideTitle=function(){var t=this.titleDom;t&&_h(t,{display:"none"})},r.prototype.setTitle=function(t){var n=this.titleDom;n&&(n.innerHTML=t)},r.prototype.renderRibbon=function(){this.clearRibbonContainerDoms();var t=this.options,n=t.min,i=t.max,a=t.colors,o=t.ribbonTpl,l=o===void 0?ok:o,c=this.ribbonContainerDom;if(c){var p="linear-gradient(to right, ".concat(a.join(", "),")"),y={min:n,max:i,backgroundImage:p},b=fA(l,y),w=this.createDom(b);c.appendChild(w),this.applyChildrenStyles(c,this.options.domStyles)}},r.prototype.clearRibbonContainerDoms=function(){this.ribbonContainerDom&&mA(this.ribbonContainerDom)},r.prototype.clear=function(){this.setTitle(""),this.clearRibbonContainerDoms()},r}(gA),tre=typeof global=="object"&&global&&global.Object===Object&&global;const rre=tre;var nre=typeof self=="object"&&self&&self.Object===Object&&self,ire=rre||nre||Function("return this")();const E2=ire;var are=E2.Symbol;const n_=are;var h6=Object.prototype,ore=h6.hasOwnProperty,sre=h6.toString,W_=n_?n_.toStringTag:void 0;function ure(e){var r=ore.call(e,W_),t=e[W_];try{e[W_]=void 0;var n=!0}catch{}var i=sre.call(e);return n&&(r?e[W_]=t:delete e[W_]),i}var lre=Object.prototype,cre=lre.toString;function fre(e){return cre.call(e)}var hre="[object Null]",pre="[object Undefined]",sk=n_?n_.toStringTag:void 0;function p6(e){return e==null?e===void 0?pre:hre:sk&&sk in Object(e)?ure(e):fre(e)}function dre(e){return e!=null&&typeof e=="object"}var vre="[object Symbol]";function C2(e){return typeof e=="symbol"||dre(e)&&p6(e)==vre}function mre(e,r){for(var t=-1,n=e==null?0:e.length,i=Array(n);++t<n;)i[t]=r(e[t],t,e);return i}var gre=Array.isArray;const CA=gre;var yre=1/0,uk=n_?n_.prototype:void 0,lk=uk?uk.toString:void 0;function d6(e){if(typeof e=="string")return e;if(CA(e))return mre(e,d6)+"";if(C2(e))return lk?lk.call(e):"";var r=e+"";return r=="0"&&1/e==-yre?"-0":r}var _re=/\s/;function xre(e){for(var r=e.length;r--&&_re.test(e.charAt(r)););return r}var bre=/^\s+/;function Ere(e){return e&&e.slice(0,xre(e)+1).replace(bre,"")}function Nb(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var ck=0/0,Cre=/^[-+]0x[0-9a-f]+$/i,Sre=/^0b[01]+$/i,wre=/^0o[0-7]+$/i,Are=parseInt;function v6(e){if(typeof e=="number")return e;if(C2(e))return ck;if(Nb(e)){var r=typeof e.valueOf=="function"?e.valueOf():e;e=Nb(r)?r+"":r}if(typeof e!="string")return e===0?e:+e;e=Ere(e);var t=Sre.test(e);return t||wre.test(e)?Are(e.slice(2),t?2:8):Cre.test(e)?ck:+e}var fk=1/0,Tre=17976931348623157e292;function Mre(e){if(!e)return e===0?e:0;if(e=v6(e),e===fk||e===-fk){var r=e<0?-1:1;return r*Tre}return e===e?e:0}function Ire(e){var r=Mre(e),t=r%1;return r===r?t?r-t:r:0}var Lre="[object AsyncFunction]",kre="[object Function]",Rre="[object GeneratorFunction]",Ore="[object Proxy]";function Pre(e){if(!Nb(e))return!1;var r=p6(e);return r==kre||r==Rre||r==Lre||r==Ore}var Fre=E2["__core-js_shared__"];const KE=Fre;var hk=function(){var e=/[^.]+$/.exec(KE&&KE.keys&&KE.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Dre(e){return!!hk&&hk in e}var Bre=Function.prototype,Nre=Bre.toString;function zre(e){if(e!=null){try{return Nre.call(e)}catch{}try{return e+""}catch{}}return""}var Ure=/[\\^$.*+?()[\]{}|]/g,Vre=/^\[object .+?Constructor\]$/,Gre=Function.prototype,jre=Object.prototype,Hre=Gre.toString,Wre=jre.hasOwnProperty,$re=RegExp("^"+Hre.call(Wre).replace(Ure,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xre(e){if(!Nb(e)||Dre(e))return!1;var r=Pre(e)?$re:Vre;return r.test(zre(e))}function Zre(e,r){return e==null?void 0:e[r]}function m6(e,r){var t=Zre(e,r);return Xre(t)?t:void 0}function Yre(e,r){return e===r||e!==e&&r!==r}var qre=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kre=/^\w*$/;function Qre(e,r){if(CA(e))return!1;var t=typeof e;return t=="number"||t=="symbol"||t=="boolean"||e==null||C2(e)?!0:Kre.test(e)||!qre.test(e)||r!=null&&e in Object(r)}var Jre=m6(Object,"create");const X1=Jre;function ene(){this.__data__=X1?X1(null):{},this.size=0}function tne(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var rne="__lodash_hash_undefined__",nne=Object.prototype,ine=nne.hasOwnProperty;function ane(e){var r=this.__data__;if(X1){var t=r[e];return t===rne?void 0:t}return ine.call(r,e)?r[e]:void 0}var one=Object.prototype,sne=one.hasOwnProperty;function une(e){var r=this.__data__;return X1?r[e]!==void 0:sne.call(r,e)}var lne="__lodash_hash_undefined__";function cne(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=X1&&r===void 0?lne:r,this}function Ug(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Ug.prototype.clear=ene;Ug.prototype.delete=tne;Ug.prototype.get=ane;Ug.prototype.has=une;Ug.prototype.set=cne;function fne(){this.__data__=[],this.size=0}function S2(e,r){for(var t=e.length;t--;)if(Yre(e[t][0],r))return t;return-1}var hne=Array.prototype,pne=hne.splice;function dne(e){var r=this.__data__,t=S2(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():pne.call(r,t,1),--this.size,!0}function vne(e){var r=this.__data__,t=S2(r,e);return t<0?void 0:r[t][1]}function mne(e){return S2(this.__data__,e)>-1}function gne(e,r){var t=this.__data__,n=S2(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function h_(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}h_.prototype.clear=fne;h_.prototype.delete=dne;h_.prototype.get=vne;h_.prototype.has=mne;h_.prototype.set=gne;var yne=m6(E2,"Map");const _ne=yne;function xne(){this.size=0,this.__data__={hash:new Ug,map:new(_ne||h_),string:new Ug}}function bne(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function w2(e,r){var t=e.__data__;return bne(r)?t[typeof r=="string"?"string":"hash"]:t.map}function Ene(e){var r=w2(this,e).delete(e);return this.size-=r?1:0,r}function Cne(e){return w2(this,e).get(e)}function Sne(e){return w2(this,e).has(e)}function wne(e,r){var t=w2(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function Xg(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Xg.prototype.clear=xne;Xg.prototype.delete=Ene;Xg.prototype.get=Cne;Xg.prototype.has=Sne;Xg.prototype.set=wne;var Ane="Expected a function";function SA(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError(Ane);var t=function(){var n=arguments,i=r?r.apply(this,n):n[0],a=t.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return t.cache=a.set(i,o)||a,o};return t.cache=new(SA.Cache||Xg),t}SA.Cache=Xg;var Tne=500;function Mne(e){var r=SA(e,function(n){return t.size===Tne&&t.clear(),n}),t=r.cache;return r}var Ine=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lne=/\\(\\)?/g,kne=Mne(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Ine,function(t,n,i,a){r.push(i?a.replace(Lne,"$1"):n||t)}),r});const Rne=kne;function OS(e){return e==null?"":d6(e)}function One(e,r){return CA(e)?e:Qre(e,r)?[e]:Rne(OS(e))}var Pne=1/0;function Fne(e){if(typeof e=="string"||C2(e))return e;var r=e+"";return r=="0"&&1/e==-Pne?"-0":r}function Dne(e,r){r=One(r,e);for(var t=0,n=r.length;e!=null&&t<n;)e=e[Fne(r[t++])];return t&&t==n?e:void 0}function pk(e,r,t){var n=e==null?void 0:Dne(e,r);return n===void 0?t:n}var Bne=E2.isFinite,Nne=Math.min;function zne(e){var r=Math[e];return function(t,n){if(t=v6(t),n=n==null?0:Nne(Ire(n),292),n&&Bne(t)){var i=(OS(t)+"e").split("e"),a=r(i[0]+"e"+(+i[1]+n));return i=(OS(a)+"e").split("e"),+(i[0]+"e"+(+i[1]-n))}return r(t)}}var Une=zne("round");const dk=Une;var Vne=5,Gne=new Object().toString,g6=function(e,r){return Gne.call(e)==="[object "+r+"]"},jne=function(e){return g6(e,"Array")},Hne=function(e){return typeof e=="object"&&e!==null},vk=function(e){if(!Hne(e)||!g6(e,"Object"))return!1;for(var r=e;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r},y6=function(e,r,t,n){t=t||0,n=n||Vne;for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){var a=r[i];a?vk(a)?(vk(e[i])||(e[i]={}),t<n?y6(e[i],a,t+1,n):e[i]=r[i]):jne(a)?(e[i]=[],e[i]=e[i].concat(a)):e[i]=a:e[i]=a}},vl=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];for(var n=0;n<r.length;n+=1)y6(e,r[n]);return e},Wne=["mousemove","click"],$ne=function(e){qh(r,e);function r(t,n,i){var a=e.call(this)||this;a.currentVisible=!1,a.interactionTriggerHander=function(O){var N=O.feature,z=O.featureId,j=a.options,Y=j.title,K=j.customTitle,ie=j.items,le=j.customItems,Se=N.type==="Feature"&&N.geometry&&N.properties,ze=Se?N.properties:N,ue=[];if(le){var Ke=le(N);if(Array.isArray(Ke))ue=Ke;else throw new Error("customItems return array")}else ie&&ie.forEach(function(Ce){if(Vf(Ce)){var je=Ce.split(".").pop()||Ce,ve=pk(ze,Ce);ve!==void 0&&ue.push({name:je,value:ve})}else{var Ie=Ce.field,dt=Ce.alias,St=Ce.customValue,Rt=dt||Ie.split(".").pop()||Ie,ve=pk(ze,Ie);ve!==void 0&&ue.push({name:Rt,value:St?St(ve,ze,z):ve})}});var ke={title:K?K(ze):Y,items:ue};a.updateTooltip(O,ke)},a.interactionUntriggerHander=function(){a.hideTooltip()},a.scene=t,a.interactionLayers=n,a.options=vl({},a.getDefaultOptions(),i);var o=a.options,l=o.offsets,c=o.title,p=o.showTitle,y=o.customContent,b=o.domStyles,w=o.anchor,M=o.className;return a.marker=new V4({offsets:l,anchor:w,draggable:!1}),a.tooltipComponent=new Zte({title:c,showTitle:p,items:[],customContent:y,domStyles:b,className:M}),a.setComponent(),a.initInteractionEvent(),a}return r.prototype.getDefaultOptions=function(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:db["TOP-LEFT"]}},r.prototype.update=function(t){this.marker.remove(),this.currentVisible=!1,this.options=vl({},this.options,t);var n=this.options,i=n.offsets,a=n.showTitle,o=n.customContent,l=n.domStyles,c=n.anchor,p=n.className;this.marker=new V4({offsets:i,anchor:c,draggable:!1}),this.tooltipComponent.update({showTitle:a,customContent:o,domStyles:l,className:p}),this.setComponent()},r.prototype.initInteractionEvent=function(){var t=this,n=this.options.trigger||"mousemove";if(!Wne.includes(n))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(function(i){var a=i.layer;a.on(n,t.interactionTriggerHander),a.on("un".concat(n),t.interactionUntriggerHander)})},r.prototype.unBindInteractionEvent=function(){var t=this,n=this.options.trigger||"mousemove";this.interactionLayers.forEach(function(i){var a=i.layer;a.off(n,t.interactionTriggerHander),a.off("un".concat(n),t.interactionUntriggerHander)})},r.prototype.updateTooltip=function(t,n){var i=t.lngLat,a=t.x,o=t.y;if(this.options.showComponent&&(this.updateComponent(n),this.setPostion(i)),this.currentVisible){var l={type:"tooltip:change",data:n,lngLat:i,x:a,y:o};this.emit("tooltip:change",l)}else{this.showTooltip();var c={type:"tooltip:show",data:n,lngLat:i,x:a,y:o};this.emit("tooltip:show",c)}},r.prototype.showTooltip=function(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)},r.prototype.hideTooltip=function(){if(!!this.currentVisible){this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;var t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}},r.prototype.updateComponent=function(t){gl(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)},r.prototype.setComponent=function(){var t=this.tooltipComponent.getContainer(),n=window.document.createElement("div");n.style.cursor="auto",n.style.userSelect="text",n.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(i){n.addEventListener(i,function(a){return a.stopPropagation()})}),n.appendChild(t),this.marker.setElement(n)},r.prototype.setPostion=function(t){this.marker.setLnglat(t)},r.prototype.destroy=function(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()},r}(b2),Xne=function(e){qh(r,e);function r(t){var n=e.call(this,t)||this;return n.legendComponents=[],n.options=t,n.legendComponents=n.initLegendComponents(t.items),n}return r.prototype.initLegendComponents=function(t){for(var n=[],i=0;i<t.length;i++){var a=t[i];if(a.type==="category"){var o=new Kte({title:a.options.title,items:a.options.items,className:a.options.className,customContent:a.options.customContent,domStyles:a.options.domStyles});n.push(o)}else if(a.type==="continue"){var o=new ere({title:a.options.title,min:a.options.min,max:a.options.max,colors:a.options.colors,className:a.options.className,customContent:a.options.customContent,domStyles:a.options.domStyles});n.push(o)}}return n},r.prototype.getDefaultOptions=function(){return{position:"bottomleft"}},r.prototype.onAdd=function(){var t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(function(n){var i=n.getContainer();t.appendChild(i)}),t},r.prototype.onRemove=function(){this.legendComponents.forEach(function(t){t.destroy()})},r}(Q1),_6=function(e){qh(r,e);function r(t,n){t===void 0&&(t=[]),n===void 0&&(n={});var i=e.call(this)||this;return i.name=n.name?n.name:x2("layerGroup"),i.layers=t,i}return r.prototype.addTo=function(t){var n=this;this.scene=t;var i=0,a=this.layers.length;this.layers.forEach(function(o){o.once("inited",function(l){i++,n.emit("inited",l),i===a&&n.emit("inited-all")}),o.addTo(t)})},r.prototype.hasLayer=function(t){return this.layers.some(function(n){return n===t})},r.prototype.addLayer=function(t){var n=this;this.layers.push(t),this.scene&&(t.once("inited",function(i){return n.emit("inited",i)}),t.addTo(this.scene))},r.prototype.removeLayer=function(t){var n=this.layers.findIndex(function(i){return i===t});return n===-1?!1:(this.layers.splice(n,1),this.scene&&t.remove(this.scene),!0)},r.prototype.getLayers=function(){return this.layers},r.prototype.getInteractionLayers=function(){return this.layers.filter(function(t){var n=t.interaction;return n})},r.prototype.getLayer=function(t){return this.layers.find(function(n){var i=n.layer;return i.id===t})},r.prototype.getLayerByName=function(t){return this.layers.find(function(n){return n.name===t})},r.prototype.removeAllLayer=function(){var t=this;this.layers.forEach(function(n){t.scene&&n.remove(t.scene)}),this.layers=[]},r.prototype.isEmpty=function(){return this.layers.length===0},r}(b2),Zne=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],Yne=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],ib=["inited","add","remove","dataUpdate","click","unclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick"],mk={map:{type:Gy.Amap},logo:!0},qne=function(e){qh(r,e);function r(t){var n=e.call(this)||this;return n.inited=!1,n.sceneLoaded=!1,n.layersLoaded=!1,n.loaded=!1,n.layerGroup=new _6,n.options=vl({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return r.prototype.getDefaultOptions=function(){return r.DefaultOptions},r.prototype.createContainer=function(t){var n=this.options,i=n.width,a=n.height,o=typeof t=="string"?document.getElementById(t):t;return o.style.position||(o.style.position="relative"),i&&(o.style.width||(o.style.width="".concat(i,"px"))),a&&(o.style.height||(o.style.height="".concat(a,"px"))),o},r.prototype.createTheme=function(){var t=Oy(this.options.theme)?vl({},MS("default"),t6(this.options.theme)):MS(this.options.theme);return t},r.prototype.createMap=function(){var t=this.options.map?this.options.map:mk.map,n=t.type,i=Rp(t,["type"]),a=Object.assign({style:this.theme.mapStyle},i);return n===Gy.Amap?new o$(a):new lP(a)},r.prototype.createScene=function(){var t=this.options,n=t.logo,i=t.antialias,a=t.preserveDrawingBuffer,o=YF(n)?{logoVisible:n}:{logoVisible:n==null?void 0:n.visible,logoPosition:n==null?void 0:n.position},l=Object.assign({antialias:i,preserveDrawingBuffer:a},o),c=this.createMap(),p=new ZF(Vl({id:this.container,map:c},l));return p},r.prototype.registerResources=function(){var t=this;qL.size&&qL.forEach(function(n,i){!t.scene.hasImage(i)&&t.scene.addImage(i,n)}),KL.size&&KL.forEach(function(n,i){t.scene.addFontFace(i,n)}),QL.size&&QL.forEach(function(n,i){t.scene.addIconFont(i,n)})},r.prototype.update=function(t){this.updateOption(t),t.map&&!gl(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")},r.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=vl({},this.options,t)},r.prototype.updateMap=function(t){var n;if(!!this.scene){var i=t.style,a=t.center,o=t.zoom,l=t.rotation,c=t.pitch;Dv(c)||this.scene.setPitch(c),Dv(l)||this.scene.setRotation(l),i&&i!==((n=this.lastOptions.map)===null||n===void 0?void 0:n.style)&&this.scene.setMapStyle(i),o&&a&&this.scene.setZoomAndCenter(o,a)}},r.prototype.changeSize=function(t,n){this.options.width===t&&this.options.height===n||(this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(n,"px"),this.options=Object.assign(this.options,{width:t,height:n}))},r.prototype.on=function(t,n){return this.proxyEventHander("on",t,n),this},r.prototype.once=function(t,n){return this.proxyEventHander("once",t,n),this},r.prototype.off=function(t,n){return this.proxyEventHander("off",t,n),this},r.prototype.proxyEventHander=function(t,n,i){var a=Zne.find(function(y){return y.adaptation===n});if(a)this.scene[t](a.original,i);else if(Yne.indexOf(n)!==-1)this.scene[t](n,i);else if(n.includes("Layer:")){var o=KF(n.split(":"),2),l=o[0],c=o[1],p=this[l]&&this[l][t];if(p&&ib.indexOf(c)!==-1)this[l][t](c,i);else throw new Error('No event name "'.concat(n,'"'))}else e.prototype[t].call(this,n,i)},r.prototype.getScene=function(){return this.scene},r.prototype.getMap=function(){var t,n;return((t=this.options.map)===null||t===void 0?void 0:t.type)===Gy.Amap?this.scene.map:((n=this.options.map)===null||n===void 0?void 0:n.type)===Gy.Mapbox?this.scene.map:this.scene.map},r.prototype.addLayer=function(t){this.layerGroup.addLayer(t)},r.prototype.getLayes=function(){return console.warn("Replace to use getLayers()"),this.getLayers()},r.prototype.getLayers=function(){return this.layerGroup.getLayers()},r.prototype.getLayerByName=function(t){return this.layerGroup.getLayerByName(t)},r.prototype.removeLayer=function(t){return this.layerGroup.removeLayer(t)},r.prototype.removeAllLayer=function(){this.layerGroup.removeAllLayer()},r.prototype.zoomIn=function(){this.scene.zoomIn()},r.prototype.zoomOut=function(){this.scene.zoomOut()},r.prototype.setPitch=function(t){this.scene.setPitch(t)},r.prototype.fitBounds=function(t){this.scene.fitBounds(t)},r.prototype.setMapStatus=function(t){this.scene.setMapStatus(t)},r.prototype.setBgColor=function(t){this.scene.setBgColor(t)},r.prototype.initComponents=function(){this.initControls(),this.initTooltip()},r.prototype.updateComponents=function(){this.updateControls(),this.initTooltip()},r.prototype.initControls=function(){var t=this.options,n=t.zoom,i=t.scale,a=t.layerMenu,o=t.legend;i&&this.addScaleControl(i),n&&this.addZoomControl(n),a&&this.addLayerMenuControl(a),o&&this.addLegendControl(o)},r.prototype.updateControls=function(){var t=this.options,n=t.zoom,i=t.scale,a=t.layerMenu,o=t.legend;gl(this.lastOptions.zoom,n)||(n?this.updateZoomControl(n):this.removeZoomControl()),gl(this.lastOptions.scale,i)||(i?this.updateScaleControl(i):this.removeScaleControl()),gl(this.lastOptions.layerMenu,a)||(a?this.updateLayerMenuControl(a):this.removeLayerMenuControl()),gl(this.lastOptions.legend,o)||(o?this.updateLegendControl(o):this.removeLegendControl())},r.prototype.addZoomControl=function(t){this.zoomControl||(this.zoomControl=new jW(t),this.scene.addControl(this.zoomControl))},r.prototype.updateZoomControl=function(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)},r.prototype.removeZoomControl=function(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)},r.prototype.addScaleControl=function(t){this.scaleControl||(this.scaleControl=new UW(t),this.scene.addControl(this.scaleControl))},r.prototype.updateScaleControl=function(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)},r.prototype.removeScaleControl=function(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)},r.prototype.addLayerMenuControl=function(t){if(!this.layerMenuControl){var n={},i={};this.layerGroup.getLayers().forEach(function(a){var o=a.name,l=a.layer;i[o]=l}),this.layerMenuControl=new PW(Object.assign({},t,{baseLayers:n,overlayers:i})),this.scene.addControl(this.layerMenuControl)}},r.prototype.updateLayerMenuControl=function(t){if(!this.layerMenuControl){this.addLayerMenuControl(t);return}this.removeLayerMenuControl(),this.addLayerMenuControl(t)},r.prototype.removeLayerMenuControl=function(){this.layerMenuControl&&(this.layerMenuControl.remove(),this.layerMenuControl=void 0)},r.prototype.getLegendOptions=function(){return{}},r.prototype.addLegendControl=function(t){if(!this.legendControl){var n=this.theme.components.legend,i=vl({},this.getLegendOptions(),t),a=i.type,o=i.position,l=Rp(i,["type","position"]),c=[];if(a==="category"){var p=vl({},{domStyles:n.category.domStyles},l);c.push({type:a,options:p})}else if(a==="continue"){var y=vl({},{domStyles:n.continue.domStyles},l);c.push({type:a,options:y})}c.length&&(this.legendControl=new Xne({position:o,items:c}),this.scene.addControl(this.legendControl))}},r.prototype.updateLegendControl=function(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)},r.prototype.removeLegendControl=function(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)},r.prototype.initTooltip=function(){var t=this;this.tooltip&&this.tooltip.destroy();var n=this.options.tooltip;if(n){var i=vl({},{domStyles:this.theme.components.tooltip.domStyles},n),a=this.layerGroup.getInteractionLayers();this.tooltip=new $ne(this.scene,a,i),this.tooltip.on("*",function(o){return t.emit(o.type,o)})}},r.prototype.exportPng=function(t){return this.scene.exportPng(t)},r.prototype.destroy=function(){var t;e.prototype.off.call(this,"*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()},r.DefaultOptions=mk,r}(b2),PS=function(){function e(){}return e.aggregation=function(r,t){var n=t.type,i=n===void 0?"grid":n,a=t.radius,o=t.method,l=t.field,c={type:i,size:a,method:o,field:l};r.transforms?(r.transforms=r.transforms.filter(function(p){return p.type!==c.type}),r.transforms.push(c)):r.transforms=[c]},e}(),gk=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"],S0=function(e){qh(r,e);function r(t){var n=e.call(this)||this;return n.options=vl({},n.getDefaultOptions(),t),n.lastOptions=n.options,n}return r.prototype.getDefaultOptions=function(){return{}},r.prototype.pickLayerConfig=function(t){var n=h1(t,gk);return n},r.prototype.addTo=function(t){t.addLayer(this.layer)},r.prototype.remove=function(t){t.removeLayer(this.layer)},r.prototype.update=function(t){this.updateOption(t),this.updateConfig(t)},r.prototype.updateOption=function(t){this.lastOptions=this.options,this.options=vl({},this.options,t)},r.prototype.updateConfig=function(t){!Dv(t.zIndex)&&!gl(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!Dv(t.blend)&&!gl(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!Dv(t.minZoom)&&!gl(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!Dv(t.maxZoom)&&!gl(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!Dv(t.visible)&&!gl(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())},r.prototype.render=function(){this.layer.renderLayers()},r.prototype.setSource=function(t){if(t instanceof Mm)this.layer.setSource(t);else{var n=t.data,i=t.aggregation,a=Rp(t,["data","aggregation"]);i&&PS.aggregation(a,i);var o=this.layer.getSource();o?this.layer.setData(n,a):this.layer.source(n,a)}},r.prototype.changeData=function(t){this.setSource(t)},r.prototype.setIndex=function(t){this.layer.setIndex(t)},r.prototype.setBlend=function(t){this.layer.setBlend(t)},r.prototype.setMinZoom=function(t){this.layer.setMinZoom(t)},r.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t)},r.prototype.show=function(){this.layer.inited&&this.layer.show()},r.prototype.hide=function(){this.layer.inited&&this.layer.hide()},r.prototype.toggleVisible=function(){this.isVisible()?this.hide():this.show()},r.prototype.isVisible=function(){return this.layer.inited?this.layer.isVisible():this.options.visible},r.prototype.fitBounds=function(t){this.layer.fitBounds(t)},r.prototype.on=function(t,n){return ib.indexOf(t)!==-1?this.layer.on(t,n):e.prototype.on.call(this,t,n),this},r.prototype.once=function(t,n){return ib.indexOf(t)!==-1?this.layer.once(t,n):e.prototype.once.call(this,t,n),this},r.prototype.off=function(t,n){return ib.indexOf(t)!==-1?this.layer.off(t,n):e.prototype.off.call(this,t,n),this},r.LayerType=IS,r.LayerConfigkeys=gk,r}(b2);function dg(e,r){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i={};return e.forEach(function(a,o){i[a]=t[o]}),delete i.undefined,r(i)}}var Go=function(){function e(){}return e.shape=function(r,t){if(Vf(t))r.shape(t);else if(g0(t)){var n=[];r.shape(n.join("*"),dg(n,t))}else if(Oy(t)){var i=t.field?t.field:"";if(g0(t.value)){var n=hm(i)?i:i.split("*");r.shape(i,dg(n,t.value))}else r.shape(i,t.value);Vf(i)&&t.scale&&e.scale(r,i,t.scale)}},e.size=function(r,t){if(Ste(t))r.size(t);else if(hm(t))r.size(t);else if(g0(t)){var n=[];r.size(n.join("*"),dg(n,t))}else if(Oy(t)){var i=t.field?t.field:"";if(g0(t.value)){var n=hm(i)?i:i.split("*");r.size(i,dg(n,t.value))}else r.size(i,t.value);Vf(i)&&t.scale&&e.scale(r,i,t.scale)}},e.color=function(r,t){if(Vf(t))r.color(t);else if(g0(t)){var n=[];r.color(n.join("*"),dg(n,t))}else if(Oy(t)){var i=t.field?t.field:"";if(g0(t.value)){var n=hm(i)?i:i.split("*");r.color(i,dg(n,t.value))}else r.color(i,t.value);Vf(i)&&t.scale&&e.scale(r,i,t.scale)}},e.style=function(r,t){t&&r.style(t)},e.state=function(r,t){var n=t.active,i=t.select;n&&r.active(n),i&&r.select(i)},e.rotate=function(r,t){Vf(t)||g0(t)},e.texture=function(r,t){Vf(t)&&r.texture(t)},e.animate=function(r,t){(YF(t)||Oy(t))&&r.animate(t)},e.scale=function(r,t,n){r.scale(t,n)},e.filter=function(r,t){var n=t.field?t.field:"",i=hm(n)?n:n.split("*");r.filter(i.join("*"),dg(i,t.value))},e}();function Kne(e,r){var t=r.field,n=r.content,i=r.style,a=i===void 0?{}:i,o=r.state,l=a.fontSize,c=a.fill,p=t||n||"",y={field:p,value:"text"};Go.shape(e,y),l&&Go.size(e,l),c&&Go.color(e,c),a&&Go.style(e,a),o&&Go.state(e,o)}var yk={style:{fontSize:12}},Qne=[],x6=function(e){qh(r,e);function r(t){var n=e.call(this,t)||this;n.type=S0.LayerType.TextLayer,n.interaction=!1;var i=n.options,a=i.name,o=i.source,l=n.pickLayerConfig(n.options);return n.name=a||x2(n.type),n.layer=new cK(Vl(Vl({},l),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return r.prototype.getDefaultOptions=function(){return yk},r.prototype.mappingLayer=function(t,n){Kne(t,n)},r.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},r.DefaultOptions=yk,r.LayerOptionsKeys=S0.LayerConfigkeys.concat(Qne),r}(S0),Jne={autoFit:!1},FS=function(e){qh(r,e);function r(t,n){var i=this;if(typeof t=="string"||t instanceof Element){if(n===void 0)throw new Error("options is undefined");i=e.call(this,n)||this,i.container=i.createContainer(t),i.theme=i.createTheme(),i.scene=i.createScene(),i.registerResources(),i.initSource()}else i=e.call(this,t)||this;return i}return r.prototype.initSource=function(){this.source=this.createSource(),this.render(),this.inited=!0},r.prototype.initLayersEvent=function(){},r.prototype.getDefaultOptions=function(){return r.DefaultOptions},r.prototype.createSource=function(){var t=this.options.source,n=t.data,i=t.aggregation,a=Rp(t,["data","aggregation"]);i&&PS.aggregation(a,i);var o=new Mm(n,a);return o},r.prototype.createLabelLayer=function(t,n,i){var a=i||{},o=a.visible,l=a.minZoom,c=a.maxZoom,p=a.zIndex,y=p===void 0?0:p,b=new x6(Vl({name:"labelLayer",visible:o,minZoom:l,maxZoom:c,zIndex:y+.1,source:t},n));return b},r.prototype.updateLabelLayer=function(t,n,i,a){n?a?a.update(Vl({},n)):(a=this.createLabelLayer(t,n,i),this.layerGroup.addLayer(a)):n===!1&&a&&this.layerGroup.removeLayer(a)},r.prototype.render=function(){var t=this,n=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),n.addTo(this.scene),this.layerGroup=n):(this.layerGroup=n,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",function(){t.onSceneLoaded()})),this.initLayersEvent()},r.prototype.onSceneLoaded=function(){var t=this;this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",function(){t.onLayersLoaded()}),this.layerGroup.addTo(this.scene)},r.prototype.onLayersLoaded=function(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")},r.prototype.attachToScene=function(t,n){this.scene=t,this.theme=n||MS("default"),this.registerResources(),this.initSource()},r.prototype.unattachFromScene=function(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()},r.prototype.addToScene=function(t){this.attachToScene(t)},r.prototype.removeFromScene=function(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()},r.prototype.update=function(t){if(this.updateOption(t),t.map&&!gl(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!gl(this.lastOptions.source,this.options.source)){var n=t.source,i=n.data,a=Rp(n,["data"]);this.changeData(i,a)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")},r.prototype.changeData=function(t,n){var i=this;this.options.source=vl({},this.options.source,Vl({data:t},n));var a=this.options.source,o=a.aggregation,l=Rp(a,["aggregation"]);o&&PS.aggregation(l,o),this.source.setData(this.options.source.data,l);var c=this.options.legend;c&&setTimeout(function(){i.updateLegendControl(c)}),this.emit("change-data")},r.DefaultOptions=Jne,r.PlotType=LS,r}(qne),eie=function(e){return!Array.isArray(e[0].value)},b6=function(e){if(eie(e))return e;var r=e.map(function(t){return Vl(Vl({},t),{value:[dk(t.value[0],2),dk(t.value[1],2)]})});return r};function tie(e,r){var t=r.shape,n=r.color,i=r.size,a=r.style,o=r.state,l=r.animate,c=r.texture;t&&Go.shape(e,t),i&&Go.size(e,i),n&&Go.color(e,n),a&&Go.style(e,a),o&&Go.state(e,o),l&&Go.animate(e,l),c&&Go.texture(e,c)}var _k={},rie=["shape","color","size","style","state","animate"],jx=function(e){qh(r,e);function r(t){var n=e.call(this,t)||this;n.type=S0.LayerType.LinesLayer,n.interaction=!0;var i=n.options,a=i.name,o=i.source,l=n.pickLayerConfig(n.options);return n.name=a||x2(n.type),n.layer=new eb(Vl(Vl({},l),{name:n.name})),n.mappingLayer(n.layer,n.options),n.setSource(o),n}return r.prototype.getDefaultOptions=function(){return _k},r.prototype.mappingLayer=function(t,n){tie(t,n)},r.prototype.update=function(t){e.prototype.update.call(this,t),this.mappingLayer(this.layer,this.options)},r.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");if(Array.isArray(t)&&t.length!==0){var n=b6(t);return n}return[]},r.DefaultOptions=_k,r.LayerOptionsKeys=S0.LayerConfigkeys.concat(rie),r}(S0),nie=["color","size","style","state","animate"],QE=function(e){qh(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=jx.LayerType.PathLayer,t}return r.prototype.getDefaultOptions=function(){return vl({},jx.DefaultOptions,{shape:"line"})},r.LayerOptionsKeys=jx.LayerConfigkeys.concat(nie),r}(jx),xk="#2f54eb",Mc={active:{fill:!1,stroke:xk,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:xk,lineWidth:1.5,lineOpacity:.8}},r1=function(e){return Dv(e)||(e.active===!1?Mc.active=Object.assign(Mc.active,{fill:!1,stroke:!1}):typeof e.active=="object"&&(e.active.fill===!1?Mc.active.fill=!1:typeof e.active.fill=="string"&&(Mc.active.fill=e.active.fill),e.active.stroke===!1?Mc.active.stroke=!1:typeof e.active.stroke=="string"&&(Mc.active.stroke=e.active.stroke),typeof e.active.lineWidth=="number"&&(Mc.active.lineWidth=e.active.lineWidth),typeof e.active.lineOpacity=="number"&&(Mc.active.lineOpacity=e.active.lineOpacity)),e.select===!1?Mc.select=Object.assign(Mc.select,{fill:!1,stroke:!1}):typeof e.select=="object"&&(e.select.fill===!1?Mc.select.fill=!1:typeof e.select.fill=="string"&&(Mc.select.fill=e.select.fill),e.select.stroke===!1?Mc.select.stroke=!1:typeof e.select.stroke=="string"&&(Mc.select.stroke=e.select.stroke),typeof e.select.lineWidth=="number"&&(Mc.select.lineWidth=e.select.lineWidth),typeof e.select.lineOpacity=="number"&&(Mc.select.lineOpacity=e.select.lineOpacity))),Mc};function iie(e,r,t,n,i,a){var o=a.color,l=a.style,c=a.state,p=r1(c),y={active:p.active.fill===!1?!1:{color:p.active.fill},select:!1},b={opacity:l==null?void 0:l.opacity},w=l==null?void 0:l.fillBottomColor,M=l==null?void 0:l.lineWidth,O=l==null?void 0:l.stroke,N={opacity:l==null?void 0:l.lineOpacity,dashArray:l==null?void 0:l.lineDash,lineType:l==null?void 0:l.lineType};if(Go.shape(e,"fill"),o&&Go.color(e,o),b&&Go.style(e,b),y&&Go.state(e,y),w&&e.setBottomColor(w),Go.shape(r,"line"),M&&Go.size(r,M),O&&Go.color(r,O),N&&Go.style(r,N),p.active.stroke){var z=p.active.stroke,j=p.active.lineWidth||M,Y={opacity:p.active.lineOpacity};Go.shape(t,"line"),j&&Go.size(t,j),z&&Go.color(t,z),Y&&Go.style(t,Y)}if(p.select.fill){var K=p.select.fill;Go.shape(n,"fill"),K&&Go.color(n,K),b&&Go.style(n,b),Go.state(n,{select:!1,active:!1})}if(p.select.stroke){var ie=p.select.stroke,j=p.select.lineWidth||M,le={opacity:p.select.lineOpacity};Go.shape(i,"line"),j&&Go.size(i,j),ie&&Go.color(i,ie),le&&Go.style(i,le)}}var bk={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},aie=["color","style","state","enabledMultiSelect"],JE=function(e){qh(r,e);function r(t){var n=e.call(this,t)||this;n.selectData=[],n.type=S0.LayerType.AreaLayer,n.interaction=!0,n.onHighlighHandle=function(O){var N=O.feature,z=O.featureId;n.setHighlightLayerSource(N,z)},n.onUnhighlighHandle=function(){n.setHighlightLayerSource()},n.onSelectHandle=function(O){var N=n.options.enabledMultiSelect,z=O.feature,j=O.featureId,Y=f1(n.selectData),K=Y.findIndex(function(le){return le.featureId===j});if(K===-1)N?Y.push({feature:z,featureId:j}):Y=[{feature:z,featureId:j}],n.emit("select",z,f1(Y));else{var ie=Y[K];N?Y.splice(K,1):Y=[],n.emit("unselect",ie,f1(Y))}n.setSelectLayerSource(Y)};var i=n.options,a=i.name,o=i.source,l=i.visible,c=i.minZoom,p=i.maxZoom,y=i.zIndex,b=y===void 0?0:y,w=n.pickLayerConfig(n.options),M=r1(n.options.state);return n.name=a||x2(n.type),n.layer=new h3(Vl(Vl({},w),{name:n.name})),n.strokeLayer=new eb({name:"strokeLayer",visible:l,zIndex:b,minZoom:c,maxZoom:p}),n.highlightLayer=new eb({name:"highlightLayer",visible:l&&Boolean(M.active.stroke),zIndex:b+.1,minZoom:c,maxZoom:p}),n.selectFillLayer=new h3({name:"selectFillLayer",visible:l&&Boolean(M.select.fill),zIndex:b+.1,minZoom:c,maxZoom:p}),n.selectStrokeLayer=new eb({name:"selectStrokeLayer",visible:l&&Boolean(M.select.stroke),zIndex:b+.1,minZoom:c,maxZoom:p}),n.mappingLayer(n.options),n.setSource(o),n.initEvent(),n}return r.prototype.getDefaultOptions=function(){return bk},r.prototype.mappingLayer=function(t){iie(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)},r.prototype.setSource=function(t){e.prototype.setSource.call(this,t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})},r.prototype.setStrokeLayerSource=function(){var t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{var n=this.layer.sourceOption,i=n.data,a=n.options;this.strokeLayer.source(i,a)}},r.prototype.setHighlightLayerSource=function(t,n){if(n===void 0&&(n=-999),this.highlightLayerData!==n){var i=t?[t]:[];this.highlightLayer.setData({type:"FeatureCollection",features:i},{parser:{type:"geojson"}}),this.highlightLayerData=n}},r.prototype.setSelectLayerSource=function(t){if(t===void 0&&(t=[]),!(this.selectData.length===t.length&&gl(this.selectData.map(function(i){var a=i.featureId;return a}),t.map(function(i){var a=i.featureId;return a})))){var n=t.map(function(i){var a=i.feature;return a});this.selectFillLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}),this.selectData=t}},r.prototype.initEvent=function(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))},r.prototype.addTo=function(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)},r.prototype.remove=function(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)},r.prototype.update=function(t){if(e.prototype.update.call(this,t),this.mappingLayer(this.options),this.options.visible){!Dv(t.state)&&!gl(this.lastOptions.state,this.options.state)&&this.updateHighlightLayer();var n=r1(this.options.state);n.active.stroke&&this.setHighlightLayerSource(),(n.select.fill||n.select.stroke)&&this.setSelectLayerSource()}this.initEvent()},r.prototype.updateHighlightLayer=function(){var t=r1(this.options.state),n=r1(this.lastOptions.state);n.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),n.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),n.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())},r.prototype.setIndex=function(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)},r.prototype.setMinZoom=function(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)},r.prototype.setMaxZoom=function(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)},r.prototype.show=function(){!this.layer.inited||(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())},r.prototype.hide=function(){!this.layer.inited||(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())},r.prototype.getColorLegendItems=function(){var t=this.layer.getLegendItems("color");if(Array.isArray(t)&&t.length!==0){var n=b6(t);return n}return[]},r.prototype.setActive=function(t){},r.prototype.setSelect=function(t){},r.DefaultOptions=bk,r.LayerOptionsKeys=S0.LayerConfigkeys.concat(aie),r}(S0),oie=vl({},FS.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),wy={world:"country",country:"province",province:"city",city:"district",district:"district"},E6="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",DS="".concat(E6,"/choropleth-data"),Ek={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}},sie=function(e,r){var t=r||{},n=t.visible,i=t.minZoom,a=t.maxZoom,o=t.zIndex,l=o===void 0?0:o,c=t.chinaBorder,p=typeof c=="object"?vl({},Ek,c):Ek,y=e.features.filter(function(z){var j=z.properties;return["coast","national"].includes(j==null?void 0:j.type)}),b=e.features.filter(function(z){var j=z.properties;return(j==null?void 0:j.type)==="dispute"}),w=e.features.filter(function(z){var j=z.properties;return(j==null?void 0:j.type)==="hkm"}),M=new QE({name:"chinaBoundaryLayer",visible:n,minZoom:i,maxZoom:a,zIndex:l+.1,source:{data:{type:"FeatureCollection",features:y},parser:{type:"geojson"}},color:{field:"type",value:function(z){var j=z.type;return p[j].color}},size:{field:"type",value:function(z){var j=z.type;return p[j].width}},style:{opacity:["type",function(z){return p[z].opacity}]}}),O=new QE({name:"chinaHkmBoundaryLayer",visible:n,minZoom:i,maxZoom:a,zIndex:l+.1,source:{data:{type:"FeatureCollection",features:w},parser:{type:"geojson"}},color:p.hkm.color,size:p.hkm.width,style:{opacity:p.hkm.opacity,lineType:"dash",dashArray:p.hkm.dashArray}}),N=new QE({name:"chinaDisputeBoundaryLayer",visible:n,minZoom:i,maxZoom:a,zIndex:l+.1,source:{data:{type:"FeatureCollection",features:b},parser:{type:"geojson"}},color:p.dispute.color,size:p.dispute.width,style:{opacity:p.dispute.opacity,lineType:"dash",dashArray:p.dispute.dashArray}});return{chinaBoundaryLayer:M,chinaHkmBoundaryLayer:O,chinaDisputeBoundaryLayer:N}},C6=new Map;function uie(e,r){C6.set(e,r)}function lie(e){return C6.get(e)}function cie(e){return e}function fie(e){if(e==null)return cie;var r,t,n=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(l,c){c||(r=t=0);var p=2,y=l.length,b=new Array(y);for(b[0]=(r+=l[0])*n+a,b[1]=(t+=l[1])*i+o;p<y;)b[p]=l[p],++p;return b}}function hie(e,r){for(var t,n=e.length,i=n-r;i<--n;)t=e[i],e[i++]=e[n],e[n]=t}function pie(e,r){return typeof r=="string"&&(r=e.objects[r]),r.type==="GeometryCollection"?{type:"FeatureCollection",features:r.geometries.map(function(t){return Ck(e,t)})}:Ck(e,r)}function Ck(e,r){var t=r.id,n=r.bbox,i=r.properties==null?{}:r.properties,a=die(e,r);return t==null&&n==null?{type:"Feature",properties:i,geometry:a}:n==null?{type:"Feature",id:t,properties:i,geometry:a}:{type:"Feature",id:t,bbox:n,properties:i,geometry:a}}function die(e,r){var t=fie(e.transform),n=e.arcs;function i(y,b){b.length&&b.pop();for(var w=n[y<0?~y:y],M=0,O=w.length;M<O;++M)b.push(t(w[M],M));y<0&&hie(b,O)}function a(y){return t(y)}function o(y){for(var b=[],w=0,M=y.length;w<M;++w)i(y[w],b);return b.length<2&&b.push(b[0]),b}function l(y){for(var b=o(y);b.length<4;)b.push(b[0]);return b}function c(y){return y.map(l)}function p(y){var b=y.type,w;switch(b){case"GeometryCollection":return{type:b,geometries:y.geometries.map(p)};case"Point":w=a(y.coordinates);break;case"MultiPoint":w=y.coordinates.map(a);break;case"LineString":w=o(y.arcs);break;case"MultiLineString":w=y.arcs.map(o);break;case"Polygon":w=c(y.arcs);break;case"MultiPolygon":w=y.arcs.map(c);break;default:return null}return{type:b,coordinates:w}}return p(r)}var vie=function(e){var r={url:DS,type:"topojson",extension:"topo.json"};return Dv(e)||(typeof e=="string"?r.url=e:(r.url=(e==null?void 0:e.url)||DS,r.type=e.type,r.extension=e.type==="topojson"?"topo.json":"json")),r},mie=function(e){try{var r=pie(e,"json");return r}catch{throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}},gie=function(e,r){if(e.length!==r.length)return!1;for(var t=0;t<e.length;t++){var n=e[t],i=n.level,a=n.granularity;if(r[t].level!==i||r[t].granularity!==a)return!1}return!0},Sk=function(e){var r=h1(e,["source","color","style","state","label","tooltip"]);return r},yie=function(e){qh(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=FS.PlotType.Choropleth,t.chinaBoundaryData={type:"FeatureCollection",features:[]},t.currentDistrictData={type:"FeatureCollection",features:[]},t.drillSteps=[],t.drillStacks=[],t.onDrillDownHander=function(n){var i,a=t.options.drill,o=a.steps,l=a.onDown,c=(i=n.feature)===null||i===void 0?void 0:i.properties,p=c.adcode;if(t.drillStacks.length!==o.length+1){var y=t.drillStacks.slice(-1)[0],b=t.drillStacks.length-1,w=t.drillSteps[b],M=w.level,O=w.granularity,N=O===void 0?wy[M]:O,z=Rp(w,["level","granularity"]),j={from:{level:y.level,adcode:y.adcode,granularity:y.granularity},to:{level:M,adcode:p,granularity:N,properties:c}},Y=function(K){K===void 0&&(K={});var ie={level:M,adcode:p,granularity:N},le=vl({},z,K);t.changeView(ie,le).then(function(Se){Se&&(t.drillStacks.push(Se),t.emit("drilldown",j))})};l?l(j.from,j.to,Y):Y()}},t.onDrillUpHander=function(){var n=t.options.drill.onUp,i=t.drillStacks.length===0||t.drillStacks.length===1;if(!i){var a=t.drillStacks.length-1,o=t.drillStacks[a],l=t.drillStacks[a-1],c={from:{level:o.level,adcode:o.adcode,granularity:o.granularity},to:{level:l.level,adcode:l.adcode,granularity:l.granularity}},p=function(y){y===void 0&&(y={});var b=c.to,w=vl({},l.config,y);t.changeView(b,w).then(function(M){M&&(t.drillStacks.pop(),t.emit("drillup",c))})};n?n(c.from,c.to,p):p()}},t}return r.prototype.initSource=function(){var t=this;this.getInitDistrictData().then(function(){t.source=t.createSource(),t.render(),t.inited=!0})},r.prototype.render=function(){var t=this;if(console.time("l7plot choropleth render time"),this.inited)this.scene.setEnableRender(!0),this.scene.render();else{var n=this.createLayers(this.source);this.layerGroup=n,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",function(){t.onSceneLoaded()}),this.initLayersEvent()}console.timeEnd("l7plot choropleth render time")},r.prototype.update=function(t){var n=this,i,a,o;if(this.updateOption(t),t.map&&!gl(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&t.drill.enabled!==!1&&!gl((i=this.lastOptions.drill)===null||i===void 0?void 0:i.steps,(a=this.options.drill)===null||a===void 0?void 0:a.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!gl(this.lastOptions.viewLevel,this.options.viewLevel)){var l=(o=t.source)===null||o===void 0?void 0:o.joinBy.geoData;console.time("l7plot choropleth update viewLevel time"),this.getDistrictData(l).then(function(){var b=n.options.source,w=b.data,M=Rp(b,["data"]);n.changeData(w,M),n.updateLayers(t),n.render(),n.updateComponents(),console.timeEnd("l7plot choropleth update viewLevel time"),n.emit("update")})}else{if(t.source&&!gl(this.lastOptions.source,this.options.source)){var c=this.options.source,p=c.data,y=Rp(c,["data"]);this.changeData(p,y)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}},r.prototype.getDefaultOptions=function(){return r.DefaultOptions},r.prototype.parserSourceConfig=function(t){var n=t.data,i=t.joinBy,a=Rp(t,["data","joinBy"]),o=i.sourceField,l=i.geoField,c=i.geoData,p=c,y={type:"join",sourceField:o,targetField:l,data:n};return a.transforms?a.transforms.push(y):a.transforms=[y],a.parser&&delete a.parser,{data:p,sourceCFG:a}},r.prototype.createSource=function(){var t=this.parserSourceConfig(this.options.source),n=t.data,i=t.sourceCFG,a=new Mm(n,i);return a},r.prototype.changeData=function(t,n){var i=this;console.time("l7plot choropleth update data time"),this.options.source=vl({},this.options.source,Vl({data:t},n));var a=this.parserSourceConfig(this.options.source),o=a.data,l=a.sourceCFG;this.source.setData(o,l),console.timeEnd("l7plot choropleth update data time");var c=this.options.legend;c&&setTimeout(function(){i.updateLegendControl(c)}),this.emit("change-data")},r.prototype.createLayers=function(t){this.fillAreaLayer=new JE(Vl({name:"fillAreaLayer",source:t},h1(this.options,JE.LayerOptionsKeys)));var n=new _6([this.fillAreaLayer]);if(this.options.chinaBorder){var i=this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options);i.forEach(function(a){return n.addLayer(a)})}return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),n.addLayer(this.labelLayer)),n},r.prototype.createCountryBoundaryLayer=function(t,n){var i=sie(t,n),a=i.chinaBoundaryLayer,o=i.chinaHkmBoundaryLayer,l=i.chinaDisputeBoundaryLayer;return this.chinaBoundaryLayer=a,this.chinaHkmBoundaryLayer=o,this.chinaDisputeBoundaryLayer=l,[a,o,l]},r.prototype.createLabelLayer=function(t,n){var i=this,a=t.originData.features.map(function(O){var N=O.properties;return Object.assign({},N,{centroid:N.centroid||N.center})}).filter(function(O){var N=O.centroid;return N}),o=this.options,l=o.visible,c=o.minZoom,p=o.maxZoom,y=o.zIndex,b=y===void 0?0:y,w=new x6(Vl({name:"labelLayer",source:{data:a,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:l,minZoom:c,maxZoom:p,zIndex:b+.1},n)),M=function(){var O=i.source.originData.features.map(function(N){var z=N.properties;return z}).filter(function(N){var z=N.centroid;return z});w.layer.setData(O)};return t.on("update",M),w.on("remove",function(){t.off("update",M)}),w},r.prototype.updateLayers=function(t){var n=this,i=h1(t,JE.LayerOptionsKeys);this.fillAreaLayer.update(i);var a=function(){var l=n.createCountryBoundaryLayer(n.chinaBoundaryData,n.options);l.forEach(function(c){return n.layerGroup.addLayer(c)})},o=function(){n.chinaBoundaryLayer&&n.layerGroup.removeLayer(n.chinaBoundaryLayer),n.chinaHkmBoundaryLayer&&n.layerGroup.removeLayer(n.chinaHkmBoundaryLayer),n.chinaDisputeBoundaryLayer&&n.layerGroup.removeLayer(n.chinaDisputeBoundaryLayer)};t.chinaBorder?(this.chinaBoundaryLayer&&o(),a()):t.chinaBorder===!1&&o(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)},r.prototype.initLayersEvent=function(){this.initDrillEvent()},r.prototype.initDrillEvent=function(){if(this.lastOptions.drill){var t=this.lastOptions.drill,n=t.triggerUp,i=n===void 0?"unclick":n,a=t.triggerDown,o=a===void 0?"click":a;this.fillAreaLayer.off(i,this.onDrillUpHander),this.fillAreaLayer.off(o,this.onDrillDownHander)}if(!(!this.options.drill||this.options.drill.enabled===!1)){var l=this.options.drill,c=l.steps,p=l.triggerUp,y=p===void 0?"unclick":p,b=l.triggerDown,w=b===void 0?"click":b,M=c.map(function(ie){return typeof ie=="string"?{level:ie,granularity:wy[ie]}:(ie.granularity||(ie.granularity=wy[ie.level]),ie)});if(gie(M,this.drillSteps)||(this.drillSteps=M,this.drillStacks=[]),!this.drillStacks.length){var O=this.options.viewLevel,N=O.level,z=O.adcode,j=O.granularity,Y=j===void 0?wy[N]:j,K=Sk(this.options);this.drillStacks=[{level:N,adcode:z,granularity:Y,config:K}]}this.fillAreaLayer.on(y,this.onDrillUpHander),this.fillAreaLayer.on(w,this.onDrillDownHander)}},r.prototype.drillReset=function(){this.drillStacks=[]},r.prototype.getCurrentDrillSteps=function(){var t=this.drillStacks.map(function(n){return h1(n,["level","adcode","granularity"])});return t},r.prototype.getLegendOptions=function(){var t=this.fillAreaLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}},r.prototype.fetchData=function(t,n,i){return Ux(this,void 0,void 0,function(){var a,o,l,c,p,y,b,w,M;return Vx(this,function(O){switch(O.label){case 0:return a="".concat(n,"_").concat(t,"_").concat(i),o=lie(a),o?[2,o]:(l=vie(this.options.geoArea),c=l.url,p=l.type,y=l.extension,w=this.options.customFetchGeoData,w?[4,w({url:c,level:t,adcode:n,granularity:i,extension:y})]:[3,2]);case 1:return b=O.sent(),[3,5];case 2:return[4,fetch("".concat(c,"/").concat(t,"/").concat(a,".").concat(y))];case 3:return M=O.sent(),[4,M.json()];case 4:b=O.sent(),O.label=5;case 5:return p==="topojson"&&(b=mie(b)),uie(a,b),[2,b]}})})},r.prototype.getInitDistrictData=function(){var t;return Ux(this,void 0,void 0,function(){var n,i,a,o;return Vx(this,function(l){switch(l.label){case 0:n=this.fetchData("country","100000","boundary"),i=(t=this.options.source)===null||t===void 0?void 0:t.joinBy.geoData,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Promise.all([n,this.getDistrictData(i)])];case 2:return o=KF.apply(void 0,[l.sent(),1]),this.chinaBoundaryData=o[0],[3,4];case 3:throw a=l.sent(),new Error("Failed to get china boundary data\uFF0C".concat(a));case 4:return[2]}})})},r.prototype.getDistrictData=function(t){return Ux(this,void 0,void 0,function(){var n,i,a,o,l,c,p,y;return Vx(this,function(b){switch(b.label){case 0:n=this.options.viewLevel,i=n.level,a=n.adcode,o=n.granularity,l=o===void 0?wy[i]:o,c=t?Promise.resolve(t):this.fetchData(i,a,l),b.label=1;case 1:return b.trys.push([1,3,,4]),p=this,[4,c];case 2:return p.currentDistrictData=b.sent(),this.options.source=vl({},this.options.source,{joinBy:{geoData:this.currentDistrictData}}),[3,4];case 3:throw y=b.sent(),new Error("Failed to get district data\uFF0C".concat(y));case 4:return[2]}})})},r.prototype.drillDown=function(t,n){var i=this;n===void 0&&(n={}),this.changeView(t,n).then(function(a){a&&i.drillStacks.push(a)})},r.prototype.drillUp=function(t,n){t===void 0&&(t={});var i=this.drillStacks.length,a=[0,1].includes(i);if(!a){var o=n?this.drillStacks.findIndex(function(M){return M.level===n}):-1,l=o!==-1,c=l?o:i-2,p=this.drillStacks[c],y=p.config,b=Rp(p,["config"]),w=vl({},y,t);this.changeView(b,w),l?this.drillStacks.splice(o+1):this.drillStacks.pop()}},r.prototype.changeView=function(t,n){return n===void 0&&(n={}),Ux(this,void 0,void 0,function(){var i,a,o,l,c,p,y;return Vx(this,function(b){switch(b.label){case 0:return i=t.level,a=t.adcode,o=t.granularity,l=o===void 0?wy[i]:o,[4,this.fetchData(i,a,l)];case 1:return c=b.sent(),c.features.length?(p=vl({},Sk(this.options),n,{viewLevel:{level:i,adcode:a,granularity:l},source:{joinBy:{geoData:c}}}),this.update(p),y={level:i,adcode:a,granularity:l,config:p},[2,y]):[2]}})})},r.DefaultOptions=oie,r.GeoDataUrl=E6,r.GeoAreaUrl=DS,r}(FS);const _ie=[{name:"\u53A6\u95E8\u5E02",value:100,adcode:350200},{name:"\u767D\u94F6\u5E02",value:100,adcode:620400},{name:"\u9152\u6CC9\u5E02",value:200,adcode:620900},{name:"\u5170\u5DDE\u5E02",value:100,adcode:620100},{name:"\u4E34\u590F\u56DE\u65CF\u81EA\u6CBB\u5DDE",value:200,adcode:622900},{name:"\u9647\u5357\u5E02",value:100,adcode:621200},{name:"\u5F20\u6396\u5E02",value:100,adcode:620700},{name:"\u4E1C\u839E\u5E02",value:100,adcode:441900},{name:"\u5E7F\u5DDE\u5E02",value:100,adcode:440100},{name:"\u6E05\u8FDC\u5E02",value:100,adcode:441800},{name:"\u6DF1\u5733\u5E02",value:200,adcode:440300},{name:"\u767E\u8272\u5E02",value:100,adcode:451e3},{name:"\u5D07\u5DE6\u5E02",value:200,adcode:451400},{name:"\u9632\u57CE\u6E2F\u5E02",value:200,adcode:450600},{name:"\u5B89\u987A\u5E02",value:100,adcode:520400},{name:"\u6BD5\u8282\u5E02",value:200,adcode:520500},{name:"\u8D35\u9633\u5E02",value:200,adcode:520100},{name:"\u9075\u4E49\u5E02",value:100,adcode:520300},{name:"\u6D77\u53E3\u5E02",value:100,adcode:460100},{name:"\u4E09\u4E9A\u5E02",value:200,adcode:460200},{name:"\u4E07\u5B81\u5E02",value:100,adcode:469006},{name:"\u4FDD\u5B9A\u5E02",value:100,adcode:130600},{name:"\u627F\u5FB7\u5E02",value:100,adcode:130800},{name:"\u77F3\u5BB6\u5E84\u5E02",value:200,adcode:130100},{name:"\u5510\u5C71\u5E02",value:100,adcode:130200},{name:"\u6FEE\u9633\u5E02",value:100,adcode:410900},{name:"\u65B0\u4E61\u5E02",value:200,adcode:410700},{name:"\u4FE1\u9633\u5E02",value:100,adcode:411500},{name:"\u90D1\u5DDE\u5E02",value:100,adcode:410100},{name:"\u5468\u53E3\u5E02",value:100,adcode:411600},{name:"\u5927\u5E86\u5E02",value:200,adcode:230600},{name:"\u54C8\u5C14\u6EE8\u5E02",value:100,adcode:230100},{name:"\u9ED1\u6CB3\u5E02",value:100,adcode:231100},{name:"\u4F73\u6728\u65AF\u5E02",value:200,adcode:230800},{name:"\u9102\u5DDE\u5E02",value:100,adcode:420700},{name:"\u6069\u65BD\u571F\u5BB6\u65CF\u82D7\u65CF\u81EA\u6CBB\u5DDE",value:200,adcode:422800},{name:"\u968F\u5DDE\u5E02",value:100,adcode:421300},{name:"\u6B66\u6C49\u5E02",value:100,adcode:420100},{name:"\u8944\u9633\u5E02",value:100,adcode:420600},{name:"\u6E58\u6F6D\u5E02",value:100,adcode:430300},{name:"\u5357\u901A\u5E02",value:100,adcode:320600},{name:"\u8D63\u5DDE\u5E02",value:100,adcode:360700},{name:"\u5409\u5B89\u5E02",value:200,adcode:360800},{name:"\u6C88\u9633\u5E02",value:100,adcode:210100},{name:"\u963F\u62C9\u5584\u76DF",value:100,adcode:152900},{name:"\u8D64\u5CF0\u5E02",value:200,adcode:150400},{name:"\u547C\u4F26\u8D1D\u5C14\u5E02",value:100,adcode:150700},{name:"\u56FA\u539F\u5E02",value:100,adcode:640400},{name:"\u5434\u5FE0\u5E02",value:100,adcode:640300},{name:"\u94F6\u5DDD\u5E02",value:100,adcode:640100},{name:"\u4E2D\u536B\u5E02",value:200,adcode:640500},{name:"\u6D77\u5357\u85CF\u65CF\u81EA\u6CBB\u5DDE",value:100,adcode:632500},{name:"\u6D77\u897F\u8499\u53E4\u65CF\u85CF\u65CF\u81EA\u6CBB\u5DDE",value:200,adcode:632800},{name:"\u83CF\u6CFD\u5E02",value:100,adcode:371700},{name:"\u6D4E\u5B81\u5E02",value:200,adcode:370800},{name:"\u9752\u5C9B\u5E02",value:200,adcode:370200},{name:"\u5A01\u6D77\u5E02",value:100,adcode:371e3},{name:"\u70DF\u53F0\u5E02",value:100,adcode:370600},{name:"\u5B9D\u9E21\u5E02",value:200,adcode:610300},{name:"\u5546\u6D1B\u5E02",value:100,adcode:611e3},{name:"\u6E2D\u5357\u5E02",value:100,adcode:610500},{name:"\u4E0A\u6D77\u5E02",value:200,adcode:310100},{name:"\u963F\u575D\u85CF\u65CF\u7F8C\u65CF\u81EA\u6CBB\u5DDE",value:100,adcode:513200},{name:"\u5DF4\u4E2D\u5E02",value:100,adcode:511900},{name:"\u6210\u90FD\u5E02",value:200,adcode:510100},{name:"\u8FBE\u5DDE\u5E02",value:100,adcode:511700},{name:"\u5FB7\u5DDE\u5E02",value:100,adcode:371400},{name:"\u5E7F\u5B89\u5E02",value:100,adcode:511600},{name:"\u5E7F\u5143\u5E02",value:100,adcode:510800},{name:"\u4E50\u5C71\u5E02",value:100,adcode:511100},{name:"\u6CF8\u5DDE\u5E02",value:100,adcode:510500},{name:"\u7EF5\u9633\u5E02",value:100,adcode:510700},{name:"\u5357\u5145\u5E02",value:100,adcode:511300},{name:"\u5185\u6C5F\u5E02",value:200,adcode:511e3},{name:"\u9042\u5B81\u5E02",value:200,adcode:510900},{name:"\u5B9C\u5BBE\u5E02",value:200,adcode:511500},{name:"\u81EA\u8D21\u5E02",value:100,adcode:510300},{name:"\u5929\u6D25\u5E02",value:200,adcode:120100},{name:"\u660C\u90FD\u5E02",value:100,adcode:540300},{name:"\u62C9\u8428\u5E02",value:100,adcode:540100},{name:"\u90A3\u66F2\u5E02",value:100,adcode:540600},{name:"\u65E5\u5580\u5219\u5E02",value:100,adcode:540200},{name:"\u5DF4\u97F3\u90ED\u695E\u8499\u53E4\u81EA\u6CBB\u5DDE",value:100,adcode:652800},{name:"\u54C8\u5BC6\u5E02",value:100,adcode:650500},{name:"\u5854\u57CE\u5730\u533A",value:100,adcode:654200},{name:"\u5410\u9C81\u756A\u5E02",value:200,adcode:650400},{name:"\u4E4C\u9C81\u6728\u9F50\u5E02",value:200,adcode:650100},{name:"\u4F0A\u7281\u54C8\u8428\u514B\u81EA\u6CBB\u5DDE",value:200,adcode:654e3},{name:"\u77F3\u6CB3\u5B50\u5E02",value:200,adcode:659001},{name:"\u5FB7\u5B8F\u50A3\u65CF\u666F\u9887\u65CF\u81EA\u6CBB\u5DDE",value:100,adcode:533100},{name:"\u7EA2\u6CB3\u54C8\u5C3C\u65CF\u5F5D\u65CF\u81EA\u6CBB\u5DDE",value:100,adcode:532500},{name:"\u6E29\u5DDE\u5E02",value:100,adcode:330300},{name:"\u91CD\u5E86\u5E02",value:100,adcode:500100}];const xie=(e,r)=>{const t=e.__vccOpts||e;for(const[n,i]of r)t[n]=i;return t},rx=e=>(TD("data-v-90995b8e"),e=e(),MD(),e),bie=rx(()=>mh("div",{id:"map",class:"w-full h-full"},null,-1)),Eie=rx(()=>mh("div",{id:"title"},[mh("h2",{class:"text-sm"},"\u5317\u4EAC\u5065\u5EB7\u5B9D\u5F39\u7A97\u5730\u56FE"),mh("span",null,"\u57FA\u4E8E\u75BE\u63A7\u4E2D\u5FC3\u6570\u636E\uFF0C\u544A\u77E5\u4F60\u53BB\u4E86\u54EA\u91CC\u53EF\u80FD\u4F1A\u5F39\u7A973"),mh("br"),mh("span",null,"\u7EA2\u8272\u5168\u5E02\u5F39\u3001\u9EC4\u8272\u90E8\u5206\u533A\u5F39\uFF1B\u65B0\u7586\u3001\u897F\u85CF\u3001\u6D77\u5357\u5168\u57DF\u90FD\u4F1A\u5F39"),mh("br"),mh("span",null,[cR("\u66F4\u65B0\u65F6\u95F4\uFF1A2022-09-23 "),mh("a",{href:"https://mp.weixin.qq.com/s/vmMoHbVxUV5ML9i-mkvpsg"},"\u6570\u636E\u6765\u6E90")])],-1)),Cie={href:"https://github.com/kokdemo/beijing-popup-map",class:"github-corner","aria-label":"View source on GitHub"},Sie={width:"80",height:"80",viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",top:"0",border:"0",right:"0"},"aria-hidden":"true"},wie=rx(()=>mh("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"},null,-1)),Aie=rx(()=>mh("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{"transform-origin":"130px 106px"},class:"octo-arm"},null,-1)),Tie=rx(()=>mh("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",class:"octo-body"},null,-1)),Mie=[wie,Aie,Tie],Iie={__name:"App",setup(e){return tw(()=>{const r=new ZF({id:"map",map:new lP({style:"blank",center:[120.19382669582967,30.258134],zoom:3,pitch:0})});r.on("loaded",()=>{new yie({source:{data:_ie,joinBy:{sourceField:"adcode",geoField:"adcode"}},viewLevel:{level:"country",adcode:1e5,granularity:"city"},autoFit:!0,color:{field:"value",value:["#FDE68A","#EF4444"],scale:{type:"quantize"}},style:{opacity:1,stroke:"#ccc",lineWidth:.6,lineOpacity:1},label:{visible:!0,field:"name",style:{fill:"#000",opacity:.8,fontSize:10,stroke:"#fff",strokeWidth:1.5,textAllowOverlap:!1,padding:[5,5]}},state:{active:{stroke:"black",lineWidth:1}},zoom:{position:"bottomright"},legend:{title:"\u8B66\u544A\u5730\u56FE",position:"bottomleft",items:[{id:"1",color:"#FFFF00",value:"\u90E8\u5206\u533A\u53BF\u5F39\u7A97"},{id:"2",color:"#FF0000",value:"\u5168\u5E02\u5F39\u7A97"}]},chinaBorder:!1}).addToScene(r)})}),(r,t)=>(HA(),$A(Gd,null,[bie,Eie,mh("a",Cie,[(HA(),$A("svg",Sie,Mie))])],64))}},Lie=xie(Iie,[["__scopeId","data-v-90995b8e"]]);e8(Lie).mount("#app");
